<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Ejemplo</title>
    <link
      rel="stylesheet"
      href="https://js.arcgis.com/4.26/esri/themes/light/main.css"
    />
    <script src="https://js.arcgis.com/4.26/"></script>

    <style>
      html,
      body,
      #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }
      .buttons {
        position: absolute;
        bottom: 20px;
        left: 0;
        right: 0;
        text-align: center;
      }
      .esri-button {
        display: inline;
        background-color: white;
        min-width: 200px;
        max-width: 300px;
      }
    </style>

    <script>
      require([
        "esri/config",
        "esri/Map",
        "esri/views/SceneView",
        "esri/layers/SceneLayer",
        "esri/layers/FeatureLayer",
        "esri/symbols/ExtrudeSymbol3DLayer",
      ], function (
        esriConfig,
        Map,
        SceneView,
        SceneLayer,
        FeatureLayer,
        ExtrudeSymbol3DLayer
      ) {
        esriConfig.apiKey =
          "AAPK18837c198fe14f849f5237a94fb8c4d9nyUIHfhPmykTR_afDukiTorJHXPimhB05XjXQ6o6rDQ-GAsclkcQJjNfsUX-ulMj";

          const urlServicio = "https://serviciosgis.catastrobogota.gov.co/arcgis/rest/services/catastro/construccion/MapServer/0";
          // const urlServicio = "https://sinupot.sdp.gov.co/serverp/rest/services/CATASTRAL/Division_Fisica/MapServer/0";

        const footprintBuildings = new FeatureLayer({
          url: urlServicio,
          renderer: {
            type: "simple",
            symbol: {
              type: "polygon-3d",
              symbolLayers: [
                {
                  type: "fill",
                  material: { color: [255, 237, 204] },
                  outline: { color: [133, 108, 62, 0.5] },
                },
              ],
            },
          },
          visible: false,
        });

        // Crear un símbolo para la extrusión de los polígonos
        const extrusionSymbol = new ExtrudeSymbol3DLayer({
          material: {
            color: [255, 0, 0, 0.7],
          },
          size: (geometry, graphic) => {
            const height = 5; //graphic.attributes["NUMERO_PISO"] * 2; // Multiplicar por 2 para dar la altura en metros
            return height;
          },
          // Establecer la base de la extrusión en el suelo
          anchor: "relative-to-ground",
        });

        let symbol = {
          type: "polygon-3d", // autocasts as new PolygonSymbol3D()
          symbolLayers: [
            {
              type: "extrude", // autocasts as new ExtrudeSymbol3DLayer()
              material: {
                color: [255, 0, 0, 0.7],
              },
              size: (geometry, graphic) => {
                const height = 5; // graphic.attributes["NUMERO_PISO"] * 2; // Multiplicar por 2 para dar la altura en metros
                return height;
              },
              // Establecer la base de la extrusión en el suelo
              anchor: "relative-to-ground",
            },
          ],
        };

        const extrudedBuildings = new FeatureLayer({
          url: urlServicio,// "https://sinupot.sdp.gov.co/serverp/rest/services/CATASTRAL/Division_Fisica/MapServer/0/query?where=1%3D1&text=&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&distance=&units=esriSRUnit_Foot&relationParam=&outFields=*&returnGeometry=true&returnTrueCurves=false&maxAllowableOffset=&geometryPrecision=&outSR=&havingClause=&returnIdsOnly=false&returnCountOnly=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&returnZ=false&returnM=false&gdbVersion=&historicMoment=&returnDistinctValues=false&resultOffset=&resultRecordCount=&returnExtentOnly=false&datumTransformation=&parameterValues=&rangeValues=&quantizationParameters=&featureEncoding=esriDefault&f=pjson",
          renderer: {
            type: "simple",
            symbol: symbol,
            visualVariables: [
              {
                type: "size",
                field: "CONNPISOS", // "NUMERO_PISO",
                valueUnit: "meters",
              },
            ],
          },
          visible: true,
        });

        // Create Map
        var map = new Map({
          basemap: "arcgis-light-gray",
          ground: "world-elevation",
          layers: [footprintBuildings, extrudedBuildings],
        });

        // Create the SceneView
        var view = new SceneView({
          container: "viewDiv",
          map: map,
          camera: {
            position: [-74.11, 4.55, 314.88439],
            heading: 356.82,
            tilt: 78.61,
          },
          qualityProfile: "high",
        });
        let type = "cartographic";
        document
          .getElementById("footprint")
          .addEventListener("click", function (event) {
            footprintBuildings.visible = true;
            extrudedBuildings.visible = false;
          });
        document
          .getElementById("extruded")
          .addEventListener("click", function (event) {
            footprintBuildings.visible = false;
            extrudedBuildings.visible = true;
          });
      });
    </script>
  </head>

  <body>
    <div id="viewDiv"></div>
    <div class="buttons">
      <button
        id="footprint"
        class="esri-button esri-button--secondary esri-button--half"
      >
        Footprints
      </button>
      <button
        id="extruded"
        class="esri-button esri-button--secondary esri-button--half"
      >
        Extruded footprints
      </button>
    </div>
  </body>
</html>
