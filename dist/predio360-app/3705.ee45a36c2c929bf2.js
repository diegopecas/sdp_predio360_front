"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[3705],{88755:(F,P,i)=>{i.d(P,{Y:()=>M,h:()=>I});var p=i(21726),m=i(31099);function I(_,d){return{...h(_,d),readResourcePaths:[]}}function M(_,d,D){const g=(0,p.mN)(_.itemUrl);return{...h(_,d),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:g?{rootPath:g.path,writtenUrls:[]}:null,resources:D?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function h(_,d){return{origin:d,url:(0,p.mN)(_.itemUrl),portal:_.portal||m.Z.getDefault(),portalItem:_}}},83705:(F,P,i)=>{i.r(P),i.d(P,{load:()=>J});var p=i(15861),m=i(26584),I=i(38305),M=i(17196),h=i(27369),_=i(71074),d=i(30164),D=i(31099),g=i(88755),y=i(73391),N=i(37281),$=i(39683),X=i(45205);function J(e,n){return L.apply(this,arguments)}function L(){return L=(0,p.Z)(function*(e,n){const r=e.instance.portalItem;if(r?.id)return yield r.load(n),function Q(e){const n=e.instance.portalItem;if(!n?.type||!e.supportedTypes.includes(n.type))throw new m.Z("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}'",{type:n?.type,expectedType:e.supportedTypes.join(", ")})}(e),e.validateItem&&e.validateItem(r),function z(e,n){return T.apply(this,arguments)}(e,n)}),L.apply(this,arguments)}function T(){return T=(0,p.Z)(function*(e,n){const r=e.instance,t=r.portalItem;if(!t)return;const{url:s,title:l}=t,a=(0,g.h)(t,"portal-item");if("group"===r.type)return function H(e,n,r){return v.apply(this,arguments)}(r,a,e);s&&"media"!==r.type&&r.read({url:s},a);const o=new h.L,u=yield K(e,o,n);return u&&r.read(u,a),r.resourceReferences={portalItem:t,paths:a.readResourcePaths??[]},"subtype-group"!==r.type&&r.read({title:l},a),(0,$.y)(r,a)}),T.apply(this,arguments)}function v(){return v=(0,p.Z)(function*(e,n,r){const t=e.portalItem;if(!e.sourceIsPortalItem)return;const{title:s,type:l}=t;if("Group Layer"===l){if(!(0,N._$)(t,"Map"))throw new m.Z("portal:invalid-layer-item-typekeyword","'Group Layer' item without 'Map' type keyword is not supported");return function Y(e){return O.apply(this,arguments)}(e)}return e.read({title:s},n),function V(e,n){return x.apply(this,arguments)}(e,r)}),v.apply(this,arguments)}function O(){return(O=(0,p.Z)(function*(e){const n=e.portalItem,r=yield n.fetchData("json");if(!r)return;const t=(0,g.h)(n,"web-map");e.read(r,t),yield(0,_.populateGroupLayer)(e,r,{context:t}),e.resourceReferences={portalItem:n,paths:t.readResourcePaths??[]}})).apply(this,arguments)}function x(){return x=(0,p.Z)(function*(e,n){let r;const{portalItem:t}=e;if(!t)return;const s=t.type,l=n.layerModuleTypeMap;switch(s){case"Feature Service":case"Feature Collection":r=l.FeatureLayer;break;case"Stream Service":r=l.StreamLayer;break;case"Scene Service":r=l.SceneLayer;break;default:throw new m.Z("portal:unsupported-item-type-as-group",`The item type '${s}' is not supported as a 'IGroupLayer'`)}const a=new h.L;let[o,u]=yield Promise.all([r(),K(n,a)]),c=()=>o;if("Feature Service"===s){const ae=(0,y.uE)(u)?.customParameters;u=t.url?yield(0,y.$O)(u,t.url,a):{};const W=(0,y.XX)(u),Z=(0,y._Y)(u),se=(0,y.H2)(u),E=[];if(W.length||Z?.length){W.length&&E.push("SubtypeGroupLayer"),Z?.length&&E.push("OrientedImageryLayer"),se?.length&&E.push("CatalogLayer");const w=[];for(const f of E)w.push((0,l[f])());const oe=yield Promise.all(w),G=new Map;E.forEach((f,A)=>{G.set(f,oe[A])}),c=f=>f.layerType?G.get(f.layerType)??o:o}const le=yield function ne(e,n){return b.apply(this,arguments)}(t.url,{customParameters:ae,loadContext:a});return yield U(e,c,u,le)}return"Scene Service"===s&&t.url&&(u=yield(0,y.CD)(t,u,a)),(0,y.Q4)(u)>0?yield U(e,c,u):yield function k(e,n){return C.apply(this,arguments)}(e,c)}),x.apply(this,arguments)}function C(){return(C=(0,p.Z)(function*(e,n){const{portalItem:r}=e;if(!r?.url)return;const t=yield(0,X.T)(r.url);t&&U(e,n,{layers:t.layers?.map(y.bS),tables:t.tables?.map(y.bS)})})).apply(this,arguments)}function U(e,n,r,t){return R.apply(this,arguments)}function R(){return(R=(0,p.Z)(function*(e,n,r,t){let s=r.layers||[];const l=r.tables||[];if("Feature Collection"===e.portalItem?.type?(s.forEach((a,o)=>{a.id=o,"Table"===a?.layerDefinition?.type&&l.push(a)}),s=s.filter(a=>"Table"!==a?.layerDefinition?.type)):(s.reverse(),l.reverse()),s.forEach(a=>{const o=t?.(a);if(o||!t){const u=B(e,n(a),r,a,o);e.add(u)}}),l.length){const a=yield d.T.FeatureLayer();l.forEach(o=>{const u=t?.(o);if(u||!t){const c=B(e,a,r,o,u);e.tables.add(c)}})}})).apply(this,arguments)}function B(e,n,r,t,s){const l=e.portalItem,a={portalItem:l.clone(),layerId:t.id};null!=t.url&&(a.url=t.url);const o=new n(a);if("sourceJSON"in o&&(o.sourceJSON=s),"subtype-group"!==o.type&&"catalog"!==o.type&&(o.sublayerTitleMode="service-name"),"Feature Collection"===l.type){const u={origin:"portal-item",portal:l.portal||D.Z.getDefault()};o.read(t,u);const c=r.showLegend;null!=c&&o.read({showLegend:c},u)}return o}function K(e,n,r){return S.apply(this,arguments)}function S(){return S=(0,p.Z)(function*(e,n,r){if(!1===e.supportsData)return;const t=e.instance,s=t.portalItem;if(!s)return;let l=null;try{l=yield s.fetchData("json",r)}catch{}if(function te(e){return"stream"!==e.type&&"layerId"in e}(t)){let a=null;const o=yield function q(e,n,r){return j.apply(this,arguments)}(s,l,n);if((l?.layers||l?.tables)&&o>0){if(null==t.layerId){const u=(0,y.XX)(l);t.layerId="subtype-group"===t.type?u?.[0]:(0,y.Ok)(l)}a=function ee(e,n){const{layerId:r}=n,t=e.layers?.find(s=>s.id===r)||e.tables?.find(s=>s.id===r);return t&&function re(e,n){return!("feature"===n.type&&"layerType"in e&&"SubtypeGroupLayer"===e.layerType||"subtype-group"===n.type&&!("layerType"in e))}(t,n)?t:null}(l,t),a&&null!=l.showLegend&&(a.showLegend=l.showLegend)}return o>1&&"sublayerTitleMode"in t&&"service-name"!==t.sublayerTitleMode&&(t.sublayerTitleMode="item-title-and-service-name"),a}return l}),S.apply(this,arguments)}function j(){return(j=(0,p.Z)(function*(e,n,r){if(n?.layers&&n?.tables)return(0,y.Q4)(n);const t=(0,I.Qc)(e.url);if(!t)return 1;const s=yield r.fetchServiceMetadata(t.url.path,{customParameters:(0,y.uE)(n)?.customParameters}).catch(()=>null);return(n?.layers?.length??s?.layers?.length??0)+(n?.tables?.length??s?.tables?.length??0)})).apply(this,arguments)}function b(){return(b=(0,p.Z)(function*(e,n){const{layersJSON:r}=yield(0,M.V)(e,n);if(!r)return null;const t=[...r.layers,...r.tables];return s=>t.find(l=>l.id===s.id)})).apply(this,arguments)}}}]);