"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[101],{22498:(te,V,t)=>{t.d(V,{z:()=>v});var E=t(17626),x=(t(29132),t(83761)),j=t(85931),Y=t(63290),K=t(21286),T=t(76825),p=t(32917),P=t(16730),a=t(77712),D=(t(8314),t(76898)),y=t(79800),W=t(29302),S=t(80774),R=t(92383),w=t(55915),C=t(15869),n=t(1582),I=t(5548),g=t(65401),m=t(36344),b=t(94425),F=t(37053),N=t(97126),ie=t(46367),ge=t(98624),_e=t(42964),ae=t(65234);const le="esri.views.3d.layers.i3s.I3SMeshViewFilter",X=()=>Y.Z.getLogger(le);let v=class extends x.Z{constructor(e){super(e),this._projectionEngineLoaded=!1}initialize(){(0,p.N1)(()=>this.viewFilter?.geometry||null!=this.layerFilter).then(()=>this.loadAsyncModule(Promise.all([t.e(4918),t.e(4766)]).then(t.bind(t,44766)).then(e=>{this.destroyed||(this._geometryEngine=e)})))}get sortedObjectIds(){if(null==this.viewFilter?.objectIds)return null;const e=(0,m.QZ)(this.viewFilter.objectIds);return e.sort(),e}get parsedWhereClause(){const e=this.viewFilter?.where;if(null==e||!e)return null;try{return S.WhereClause.create(e,this.layerFieldsIndex)}catch(r){X().error(`Failed to parse filter where clause: ${r}`)}return null}addFilters(e,r,s,u){const i=this.sortedObjectIds;null!=i&&e.push(_=>(0,_e.Yb)(i,!0,_)),this.addSqlFilter(e,this.parsedWhereClause),this.addTimeFilter(e,this.viewFilter?.timeExtent);const o=(0,T.lK)(this._layerMaskGeometries),l=this._geometryEngine;if(null!=o&&null!=this.layerFilter&&null!=l){const _=this.layerFilter.spatialRelationship;e.push((d,f)=>Ee(l,d,f,u,r,s,o,_))}const c=(0,T.lK)(this._viewMaskGeometries);if(null!=c&&null!=this.viewFilter&&null!=l){const _=this.viewFilter.spatialRelationship;e.push((d,f)=>Ee(l,d,f,u,r,s,c,_))}}isMBSGeometryVisible(e,r,s){const u=(0,T.lK)(this._layerMaskGeometries),i=this._geometryEngine;if(null!=u&&null!=this.layerFilter&&null!=i){const l=this.layerFilter.spatialRelationship,c=u[0].spatialReference||r;return(0,C.s)(e,s,k,c)?ue(i,k,u,c,l):(X().warnOnce("SceneLayer.mask geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)}const o=(0,T.lK)(this._viewMaskGeometries);if(null!=o&&null!=this.viewFilter&&null!=i){const l=this.viewFilter.spatialRelationship,c=o[0].spatialReference||r;return(0,C.s)(e,s,k,c)?ue(i,k,o,c,l):(X().warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)}return!0}get parsedGeometry(){const e=(0,T.lK)(this._viewMaskGeometries),r=(0,T.lK)(this._layerMaskGeometries);return null==e||null==r?e||r:r.concat(e)}get _layerMaskGeometries(){const e=this.layerFilter;return null==e?null:null==this._geometryEngine?T.cn:"disjoint"===e.spatialRelationship?e.geometries.map(r=>({type:"polygon",rings:r.rings,spatialReference:r.spatialReference,cache:{}})):[e.geometries.reduce((r,s)=>(r.rings=[...r.rings,...s.rings],r),{type:"polygon",rings:[],spatialReference:e.geometries[0].spatialReference,cache:{}})]}get _viewMaskGeometries(){if(null==this.viewFilter)return null;const{geometry:e}=this.viewFilter;if(null==e)return null;if(null==this.viewFilter||null==this._geometryEngine)return T.cn;const{distance:r,units:s}=this.viewFilter,u=this.viewFilter.spatialRelationship,i="mesh"===e.type?e.extent:e;if(null==r||0===r)return ee(this._geometryEngine,i,u);const o=s||(0,P.qE)(i.spatialReference);if(i.spatialReference.isWGS84){const _=this._geometryEngine.geodesicBuffer(i,r,o);return ee(this._geometryEngine,_,u)}const l=(0,ie.iV)(i,ae.Z.WGS84);if(null!=l){const _=(0,ie.iV)(this._geometryEngine.geodesicBuffer(l,r,o),i.spatialReference);return ee(this._geometryEngine,_,u)}if(!this._projectionEngineLoaded&&(this.loadAsyncModule((0,w.load)().then(()=>this._projectionEngineLoaded=!0)),!this._projectionEngineLoaded))return null;let c=null;try{c=(0,w.project)(i,ae.Z.WGS84)}catch{}if(c)try{c=(0,w.project)(this._geometryEngine.geodesicBuffer(c,r,o),i.spatialReference)}catch{c=null}return c||X().error(`Filter by geodesic buffer (distance) unsupported, failed to project input geometry (${i.spatialReference.wkid}) to WGS84.`),ee(this._geometryEngine,c,u)}get updating(){return(0,T.j)(this._layerMaskGeometries)||(0,T.j)(this._viewMaskGeometries)}static checkSupport(e){return!(null==e||!function he(e){return null!=e&&ce.includes(e)}(e.spatialRelationship)&&(X().warn(`Filters with spatialRelationship other than ${ce.join(", ")} are not supported for mesh scene layers`),1))}};(0,E._)([(0,a.Cb)()],v.prototype,"layerFilter",void 0),(0,E._)([(0,a.Cb)({type:ge.Z})],v.prototype,"viewFilter",void 0),(0,E._)([(0,a.Cb)()],v.prototype,"layerFieldsIndex",void 0),(0,E._)([(0,a.Cb)()],v.prototype,"loadAsyncModule",void 0),(0,E._)([(0,a.Cb)()],v.prototype,"addSqlFilter",void 0),(0,E._)([(0,a.Cb)()],v.prototype,"addTimeFilter",void 0),(0,E._)([(0,a.Cb)({readOnly:!0})],v.prototype,"sortedObjectIds",null),(0,E._)([(0,a.Cb)({readOnly:!0})],v.prototype,"parsedWhereClause",null),(0,E._)([(0,a.Cb)({readOnly:!0})],v.prototype,"parsedGeometry",null),(0,E._)([(0,a.Cb)({readOnly:!0})],v.prototype,"_layerMaskGeometries",null),(0,E._)([(0,a.Cb)({readOnly:!0})],v.prototype,"_viewMaskGeometries",null),(0,E._)([(0,a.Cb)()],v.prototype,"updating",null),(0,E._)([(0,a.Cb)()],v.prototype,"_projectionEngineLoaded",void 0),(0,E._)([(0,a.Cb)()],v.prototype,"_geometryEngine",void 0),v=(0,E._)([(0,D.j)(le)],v);const ce=["contains","intersects","disjoint"];var M,e;function ee(e,r,s){if(null==r)return null;if("disjoint"===s&&"polygon"===r.type){const u=r.rings.length,i=r.spatialReference,o=new Array(u);for(let _=0;_<u;++_){const d=(0,g.al)(1/0,1/0,-1/0,-1/0);(0,g.Wi)(d,r.rings[_]),o[_]={type:"polygon",rings:[r.rings[_]],spatialReference:i,cache:{},aabr:d}}o.sort((_,d)=>_.aabr[0]-d.aabr[0]);const l=new Set,c=new j.SO;for(let _=0;_<o.length;++_){const d=o[_],f=d.aabr[0];l.forEach(h=>{if(f>=h.aabr[2])return void l.delete(h);if(d.aabr[1]>h.aabr[3]||d.aabr[3]<h.aabr[1]||!e.intersects(d,h))return;d.rings=d.rings.concat(h.rings),(0,g.jn)(d.aabr,h.aabr,d.aabr),d.cache={},l.delete(h);const B=(0,j.cq)(o,h,o.length,c);o.splice(B,1)}),l.add(d)}for(const _ of o)_.aabr=void 0;return o}return[r]}function ue(e,r,s,u,i){if(r[3]>=.5*(r[2]+(0,R.Iu)(u).radius))return!0;const o=de(e,r,u);return s.every(l=>ye(e,l,o,i)!==M.DISCARD)}function Ee(e,r,s,u,i,o,l,c){const _=l[0].spatialReference||i.spatialReference;if(!(0,C.s)(s.node.serviceMbsInIndexSR,o,k,_))return void X().warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter");const d=de(e,k,_),f=function Oe(e,r,s,u,i){const o=r.renderSpatialReference,l=new Map,c={type:"polygon",rings:[[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],spatialReference:s};c.rings[0][3]=c.rings[0][0];let d,f;switch(e){case"intersects":d=(h,B,Z)=>h.intersects(B,Z)?M.KEEP:M.TEST,f=re;break;case"contains":d=(h,B,Z)=>h.contains(B,Z)?M.TEST:M.DISCARD,f=re;break;default:d=(h,B,Z)=>h.disjoint(B,Z)?M.TEST:M.DISCARD,f=pe}return{collection:u,object:i,type:e,maskSR:s,renderSR:o,aabbCache:l,triangle:c,positions:{indices:null,data:null,stride:0,startIndex:0,endIndex:0},triangleTest:d,geometryTest:f}}(c,i,_,u,s.objectHandle);for(const h of l){if(0===r.length)return;switch(ye(e,h,d,c)){case M.DISCARD:return void(r.length=0);case M.KEEP:continue}(0,_e.hv)(r,s.featureIds,B=>Me(e,h,B,f))}}(e=M||(M={}))[e.KEEP=0]="KEEP",e[e.DISCARD=1]="DISCARD",e[e.TEST=2]="TEST";const k=(0,N.f)(0,0,0,0);function de(e,r,s){const u={type:"point",x:r[0],y:r[1],hasZ:!1,hasM:!1,spatialReference:s},i=!(0,F.oR)(s)&&!(0,F.sS)(s),o=Number.isNaN(r[3])?0:(0,K.uZ)(r[3],0,2*b.sv.radius),l=i?e.buffer(u,o,1):e.geodesicBuffer(u,o,1);return l.type="polygon",l}function ye(e,r,s,u){switch(u){case"intersects":case"contains":return re(e,r,s);case"disjoint":return pe(e,r,s)}}function re(e,r,s){return e.intersects(r,s)?e.contains(r,s)?M.KEEP:M.TEST:M.DISCARD}function pe(e,r,s){return e.intersects(r,s)?e.contains(r,s)?M.DISCARD:M.TEST:M.KEEP}function Me(e,r,s,u){const{collection:i,object:o,renderSR:l,maskSR:c,geometryTest:_,aabbCache:d}=u;let f=d.get(s);if(!f){const J=i.getObjectTransform(o);i.getComponentAabb(o,s,Q);const L=[(0,W.al)(Q[0],Q[1],0),(0,W.al)(Q[0],Q[4],0),(0,W.al)(Q[3],Q[4],0),(0,W.al)(Q[3],Q[1],0)];for(let U=0;U<4;++U)(0,y.t)(L[U],L[U],J.rotationScale),(0,y.g)(L[U],L[U],J.position),(0,n.S)(L[U],l,L[U],c);f={type:"polygon",rings:[L],spatialReference:c,cache:{}},f.rings[0][4]=f.rings[0][0],d.set(s,f)}switch(_(e,r,f)){case M.DISCARD:return!1;case M.KEEP:return!0}const{triangle:h,triangleTest:B,positions:Z}=u,z=h.rings[0][0],H=h.rings[0][1],$=h.rings[0][2],q=i.getObjectTransform(o);i.getComponentPositions(o,s,Z);const{indices:se,data:G,stride:ne,startIndex:De,endIndex:fe}=Z;for(let J=De;J<fe;J+=3){const L=ne*se[J],U=ne*se[J+1],oe=ne*se[J+2];switch((0,y.s)(z,G[L],G[L+1],G[L+2]),(0,y.s)(H,G[U],G[U+1],G[U+2]),(0,y.s)($,G[oe],G[oe+1],G[oe+2]),(0,y.t)(z,z,q.rotationScale),(0,y.t)(H,H,q.rotationScale),(0,y.t)($,$,q.rotationScale),(0,y.g)(z,z,q.position),(0,y.g)(H,H,q.position),(0,y.g)($,$,q.position),(0,n.S)(z,l,z,c),(0,n.S)(H,l,H,c),(0,n.S)($,l,$,c),B(e,r,h)){case M.DISCARD:return!1;case M.KEEP:return!0}}return"intersects"!==u.type}const Q=(0,I.Ue)()},94443:(te,V,t)=>{t.d(V,{u:()=>C});var E=t(15861),A=t(17626),x=t(83761),j=t(26584),Y=t(62208),K=t(77712),a=(t(8314),t(63290),t(4619),t(76898)),O=t(2004),D=t(5437),y=t(73771),W=t(60466),S=t(17253),R=t(96854);const w=y.q;let C=class extends x.Z{get spatialReference(){return this.layerView.view.spatialReference}get layer(){return this.layerView.i3slayer}get defaultQueryJSON(){return new R.Z({outSpatialReference:this.spatialReference}).toJSON()}get _dataQueryEngine(){return this._ensureDataQueryEngine()}constructor(n){super(n)}initialize(){this.addHandles(this.layerView.on("visible-geometry-changed",()=>this.spatialIndex.events.emit("changed")))}destroy(){this._dataQueryEngineInstance=(0,Y.SC)(this._dataQueryEngineInstance),this._set("layerView",null)}executeQueryForCount(n,I){var g=this;return(0,E.Z)(function*(){return g._dataQueryEngine.executeQueryForCount(g._ensureQueryJSON(n),I)})()}executeQueryForExtent(n,I){var g=this;return(0,E.Z)(function*(){const{count:m,extent:b}=yield g._dataQueryEngine.executeQueryForExtent(g._ensureQueryJSON(n),I);return{count:m,extent:O.Z.fromJSON(b)}})()}executeQueryForIds(n,I){var g=this;return(0,E.Z)(function*(){return g._dataQueryEngine.executeQueryForIds(g._ensureQueryJSON(n),I)})()}executeQuery(n,I){var g=this;return(0,E.Z)(function*(){const m=g._ensureQueryJSON(n);if(m.returnGeometry)throw new j.Z("unsupported-query","returnGeometry is not yet supported for mesh scene layer queries");if(m.returnCentroid)throw new j.Z("unsupported-query","returnCentroid is not yet supported for mesh scene layer queries");const b=yield g._dataQueryEngine.executeQuery(m,I),F=S.Z.fromJSON(b);return F.features.forEach(N=>N.geometry=null),F})()}_ensureQueryJSON(n){return null==n?this.defaultQueryJSON:n.toJSON()}_ensureDataQueryEngine(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const n=this.layer.objectIdField||D.d,g=this.layer.fieldsIndex?.toJSON()||new W.Z([]),m=this.layerView.view.resourceController.scheduler,b=this.spatialReference.toJSON();return this._dataQueryEngineInstance=new w({hasZ:!0,hasM:!1,geometryType:"esriGeometryPolygon",fieldsIndex:g,timeInfo:null,spatialReference:b,objectIdField:n,featureStore:this.spatialIndex,scheduler:m,priority:this.priority}),this._dataQueryEngineInstance}};(0,A._)([(0,K.Cb)({constructOnly:!0})],C.prototype,"layerView",void 0),(0,A._)([(0,K.Cb)({constructOnly:!0})],C.prototype,"priority",void 0),(0,A._)([(0,K.Cb)({constructOnly:!0})],C.prototype,"spatialIndex",void 0),(0,A._)([(0,K.Cb)()],C.prototype,"spatialReference",null),(0,A._)([(0,K.Cb)()],C.prototype,"layer",null),(0,A._)([(0,K.Cb)()],C.prototype,"defaultQueryJSON",null),C=(0,A._)([(0,a.j)("esri.views.3d.layers.i3s.I3SQueryEngine")],C)},72537:(te,V,t)=>{t.d(V,{u:()=>Y});var E=t(5548),A=t(77044),x=t(88071),j=t(42964);class Y{constructor(p){this._objectIdField=p.objectIdField,this._getFeatureExtent=p.getFeatureExtent}getObjectId(p){return p.id}getAttributes(p){const{meta:P,index:a}=p,O={};this._objectIdField&&(O[this._objectIdField]=p.id);const D=P.attributeInfo?.attributeData;if(null!=D)for(const y of Object.keys(D))O[y]=(0,j.Jx)(D[y],a);return O}getAttribute(p,P){if(P===this._objectIdField)return p.id;const{meta:a,index:O}=p,D=a.attributeInfo?.attributeData;return null!=D?(0,j.Jx)(D[P],O):null}getGeometry(p){if(p.geometry)return p.geometry;const[P,a,O,D,y]=this._getFeatureExtent(p,K);return new x.Z([5],[P,a,O,D,a,O,D,y,O,P,y,O,P,a,O])}getCentroid(p,P){if(p.geometry)return(0,A.Y)(new x.Z,p.geometry,P.hasZ,P.hasM);const[a,O,D,y,W,S]=this._getFeatureExtent(p,K);return new x.Z([0],[(a+y)/2,(O+W)/2,(D+S)/2])}cloneWithGeometry(p,P){const{id:a,index:O,meta:D}=p;return{id:a,index:O,meta:D,geometry:P}}}const K=(0,E.Ue)()},41941:(te,V,t)=>{t.d(V,{I:()=>S});var E=t(17626),A=t(83761),x=t(61885),j=t(77712),p=(t(8314),t(63290),t(4619),t(76898)),P=t(15869),a=t(5548),O=t(65401),D=t(97126),y=t(52836);const W=(0,a.Ue)();let S=class extends A.Z{constructor(n){super(n),this.events=new x.Z}forEach(n){this.forAllFeatures(I=>(n(I),y.Ku.CONTINUE))}forEachBounds(n,I){const g=this.getFeatureExtent;for(const m of n)I(g(m,W))}forEachInBounds(n,I){this.forAllFeatures(g=>{const m=this.getFeatureExtent(g,w);return(0,O.kK)(n,(0,a.y8)(m,C))&&I(g),y.Ku.CONTINUE},g=>{if((0,P.s)(g.node.serviceMbsInIndexSR,this.sourceSpatialReference,R,this.viewSpatialReference),R[0]>=n[0]&&R[2]<=n[2]&&R[1]>=n[1]&&R[3]<=n[3])return y.Ku.CONTINUE;const m=Math.max(n[0],Math.min(R[0],n[2])),b=Math.max(n[1],Math.min(R[1],n[3])),F=R[0]-m,N=R[1]-b;return F*F+N*N<=R[3]*R[3]?y.Ku.CONTINUE:y.Ku.SKIP})}};(0,E._)([(0,j.Cb)({constructOnly:!0})],S.prototype,"featureAdapter",void 0),(0,E._)([(0,j.Cb)({constructOnly:!0})],S.prototype,"forAllFeatures",void 0),(0,E._)([(0,j.Cb)({constructOnly:!0})],S.prototype,"getFeatureExtent",void 0),(0,E._)([(0,j.Cb)({constructOnly:!0})],S.prototype,"sourceSpatialReference",void 0),(0,E._)([(0,j.Cb)({constructOnly:!0})],S.prototype,"viewSpatialReference",void 0),S=(0,E._)([(0,p.j)("esri.views.3d.layers.i3s.I3SQueryFeatureStore")],S);const R=(0,D.f)(0,0,0,0),w=(0,a.Ue)(),C=(0,O.Ue)()}}]);