"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[9861],{39861:(Ve,ne,v)=>{v.r(ne),v.d(ne,{default:()=>da});var Pe,l,G=v(15861),S=v(17626),B=v(14517),W=v(46160),U=v(63290),m=v(62208),O=v(32917),P=v(77712),de=(v(90912),v(85931),v(76898)),Ne=v(1437),I=v(97662),se=v(72392),_e=v(16730),Ee=v(75775),j=v(21286),J=v(15572),ie=v(28347),ye=v(43703),x=v(84161),V=v(28093),et=v(78172),Z=v(26242),pe=v(38114),me=v(84786),Ce=v(64770),we=v(55915),Pt=v(37053),Et=v(66601);function Le(l,o,c){const h=function be(l,o,c,h){const p=(0,Et.m)(c),g=(0,_e.j5)(p);if((0,m.Wi)(g))return null;const f=o[2]-l[2];if(h===Pe.Vertical)return{verticalSigned:f,unit:g};if(!(0,we.SH)(l,c,pt,p)||!(0,we.SH)(o,c,Kt,p))return null;if(h===Pe.Direct)return{direct:(0,x.i)(Kt,pt),unit:g};if((0,x.s)(Yt,l[0],l[1],o[2]),!(0,we.SH)(Yt,c,Yt,p))return null;const _=(0,x.i)(Yt,Kt);return h===Pe.Horizontal?{horizontal:_,unit:g}:{direct:(0,x.i)(Kt,pt),horizontal:_,vertical:Math.abs(f),unit:g}}(l,o,c,Pe.Direct);return(0,m.pC)(h)?(0,J.yG)(h.direct,h.unit):null}(l=Pe||(Pe={}))[l.Direct=0]="Direct",l[l.Horizontal=1]="Horizontal",l[l.Vertical=2]="Vertical";const $=(0,V.c)(),le=(0,V.c)(),pt=(0,V.c)(),Kt=(0,V.c)(),Yt=(0,V.c)();function Xt(l){const{elevationAlignedStartPoint:o,elevationAlignedEndPoint:c,dimension:{offset:h,measureType:p,orientation:g}}=l;return{elevationAlignedStartPoint:o,elevationAlignedEndPoint:c,offset:h,measureType:p,orientation:g}}function $t({elevationAlignedStartPoint:l,elevationAlignedEndPoint:o,offset:c,measureType:h,orientation:p},g,f=null){if((0,m.Wi)(l)||(0,m.Wi)(o))return null;const _=Gn((0,m.pC)(f)?f.directSegment:new Ce.y,{elevationAlignedStartPoint:l,elevationAlignedEndPoint:o},g),y=(0,m.pC)(f)?f.primaryOffsetAxis:(0,V.c)();Qt(y,{measureType:h,elevationAlignedStartPoint:l,elevationAlignedEndPoint:o,directSegment:_,orientation:p,renderCoordsHelper:g});const C=(0,m.pC)(f)?f.dimensionSegment:new Ce.y;return mn({elevationAlignedStartPoint:l,elevationAlignedEndPoint:o})&&h===I.n.Vertical?((0,x.c)(C.startRenderSpace,_.startRenderSpace),(0,x.c)(C.endRenderSpace,_.endRenderSpace)):jn(C,{offsetAxis:y,offset:c,relativeToSegment:_,renderCoordsHelper:g}),{directSegment:_,dimensionSegment:C,primaryOffsetAxis:y,spatialReference:g.spatialReference}}function In(l,o,c,h){return o===It.Start?((0,x.c)(l.startRenderSpace,c.startRenderSpace),(0,x.c)(l.endRenderSpace,h.startRenderSpace)):((0,x.c)(l.startRenderSpace,c.endRenderSpace),(0,x.c)(l.endRenderSpace,h.endRenderSpace)),l}var It;function Hn(l,o,c,h){switch(o){case I.n.Direct:return Gn(l,c,h);case I.n.Horizontal:case I.n.Vertical:{const{elevationAlignedStartPoint:p,elevationAlignedEndPoint:g,dimension:f,geometry:_}=c;let y;f.measureType===I.n.Direct?(y=function Hi(l,o){const c=l.directSegment.eval(.5,Z.WM.get()),h=o.worldUpAtPosition(c,Z.WM.get()),p=l.dimensionSegment.eval(.5,Z.WM.get()),g=(0,x.w)(Z.WM.get(),p,c);return!(0,x.F)(g,V.Z)&&(0,x.e)(g,h)>0}(_,h)===p.z>g.z,o===I.n.Horizontal&&(y=!y)):y=!function Gi(l){const{startRenderSpace:o,endRenderSpace:c}=l.dimensionSegment,{startRenderSpace:h,endRenderSpace:p}=l.directSegment;return(0,x.E)(h,o)<(0,x.E)(p,c)}(_);const[C,M]=y?[p,g]:[g,p],T=(0,me.WG)(M,ji);return o===I.n.Horizontal?T.z=C.z:(T.x=C.x,T.y=C.y),h.toRenderCoords(C,l.startRenderSpace),h.toRenderCoords(T,l.endRenderSpace),l}}}function Gn(l,o,c){return c.toRenderCoords(o.elevationAlignedStartPoint,l.startRenderSpace),c.toRenderCoords(o.elevationAlignedEndPoint,l.endRenderSpace),l}!function(l){l[l.Start=0]="Start",l[l.End=1]="End"}(It||(It={}));const ji=(0,pe.Tx)(0,0,0,null),Ui=new Ce.y;function Qt(l,o){const{measureType:c,elevationAlignedStartPoint:h,elevationAlignedEndPoint:p,directSegment:{startRenderSpace:g,endRenderSpace:f},directSegment:_,renderCoordsHelper:y}=o,C=_.eval(.5,Z.WM.get()),M=y.worldUpAtPosition(C,Z.WM.get()),T=y.worldBasisAtPosition(C,et.R.Y,Z.WM.get());switch(c){case I.n.Horizontal:(0,x.c)(l,M);break;case I.n.Vertical:(0,x.e)(g,M)<(0,x.e)(f,M)?(0,x.w)(l,f,g):(0,x.w)(l,g,f),(0,x.f)(l,l,M),(0,x.f)(l,l,M);break;case I.n.Direct:{const b=(0,m.Pt)(o.orientation,0);if(mn({elevationAlignedStartPoint:h,elevationAlignedEndPoint:p}))(0,ie.d)(Jt,-(0,j.Vl)(b),M),(0,x.m)(l,T,Jt);else{const k=(0,x.w)(Z.WM.get(),f,g),oe=(0,x.f)(Z.WM.get(),k,M);(0,x.f)(oe,oe,k),(0,ie.d)(Jt,(0,j.Vl)(b),k),(0,x.m)(l,oe,Jt)}break}}return(0,x.F)(l,V.Z)?(0,x.c)(l,T):(0,x.n)(l,l)}const Jt=(0,ye.c)();function mn({elevationAlignedStartPoint:l,elevationAlignedEndPoint:o}){return(0,m.pC)(l)&&(0,m.pC)(o)&&l.x===o.x&&l.y===o.y}function jn(l,o){const{offsetAxis:c,offset:h,relativeToSegment:{startRenderSpace:p,endRenderSpace:g},relativeToSegment:f,renderCoordsHelper:_}=o,y=h/_.unitInMeters,[C,M]=function Ni(l,o,c,h=0){const p=(0,x.e)(o,c),g=(0,x.e)(l,c),f=Math.abs(p-g)+h;return p>g?[f,h]:[h,f]}(p,g,c,y);return(0,x.z)(l.startRenderSpace,f.startRenderSpace,c,C),(0,x.z)(l.endRenderSpace,f.endRenderSpace,c,M),l}function qt(l,o,c){const h=o.directSegment.eval(.5,Z.WM.get());return c.worldUpAtPosition(h,l)}function vn(l,o){const{startRenderSpace:c,endRenderSpace:h}=o.directSegment;return(0,x.w)(l,h,c)}function yn(l,o,c={invert:!1}){const{startRenderSpace:h,endRenderSpace:p}=o.dimensionSegment;return c.invert?(0,x.w)(l,h,p):(0,x.w)(l,p,h)}function _n(l,o){const c=l.directSegment.eval(.5,Z.WM.get());return o.headingAtPosition(c,l.primaryOffsetAxis)}const Bi=(0,V.c)();function Fn(l){const{elevationAlignedStartPoint:o,elevationAlignedEndPoint:c}=l;if((0,m.Wi)(o)||(0,m.Wi)(c))return!1;const h=function H(l,o){const{spatialReference:c}=l;return(0,Pt.fS)(c,o.spatialReference)?($[0]=l.x,$[1]=l.y,$[2]=l.hasZ?l.z:0,le[0]=o.x,le[1]=o.y,le[2]=o.hasZ?o.z:0,Le($,le,c)):null}(o,c);return(0,m.pC)(h)&&(0,J.nn)(h,"meters").value>Un}const Un=1e5;function Ht(l){return(0,m.pC)(l.geometry)}let ut=class extends B.Z{constructor(l){super(l),this._handles=new se.Z}initialize(){const{computations:l}=this.analysisViewData;for(const o of l)this._addComputation(o);this.addHandles(l.on("change",({added:o,removed:c})=>{for(const h of c)this._removeComputation(h);for(const h of o)this._addComputation(h)}))}destroy(){this._handles=(0,m.SC)(this._handles)}get analysis(){return this.analysisViewData.analysis}get _defaultUnit(){return(0,Ee.R)(this.view)}_addComputation(l){this._handles.has(l)||this._handles.add((0,O.YP)(()=>Xt(l),o=>{const{measureType:c}=o;if(Fn(o)&&c!==I.n.Direct){const p=Math.round((0,_e.En)(Un,"meters","kilometers"));return U.Z.getLogger(this.declaredClass).warnOnce(`A ${c} dimension in the analysis (id: '${this.analysis.id}') will not display, because only direct dimensions can measure lengths greater than ${p} km. Update the measureType of the affected dimension to "direct" to display it.`),void(l.geometry=null)}const h=$t(o,this.view.renderCoordsHelper,l.geometry);l.geometry=h,l.result.length=function Wi(l,o,c){if((0,m.Wi)(l))return null;const g=Le(l.dimensionSegment.startRenderSpace,l.dimensionSegment.endRenderSpace,l.spatialReference);if((0,m.Wi)(g))return null;const f=o===I.n.Vertical?(0,_e.ov)(g.value,g.unit,c):(0,_e.iS)(g.value,g.unit,c);return(0,J.nn)(g,f)}(h,c,this._defaultUnit)},O.tX),l)}_removeComputation(l){this._handles.remove(l)}};(0,S._)([(0,P.Cb)({constructOnly:!0})],ut.prototype,"analysisViewData",void 0),(0,S._)([(0,P.Cb)({constructOnly:!0})],ut.prototype,"view",void 0),(0,S._)([(0,P.Cb)()],ut.prototype,"analysis",null),(0,S._)([(0,P.Cb)()],ut.prototype,"_defaultUnit",null),ut=(0,S._)([(0,de.j)("esri.views.3d.analysis.Dimension.support.DimensionController")],ut);var ki=v(84244),Ke=v(54024),ce=v(91558),Sn=(v(29132),v(23719)),We=v(23841),tt=v(90014);const Nn={main:new ce.Z([255,127,0])};class Ki{constructor(){this.color=Nn.main,this.opacity=.5,this.radius=5}}class Yi{constructor(){this.color=new ce.Z([127,127,127]),this.opacity=.5,this.radius=5}}class Xi{constructor(){this.lineSizeFraction=.8}}class $i{constructor(){this.color=Nn.main,this.opacity=.5,this.linePaddingPx=4,this.focusedLinePaddingPx=6,this.lengthFraction=.5,this.minLengthMeters=.1}}class Qi{constructor(){this.calloutOffsetPx=18,this.calloutOpacity=.5,this.calloutWidth=2,this.discScale=.3,this.focusMultiplier=2}}class Ji{constructor(){this.lineSizeFraction=.25}}class qi{constructor(){this.marginPx=20,this.minScreenLengthFontSizeFactor=5}}class es{constructor(){this.color=new ce.Z([255,127,0,.5])}}const fe=new class ts{constructor(){this.pointManipulators=new Ki,this.offsetManipulator=new $i,this.orientationManipulator=new Qi,this.markers=new Xi,this.labels=new qi,this.offsetLine=new Ji,this.constraint=new es,this.constraintThresholdPx=10,this.initialOffsetPx=50,this.orientationSnapThresholdDegrees=5,this.disabledPointIndicator=new Yi,this.smallScreenLengthLineSizeFactor=2,this.pointerMoveTimeoutMs=2500}};var Zn=v(45403),nt=v(19142),Gt=v(40345),Mt=v(8859),Bn=v(81805),gt=v(57521),Je=v(30260),Dt=v(33786),xt=v(72642);class ns{constructor(o){this.start=o.start,this.end=o.end,this.offset=o.offset,this.heading=o.heading,this.rotation=o.rotation,this.direct=o.direct,this.horizontal=o.horizontal,this.vertical=o.vertical}manipulatorName(o){return Object.keys(this).find(c=>this.hasOwnProperty(c)&&o===this[c])}values(){return[this.start,this.end,this.offset,this.heading,this.rotation,this.direct,this.horizontal,this.vertical]}forEachMeasureTypeManipulator(o){for(const c of I.V)o(this.manipulatorForMeasureType(c),c)}manipulatorForMeasureType(o){switch(o){case I.n.Direct:return this.direct;case I.n.Horizontal:return this.horizontal;case I.n.Vertical:return this.vertical}}}function kn(l,{lineSizePt:o,material:c}){const{calloutOffsetPx:h,calloutOpacity:p,calloutWidth:g,discScale:f,focusMultiplier:_}=fe.orientationManipulator;return{calloutLength:.25*Bn._Z*fe.markers.lineSizeFraction*(0,We.F2)(o)+h,calloutOpacity:p,calloutWidth:g,customStateMask:it,discScale:f,focusMultiplier:_,material:c,metadata:l}}function Kn(l,o){return(0,nt.Ju)(l,kn(o.metadata,o))}function Yn(l,o){(0,nt.Bz)(l,kn(l.metadata,o))}function Xn(l){const{cancel:o,computation:c,settingHeading:h,steps:p,view:g}=l;if(!Ht(c))return;const{renderCoordsHelper:f}=g,{dimension:_,geometry:y}=c,C=(0,V.c)(),M=qn((0,V.c)(),y,y.directSegment,f),T=ei(Z.WM.get(),{forHeading:h,geometry:y,renderCoordsHelper:f}),b=(0,tt.Yq)(M,T,(0,tt.Ue)()),k=(0,m.Pt)(_.orientation,h?()=>_n(y,g.renderCoordsHelper):0);p.next((0,Mt._N)(g,b)).next(oe=>{"start"===oe.action&&(0,x.c)(C,oe.renderStart);const he=(0,tt.mJ)(b),te=(0,nt.Gd)(C,oe.renderEnd,M,he);let Re=k-(0,j.BV)(te);h||(Re=function hs(l){const o=Sn.BV.normalize(l)%90;return o<fe.orientationSnapThresholdDegrees?l-o:90-o<fe.orientationSnapThresholdDegrees?l+(90-o):l}(Re)),_.orientation=Re}),o.next((0,Je.di)(_,["orientation"]))}function $n(l,o,c,h){const p=(0,x.b)(Z.WM.get(),c.endRenderSpace,c.startRenderSpace);(0,x.f)(p,p,h);const g=(0,tt.Yq)(c.startRenderSpace,p,(0,tt.Ue)()),f=(0,tt.Yq)(c.startRenderSpace,h,(0,tt.Ue)()),_=o.offset;let y,C=0;const M=new Je.hM;return M.next((0,Mt._N)(l,g)).next(T=>{"start"===T.action&&(C=(0,tt.jH)(f,T.renderStart));const b=((0,tt.jH)(f,T.renderEnd)-C)*l.renderCoordsHelper.unitInMeters;o.offset=_+b,y=T}),T=>(M.execute(T),y)}function Qn(l,o){const{directSegment:c}=l,{renderCoordsHelper:h}=o,p=qt(Z.WM.get(),l,h),g=vn(Z.WM.get(),l),f=(0,x.f)(Z.WM.get(),g,p),{viewForward:_}=o.state.camera;(0,x.e)(f,_)>0&&(0,x.g)(f,f,-1);const y=c.eval(.5,Z.WM.get());return h.headingAtPosition(y,f)}function Jn(l,o,c,{forHeading:h}){const{dimension:p,geometry:g}=o,{primaryOffsetAxis:f}=g,_=(0,x.g)(ms,f,p.offset>=0?1:-1),y=ei(vs,{forHeading:h,geometry:g,renderCoordsHelper:c});(0,x.f)(y,y,_);const C=(0,nt.Aq)(_,y,V.Z,en);l.modelTransform=C,l.renderLocation=qn(jt,g,g.dimensionSegment,c)}const ms=(0,V.c)(),vs=(0,V.c)();function qn(l,o,c,h){const{startRenderSpace:p,endRenderSpace:g}=c,f=function _s(l,o){const c=vn(Ss,l),h=qt(Cs,l,o);return(0,x.e)(c,h)>0}(o,h)?p:g;return(0,x.c)(l,f)}function ei(l,{forHeading:o,geometry:c,renderCoordsHelper:h}){return o?qt(l,c,h):yn(l,c,{invert:!0})}const Ss=(0,V.c)(),Cs=(0,V.c)();function Cn(l){return(0,We.F2)(l)+fe.offsetManipulator.focusedLinePaddingPx}const it=Dt.jg.Custom1,jt=(0,V.c)(),Pn=(0,V.c)(),en=(0,ye.c)(),ti=new Ce.y;var Ze,Es=v(69186),En=v(80542),Mn=v(58817),lt=v(10699);function ni(l,o,c){const{constraint:h,elevationAlignedStartPoint:p,elevationAlignedEndPoint:g,unconstrainedGeometry:f,view:_}=c,{dimension:y,previousConstraint:C,preConstraintProperties:M}=l;if((0,m.Wi)(p)||(0,m.Wi)(g))return;const T=()=>{"startPoint"in o?y.startPoint=o.startPoint:"endPoint"in o&&(y.endPoint=o.endPoint)};if((0,m.Wi)(h))T(),(0,m.pC)(C)&&(0,m.pC)(M)&&(y.measureType=M.measureType,y.orientation=M.orientation);else switch(y.measureType=I.n.Direct,h){case Ze.Horizontal:if(h!==C&&(y.orientation=0),"startPoint"in o){const b=o.startPoint;(0,m.pC)(b)&&(b.z=g.z),y.startPoint=b}else if("endPoint"in o){const b=o.endPoint;(0,m.pC)(b)&&(b.z=p.z),y.endPoint=b}break;case Ze.Vertical:if(h!==C&&(y.orientation=Qn(f,_)),"startPoint"in o){const b=o.startPoint;(0,m.pC)(b)&&(b.x=g.x,b.y=g.y),y.startPoint=b}else if("endPoint"in o){const b=o.endPoint;(0,m.pC)(b)&&(b.x=p.x,b.y=p.y),y.endPoint=b}break;case Ze.Direct:h!==C&&(0,m.pC)(M)&&(y.orientation=M.orientation),T()}l.previousConstraint=h,l.unconstrainedGeometry=f}v(8314),function(l){l[l.Horizontal=0]="Horizontal",l[l.Vertical=1]="Vertical",l[l.Direct=2]="Direct"}(Ze||(Ze={}));var Rs=v(25601),Se=v(60507),Ye=v(993),wt=v(67709),tn=v(85072),Ts=v(8834),st=v(13777),nn=v(70562),ii=v(82755),bs=v(23018),Dn=v(64835),ee=v(40723),si=v(64232),sn=v(16396),rt=v(92222);class Ls extends ii.i{constructor(o){super(o),this._ray=(0,nn.Ue)(),this._isWorldDown=!1,this._start=(0,V.c)(),this._end=(0,V.f)(1,0,0),this._width=1,this._color=(0,wt.f)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,wt.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=Ge.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=ee.yD.OccludeAndTransparent,this._fadedExtensions=oi,this._laserline=new bs.W({view:this.view}),this.applyProps(o)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(o){return{view:o,createResources:c=>this._createObject3DResources(c),destroyResources:c=>this._destroyExternalResources(c),recreateGeometry:(c,h)=>this._recreateObject3DGeometry(c,h),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(o){return{view:o,createResources:()=>this._createDrapedResources(),destroyResources:c=>this._destroyExternalResources(c),recreateGeometry:c=>this._recreateDrapedGeometry(c)}}updateVisibility(o){super.updateVisibility(o),this._laserline.visible=o}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(o){this._isWorldDown=!0,(0,x.c)(this._start,o),this.view.renderCoordsHelper.worldUpAtPosition(o,this._end),(0,x.b)(this._end,o,this._end),(0,nn.zk)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(o){this._isWorldDown=!1,(0,x.k)(this._start,o)||((0,x.c)(this._start,o),(0,nn.zk)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(o){this._isWorldDown=!1,(0,x.k)(this._end,o)||((0,x.c)(this._end,o),(0,nn.zk)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(o){o!==this._width&&(this._width=o,this._updateMaterial())}get color(){return this._color}set color(o){(0,Ye.g)(o,this._color)||((0,Ye.c)(this._color,o),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(o){o!==this._polygonOffset&&(this._polygonOffset=o,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(o){this._writeDepthEnabled!==o&&(this._writeDepthEnabled=o,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(o){o!==this._innerWidth&&(this._innerWidth=o,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(o){(0,Ye.g)(o,this._innerColor)||((0,Ye.c)(this._innerColor,o),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(o){const c=(0,m.pC)(o)!==(0,m.pC)(this._stipplePattern);this._stipplePattern=o,c?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(o){((0,m.Wi)(o)||(0,m.Wi)(this._stippleOffColor)||!(0,Ye.g)(o,this._stippleOffColor))&&(this._stippleOffColor=(0,m.pC)(o)?(0,wt.c)(o):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(o){o!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=o,this._updateMaterial())}get falloff(){return this._falloff}set falloff(o){o!==this._falloff&&(this._falloff=o,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(o){o!==this._extensionType&&(this._extensionType=o,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&(0,m.pC)(this._laserlineStyle)&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(o){this._laserlineStyle=o,this._laserline.attached=this._laserlineAttached,(0,m.pC)(o)&&(this._laserline.style=o)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(o){this._laserlineEnabled!==o&&(this._laserlineEnabled=o,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(o){o!==this._renderOccluded&&(this._renderOccluded=o,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===ee.yD.OccludeAndTransparentStencil?ee.yD.OccludeAndTransparent:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(o){this._fadedExtensions=(0,m.Pt)(o,oi),this.recreateGeometry()}_updateMaterial(){const{materialParameters:o}=this;(0,m.WG)(this.object3dResources.resources)?.material.setParameters(o),(0,m.WG)(this.drapedResources.resources)?.material.setParameters(o)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,writeDepth:this._writeDepthEnabled}}_createObject3DResources(o){const c=new rt.U(this.materialParameters),h=new Array;return this._createObject3DGeometry(c,o,h),{material:c,geometries:h,forEach:p=>{p(c),h.forEach(p)}}}_destroyExternalResources(o){o.geometries=[],o.material.dispose()}_recreateObject3DGeometry(o,c){o.geometries.length=0,this._createObject3DGeometry(o.material,c,o.geometries)}_createObject3DGeometry(o,c,h){const p=this._createGeometry(o);h.push(p),c.addGeometry(p),this._updateVerticesObject3D(c)}_createDrapedResources(){const o=new rt.U(this.materialParameters);return{material:o,geometries:[this._createDrapedGeometry(o)]}}_recreateDrapedGeometry(o){o.geometries=[this._createDrapedGeometry(o.material)]}_createDrapedGeometry(o){const c=this._createGeometry(o);this._updateVerticesDraped(c);const h=new si.z(c,{boundingInfo:c.boundingInfo});return h.computeBoundingSphere(h.transformation,h.boundingSphere),h}_createGeometry(o){const c=this.extensionType===Ge.FADED,h=c?[(0,V.c)(),(0,V.c)(),(0,V.c)(),(0,V.c)()]:[(0,V.c)(),(0,V.c)()];return(0,gt.rh)(o,h,null,c?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const o=(0,m.WG)(this.object3dResources.object);o&&this._updateVerticesObject3D(o)}}_updateVerticesObject3D(o){const c=this._lineSegment;this._updateVertexAttributesObject3D(o,c),this._laserline.intersectsLine=c}_updateVerticesDraped(o){this._updateVertexAttributesDraped(o,this._lineSegment)}get _lineSegment(){return this._extensionType===Ge.FADED?this._updateLineSegmentFinite(ri):this._updateLineSegmentInfinite(this._extensionType,ri)}_updateLineSegmentFinite(o){return(0,st.zk)(this._start,this._end,o)}_updateLineSegmentInfinite(o,c){const h=this.view.state.camera;switch((0,tn.iL)(this._ray,dt),o){case Ge.LINE:dt.c0=-Number.MAX_VALUE;break;case Ge.RAY:case Ge.GROUND_RAY:{const f=this._ray.origin,_=(0,m.Pt)(this.view.elevationProvider.getElevation(f[0],f[1],f[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),y=this.view.renderCoordsHelper.getAltitude(f);this._isWorldDown&&y<_&&(0,x.o)(dt.ray.direction,dt.ray.direction),this._extensionType===Ge.GROUND_RAY&&null!=_&&(dt.c1=Math.abs(y-_));break}}if(!(0,Ts.zq)(h.frustum,dt))return this._updateLineSegmentFinite(c);const p=(0,tn.Ws)(dt,ft),g=(0,tn.S$)(dt,As);return(0,st.zk)(p,g,c)}_updateVertexAttributesObject3D(o,c){const h=o.geometries[0].getMutableAttribute(sn.T.POSITION)?.data;if(!h)return;let p=0;for(const g of this._lineVertices(c))h[p++]=g[0],h[p++]=g[1],h[p++]=g[2];o.geometryVertexAttrsUpdated(o.geometries[0])}_updateVertexAttributesDraped(o,c){const h=o.getMutableAttribute(sn.T.POSITION)?.data;if(!h)return;let p=0;for(const g of this._lineVertices(c))h[p++]=g[0],h[p++]=g[1],h[p++]=Dn.Rn;o.invalidateBoundingInfo()}*_lineVertices(o){this.extensionType===Ge.FADED?(yield(0,st.KU)(o,-this.fadedExtensions.start,ft),yield(0,st.KU)(o,0,ft),yield(0,st.KU)(o,1,ft),yield(0,st.KU)(o,1+this.fadedExtensions.end,ft)):(yield(0,st.KU)(o,0,ft),yield(0,st.KU)(o,1,ft))}}const dt=(0,tn.Ue)(),ft=(0,V.c)(),As=(0,V.c)(),ri=(0,st.Ue)();var Ge;!function(l){l[l.LINE=0]="LINE",l[l.RAY=1]="RAY",l[l.GROUND_RAY=2]="GROUND_RAY",l[l.FADED=3]="FADED"}(Ge||(Ge={}));const ai=1/3,oi={start:ai,end:ai};var ve=v(67831),Ot=v(99770);class zs extends ii.i{constructor(o){super(o),this._location=(0,V.c)(),this._direction=(0,V.f)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,wt.f)(1,0,1,1),this._renderOccluded=ee.yD.OccludeAndTransparent,this.applyProps(o)}createObject3DResourceFactory(o){return{view:o,createResources:c=>this._createObject3DResources(c),destroyResources:c=>this._destroyObject3DResources(c),recreateGeometry:(c,h)=>this._recreateObject3DGeometry(c,h),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(o){return{view:o,createResources:()=>this._createDrapedResources(),destroyResources:c=>this._destroyDrapedResources(c),recreateGeometry:c=>this._recreateDrapedGeometry(c)}}get location(){return this._location}set location(o){(0,x.k)(this._location,o)||((0,x.c)(this._location,o),this._updateGeometry())}get direction(){return this._direction}set direction(o){(0,x.k)(this._direction,o)||((0,x.c)(this._direction,o),this._updateGeometry())}setDirectionFromPoints(o,c){(0,x.n)(this._direction,(0,x.b)(this._direction,c,o)),this._updateGeometry()}get width(){return this._width}set width(o){o!==this._width&&(this._width=o,this._updateMaterial())}get offset(){return this._offset}set offset(o){o!==this._offset&&(this._offset=o,this._updateGeometry())}get length(){return this._length}set length(o){o!==this._length&&(this._length=o,this._updateGeometry())}get color(){return this._color}set color(o){(0,Ye.g)(o,this._color)||((0,Ye.c)(this._color,o),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(o){o!==this._renderOccluded&&(this._renderOccluded=o,this._updateMaterial())}_createObject3DResources(o){const c=new rt.U(this.materialParameters),h=new Array;return this._createObject3DGeometry(c,o,h),{material:c,geometries:h,forEach:p=>{p(c),h.forEach(p)}}}_destroyObject3DResources(o){o.geometries.length=0,o.material.dispose()}_recreateObject3DGeometry(o,c){o.geometries.length=0,this._createObject3DGeometry(o.material,c,o.geometries)}_createObject3DGeometry(o,c,h){const[p,g]=this._createGeometries(o);c.addGeometry(p),c.addGeometry(g),h.push(p),h.push(g),this._updateVerticesObject3D(c)}_createDrapedResources(){const o=new rt.U(this.materialParameters),c=(0,O.YP)(()=>this.view.state.contentPixelRatio,()=>{this.drapedResources.recreateGeometry()});return{material:o,geometries:this._createDrapedGeometry(o),pixelRatioHandle:c}}_destroyDrapedResources(o){o.pixelRatioHandle.remove(),o.geometries=[],o.material.dispose()}_recreateDrapedGeometry(o){o.geometries=this._createDrapedGeometry(o.material)}_createDrapedGeometry(o){const c=this._createGeometries(o);this._updateVerticesDraped(c);const h=c.map(p=>new si.z(p,{boundingInfo:p.boundingInfo}));for(const p of h)p.computeBoundingSphere(p.transformation,p.boundingSphere);return h}_createGeometries(o){return[(0,gt.rh)(o,[(0,V.c)(),(0,V.c)()]),(0,gt.rh)(o,[(0,V.c)(),(0,V.c)()])]}_updateMaterial(){const{materialParameters:o}=this;(0,m.WG)(this.object3dResources.resources)?.material.setParameters(o),(0,m.WG)(this.drapedResources.resources)?.material.setParameters(o)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const o=(0,m.WG)(this.object3dResources.object);o&&this._updateVerticesObject3D(o)}}_updateVerticesObject3D(o){const c=this.view.state.camera;c.projectToScreen(this.location,an),(0,x.a)(qe,this.location,this.direction),c.projectToScreen(qe,Rt),(0,ve.f)(Rt,(0,ve.a)(Rt,Rt,an)),this._updateVertexAttributesObject3D(c,o,0,an,Rt,1),this._updateVertexAttributesObject3D(c,o,1,an,Rt,-1)}_updateVertexAttributesObject3D(o,c,h,p,g,f){const _=c.geometries[h],y=_.getMutableAttribute(sn.T.POSITION)?.data;if(!y)return;const{start:C,end:M}=this._computeStartEnd(g,p,f,this.offset,this.width,this.length);o.unprojectFromScreen((0,We.c$)(C),qe),y[0]=qe[0],y[1]=qe[1],y[2]=qe[2],o.unprojectFromScreen((0,We.c$)(M),qe),y[3]=qe[0],y[4]=qe[1],y[5]=qe[2],c.geometryVertexAttrsUpdated(_)}_updateVerticesDraped(o){const{view:{basemapTerrain:{overlayManager:c},state:{contentPixelRatio:h}}}=this,{location:p,width:g,length:f,offset:_}=this,y=Vs;y.spatialReference=(0,m.Wg)(c.renderer.spatialReference),y.x=p[0],y.y=p[1];const C=c.overlayPixelSizeInMapUnits(y)*h,M=g*C,T=f*C,b=_*C;this._updateVertexAttributesDraped(o[0],M,T,b,-1),this._updateVertexAttributesDraped(o[1],M,T,b,1)}_updateVertexAttributesDraped(o,c,h,p,g){const f=o.getMutableAttribute(sn.T.POSITION)?.data;if(!f)return;const{location:_,direction:y}=this,{start:C,end:M}=this._computeStartEnd(y,_,g,p,c,h);f[0]=C[0],f[1]=C[1],f[2]=Dn.Rn,f[3]=M[0],f[4]=M[1],f[5]=Dn.Rn,o.invalidateBoundingInfo()}_computeStartEnd(o,c,h,p,g,f){const _=(0,ve.b)(li,(0,ve.s)(li,o[1]*h,o[0]*-h),p+g/2),y=(0,ve.j)(rn,(0,ve.j)(rn,(0,ve.j)(rn,c,(0,ve.b)(rn,o,f/2)),_),_);return{start:y,end:(0,ve.j)(di,y,(0,ve.b)(di,o,-f))}}}const qe=(0,V.c)(),li=(0,Ot.a)(),rn=(0,Ot.a)(),di=(0,Ot.a)(),an=(0,We.s1)(),Rt=(0,We.s1)(),Vs=(0,pe.Tx)(0,0,void 0,null);var ci=v(30693),Ws=v(77603),xn=v(62600),hi=v(86810);let Xe=class extends hi.wq{constructor(){super(...arguments),this.enabled=!0}};(0,S._)([(0,P.Cb)({type:Boolean})],Xe.prototype,"enabled",void 0),Xe=(0,S._)([(0,de.j)("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],Xe);let ue=class extends hi.wq{constructor(l){super(l),this.lineSnapper=new Xe,this.parallelLineSnapper=new Xe,this.rightAngleSnapper=new Xe,this.rightAngleTriangleSnapper=new Xe,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThreshold=.1,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new ce.Z([255,127,0]),this.orangeTransparent=new ce.Z([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};(0,S._)([(0,P.Cb)({type:Xe,constructOnly:!0,nonNullable:!0,json:{write:!0}})],ue.prototype,"lineSnapper",void 0),(0,S._)([(0,P.Cb)({type:Xe,constructOnly:!0,nonNullable:!0,json:{write:!0}})],ue.prototype,"parallelLineSnapper",void 0),(0,S._)([(0,P.Cb)({type:Xe,constructOnly:!0,nonNullable:!0,json:{write:!0}})],ue.prototype,"rightAngleSnapper",void 0),(0,S._)([(0,P.Cb)({type:Xe,constructOnly:!0,nonNullable:!0,json:{write:!0}})],ue.prototype,"rightAngleTriangleSnapper",void 0),(0,S._)([(0,P.Cb)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],ue.prototype,"shortLineThreshold",void 0),(0,S._)([(0,P.Cb)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],ue.prototype,"distance",void 0),(0,S._)([(0,P.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],ue.prototype,"pointThreshold",void 0),(0,S._)([(0,P.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],ue.prototype,"intersectionParallelLineThreshold",void 0),(0,S._)([(0,P.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],ue.prototype,"parallelLineThreshold",void 0),(0,S._)([(0,P.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],ue.prototype,"verticalLineThreshold",void 0),(0,S._)([(0,P.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],ue.prototype,"touchSensitivityMultiplier",void 0),(0,S._)([(0,P.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],ue.prototype,"pointOnLineThreshold",void 0),(0,S._)([(0,P.Cb)({type:ce.Z,nonNullable:!0})],ue.prototype,"orange",void 0),(0,S._)([(0,P.Cb)({type:ce.Z,nonNullable:!0})],ue.prototype,"orangeTransparent",void 0),(0,S._)([(0,P.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],ue.prototype,"lineHintWidthReference",void 0),(0,S._)([(0,P.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],ue.prototype,"lineHintWidthTarget",void 0),(0,S._)([(0,P.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],ue.prototype,"lineHintFadedExtensions",void 0),(0,S._)([(0,P.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],ue.prototype,"parallelLineHintWidth",void 0),(0,S._)([(0,P.Cb)({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],ue.prototype,"parallelLineHintLength",void 0),(0,S._)([(0,P.Cb)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],ue.prototype,"parallelLineHintOffset",void 0),(0,S._)([(0,P.Cb)({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],ue.prototype,"rightAngleHintSize",void 0),(0,S._)([(0,P.Cb)({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],ue.prototype,"rightAngleHintOutlineSize",void 0),(0,S._)([(0,P.Cb)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],ue.prototype,"satisfiesConstraintScreenThreshold",void 0),ue=(0,S._)([(0,de.j)("esri.views.interactive.snapping.Settings.Defaults")],ue);const ae=new ue;var Ae=v(26352),K=v(59550),ge=v(44725),wn=v(5286);class on extends wn.r{constructor(o,c,h=Ae.B.ALL){super(c,h),this.intersectionPoint=o}equals(o){return o instanceof on&&(0,x.k)(this.intersectionPoint,o.intersectionPoint)}}var $e=v(62160);class ln extends wn.r{constructor(o,c,h,p=Ae.B.ALL){super(h,p),this.lineStart=o,this.lineEnd=c}equals(o){return o instanceof ln&&(0,x.k)(this.lineStart,o.lineStart)&&(0,x.k)(this.lineEnd,o.lineEnd)}}var Is=v(19038);class Ft extends wn.r{constructor(o,c,h,p,g=Ae.B.ALL){super(p,g),this.previousVertex=o,this.centerVertex=c,this.nextVertex=h}equals(o){return o instanceof Ft&&(0,x.k)(this.previousVertex,o.previousVertex)&&(0,x.k)(this.centerVertex,o.centerVertex)&&(0,x.k)(this.nextVertex,o.nextVertex)}}class Hs{draw(o,c){const h=this._getUniqueHints(o),p=this.sortUniqueHints(h),g=[];for(const f of p)f instanceof on&&g.push(this.visualizeIntersectionPoint(f,c)),f instanceof $e.w&&g.push(this.visualizeLine(f,c)),f instanceof ln&&g.push(this.visualizeParallelSign(f,c)),f instanceof Ft&&g.push(this.visualizeRightAngleQuad(f,c)),f instanceof Is.n&&g.push(this.visualizePoint(f,c));return(0,Ke.AL)(g)}sortUniqueHints(o){return o}_getUniqueHints(o){const c=[];for(const h of o){let p=!0;for(const g of c)if(h.equals(g)){p=!1;break}p&&c.push(h)}return c}}var Te=v(25858);class Gs extends Hs{sortUniqueHints(o){return o.sort((c,h)=>(h instanceof $e.w?h.length:0)-(c instanceof $e.w?c.length:0))}visualizeIntersectionPoint(o,c){const{spatialReference:h,view:p}=c;return(0,Ke.ed)(new ci.L({view:p,primitive:"circle",geometry:(0,K.SH)(o.intersectionPoint,h),elevationInfo:o.isDraped?Se.tR:Se.jG,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:ce.Z.toUnitRGBA(ae.orange),pixelSnappingEnabled:!1}))}visualizePoint(o,c){const{view:h,spatialReference:p}=c,g=this._alignPoint(o.point,o.domain,c);return(0,Ke.ed)(new ci.L({view:h,primitive:"circle",geometry:(0,K.SH)(g,p),elevationInfo:this._hintElevationInfo(o,c),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:ce.Z.toUnitRGBA(ae.orange),pixelSnappingEnabled:!1}))}visualizeLine(o,c){const{view:h,spatialReference:p}=c,g=this._alignPoint(o.lineStart,o.domain,c),f=this._alignPoint(o.lineEnd,o.domain,c);return(0,Ke.ed)(this._createLineSegmentHint(o.type,g,f,p,this._hintElevationInfo(o,c),h,o.isDraped,o.fadeLeft,o.fadeRight))}visualizeParallelSign(o,c){const{view:h,spatialReference:p}=c,{isDraped:g}=o,f=this._hintElevationInfo(o,c),_=this._alignPoint(o.lineStart,o.domain,c),y=this._alignPoint(o.lineEnd,o.domain,c),C=mt(_,p,f,h,g),M=mt(y,p,f,h,g),T=(0,x.h)(M,C,M,.5),b=new zs({view:h,attached:!1,offset:ae.parallelLineHintOffset,length:ae.parallelLineHintLength,width:ae.parallelLineHintWidth,color:ce.Z.toUnitRGBA(ae.orange),location:T,renderOccluded:g?ee.yD.OccludeAndTransparent:ee.yD.Opaque,isDraped:g,renderGroup:xn.eZ.SnappingHint});return b.setDirectionFromPoints(C,T),b.attached=!0,(0,Ke.ed)(b)}visualizeRightAngleQuad(o,c){const{view:h,spatialReference:p}=c,g=this._hintElevationInfo(o,c),{isDraped:f}=o,_=this._alignPoint(o.previousVertex,o.domain,c),y=this._alignPoint(o.centerVertex,o.domain,c),C=this._alignPoint(o.nextVertex,o.domain,c),M=mt(_,p,g,h,f),T=mt(y,p,g,h,f),b=mt(C,p,g,h,f);return(0,Ke.ed)(new Ws.R({view:h,attached:!0,color:ce.Z.toUnitRGBA(f?ae.orangeTransparent:ae.orange),renderOccluded:f?ee.yD.OccludeAndTransparent:ee.yD.Transparent,outlineRenderOccluded:f?ee.yD.OccludeAndTransparent:ee.yD.Opaque,outlineColor:ce.Z.toUnitRGBA(ae.orange),outlineSize:ae.rightAngleHintOutlineSize,size:ae.rightAngleHintSize,isDraped:f,geometry:{previous:M,center:T,next:b},renderGroup:xn.eZ.SnappingHint}))}_createLineSegmentHint(o,c,h,p,g,f,_=!1,y=!0,C=!0){const M=mt(c,p,g,f,_),T=mt(h,p,g,f,_),b=new Ls({view:f,extensionType:Ge.FADED,start:M,end:T,isDraped:_,color:ce.Z.toUnitRGBA(ae.orange),renderOccluded:_?ee.yD.OccludeAndTransparent:ee.yD.Opaque,renderGroup:xn.eZ.SnappingHint});switch(o){case ge.ze.TARGET:b.width=ae.lineHintWidthTarget,b.fadedExtensions={start:0,end:ae.lineHintFadedExtensions};break;case ge.ze.REFERENCE_EXTENSION:b.width=ae.lineHintWidthReference,b.fadedExtensions={start:0,end:0};break;case ge.ze.REFERENCE:b.width=ae.lineHintWidthReference,b.fadedExtensions={start:y?ae.lineHintFadedExtensions:0,end:C?ae.lineHintFadedExtensions:0}}return b.attached=!0,b}_alignPoint(o,c,h){const p=this._getSelfSnappingZ(c,h);return(0,m.Wi)(p)?o:(0,K.$G)(o[0],o[1],p)}_hintElevationInfo(o,c){return(0,m.pC)(this._getSelfSnappingZ(o.domain,c))?(0,m.Wg)(c.selfSnappingZ).elevationInfo:o.isDraped?Se.tR:Se.jG}_getSelfSnappingZ(o,{selfSnappingZ:c}){return o===Ae.B.SELF&&(0,m.pC)(c)?c.value:null}}function mt(l,o,c,h,p,g=(0,V.c)()){return p?(0,we.SH)(l,o,g,h.basemapTerrain.overlayManager.renderer.spatialReference):(0,Te.RS)(l,o,c,h,g),g}var vt=v(87469),pi=v(78260),Tt=v(4794),yt=v(54889);const X={main:new ce.Z([255,127,0]),selected:new ce.Z([255,255,255]),staged:new ce.Z([12,207,255]),outline:new ce.Z([0,0,0,.5]),selectedOutline:new ce.Z([255,255,255])};function Ut(l,o){const c=l.clone();return c.a*=o,c}function js(l,o){const c=l.clone(),h=(0,pi._Y)(c);h.s*=o;const p=(0,pi.xr)(h);return c.r=p.r,c.g=p.g,c.b=p.b,c}function Be(l,o){if(o)for(const c in o)l[c]=o[c]}class Fs{constructor(o){this.color=X.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=ee.yD.Opaque,Be(this,o)}}class On{constructor(o){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=X.main,this.outlineColor=X.outline,this.renderOccluded=ee.yD.Opaque,this.hoverOutlineColor=X.selectedOutline,Be(this,o)}apply(o,c){const h=this[o];c.setParameters({color:ct(h),transparent:"color"!==o||h.a<1,renderOccluded:this.renderOccluded})}}class Us{constructor(o){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.color=Ut(X.main,.5),this.hoverColor=X.main,this.renderOccluded=ee.yD.Transparent,this.minSquaredEdgeLength=900,Be(this,o)}apply(o,c){const h=this[o];c.setParameters({color:ct(h),transparent:h.a<1,renderOccluded:this.renderOccluded})}}class Ns{constructor(o){this.vertex=new On({color:X.main,outlineColor:X.outline}),this.edge=new On({color:js(Ut(X.main,2/3),.5),outlineColor:Ut(X.outline,.5),size:8,collisionPadding:8}),this.selected=new On({color:X.selected,outlineColor:X.outline}),this.edgeOffset=new Us,Be(this,o)}}class Rn{constructor(o){this.color=X.selected,this.width=1.5,this.stipplePattern=(0,yt.z5)(5),this.stippleOffColor=X.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=X.selected,this.renderOccluded=ee.yD.OccludeAndTransparent,Be(this,o)}apply(o){o.color=ct(this.color),o.width=this.width,o.stipplePattern=this.stipplePattern,o.stippleOffColor=ct(this.stippleOffColor),o.falloff=this.falloff,o.innerWidth=this.innerWidth,o.innerColor=ct(this.innerColor),o.renderOccluded=this.renderOccluded}}class Zs{constructor(o){this.color=X.selected,this.size=4,this.outlineSize=1,this.outlineColor=X.outline,this.shape="square",Be(this,o)}apply(o){o.color=ct(this.color),o.size=this.size,o.outlineSize=this.outlineSize,o.outlineColor=ct(this.outlineColor),o.primitive=this.shape}}class dn{constructor(o){this.innerColor=X.selected,this.innerWidth=1,this.glowColor=X.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.3,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=X.main,Be(this,o)}apply(o,c=1){const h={glowColor:ce.Z.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:ce.Z.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*c,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in o?o.style=h:o.laserlineStyle=h}}class Bs{constructor(o){this.outline=new Rn({color:X.outline,renderOccluded:ee.yD.OccludeAndTransparentStencil,stippleOffColor:X.selected,stipplePattern:(0,yt.z5)(5),width:1.5,innerWidth:0}),this.staged=new Rn({color:X.selected,renderOccluded:ee.yD.OccludeAndTransparentStencil,innerColor:X.staged,stippleOffColor:X.outline,stipplePattern:(0,yt.z5)(5),width:1.5}),this.shadowStyle=new dn({globalAlpha:.3,glowColor:X.main,glowFalloff:8,glowWidth:8,innerColor:X.selected,innerWidth:1}),Be(this,o)}}class ks{constructor(o){this.outline=new Zs({color:X.selected,outlineColor:X.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new dn({globalAlpha:.3,glowColor:X.main,glowFalloff:1.5,glowWidth:6,innerColor:X.selected,innerWidth:1,radius:2}),Be(this,o)}}class Ks extends Rn{constructor(o){super(),this.extensionType=Ge.GROUND_RAY,Be(this,o)}}class Ys{constructor(o){this.lineGraphics=new Bs,this.pointGraphics=new ks,this.heightPlane=new dn({globalAlpha:.3,glowColor:X.main,glowFalloff:8,glowWidth:8,innerColor:X.selected,innerWidth:1}),this.heightBox=new dn({globalAlpha:.3,glowColor:X.main,glowFalloff:8,glowWidth:8,innerColor:X.selected,innerWidth:0,heightFillColor:X.main}),this.zVerticalLine=new Ks({color:Ut(X.main,.5),falloff:2,innerColor:Ut(X.selected,0),renderOccluded:ee.yD.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:Ge.GROUND_RAY}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,Be(this,o)}}function ct(l){return(0,Tt.b)(ce.Z.toUnitRGBA(l))}const Lt=new class Xs{constructor(o){this.visualElements=new Ys,this.reshapeManipulators=new Ns,this.zManipulator=new Fs,Be(this,o)}colorToVec4(o){return ct(o)}};var ui=v(53928),$s=v(79112),Qs=v(81468),gi=v(6040),fi=v(42743),mi=v(81040);class qs extends ui._{constructor(o){super(o),this.view=null,this._renderOccluded=ee.yD.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=Lt.colorToVec4(Lt.reshapeManipulators.vertex.color),this._size=Lt.reshapeManipulators.vertex.size,this._outlineColor=Lt.colorToVec4(Lt.reshapeManipulators.vertex.outlineColor),this._outlineSize=Lt.reshapeManipulators.vertex.outlineSize,this._elevationInfo=null,this.applyProps(o)}get renderOccluded(){return this._renderOccluded}set renderOccluded(o){o!==this._renderOccluded&&(this._renderOccluded=o,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(o){this._vertices=o,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(o){this._spatialReference=o,this.recreateGeometry()}get color(){return this._color}set color(o){(0,Ye.g)(o,this._color)||((0,Ye.c)(this._color,o),this._updateMaterial())}get size(){return this._size}set size(o){o!==this._size&&(this._size=o,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(o){(0,Ye.g)(o,this._outlineColor)||((0,Ye.c)(this._outlineColor,o),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(o){o!==this._outlineSize&&(this._outlineSize=o,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(o){this._elevationInfo=o,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSizeScale:this.size,renderOccluded:this._renderOccluded}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const o=this.vertices;if((0,m.Wi)(o)||0===o.length)return[];const p=function Js(l,o,c,h,p){const g=(0,gi.bg)(3*l.length),f=(0,gi.bg)(g.length);l.forEach((C,M)=>{g[3*M+0]=C[0],g[3*M+1]=C[1],g[3*M+2]=C.length>2?C[2]:0});const _=(0,Qs.rR)(g,o,0,f,0,g,0,g.length/3,c,h,p);return{numVertices:l.length,position:g,mapPositions:f,projectionSuccess:null!=_,sampledElevation:_}}(o,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,$s.o.fromElevationInfo(this.elevationInfo)),g=[],f=p.numVertices,_=p.position;for(let y=0;y<f;++y){const C=(0,x.s)(er,_[3*y+0],_[3*y+1],_[3*y+2]),M=vi(this._vertexMaterial,.5,C),T=vi(this._vertexOutlineMaterial,.5,C);g.push({vertexGeometry:M,vertexOutlineGeometry:T})}return g}createGeometries(o){const c=this._createRenderGeometries();for(const{vertexGeometry:h,vertexOutlineGeometry:p}of c)o.addGeometry(h),o.addGeometry(p)}createExternalResources(){this._vertexMaterial=new mi.Q({...this._vertexMaterialParameters,writeDepth:!0,cullFace:fi.Vr.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new mi.Q({...this._vertexOutlineMaterialParameters,transparent:!0,writeDepth:!0,cullFace:fi.Vr.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(o){o(this._vertexMaterial),o(this._vertexOutlineMaterial)}}const er=(0,V.c)();function vi(l,o,c){return(0,gt.PI)(l,o,16,16,{offset:c})}var tr=v(79967),nr=v(50017),ir=v(466),sr=v(97737),rr=v(79682);let _t=class extends B.Z{constructor(l){super(l),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1}};(0,S._)([(0,P.Cb)({constructOnly:!0})],_t.prototype,"layer",void 0),(0,S._)([(0,P.Cb)()],_t.prototype,"enabled",void 0),(0,S._)([(0,P.Cb)()],_t.prototype,"updating",void 0),(0,S._)([(0,P.Cb)()],_t.prototype,"availability",void 0),_t=(0,S._)([(0,de.j)("esri.views.interactive.snapping.FeatureSnappingLayerSource")],_t);const yi=_t;let je=class extends B.Z{constructor(l){super(l),this.enabled=!1,this.enabledToggled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new W.Z,this.distance=ae.distance,this.touchSensitivityMultiplier=ae.touchSensitivityMultiplier}get effectiveEnabled(){return this.enabledToggled?!this.enabled:this.enabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}};(0,S._)([(0,P.Cb)()],je.prototype,"enabled",void 0),(0,S._)([(0,P.Cb)()],je.prototype,"enabledToggled",void 0),(0,S._)([(0,P.Cb)()],je.prototype,"selfEnabled",void 0),(0,S._)([(0,P.Cb)()],je.prototype,"featureEnabled",void 0),(0,S._)([(0,P.Cb)({type:W.Z.ofType(yi)})],je.prototype,"featureSources",void 0),(0,S._)([(0,P.Cb)()],je.prototype,"distance",void 0),(0,S._)([(0,P.Cb)()],je.prototype,"touchSensitivityMultiplier",void 0),(0,S._)([(0,P.Cb)({readOnly:!0})],je.prototype,"effectiveEnabled",null),(0,S._)([(0,P.Cb)({readOnly:!0})],je.prototype,"effectiveSelfEnabled",null),(0,S._)([(0,P.Cb)({readOnly:!0})],je.prototype,"effectiveFeatureEnabled",null),je=(0,S._)([(0,de.j)("esri.views.interactive.snapping.SnappingOptions")],je);const _i=je;var zt,or=v(88159),lr=v(39863),Si=v(83308),At=v(33351),dr=v(61430),cr=v(75897),hr=v(97979),Nt=v(22823);class Ci extends Nt.j{constructor({targetPoint:o,constraint:c,previousVertex:h,otherVertex:p,otherVertexType:g,objectId:f,isDraped:_}){super(o,c,_,Ae.B.SELF),this.previousVertex=h,this.otherVertex=p,this.otherVertexType=g,this.objectId=f}get hints(){const o=this.previousVertex,c=this.otherVertexType===zt.CENTER?this.otherVertex:this.targetPoint,h=this.otherVertexType===zt.CENTER?this.targetPoint:this.otherVertex;return[new $e.w(ge.ze.TARGET,c,h,this.isDraped,this.domain),new $e.w(ge.ze.REFERENCE,o,c,this.isDraped,this.domain),new Ft(this.previousVertex,c,h,this.isDraped,this.domain)]}}!function(l){l[l.NEXT=0]="NEXT",l[l.CENTER=1]="CENTER"}(zt||(zt={}));let at=class extends En.r{get updating(){return(0,or.oE)(this.snappingSources,({snappingSource:l})=>l.updating)||this.updatingHandles.updating}get snappingSources(){const l=this._get("snappingSources")||new Map,o=new Map;if((0,m.pC)(this.options)&&(0,m.pC)(this.options.featureSources))for(const c of this.options.featureSources.items){const h=c.layer.uid,p=l.get(h);if(p){l.delete(h),o.set(h,p);continue}if(!c.layer.loaded){this.updatingHandles.addPromise(c.layer.load());continue}const g=this._createSourceInfo(c);(0,m.pC)(g)&&o.set(h,g)}for(const[,c]of l)c.destroy();return o}constructor(l){super(l),this.options=null,this._domain=Ae.B.FEATURE,this._sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null},notes:{module:null,loader:null},scene:{module:null,loader:null}}}initialize(){this.updatingHandles.add(()=>this.snappingSources,()=>this.notifyChange("updating"),O.Z_),(0,m.pC)(this.view)&&this.handles.add([this.view.on("layerview-create",l=>this._updateLayerView(l.layer,l.layerView)),this.view.on("layerview-destroy",l=>this._updateLayerView(l.layer,null))])}_updateLayerView(l,o){for(const[,c]of this.snappingSources)c.snappingSource.layerSource.layer===l&&(c.layerView=o)}destroy(){this._set("options",null);for(const[,l]of this.snappingSources)l.destroy()}fetchCandidates(l,o,c,h){var p=this;return(0,G.Z)(function*(){if(!(o&p._domain)||(0,m.Wi)(p.options)||!p.options.effectiveFeatureEnabled)return[];const g=[],f=p._computeScreenSizeDistanceParameters(l,c),_={distance:f,mode:(0,m.Wg)(p.view)?.type??"2d",point:l,coordinateHelper:c.coordinateHelper,types:p._types};for(const[,{snappingSource:C,layerView:M}]of p.snappingSources)!C.layerSource.enabled||(0,m.pC)(M)&&M.suspended||g.push(C.fetchCandidates(_,h).then(T=>T.filter(b=>!p._candidateIsExcluded(C,b,c.excludeFeature))));const y=(yield(0,lt.WW)(g)).flat();return p._addRightAngleCandidates(y,l,f,c),(0,lt.k_)(h),(0,ge.lQ)(l,y),y})()}_addRightAngleCandidates(l,o,c,h){const p=(0,m.pC)(h.vertexHandle)?h.vertexHandle.rightEdge?.rightVertex?.pos:(0,m.pC)(h.editGeometryOperations)&&"polygon"===h.editGeometryOperations.data.type?(0,m.Wg)(h.editGeometryOperations.data.components[0]?.getFirstVertex())?.pos:null,g=(0,m.pC)(h.vertexHandle)?h.vertexHandle.leftEdge?.leftVertex?.pos:(0,m.pC)(h.editGeometryOperations)?(0,m.Wg)(h.editGeometryOperations.data.components[0]?.getLastVertex())?.pos:null,{view:f}=this,_=(0,K.$D)(p,f,h),y=(0,K.$D)(g,f,h),C=l.length;for(let M=0;M<C;M++)this._addRightAngleCandidate(l[M],y,o,c,l),this._addRightAngleCandidate(l[M],_,o,c,l)}_addRightAngleCandidate(l,o,c,h,p){if((0,m.Wi)(o)||!function ur(l){return(l instanceof cr.L||l instanceof dr.k)&&!function gr({constraint:{start:l,end:o}}){const c=(0,x.d)(l,o),h=(0,ve.k)(l,o);return c<(0,lr.g)()||h/c<mr}(l)}(l))return;const g=l.constraint.closestTo(o),f=(g[0]-c[0])/h.x,_=(g[1]-c[1])/h.y,{start:y,end:C}=l.constraint;if(f*f+_*_<=1){const M=new Ci({targetPoint:g,otherVertex:o,otherVertexType:zt.NEXT,previousVertex:(0,ve.k)(g,y)>(0,ve.k)(g,C)?y:C,constraint:new At.aU(o,g),objectId:l.objectId,isDraped:l.isDraped});p.push(M)}}_computeScreenSizeDistanceParameters(l,o){let c=(0,m.pC)(this.options)?this.options.distance*("touch"===o.pointer?this.options.touchSensitivityMultiplier:1):0;return(0,m.Wi)(this.view)?{x:c,y:c,z:c,distance:c}:"2d"===this.view.type?(c*=this.view.resolution,{x:c,y:c,z:c,distance:c}):this._computeScreenSizeDistanceParameters3D(l,c,this.view,o)}_computeScreenSizeDistanceParameters3D(l,o,c,h){const{spatialReference:p}=h;c.renderCoordsHelper.toRenderCoords(l,p,Pi);const g=c.state.camera.computeScreenPixelSizeAt(Pi),f=g*c.renderCoordsHelper.unitInMeters/c.mapCoordsHelper.unitInMeters,_=o*f,y=(0,Te.Rs)(l,p,Se.jG,c),C=y?Tn(y,l,f,0,0,c,h):0,M=y?Tn(y,l,0,f,0,c,h):0,T=y?Tn(y,l,0,0,f,c,h):0;return{x:0===C?0:_/C,y:0===M?0:_/M,z:0===T?0:_/T,distance:g*o}}get _types(){return Si.r.EDGE|Si.r.VERTEX}_candidateIsExcluded(l,o,c){if((0,m.Wi)(c))return!1;const h=this._getCandidateObjectId(o);if((0,m.Wi)(h))return!1;const p=l.layerSource.layer;return"graphics"===p.type?c.uid===h:c.sourceLayer===p&&!(!c.attributes||!("objectIdField"in p))&&c.attributes[p.objectIdField]===h}_getCandidateObjectId(l){return l instanceof hr.a?l.objectId:null}_createSourceInfo(l){const o=this._createFeatureSnappingSourceType(l);if((0,m.Wi)(o))return null;if("loading"in o)return this.updatingHandles.addPromise(o.loading.then(()=>{this.destroyed||this.notifyChange("snappingSources")})),null;const c=(0,m.pC)(this.view)?this.view.allLayerViews.find(h=>h.layer===l.layer):null;return new pr(o.source,c)}_createFeatureSnappingSourceType(l){switch(l.layer.type){case"feature":case"geojson":case"csv":case"oriented-imagery":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(l);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(l);case"map-notes":return this._createFeatureSnappingSourceMapNotesLayer(l);case"scene":case"building-scene":return this._createFeatureSnappingSourceSceneLayer(l)}return null}_createFeatureSnappingSourceSceneLayer(l){const{view:o}=this;if((0,m.Wi)(o)||"3d"!==o.type)return null;const c=this._getSourceModule("scene");return(0,m.pC)(c.module)?{source:new c.module.SceneLayerSnappingSource({layerSource:l,view:o})}:{loading:c.loader}}_createFeatureSnappingSourceFeatureLayer(l){switch(l.layer.source?.type){case"feature-layer":case"oriented-imagery":{const o=this._getSourceModule("featureService");return(0,m.pC)(o.module)?{source:new o.module.FeatureServiceSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:l})}:{loading:o.loader}}case"memory":case"csv":case"geojson":case"wfs":{if("mesh"===l.layer.geometryType)return null;const o=this._getSourceModule("featureCollection");return(0,m.pC)(o.module)?{source:new o.module.FeatureCollectionSnappingSource({layerSource:l,view:this.view})}:{loading:o.loader}}}return null}_createFeatureSnappingSourceGraphicsLayer(l){const o=this._getSourceModule("graphics");return(0,m.pC)(o.module)?{source:new o.module.GraphicsSnappingSource({getGraphicsLayers:()=>[l.layer],spatialReference:this.spatialReference,view:this.view,layerSource:l})}:{loading:o.loader}}_createFeatureSnappingSourceMapNotesLayer(l){const o=this._getSourceModule("notes");return(0,m.pC)(o.module)?{source:new o.module.GraphicsSnappingSource({getGraphicsLayers:()=>(0,m.pC)(l.layer.sublayers)?l.layer.sublayers.toArray():[],spatialReference:this.spatialReference,view:this.view,layerSource:l})}:{loading:o.loader}}_getSourceModule(l){const o=this._sourceModules[l];if((0,m.Wi)(o.loader)){const c=this._loadSourceModule(l).then(h=>{o.module=h});return o.loader=c,{module:o.module,loader:c}}return{module:o.module,loader:o.loader}}_loadSourceModule(l){const o=this.updatingHandles;switch(l){case"featureService":return o.addPromise(Promise.all([v.e(8592),v.e(8740)]).then(v.bind(v,78740)));case"featureCollection":return o.addPromise(Promise.all([v.e(8592),v.e(8176)]).then(v.bind(v,78176)));case"graphics":case"notes":return o.addPromise(Promise.all([v.e(3464),v.e(8592),v.e(6269)]).then(v.bind(v,66269)));case"scene":return o.addPromise(Promise.all([v.e(8592),v.e(7566)]).then(v.bind(v,57566)))}}};(0,S._)([(0,P.Cb)({constructOnly:!0})],at.prototype,"spatialReference",void 0),(0,S._)([(0,P.Cb)({constructOnly:!0})],at.prototype,"view",void 0),(0,S._)([(0,P.Cb)()],at.prototype,"options",void 0),(0,S._)([(0,P.Cb)({readOnly:!0})],at.prototype,"updating",null),(0,S._)([(0,P.Cb)({readOnly:!0})],at.prototype,"snappingSources",null),at=(0,S._)([(0,de.j)("esri.views.interactive.snapping.FeatureSnappingEngine")],at);class pr{constructor(o,c){this.snappingSource=o,this.layerView=c,this.handles=new se.Z;const h=this.snappingSource.layerSource.layer;"refresh"in h&&this.handles.add(h.on("refresh",()=>o.refresh())),this.handles.add([(0,O.YP)(()=>o.updating,p=>o.layerSource.updating=p,O.tX),(0,O.YP)(()=>o.availability,p=>o.layerSource.availability=p,O.tX)])}destroy(){this.snappingSource.destroy(),this.handles.destroy()}}function Tn(l,o,c,h,p,g,{spatialReference:f}){const _=(0,x.c)(fr,o);_[0]+=c,_[1]+=h,_[2]+=p;const y=(0,Te.Rs)(_,f,Se.jG,g);return y?(0,ge.fG)(y,l):1/0}const Pi=(0,V.c)(),fr=(0,V.c)(),mr=1e-4;var vr=v(61885);class cn{constructor(o,c){this.view=o,this.options=c,this.squaredShortLineThreshold=ae.shortLineThreshold*ae.shortLineThreshold}snap(o,c){return(0,m.pC)(c.vertexHandle)?"vertex"!==c.vertexHandle.type?[]:this.snapExistingVertex(o,c):this.snapNewVertex(o,c)}edgeExceedsShortLineThreshold(o,c){return this.exceedsShortLineThreshold((0,K.$D)(o.leftVertex.pos,this.view,c),(0,K.$D)(o.rightVertex.pos,this.view,c),c)}exceedsShortLineThreshold(o,c,{spatialReference:h}){return 0===this.squaredShortLineThreshold||(0,ge.Bb)((0,Te.Rs)(c,h,Se.jG,this.view),(0,Te.Rs)(o,h,Se.jG,this.view))>this.squaredShortLineThreshold}isVertical(o,c){return(0,ve.k)(o,c)<ae.verticalLineThreshold}squaredProximityThreshold(o){return"touch"===o?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:o,touchSensitivityMultiplier:c}=this.options,h=o*c;return h*h}}class yr extends Nt.j{constructor({lineStart:o,lineEnd:c,targetPoint:h,isDraped:p}){super(h,new At.jg(o,c),p,Ae.B.SELF),this._referenceLineHint=new $e.w(ge.ze.REFERENCE_EXTENSION,o,c,p,this.domain)}get hints(){return[this._referenceLineHint,new $e.w(ge.ze.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}}var _r=v(26362),Zt=v(396);class Sr extends cn{snapNewVertex(o,c){const h=c.editGeometryOperations.data.components[0],p=h.edges.length,g=[];if(p<1)return g;const{spatialReference:f}=c,_=(0,Te.Rs)(o,f,Se.jG,this.view),{view:y}=this,C=h.edges[p-1];let M=C;do{if(this.edgeExceedsShortLineThreshold(M,c)){const T=(0,ge._j)(M,y,c);this._processCandidateProposal(T.left,T.right,o,_,c,g)}M=M.leftVertex.leftEdge}while(M&&M!==C);return g}snapExistingVertex(o,c){const h=[],p=(0,m.Wg)(c.vertexHandle),g=p.component;if(g.edges.length<2)return h;const{view:f}=this,{spatialReference:_}=c,y=(0,Te.Rs)(o,_,Se.jG,f),C=p.leftEdge,M=p.rightEdge;C&&M&&this.edgeExceedsShortLineThreshold(C,c)&&this.edgeExceedsShortLineThreshold(M,c)&&this._processCandidateProposal((0,K.$D)(C.leftVertex.pos,f,c),(0,K.$D)(M.rightVertex.pos,f,c),o,y,c,h);const T=g.edges[0];let b=T;do{if(b!==p.leftEdge&&b!==p.rightEdge&&this.edgeExceedsShortLineThreshold(b,c)){const k=(0,ge._j)(b,f,c);this._processCandidateProposal(k.left,k.right,o,y,c,h)}b=b.rightVertex.rightEdge}while(b&&b!==T);return h}_processCandidateProposal(o,c,h,p,g,f){const{spatialReference:_,pointer:y}=g,C=(0,K.uc)((0,_r.ZE)(h,{start:o,end:c,type:Zt.SP.LINE}));(0,ge.Bb)(p,(0,Te.Rs)(C,_,Se.jG,this.view))<this.squaredProximityThreshold(y)&&f.push(new yr({lineStart:o,lineEnd:c,targetPoint:C,isDraped:"on-the-ground"===g.elevationInfo?.mode}))}}class Cr extends Nt.j{constructor({referenceLine:o,lineStart:c,targetPoint:h,isDraped:p}){const g=(0,V.a)(c),{left:f,right:_}=o;(0,x.b)(g,(0,x.a)(g,g,_),f),super(h,new At.jg(c,(0,K.uc)(g)),p,Ae.B.SELF),this._referenceLines=[{edge:o,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new $e.w(ge.ze.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new ln(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(o=>new $e.w(ge.ze.REFERENCE,o.edge.left,o.edge.right,this.isDraped,this.domain,o.fadeLeft,o.fadeRight))]}addReferenceLine(o){const c={edge:o,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(h=>{(0,x.k)(o.right,h.edge.left)&&(h.fadeLeft=!1,c.fadeRight=!1),(0,x.k)(o.right,h.edge.right)&&(h.fadeRight=!1,c.fadeRight=!1),(0,x.k)(o.left,h.edge.right)&&(h.fadeRight=!1,c.fadeLeft=!1),(0,x.k)(o.left,h.edge.left)&&(h.fadeLeft=!1,c.fadeLeft=!1)}),this._referenceLines.push(c)}}class Pr extends cn{snapNewVertex(o,c){const h=c.editGeometryOperations.data.components[0],p=h.edges.length,g=h.vertices.length,f=[];if(p<2)return f;const{view:_}=this,y=(0,Te.Rs)(o,c.spatialReference,Se.jG,_),C=(0,K.$D)(h.vertices[g-1].pos,_,c),M=(0,K.$D)(h.vertices[0].pos,_,c),T=h.edges[p-1];let b=T;do{if(this.edgeExceedsShortLineThreshold(b,c)){const k=(0,ge._j)(b,_,c);this._checkEdgeForParallelLines(k,C,o,y,c,f),this._checkEdgeForParallelLines(k,M,o,y,c,f)}b=b.leftVertex.leftEdge}while(b&&b!==T);return f}snapExistingVertex(o,c){const h=[],p=(0,m.Wg)(c.vertexHandle),g=p.component;if(g.edges.length<3)return h;const{view:f}=this,_=(0,Te.Rs)(o,c.spatialReference,Se.jG,f),y=p.leftEdge,C=p.rightEdge,M=g.vertices[0],T=(0,K.$D)(M.pos,f,c),k=g.vertices[g.vertices.length-1],oe=(0,K.$D)(k.pos,f,c),he=g.edges[0];let te=he;do{if(te!==y&&te!==C&&this.edgeExceedsShortLineThreshold(te,c)){const Re=(0,ge._j)(te,f,c);y&&this._checkEdgeForParallelLines(Re,(0,K.$D)(y.leftVertex.pos,f,c),o,_,c,h),C&&this._checkEdgeForParallelLines(Re,(0,K.$D)(C.rightVertex.pos,f,c),o,_,c,h),p===M?this._checkEdgeForParallelLines(Re,oe,o,_,c,h):p===k&&this._checkEdgeForParallelLines(Re,T,o,_,c,h)}te=te.rightVertex.rightEdge}while(te&&te!==he);return h}_checkEdgeForParallelLines(o,c,h,p,g,f){const _=o.left,y=o.right;if((0,Zt.k0)(St,c,_,y),(0,ve.k)(St,c)<ae.parallelLineThreshold)return;(0,Zt.k0)(St,h,_,y,c);const{spatialReference:C,pointer:M}=g,T=(0,K.uc)((0,V.f)(St[0],St[1],h[2]));if((0,ge.Bb)(p,(0,Te.Rs)(T,C,Se.jG,this.view))<this.squaredProximityThreshold(M)){if(this.isVertical(T,c)||this.isVertical(_,y)||this._parallelToPreviousCandidate(o,f))return;f.push(new Cr({referenceLine:o,lineStart:c,targetPoint:T,isDraped:"on-the-ground"===g.elevationInfo?.mode}))}}_parallelToPreviousCandidate(o,c){const h=o.left,p=o.right;for(const g of c)if((0,Zt.k0)(St,p,g.constraint.start,g.constraint.end,h),(0,ve.k)(St,p)<ae.parallelLineThreshold)return g.addReferenceLine(o),!0;return!1}}const St=(0,Ot.a)();class Er extends cn{snapNewVertex(o,c){const h=c.editGeometryOperations.data.components[0],p=h.vertices.length,g=[];if(p<2)return g;const{view:f}=this,_=(0,Te.Rs)(o,c.spatialReference,Se.jG,f),y=h.vertices[p-1];if(this.edgeExceedsShortLineThreshold(y.leftEdge,c)){const M=(0,K.$D)(y.pos,f,c),T=(0,K.$D)(y.leftEdge.leftVertex.pos,f,c);this._checkForSnappingCandidate(g,T,M,o,_,c)}const C=h.vertices[0];if(this.edgeExceedsShortLineThreshold(C.rightEdge,c)){const M=(0,K.$D)(C.pos,f,c),T=(0,K.$D)(C.rightEdge.rightVertex.pos,f,c);this._checkForSnappingCandidate(g,T,M,o,_,c)}return g}snapExistingVertex(o,c){const h=[],p=(0,m.Wg)(c.vertexHandle);if(p.component.vertices.length<3)return h;const{view:g}=this,f=(0,Te.Rs)(o,c.spatialReference,Se.jG,g),_=p.leftEdge,y=p.rightEdge;if(_&&_.leftVertex.leftEdge){const C=_.leftVertex.leftEdge;if(this.edgeExceedsShortLineThreshold(C,c)){const M=(0,K.$D)(C.rightVertex.pos,g,c),T=(0,K.$D)(C.leftVertex.pos,g,c);this._checkForSnappingCandidate(h,T,M,o,f,c)}}if(y&&y.rightVertex.rightEdge){const C=y.rightVertex.rightEdge;if(this.edgeExceedsShortLineThreshold(C,c)){const M=(0,K.$D)(C.leftVertex.pos,g,c),T=(0,K.$D)(C.rightVertex.pos,g,c);this._checkForSnappingCandidate(h,T,M,o,f,c)}}return h}_checkForSnappingCandidate(o,c,h,p,g,f){const{spatialReference:_,pointer:y}=f;(0,ve.a)(hn,h,c);const C=(0,x.s)(Mr,hn[1],-hn[0],0),M=(0,ve.h)(C,(0,ve.a)(hn,p,h))/(0,ve.v)(C),T=(0,K.uc)((0,ve.w)((0,V.a)(p),h,C,M));if((0,ge.Bb)(g,(0,Te.Rs)(T,_,Se.jG,this.view))<this.squaredProximityThreshold(y)){if(this.isVertical(T,h)||this.isVertical(h,c))return;const b=(0,x.z)((0,V.c)(),h,C,Math.sign(M));o.push(new Ci({targetPoint:T,constraint:new At.aU(h,(0,K.uc)(b)),previousVertex:c,otherVertex:h,otherVertexType:zt.CENTER,isDraped:"on-the-ground"===f.elevationInfo?.mode}))}}}const hn=(0,Ot.a)(),Mr=(0,V.c)();class Dr extends Nt.j{constructor({targetPoint:o,point1:c,point2:h,isDraped:p}){super(o,new At.kt((0,K.uc)((0,x.h)((0,V.c)(),c,h,.5)),.5*(0,ve.d)(c,h)),p,Ae.B.SELF),this._p1=c,this._p2=h}get hints(){return[new $e.w(ge.ze.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new $e.w(ge.ze.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new Ft(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}}class xr extends cn{snapNewVertex(o,c){const h=c.editGeometryOperations.data.components[0],p=[],g=h.vertices.length;if("polygon"!==c.editGeometryOperations.data.type||g<2)return p;const{view:f}=this,y=h.vertices[g-1],C=(0,K.$D)(h.vertices[0].pos,f,c),M=(0,K.$D)(y.pos,f,c);return this._processCandidateProposal(C,M,o,c,p),p}snapExistingVertex(o,c){const h=[],p=(0,m.Wg)(c.vertexHandle),g=p.component;if(g.edges.length<2||"polyline"===c.editGeometryOperations.data.type&&(0===p.index||p.index===g.vertices.length-1))return h;const{view:f}=this,_=(0,K.$D)(p.leftEdge.leftVertex.pos,f,c),y=(0,K.$D)(p.rightEdge.rightVertex.pos,f,c);return this._processCandidateProposal(_,y,o,c,h),h}_processCandidateProposal(o,c,h,p,g){if(!this.exceedsShortLineThreshold(o,c,p))return;const f=(0,ve.l)(wr,o,c,.5),_=.5*(0,ve.d)(o,c),y=(0,V.c)();(0,Zt.xO)(y,h,f,_),y[2]=h[2];const C=(0,K.uc)(y),{spatialReference:M,pointer:T}=p,b=(0,Te.Rs)(h,M,Se.jG,this.view);if((0,ge.Bb)(b,(0,Te.Rs)(C,M,Se.jG,this.view))<this.squaredProximityThreshold(T)){if(this.isVertical(o,C)||this.isVertical(C,c))return;g.push(new Dr({targetPoint:C,point1:o,point2:c,isDraped:"on-the-ground"===p.elevationInfo?.mode}))}}}const wr=(0,Ot.a)();let Vt=class extends B.Z{constructor(l){super(l),this.updating=!1,this._snappers=new W.Z,this._domain=Ae.B.SELF}initialize(){this._snappers.push(new Pr(this.view,this.options),new Sr(this.view,this.options),new Er(this.view,this.options),new xr(this.view,this.options))}set options(l){this._set("options",l);for(const o of this._snappers)o.options=l}fetchCandidates(l,o,c){var h=this;return(0,G.Z)(function*(){if(!(o&h._domain&&h.options.effectiveSelfEnabled))return[];const p=[];for(const g of h._snappers.items)for(const f of g.snap(l,c))p.push(f);return(0,ge.lQ)(l,p),p})()}};function Or(l,o){return[new Vt({view:l,options:o}),new at({view:l,options:o,spatialReference:l.spatialReference})]}(0,S._)([(0,P.Cb)({readOnly:!0})],Vt.prototype,"updating",void 0),(0,S._)([(0,P.Cb)({constructOnly:!0})],Vt.prototype,"view",void 0),(0,S._)([(0,P.Cb)()],Vt.prototype,"options",null),Vt=(0,S._)([(0,de.j)("esri.views.interactive.snapping.SelfSnappingEngine")],Vt);class pn extends Nt.j{constructor(o,c,h,p){super(o,new At.Bq(o,c.constraint,h.constraint),p,Ae.B.ALL),this.first=c,this.second=h}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new on(this.targetPoint,this.isDraped,this.domain)]}}let Qe=class extends(vr.Z.EventedMixin(En.r)){constructor(l){super(l),this.options=new _i,this.snappingEnginesFactory=Or,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=ot.MAIN}initialize(){this.handles.add([(0,O.YP)(()=>{const{effectiveFeatureEnabled:l,effectiveSelfEnabled:o,touchSensitivityMultiplier:c,distance:h}=this.options;return{effectiveFeatureEnabled:l,effectiveSelfEnabled:o,touchSensitivityMultiplier:c,distance:h}},()=>{this.doneSnapping(),this.emit("changed")},O.Z_),(0,O.YP)(()=>this.options,l=>{for(const o of this._engines)o.options=l},O.Z_),(0,O.YP)(()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory}),({viewReady:l,snappingEnginesFactory:o})=>this._recreateEngines(l,o),O.tX)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some(l=>l.updating)}_recreateEngines(l,o){if(this._destroyEngines(),!l)return;const{view:c,options:h}=this;this._engines=o(c,h)}_destroyEngines(){for(const l of this._engines)l.destroy();this._engines=[]}get _squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:l,touchSensitivityMultiplier:o}=this.options,c=l*o;return c*c}get _squaredSatisfiesConstraintThreshold(){return ae.satisfiesConstraintScreenThreshold*ae.satisfiesConstraintScreenThreshold}snap(l){var o=this;return(0,G.Z)(function*(){return function Rr(l){return(0,m.pC)(l.scenePoint)}(l)?o._snapMultiPoint(l):o._snapSinglePoint(l)})()}update(l){const{point:o,context:c}=l;this._removeVisualization();const h=this._currentMainCandidate;if((0,m.Wi)(h))return o;const p=this._selectUpdateInput(l);if((0,m.Wi)(p))return o;const{spatialReference:g}=c,f=(0,we.iV)(p,g);if((0,m.Wi)(f))return o;const{view:_}=this,{elevationInfo:y,visualizer:C}=c,M=[],T=(0,K.dF)(f,_,c),b=h.constraint.closestTo(T);if(!this._arePointsWithinScreenThreshold(T,b,c))return this._resetSnappingState(),o;h.targetPoint=b,M.push(...h.hints);for(const k of this._currentOtherActiveCandidates)k.targetPoint=b,M.push(...k.hints);return(0,m.pC)(C)&&this.handles.add(C.draw(M,{spatialReference:g,elevationInfo:Tr(c),view:_,selfSnappingZ:c.selfSnappingZ}),un),(0,K.Gs)(b,_,{z:o.z,m:o.m,spatialReference:o.spatialReference,elevationInfo:y})}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:l,scenePoint:o}){switch(this._currentSnappedType){case ot.MAIN:return l;case ot.SCENE:return o}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=ot.MAIN}_removeVisualization(){this.handles.remove(un)}_snapSinglePoint({point:l,context:o,signal:c}){var h=this;return(0,G.Z)(function*(){const{view:p}=h,g=(0,K.dF)(l,p,o),f=yield h._fetchCandidates(g,Ae.B.ALL,o,c);return h._createSnapResult(g,ot.MAIN,f,p,o,{z:l.z,m:l.m,spatialReference:l.spatialReference,elevationInfo:o.elevationInfo},c)})()}_snapMultiPoint({point:l,scenePoint:o,context:c,signal:h}){var p=this;return(0,G.Z)(function*(){const{view:g}=p,{coordinateHelper:f,spatialReference:_}=c;yield(0,we.iQ)(o.spatialReference,_);const y=(0,we.iV)(o,_),C=(0,K.dF)(y,g,c),M=yield p._fetchCandidates(C,Ae.B.FEATURE,c,h);if(M.length>0){const k=yield p._fetchCandidates(C,Ae.B.SELF,c,h);return p._createSnapResult(C,ot.SCENE,[...M,...k],g,c,{z:y.z,m:y.m,spatialReference:y.spatialReference,elevationInfo:c.elevationInfo},h)}const T=(0,K.dF)(l,g,c),b=yield p._fetchCandidates(T,Ae.B.SELF,c,h);return p._createSnapResult(T,ot.MAIN,b,g,c,{z:f.hasZ()&&l.hasZ?l.z??0:void 0,m:f.hasM()&&l.hasM?l.m??0:void 0,spatialReference:l.spatialReference,elevationInfo:c.elevationInfo},h)})()}_fetchCandidates(l,o,c,h){var p=this;return(0,G.Z)(function*(){return(yield Promise.all(p._engines.map(g=>g.fetchCandidates(l,o,c,h)))).flat()})()}_createSnapResult(l,o,c,h,p,g,f){return{get valid(){return!(0,lt.Hc)(f)},apply:()=>{const{spatialReference:_}=p,{snappedPoint:y,hints:C}=this._processCandidates(l,o,c,p);return this._removeVisualization(),(0,m.pC)(p.visualizer)&&this.handles.add(p.visualizer.draw(C,{spatialReference:_,elevationInfo:Se.jG,view:h,selfSnappingZ:p.selfSnappingZ}),un),(0,K.Gs)(y,h,g)}}}_processCandidates(l,o,c,h){if(c.length<1)return this.doneSnapping(),{snappedPoint:l,hints:[]};this._currentSnappedType!==o&&this._resetSnappingState(),(0,ge.lQ)(l,c);const p=this._currentMainCandidate;if((0,m.pC)(p)){const g=this._findOldConstraintInNewCandidates(p,c);if(g>=0){if(!(c[g]instanceof pn))return this._intersectWithOtherCandidates(g,c,l,o,h);if(this._arePointsWithinScreenThreshold(l,p.targetPoint,h))return this._updateSnappingCandidate(p,o,c,h)}}return this._intersectWithOtherCandidates(0,c,l,o,h)}_findOldConstraintInNewCandidates(l,o){return l instanceof pn?this._findOldCandidateIndex(o,l.first)>=0&&this._findOldCandidateIndex(o,l.second)>=0?0:-1:this._findOldCandidateIndex(o,l)}_intersectWithOtherCandidates(l,o,c,h,p){const{coordinateHelper:g}=p,f=o[l],_=[];for(let y=0;y<o.length;++y){if(y===l)continue;const C=o[y];for(const M of f.constraint.intersect(C.constraint)){const T=M.closestTo(f.targetPoint);_.push([new pn(T,f,C,C.isDraped),this._squaredScreenDistance(c,T,g)])}}return _.length>0&&(_.sort((y,C)=>y[1]-C[1]),_[0][1]<this._squaredPointProximityThreshold(p.pointer))?this._updateSnappingCandidate(_[0][0],h,o,p):this._updateSnappingCandidate(f,h,o,p)}_updateSnappingCandidate(l,o,c,h){this.doneSnapping(),this._currentMainCandidate=l,this._currentSnappedType=o;const p=this._currentMainCandidate.targetPoint,g=[];g.push(...l.hints);for(const f of c){if(l instanceof pn){if(f.constraint.equals(l.first.constraint)||f.constraint.equals(l.second.constraint))continue}else if(f.constraint.equals(l.constraint))continue;const _=f.constraint.closestTo(p);this._squaredScreenDistance(_,p,h.coordinateHelper)<this._squaredSatisfiesConstraintThreshold&&(f.targetPoint=p,this._currentOtherActiveCandidates.push(f),g.push(...f.hints))}return{snappedPoint:p,hints:g}}_squaredPointProximityThreshold(l){return"touch"===l?this._squaredTouchProximityThreshold:this._squaredMouseProximityTreshold}_arePointsWithinScreenThreshold(l,o,c){return this._squaredScreenDistance(l,o,c.coordinateHelper)<this._squaredPointProximityThreshold(c.pointer)}_squaredScreenDistance(l,o,c){return(0,ge.Bb)(this._toScreen(l,c),this._toScreen(o,c))}_toScreen(l,o){return(0,Te.Rs)(l,o.spatialReference,Se.jG,this.view)}_findOldCandidateIndex(l,o){let c=-1;for(let h=0;h<l.length;++h)if(o.constraint.equals(l[h].constraint)){c=h;break}return c}get test(){return{visualizationsActive:this.handles.has(un),engines:this._engines}}};var ot;(0,S._)([(0,P.Cb)({constructOnly:!0})],Qe.prototype,"view",void 0),(0,S._)([(0,P.Cb)()],Qe.prototype,"options",void 0),(0,S._)([(0,P.Cb)({readOnly:!0})],Qe.prototype,"updating",null),(0,S._)([(0,P.Cb)()],Qe.prototype,"snappingEnginesFactory",void 0),(0,S._)([(0,P.Cb)()],Qe.prototype,"_engines",void 0),(0,S._)([(0,P.Cb)()],Qe.prototype,"_squaredMouseProximityTreshold",null),(0,S._)([(0,P.Cb)()],Qe.prototype,"_squaredTouchProximityThreshold",null),(0,S._)([(0,P.Cb)()],Qe.prototype,"_squaredSatisfiesConstraintThreshold",null),Qe=(0,S._)([(0,de.j)("esri.views.interactive.snapping.SnappingManager")],Qe),function(l){l[l.MAIN=0]="MAIN",l[l.SCENE=1]="SCENE"}(ot||(ot={}));const un="visualization-handle";function Tr({coordinateHelper:l,elevationInfo:o}){return l.hasZ()?Se.jG:o}const gn=new Map;class Ei{constructor(o){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.editGeometryOperations=o.editGeometryOperations,this.elevationInfo=o.elevationInfo,this.pointer=o.pointer,this.vertexHandle=o.vertexHandle,this.excludeFeature=o.excludeFeature,this.visualizer=o.visualizer,this.selfSnappingZ=o.selfSnappingZ}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}get spatialReference(){return this.coordinateHelper.spatialReference}}var zr=v(53639),fn=v(87091);function Mi(l,[o,c,h]){const p=(0,me.WG)(l);return p.x+=o,p.y+=c,p.hasZ&&(p.z+=h),p}function bn(l,o){return[l.x-o.x,l.y-o.y,l.hasZ&&o.hasZ?l.z-o.z:0]}function Di(l,o,[c,h,p],g){l.x=o.x+c,l.y=o.y+h,g&&l.hasZ&&o.hasZ&&(l.z=o.z+p)}function xi(l){return l}let Ct=class extends B.Z{constructor(l){var o;super(l),o=this,this.constrainResult=c=>c,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=(0,lt.Ds)(function(){var c=(0,G.Z)(function*(h,p,g,f){const _=o._frameTask;if((0,m.Wi)(_))return;const y=yield _.schedule(()=>p.snap({...h,context:g,signal:f}),f);y.valid&&(yield _.schedule(()=>{o.stagedPoint=y.apply(),h!==o._snapPoints&&(0,m.pC)(o._snapPoints)&&(o.stagedPoint=p.update({...o._snapPoints,context:g}))},f))});return function(h,p,g,f){return c.apply(this,arguments)}}())}get stagedPoint(){return this._stagedPoint}set stagedPoint(l){this._stagedPoint=this.constrainResult(l)}initialize(){const l="3d"===this.view.type?this.view?.resourceController?.scheduler:null;this._frameTask=(0,m.pC)(l)?l.registerTask(fn.T8.SNAPPING):fn.sq}destroy(){this._abortController=(0,m.IM)(this._abortController),this._frameTask=(0,m.hw)(this._frameTask)}update(l,o,c){this._snapPoints=l;const{point:h,scenePoint:p}=l,g=o.update({point:h,scenePoint:p,context:c});return this.stagedPoint=g,g}snap(l,o,c){var h=this;return(0,G.Z)(function*(){const{point:p,scenePoint:g}=l;return h.stagedPoint=o.update({point:p,scenePoint:g,context:c}),h._snapPoints=l,(0,m.Wi)(h._abortController)&&(h._abortController=new AbortController),h._snap(l,o,c,h._abortController.signal)})()}resnap(l,o){var c=this;return(0,G.Z)(function*(){(0,m.Wi)(c._snapPoints)||(yield c.snap(c._snapPoints,l,o))})()}abort(){this._abortController=(0,m.IM)(this._abortController),this._snapPoints=null}};(0,S._)([(0,P.Cb)({constructOnly:!0})],Ct.prototype,"view",void 0),(0,S._)([(0,P.Cb)()],Ct.prototype,"stagedPoint",null),(0,S._)([(0,P.Cb)()],Ct.prototype,"constrainResult",void 0),(0,S._)([(0,P.Cb)()],Ct.prototype,"_stagedPoint",void 0),Ct=(0,S._)([(0,de.j)("esri.views.interactive.snapping.SnappingOperation")],Ct);let ze=class extends En.r{constructor(l){super(l),this._stagedDimension=null,this._computationManipulators=new Map,this._computationHandles=new se.Z,this._getSnappingContext=function Ms(l){let o,c,h=[],p=!1;return function g(...f){return p&&o===this&&function Ds(l,o){if(l.length!==o.length)return!1;for(let c=0;c<l.length;++c)if(l[c]!==o[c])return!1;return!0}(f,h)||(c=l.apply(this,f),o=this,h=f,p=!0),c}}(c=>new Ei({elevationInfo:{mode:"absolute-height",offset:0},pointer:c,editGeometryOperations:new sr.c(new ir.XE("point",(0,nr.Y6)(!0,!1,this.view.spatialReference))),visualizer:new Gs})),this._snappingManagerResult=function br(l){if(!gn.has(l)){const h=function ar(l,o){const c=new _i({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:o?.distance??ae.distance,touchSensitivityMultiplier:o?.touchSensitivityMultiplier??ae.touchSensitivityMultiplier});return{...(0,O.YP)(()=>l.map?.allLayers?.toArray()??[],h=>{c.featureSources=new W.Z(h.map(p=>new yi({layer:p,enabled:!0})))},O.nn),options:c}}(l,{distance:10}),p=function Ar(l,o){return new Qe({view:l,options:o,snappingEnginesFactory:(c,h)=>[new at({view:l,spatialReference:l.spatialReference,options:h})]})}(l,h.options);gn.set(l,{referenceCount:0,snappingManager:p,remove:()=>{h.remove(),p.destroy()}})}const o=gn.get(l);o.referenceCount++;const c=(0,Ke.kB)(()=>function Lr(l,o){o.referenceCount--,o.referenceCount>0||(0,rr.Y)(()=>{0===o.referenceCount&&(o.remove(),gn.delete(l))})}(l,o));return{snappingManager:o.snappingManager,...c}}(l.view),this.addHandles(this._snappingManagerResult),this._unfocusedOffsetManipulatorMaterial=Ln(),this._focusedOffsetManipulatorMaterial=Ln(),this._thinOffsetManipulatorMaterial=Ln(),this._thinOffsetManipulatorMaterial.setParameters({stipplePattern:(0,yt.z5)(2)}),this._constraintSnappingIndicator=new vt.r({view:l.view,attached:!0,width:1,color:ce.Z.toUnitRGBA(fe.constraint.color),renderOccluded:ee.yD.OccludeAndTransparent,stipplePattern:(0,yt.z5)(5)});const o=ce.Z.toUnitRGBA(fe.disabledPointIndicator.color);o[3]*=fe.disabledPointIndicator.opacity,this._stagedStartIndicator=new qs({view:l.view,attached:!1,color:o,size:2*fe.disabledPointIndicator.radius,elevationInfo:{mode:"absolute-height",offset:0},spatialReference:l.view.renderCoordsHelper.spatialReference,outlineSize:0,renderOccluded:ee.yD.OccludeAndTransparent})}initialize(){this._snappingOperation=new Ct({view:this.view}),this._orientationManipulatorTexture=(0,Rs.O)(this.view.toolViewManager.textures),this._orientationManipulatorMaterial=new tr.j({transparent:!0,writeDepth:!1,textureId:this._orientationManipulatorTexture.texture.id,renderOccluded:ee.yD.Opaque});const{computations:l}=this.analysisViewData;for(const o of l)this._addComputation(o);this.addHandles([l.on("after-add",o=>this._addComputation(o.item)),l.on("after-remove",o=>this._removeComputation(o.item))]),this.addHandles([(0,O.YP)(()=>({stagedPoint:this._snappingOperation.stagedPoint,stagedComputation:this._stagedComputation}),({stagedPoint:o,stagedComputation:c})=>{if((0,m.Wi)(c)||(0,m.Wi)(o))return;const h=(0,me.WG)(o,new xt.Z);this._applyPointUpdate(c,{endPoint:h})},O.Z_),(0,O.YP)(()=>({stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator}),(o,c)=>{const{stagedDimension:h,selectedComputation:p,firstGrabbedManipulator:g}=o;if(h===c?.stagedDimension&&g===c?.firstGrabbedManipulator){for(const f of[p,c?.selectedComputation])if((0,m.pC)(f)){const _=this._computationManipulators.get(f);this._updateManipulators(f,_,o)}}else for(const[f,_]of this._computationManipulators)this._updateManipulators(f,_,o)},O.tX),(0,O.YP)(()=>this.analysis.style.lineSize,o=>{this._updateManipulatorStyle(o)},O.nn),(0,O.YP)(()=>this.view.state.camera,()=>{(0,m.pC)(this._stagedComputation)&&this._updateStagedDimensionOffset(this._stagedComputation)}),(0,O.YP)(()=>(0,m.yw)(this._stagedComputation,o=>{const c=o.elevationAlignedStartPoint,h=(0,V.c)();return(0,m.pC)(c)&&this.view.renderCoordsHelper.toRenderCoords(c,h)?h:null}),o=>{(0,m.pC)(o)?(this._stagedStartIndicator.vertices=[o],this._stagedStartIndicator.attached=!0):this._stagedStartIndicator.attached=!1})]),this.addHandles(this._constraintHandles),this.addHandles(this._snappingIndicatorHandles),(0,ge.Ob)(this,()=>{const o=this._activeComputation,c=this._stagedComputation;if((0,m.Wi)(o)||(0,m.pC)(c)){const h=(0,m.Pt)(this.view.inputManager.latestPointerType,"mouse"),p=this._getSnappingContext(h);this.updatingHandles.addPromise((0,lt.R8)(this._snappingOperation.resnap(this._snappingManager,p)))}if((0,m.pC)(o)){const{start:h,end:p}=this._computationManipulators.get(o);(h.grabbing||p.grabbing)&&function Os(l,o,{constraint:c,view:h}){const{unconstrainedGeometry:p}=l;if((0,m.Wi)(p))return;const{renderCoordsHelper:g,spatialReference:f}=h,{startRenderSpace:_,endRenderSpace:y}=p.directSegment,C=g.fromRenderCoords(_,new xt.Z,f),M=g.fromRenderCoords(y,new xt.Z,f);let T;T="start"===o?{startPoint:C}:{endPoint:M},ni(l,T,{constraint:c,elevationAlignedStartPoint:l.elevationAlignedStartPoint,elevationAlignedEndPoint:l.elevationAlignedEndPoint,unconstrainedGeometry:p,view:h})}(o,h.grabbing?"start":"end",{constraint:this._computeConstraint(o),view:this.view})}})}destroy(){this._snappingOperation=(0,m.SC)(this._snappingOperation),this._computationHandles.destroy(),this._constraintSnappingIndicator.destroy(),this._stagedStartIndicator.destroy(),this._orientationManipulatorMaterial.dispose(),this._orientationManipulatorTexture.release()}get updating(){return this.updatingHandles.updating||this._snappingManager.updating}get firstGrabbedManipulator(){return this.parentTool.firstGrabbedManipulator}get hasGrabbedManipulators(){return this.parentTool.hasGrabbedManipulators}get snappingOptions(){return this._snappingManager.options}get _snappingManager(){return this._snappingManagerResult.snappingManager}get _activeComputation(){if((0,m.pC)(this._stagedComputation))return this._stagedComputation;const{selectedComputation:l}=this.analysisViewData;return this.hasGrabbedManipulators&&(0,m.pC)(l)?l:null}get _stagedComputation(){const l=this._stagedDimension,o=this.analysisViewData.computations.at(-1);return(0,m.Wi)(l)||(0,m.Wi)(o)||o.dimension!==l?null:o}get _constraintHandles(){return[(0,O.gx)(()=>this.analysisViewData.selectedComputation,l=>{l.previousConstraint=this._computeConstraint(l)},{...O.tX,equals:Mn.fS}),(0,O.YP)(()=>{const l=this._activeComputation;if((0,m.Wi)(l))return null;const{measureType:o,orientation:c}=l.dimension;return{measureType:o,orientation:c,computation:l}},(l,o)=>{if((0,m.pC)(l)&&(0,m.Wi)(o)){const{measureType:c,orientation:h,computation:p}=l;switch(p.previousConstraint){case Ze.Horizontal:p.preConstraintProperties={measureType:I.n.Horizontal,orientation:0};break;case Ze.Vertical:p.preConstraintProperties={measureType:I.n.Vertical,orientation:0};break;case Ze.Direct:p.preConstraintProperties={measureType:I.n.Direct,orientation:h};break;default:p.preConstraintProperties={measureType:c,orientation:h}}}(0,m.Wi)(l)&&(0,m.pC)(o)&&(o.computation.preConstraintProperties=null)},O.Z_)]}get _snappingIndicatorHandles(){const l="snapping-indicator-event-handles";return[(0,O.YP)(()=>({stagedComputation:this._stagedComputation,activeComputation:this._activeComputation}),({stagedComputation:o,activeComputation:c})=>{const h=this._constraintSnappingIndicator;if(this.removeHandles(l),(0,m.Wi)(c))h.attached=!1;else if(c===o)h.attached=!0;else{const{start:p,end:g}=this._computationManipulators.get(c),f=()=>{h.attached=p.grabbing||g.grabbing};f(),this.addHandles([p.events.on("grab-changed",f),g.events.on("grab-changed",f)],l)}}),(0,O.YP)(()=>{const o=this._activeComputation;return(0,m.pC)(o)?{geometry:o.geometry,constraint:o.previousConstraint}:{}},({geometry:o,constraint:c})=>{const h=this._constraintSnappingIndicator;(0,m.pC)(o)&&(0,m.pC)(c)&&c!==Ze.Direct?(h.visible=!0,h.setGeometryFromSegment(o.directSegment)):h.visible=!1})]}removeStaged(){return!!(0,m.pC)(this._stagedDimension)&&(this.analysis.dimensions.remove(this._stagedDimension),this._stagedDimension=null,!0)}onDeactivate(){this.removeStaged(),this._resetSnappingState()}onClick(l){const{_stagedDimension:o}=this;if((0,m.Wi)(o)){const c=this._onUnstagedClick(l);return this.analysis.dimensions.add(c),null}return this._onStagedClick(l),o}onPointerMove({mapPoint:l,pointerType:o}){if("touch"===o)return;const c=this._getSnappingContext(o);this.updatingHandles.addPromise((0,lt.R8)(this._snappingOperation.snap({point:l},this._snappingManager,c)))}onManipulatorSelectionChanged(){(0,m.pC)(this.analysisViewData.selectedComputation)&&(this._computationManipulators.get(this.analysisViewData.selectedComputation).offset.selected||(this.analysisViewData.selectedDimension=null))}_onUnstagedClick({mapPoint:l,pointerType:o}){let c=l;if("mouse"===o){const p=this._getSnappingContext(o);c=this._snappingManager.update({point:l,context:p})}const h=new Es.Z({startPoint:(0,me.WG)(c,new xt.Z),endPoint:null,measureType:I.n.Horizontal});return this._stagedDimension=h,this._resetSnappingState(),h}_onStagedClick({mapPoint:l,pointerType:o}){const c=this._stagedComputation;if((0,m.Wi)(c))return;let h=l;if("mouse"===o){const g=this._getSnappingContext(o);h=this._snappingManager.update({point:l,context:g})}const p=(0,me.WG)(h,new xt.Z);this._applyPointUpdate(c,{endPoint:p}),this._stagedDimension=null,this._resetSnappingState()}_resetSnappingState(){this._snappingManager.doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null}_addComputation(l){if(this._computationManipulators.has(l))return;const o=this._setupPointManipulator(l,{isStart:!0}),c=this._setupPointManipulator(l,{isStart:!1}),h=this._setupOffsetManipulator(l),p=this._setupHeadingManipulator(l),g=this._setupRotationManipulator(l),f=this._setupMeasureTypeManipulator(l,I.n.Direct),_=this._setupMeasureTypeManipulator(l,I.n.Horizontal),y=this._setupMeasureTypeManipulator(l,I.n.Vertical),C=new ns({start:o,end:c,offset:h,heading:p,rotation:g,direct:f,horizontal:_,vertical:y});this._setupComputationToManipulatorsSync(l,C),this._computationManipulators.set(l,C),this.manipulators.addMany(C.values())}_removeComputation(l){const o=this._computationManipulators.get(l);if(!(0,m.Wi)(o)){this._computationHandles.remove(l),this._computationManipulators.delete(l);for(const c of o.values())this.manipulators.remove(c)}}_setupComputationToManipulatorsSync(l,o){this._computationHandles.add([(0,O.YP)(()=>l.geometry,()=>this._updateManipulators(l,o),{...O.tX,equals:Mn.fS})],l)}_setupPointManipulator(l,o){const{view:c}=this,{dimension:h}=l,p=function is(l,o){const c=(0,nt.aD)(l,ce.Z.toUnitRGB(fe.pointManipulators.color),fe.pointManipulators.opacity,it);return c.available=!1,c.grabCursor="crosshair",c.radius=fe.pointManipulators.radius,c.metadata=o.metadata,c.collisionPriority=1,c}(c,{metadata:h}),g=function as(l,{isStart:o,createSnappingPipelineStep:c,dimension:h,onUpdate:p,view:g}){const f=o?"startPoint":"endPoint";return[(0,Je.Xd)(l,(y,C,M,T)=>{const b=(0,Mt.J4)(y),{snappingStep:k,cancelSnapping:oe}=c(T);M=M.next(b).next((0,Je.di)(h,[f,"measureType","orientation"])).next(oe),C.next(b).next((0,Mt.gv)(g)).next(...k).next(he=>{const te=(0,me.WG)(he.mapEnd,new xt.Z);p("startPoint"===f?{startPoint:te}:{endPoint:te})})})]}(p,{isStart:o.isStart,createSnappingPipelineStep:f=>function Vr({predicate:l=(()=>!0),snappingManager:o,snappingContext:c,updatingHandles:h,useZ:p=!0}){const g=new Je.hM;if((0,m.Wi)(o))return{snappingStep:[xi,g],cancelSnapping:xi};let f,_=null,y=null,C=null;const M=()=>{_=(0,m.IM)(_),o.doneSnapping(),(0,m.pC)(y)&&y.frameTask.remove(),y=null,f=(0,m.hw)(f),C=null},T=function Wr(l,o,c){return(0,lt.Ds)(function(){var h=(0,G.Z)(function*({frameTask:p,point:g,scenePoint:f,context:_,event:y,delta:C,getLastState:M},T){const b=yield p.schedule(()=>l.snap({point:g,scenePoint:f,context:_,signal:T}),T);if(b.valid){let k=yield p.schedule(()=>b.apply(),T);const oe=M();(0,m.pC)(oe.point)&&g!==oe.point&&(k=l.update({point:oe.point,scenePoint:oe.scenePoint,context:_})),!(0,m.Wi)(oe.updatePoint)&&(0,zr.k)(k,oe.updatePoint)||(Di(y.mapEnd,k,C,o),c.execute(y))}});return function(p,g){return h.apply(this,arguments)}}())}(o,p,g);let b=null,k=null,oe=null;return{snappingStep:[he=>{if(!l(he))return he;const{action:te}=he;if("start"===te){const{info:Re}=he,zn=function Ir(l){return"3d"===l.type?l.resourceController.scheduler.registerTask(fn.T8.SNAPPING):fn.sq}(o.view);if(y=function Hr(l,o,c){return{context:new Ei({editGeometryOperations:l.editGeometryOperations,elevationInfo:l.elevationInfo,pointer:l.pointer,vertexHandle:(0,m.pC)(o.info)?o.info.handle:null,excludeFeature:l.excludeFeature,visualizer:l.visualizer}),originalPos:(0,m.pC)(o.snapOrigin)?l.coordinateHelper.vectorToDehydratedPoint(o.snapOrigin):o.mapStart,originalScenePos:(0,m.pC)(o.scenePoints)?o.scenePoints.sceneStart:null,frameTask:c}}(c,he,zn),y.context.selfSnappingZ=null,!p&&(0,m.pC)(Re)){const kt=function jr(l,o){if(!l.hasZ())return null;const c=o.vertices;let h=null;for(const p of c){const g=l.getZ(p.pos);if((0,m.pC)(h)&&(0,m.pC)(g)&&Math.abs(g-h)>1e-6)return null;(0,m.Wi)(h)&&(h=g)}return h}(c.coordinateHelper,Re.handle.component);(0,m.pC)(kt)&&(y.context.selfSnappingZ={value:kt,elevationInfo:c.elevationInfo})}}if((0,m.pC)(y)){const{context:Re,originalScenePos:zn,originalPos:kt}=y,{mapEnd:Li,mapStart:Ai,scenePoints:ca}=he,Vn=Mi(kt,bn(Li,Ai)),zi=bn(Ai,kt),ha={...he,action:"update"},pa=y.context,Wn=function Gr(l,o){return(0,m.Wi)(l)||(0,m.Wi)(o)?null:Mi(l,bn(o.sceneEnd,o.sceneStart))}(zn,ca),Vi=o.update({point:Vn,scenePoint:Wn,context:Re});if(oe=Vi,Di(Li,Vi,zi,p),b=Vn,k=Wn,"end"!==te){const{frameTask:ua}=y;(0,m.Wi)(_)&&(_=new AbortController),C=ga=>{h.addPromise((0,lt.R8)(T({frameTask:ua,event:ha,context:pa,point:Vn,scenePoint:Wn,delta:zi,getLastState:()=>({point:b,scenePoint:k,updatePoint:ga.forceUpdate?null:oe})},(0,m.Wg)(_).signal)))},C({forceUpdate:!1}),(0,m.Wi)(f)&&(f=(0,O.YP)(()=>o.options.effectiveEnabled,()=>C?.({forceUpdate:!0})))}}return"end"===te&&M(),he},g],cancelSnapping:he=>(M(),he)}}({snappingContext:this._getSnappingContext(f),snappingManager:this._snappingManager,updatingHandles:this.updatingHandles}),dimension:h,onUpdate:f=>this._applyPointUpdate(l,f),view:c});return this._computationHandles.add(g,l),p}_setupOffsetManipulator(l){const{view:o}=this,c=function ss(l,o){const c=[(0,V.f)(-.5,0,0),(0,V.f)(.5,0,0)],{lengthFraction:h}=fe.offsetManipulator,p=(0,gt.rh)(o.unfocusedMaterial,c.map(f=>(0,x.g)((0,V.c)(),f,h))),g=p.instantiate({material:o.focusedMaterial});return new Zn.Z({view:l,renderObjects:[new Gt.r(p,Dt.Q9.Unfocused|Dt.Q9.Selected|it),new Gt.r(g,Dt.Q9.Focused|it)],collisionType:{type:"line",paths:[c]},radius:Cn(o.lineSizePt)/2,metadata:o.metadata,available:!1,...nt.X9})}(o,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,metadata:l.dimension}),h=function os(l,{computation:o,view:c}){return[(0,Je.Xd)(l,(h,p,g)=>{if(!Ht(o)||!h.selected)return;const{geometry:f,dimension:_}=o,y=(0,Mt.J4)(h);p.next(y).next($n(c,_,f.dimensionSegment,f.primaryOffsetAxis)),g.next(y).next((0,Je.di)(_,["offset"]))})]}(c,{computation:l,view:o});return this._computationHandles.add(h,l),c}_setupHeadingManipulator(l){const{view:o}=this,c=Kn(o,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:l.dimension}),h=function ls(l,{computation:o,view:c}){return[(0,Je.Xd)(l,(h,p,g)=>{Xn({cancel:g,computation:o,settingHeading:!0,steps:p,view:c})})]}(c,{computation:l,view:o});return this._computationHandles.add(h,l),c}_setupRotationManipulator(l){const{view:o}=this,c=Kn(o,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:l.dimension}),h=function ds(l,{computation:o,view:c}){return[(0,Je.Xd)(l,(h,p,g)=>{Xn({cancel:g,computation:o,settingHeading:!1,steps:p,view:c})}),l.events.on("immediate-click",h=>{!function cs(l,o,c){const{dimension:h,geometry:p}=o;if(90===h.orientation||270===h.orientation)return h.orientation=0,void l.stopPropagation();if((0,m.Wi)(p))return;const{renderCoordsHelper:g}=c,f=$t({...Xt(o),orientation:90},g),_=$t({...Xt(o),orientation:270},g);if((0,m.Wi)(f)||(0,m.Wi)(_))return;const y=_n(f,g),C=_n(_,g),M=Qn(p,c),T=Sn.BV.shortestSignedDiff(M,y),b=Sn.BV.shortestSignedDiff(M,C);h.orientation=Math.abs(T)<Math.abs(b)?90:270,l.stopPropagation()}(h,o,c)})]}(c,{computation:l,view:o});return this._computationHandles.add(h,l),c}_setupMeasureTypeManipulator(l,o){const{view:c}=this,h=function rs(l,o){const c=[(0,V.f)(-.5,0,0),(0,V.f)(.5,0,0)],{lengthFraction:h}=fe.offsetManipulator,p=(0,gt.rh)(o.thinOffsetManipulatorMaterial,c),g=(0,gt.rh)(o.unfocusedMaterial,c.map(_=>(0,x.g)((0,V.c)(),_,h))),f=g.instantiate({material:o.focusedMaterial});return new Zn.Z({view:l,renderObjects:[new Gt.r(g,Dt.Q9.Unfocused|it),new Gt.r(f,Dt.Q9.Focused|it),new Gt.r(p,it)],collisionType:{type:"line",paths:[c]},radius:Cn(o.lineSizePt)/2,available:!1,metadata:o.metadata,...nt.X9})}(c,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,thinOffsetManipulatorMaterial:this._thinOffsetManipulatorMaterial,metadata:l.dimension}),p=function ps(l,{computation:o,manipulatorMeasureType:c,view:h}){let p=I.n.Direct,g=0,f=0;return[l.events.on("grab-changed",_=>{if("start"!==_.action||!Ht(o))return;const{dimension:y,geometry:C}=o;p=y.measureType,g=y.offset,f=y.orientation;const M=(0,x.c)(Z.WM.get(),l.renderLocation);y.measureType=c,y.offset=function Fi(l,o,c,h){const{directSegment:p}=c,g=Qt(Z.WM.get(),{measureType:o,directSegment:p,renderCoordsHelper:h}),f=jn(Ui,{offsetAxis:g,offset:0,relativeToSegment:p,renderCoordsHelper:h}).eval(.5,Z.WM.get()),_=(0,x.w)(Z.WM.get(),l,f);return(0,x.e)(_,g)*h.unitInMeters}(M,c,C,h.renderCoordsHelper),y.orientation=0}),(0,Je.Xd)(l,(_,y,C)=>{if(!Ht(o))return;const{geometry:M,dimension:T}=o,{renderCoordsHelper:b}=h,k=Hn(ti,c,o,b),oe=Qt(Z.WM.get(),{measureType:c,directSegment:M.directSegment,renderCoordsHelper:b}),he=(0,Mt.J4)(_);y.next(he).next($n(h,T,k,oe)),C.next(he).next(te=>(T.measureType=p,T.offset=g,T.orientation=f,te))})]}(h,{computation:l,manipulatorMeasureType:o,view:c});return this._computationHandles.add(p,l),h}_updateManipulators(l,o,c={stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator}){const{stagedDimension:h,selectedComputation:p,firstGrabbedManipulator:g}=c,{start:f,end:_,offset:y,heading:C,rotation:M}=o,T=p===l,b=Ht(l),{dimension:k}=l;for(const te of o.values()){const Re=b&&(0,m.Wi)(h)&&((0,m.Wi)(g)||te===g);te===y?(te.available=Re,te.selected=T):te.available=Re&&T}if(!b)return;(0,m.pC)(this._computeConstraint(l))?o.forEachMeasureTypeManipulator(te=>te.available=!1):o.manipulatorForMeasureType(k.measureType).available=!1;for(const te of[C,M])k.measureType===I.n.Direct&&0!==k.offset||(te.available=!1);mn(l)?M.available=!1:C.available=!1;const{geometry:oe}=l;f.renderLocation=oe.directSegment.startRenderSpace,_.renderLocation=oe.directSegment.endRenderSpace;const{renderCoordsHelper:he}=this.view;(function us(l,o,c){const{dimensionSegment:h,primaryOffsetAxis:p}=o,g=yn(jt,o),f=(0,x.k)(g,V.Z)?(0,ie.i)(en):(0,nt.Aq)(g,p,V.Z,en),_=Math.max((0,x.l)(g),fe.offsetManipulator.minLengthMeters/c.unitInMeters);(0,ie.k)(f,f,(0,x.s)(jt,_,_,_)),l.modelTransform=f,l.renderLocation=h.eval(.5,jt)})(y,oe,he),C.available&&function gs(l,o,c){Jn(l,o,c,{forHeading:!0})}(C,l,he),M.available&&function fs(l,o,c){Jn(l,o,c,{forHeading:!1})}(M,l,he),o.forEachMeasureTypeManipulator((te,Re)=>{te.available&&function ys(l,o,c,h){const{geometry:p}=o,g=Hn(ti,c,o,h),f=Qt(jt,{measureType:c,directSegment:p.directSegment,renderCoordsHelper:h}),_=(0,x.w)(Pn,g.endRenderSpace,g.startRenderSpace),y=(0,nt.Aq)(_,f,V.Z,en),C=(0,x.l)(_);(0,ie.k)(y,y,(0,x.s)(Pn,C,C,C)),l.modelTransform=y,l.renderLocation=g.eval(.5,Pn)}(te,l,Re,he)})}_updateManipulatorStyle(l){const o=function Ps(l){return(0,We.F2)(l)+fe.offsetManipulator.linePaddingPx}(l),c=Cn(l),h={lineSizePt:l,material:this._orientationManipulatorMaterial};for(const{offset:p,heading:g,rotation:f}of this._computationManipulators.values())p.radius=c/2,Yn(g,h),Yn(f,h);this._unfocusedOffsetManipulatorMaterial.setParameters({width:o}),this._focusedOffsetManipulatorMaterial.setParameters({width:c})}_applyPointUpdate(l,o){const{view:c}=this,h=Xt(l);"startPoint"in o&&(h.elevationAlignedStartPoint=o.startPoint),"endPoint"in o&&(h.elevationAlignedEndPoint=o.endPoint);const p=$t(h,c.renderCoordsHelper);if((0,m.Wi)(p))return;const g=this._computeConstraint({...h,geometry:p});ni(l,o,{...h,constraint:g,unconstrainedGeometry:p,view:c}),l===this._stagedComputation&&this._updateStagedDimensionOffset(l)}_updateStagedDimensionOffset(l){if((0,m.Wi)(l.geometry))return;l.geometry.directSegment.eval(.5,wi);const o=this.view.state.camera.computeRenderPixelSizeAt(wi);l.dimension.offset=fe.initialOffsetPx*o}_computeConstraint(l){return function ws(l,o){if(Fn(l))return Ze.Direct;if(!l.enabled)return null;const{geometry:c}=l;if((0,m.Wi)(c)||(0,x.k)(c.directSegment.startRenderSpace,c.directSegment.endRenderSpace))return null;const{constraintThresholdPx:h}=fe,{camera:p}=o.state,g=qt(Z.WM.get(),c,o.renderCoordsHelper),f=vn(Z.WM.get(),c),_=(0,x.g)(Z.WM.get(),g,(0,x.e)(f,g)),y=(0,x.b)(Z.WM.get(),f,_),C=(0,x.p)(y),M=(0,x.p)(_),{startRenderSpace:T,endRenderSpace:b}=c.directSegment,k=Math.max(p.computeRenderPixelSizeAt(T)*h,p.computeRenderPixelSizeAt(b)*h)**2;return C<k?Ze.Vertical:M<k?Ze.Horizontal:null}(function xs(l,o){return{enabled:o.effectiveFeatureEnabled,elevationAlignedStartPoint:l.elevationAlignedStartPoint,elevationAlignedEndPoint:l.elevationAlignedEndPoint,geometry:l.geometry}}(l,this._snappingManager.options),this.view)}get testInfo(){const l=o=>this.analysisViewData.computations.find(c=>c.dimension===o);return{disableManipulatorPartialOcclusion:()=>{this._stagedStartIndicator.renderOccluded=ee.yD.Occlude,this.manipulators.forEach(({manipulator:o})=>{for(const{geometry:c}of o.renderObjects)c.material.setParameters({renderOccluded:ee.yD.Occlude})})},getManipulatorsForDimension:o=>this._computationManipulators.get(l(o)),getComputationForDimension:o=>l(o),getConstraintForDimension:o=>{const c=l(o);return(0,m.pC)(c)?this._computeConstraint(c):null},stagedDimension:this._stagedDimension,stagedStartIndicator:this._stagedStartIndicator,constraintSnappingIndicator:this._constraintSnappingIndicator,snappingManager:this._snappingManager}}};function Ln(){const{color:l,opacity:o}=fe.offsetManipulator;return new rt.U({color:[...ce.Z.toUnitRGB(l),o],width:1,renderOccluded:ee.yD.OccludeAndTransparent,writeDepth:!1,hasPolygonOffset:!0})}(0,S._)([(0,P.Cb)({constructOnly:!0})],ze.prototype,"analysis",void 0),(0,S._)([(0,P.Cb)({constructOnly:!0})],ze.prototype,"analysisViewData",void 0),(0,S._)([(0,P.Cb)({constructOnly:!0})],ze.prototype,"manipulators",void 0),(0,S._)([(0,P.Cb)({constructOnly:!0})],ze.prototype,"parentTool",void 0),(0,S._)([(0,P.Cb)({constructOnly:!0,nonNullable:!0})],ze.prototype,"view",void 0),(0,S._)([(0,P.Cb)({readOnly:!0})],ze.prototype,"updating",null),(0,S._)([(0,P.Cb)()],ze.prototype,"firstGrabbedManipulator",null),(0,S._)([(0,P.Cb)()],ze.prototype,"hasGrabbedManipulators",null),(0,S._)([(0,P.Cb)()],ze.prototype,"snappingOptions",null),(0,S._)([(0,P.Cb)()],ze.prototype,"_stagedDimension",void 0),(0,S._)([(0,P.Cb)()],ze.prototype,"_activeComputation",null),(0,S._)([(0,P.Cb)()],ze.prototype,"_stagedComputation",null),ze=(0,S._)([(0,de.j)("esri.views.3d.analysis.Dimension.LengthDimensionSubTool")],ze);const wi=(0,V.c)();var Wt,Fr=v(62483),Ur=v(67857),Nr=v(58997),Oi=v(72791),Zr=v(41900);!function(l){l.Ready="ready",l.Creating="creating",l.Created="created"}(Wt||(Wt={}));let Fe=class extends Nr.f{constructor(l){super(l),this.automaticManipulatorSelection=!1,this.removeIncompleteOnCancel=!1,this._pointerMoveTimerMs=fe.pointerMoveTimeoutMs,this._prevPointerMoveTimeout=null}initialize(){this._intersector=(0,Fr.Z8)(this.view.state.viewingMode),this._intersector.options.store=Ur.eC.MIN,this._lengthDimensionSubTool=new ze({analysis:this.analysis,analysisViewData:this.analysisViewData,manipulators:this.manipulators,parentTool:this,view:this.view}),this.addHandles([(0,Ke.ed)(this._lengthDimensionSubTool),(0,Ke.kB)(()=>this._clearPointerMoveTimeout()),(0,O.YP)(()=>this.state,l=>{l===Wt.Created&&this.finishToolCreation()},O.tX),(0,O.gx)(()=>this.firstGrabbedManipulator,l=>{this.selectedDimension=l.metadata},O.tX),(0,O.YP)(()=>this.selectedDimension,()=>this._resetPointerMoveTimeout(),O.tX)])}get state(){return this.analysis.dimensions.some(l=>"length"===l.type)?(0,m.pC)(this._activeSubTool)?Wt.Creating:Wt.Created:Wt.Ready}get updating(){return this._lengthDimensionSubTool.updating}get cursor(){return this.active?"crosshair":null}get selectedDimension(){return this.analysisViewData.selectedDimension}set selectedDimension(l){this.analysisViewData.selectedDimension=l}onInputEvent(l){switch(l.type){case"immediate-click":this._clickHandler(l);break;case"immediate-double-click":this._doubleClickHandler(l);break;case"pointer-move":this._pointerMoveHandler(l);break;case"key-down":if(Oi.j.cancel===l.key){if((0,m.pC)(this._activeSubTool)&&this._activeSubTool.removeStaged())return void l.stopPropagation();this.active||(this.selectedDimension=null)}else Oi.j.delete.includes(l.key)&&this._deleteKeyHandler()}}onActivate(){this._activeSubTool=this._lengthDimensionSubTool}onDeactivate(){(0,m.pC)(this._activeSubTool)&&(this._activeSubTool.onDeactivate(),this._activeSubTool=null)}onShow(){this._resetPointerMoveTimeout()}onManipulatorSelectionChanged(){this._lengthDimensionSubTool.onManipulatorSelectionChanged()}onHide(){this.selectedDimension=null}_clickHandler(l){if(this.hasFocusedManipulators)return void l.stopPropagation();if((0,m.Wi)(this._activeSubTool))return;const o=this._intersectScreen(l);(0,m.Wi)(o)||(this.selectedDimension=this._activeSubTool.onClick({mapPoint:o,pointerType:l.pointerType}),l.stopPropagation())}_doubleClickHandler(l){this.active&&(this.view.activeTool=null,l.stopPropagation())}_pointerMoveHandler(l){if(this._resetPointerMoveTimeout(),(0,m.Wi)(this._activeSubTool)||this.hasFocusedManipulators)return;const o=this._intersectScreen(l);(0,m.Wi)(o)||this._activeSubTool.onPointerMove({mapPoint:o,pointerType:l.pointerType})}_deleteKeyHandler(){(0,m.pC)(this._activeSubTool)&&this._activeSubTool.removeStaged(),this._removeSelected()}_intersectScreen(l){const o=(0,Zr.Sj)(l);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(o,this._intersector);const c=this._intersector.results.min,h=Z.WM.get();return c.getIntersectionPoint(h)?this.view.renderCoordsHelper.fromRenderCoords(h,this.view.spatialReference):null}_removeSelected(){(0,m.pC)(this.selectedDimension)&&(this.analysis.dimensions.remove(this.selectedDimension),this.selectedDimension=null)}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=(0,m.hw)(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.manipulators.forEach(l=>{l.manipulator.state|=it}),this._prevPointerMoveTimeout=ki.m.setTimeout(()=>{this.manipulators.forEach(l=>{l.manipulator.state&=~it})},this._pointerMoveTimerMs)}get testInfo(){return{...this._lengthDimensionSubTool.testInfo,setManipulatorAutoHideDelay:l=>{this._pointerMoveTimerMs=l,this._resetPointerMoveTimeout()}}}};(0,S._)([(0,P.Cb)({constructOnly:!0})],Fe.prototype,"view",void 0),(0,S._)([(0,P.Cb)({constructOnly:!0})],Fe.prototype,"analysis",void 0),(0,S._)([(0,P.Cb)({readOnly:!0})],Fe.prototype,"state",null),(0,S._)([(0,P.Cb)({readOnly:!0})],Fe.prototype,"updating",null),(0,S._)([(0,P.Cb)({readOnly:!0})],Fe.prototype,"cursor",null),(0,S._)([(0,P.Cb)({constructOnly:!0})],Fe.prototype,"analysisViewData",void 0),(0,S._)([(0,P.Cb)()],Fe.prototype,"selectedDimension",null),(0,S._)([(0,P.Cb)()],Fe.prototype,"automaticManipulatorSelection",void 0),(0,S._)([(0,P.Cb)()],Fe.prototype,"_activeSubTool",void 0),(0,S._)([(0,P.Cb)()],Fe.prototype,"_lengthDimensionSubTool",void 0),Fe=(0,S._)([(0,de.j)("esri.views.3d.analysis.Dimension.DimensionTool")],Fe),v(52515);var Br=v(84600),kr=v(68063),Ri=v(79020),Ti=v(70591);class Kr extends ui._{constructor(o,c){super(o),this._hasExternalMaterial=!1,this._renderOccluded=ee.yD.OccludeAndTransparent,this._width=1,this._color=(0,wt.f)(1,0,1,1),this._placement="end",this._textureId=null,this._material=c,this._hasExternalMaterial=(0,m.pC)(c),this.applyProps(o)}setGeometryFromSegment(o,c){const h=o.endRenderSpace;this.transform=(0,ie.f)(Yr,h),this._normal=c;const{points:p}=o.createRenderGeometry(h,this.view.renderCoordsHelper);this.geometry=[p]}get renderOccluded(){return(0,m.pC)(this._material)?this._material.parameters.renderOccluded:this._renderOccluded}set renderOccluded(o){this._renderOccluded=o,(0,m.pC)(this._material)&&this._material.setParameters({renderOccluded:o})}get geometry(){return this._geometry}set geometry(o){this._geometry=o,this.recreateGeometry()}get normal(){return this._normal}set normal(o){this._normal=o,this.recreateGeometry()}get width(){return(0,m.pC)(this._material)?this._material.parameters.width:this._width}set width(o){this._width=o,(0,m.pC)(this._material)&&this._material.setParameters({width:o})}get color(){return(0,m.pC)(this._material)?this._material.parameters.color:this._color}set color(o){this._color=(0,wt.c)(o),(0,m.pC)(this._material)&&this._material.setParameters({color:this._color})}get placement(){return(0,m.pC)(this._material)?this._material.parameters.placement:this._placement}set placement(o){this._placement=o,(0,m.pC)(this._material)&&this._material.setParameters({placement:this._placement})}get textureId(){return(0,m.pC)(this._material)?this._material.parameters.textureId:this._textureId}set textureId(o){this._textureId=o,(0,m.pC)(this._material)&&this._material.setParameters({textureId:o})}createExternalResources(){this._hasExternalMaterial||(this._material=new Ti.X({width:this._width,color:this._color,placement:this._placement,renderOccluded:this._renderOccluded,textureId:this._textureId}))}destroyExternalResources(){this._hasExternalMaterial||(this._material=null)}createGeometries(o){for(const c of(0,Ri.c)(this.geometry,this.normal)){const h=(0,Ri.Y)((0,m.Wg)(this._material),c);o.addGeometry(h)}}forEachExternalMaterial(o){this._hasExternalMaterial||o((0,m.Wg)(this._material))}}const Yr=(0,ye.c)();class Xr{set visible(o){for(const c of this._visualElements.values())c.attached=o}constructor(o){this.destroyed=!1,this._handles=new se.Z,this._messages=null,this._labelSegment=new Ce.y;const{analysis:c,computation:h,view:p,messages:g}=o;this.analysis=c,this.computation=h,this.view=p,this._messages=g;const f=o.visible,_={view:p,attached:f},{fontSize:y,textColor:C,textBackgroundColor:M}=c.style;this._visualElements=new ea({marker:new Kr(_,o.markerMaterial),dimension:new vt.r(_,o.dimensionLineMaterial),startOffset:new vt.r(_,o.offsetLineMaterial),endOffset:new vt.r(_,o.offsetLineMaterial),dimensionSmall:new vt.r(_,o.smallDimensionLineMaterial),startOffsetSmall:new vt.r(_,o.smallOffsetLineMaterial),endOffsetSmall:new vt.r(_,o.smallOffsetLineMaterial),label:new kr.Kc({view:p,attached:f,distance:0,geometry:{type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1},fontSize:(0,We.F2)(y),textColor:C.clone(),backgroundColor:M.clone()})}),this._handles.add([(0,O.YP)(()=>h.geometry,T=>{this.updateCameraDependentElements(p.state.camera,T,c.style),(0,m.pC)(h.geometry)&&this._updateLines(h.geometry)},{...O.nn,equals:Mn.fS}),(0,O.YP)(()=>h.length,T=>this._updateLabelContent(T),O.nn)])}destroy(){this.destroyed=!0,this._handles=(0,m.SC)(this._handles);for(const o of this._visualElements.values())o.destroy()}get testInfo(){return{dimensionVisualElement:this._visualElements.dimension,label:this._visualElements.label}}_updateLines(o){const c=In(Qr,It.Start,o.directSegment,o.dimensionSegment),h=In(Jr,It.End,o.directSegment,o.dimensionSegment),p=this._visualElements;p.marker.setGeometryFromSegment(o.dimensionSegment,o.primaryOffsetAxis),p.dimension.setGeometryFromSegment(o.dimensionSegment),p.startOffset.setGeometryFromSegment(c),p.endOffset.setGeometryFromSegment(h),p.dimensionSmall.setGeometryFromSegment(o.dimensionSegment),p.startOffsetSmall.setGeometryFromSegment(c),p.endOffsetSmall.setGeometryFromSegment(h)}updateCameraDependentElements(o,c,h){const p=this._visualElements;if((0,m.Wi)(c)){for(const he of p.values())he.visible=!1;return}const g=o.computeScreenPixelSizeAt(c.dimensionSegment.eval(.5,qr)),f=function Zi(l,o){return(0,x.p)(yn(Bi,l))/o**2}(c,g),_=f<((0,We.F2)(h.lineSize)*fe.smallScreenLengthLineSizeFactor)**2,y=!_;p.marker.visible=y,p.dimension.visible=y,p.startOffset.visible=y,p.endOffset.visible=y,p.dimensionSmall.visible=_,p.startOffsetSmall.visible=_,p.endOffsetSmall.visible=_;const C=(0,We.F2)(h.fontSize)*fe.labels.minScreenLengthFontSizeFactor,{label:M}=p;if(M.visible=f>=C**2,!M.visible)return;const{dimensionSegment:T,primaryOffsetAxis:b}=c,{offset:k}=this.computation.dimension,oe=(Math.sign(k)>=0?1:-1)*function $r(l){return 1.5*(0,We.F2)(l.fontSize)+fe.labels.marginPx+(0,We.F2)(l.lineSize/2)}(h)*g;(function Ii(l,o,c,h){(0,x.z)(l.startRenderSpace,o.startRenderSpace,c,h),(0,x.z)(l.endRenderSpace,o.endRenderSpace,c,h)})(this._labelSegment,T,b,oe),M.updateLabelPosition()}updateLabelStyle(o){const{label:c}=this._visualElements;c.fontSize=(0,We.F2)(o.fontSize),c.textColor=o.textColor,c.backgroundColor=o.textBackgroundColor}updateUnitsMessages(o){this._messages=o;const{length:c}=this.computation;this._updateLabelContent(c)}_updateLabelContent(o){const{label:c}=this._visualElements;c.text=(0,m.Wi)(o)||(0,m.Wi)(this._messages)?"":(0,Br.VG)(this._messages,o,o.unit)}}const Qr=new Ce.y,Jr=new Ce.y,qr=(0,V.c)();class ea{constructor(o){this.marker=o.marker,this.dimension=o.dimension,this.startOffset=o.startOffset,this.endOffset=o.endOffset,this.dimensionSmall=o.dimensionSmall,this.startOffsetSmall=o.startOffsetSmall,this.endOffsetSmall=o.endOffsetSmall,this.label=o.label}values(){return[this.marker,this.dimension,this.startOffset,this.endOffset,this.dimensionSmall,this.startOffsetSmall,this.endOffsetSmall,this.label]}}var ta=v(52051);class na{constructor(o,c){this._textures=o,this._textureRepository=c,this._texturesByPrimitive=new Map}acquire(o){if(!this._texturesByPrimitive.has(o)){const c=(0,Bn.uM)(this._textures,o),h=new ta.T(this._textureRepository,c.texture.id);return this._texturesByPrimitive.set(o,{result:c,reference:h}),c.texture}return this._texturesByPrimitive.get(o).result.texture}destroy(){this._texturesByPrimitive.forEach(({result:o,reference:c})=>{c.dispose(),o.release()}),this._texturesByPrimitive.clear()}}var ia=v(46359),sa=v(56683),ra=v(41840);let ht=class extends B.Z{get analysis(){return this.analysisViewData.analysis}get visible(){return this.analysisViewData.visible}constructor(l){super(l),this.loadingMessages=!1,this._messages=null,this._dimensionVisualizations=new Map,this._markerMaterial=new Ti.X({width:1,anchor:ia.i5.Tip,color:Tt.Z,placement:"begin-end",worldSpace:!0,hideOnShortSegments:!0,hasTip:!0,renderOccluded:ee.yD.OccludeAndTransparent}),this._dimensionLineMaterial=new rt.U({width:1,color:Tt.Z,renderOccluded:ee.yD.OccludeAndTransparent,markerParameters:this._markerMaterial.parameters}),this._offsetLineMaterial=new rt.U({width:1,color:Tt.Z,renderOccluded:ee.yD.OccludeAndTransparent,stipplePattern:(0,yt.z5)(5),stippleScaleWithLineWidth:!0}),this._smallDimensionLineMaterial=new rt.U({width:1,color:Tt.Z,renderOccluded:ee.yD.OccludeAndTransparent}),this._smallOffsetLineMaterial=new rt.U({width:1,color:Tt.Z,renderOccluded:ee.yD.OccludeAndTransparent,stipplePattern:(0,yt.z5)(5),stippleScaleWithLineWidth:!0})}initialize(){const l=this.view.sharedSymbolResources?.textures;if((0,m.pC)(l)){const{textureRepository:c}=this.view._stage.renderView,h=new na(l,c),p=h.acquire("triangle");this.addHandles((0,Ke.kB)(()=>h.destroy())),this._markerMaterial.setParameters({textureId:p.id})}for(const c of this._lineMaterials())this.view._stage.add(c),this.addHandles((0,Ke.kB)(()=>{this.view._stage.remove(c),c.dispose()}));const{computations:o}=this.analysisViewData;for(const c of o)this._addComputation(c);this.addHandles([o.on("change",({added:c,removed:h})=>{for(const p of h)this._removeComputation(p);for(const p of c)this._addComputation(p)}),(0,O.YP)(()=>ce.Z.toUnitRGBA(this.analysis.style.color),c=>{for(const h of this._lineMaterials())h.setParameters({color:c})},O.tX),(0,O.YP)(()=>this.analysis.style.lineSize,c=>{const h=(0,We.F2)(c);this._markerMaterial.setParameters({width:h*fe.markers.lineSizeFraction}),this._dimensionLineMaterial.setParameters({width:h,markerParameters:this._markerMaterial.parameters});const p=Math.max(h*fe.offsetLine.lineSizeFraction,1);this._offsetLineMaterial.setParameters({width:p})},O.tX),(0,O.YP)(()=>({camera:this.view.state.camera,style:aa(this.analysis)}),({camera:c,style:h})=>{for(const[p,g]of this._dimensionVisualizations)g.updateCameraDependentElements(c,p.geometry,h),g.updateLabelStyle(h)}),(0,O.YP)(()=>this.visible,c=>{for(const h of this._dimensionVisualizations.values())h.visible=c})]),this.addHandles([(0,sa.qe)(()=>this._updateMessageBundle()),(0,O.gx)(()=>!this.loadingMessages,()=>{for(const c of this._dimensionVisualizations.values())c.updateUnitsMessages(this._messages)},O.Z_)]),this._updateMessageBundle()}destroy(){this._dimensionVisualizations.forEach(l=>{l.destroy()}),this._dimensionVisualizations.clear()}get testInfo(){return{visualizations:Array.from(this._dimensionVisualizations.values()),disablePartialOcclusion:()=>{for(const l of this._lineMaterials())l.setParameters({renderOccluded:ee.yD.Occlude})}}}_addComputation(l){this._dimensionVisualizations.has(l)||this._dimensionVisualizations.set(l,new Xr({analysis:this.analysis,computation:l,view:this.view,visible:this.visible,markerMaterial:this._markerMaterial,dimensionLineMaterial:this._dimensionLineMaterial,offsetLineMaterial:this._offsetLineMaterial,smallDimensionLineMaterial:this._smallDimensionLineMaterial,smallOffsetLineMaterial:this._smallOffsetLineMaterial,messages:this._messages}))}_removeComputation(l){const o=this._dimensionVisualizations.get(l);(0,m.Wi)(o)||(o.destroy(),this._dimensionVisualizations.delete(l))}_lineMaterials(){return[this._markerMaterial,this._dimensionLineMaterial,this._offsetLineMaterial,this._smallDimensionLineMaterial,this._smallOffsetLineMaterial]}_updateMessageBundle(){var l=this;return(0,G.Z)(function*(){l.loadingMessages=!0;try{l._messages=yield(0,ra.ME)("esri/core/t9n/Units")}finally{l.loadingMessages=!1}})()}};function aa(l){const{fontSize:o,lineSize:c,textColor:h,textBackgroundColor:p}=l.style;return{fontSize:o,lineSize:c,textBackgroundColor:p.clone(),textColor:h.clone()}}(0,S._)([(0,P.Cb)({constructOnly:!0})],ht.prototype,"analysisViewData",void 0),(0,S._)([(0,P.Cb)({constructOnly:!0,nonNullable:!0})],ht.prototype,"view",void 0),(0,S._)([(0,P.Cb)()],ht.prototype,"analysis",null),(0,S._)([(0,P.Cb)()],ht.prototype,"visible",null),(0,S._)([(0,P.Cb)()],ht.prototype,"loadingMessages",void 0),ht=(0,S._)([(0,de.j)("esri.views.3d.analysis.Dimension.DimensionVisualization")],ht);let Bt=class extends B.Z{constructor(l){super(l),this.dimension=null,this.length=null}};(0,S._)([(0,P.Cb)({constructOnly:!0,nonNullable:!0})],Bt.prototype,"dimension",void 0),(0,S._)([(0,P.Cb)()],Bt.prototype,"length",void 0),Bt=(0,S._)([(0,de.j)("esri.views.3d.analysis.LengthDimensionResult")],Bt);const oa=Bt;let Ue=class extends B.Z{constructor(l){super(l),this.geometry=null,this.unconstrainedGeometry=null,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}normalizeCtorArgs(l){const{dimension:o,...c}=l;return{result:new oa({dimension:o}),...c}}initialize(){this.addHandles([(0,O.YP)(()=>this.dimension.startPoint,l=>this.elevationAlignedStartPoint=this.projectAndAlignPoint(l),O.tX),(0,O.YP)(()=>this.dimension.endPoint,l=>this.elevationAlignedEndPoint=this.projectAndAlignPoint(l),O.tX)])}get dimension(){return this.result.dimension}get length(){return this.result.length}};(0,S._)([(0,P.Cb)({constructOnly:!0,nonNullable:!0})],Ue.prototype,"result",void 0),(0,S._)([(0,P.Cb)({constructOnly:!0,nonNullable:!0})],Ue.prototype,"projectAndAlignPoint",void 0),(0,S._)([(0,P.Cb)()],Ue.prototype,"dimension",null),(0,S._)([(0,P.Cb)()],Ue.prototype,"length",null),(0,S._)([(0,P.Cb)()],Ue.prototype,"geometry",void 0),(0,S._)([(0,P.Cb)()],Ue.prototype,"unconstrainedGeometry",void 0),(0,S._)([(0,P.Cb)()],Ue.prototype,"elevationAlignedStartPoint",void 0),(0,S._)([(0,P.Cb)()],Ue.prototype,"elevationAlignedEndPoint",void 0),(0,S._)([(0,P.Cb)()],Ue.prototype,"preConstraintProperties",void 0),(0,S._)([(0,P.Cb)()],Ue.prototype,"previousConstraint",void 0),Ue=(0,S._)([(0,de.j)("esri.views.3d.analysis.LengthDimensionComputation")],Ue);var bi=v(54865),An=v(95925);const la=l=>{let o=class extends l{constructor(...c){super(...c),this.analysis=null,this.tool=null,this.selectedDimension=null,this.interactive=!1,this.visible=null}get results(){return new W.Z}createLengthDimensions(c){throw new Error("Method not implemented.")}};return(0,S._)([(0,P.Cb)({constructOnly:!0})],o.prototype,"view",void 0),(0,S._)([(0,P.Cb)({constructOnly:!0,nonNullable:!0})],o.prototype,"analysis",void 0),(0,S._)([(0,P.Cb)()],o.prototype,"tool",void 0),(0,S._)([(0,P.Cb)({readOnly:!0})],o.prototype,"results",null),(0,S._)([(0,P.Cb)()],o.prototype,"selectedDimension",void 0),(0,S._)([(0,P.Cb)()],o.prototype,"interactive",void 0),(0,S._)([(0,P.Cb)()],o.prototype,"visible",void 0),o=(0,S._)([(0,de.j)("esri.views.analysis.DimensionAnalysisView")],o),o};let Ie=class extends(la((0,Ne.p)(B.Z))){constructor(l){super(l),this.type="dimension-view-3d",this.tool=null,this.computations=new W.Z,this.selectedDimension=null,this._dimensionsToComputations=new Map,this._placementTask=null,this._projectAndAlignPoint=null}initialize(){this._projectAndAlignPoint=l=>{if((0,m.Wi)(l))return null;const{spatialReference:o,elevationProvider:c}=this.view,h=(0,bi.G)(l,o,c);return(0,m.Wi)(h)&&(0,bi.e)(this.analysis,l.spatialReference,U.Z.getLogger(this.declaredClass)),h},this.addHandles([(0,An.Lp)(this,Fe),(0,O.on)(()=>this.analysis.dimensions,"after-add",l=>this._onDimensionAdd(l.item),{onListenerAdd:l=>{for(const o of l)this._onDimensionAdd(o)},onListenerRemove:()=>{this._onDimensionsClear()}}),(0,O.on)(()=>this.analysis.dimensions,"after-remove",l=>this._onDimensionRemove(l.item))]),this._analysisVisualization=new ht({analysisViewData:this,view:this.view}),this._analysisController=new ut({analysisViewData:this,view:this.view})}destroy(){this._placementTask=(0,m.IM)(this._placementTask),this._analysisVisualization=(0,m.SC)(this._analysisVisualization),(0,An.Yq)(this)}get updating(){return this._analysisVisualization?.loadingMessages??!1}get results(){return this.analysis.dimensions.map(l=>this._dimensionsToComputations.get(l).result)}get selectedComputation(){const{selectedDimension:l}=this;return(0,m.Wi)(l)?null:this._dimensionsToComputations.get(l)}get testInfo(){return{visualization:this._analysisVisualization,controller:this._analysisController}}createLengthDimensions(l){var o=this;return(0,G.Z)(function*(){return o.selectedDimension=null,o._placementTask=(0,m.IM)(o._placementTask),o._placementTask=(0,An.Er)(o,l),o._placementTask.promise})()}_onDimensionAdd(l){const{computations:o,_dimensionsToComputations:c}=this;if(c.has(l))return;const h=new Ue({dimension:l,projectAndAlignPoint:this._projectAndAlignPoint});o.add(h),c.set(l,h)}_onDimensionRemove(l){const{computations:o,_dimensionsToComputations:c}=this,h=o.findIndex(g=>g.dimension===l),p=o.getItemAt(h);p.dimension===this.selectedDimension&&(this.selectedDimension=null),o.removeAt(h),c.delete(l),(0,m.SC)(p)}_onDimensionsClear(){this.computations.drain(l=>l.destroy()),this._dimensionsToComputations.clear()}};(0,S._)([(0,P.Cb)({readOnly:!0})],Ie.prototype,"type",void 0),(0,S._)([(0,P.Cb)()],Ie.prototype,"tool",void 0),(0,S._)([(0,P.Cb)()],Ie.prototype,"updating",null),(0,S._)([(0,P.Cb)({readOnly:!0})],Ie.prototype,"results",null),(0,S._)([(0,P.Cb)({readOnly:!0})],Ie.prototype,"computations",void 0),(0,S._)([(0,P.Cb)()],Ie.prototype,"selectedDimension",void 0),(0,S._)([(0,P.Cb)()],Ie.prototype,"selectedComputation",null),(0,S._)([(0,P.Cb)()],Ie.prototype,"_analysisVisualization",void 0),(0,S._)([(0,P.Cb)()],Ie.prototype,"_analysisController",void 0),(0,S._)([(0,P.Cb)()],Ie.prototype,"_dimensionsToComputations",void 0),(0,S._)([(0,P.Cb)()],Ie.prototype,"_placementTask",void 0),Ie=(0,S._)([(0,de.j)("esri.views.3d.analysis.DimensionAnalysisView3D")],Ie);const da=Ie},52051:(Ve,ne,v)=>{v.d(ne,{T:()=>B});var G=v(62208),S=v(10699);class B{constructor(U,m){this._textureRep=U,this.loadPromise=null,this._disposed=!1;const O=this._textureRep.acquire(m);(0,S.y8)(O)?(O.then(P=>{this._disposed?(0,G.RY)(P):this._textureRef=P}),this.loadPromise=O):this._textureRef=O}dispose(){this._textureRef=(0,G.RY)(this._textureRef),this._disposed=!0}get glTexture(){return(0,G.pC)(this._textureRef)?this._textureRef.glTexture:null}}},72791:(Ve,ne,v)=>{v.d(ne,{c:()=>S,j:()=>G});const G={redo:"r",undo:"z",center:"Alt",constraint:"Shift",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "},S={toggle:"Control"}},33351:(Ve,ne,v)=>{v.d(ne,{Bq:()=>I,Hk:()=>ke,M8:()=>ie,aU:()=>j,jg:()=>J,kt:()=>_e,ku:()=>Ne});var G=v(62208),S=v(67831),B=v(99770),W=v(84161),U=v(28093),m=v(59550),O=v(26362),P=v(396);class xe{intersect(D){return function x(F,D){let w=[];if(Z(F)){const{point:z}=F;pe(D)?w=(0,O.pk)(D.lineLike,z):me(D)?w=(0,O.Xi)(D.center,D.radius,z):Ce(D)?w=(0,O.hm)(D.planeLike,z):we(D)&&(w=V(D,F))}else if(pe(F)){const{lineLike:z}=F;Z(D)?w=(0,O.pk)(z,D.point):pe(D)?w=(0,O.Lh)(z,D.lineLike):me(D)?w=(0,O.CJ)(z,D.center,D.radius):Ce(D)?w=(0,O.fK)(D.planeLike,z):we(D)&&(w=V(D,F))}else if(me(F)){const{center:z,radius:H}=F;if(pe(D))w=(0,O.CJ)(D.lineLike,z,H);else if(Z(D))w=(0,O.Xi)(z,H,D.point);else{if(Ce(D))return(0,O.SD)(D.planeLike,z,H).map(q=>new se(q,F,D));we(D)&&(w=V(D,F))}}else if(Ce(F)){const{planeLike:z}=F;if(Ce(D))return(0,O.qi)(z,D.planeLike).map(H=>new se(H,F,D));if(Z(D))w=(0,O.hm)(z,D.point);else if(pe(D))w=(0,O.fK)(z,D.lineLike);else{if(me(D))return(0,O.SD)(z,D.center,D.radius).map(H=>new se(H,F,D));we(D)&&(w=V(D,F))}}else we(F)&&(w=V(F,D));return function et(F,D,w){return F.map(z=>new I((0,m.uc)(z),D,w))}(w,F,D)}(this,D)}}class ke extends xe{constructor(D){super(),this.point=D}equals(D){return Z(D)&&(0,W.k)(this.point,D.point)}closestTo(){return(0,m.bQ)(this.point)}}class de extends xe{constructor(D,w,z){super(),this.start=D,this.end=w,this.type=z,this.lineLike={start:this.start,end:this.end,type:this.type}}equals(D){return pe(D)&&this.type===D.type&&(0,W.k)(this.start,D.start)&&(0,W.k)(this.end,D.end)}closestTo(D){const w=(0,O.ZE)(D,this.lineLike);return(0,m.uc)(w)}}class Ne extends de{constructor(D,w){super(D,w,P.SP.LINE)}}class I extends xe{constructor(D,w,z){super(),this.intersection=D,this.first=w,this.second=z}equals(D){return D instanceof I&&this.first.equals(D.first)&&this.second.equals(D.second)}closestTo(){return(0,m.bQ)(this.intersection)}}class se extends xe{constructor(D,w,z){super(),this.basePoint=D,this.first=w,this.second=z}equals(D){return D instanceof se&&this.first.equals(D.first)&&this.second.equals(D.second)}closestTo(D){const w=this.basePoint;return(0,m.uc)((0,U.f)(w[0],w[1],D[2]))}}class _e extends xe{constructor(D,w){super(),this.center=D,this.radius=w}equals(D){return me(D)&&this.center[0]===D.center[0]&&this.center[1]===D.center[1]&&this.radius===D.radius}closestTo(D){const w=(0,O.sc)(D,this.center,this.radius);return(0,m.uc)(w)}}class Ee extends xe{constructor(D,w,z){super(),this.start=D,this.end=w,this.type=z,this.planeLike={start:D,end:w,type:z}}equals(D){return Ce(D)&&this.type===D.type&&(0,W.k)(this.start,D.start)&&(0,W.k)(this.end,D.end)}closestTo(D){return(0,m.uc)((0,O.z9)(D,this.planeLike))}closestEndTo(D){const{start:w,end:z}=this;return Math.sign((0,S.h)((0,S.a)(Pt,z,w),(0,S.a)(Et,D,w)))>0?z:w}}class j extends Ee{constructor(D,w){super(D,w,O.Jk.HALF_PLANE)}}class J extends Ee{constructor(D,w){super(D,w,O.Jk.PLANE)}}class ie extends xe{constructor(D,w,z){super(),this.start=D,this.end=w,this.getZ=z,this.planeLike={start:D,end:w,type:O.Jk.HALF_PLANE}}equals(D){return we(D)&&(0,W.k)(this.start,D.start)&&(0,W.k)(this.end,D.end)&&this.getZ===D.getZ}closestTo(D){return function ye(F,D){const w=(0,O.z9)(D,F.planeLike);return w[2]=(0,G.WG)(F.getZ(D[0],D[1],D[2]))??Pe,(0,m.uc)(w)}(this,D)}addIfOnTheGround(D,w){for(const z of w){const H=(0,G.Pt)(this.getZ(z[0],z[1],z[2]),0);Math.abs(z[2]-H)<O.Ho&&(z[2]=H,D.push(z))}}}function V(F,D){const{planeLike:w,getZ:z}=F,H=[];if(Z(D))F.addIfOnTheGround(H,(0,O.hm)(w,D.point));else if(pe(D))F.addIfOnTheGround(H,(0,O.fK)(w,D.lineLike));else if(me(D))for(const[q,Q]of(0,O.SD)(w,D.center,D.radius)){const Y=z(q,Q,0);(0,G.pC)(Y)&&H.push((0,U.f)(q,Q,Y))}else if(Ce(D)||we(D))for(const[q,Q]of(0,O.qi)(w,D.planeLike)){const Y=(0,G.WG)(z(q,Q,0))??Pe;H.push((0,U.f)(q,Q,Y))}return H}function Z(F){return F instanceof ke}function pe(F){return F instanceof de}function me(F){return F instanceof _e}function Ce(F){return F instanceof Ee}function we(F){return F instanceof ie}const Pt=(0,B.a)(),Et=(0,B.a)(),Pe=0},26352:(Ve,ne,v)=>{var G,S;v.d(ne,{B:()=>G}),(S=G||(G={}))[S.FEATURE=1]="FEATURE",S[S.SELF=2]="SELF",S[S.ALL=3]="ALL"},59550:(Ve,ne,v)=>{v.d(ne,{$D:()=>P,$G:()=>O,Gs:()=>ke,SH:()=>de,bQ:()=>m,dF:()=>xe,uc:()=>U});var G=v(62208),S=v(28093),B=v(38114),W=v(60507);function U(I){return I}function m(I){return(0,S.a)(I)}function O(I,se,_e){return(0,S.f)(I,se,_e)}function P(I,se,_e){return(0,G.Wi)(I)?null:xe(_e.coordinateHelper.vectorToDehydratedPoint(I,Ne),se,_e)}function xe(I,se,_e){if((0,G.Wi)(I))return null;if((0,G.Wi)(se))return(0,S.f)(I.x,I.y,I.z??0);if("2d"===se.type)return(0,S.f)(I.x,I.y,0);const{elevationInfo:Ee}=_e,j=(0,W.vQ)(se,I,Ee,W.jG)??0;return(0,S.f)(I.x,I.y,j)}function ke(I,se,{z:_e,m:Ee,spatialReference:j,elevationInfo:J}){if(null==_e&&null==Ee){const x=(0,B.Tx)(I[0],I[1],void 0,j);return null!=Ee&&(x.m=Ee,x.hasM=!0),x}if((0,G.Wi)(se)||"2d"===se.type){const x=(0,B.Tx)(I[0],I[1],_e,j);return null!=Ee&&(x.m=Ee,x.hasM=!0),x}const ie=(0,W.zx)(se,I,j,W.jG,J)??0,ye=(0,B.Tx)(I[0],I[1],ie,j);return null!=Ee&&(ye.m=Ee,ye.hasM=!0),ye}function de(I,se){return(0,B.Tx)(I[0],I[1],I[2],se)}const Ne=(0,B.Tx)(0,0,0,null)},61430:(Ve,ne,v)=>{v.d(ne,{k:()=>U});var G=v(33351),S=v(44725),B=v(97979),W=v(62160);class U extends B.a{constructor(O){super({...O,isDraped:!0,constraint:new G.M8(O.edgeStart,O.edgeEnd,O.getGroundElevation)})}get hints(){return[new W.w(S.ze.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},75897:(Ve,ne,v)=>{v.d(ne,{L:()=>U});var G=v(33351),S=v(44725),B=v(97979),W=v(62160);class U extends B.a{constructor(O){super({...O,constraint:new G.ku(O.edgeStart,O.edgeEnd)})}get hints(){return[new W.w(S.ze.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},97979:(Ve,ne,v)=>{v.d(ne,{a:()=>B});var G=v(26352),S=v(22823);class B extends S.j{constructor({targetPoint:U,objectId:m,constraint:O,isDraped:P}){super(U,O,P,G.B.FEATURE),this.objectId=m}}},22823:(Ve,ne,v)=>{v.d(ne,{j:()=>G});class G{constructor(B,W,U,m){this.targetPoint=B,this.constraint=W,this.isDraped=U,this.domain=m}}},62160:(Ve,ne,v)=>{v.d(ne,{w:()=>m}),v(8314),v(63290);var B=v(84161),W=v(26352),U=v(5286);class m extends U.r{constructor(P,xe,ke,de,Ne=W.B.ALL,I=!0,se=!0){super(de,Ne),this.type=P,this.lineStart=xe,this.lineEnd=ke,this.fadeLeft=I,this.fadeRight=se}equals(P){return P instanceof m&&this.type===P.type&&(0,B.k)(this.lineStart,P.lineStart)&&(0,B.k)(this.lineEnd,P.lineEnd)&&this.fadeLeft===P.fadeLeft&&this.fadeRight===P.fadeRight}get length(){return(0,B.i)(this.lineStart,this.lineEnd)}}},19038:(Ve,ne,v)=>{v.d(ne,{n:()=>B});var G=v(84161),S=v(5286);class B extends S.r{constructor(U,m,O){super(m,O),this.point=U}equals(U){return U instanceof B&&(0,G.k)(this.point,U.point)}}},5286:(Ve,ne,v)=>{v.d(ne,{r:()=>G});class G{constructor(B,W){this.isDraped=B,this.domain=W}}},44725:(Ve,ne,v)=>{v.d(ne,{Bb:()=>xe,ML:()=>_e,Ob:()=>Ee,_j:()=>se,fG:()=>ke,lQ:()=>de,rh:()=>I,ze:()=>Ne});var Ne,j,G=v(62208),S=v(32917),B=v(84161),W=v(38114),U=v(18547),m=v(72791),O=v(59550);function xe(j,J){const ie=j.x-J.x,ye=j.y-J.y;return ie*ie+ye*ye}function ke(j,J){return Math.sqrt(xe(j,J))}function de(j,J){J.sort((ie,ye)=>(0,B.d)(ie.targetPoint,j)-(0,B.d)(ye.targetPoint,j))}function I({point:j,distance:J,types:ie,coordinateHelper:{spatialReference:ye}},x,V){return{point:(0,W.Tx)(j[0],j[1],j[2],ye.toJSON()),mode:x,distance:J,types:ie,query:(0,G.pC)(V)?V.toJSON():{where:"1=1"}}}function se(j,J,ie){return{left:(0,O.$D)(j.leftVertex.pos,J,ie),right:(0,O.$D)(j.rightVertex.pos,J,ie)}}function _e(j){return j.createQuery()}function Ee(j,J=(()=>{})){const ie=(0,S.YP)(()=>({view:j.view,snappingOptions:j.snappingOptions}),({view:ye,snappingOptions:x})=>{const V="snapping-toggle",et=U.f.TOOL;if(j.removeHandles(V),ye&&(0,G.pC)(x)){const Z=[ye.on("key-down",pe=>{pe.key!==m.c.toggle||pe.repeat||(x.enabledToggled=!0,J())},et),ye.on("key-up",pe=>{pe.key===m.c.toggle&&(x.enabledToggled=!1,J())},et),ye.on("pointer-move",pe=>{const me=pe.native.ctrlKey;x.enabledToggled!==me&&(x.enabledToggled=me,J())},et)];j.addHandles(Z,V)}},S.tX);j.addHandles(ie)}(j=Ne||(Ne={}))[j.TARGET=0]="TARGET",j[j.REFERENCE=1]="REFERENCE",j[j.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"},26362:(Ve,ne,v)=>{v.d(ne,{CJ:()=>j,Ho:()=>Z,Jk:()=>V,Lh:()=>J,SD:()=>O,Xi:()=>ye,ZE:()=>_e,fK:()=>P,hm:()=>xe,pk:()=>ie,qi:()=>ke,sc:()=>I,z9:()=>de});var V,w,G=v(21286),S=v(67831),B=v(99770),W=v(84161),U=v(28093),m=v(396);function O({start:w,end:z,type:H},q,Q){const Y=[],re=(0,S.a)(pe,z,w),Le=(0,S.a)(me,w,q),Me=(0,S.v)(re),De=2*(0,S.h)(re,Le),He=De*De-4*Me*((0,S.v)(Le)-Q*Q);if(0===He){const Oe=-De/(2*Me);(H===V.PLANE||Oe>=0)&&Y.push((0,S.w)((0,B.a)(),w,re,Oe))}else if(He>0){const Oe=Math.sqrt(He),be=(-De+Oe)/(2*Me);(H===V.PLANE||be>=0)&&Y.push((0,S.w)((0,B.a)(),w,re,be));const $=(-De-Oe)/(2*Me);(H===V.PLANE||$>=0)&&Y.push((0,S.w)((0,B.a)(),w,re,$))}return Y}function P(w,z){const H=w.start,Q=(0,S.a)(pe,w.end,H),Y=(0,W.s)(me,-Q[1],Q[0],0),re=z.start,Me=(0,W.w)(Ce,z.end,re),De=(0,W.e)(Me,Y),He=(0,W.s)(we,H[0],H[1],0),Oe=(0,W.w)(Pt,He,re),be=(0,W.e)(Oe,Y);if(Math.abs(De)<Z)return Math.abs(be),[];const $=(0,W.z)(Et,re,Me,be/De);if(z.type===m.SP.RAY){const le=(0,W.w)(Pe,$,re);if((0,W.e)(le,Me)<-Z)return[]}if(w.type===V.HALF_PLANE){const le=(0,S.e)(Pe,$,H);if((0,S.h)(le,Q)<-Z)return[]}return[(0,U.a)($)]}function xe(w,z){return ie(x(F,z[2],w),z)}function ke(w,z){const q=J(x(F,0,w),x(D,0,z)),Q=[];for(const Y of q)Q.push((0,B.d)(Y));return Q}function de(w,z){return _e(w,x(F,w[2],z))}function I(w,z,H){const q=(0,S.a)(pe,w,z),Q=H/(0,S.i)(q),Y=(0,S.w)((0,U.c)(),z,q,Q);return Y[2]=w[2],Y}function _e(w,{start:z,end:H,type:q}){const Q=(0,W.w)(pe,w,z),Y=(0,W.w)(me,H,z),re=(0,W.e)(Q,Y)/(0,W.e)(Y,Y);return(0,W.z)((0,U.c)(),z,Y,q===m.SP.RAY?Math.max(re,0):re)}function j({start:w,end:z,type:H},q,Q){const Y=[],re=(0,W.b)(pe,z,w),Le=(0,S.a)(me,w,q),Me=(0,S.v)(re),De=2*(0,S.h)(re,Le),He=De*De-4*Me*((0,S.v)(Le)-Q*Q);if(0===He){const Oe=-De/(2*Me);(H===m.SP.LINE||Oe>=0)&&Y.push((0,W.z)((0,U.c)(),w,re,Oe))}else if(He>0){const Oe=Math.sqrt(He),be=(-De+Oe)/(2*Me);(H===m.SP.LINE||be>=0)&&Y.push((0,W.z)((0,U.c)(),w,re,be));const $=(-De-Oe)/(2*Me);(H===m.SP.LINE||$>=0)&&Y.push((0,W.z)((0,U.c)(),w,re,$))}return Y}function J(w,z){const H=w.start,Q=z.start,Y=z.end,re=(0,W.w)(pe,w.end,H),Le=(0,W.w)(me,Y,Q),Me=(0,W.w)(Ce,Q,H),De=(0,W.f)(we,re,Le),He=(0,W.e)(Me,De);if(!(0,G.W8)(He,0,Z))return[];const Oe=(0,W.D)(De);if((0,G.W8)(Oe,0,Z))return[];const be=(0,W.f)(Pt,Me,Le),$=(0,W.e)(be,De)/Oe,le=(0,W.z)(Et,H,re,$);if(w.type===m.SP.RAY){const pt=(0,W.w)(Pe,le,H);if((0,W.e)(re,pt)<-Z)return[]}if(z.type===m.SP.RAY){const pt=(0,W.w)(Pe,le,Q);if((0,W.e)(Le,pt)<-Z)return[]}return[(0,U.a)(le)]}function ie({start:w,end:z,type:H},q){const Q=(0,W.w)(pe,q,w),Y=(0,W.w)(me,z,w),re=(0,W.f)(Ce,Y,Q);if((0,W.D)(re)/(0,W.D)(Y)<Z)switch(H){case m.SP.LINE:return[(0,U.a)(q)];case m.SP.RAY:return(0,W.e)(Y,Q)<-Z?[]:[(0,U.a)(q)]}return[]}function ye(w,z,H){return(0,G.W8)((0,S.k)(H,w),z*z,Z)?[(0,U.a)(H)]:[]}function x(w,z,{start:H,end:q,type:Q}){return(0,W.s)(w.start,H[0],H[1],z),(0,W.s)(w.end,q[0],q[1],z),w.type=et[Q],w}(w=V||(V={}))[w.PLANE=0]="PLANE",w[w.HALF_PLANE=1]="HALF_PLANE";const et={[V.PLANE]:m.SP.LINE,[V.HALF_PLANE]:m.SP.RAY},Z=1e-6,pe=(0,U.c)(),me=(0,U.c)(),Ce=(0,U.c)(),we=(0,U.c)(),Pt=(0,U.c)(),Et=(0,U.c)(),Pe=(0,U.c)(),F={start:(0,U.c)(),end:(0,U.c)(),type:m.SP.LINE},D={start:(0,U.c)(),end:(0,U.c)(),type:m.SP.LINE}}}]);