"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[6457],{66457:(Ge,L,n)=>{n.r(L),n.d(L,{default:()=>Ce});var v=n(15861),g=n(17626),M=n(88879),z=n(85931),O=n(63290),b=n(62208),F=n(32917),B=n(55713),y=n(77712),_=(n(8314),n(76898)),W=n(79800),V=n(29302),R=n(39774),K=n(1582),j=n(33190),G=n(36344),J=n(33696),X=n(5437),Y=n(38114),$=n(41967),q=n(84786),k=n(80543),ee=n(98624),U=n(96854),te=n(82157),re=n(42930);class Z extends re.q{constructor(e){super("SceneLayerWorker","dracoDecompressPointCloudData",{dracoDecompressPointCloudData:i=>[i.geometryBuffer]},e,{hasInitialize:!0})}}var ie=n(19702),se=n(33816),oe=n(34675),A=n(30578),ne=n(61885),ae=n(88159);class de extends ne.Z{constructor(e,i){super(),this._updateAndCompare=e,this._notifyUpdated=i,this._nodes=new Map,this._graphics=new Map,this._duplicates=new Map}clear(){if(this._graphics.size>0){const e=this.toArray();this._graphics.clear(),this.emit("change",{added:[],removed:e})}this._nodes.clear()}get length(){return this._graphics.size}get(e){return this._graphics.get(e)}getNode(e){return this._nodes.get(e)}hasNode(e){return this._nodes.has(e)}nodes(){return this._nodes.values()}addNode(e,i){this._nodes.set(e,i);const r=i.graphics;if(0===r.length)return;const s=new Set;for(let a=0;a<r.length;a++){const l=r[a],d=l.objectId,h=this._graphics.get(d);if(h){s.add(d),l!==h&&(r[a]=h);const c=this._duplicates.get(d);c?c.push(e):this._duplicates.set(d,[h.nodeIndex,e])}else l.nodeIndex=e,this._graphics.set(d,l)}s.size&&this._updateForeignGraphics(i);const o=s.size>0?r.filter(a=>!s.has(a.objectId)):r;o.length>0&&this.emit("change",{added:o,removed:[]})}removeNode(e){const i=this._nodes.get(e);if(!i)return void console.error("Removing unknown node");this._nodes.delete(e);const r=new Set,s=[];for(const o of i.graphics){const a=o.objectId,l=this._graphics.get(a);if(!l)continue;const d=this._duplicates.get(a);if(d){const h=d.indexOf(e);if(-1===h){console.error("error: removing graphic from node that should not reference it.");continue}if(d.splice(h,1),l.nodeIndex===e){let c=this.getNode(d[0]);for(let f=1;f<d.length;f++){const u=this.getNode(d[f]);(null==c||null!=u&&u.node.level>c.node.level)&&(c=u)}null!=c&&r.add(c)}1===d.length&&this._duplicates.delete(a)}else this._graphics.delete(a),s.push(o)}s.length>0&&this.emit("change",{added:[],removed:s}),r.forEach(o=>this._updateForeignGraphics(o))}_updateForeignGraphics(e){const i=[],r=e.node.index,s=e.node.level;let o=0;for(;o<e.graphics.length;){const a=e.graphics[o].nodeIndex;if(a===r){o++;continue}let l=1;for(;o+l<e.graphics.length&&e.graphics[o+l].nodeIndex===a;)l++;const d=this.getNode(a);if(null!=d&&d.node.level>s)o+=l;else{for(let h=o;h<o+l;h++){const c=e.graphics[h];c.nodeIndex=r,this._updateAndCompare(c,e,h)&&i.push(c)}o+=l}}this._notifyUpdated(i)}toArray(){return Array.from(this._graphics.values())}find(e){let i;return(0,ae.oE)(this._graphics,r=>!!e(r)&&(i=r,!0)),i}forEach(e){this._graphics.forEach(i=>e(i))}forEachNode(e){this._nodes.forEach((i,r)=>e(i,r))}get nodeCount(){return this._nodes.size}_checkInvariants(){const e=new Map;this._nodes.forEach((r,s)=>{s!==r.node.index&&console.error("Mismatched node index"),r.graphics.forEach(o=>{e.set(o.objectId,1+(e.get(o.objectId)??0));const a=this._duplicates.get(o.objectId);a&&!a.includes(s)&&console.error("Node not listed in duplicate list"),a||o.nodeIndex===s||console.error("Unique graphic does not reference owning node index")})}),this._graphics.size!==e.size&&console.error("Mismatch between actual and expected number of graphics");let i=0;e.forEach((r,s)=>{i+=r>1?1:0;const o=this._graphics.get(s);if(!o)return void console.error("Missing graphic entry");const a=this._nodes.get(o.nodeIndex);if(!a)return void console.error("Graphic references unkown node");const l=this._duplicates.get(s);l?(l.length!==r&&console.error("Wrong number of entries in duplicate list"),l.forEach(d=>{const h=this._nodes.get(d);h?h.node.level>a.node.level&&console.error("Duplicated graphic does not reference highest level node"):console.error("Unknown node in duplicate list")})):r>1&&console.error("Missing duplicates entry")}),this._duplicates.size!==i&&console.error("Mismatch between expected and actual number of duplicate entries")}}var H=n(39159),N=n(42964),le=n(89476),he=n(67966),ue=n(46196),ce=n(40465),pe=n(57610),ge=n(12844),w=n(93605),ye=n(93394),fe=n(41632),me=n(94255),ve=n(23147),be=n(78465),Ie=n(10023),xe=n(87091);const Q=(0,he.v)();class Ee{constructor(e,i,r,s){this.graphics=e,this.featureIds=i,this.attributeInfo=r,this.node=s}}let p=class extends((0,ge.q)((0,le.l)((0,ce.i)((0,ie.A)(be.Z))))){constructor(){super(...arguments),this.type="scene-layer-graphics-3d",this._queryEngine=null,this._memCache=null,this._interactiveEditingSessions=new Map,this._pendingEditsQueue=Promise.resolve(),this.loadedGraphics=new de((t,e,i)=>function Oe(t,e,i){const r=e.attributeInfo;if(null==r?.loadedAttributes||null==r.attributeData)return!1;let s=!1;for(const{name:o}of r.loadedAttributes)if(r.attributeData[o]){const a=(0,N.Jx)(r.attributeData[o],i);a!==t.attributes[o]&&(t.attributes[o]=a,s=!0)}return s}(t,e,i),t=>this.processor.graphicsCore.recreateGraphics(t)),this.holeFilling="always",this.progressiveLoadFactor=1,this.supportsHeightUnitConversion=!0,this._coordinatesOutsideExtentErrors=0,this._maxCoordinatesOutsideExtentErrors=20}tryRecycleWith(t,e){return t.url===this.layer.url&&this._i3sOverrides.isEmpty?t.load(e).then(()=>{(0,N.tq)(this.layer,t,this._i3sOverrides),this.layer=t,this._i3sOverrides.destroy();const i=this.view.resourceController?.memoryController;this._i3sOverrides=new H.v({view:this.view,layer:t,memoryController:i}),(0,b.SC)(this._queryEngine),this._setupQueryEngine(),this.processor.resetObjectStates()}):null}initialize(){this.addResolvingPromise(this.layer.indexInfo);const t=this.view.resourceController?.memoryController;this._i3sOverrides=new H.v({view:this.view,layer:this.layer,memoryController:t}),(0,N.OJ)(this.layer,this.view.spatialReference,this.view.viewingMode),this._fieldsHelper=new pe.K({layerView:this}),this._updatingHandles.add(()=>this.layer.rangeInfos,e=>this._rangeInfosChanged(e),F.nn),this._updatingHandles.add(()=>this.layer.renderer,(e,i)=>this._rendererChange(e,i)),this._updatingHandles.add(()=>[this.parsedDefinitionExpression,this._excludeObjectIdsSorted],()=>this._filterChange()),this.addHandles((0,F.YP)(()=>w.h.I3S_TREE_SHOW_TILES,e=>{if(e&&!this._treeDebugger){const i=this._controller.crsIndex;Promise.all([n.e(8592),n.e(3109)]).then(n.bind(n,3109)).then(({I3STreeDebugger:r})=>{!this._treeDebugger&&w.h.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new r({lv:this,view:this.view,nodeSR:i}))})}else e||!this._treeDebugger||w.h.I3S_TREE_SHOW_TILES||(this._treeDebugger.destroy(),this._treeDebugger=null)},F.nn)),this._set("processor",new se.I({owner:this,preferredUpdatePolicy:ve.j.ASYNC,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentEnabled:!1,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,setUidToIdOnAdd:!1,dataExtent:this.layer.fullExtent,updateClippingExtent:e=>this._updateClippingExtent(e)})),this.processor.elevationAlignment?.events.on("invalidate-elevation",({extent:e,spatialReference:i})=>this._controller.updateElevationChanged(e,i)),this.supportsHeightUnitConversion&&(this._verticalScale=(0,J.k)("point",this.layer.spatialReference,this.view.spatialReference)),this.addResolvingPromise(this.processor.initializePromise),this._memCache=this.view.resourceController.memoryController.newCache(`psl-${this.uid}`),this._controller=new k.Z({layerView:this,scaleVisibilityEnabled:!1}),(0,N.X5)(this.layer.geometryDefinitions)&&(this._worker=new Z(e=>this.view.resourceController.immediate.schedule(e))),this.addHandles(this.layer.on("apply-edits",e=>this._updatingHandles.addPromise(e.result))),this.addHandles(this.layer.on("edits",e=>{const i=this._pendingEditsQueue.then(()=>this._handleEdits(e)).then();this._pendingEditsQueue=i,this._updatingHandles.addPromise(i)})),this.when(()=>{this._setupQueryEngine(),this._updatingHandles.add(()=>this.maximumNumberOfFeatures,e=>this._controller.featureTarget=e,F.nn),this._updatingHandles.add(()=>this.suspended,e=>{e&&this._removeAllNodeData()})})}destroy(){this._treeDebugger=(0,b.SC)(this._treeDebugger),this._i3sOverrides=(0,b.SC)(this._i3sOverrides),this._set("processor",(0,b.SC)(this.processor)),this._controller=(0,b.SC)(this._controller),this._queryEngine=(0,b.SC)(this._queryEngine),this._worker=(0,b.SC)(this._worker),this._memCache=(0,b.SC)(this._memCache),this.loadedGraphics.clear(),this._fieldsHelper=(0,b.SC)(this._fieldsHelper)}get i3slayer(){return this.layer}get updatingProgressValue(){return this._controller?.updatingProgress??1}get requiredFields(){return this._fieldsHelper?.requiredFields??[]}get maximumNumberOfFeatures(){return this.processor?.graphicsCore?.displayFeatureLimit?.maximumNumberOfFeatures??0}set maximumNumberOfFeatures(t){null!=t?(this._override("maximumNumberOfFeatures",t),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),this._controller.fixedFeatureTarget=!1)}get maximumNumberOfFeaturesExceeded(){return!this.suspended&&!!this._controller?.useMaximumNumberOfFeatures&&!this._controller.leavesReached}get _excludeObjectIdsSorted(){const t=this.layer.excludeObjectIds;return t.length?t.toArray().sort((e,i)=>e-i):null}get lodFactor(){return"Labels"===this.layer.semantic?1:this.view.qualitySettings.sceneService.point.lodFactor}get hasM(){return!1}get hasZ(){return!0}get contentVisible(){return!this.suspended&&!!this._controller?.rootNodeVisible}get legendEnabled(){return this.contentVisible&&!0===this.i3slayer?.legendEnabled}whenGraphicAttributes(t,e){var i=this;return(0,v.Z)(function*(){return(0,N.bf)(i.layer,t,i._getObjectIdField(),e,()=>[...i.loadedGraphics.nodes()])})()}getHit(t){if(!this.loadedGraphics)return null;const e=(0,q.mW)(this.loadedGraphics.find(r=>r.uid===t),this.layer),i=this._getObjectIdField();return e?.attributes?.[i]?(e.layer=this.layer,e.sourceLayer=this.layer,{type:"graphic",graphic:e,layer:e.layer}):null}whenGraphicBounds(t,e){return this.processor.whenGraphicBounds(t,e)}computeAttachmentOrigin(t,e){return this.processor.computeAttachmentOrigin(t,e)}isUpdating(){return!!(this._controller?.updating||this.processor?.updating||this._fieldsHelper?.updating||this.layerFilterUpdating)}highlight(t){return this.processor.highlight(t,this.layer.objectIdField)}get updatePolicy(){return this.processor.graphicsCore.effectiveUpdatePolicy}createInteractiveEditSession(t){return(0,A.sw)(this._attributeEditingContext,t)}_decompressBinaryPointData(t,e){var i=this;return(0,v.Z)(function*(){const r={geometryBuffer:t.geometryBuffer};null==i._worker&&(i._worker=new Z(o=>i.view.resourceController.immediate.schedule(o)));const s=yield i._worker.invoke(r,e);if(null==s)throw new Error("Failed to decompress Draco point data");return{positionData:s.positions,featureIds:s.featureIds}})()}addNode(t,e,i){var r=this;return(0,v.Z)(function*(){if(!P(e)&&!function Ne(t){return"pointData"in t}(e))throw new Error;if(r.loadedGraphics.hasNode(t.index))return void O.Z.getLogger(r).error("I3S node "+t.id+" already added");const s=null!=r.layer.fullExtent?function Se(t,e){return t.xmin-=e,t.ymin-=e,t.xmax+=e,t.ymax+=e,null!=t.zmin&&null!=t.zmax&&(t.zmin-=e,t.zmax+=e),null!=t.mmin&&null!=t.mmax&&(t.mmin-=e,t.mmax+=e),t}(r.layer.fullExtent.clone(),.5):null,{featureIds:o,pointPositions:a}=P(e)?yield r._extractBinaryPointPositions(t,e,i):r._extractLegacyPointPositions(e),l=new Array;r._validatePositions(t,o,a,s,l);const d=r._controller.crsVertex;(0,R.projectBuffer)(a,d,0,a,r.view.spatialReference,0,o.length);const c=P(e)?t.level:0,f=r._createGraphics(o,a,t.index,c),u=new Ee(f,o,e.attributeDataInfo,t);if(yield r._i3sOverrides.applyAttributeOverrides(u.featureIds,e.attributeDataInfo,i),t.numFeatures=u.graphics.length,r._updateNodeMemory(t),T(u),l.length>0&&(r._computeObb(t,l,d),r._controller.updateVisibility(t.index)),!r._controller.isGeometryVisible(t))return void r._cacheNodeData(u);if(null!=r._verticalScale)for(const x of u.graphics)r._verticalScale(x.geometry);const S=r.view._stage.renderView.objectAndLayerIdRenderHelper;if(null!=S){const x=(0,te.ql)(r.view.map,r.layer.uid);for(let C=0;C<u.featureIds.length;C++)S.setUidToObjectAndLayerId(u.featureIds[C],u.graphics[C].uid,r.layer.id,r.layer.uid,r.layer.popupEnabled&&!x&&(0,Ie.zc)(r.layer,r.view.popup?.defaultPopupTemplateEnabled),u.node.resources.attributes,C)}r.loadedGraphics.addNode(t.index,u),r._controller.updateLoadStatus(t.index,!0),r._filterNode(u),r._treeDebugger&&r._treeDebugger.update()})()}_computeObb(t,e,i){const r=this._controller.crsIndex,s=r.isGeographic?this.view.renderSpatialReference:r;(0,R.projectBuffer)(e,i,0,e,s,0,e.length/3),t.serviceObbInIndexSR=(0,ye.Qb)(new me.U(e,3)),r.isGeographic&&((0,K.S)(t.serviceObbInIndexSR.center,s,I,r),t.serviceObbInIndexSR.center=I)}isNodeLoaded(t){return this.loadedGraphics.hasNode(t)}isNodeReloading(){return!1}updateNodeState(){}_extractBinaryPointPositions(t,e,i){var r=this;return(0,v.Z)(function*(){const s=yield r._decompressBinaryPointData(e,i),o=s.positionData,l=o.length/3,d=(0,G.bg)(3*l),h=null!=t.serviceObbInIndexSR?t.serviceObbInIndexSR.center:V.AG,c=Math.abs(h[2])*2**-20;for(let f=0;f<l;f++){const u=3*f;d[u]=o[u]+h[0],d[u+1]=o[u+1]+h[1],d[u+2]=o[u+2]+h[2],Math.abs(d[u+2])<c&&(d[u+2]=0)}return{featureIds:s.featureIds?(0,G.QZ)(s.featureIds):[],pointPositions:d}})()}_extractLegacyPointPositions(t){const e=t.pointData.length,i=(0,G.bg)(3*e),r=new Array;for(let s=0;s<e;s++){const o=t.pointData[s],a=o.featureDataPosition,l=a.length,d=o.geometries?.[0]??De[l],h=o.featureIds[0];if("Embedded"!==d.type||"points"!==d.params.type||l<2||l>3)continue;const c=d.params.vertexAttributes?.position??[0,0,0],f=3*r.length;i[f]=a[0]+c[0],i[f+1]=a[1]+c[1],i[f+2]=3===l?a[2]+c[2]:NaN,r.push(h)}return{featureIds:r,pointPositions:i}}_validatePositions(t,e,i,r,s){if(null==r&&t.serviceObbInIndexSR)return;const o=e.length;for(let l=0;l<o;l++){const d=3*l;(0,W.s)(I,i[d],i[d+1],i[d+2]);const h=!Number.isNaN(i[2]);null==r||(h?(0,j.Qg)(r,I):(0,j.OQ)(r,I))||(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&O.Z.getLogger(this).error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&O.Z.getLogger(this).error("Maximum number of errors reached. Further errors are ignored."),this._coordinatesOutsideExtentErrors++),t.serviceObbInIndexSR||s.push(I[0],I[1],I[2])}}_createGraphics(t,e,i,r){const s=t.length,a=this._getObjectIdField(),l=this.processor.graphicsCore,d=new Array,h=this.view.spatialReference;for(let c=0;c<s;c++){const f=t[c],u={};null!=f&&(u[a]=f);const S=f??M.Z.generateUID(),x=3*c,C=isNaN(e[x+2])?void 0:e[x+2],D=(0,$.T)(e[x],e[x+1],C,h),E=this.loadedGraphics.get(S);if(null!=E)(null==E.level||E.level<r)&&(m.property="geometry",m.graphic=E,m.oldValue=E.geometry,m.newValue=D,E.geometry=D,E.level=r,l.graphicUpdateHandler(m)),d.push(E);else{const Fe=M.Z.generateUID();d.push({objectId:S,uid:Fe,geometry:D,attributes:u,visible:!0,nodeIndex:i,level:r})}}return d}_updateNodeMemory(t){t.memory=4096+(null!=t.numFeatures?t.numFeatures*this.processor.graphicsCore.usedMemoryPerGraphic:0)}_cacheNodeData(t){const e=t.graphics.reduce((i,r)=>(0,Y.Xw)(r)+i,(0,B.Xw)(t.featureIds)+1024);this._memCache.put(this._getMemCacheKey(t.node),t,e)}_getMemCacheKey(t){return`${t.index}`}_removeAllNodeData(){this.loadedGraphics.forEachNode((t,e)=>{t&&(this._updateNodeMemory(t.node),this._cacheNodeData(t)),this._controller.updateLoadStatus(e,!1)}),this._treeDebugger&&this._treeDebugger.update(),this.loadedGraphics.clear()}removeNode(t){const e=this._removeNodeStageData(t);e&&(this._updateNodeMemory(e.node),this._cacheNodeData(e))}_removeNodeStageData(t){const e=this.loadedGraphics.getNode(t);return null==e?null:(this._controller.updateLoadStatus(t,!1),this.loadedGraphics.removeNode(t),this._treeDebugger&&this._treeDebugger.update(),e)}loadCachedNodeData(t){var e=this;return(0,v.Z)(function*(){return e._memCache?.pop(e._getMemCacheKey(t))})()}addCachedNodeData(t,e,i,r){var s=this;return(0,v.Z)(function*(){s.loadedGraphics.hasNode(t.index)?O.Z.getLogger(s).error("I3S node "+t.id+" already added"):(yield s._i3sOverrides.applyAttributeOverrides(e.featureIds,i,r),s.loadedGraphics.addNode(t.index,e),s._controller.updateLoadStatus(t.index,!0),s._updateNodeMemory(t),e.attributeInfo=i,s._attributeValuesChanged(e),s._filterNode(e),s._treeDebugger&&s._treeDebugger.update())})()}getLoadedNodeIds(){const t=[];return this.loadedGraphics.forEachNode(e=>t.push(e.node.id)),t.sort()}getVisibleNodes(){const t=new Array;return this.loadedGraphics.forEachNode(e=>t.push(e.node)),t}getLoadedNodeIndices(t){this.loadedGraphics.forEachNode((e,i)=>t.push(i))}getLoadedAttributes(t){const e=this.loadedGraphics.getNode(t);if(null!=e?.attributeInfo)return e.attributeInfo.loadedAttributes}getAttributeData(t){const e=this.loadedGraphics.getNode(t);if(null!=e?.attributeInfo)return e.attributeInfo.attributeData}_setAttributeData(t,e){const i=this.loadedGraphics.getNode(t);null!=i?.attributeInfo&&(i.attributeInfo.attributeData=e,this._attributeValuesChanged(i))}updateAttributes(t,e,i){var r=this;return(0,v.Z)(function*(){const s=r.loadedGraphics.getNode(t);null!=s&&(yield r._i3sOverrides.applyAttributeOverrides(s.featureIds,e,i),s.attributeInfo=e,r._attributeValuesChanged(s))})()}_attributeValuesChanged(t){if(T(t),this._filterNode(t),this.processor.graphicsCore.labelsEnabled){const e=t.graphics.map(i=>i.uid);this.processor.graphicsCore.updateLabelingInfo(e)}}_updateClippingExtent(t){return this._controller&&this._controller.updateClippingArea(t),!1}_getObjectIdField(){return this.layer.objectIdField||X.d}_getGlobalIdField(){return this.layer.associatedLayer?.globalIdField}_rendererChange(t,e){var i=this;return(0,v.Z)(function*(){const{layer:{fieldsIndex:r}}=i,s=new Set;let o,a;t?(yield t.collectRequiredFields(s,r),o=Array.from(s).sort()):o=[],s.clear(),e?(yield e.collectRequiredFields(s,r),a=Array.from(s).sort()):a=[],o.length===a.length&&o.every((l,d)=>o[d]===a[d])||i._reloadAllNodes()})()}_rangeInfosChanged(t){null!=t&&t.length>0&&O.Z.getLogger(this).warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")}_filterChange(){this.loadedGraphics.forEachNode(t=>this._filterNode(t))}_reloadAllNodes(){this._removeAllNodeData(),this._controller&&this._controller.restartNodeLoading()}_filterNode(t){const e=this.parsedDefinitionExpression,i=this._excludeObjectIdsSorted,r=this._getObjectIdField();for(const s of t.graphics){const o=s.visible,a=!e||this._evaluateClause(e,s),l=null==i||(0,z.$A)(i,s.attributes[r])<0;s.visible=a&&l,o!==s.visible&&(m.graphic=s,m.property="visible",m.oldValue=o,m.newValue=s.visible,this.processor.graphicsCore.graphicUpdateHandler(m))}}createQuery(){const t={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return null!=this.filter?this.filter.createQuery(t):new U.Z(t)}queryFeatures(t,e){return this._queryEngine.executeQuery(this._ensureQuery(t),e?.signal)}queryObjectIds(t,e){return this._queryEngine.executeQueryForIds(this._ensureQuery(t),e?.signal)}queryFeatureCount(t,e){return this._queryEngine.executeQueryForCount(this._ensureQuery(t),e?.signal)}queryExtent(t,e){return this._queryEngine.executeQueryForExtent(this._ensureQuery(t),e?.signal)}_ensureQuery(t){return this._addDefinitionExpressionToQuery(null==t?this.createQuery():U.Z.from(t))}_setupQueryEngine(){const t=()=>this.processor.featureStore;this._queryEngine=new oe.q({context:{spatialReference:this.view.spatialReference,layer:this.layer,scheduler:this.view.resourceController.scheduler,get featureStore(){return t()},hasZ:this.hasZ,hasM:this.hasM},priority:xe.T8.FEATURE_QUERY_ENGINE})}get usedMemory(){return this.processor?.graphicsCore?.usedMemory??0}get unloadedMemory(){return.8*((this._controller?.unloadedMemoryEstimate??0)+(this.processor?.graphicsCore?.unprocessedMemoryEstimate??0))}get ignoresMemoryFactor(){return this._controller&&this._controller.fixedFeatureTarget}_handleEdits(t){var e=this;return(0,v.Z)(function*(){const i=e._attributeEditingContext,r=yield(0,A.Qw)(i,t);(0,A.Z6)(i,r)})()}get _attributeEditingContext(){const t=this._getObjectIdField(),e=this._getGlobalIdField();return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:t,globalIdField:e,forEachNode:i=>this.loadedGraphics.forEachNode(r=>i(r.node,r.featureIds)),attributeStorageInfo:this.i3slayer.attributeStorageInfo??[],i3sOverrides:this._i3sOverrides,getAttributeData:i=>this.getAttributeData(i),setAttributeData:(i,r,s)=>{this._setAttributeData(i,r);const o=this.loadedGraphics.getNode(i);if(null!=s){const a=this.loadedGraphics.get(s.attributes[t]);null!=a&&this.processor.graphicsCore.recreateGraphics([a])}else null!=o&&this.processor.graphicsCore.recreateGraphics(o.graphics)},clearMemCache:()=>{}}}get performanceInfo(){return new ue.W(this.usedMemory,this.loadedGraphics.length,-1,this.maximumNumberOfFeatures,this.loadedGraphics.nodeCount,this.processor.graphicsCore.performanceInfo)}get test(){return{controller:this._controller,numNodes:this.loadedGraphics.nodeCount,loadedGraphics:this.loadedGraphics}}};(0,g._)([(0,y.Cb)()],p.prototype,"processor",void 0),(0,g._)([(0,y.Cb)({type:ee.Z})],p.prototype,"filter",void 0),(0,g._)([(0,y.Cb)()],p.prototype,"loadedGraphics",void 0),(0,g._)([(0,y.Cb)()],p.prototype,"i3slayer",null),(0,g._)([(0,y.Cb)()],p.prototype,"_controller",void 0),(0,g._)([(0,y.Cb)()],p.prototype,"updating",void 0),(0,g._)([(0,y.Cb)()],p.prototype,"suspended",void 0),(0,g._)([(0,y.Cb)()],p.prototype,"holeFilling",void 0),(0,g._)([(0,y.Cb)(fe.q)],p.prototype,"updatingProgress",void 0),(0,g._)([(0,y.Cb)()],p.prototype,"updatingProgressValue",null),(0,g._)([(0,y.Cb)(Q.requiredFields)],p.prototype,"requiredFields",null),(0,g._)([(0,y.Cb)(Q.availableFields)],p.prototype,"availableFields",void 0),(0,g._)([(0,y.Cb)()],p.prototype,"_fieldsHelper",void 0),(0,g._)([(0,y.Cb)({type:Number})],p.prototype,"maximumNumberOfFeatures",null),(0,g._)([(0,y.Cb)({readOnly:!0})],p.prototype,"maximumNumberOfFeaturesExceeded",null),(0,g._)([(0,y.Cb)()],p.prototype,"_excludeObjectIdsSorted",null),(0,g._)([(0,y.Cb)({readOnly:!0})],p.prototype,"lodFactor",null),(0,g._)([(0,y.Cb)({readOnly:!0})],p.prototype,"hasM",null),(0,g._)([(0,y.Cb)({readOnly:!0})],p.prototype,"hasZ",null),(0,g._)([(0,y.Cb)()],p.prototype,"contentVisible",null),(0,g._)([(0,y.Cb)({readOnly:!0})],p.prototype,"legendEnabled",null),p=(0,g._)([(0,_.j)("esri.views.3d.layers.SceneLayerGraphicsView3D")],p);const Ce=p;function P(t){return"geometryBuffer"in t&&null!==t.geometryBuffer}function T(t){const e=t.attributeInfo,i=t.node.index;if(null!=e?.loadedAttributes&&null!=e.attributeData)for(let r=0;r<t.graphics.length;r++){const s=t.graphics[r];if(s.nodeIndex===i){s.attributes||(s.attributes={});for(const{name:o}of e.loadedAttributes)e.attributeData[o]&&(s.attributes[o]=(0,N.Jx)(e.attributeData[o],r))}}}const De={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},I=(0,V.Ue)(),m={graphic:null,property:null,oldValue:null,newValue:null}}}]);