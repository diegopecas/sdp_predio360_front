"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[5740],{30750:(Pe,Q,l)=>{l.d(Q,{S:()=>_,b:()=>V});var g=l(2166),A=l(69960),H=l(65787),p=l(17625),G=l(22355),N=l(16396);function V(D){const B=new G.kG,{vertex:Z,fragment:$,attributes:J,varyings:q}=B;return(0,g.Sv)(Z,D),J.add(N.T.POSITION,"vec3"),J.add(N.T.UV0,"vec2"),q.add("vUV","vec2"),Z.code.add(p.H`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),$.uniforms.add(new A.N("backgroundColor",K=>K.backgroundColor),new A.N("gridColor",K=>K.gridColor),new H.p("gridWidth",K=>K.gridWidth)),$.code.add(p.H`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
fragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),B}const _=Object.freeze(Object.defineProperty({__proto__:null,build:V},Symbol.toStringTag,{value:"Module"}))},128:(Pe,Q,l)=>{l.d(Q,{B:()=>Z});var g=l(26584),A=l(50011),H=l(22558),p=l(21726),G=l(35948),N=l(34117),V=l(31283),_=l(77712),D=l(61556),B=l(29840);function Z(d){const C=d?.origins??[void 0];return(T,I)=>{const b=function $(d,C,T){if("resource"===d?.type)return function J(d,C,T){const I=(0,N.Oe)(C,T);return{type:String,read:(b,M,r)=>{const P=(0,B.r)(b,M,r);return I.type===String?P:"function"==typeof I.type?new I.type({url:P}):void 0},write:{writer(b,M,r,P){if(!P?.resources)return"string"==typeof b?void(M[r]=(0,B.t)(b,P)):void(M[r]=b.write({},P));const Y=function he(d){return null==d?null:"string"==typeof d?d:d.url}(b),X=(0,B.t)(Y,{...P,verifyItemRelativeUrls:P?.verifyItemRelativeUrls?{writtenUrls:P.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},B.M.NO),S=I.type!==String&&(!(0,H.l)(this)||P?.origin&&this.originIdOf(T)>(0,V.M9)(P.origin)),ee={object:this,propertyName:T,value:b,targetUrl:X,dest:M,targetPropertyName:r,context:P,params:d};P?.portalItem&&X&&!(0,p.YP)(X)?S&&d?.contentAddressed?q(ee):S?function K(d){const{context:C,targetUrl:T,params:I,value:b,dest:M,targetPropertyName:r}=d;if(!C.portalItem)return;const P=C.portalItem.resourceFromPath(T),Y=U(b,T,C),X=(0,D.B)(Y),S=(0,p.Ml)(P.path),ee=I?.compress??!1;X===S?(C.resources&&ae({...d,resource:P,content:Y,compress:ee,updates:C.resources.toUpdate}),M[r]=T):q(d)}(ee):function R({context:d,targetUrl:C,dest:T,targetPropertyName:I}){d.portalItem&&d.resources&&(d.resources.toKeep.push({resource:d.portalItem.resourceFromPath(C),compress:!1}),T[I]=C)}(ee):P?.portalItem&&(null==X||null!=(0,B.i)(X)||(0,p.jc)(X)||S)?q(ee):M[r]=X}}}}(d,C,T);switch(d?.type??"other"){case"other":return{read:!0,write:!0};case"url":{const{read:I,write:b}=B.b;return{read:I,write:b}}}}(d,T,I);for(const M of C){const r=(0,_.CJ)(T,M,I);for(const P in b)r[P]=b[P]}}}function q(d){const{targetUrl:C,params:T,value:I,context:b,dest:M,targetPropertyName:r}=d;if(!b.portalItem)return;const P=(0,B.p)(C),Y=U(I,C,b);if(T?.contentAddressed&&"json"!==Y.type)return void b.messages?.push(new g.Z("persistable:contentAddressingUnsupported",`Property "${r}" is trying to serializing a resource with content of type ${Y.type} with content addressing. Content addressing is only supported for json resources.`,{content:Y}));const X=T?.contentAddressed&&"json"===Y.type?(0,A.F)(Y.jsonString):P?.filename??(0,G.DO)(),S=(0,p.v_)(T?.prefix??P?.prefix,X),ee=`${S}.${(0,D.B)(Y)}`;if(T?.contentAddressed&&b.resources&&"json"===Y.type){const ce=b.resources.toKeep.find(({resource:se})=>se.path===ee)??b.resources.toAdd.find(({resource:se})=>se.path===ee);if(ce)return void(M[r]=ce.resource.itemRelativeUrl)}const Me=b.portalItem.resourceFromPath(ee);(0,p.jc)(C)&&b.resources&&b.resources.pendingOperations.push((0,p.gi)(C).then(ce=>{Me.path=`${S}.${(0,D.B)({type:"blob",blob:ce})}`,M[r]=Me.itemRelativeUrl}).catch(()=>{}));const u=T?.compress??!1;b.resources&&ae({...d,resource:Me,content:Y,compress:u,updates:b.resources.toAdd}),M[r]=Me.itemRelativeUrl}function ae({object:d,propertyName:C,updates:T,resource:I,content:b,compress:M}){T.push({resource:I,content:b,compress:M,finish:P=>{!function x(d,C,T){"string"==typeof d[C]?d[C]=T.url:d[C].url=T.url}(d,C,P)}})}function U(d,C,T){return"string"==typeof d?{type:"url",url:C}:{type:"json",jsonString:JSON.stringify(d.toJSON(T))}}},22558:(Pe,Q,l)=>{function g(A){return A&&"getAtOrigin"in A&&"originOf"in A}l.d(Q,{l:()=>g})},60595:(Pe,Q,l)=>{l.d(Q,{T:()=>p});var g=l(15861),A=l(84792),H=l(26584);function p(N,V,_,D,B,Z,$){return G.apply(this,arguments)}function G(){return(G=(0,g.Z)(function*(N,V,_,D,B,Z,$){let J=null;if(null!=_){const ae=`${N}/nodepages/`,U=ae+Math.floor(_.rootIndex/_.nodesPerPage);try{return{type:"page",rootPage:(yield(0,A.Z)(U,{query:{f:"json",...D,token:B},responseType:"json",signal:$})).data,rootIndex:_.rootIndex,pageSize:_.nodesPerPage,lodMetric:_.lodSelectionMetricType,urlPrefix:ae}}catch(he){Z?.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",U,he),J=he}}if(!V)return null;const q=V?.split("/").pop(),K=`${N}/nodes/`,R=K+q;try{return{type:"node",rootNode:(yield(0,A.Z)(R,{query:{f:"json",...D,token:B},responseType:"json",signal:$})).data,urlPrefix:K}}catch(ae){throw new H.Z("sceneservice:root-node-missing","Root node missing.",{pageError:J,nodeError:ae,url:R})}})).apply(this,arguments)}},61556:(Pe,Q,l)=>{l.d(Q,{B:()=>A});var g=l(21726);function A(D){return G[function H(D){return"json"===D.type?"application/json":"blob"===D.type?D.blob.type:function p(D){const B=(0,g.Ml)(D);return _[B]||N}(D.url)}(D)]||V}const G={},N="text/plain",V=G[N],_={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const D in _)G[_[D]]=D},47363:(Pe,Q,l)=>{l.r(Q),l.d(Q,{default:()=>qi});var g=l(17626),A=l(83761),H=l(62208),p=l(77712),G=l(8314),N=l(63290),_=(l(4619),l(76898)),D=l(1437),Z=(l(29132),l(79608)),$=l(23719),J=l(86810),q=l(66656),K=l(90912),R=l(128),ae=l(72642);let U=class extends((0,Z.J)(J.wq)){constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&(0,H._W)(this.position,e.position)&&this.width===e.width&&this.height===e.height}};(0,g._)([(0,p.Cb)({readOnly:!0,json:{read:!1,write:!0}})],U.prototype,"type",void 0),(0,g._)([(0,p.Cb)({type:ae.Z}),(0,R.B)()],U.prototype,"position",void 0),(0,g._)([(0,p.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,R.B)(),(0,q.p)(e=>$.BV.normalize((0,K.q9)(e),0,!0))],U.prototype,"heading",void 0),(0,g._)([(0,p.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,R.B)(),(0,q.p)(e=>$.BV.normalize((0,K.q9)(e),0,!0))],U.prototype,"tilt",void 0),(0,g._)([(0,p.Cb)({type:Number,nonNullable:!0}),(0,R.B)()],U.prototype,"width",void 0),(0,g._)([(0,p.Cb)({type:Number,nonNullable:!0}),(0,R.B)()],U.prototype,"height",void 0),U=(0,g._)([(0,_.j)("esri.analysis.SlicePlane")],U);const he=U;var x=l(32917),d=l(41743),C=l(44917),T=l(49410),I=l(21286),b=l(23841),M=l(52113),r=l(79800),P=l(29302),Y=l(55915),X=l(78172),S=l(90014),ee=l(70562),Me=l(34054),u=l(26242),ce=l(78260),se=l(1503);const ze=(0,se.al)(0,0,0,.04);function lt({accentColor:e}){return(0,ce.Ch)(e,.5)}function Fe({accentColor:e}){return(0,ce.Ch)(e,.7)}const Ze=(0,G.Z)("mac")?"Meta":"Control",Ke="Shift",Wt=1.15,jt=1.15,Nt=Math.cos((0,I.Vl)(45)),ot=Math.cos((0,I.Vl)(5)),dt=1,Ft=3,ut=11,Ye=22.5,Re=40,ht=48,Zt=2.25,Yt=.3,Qt=6,$t=4;var vt=l(54865),Ce=l(19142),Xt=l(87469),yt=l(63657),kt=l(53928),le=l(57521),ne=l(40723),qt=l(13934),ei=l(87601),ii=l(60881),ai=l(5894),si=l(2770),ni=l(66131),ri=l(15842),li=l(17625),oi=l(651),ci=l(91056),di=l(39114),ui=l(12407),hi=l(30750),Te=l(67969),Qe=l(2078);class pi extends li.K{constructor(){super(...arguments),this.backgroundColor=(0,se.al)(1,0,0,.5),this.gridColor=(0,se.al)(0,1,0,.5),this.gridWidth=4}}class xe extends ci.A{initializeProgram(t){return new ui.$(t.rctx,xe.shader.get().build(this.configuration),di.i)}initializePipeline(){return(0,Qe.sm)({blending:(0,Qe.wK)(Te.zi.ONE,Te.zi.ONE,Te.zi.ONE_MINUS_SRC_ALPHA,Te.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:Te.wb.LESS},colorWrite:Qe.BK})}}xe.shader=new oi.J(hi.S,()=>l.e(5175).then(l.bind(l,15175)));class gi extends ri.c{constructor(t){super(t,new yi),this.produces=new Map([[ai.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,i=>i===qt.H_.Color]]),this._configuration=new ei.m}createBufferWriter(){return new si.G(ni.W1)}createGLMaterial(t){return new vi(t)}getConfiguration(){return this._configuration}}class vi extends ii.Z{constructor(t){super(t),this.ensureTechnique(xe,null)}beginSlot(){return this.technique}}class yi extends pi{constructor(){super(...arguments),this.renderOccluded=ne.yD.Occlude,this.isDecoration=!1}}class fi extends kt._{constructor(t){super(t),this._material=null,this._renderOccluded=ne.yD.OccludeAndTransparent,this._gridWidth=1,this._gridColor=(0,se.al)(1,0,0,1),this._backgroundColor=(0,se.al)(1,0,0,1),this.applyProperties(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(t){this._gridWidth!==t&&(this._gridWidth=t,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(t){(0,yt.c)(this._gridColor,t),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){(0,yt.c)(this._backgroundColor,t),this._updateMaterial()}createExternalResources(){this._material=new gi(this._materialParameters)}destroyExternalResources(){this._material=null}forEachExternalMaterial(t){null!=this._material&&t(this._material)}createGeometries(t){if(null!=this._material){const i=(0,le.g7)(this._material);t.addGeometry(i)}}get _materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){null!=this._material&&this._material.setParameters(this._materialParameters)}}var ue,e,ft=l(60011),we=l(26046),z=l(33786);function mt(e,t){return(0,Ce.Aq)(e.basis1,e.basis2,e.origin,t)}function Pt(e,t,i,a){const s=t.worldUpAtPosition(e.origin,u.WM.get()),o=u.WM.get();switch(i){case be.HEADING:(0,r.c)(o,s);break;case be.TILT:(0,r.c)(o,e.basis1)}return(0,S.Yq)(e.origin,o,a)}function $e(e,t){switch(t){case ue.POSITIVE_X:return{basis:e.basis1,direction:1,position:(0,r.g)(u.WM.get(),e.origin,e.basis1),edge:t};case ue.POSITIVE_Y:return{basis:e.basis2,direction:1,position:(0,r.g)(u.WM.get(),e.origin,e.basis2),edge:t};case ue.NEGATIVE_X:return{basis:e.basis1,direction:-1,position:(0,r.f)(u.WM.get(),e.origin,e.basis1),edge:t};case ue.NEGATIVE_Y:return{basis:e.basis2,direction:-1,position:(0,r.f)(u.WM.get(),e.origin,e.basis2),edge:t}}}function Mt(e,t,i){const a=i.projectToRenderScreen((0,r.g)(u.WM.get(),e,t),(0,b.Wv)(u.WM.get())),s=i.projectToRenderScreen((0,r.f)(u.WM.get(),e,t),(0,b.Wv)(u.WM.get()));return(0,r.p)((0,r.f)(a,a,s))}function wt(e){const t=(0,r.l)(e.basis1),i=(0,r.l)(e.basis2);return Yt*Math.min(t,i)}function Je(e){return wt(e)}function Xe(e){return 0!==e.direction[0]&&0!==e.direction[1]}function bt(e){return new Xt.r({view:e,attached:!1,color:Fe(e.effectiveTheme),width:dt,renderOccluded:ne.yD.OccludeAndTransparent,geometry:[[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]]],isDecoration:!0})}function _t(e){return new fi({view:e,attached:!1,backgroundColor:ze,gridColor:lt(e.effectiveTheme),gridWidth:4,renderOccluded:ne.yD.OccludeAndTransparent,isDecoration:!0})}function Et(e,t,i,a=new he){if(null==e)return null;const{renderCoordsHelper:s}=t,o=s.fromRenderCoords(e.origin,new ae.Z({spatialReference:t.spatialReference}));if(null==o)return null;const n=(0,Y.tryProjectWithZConversion)(o,i);if(null==n)return null;a.position=n;const c=2*(0,r.l)(e.basis1),h=2*(0,r.l)(e.basis2),m=ft.Z.renderUnitScaleFactor(t.spatialReference,i);a.width=c*m,a.height=h*m;const v=s.worldUpAtPosition(e.origin,u.WM.get());return a.tilt=(0,I.BV)(ke(e,v)),a.heading=s.headingAtPosition(e.origin,e.basis1)-90,a}function ke(e,t){return(0,Me.cp)(t,e.basis2,e.basis1)+_e}l(2004),(e=ue||(ue={}))[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y";const k=z.jg.Custom1;var be,re;(function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"})(be||(be={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"}(re||(re={}));const Ae=z.jg.Custom2,Ue=(0,ee.Ue)(),_e=Math.PI/2,qe=z.jg.Custom1,Si=z.jg.Custom2;function Ii(e){return null!=("building-scene-3d"===e.type?e:null)}var Ri=l(94573);let ve=class extends A.Z{constructor(e){super(e),this._internalChange=!1,this._currentSlicePlane=null}initialize(){this.addHandles(this.analysis.excludedLayers.on("before-add",e=>{const t=e.item;null!=t&&(t instanceof C.Z||t instanceof T.Z)?t instanceof C.Z&&function xi(e){switch(e.type){case"building-scene":case"catalog":case"catalog-dynamic-group":case"catalog-footprint":case"csv":case"dimension":case"feature":case"geo-rss":case"geojson":case"graphics":case"group":case"integrated-mesh":case"integrated-mesh-3dtiles":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-notes":case"ogc-feature":case"oriented-imagery":case"point-cloud":case"route":case"scene":case"stream":case"voxel":case"subtype-group":case"unknown":case"unsupported":case"wfs":case null:return!1;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"elevation":case"imagery":case"imagery-tile":case"map-image":case"media":case"open-street-map":case"tile":case"vector-tile":case"video":case"wcs":case"web-tile":case"wms":case"wmts":return!0;default:return(0,Ri.Bg)(e.type),!1}}(t)?(N.Z.getLogger(this).error("excludedLayers",`Layer '${t.title}, id:${t.id}' of type '${t.type}' can not be individually excluded from slicing. Use 'excludeGroundSurface' instead.`),e.preventDefault()):this.analysis.excludedLayers.includes(t)&&e.preventDefault():(N.Z.getLogger(this).error("excludedLayers","Invalid layer type, layer must derive from Layer or BuildingComponentSublayer"),e.preventDefault())})),function Ui(e,t){ye.has(e)||ye.set(e,{all:[],activeController:null}),ye.get(e)?.all.push(t)}(this.view,this),this.addHandles([(0,x.YP)(()=>this.analysisViewData.plane,()=>{this._internalChange||this._updateSlicePlaneFromBoundedPlane(),this._updateLayerViews()},{sync:!0}),(0,x.YP)(()=>this.analysis.excludeGroundSurface,()=>this._updateLayerViews(),{sync:!0}),this.analysis.excludedLayers.on("change",()=>this._updateLayerViews()),(0,x.YP)(()=>[this.analysisViewData.active,this.analysisViewData.visible],()=>{this._updateActiveController(),this._updateViewSlicePlane()},{sync:!0}),(0,x.YP)(()=>this._allLayerAndSubLayerViews,()=>this._updateLayerViews())]),this.addHandles([(0,x.YP)(()=>this.analysis.shape,()=>{this._internalChange||(this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane())},{sync:!0})],"analysis"),this._updateActiveController(),this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane()}destroy(){this.analysisViewData.active&&(this.analysisViewData.active=!1,this.view.slicePlane=null,this._updateActiveController(),this._updateViewSlicePlane()),function Li(e,t){if(!ye.has(e))throw new Error("view expected in global slice register");const i=ye.get(e),a=i?.all.lastIndexOf(t)??-1;if(!i||-1===a)throw new Error("controller expected in global slice register");i.all.splice(a,1),0===i.all.length&&ye.delete(e)}(this.view,this),this.set("view",null)}get _allLayerAndSubLayerViews(){const e=this.view.allLayerViews.items;return e.concat(e.filter(Ii).flatMap(({sublayerViews:t})=>t.items))}_updateBoundedPlaneFromSlicePlane(){const e=this.analysis.shape,t=this._currentSlicePlane;if(null==t&&null==e||null!=t&&null!=e&&e.equals(t))return;let i=null,a=null;if(null!=e?.position){const s=e.position.spatialReference,o=function Ct(e,t){if(null==e?.position)return null;const i=(0,vt.G)(e.position,t.spatialReference,t.elevationProvider);if(null==i)return null;const a=ft.Z.renderUnitScaleFactor(e.position.spatialReference,t.spatialReference);return{position:i,heading:e.heading,tilt:e.tilt,renderWidth:e.width*a,renderHeight:e.height*a}}(e,this.view);null==o&&(0,vt.e)(this.analysis,s,N.Z.getLogger(this)),i=function Tt(e,t,i,a=(0,d.a)()){if(null==e)return null;const s=function Oi(e,t,i,a,s,o,n=(0,d.a)()){return o.toRenderCoords(e,n.origin)?(o.worldBasisAtPosition(n.origin,X.R.X,n.basis1),o.worldBasisAtPosition(n.origin,X.R.Y,n.basis2),(0,S.my)(n.basis2,n.basis1,n.origin,n.plane),(0,d.r)(n,-(0,I.Vl)(t),(0,d.n)(n),n),(0,d.r)(n,(0,I.Vl)(i),n.basis1,n),(0,r.h)(n.basis1,n.basis1,a/2),(0,r.h)(n.basis2,n.basis2,s/2),(0,d.u)(n),n):(N.Z.getLogger("esri.views.3d.analysis.Slice.sliceToolUtils").error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}(e.position,e.heading,e.tilt,e.renderWidth,e.renderHeight,t.renderCoordsHelper,a);return i.tiltEnabled||null==s||function Mi(e,t,i){const a=t.worldUpAtPosition(e.origin,u.WM.get()),s=e.basis1,o=ke(e,a),n=Math.round(o/_e)*_e;(0,d.r)(e,n-o,s,i)}(s,t.renderCoordsHelper,s),s}(o,this.view,{tiltEnabled:this.analysis.tiltEnabled},(0,d.a)()),null!=i&&(a={heading:e.heading,tilt:e.tilt,position:e.position,width:e.width,height:e.height})}this._currentSlicePlane=a,this._internalChange=!0,this.analysisViewData.plane=i,this._internalChange=!1}_updateSlicePlaneFromBoundedPlane(){const t=Et(this.analysisViewData.plane,this.view,this.view.spatialReference,new he);let i=null;null!=t&&(i={heading:t.heading,tilt:t.tilt,position:t.position,width:t.width,height:t.height}),this._currentSlicePlane=i,this._internalChange=!0,this.analysis.shape=t,this._internalChange=!1,this._updateViewSlicePlane()}_updateActiveController(){if(et)return;const e=Vt(this.view);if(e)if(this.analysisViewData.active)null!=e.activeController&&e.activeController!==this&&(et=!0,e.activeController.analysisViewData.active=!1,et=!1),this._updateLayerViews(),e.activeController=this;else{if(null!=e.activeController&&e.activeController!==this)return;null!=e.activeController&&e.activeController===this&&(e.activeController=null,this._updateLayerViews())}}_updateViewSlicePlane(){!function Ai(e){const i=Vt(e)?.activeController;e.slicePlane=null!=i?.analysisViewData.plane&&i.analysisViewData.visible?i.analysisViewData.plane:null}(this.view)}_updateLayerViews(){const e=null!=this.analysisViewData.plane&&this.analysisViewData.visible&&this.analysisViewData.active,t=[],i=a=>{"layers"in a?a.layers.forEach(i):t.push(a)};this.analysis.excludedLayers.forEach(i),this.view.allLayerViews.forEach(a=>{a.destroyed||("slicePlaneEnabled"in a&&(a.slicePlaneEnabled=e&&!t.includes(a.layer)),"sublayerViews"in a&&a.sublayerViews.forEach(s=>{s.slicePlaneEnabled=e&&!t.includes(s.sublayer)}))}),null!=this.view.basemapTerrain&&(this.view.basemapTerrain.slicePlaneEnabled=e&&!this.analysis.excludeGroundSurface)}};(0,g._)([(0,p.Cb)()],ve.prototype,"view",void 0),(0,g._)([(0,p.Cb)()],ve.prototype,"analysis",void 0),(0,g._)([(0,p.Cb)()],ve.prototype,"analysisViewData",void 0),(0,g._)([(0,p.Cb)()],ve.prototype,"_allLayerAndSubLayerViews",null),ve=(0,g._)([(0,_.j)("esri.views.3d.analysis.Slice.SliceController")],ve);const ye=new Map;let et=!1;function Vt(e){return ye.get(e)}var Wi=l(84244),ji=l(50618),Dt=l(33515),pe=l(91558),tt=l(45403),te=l(40345),Ve=l(92222);class Hi extends tt.Z{constructor(t,i){const a=Xe(i),s=a?4:1,o=2*s,c={renderOccluded:ne.yD.OccludeAndTransparent,isDecoration:!0},h=new Ve.U({...c,width:s}),m=new Ve.U({...c,width:o}),v=new Ve.U({...c,width:1});super({view:t,...Ce.X9,...Bi({isCorner:a,unfocusedMaterial:h,focusedMaterial:m,outlineMaterial:v})}),this._themeHandle=(0,x.YP)(()=>t.effectiveTheme.accentColor,w=>{const O=pe.Z.toUnitRGBA(w);h.setParameters({color:O}),m.setParameters({color:O}),v.setParameters({color:O})},x.nn)}destroy(){this._themeHandle.remove(),super.destroy()}}function Bi({isCorner:e,unfocusedMaterial:t,focusedMaterial:i,outlineMaterial:a}){const s=e?[(0,P.al)(1,0,0),(0,P.al)(0,0,0),(0,P.al)(0,1,0)]:[(0,P.al)(1,0,0),(0,P.al)(-1,0,0)];return{renderObjects:[new te.r((0,le.rh)(t,s),z.Q9.Unfocused|qe),new te.r((0,le.rh)(i,s),z.Q9.Focused|qe),new te.r((0,le.rh)(a,s),Si)],collisionType:{type:"line",paths:[s]},radius:e?Qt:$t,state:qe}}var Ot=l(94255),Ni=l(41120),St=l(16396),Gi=l(79967);class It extends tt.Z{constructor(t,i){const a=new Gi.j({transparent:!0,writeDepth:!1,renderOccluded:ne.yD.Opaque,isDecoration:!0}),o=new Ve.U({width:Ce.vQ.calloutWidth,renderOccluded:ne.yD.OccludeAndTransparent,isDecoration:!0});super({view:t,...zi({imageMaterial:a,calloutMaterial:o})}),this._currentTexture=null,this._themeHandle=(0,x.YP)(()=>t.effectiveTheme.accentColor,n=>{const c=(0,ce.G)(n,.5),h=(0,ce.mj)(n),m=this._currentTexture,v=i(c,h);a.setParameters({textureId:v.texture.id}),o.setParameters({color:pe.Z.toUnitRGBA(n)}),this._currentTexture=v,m?.release()},x.nn)}destroy(){this._themeHandle.remove(),this._currentTexture?.release(),super.destroy()}}function zi({imageMaterial:e,calloutMaterial:t}){const{focusMultiplier:i,calloutLength:a,discRadius:s}=Ce.vQ,o=s*i,n=(v,w)=>{const O=[0,1,2,2,3,0];return new Ni.Z(w,[[St.T.POSITION,new Ot.a([a-v,-v,0,a+v,-v,0,a+v,v,0,a-v,v,0],O,3,!0)],[St.T.UV0,new Ot.a([0,0,1,0,1,1,0,1],O,2,!0)]])},c=(0,le.rh)(t,[[0,0,0],[a-s,0,0]]),h=(0,le.rh)(t,[[0,0,0],[a-o,0,0]]),m=k;return{autoScaleRenderObjects:!1,collisionPriority:1,collisionType:{type:"disc",direction:[0,0,1],offset:[a,0,0]},focusMultiplier:i,radius:s,renderObjects:[new te.r(n(s,e),z.Q9.Unfocused|m),new te.r(c,z.Q9.Unfocused|m),new te.r(n(o,e),z.Q9.Focused|m),new te.r(h,z.Q9.Focused|m)],state:m}}var je,it=l(74741),Rt=l(32056),Le=l(42743),We=l(92972);!function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"}(je||(je={}));class Fi extends tt.Z{constructor(t,i){const a=new Ve.U({width:1,renderOccluded:ne.yD.OccludeAndTransparent,isDecoration:!0}),s=new We.E({cullFace:Le.Vr.Back,renderOccluded:ne.yD.Opaque,isDecoration:!0}),o=new We.E({cullFace:Le.Vr.Back,renderOccluded:ne.yD.Opaque,isDecoration:!0}),n=new We.E({cullFace:Le.Vr.Back,renderOccluded:ne.yD.Opaque,isDecoration:!0}),c=new We.E({writeDepth:!1,cullFace:Le.Vr.Front,renderOccluded:ne.yD.Transparent,isDecoration:!0});super({view:t,...Zi({offsetMode:i,tubeMaterial:s,tipMaterial:o,capMaterial:n,outlineMaterial:c,calloutMaterial:a})}),this._themeHandle=(0,x.YP)(()=>t.effectiveTheme.accentColor,h=>{const m=(0,ce.mj)(h),v=pe.Z.toUnitRGBA(h),w=pe.Z.toUnitRGBA(m),O=pe.Z.toUnitRGBA(pe.Z.blendColors(m,h,.4)),W=pe.Z.toUnitRGBA(pe.Z.blendColors(m,h,.14));a.setParameters({color:v}),s.setParameters({color:W}),o.setParameters({color:w}),n.setParameters({color:O}),c.setParameters({color:v})},x.nn)}destroy(){this._themeHandle.remove(),super.destroy()}}function Zi({offsetMode:e,tubeMaterial:t,tipMaterial:i,capMaterial:a,outlineMaterial:s,calloutMaterial:o}){const n=e===je.CENTER_ON_CALLOUT?Re:0,c=[(0,P.al)(n,0,-ht/2),(0,P.al)(n,0,ht/2)],h=function Yi(e,t){const i=(0,r.f)((0,P.Ue)(),e[e.length-1],e[e.length-2]);if((0,r.n)(i,i),(0,r.h)(i,i,Ye),(0,r.g)(i,i,e[e.length-1]),t){const a=(0,r.f)((0,P.Ue)(),e[0],e[1]);return(0,r.n)(a,a),(0,r.h)(a,a,Ye),(0,r.g)(a,a,e[0]),[a,...e,i]}return[...e,i]}(c,!0),m=xt({vertices:c,padding:0,materials:{tube:t,tip:i,cap:a}}),v=xt({vertices:c,padding:Zt,materials:{tube:s,tip:s,cap:s}}),w=(0,le.rh)(o,[[n,0,0],[n-Re,0,0]]),O=(0,le.rh)(o,[[n,0,0],[n-Re,0,0]]);return{renderObjects:[...m.normal.map(W=>new te.r(W,z.Q9.Unfocused|k)),...v.normal.map(W=>new te.r(W,z.Q9.Unfocused|k)),new te.r(w,z.Q9.Unfocused|k|Ae),...m.focused.map(W=>new te.r(W,z.Q9.Focused|k)),...v.focused.map(W=>new te.r(W,z.Q9.Focused|k)),new te.r(O,z.Q9.Focused|k|Ae)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[h]},collisionPriority:1,radius:ut,state:k}}function xt({vertices:e,padding:t,materials:i}){const a=s=>{const o=e.slice(0),n=(0,r.f)(u.WM.get(),o[0],o[1]);(0,r.n)(n,n);const c=(0,r.f)(u.WM.get(),o[o.length-1],o[o.length-2]);if((0,r.n)(c,c),t>0){const Ie=(0,r.h)((0,P.Ue)(),c,-t);o[o.length-1]=(0,r.g)(Ie,Ie,o[o.length-1]);const Ee=(0,r.h)((0,P.Ue)(),n,-t);o[0]=(0,r.g)(Ee,Ee,o[0])}const h=s?jt:1,m=Ye*h,v=ut*h,w=(0,M.yR)(u.MP.get());if(t>0){const Ie=m/4,Ee=(0,r.s)(u.WM.get(),0,Ie,0),Ge=1+t/Ie;(0,M.Iu)(w,w,Ee),(0,M.bA)(w,w,(0,r.s)(u.WM.get(),Ge,Ge,Ge)),(0,M.Iu)(w,w,(0,r.h)(Ee,Ee,-1/Ge))}const O=(0,M.yR)((0,it.Ue)()),W=(0,P.al)(0,1,0),ie=(0,M.en)((0,it.Ue)(),(0,Rt.b0)(u.vD.get(),W,c));ie[12]=o[o.length-1][0],ie[13]=o[o.length-1][1],ie[14]=o[o.length-1][2],(0,M.Jp)(ie,ie,w);const fe=function Ki(e,t,i){const a=[];for(let o=0;o<12;o++){const n=o/12*2*Math.PI;a.push([Math.cos(n)*e,Math.sin(n)*e])}return(0,le.x2)(i,a,t,[],[],!1)}(Ft*(s?Wt:1)+t,o,i.tube);fe.transformation=O;const oe=[fe],Se=(0,le.QL)(i.tip,m,v,24,!1,!1,!0);Se.transformation=ie,oe.push(Se);const rt=(0,le.QL)(i.cap,m,v,24,!1,!0,!1);rt.transformation=ie,oe.push(rt);const me=(0,M.en)((0,it.Ue)(),(0,Rt.b0)(u.vD.get(),W,n));return me[12]=o[0][0],me[13]=o[0][1],me[14]=o[0][2],(0,M.Jp)(me,me,w),oe.push(Se.instantiate({transformation:me})),oe.push(rt.instantiate({transformation:me})),oe};return{normal:a(!1),focused:a(!0)}}var at,He=l(8859),Qi=l(58997),Be=l(30260),$i=l(59278),De=l(41900);let F=at=class extends Qi.f{constructor(e){super(e),this._clock=Wi.m,this._previewPlaneOpacity=1,this.removeIncompleteOnCancel=!1,this._layersMode="none",this.shiftManipulator=null,this.rotateHeadingManipulator=null,this.rotateTiltManipulator=null,this.resizeManipulators=null,this._frameTask=null,this._pointerMoveTimerMs=2500,this._prevPointerMoveTimeout=null,this._previewPlaneGridVisualElement=null,this._previewPlaneOutlineVisualElement=null,this._startPlane=(0,d.a)(),this._previewPlane=null,this._activeKeyModifiers={},this._lastCursorPosition=(0,b.vW)(),this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._intersector=(0,$i.w)(e.view.state.viewingMode)}initialize(){if(null==this.analysis)throw new Error("SliceTool requires valid analysis, but null was provided.");const e=n=>{this._updateManipulatorsInteractive(n),n.grabbing||(null!=this.analysisViewData.plane&&(0,d.c)(this.analysisViewData.plane,this._startPlane),this.inputState=null)},t=new Fi(this.view,je.CENTER_ON_ARROW);this.shiftManipulator=t,this.manipulators.add(t),this.addHandles([this._createShiftDragPipeline(t),t.events.on("grab-changed",n=>{this._onShiftGrab(n),e(t)})]);const i=!this.view._stage?.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result,a=new It(this.view,(n,c)=>(0,Dt.O)(this.view.textures,{accentColor:n,contrastColor:c,preMultiplyAlpha:i}));this.rotateHeadingManipulator=a,this.manipulators.add(a),this.addHandles([this._createRotateHeadingDragPipeline(a),a.events.on("grab-changed",n=>{this._onRotateHeadingGrab(n),e(a)})]);const s=new It(this.view,(n,c)=>(0,Dt.s)(this.view.textures,{accentColor:n,contrastColor:c,preMultiplyAlpha:i}));this.rotateTiltManipulator=s,this.manipulators.add(s),this.addHandles([this._createRotateTiltDragPipeline(s),s.events.on("grab-changed",n=>{this._onRotateTiltGrab(n),e(s)})]),this.resizeManipulators=this._resizeHandles.map((n,c)=>{const h=new Hi(this.view,n);return this.addHandles([this._createResizeDragPipeline(h),h.events.on("grab-changed",m=>{this._onResizeGrab(m,c),e(h)})]),h}),this.manipulators.addMany(this.resizeManipulators),this._previewPlaneGridVisualElement=_t(this.view),this._previewPlaneOutlineVisualElement=bt(this.view),this._previewPlaneOutlineVisualElement.width=2,this.addHandles((0,x.YP)(()=>[this.analysisViewData.plane,this.analysis.tiltEnabled],()=>this._updateManipulators(),x.Z_));const o=(0,x.YP)(()=>this.state,n=>{"sliced"===n&&this.finishToolCreation()},x.tX);this.addHandles([o,(0,x.YP)(()=>this.view.state.camera,()=>this._onCameraChange())])}destroy(){this._removeFrameTask(),this._clearPointerMoveTimeout(),this._previewPlaneOutlineVisualElement=(0,H.SC)(this._previewPlaneOutlineVisualElement),this._previewPlaneGridVisualElement=(0,H.SC)(this._previewPlaneGridVisualElement)}get state(){const e=!!this.analysisViewData.plane,t=!!this.inputState;return e?e&&t?"slicing":e&&!t?"sliced":"ready":"ready"}get cursor(){return this._isPlacingSlicePlane||"exclude"===this.layersMode?"crosshair":null!=this._creatingPointerId?"grabbing":null}set analysis(e){if(null==e)throw new Error("SliceTool requires valid analysis, but null was provided.");this.removeHandles("analysis"),this._set("analysis",e)}get layersMode(){return this._layersMode}get inputState(){return this._get("inputState")}set inputState(e){this._set("inputState",e),this.analysisViewData.showGrid=null!=e&&"resize"===e.type,this._updateMaterials()}get _isPlacingSlicePlane(){return!this.inputState&&!this.analysisViewData.plane&&this.active}get _creatingPointerId(){return null!=this.inputState&&"shift"===this.inputState.type?this.inputState.creatingPointerId:null}enterExcludeLayerMode(){null!=this.analysisViewData.plane&&(this._layersMode="exclude",this.active||(this.view.activeTool=this))}exitExcludeLayerMode(){null!=this.analysisViewData.plane&&(this._layersMode="none",this.active&&(this.view.activeTool=null))}onDeactivate(){this._updatePreviewPlane(null)}onShow(){this._updateVisibility(!0)}onHide(){this._updateVisibility(!1)}_updateVisibility(e){this._updateManipulators(),e||this._clearPointerMoveTimeout()}onInputEvent(e){switch(e.type){case"pointer-drag":if(!st(e))return;this._isPlacingSlicePlane?this._onClickPlacePlane(e)&&e.stopPropagation():this._onPointerDrag(e)&&e.stopPropagation();break;case"pointer-move":this._onPointerMove(e);break;case"pointer-up":this._onPointerUp(e)&&e.stopPropagation();break;case"immediate-click":if(!st(e))return;this._onClickPlacePlane(e)&&e.stopPropagation();break;case"click":if(!st(e))return;this._onClickExcludeLayer(e)&&e.stopPropagation();break;case"drag":this.inputState&&e.stopPropagation();break;case"key-down":this._onKeyDown(e)&&e.stopPropagation();break;case"key-up":this._onKeyUp(e)&&e.stopPropagation()}}onEditableChange(){this.analysisViewData.editable=this.internallyEditable}_onPointerDrag(e){const t=this.inputState;if(e.pointerId===this._creatingPointerId&&null!=t&&"shift"===t.type){const i=(0,De.vT)(e);return this.shiftManipulator.events.emit("drag",{action:t.hasBeenDragged?"update":"start",pointerType:e.pointerType,start:i,screenPoint:i}),t.hasBeenDragged=!0,!0}return!1}_onPointerMove(e){this._lastCursorPosition.x=e.x,this._lastCursorPosition.y=e.y,this._resetPointerMoveTimeout(),"touch"!==e.pointerType&&this._updatePreviewPlane((0,De.vT)(e),this._activeKeyModifiers)}_onCameraChange(){this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),this._updateManipulators()}_onPointerUp(e){if(e.pointerId===this._creatingPointerId&&null!=this.analysisViewData.plane){const t=(0,De.vT)(e);return this.shiftManipulator.events.emit("drag",{action:"end",start:t,screenPoint:t}),(0,d.c)(this.analysisViewData.plane,this._startPlane),this.inputState=null,!0}return!1}_onClickPlacePlane(e){if("exclude"===this.layersMode)return!1;if(this._isPlacingSlicePlane){const t=(0,De.vT)(e),i=(0,d.a)();if(this._pickPlane(t,!1,this._activeKeyModifiers,i)){if("pointer-drag"===e.type){const a=(0,we.j$)(this.view.state.camera,t,Oe);this.inputState=At(a,e.pointerId,i.origin,i)}return(0,d.c)(i,this._startPlane),this.analysis.shape=Et(i,this.view,this.view.spatialReference,new he),!0}}return!1}_onClickExcludeLayer(e){return!("exclude"!==this.layersMode||!this.created||(this.view.hitTest((0,De.vT)(e)).then(t=>{if(t.results.length){const i=t.results[0],a="graphic"===i?.type&&i.graphic;if(a){const s=a.sourceLayer||a.layer;s&&this.analysis.excludedLayers.push(s)}}else t.ground.layer?this.analysis.excludedLayers.push(t.ground.layer):this.analysis.excludeGroundSurface=!0}),this.exitExcludeLayerMode(),0))}_onKeyDown(e){return(e.key===Ke||e.key===Ze)&&(this._activeKeyModifiers[e.key]=!0,null!=this._previewPlane&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)}_onKeyUp(e){return!(e.key!==Ke&&e.key!==Ze||!this._activeKeyModifiers[e.key]||(delete this._activeKeyModifiers[e.key],null!=this._previewPlane&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),0))}_onShiftGrab(e){if("start"!==e.action||null==this.analysisViewData.plane||!e.screenPoint)return;const t=(0,we.j$)(this.view.state.camera,e.screenPoint,Oe);(0,d.c)(this.analysisViewData.plane,this._startPlane),this.inputState=At(t,null,this.shiftManipulator.renderLocation,this.analysisViewData.plane)}_createShiftDragPipeline(e){return(0,Be.Xd)(e,(t,i,a)=>{const s=this.inputState;if(null==s||"shift"!==s.type)return;const o=null!=this.analysisViewData.plane?(0,d.c)(this.analysisViewData.plane,(0,d.a)()):null;i.next((0,He._N)(this.view,s.shiftPlane)).next(this._shiftDragAdjustSensitivity(s)).next(this._shiftDragUpdatePlane(s)),a.next(()=>{null!=o&&this._updateBoundedPlane(o)})})}_shiftDragAdjustSensitivity(e){return t=>{if(null==this.analysisViewData.plane)return null;const a=Math.min((1-Math.abs((0,r.k)((0,d.n)(this.analysisViewData.plane),t.ray.direction)/(0,r.l)(t.ray.direction)))/.001,1),s=-(0,S.jH)(this._startPlane.plane,t.renderEnd),o=-(0,S.jH)(this._startPlane.plane,e.startPoint);return e.depth=e.depth*(1-a)+s*a-o,t}}_shiftDragUpdatePlane(e){return()=>{if(null==this.analysisViewData.plane)return;const t=(0,r.c)(u.WM.get(),this._startPlane.origin),i=(0,r.c)(u.WM.get(),(0,d.n)(this._startPlane));(0,r.h)(i,i,-e.depth),(0,r.g)(i,i,t);const a=(0,d.f)(i,this.analysisViewData.plane.basis1,this.analysisViewData.plane.basis2,(0,d.a)());this._updateBoundedPlane(a)}}_onRotateHeadingGrab(e){if("start"!==e.action||null==this.analysisViewData.plane||!e.screenPoint)return;const t=Pt(this.analysisViewData.plane,this.view.renderCoordsHelper,be.HEADING,(0,S.Ue)()),i=(0,we.j$)(this.view.state.camera,e.screenPoint,Oe),a=(0,P.Ue)();(0,S.BR)(t,i,a)&&((0,d.c)(this.analysisViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:t,startPoint:a})}_createRotateHeadingDragPipeline(e){return(0,Be.Xd)(e,(t,i,a)=>{const s=this.inputState;if(null==s||"rotate"!==s.type)return;const o=null!=this.analysisViewData.plane?(0,d.c)(this.analysisViewData.plane,(0,d.a)()):null;i.next((0,He._N)(this.view,s.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(s)).next(this._rotateDragUpdatePlaneFromRotate()),a.next(()=>{null!=o&&this._updateBoundedPlane(o)})})}_onRotateTiltGrab(e){if("start"!==e.action||null==this.analysisViewData.plane||!e.screenPoint)return;const t=Pt(this.analysisViewData.plane,this.view.renderCoordsHelper,be.TILT,(0,S.Ue)()),i=(0,we.j$)(this.view.state.camera,e.screenPoint,Oe),a=(0,P.Ue)();(0,S.BR)(t,i,a)&&((0,d.c)(this.analysisViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:t,startPoint:a})}_createRotateTiltDragPipeline(e){return(0,Be.Xd)(e,(t,i,a)=>{const s=this.inputState;if(null==s||"rotate"!==s.type)return;const o=null!=this.analysisViewData.plane?(0,d.c)(this.analysisViewData.plane,(0,d.a)()):null;i.next((0,He._N)(this.view,s.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(s)).next(this._rotateDragUpdatePlaneFromRotate()),a.next(()=>{null!=o&&this._updateBoundedPlane(o)})})}_rotateDragRenderPlaneToRotate(e){return t=>{if(null==this.analysisViewData.plane)return null;const i=(0,S.st)(e.rotatePlane),a=(0,Ce.Gd)(e.startPoint,t.renderEnd,this.analysisViewData.plane.origin,i);return{...t,rotateAxis:i,rotateAngle:a}}}_rotateDragUpdatePlaneFromRotate(){return e=>{if(null==this.analysisViewData.plane)return;const t=(0,M.Us)(u.MP.get(),e.rotateAngle,e.rotateAxis);if(null==t)return;const i=(0,r.e)(u.WM.get(),this._startPlane.basis1,t),a=(0,r.e)(u.WM.get(),this._startPlane.basis2,t),s=(0,d.f)(this.analysisViewData.plane.origin,i,a,(0,d.a)());this._updateBoundedPlane(s)}}_onResizeGrab(e,t){if("start"!==e.action||null==this.analysisViewData.plane||!e.screenPoint)return;const i=(0,we.j$)(this.view.state.camera,e.screenPoint,Oe),a=u.WM.get();(0,S.BR)(this.analysisViewData.plane.plane,i,a)&&((0,d.c)(this.analysisViewData.plane,this._startPlane),this.inputState={type:"resize",activeHandleIdx:t,startPoint:(0,P.d9)(a)})}_createResizeDragPipeline(e){return(0,Be.Xd)(e,(t,i,a)=>{const s=this.inputState;if(null==s||"resize"!==s.type||null==this.analysisViewData.plane)return;const o=(0,d.c)(this.analysisViewData.plane,(0,d.a)());i.next((0,He._N)(this.view,this.analysisViewData.plane.plane)).next(this._resizeDragUpdatePlane(s)),a.next(()=>{this._updateBoundedPlane(o)})})}_resizeDragUpdatePlane(e){return t=>{if(null==this.analysisViewData.plane)return;const a=function wi(e,t,i,a,s,o){const n=(0,r.c)(u.WM.get(),s.origin);(0,r.g)(n,n,(0,r.h)(u.WM.get(),s.basis1,e.direction[0]<0?1:-1)),(0,r.g)(n,n,(0,r.h)(u.WM.get(),s.basis2,e.direction[1]<0?1:-1));const c=(0,r.l)(s.basis1),h=(0,r.l)(s.basis2),m=(0,r.f)(u.WM.get(),i,n),v=(0,r.f)(u.WM.get(),t,n);let w=0,O=0;if(Xe(e)){const nt=Je(s),Se=Je(o);w=c-.5*e.direction[0]*(0,r.k)(s.basis1,v)/c,O=h-.5*e.direction[1]*(0,r.k)(s.basis2,v)/h;const Ne=Se/nt;w*=Ne,O*=Ne}const W=w+.5*e.direction[0]*(0,r.k)(s.basis1,m)/c,ie=O+.5*e.direction[1]*(0,r.k)(s.basis2,m)/h,j=(0,r.h)(u.WM.get(),s.basis1,W/c),fe=(0,r.h)(u.WM.get(),s.basis2,ie/h);(W<=0||Mt(o.origin,j,a)<=1600)&&(0,r.c)(j,o.basis1),(ie<=0||Mt(o.origin,fe,a)<=1600)&&(0,r.c)(fe,o.basis2);const oe=(0,r.c)(u.WM.get(),n);return(0,r.g)(oe,oe,(0,r.h)(u.WM.get(),j,e.direction[0]<0?-1:1)),(0,r.g)(oe,oe,(0,r.h)(u.WM.get(),fe,e.direction[1]<0?-1:1)),(0,d.f)(oe,j,fe,o)}(this._resizeHandles[e.activeHandleIdx],e.startPoint,t.renderEnd,this.view.state.camera,this._startPlane,(0,d.c)(this.analysisViewData.plane));this._updateBoundedPlane(a)}}_updateBoundedPlane(e){const t=this.analysisViewData;if(null==t)throw new Error("valid internal object expected");t.plane=e}_updatePreviewPlane(e,t={}){let i=this._previewPlane;if(this._previewPlane=null,null==e)return this._removeFrameTask(),void this._updateManipulators();if(!this.analysisViewData.plane&&this.active){const a=i??(0,d.a)();if(i=null!=i?(0,d.c)(i,Ji):null,this._pickPlane(e,!0,t,a)){const s=.95;let o=!1;null!=i&&(o=(0,r.k)((0,S.st)(i.plane),(0,S.st)(a.plane))<s||(0,r.k)((0,r.n)(u.WM.get(),i.basis1),(0,r.n)(u.WM.get(),a.basis1))<s),o&&(this._previewPlaneOpacity=0),this._previewPlane=a}}null!=this._previewPlane&&null==this._frameTask&&0===this._previewPlaneOpacity?this._frameTask=(0,ji.A)({update:({deltaTime:a})=>{this._previewPlaneOpacity=Math.min(this._previewPlaneOpacity+a/300,1),this._updateManipulators(),1===this._previewPlaneOpacity&&this._removeFrameTask()}}):null==this._previewPlane&&null!=this._frameTask?this._removeFrameTask():null!=this._previewPlane&&this._updateManipulators()}_removeFrameTask(){this._frameTask=(0,H.hw)(this._frameTask)}_pickMinResult(e){const t=(0,b.md)(e,u.qW.get());return this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector),this._intersector.results.min}_pickPlane(e,t,i,a){const s=this._pickMinResult(e),o=u.WM.get();if(!s.getIntersectionPoint(o))return!1;const n=s.getTransformedNormal(u.WM.get()),c=this.view.state.camera;(0,r.k)(n,c.viewForward)>0&&(0,r.h)(n,n,-1);const h=function bi(e,t){return.4*Math.min(t.width,t.height)*t.computeRenderPixelSizeAt(e)}(o,c),m=(t?1:-1)*h*.02,v=(0,r.h)(u.WM.get(),n,m);return(0,r.g)(v,v,o),function mi(e,t,i,a,s,o,n,c){return function Pi(e,t,i,a,s,o){const n=(0,r.k)(e,t),c=u.WM.get(),h=u.WM.get();switch(a===re.HORIZONTAL_OR_VERTICAL?Math.abs(n)>Nt?re.HORIZONTAL:re.VERTICAL:a){case re.VERTICAL:{const v=Math.abs(n)<=ot?e:i.viewUp;(0,r.b)(c,v,t),(0,r.c)(h,t);break}case re.HORIZONTAL:(0,r.b)(c,i.viewUp,t),(0,r.b)(h,t,c);break;case re.TILTED:{const v=Math.abs(n)<=ot?t:i.viewUp;(0,r.b)(c,v,e),(0,r.b)(h,e,c);break}}const m=(0,r.b)(u.WM.get(),c,h);(0,r.k)(m,i.viewForward)>0&&(0,r.h)(h,h,-1),(0,r.n)(s,c),(0,r.n)(o,h)}(t,n.worldUpAtPosition(e,u.WM.get()),s,o,c.basis1,c.basis2),(0,r.h)(c.basis1,c.basis1,i),(0,r.h)(c.basis2,c.basis2,a),(0,r.c)(c.origin,e),(0,S.my)(c.basis2,c.basis1,c.origin,c.plane),c}(v,n,h,h,c,i[Ke]?re.VERTICAL:i[Ze]?re.HORIZONTAL:this.analysis.tiltEnabled?re.TILTED:re.HORIZONTAL_OR_VERTICAL,this.view.renderCoordsHelper,a),!0}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=(0,H.hw)(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.shiftManipulator.state|=k,this.rotateHeadingManipulator.state|=k,this.rotateTiltManipulator.state|=k,this._prevPointerMoveTimeout=this._clock.setTimeout(()=>{this.shiftManipulator.state&=~k,this.rotateHeadingManipulator.state&=~k,this.rotateTiltManipulator.state&=~k},this._pointerMoveTimerMs)}_updateManipulators(){if(at.disableEngineLayers)return;let e,t=!1;if(null!=this.analysisViewData.plane)e=this.analysisViewData.plane,t=!1;else{if(null==this._previewPlane)return this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach(n=>n.available=!1),this._previewPlaneOutlineVisualElement.visible=!1,void(this._previewPlaneGridVisualElement.visible=!1);e=this._previewPlane,t=!0}const i=mt(e,u.MP.get());t?(this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach(n=>n.available=!1),this._previewPlaneOutlineVisualElement.attached=!0,this._previewPlaneGridVisualElement.attached=!0,this._previewPlaneOutlineVisualElement.visible=!0,this._previewPlaneGridVisualElement.visible=!0):(this.shiftManipulator.available=!0,this.rotateHeadingManipulator.available=!0,this.rotateTiltManipulator.available=this.analysis.tiltEnabled,this.resizeManipulators.forEach(n=>n.available=!0),function Ei(e,t,i,a){const s=$e(i,ue.NEGATIVE_X),o=u.MP.get();(0,M.jI)(o,t,s.edge*Math.PI/2);const n=(0,r.n)(u.WM.get(),s.basis);let c=(0,r.h)(u.WM.get(),n,s.direction*a.computeScreenPixelSizeAt(s.position)*Re);(0,r.g)(c,c,s.position);const h=a.projectToRenderScreen(c,(0,b.Wv)(u.WM.get())),m=function Ci(e,t){const[i,a,s,o]=e.viewport,n=Math.min(s,o)/16;let c=!0;return t[0]<i+n?(t[0]=i+n,c=!1):t[0]>i+s-n&&(t[0]=i+s-n,c=!1),t[1]<a+n?(t[1]=a+n,c=!1):t[1]>a+o-n&&(t[1]=a+o-n,c=!1),c}(a,h);(0,we.Bh)(a,h,Ue),(0,r.n)(Ue.direction,Ue.direction);const v=u.WM.get();!m&&(0,d.i)(i,Ue,v)&&(c=v),o[12]=0,o[13]=0,o[14]=0,e.modelTransform=o,e.renderLocation=(0,P.d9)(c),m?e.state|=Ae:e.state&=~Ae}(this.shiftManipulator,i,e,this.view.state.camera),function Vi(e,t,i,a){const s=a.worldUpAtPosition(i.origin,u.WM.get()),o=$e(i,ue.POSITIVE_X),n=(0,M.QO)(u.MP.get(),o.edge*Math.PI/2);(0,M.lM)(n,n,-ke(i,s)),(0,M.Jp)(n,t,n),n[12]=0,n[13]=0,n[14]=0,e.modelTransform=n,e.renderLocation=o.position}(this.rotateHeadingManipulator,i,e,this.view.renderCoordsHelper),function Di(e,t,i){const a=$e(i,ue.POSITIVE_Y),s=(0,M.QO)(u.MP.get(),a.edge*Math.PI/2);(0,M.lM)(s,s,_e),(0,M.Jp)(s,t,s),s[12]=0,s[13]=0,s[14]=0,e.modelTransform=s,e.renderLocation=a.position}(this.rotateTiltManipulator,i,e),this.resizeManipulators.forEach((n,c)=>function Ti(e,t,i,a){const s=(0,r.l)(a.basis1),o=(0,r.l)(a.basis2),n=wt(a),c=Je(a),h=(0,r.s)(u.WM.get(),0,0,0);(0,r.g)(h,(0,r.h)(u.WM.get(),a.basis1,t.direction[0]),(0,r.h)(u.WM.get(),a.basis2,t.direction[1])),(0,r.g)(h,a.origin,h);let m=0,v=1;if(Xe(t))1===t.direction[0]&&-1===t.direction[1]?m=_e:1===t.direction[0]&&1===t.direction[1]?m=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(m=3*Math.PI/2),v=c;else{const O=0!==t.direction[0]?1:2;m=1===O?_e:0,v=(1===O?o:s)-n}const w=(0,M.QO)(u.MP.get(),m);(0,M.bA)(w,w,(0,r.s)(u.WM.get(),v,v,v)),(0,M.Jp)(w,i,w),w[12]=0,w[13]=0,w[14]=0,e.modelTransform=w,e.renderLocation=h}(n,this._resizeHandles[c],i,e)),this._previewPlaneOutlineVisualElement.visible=!1,this._previewPlaneGridVisualElement.visible=!1);const a=(0,r.s)(u.WM.get(),(0,r.l)(e.basis1),(0,r.l)(e.basis2),1),s=(0,M.xJ)(u.MP.get(),a),o=(0,M.Jp)(s,i,s);this._previewPlaneOutlineVisualElement.transform=o,this._previewPlaneGridVisualElement.transform=o,this._updateMaterials()}_updateMaterials(){const e=Fe(this.view.effectiveTheme);e[3]*=this._previewPlaneOpacity;const t=(0,se.d9)(ze);t[3]*=this._previewPlaneOpacity,this._previewPlaneOutlineVisualElement.color=e,this._previewPlaneGridVisualElement.backgroundColor=t,this._previewPlaneGridVisualElement.gridColor=se.AG}_updateManipulatorsInteractive(e){if(!e.grabbing)return this.shiftManipulator.interactive=!0,this.rotateHeadingManipulator.interactive=!0,this.rotateTiltManipulator.interactive=!0,void this.resizeManipulators.forEach(t=>{t.interactive=!0});this.shiftManipulator.interactive=this.shiftManipulator===e,this.rotateHeadingManipulator.interactive=this.rotateHeadingManipulator===e,this.rotateTiltManipulator.interactive=this.rotateTiltManipulator===e,this.resizeManipulators.forEach(t=>{t.interactive=t===e})}testData(){return{plane:this.analysisViewData.plane,setPointerMoveTimerMs:e=>{this._pointerMoveTimerMs=e}}}};function At(e,t,i,a){const s=function _i(e,t,i,a){const s=(0,r.b)(u.WM.get(),t,i);return(0,r.b)(s,s,t),(0,S.Yq)(e,s,a)}(i,(0,d.n)(a),e.direction,(0,S.Ue)()),o=(0,P.Ue)();return(0,S.BR)(s,e,o)?{type:"shift",creatingPointerId:t,hasBeenDragged:!1,shiftPlane:s,depth:0,startPoint:o}:null}function st(e){return"mouse"!==e.pointerType||0===e.button}F.disableEngineLayers=!1,(0,g._)([(0,p.Cb)()],F.prototype,"_clock",void 0),(0,g._)([(0,p.Cb)({constructOnly:!0})],F.prototype,"view",void 0),(0,g._)([(0,p.Cb)()],F.prototype,"analysisViewData",void 0),(0,g._)([(0,p.Cb)({readOnly:!0})],F.prototype,"state",null),(0,g._)([(0,p.Cb)({readOnly:!0})],F.prototype,"cursor",null),(0,g._)([(0,p.Cb)()],F.prototype,"analysis",null),(0,g._)([(0,p.Cb)()],F.prototype,"removeIncompleteOnCancel",void 0),(0,g._)([(0,p.Cb)()],F.prototype,"_layersMode",void 0),(0,g._)([(0,p.Cb)()],F.prototype,"layersMode",null),(0,g._)([(0,p.Cb)({value:null})],F.prototype,"inputState",null),(0,g._)([(0,p.Cb)()],F.prototype,"_isPlacingSlicePlane",null),(0,g._)([(0,p.Cb)()],F.prototype,"_creatingPointerId",null),F=at=(0,g._)([(0,_.j)("esri.views.3d.analysis.Slice.SliceTool")],F);const Ji=(0,d.a)(),Oe=(0,ee.Ue)(),Xi=F;var ki=l(54889);let ge=class extends A.Z{constructor(e){super(e),this._gridVisualElement=null,this._outlineVisualElement=null,this.showGrid=!1,this.preview=!0}initialize(){const e=this.analysisViewData;if(null==e)throw new Error("expected internal object to be valid");this._gridVisualElement=_t(this.view),this._outlineVisualElement=bt(this.view),this.addHandles([(0,x.YP)(()=>{const t=null!=e.plane&&this.analysisViewData.visible,{active:i}=this.analysisViewData,{preview:a,showGrid:s,view:o}=this,{effectiveTheme:n}=o;return{visible:t,active:i,preview:a,showGrid:s,gridColor:lt(n),outlineColor:Fe(n)}},t=>this._updateMaterials(t),x.tX),(0,x.YP)(()=>e.plane,t=>this._updatePlane(t),x.tX)],"internal")}destroy(){this._gridVisualElement=(0,H.SC)(this._gridVisualElement),this._outlineVisualElement=(0,H.SC)(this._outlineVisualElement),this.set("view",null)}_updatePlane(e){if(null==e)return;this._gridVisualElement.attached=!0,this._outlineVisualElement.attached=!0;const t=(0,r.s)(u.WM.get(),(0,r.l)(e.basis1),(0,r.l)(e.basis2),1),i=(0,M.xJ)(u.MP.get(),t),a=mt(e,u.MP.get()),s=(0,M.Jp)(i,a,i);this._outlineVisualElement.transform=s,this._gridVisualElement.transform=s}_updateMaterials({visible:e,active:t,preview:i,showGrid:a,gridColor:s,outlineColor:o}){this._outlineVisualElement.color=o,this._outlineVisualElement.width=i?2:dt,this._outlineVisualElement.stipplePattern=t?null:(0,ki.z5)(5),this._gridVisualElement.backgroundColor=ze,this._gridVisualElement.gridColor=a?s:se.AG,this._gridVisualElement.visible=e,this._outlineVisualElement.visible=e}};(0,g._)([(0,p.Cb)()],ge.prototype,"view",void 0),(0,g._)([(0,p.Cb)()],ge.prototype,"analysis",void 0),(0,g._)([(0,p.Cb)()],ge.prototype,"analysisViewData",void 0),(0,g._)([(0,p.Cb)()],ge.prototype,"showGrid",void 0),(0,g._)([(0,p.Cb)()],ge.prototype,"preview",void 0),ge=(0,g._)([(0,_.j)("esri.views.3d.analysis.Slice.SliceVisualization")],ge);var Ut=l(95925);let de=class extends((0,D.p)(A.Z)){constructor(e){super(e),this.type="slice-view-3d",this.analysis=null,this.tool=null,this.analysisVisualization=null,this.analysisController=null,this.plane=null,this.active=!0}initialize(){this.analysisVisualization=new ge({view:this.view,analysis:this.analysis,analysisViewData:this}),this.analysisController=new ve({view:this.view,analysis:this.analysis,analysisViewData:this}),this.addHandles((0,Ut.Lp)(this,Xi))}destroy(){(0,Ut.Yq)(this),this.analysisVisualization=(0,H.SC)(this.analysisVisualization),this.analysisController=(0,H.SC)(this.analysisController)}get showGrid(){return this.analysisVisualization?.showGrid??!1}set showGrid(e){this.analysisVisualization&&(this.analysisVisualization.showGrid=e)}get editable(){return!this.analysisVisualization.preview}set editable(e){this.analysisVisualization.preview=!e}get testData(){return{visualization:this.analysisVisualization,controller:this.analysisController,tool:this.tool}}};(0,g._)([(0,p.Cb)({readOnly:!0})],de.prototype,"type",void 0),(0,g._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],de.prototype,"analysis",void 0),(0,g._)([(0,p.Cb)()],de.prototype,"tool",void 0),(0,g._)([(0,p.Cb)()],de.prototype,"plane",void 0),(0,g._)([(0,p.Cb)()],de.prototype,"active",void 0),(0,g._)([(0,p.Cb)()],de.prototype,"showGrid",null),(0,g._)([(0,p.Cb)()],de.prototype,"editable",null),de=(0,g._)([(0,_.j)("esri.views.3d.analysis.SliceAnalysisView3D")],de);const qi=de},10023:(Pe,Q,l)=>{l.d(Q,{V5:()=>G,e7:()=>H,zc:()=>N});var g=l(15861),A=l(90194);function H(V){return p.apply(this,arguments)}function p(){return(p=(0,g.Z)(function*(V,_=V.popupTemplate){if(null==_)return[];const D=yield _.getRequiredFields(V.fieldsIndex),{lastEditInfoEnabled:B}=_,{objectIdField:Z,typeIdField:$,globalIdField:J,relationships:q}=V;if(D.includes("*"))return["*"];const K=B?(0,A.CH)(V):[],R=(0,A.Q0)(V.fieldsIndex,[...D,...K]);return $&&R.push($),R&&Z&&V.fieldsIndex?.has(Z)&&!R.includes(Z)&&R.push(Z),R&&J&&V.fieldsIndex?.has(J)&&!R.includes(J)&&R.push(J),q&&q.forEach(ae=>{const{keyField:U}=ae;R&&U&&V.fieldsIndex?.has(U)&&!R.includes(U)&&R.push(U)}),R})).apply(this,arguments)}function G(V,_){return V.popupTemplate?V.popupTemplate:null!=_&&_.defaultPopupTemplateEnabled&&null!=V.defaultPopupTemplate?V.defaultPopupTemplate:null}function N(V,_){return null!=G(V,{defaultPopupTemplateEnabled:_})}}}]);