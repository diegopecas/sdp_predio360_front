"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[6522],{19702:(X,P,s)=>{s.d(P,{A:()=>A});var I=s(15861),d=s(17626),V=s(54024),D=s(10699),p=s(32917),T=s(77712),j=(s(8314),s(63290),s(4619),s(76898)),B=s(36947);const A=W=>{let C=class extends W{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(c){super.postscript(c),(0,B.qC)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}_validateHeightModelInfo(){var c=this;return(0,I.Z)(function*(){const v=new AbortController,H=v.signal;c.addHandles((0,V.kB)(()=>v.abort())),yield(0,p.N1)(()=>c.view.defaultsFromMap?.heightModelInfoReady,H),(0,D.k_)(H);const x=(0,B.Wt)(c.layer,c.view.heightModelInfo,c.supportsHeightUnitConversion);if(x)throw x})()}canResume(){const c=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return super.canResume()&&(!c?.minScale||!c.maxScale||c.minScale>=c.maxScale)}getSuspendInfo(){const c=super.getSuspendInfo(),v=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return v&&v.minScale&&v.maxScale&&v.minScale<v.maxScale&&(c.outsideScaleRange=!0),c}};return(0,d._)([(0,T.Cb)()],C.prototype,"view",void 0),(0,d._)([(0,T.Cb)()],C.prototype,"slicePlaneEnabled",void 0),C=(0,d._)([(0,j.j)("esri.views.3d.layers.LayerView3D")],C),C}},76522:(X,P,s)=>{s.r(P),s.d(P,{default:()=>me});var I=s(15861),d=s(17626),V=s(26584),D=s(8314),p=s(62208),T=s(10699),O=s(32917),f=s(77712),B=(s(63290),s(4619),s(76898));class A{constructor(e,t,i){this._scale=e,this._shift=t,this._levelShift=i}getLevelRowColumn(e){const t=this.getLevelShift(e[0]),i=this._shift+t;return i?[e[0]-t,e[1]>>i,e[2]>>i]:e}getLevelShift(e){return Math.min(e,this._levelShift)}getOffset(e,t){let i=0,a=0;const l=this._shift+this.getLevelShift(e[0]);if(l){const r=(1<<l)-1,n=t/(this._scale*(1<<l-1));i=(e[2]&r)*n,a=(e[1]&r)*n}return[i,a]}getScale(e){return this._scale*(1<<this._shift+this.getLevelShift(e))}}var W=s(1036),C=s(2753),c=s(65401),v=s(63631),H=s(40022),x=s(51200),q=s(78224),ee=s(12378),te=s(59047),se=s(76763),g=s(1268),ie=s(92862),ne=s(58098);class N extends v.m{constructor(e,t,i,a){super(e,t,i,e.tileInfo.lods.length-1),this._memCache=a,this._ongoingTileRequests=new Map,this._ongoingRequestToController=new Map,this._tileInfoView=new ie.Z(e.tileInfo,e.fullExtent)}destroy(){super.destroy(),this._ongoingRequestToController.forEach(e=>e.abort()),this._ongoingRequestToController.clear(),this._ongoingTileRequests.clear()}getVectorTile(e,t,i,a){var l=this;return(0,I.Z)(function*(){const r=new ne.Z(e,t,i,0);let n=l._memCache.get(r.id);if(null!=n)return n.retain(),n;const h=yield l._getVectorTileData(r);if((0,T.k_)(a),!l._layer)return null;if(n=l._memCache.get(r.id),null!=n)return n.retain(),n;const y=l._layer.tileInfo.getTileBounds((0,c.Ue)(),r),z=l._tileInfoView.getTileResolution(e);return n=new H.i(r,z,y[0],y[3],512,512,l._styleRepository,l._memCache),h?(n.setData(h),n.retain(),l._memCache.put(r.id,n,n.usedMemory,W.M4)):n.setData(null),n.neededForCoverage=!0,n.transforms.tileUnitsToPixels=(0,C.al)(1/8,0,0,0,1/8,0,0,0,1),function le(o){const e=[],t=new te.L(4096,e,()=>{const a=new x.J;return a.show=!1,a.parts.push({startTime:0,startOpacity:0,targetOpacity:0,show:!1}),a.parts.push({startTime:0,startOpacity:0,targetOpacity:0,show:!1}),a}),i=new ee.g(e,t,(a,l,r)=>new q.f(a,l,r,o.styleRepository,o.key.level,0),(a,l)=>{(0,se.C$)(a,l,!1)},()=>0,a=>{const l=o.styleRepository.getStyleLayerByUID(a).getLayoutProperty("visibility");return!l||l.getValue()!==g.EE.NONE});e.push(o),t.add(o),i.setScreenSize(512,512),i.continue(1/0)}(n),n})()}_getVectorTileData(e){const t=e.id;if(this._ongoingTileRequests.has(t))return this._ongoingTileRequests.get(t);const i=new AbortController,l=this._getParsedVectorTileData(e,{signal:i.signal}).then(r=>(this._ongoingTileRequests.delete(t),this._ongoingRequestToController.delete(t),r)).catch(()=>(this._ongoingTileRequests.delete(t),this._ongoingRequestToController.delete(t),null));return this._ongoingTileRequests.set(t,l),this._ongoingRequestToController.set(t,i),l}_getParsedVectorTileData(e,t){return this.fetchTileData(e,t).then(i=>this.parseTileData({key:e,data:i},t))}}var ae=s(66420),re=s(68109),oe=s(11099),he=s(69172),ce=s(86406);const de={vtlBackground:ae.J,vtlFill:oe.R,vtlLine:he.z,vtlCircle:re.j,vtlSymbol:ce.e};var ge=s(68447),M=s(67969);const L=1e-6;class G{constructor(e,t){this.spriteMosaic=e,this.glyphMosaic=t,this._brushCache=new Map,this._vtlMaterialManager=new ge.Z}dispose(){this._brushCache&&(this._brushCache.forEach(e=>e.dispose()),this._brushCache=null),this._vtlMaterialManager=(0,p.M2)(this._vtlMaterialManager),this.spriteMosaic.dispose(),this.glyphMosaic.dispose()}get vectorTilesMaterialManager(){return this._vtlMaterialManager}drawSymbols(e,t,i){const a=i.layers;e.renderPass="translucent";for(let l=0;l<a.length;l++){const r=a[l];if(r.type!==g.fR.SYMBOL)continue;const n=r.getLayoutProperty("visibility");if(n&&n.getValue()===g.EE.NONE)continue;const h=e.displayLevel;void 0!==r.minzoom&&r.minzoom>h+L||void 0!==r.maxzoom&&r.maxzoom<=h-L||(e.styleLayerUID=r.uid,e.styleLayer=r,this._drawWithBrush(e,t,"vtlSymbol"))}}drawBackground(e,t,i){if(0===i.backgroundBucketIds.length)return;const{context:a,displayLevel:l,requiredLevel:r}=e;t.key.level=r,a.setBlendingEnabled(!0),a.setDepthTestEnabled(!1),a.setStencilTestEnabled(!1),e.renderPass="background",i.backgroundBucketIds.forEach(n=>{const h=i.getLayerById(n);if(h.type!==g.fR.BACKGROUND)return;const y=h.getLayoutProperty("visibility");y&&y.getValue()===g.EE.NONE||void 0!==h.minzoom&&h.minzoom>l+L||void 0!==h.maxzoom&&h.maxzoom<=l-L||(e.styleLayerUID=h.uid,e.styleLayer=h,this._drawWithBrush(e,t,"vtlBackground"))})}drawTile(e,t,i,a){const{context:l}=e,r=i.layers;l.setBlendingEnabled(!1),l.setDepthTestEnabled(!0),l.setDepthWriteEnabled(!0),l.setDepthFunction(M.wb.LEQUAL),e.renderPass="opaque";for(let n=r.length-1;n>=0;n--){const h=r[n];null!=a&&a!==h.type||this._renderStyleLayer(h,e,t,!1)}l.setDepthWriteEnabled(!1),l.setBlendingEnabled(!0),l.setBlendFunctionSeparate(M.zi.ONE,M.zi.ONE_MINUS_SRC_ALPHA,M.zi.ONE,M.zi.ONE_MINUS_SRC_ALPHA),e.renderPass="translucent";for(let n=0;n<r.length;n++){const h=r[n];null!=a&&a!==h.type||this._renderStyleLayer(h,e,t,!1)}l.setDepthTestEnabled(!1),l.bindVAO()}_renderStyleLayer(e,t,i,a){if(!(a||e&&i.layerData.has(e.uid)))return;const l=e.getLayoutProperty("visibility");if(l&&l.getValue()===g.EE.NONE)return;const{renderPass:r}=t;let n;switch(e.type){case g.fR.BACKGROUND:if("background"!==r)return;n="vtlBackground";break;case g.fR.FILL:if("opaque"!==r&&"translucent"!==t.renderPass)return;n="vtlFill";break;case g.fR.LINE:if("translucent"!==r)return;n="vtlLine";break;case g.fR.CIRCLE:if("translucent"!==r)return;n="vtlCircle";break;case g.fR.SYMBOL:if("translucent"!==r)return;n="vtlSymbol"}const h=t.displayLevel;if(void 0!==e.minzoom&&e.minzoom>h+L||void 0!==e.maxzoom&&e.maxzoom<=h-L)return;const{context:y}=t;y.setStencilTestEnabled(!1),y.setStencilWriteMask(0),t.styleLayerUID=e.uid,t.styleLayer=e,this._drawWithBrush(t,i,n)}_drawWithBrush(e,t,i){this._brushCache.has(i)||this._brushCache.set(i,new(0,de[i])),this._brushCache.get(i).drawMany(e,[t])}}var Z=s(78364),ue=s(19702),ye=s(50916),K=s(61779),ve=s(45611);let u=class extends((0,ye.r)((0,ue.A)(ve.Z))){constructor(){super(...arguments),this._tileHandlerController=null,this.type="vector-tile-3d",this.levelShift=(0,D.Z)("disable-feature:vtl-level-shift")?0:1}initialize(){if(null==this.layer.fullExtent)return void this.addResolvingPromise(Promise.reject(new V.Z("vectortilelayerview:full-extent-undefined","This layer view's layer does not define a fullExtent.")));const{basemapTerrain:o,spatialReference:e,state:t,viewingMode:i}=this.view,r="local"===i&&!(0,K.jO)(e)||K.Bu.force512VTL?this.layer.tileInfo:this.layer.tileInfo.getOrCreateCompatible(256,this.layer.tileInfo.spatialReference.isGeographic?1:2),n=this._getTileInfoSupportError(r,this.layer.fullExtent);if(null!=n)return this.addResolvingPromise(Promise.reject(n));const h=(0,O.N1)(()=>this.view?.basemapTerrain?.tilingSchemeLocked).then(()=>{const m=o.tilingScheme,S=m.pixelSize;let E;this.schemaHelper=new A(256===S?1:2,o.spatialReference?.isGeographic&&256===S?1:0,this.levelShift+(o.spatialReference?.isGeographic||256!==S?0:1)),E=256===S?this.layer.tileInfo.getOrCreateCompatible(256,this.layer.tileInfo.spatialReference.isGeographic?1:2):this.view.spatialReference?.isGeographic?this.layer.tileInfo.getOrCreateCompatible(512,.5):this.layer.tileInfo;const b=this._getTileInfoCompatibilityError(E,m);if(b)throw b;this.tileInfo=E});this._tileHandlerController=new AbortController;const y=this.view.resourceController;this._memCache=y.memoryController.newCache(`vtl-${this.layer.uid}`,m=>{m.release()}),this.addHandles((0,O.YP)(()=>this.view.qualitySettings.memoryLimit,m=>this._memCache.maxSize=Math.ceil(m/10*1048576),O.tX));const z=new Z.Z(this.layer.currentStyleInfo.style);this._tileHandler=new N(this.layer,z,t.contentPixelRatio,this._memCache);const F=this._tileHandlerController.signal,Y=function fe(o){return e=>o.immediate.schedule(e)}(y),J=this._tileHandler.start({signal:F,schedule:Y}),$=this._tileHandler.spriteMosaic;$.then(m=>{!(0,T.Hc)(F)&&this._tileHandler&&(this.painter=new G(m,this._tileHandler.glyphMosaic))}),J.then(()=>this._tileHandlerController=null),this._updatingHandles.add(()=>({style:this.layer.currentStyleInfo.style,pixelRatio:this.view.state?.contentPixelRatio}),({style:m,pixelRatio:S})=>{this._tileHandlerController&&this._tileHandlerController.abort(),this._tileHandlerController=new AbortController,this._memCache.clear();const w=new Z.Z(m),R=new N(this.layer,w,S,this._memCache),U=R.start({signal:this._tileHandlerController.signal,schedule:Y}),E=R.spriteMosaic;U.then(()=>this._tileHandlerController=null),this._updatingHandles.addPromise(Promise.all([U,E]).then(([,b])=>{const _=this._tileHandler,Q=this.painter;this.painter=new G(b,R.glyphMosaic),this._tileHandler=R,this.emit("data-changed"),_.destroy(),Q&&Q.dispose()}))});const pe=Promise.all([h,J,$]);this.addResolvingPromise(pe)}destroy(){this.painter=(0,p.M2)(this.painter),this._tileHandlerController=(0,p.IM)(this._tileHandlerController),this._tileHandler=(0,p.SC)(this._tileHandler),this._memCache=(0,p.SC)(this._memCache)}get contentZoom(){return(0,D.Z)("disable-feature:vtl-level-shift")?1:this.view.qualitySettings.tiledSurface.vtlContentZoom}get displayLevelRange(){const o=this.tileInfo.lods,i=this.levelRangeFromScaleRange(this.layer.minScale||o[0].scale,this.layer.maxScale||o[o.length-1].scale);return this.layer.maxScale?i.maxLevel++:i.maxLevel+=this.levelShift,i}get dataScaleRange(){const o=this.tileInfo.lods;return{minScale:o[0].scale,maxScale:o[o.length-1].scale}}get dataLevelRange(){const{minScale:o,maxScale:e}=this.dataScaleRange,t=this.levelRangeFromScaleRange(o,e);return 1===t.minLevel&&256===this.tileInfo.size[0]&&(t.minLevel=0),t.maxLevel+=this.levelShift,t}fetchTile(o,e,t,i){var a=this;return(0,I.Z)(function*(){return a._tileHandler.getVectorTile(o,e,t,i)})()}};(0,d._)([(0,f.Cb)()],u.prototype,"layer",void 0),(0,d._)([(0,f.Cb)()],u.prototype,"levelShift",void 0),(0,d._)([(0,f.Cb)()],u.prototype,"contentZoom",null),(0,d._)([(0,f.Cb)()],u.prototype,"displayLevelRange",null),(0,d._)([(0,f.Cb)()],u.prototype,"tileInfo",void 0),(0,d._)([(0,f.Cb)()],u.prototype,"dataScaleRange",null),(0,d._)([(0,f.Cb)()],u.prototype,"dataLevelRange",null),(0,d._)([(0,f.Cb)()],u.prototype,"updatingProgressValue",void 0),u=(0,d._)([(0,B.j)("esri.views.3d.layers.VectorTileLayerView3D")],u);const me=u}}]);