"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[6212],{50978:(ee,z,i)=>{i.d(z,{M:()=>G,b:()=>U});var d=i(2166),V=i(69960),P=i(65787),r=i(17625),S=i(22355),M=i(16396);function U(m){const b=new S.kG,{vertex:y,fragment:R}=b;(0,d.Sv)(y,m),y.uniforms.add(new P.p("width",o=>o.width)),b.attributes.add(M.T.POSITION,"vec3"),b.attributes.add(M.T.NORMAL,"vec3"),b.attributes.add(M.T.UV0,"vec2"),b.attributes.add(M.T.LENGTH,"float"),b.varyings.add("vtc","vec2"),b.varyings.add("vlength","float"),b.varyings.add("vradius","float"),y.code.add(r.H`void main(void) {
vec3 bitangent = normal;
vtc = uv0;
vlength = length;
vradius = 0.5 * width;
vec4 pos = view * vec4(position + vradius * bitangent * uv0.y, 1.0);
gl_Position = proj * pos;
}`),R.uniforms.add(new P.p("outlineSize",o=>o.outlineSize),new V.N("outlineColor",o=>o.outlineColor),new P.p("stripeLength",o=>o.stripeLength),new V.N("stripeEvenColor",o=>o.stripeEvenColor),new V.N("stripeOddColor",o=>o.stripeOddColor));const s=1/Math.sqrt(2);return R.code.add(r.H`
    const float INV_SQRT2 = ${r.H.float(s)};

    vec4 arrowColor(vec2 tc, float len) {
      float d = INV_SQRT2 * (tc.x - abs(tc.y));
      d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));
      d = min(d, 1.0 - abs(tc.y));

      if (d < 0.0) {
        return vec4(0.0);
      } else if (d < outlineSize) {
        return outlineColor;
      } else {
        return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;
      }
    }

    void main(void) {
      vec2 ntc = vec2(vtc.x / vradius, vtc.y);
      vec4 color = arrowColor(ntc, vlength / vradius);
      if (color.a == 0.0) {
        discard;
      }
      fragColor = color;
    }
  `),b}const G=Object.freeze(Object.defineProperty({__proto__:null,build:U},Symbol.toStringTag,{value:"Module"}))},1437:(ee,z,i)=>{i.d(z,{p:()=>m});var d=i(17626),V=i(54024),P=i(60330),r=i(77712),G=(i(8314),i(63290),i(4619),i(76898));const m=b=>{let y=class extends((0,P.v)(b)){constructor(){super(...arguments),this.parent=null,this._userInteractive=!1,this._interactiveViewModelCount=0}get interactive(){return this._interactiveViewModelCount>0||this._userInteractive}set interactive(R){this._userInteractive=R}get updating(){return!1}get visible(){return null==this.parent||this.parent.visible&&!this.parent.suspended}set visible(R){this._overrideIfSome("visible",R)}forceInteractiveForViewModel(){return this._interactiveViewModelCount++,(0,V.kB)(()=>this._interactiveViewModelCount--)}};return(0,d._)([(0,r.Cb)({constructOnly:!0})],y.prototype,"parent",void 0),(0,d._)([(0,r.Cb)({constructOnly:!0})],y.prototype,"view",void 0),(0,d._)([(0,r.Cb)({type:Boolean})],y.prototype,"interactive",null),(0,d._)([(0,r.Cb)()],y.prototype,"_userInteractive",void 0),(0,d._)([(0,r.Cb)({readOnly:!0})],y.prototype,"updating",null),(0,d._)([(0,r.Cb)()],y.prototype,"visible",null),(0,d._)([(0,r.Cb)()],y.prototype,"_interactiveViewModelCount",void 0),y=(0,d._)([(0,G.j)("esri.views.3d.analysis.AnalysisView3D")],y),y}},96212:(ee,z,i)=>{i.r(z),i.d(z,{default:()=>gt});var d=i(17626),V=i(83761),P=i(62208),r=i(77712),M=(i(8314),i(63290)),G=(i(4619),i(76898)),m=i(39691),b=i(1437),y=i(74554),R=i(15572),s=i(32917),o=i(79800),h=i(29302),g=i(44766),D=i(55214),_=i(55915),W=i(65234),B=i(81863),H=i(43668),F=i(90935),de=i(10049),Pe=i(54865),ze=i(68),fe=i(91622);let $=class extends V.Z{constructor(t){super(t),this._unitNormalizer=new ze.D,this._tempStartPosition=(0,h.Ue)(),this._tempEndPosition=(0,h.Ue)(),this._tempCornerPosition=(0,h.Ue)()}initialize(){const t=this.view.spatialReference,e=(0,B.rS)(t),n=e===B.GG?B.wY:e;this._sphericalPCPF=n;const l=(0,_.canProjectWithoutEngine)(t,n);this._unitNormalizer.spatialReference=l?n:t,this.addHandles([(0,s.YP)(()=>({viewData:this.viewData,startPoint:this.analysis.startPoint}),({viewData:a,startPoint:c})=>{a.elevationAlignedStartPoint=this._applyProjectionAndElevationAlignment(c)},s.tX),(0,s.YP)(()=>({viewData:this.viewData,endPoint:this.analysis.endPoint}),({viewData:a,endPoint:c})=>{a.elevationAlignedEndPoint=this._applyProjectionAndElevationAlignment(c)},s.tX),(0,s.YP)(()=>({result:this._computedResult,viewData:this.viewData}),({result:a,viewData:c})=>{c.result=a},s.tX)])}_applyProjectionAndElevationAlignment(t){if(null==t)return t;const{spatialReference:e,elevationProvider:n}=this.view;return(0,Pe.G)(t,e,n)??((0,Pe.e)(this.analysis,t.spatialReference,M.Z.getLogger(this)),null)}get _computedResult(){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:e,measurementMode:n}=this.viewData;if(null==t||null==e)return null;const l=this._euclideanDistances(t,e),a=this._geodesicDistance(t,e);let c,v;switch(n){case y.e.Auto:v=null!=a?"geodesic":"euclidean",c=a??l.horizontal;break;case y.e.Geodesic:if(null==a)return null;v="geodesic",c=a;break;case y.e.Euclidean:v="euclidean",c=l.horizontal}return{mode:v,directDistance:l.direct,horizontalDistance:c,verticalDistance:l.vertical,distance:n===y.e.Euclidean||l.horizontal.value<=fe.Y?l.direct:a??l.horizontal}}_euclideanDistances(t,e){const n=t.clone();n.z=e.z;const l=this._tempStartPosition,a=this._tempEndPosition,c=this._tempCornerPosition,v=this.view.spatialReference,f=this._sphericalPCPF,u=(0,_.canProjectWithoutEngine)(v,f)?f:v;(0,H.K)(t,l,u),(0,H.K)(e,a,u),(0,H.K)(n,c,u);const C=(0,o.q)(l,a),E=(0,o.q)(c,a),p=Math.abs(e.z-t.z),A=ie=>this._unitNormalizer.normalizeDistance(ie),O=A(C),x=A(E),te=A(p);return{direct:(0,R.yG)(O,"meters"),horizontal:(0,R.yG)(x,"meters"),vertical:(0,R.yG)(te,"meters")}}_geodesicDistance(t,e){const{spatialReference:n}=t,l=new D.Z({spatialReference:n});l.addPath([t,e]);const c=(n.isGeographic&&(0,de.Gb)(n)?(0,de.Jf)([l],"meters")[0]:n.isWebMercator?(0,g.geodesicLength)(l,"meters"):null)??this._fallbackGeodesicDistance(t,e);return null!=c?(0,R.yG)(c,"meters"):null}_fallbackGeodesicDistance(t,e){if((0,F.U)(t,be)&&(0,F.U)(e,Oe)){const n=new de._q;return(0,de.cA)(n,be,Oe,W.Z.WGS84),n.distance}return null}};(0,d._)([(0,r.Cb)()],$.prototype,"view",void 0),(0,d._)([(0,r.Cb)()],$.prototype,"analysis",void 0),(0,d._)([(0,r.Cb)()],$.prototype,"viewData",void 0),(0,d._)([(0,r.Cb)()],$.prototype,"_computedResult",null),$=(0,d._)([(0,G.j)("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController")],$);const be=(0,h.Ue)(),Oe=(0,h.Ue)();var T,N,t,Ue=i(15861),K=(i(52515),i(78260)),Me=i(21286),Y=i(84600),ne=i(23841),Le=i(16730),De=i(95470);(t=T||(T={}))[t.None=0]="None",t[t.Direct=1]="Direct",t[t.Triangle=2]="Triangle",t[t.ProjectedGeodesic=3]="ProjectedGeodesic",function(t){t[t.Auto=0]="Auto",t[t.AboveSegment=1]="AboveSegment",t[t.BelowSegment=2]="BelowSegment"}(N||(N={}));var re=i(68063),he=i(87469),je=i(72392),Ge=i(74741),Ae=i(63657),ae=i(1503),ce=i(26242),xe=i(53928),We=i(57521),J=i(40723),Ie=i(19625),ue=i(13934),Be=i(60881),we=i(5894),I=i(16396),He=i(651),Ke=i(91056),me=i(87601),Se=i(88569),Ne=i(12407),_e=i(44835),Fe=i(41528),Ye=i(50978),Te=i(67969),pe=i(2078);class ge extends Ke.A{constructor(e,n,l){super(e,n,l)}initializeProgram(e){return new Ne.$(e.rctx,ge.shader.get().build(this.configuration),Ve)}_setPipelineState(e){return(0,pe.sm)({blending:this.configuration.transparent?e===_e.A.NONE?Se.wu:(0,Se.j7)(e):null,polygonOffset:this.configuration.polygonOffsetEnabled?{factor:0,units:-4}:null,depthTest:{func:Te.wb.LESS},depthWrite:pe.LZ,colorWrite:pe.BK})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return Te.MX.TRIANGLE_STRIP}}ge.shader=new He.J(Ye.M,()=>i.e(3368).then(i.bind(i,3368)));class ve extends Fe.W{constructor(){super(...arguments),this.polygonOffsetEnabled=!1,this.transparent=!1,this.transparencyPassType=_e.A.NONE}}(0,d._)([(0,me.o)()],ve.prototype,"polygonOffsetEnabled",void 0),(0,d._)([(0,me.o)()],ve.prototype,"transparent",void 0),(0,d._)([(0,me.o)({count:_e.A.COUNT})],ve.prototype,"transparencyPassType",void 0);const Ve=new Map([[I.T.POSITION,0],[I.T.NORMAL,1],[I.T.UV0,2],[I.T.LENGTH,3]]);class Qe extends J.F5{constructor(e){super(e,new Xe),this._vertexAttributeLocations=Ve,this.produces=new Map([[we.r.OPAQUE_MATERIAL,n=>!this._transparent&&(n===ue.H_.Color||n===ue.H_.Alpha)],[we.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,n=>this._transparent&&(n===ue.H_.Color||n===ue.H_.Alpha)]]),this._configuration=new ve}getConfiguration(e,n){return this._configuration.polygonOffsetEnabled=this.parameters.polygonOffset,this._configuration.transparent=this._transparent,this._configuration.transparencyPassType=n.transparencyPassType,this._configuration}intersect(){}createGLMaterial(e){return new Ze(e)}createBufferWriter(){return new it}get _transparent(){const{parameters:e}=this;return e.outlineColor[3]<1||e.stripeEvenColor[3]<1||e.stripeOddColor[3]<1}}class Ze extends Be.Z{beginSlot(e){return this.ensureTechnique(ge,e)}}class Xe extends J.Mt{constructor(){super(...arguments),this.width=32,this.outlineSize=.2,this.outlineColor=(0,ae.al)(1,.5,0,1),this.stripeEvenColor=(0,ae.al)(1,1,1,1),this.stripeOddColor=(0,ae.al)(1,.5,0,1),this.stripeLength=1,this.polygonOffset=!1}}const $e=(0,Ie.U$)().vec3f(I.T.POSITION).vec3f(I.T.NORMAL).vec2f(I.T.UV0).f32(I.T.LENGTH),Je=(0,h.Ue)(),ke=(0,h.Ue)(),qe=(0,h.Ue)(),et=(0,h.Ue)(),tt=(0,h.Ue)();class it{constructor(){this.vertexBufferLayout=$e}elementCount(e){return 2*(e.attributes.get(I.T.POSITION).indices.length/2+1)}write(e,n,l,a,c){const{data:v,indices:f}=l.attributes.get(I.T.POSITION),u=l.attributes.get(I.T.NORMAL).data,C=v.length/3;f&&f.length!==2*(C-1)&&console.warn("MeasurementArrowMaterial does not support indices");const E=Je,p=ke,A=qe,O=et,x=tt,te=a.position,ie=a.normal,Z=a.uv0;let X=0;for(let j=0;j<C;++j){const le=3*j;if((0,o.s)(E,v[le],v[le+1],v[le+2]),j<C-1){const Q=3*(j+1);(0,o.s)(p,v[Q],v[Q+1],v[Q+2]),(0,o.s)(x,u[Q],u[Q+1],u[Q+2]),(0,o.n)(x,x),(0,o.f)(A,p,E),(0,o.n)(A,A),(0,o.b)(O,x,A),(0,o.n)(O,O)}const Ee=(0,o.q)(E,p);e&&n&&((0,o.e)(E,E,e),(0,o.e)(p,p,e),(0,o.e)(O,O,n));const q=c+2*j,se=q+1;te.setVec(q,E),te.setVec(se,E),ie.setVec(q,O),ie.setVec(se,O),Z.set(q,0,X),Z.set(q,1,-1),Z.set(se,0,X),Z.set(se,1,1),j<C-1&&(X+=Ee)}const oe=a.length;for(let j=0;j<2*C;++j)oe.set(c+j,X)}}class st extends xe._{constructor(e){super(e),this._arrowWidth=16,this._arrowSubdivisions=128,this._origin=(0,h.Ue)(),this._originTransform=(0,Ge.Ue)(),this._arrowCenter=(0,h.Ue)(),this._renderOccluded=J.yD.OccludeAndTransparent,this._geometry=null,this._stripeLength=1,this._stripesEnabled=!0,this._color=(0,ae.Ue)(),this._contrastColor=(0,ae.Ue)(),this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._arrowMaterial&&this._arrowMaterial.setParameters({renderOccluded:e}))}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this._geometryChanged()}get stripeLength(){return this._stripeLength}set stripeLength(e){this._stripeLength=e,this.attached&&this._arrowMaterial.setParameters({stripeLength:this._stripeLength})}get stripesEnabled(){return this._stripesEnabled}set stripesEnabled(e){this._stripesEnabled=e,this.attached&&this._arrowMaterial.setParameters({stripeEvenColor:this._stripesEnabled?this._contrastColor:this._color})}get color(){return this._color}set color(e){(0,K.Ht)(e,this._color)||((0,Ae.c)(this._color,e),this._updateArrowColor())}get contrastColor(){return this._contrastColor}set contrastColor(e){(0,K.Ht)(e,this._color)||((0,Ae.c)(this._contrastColor,e),this._updateArrowColor())}createExternalResources(){const e=this._color;this._arrowMaterial=new Qe({outlineColor:e,stripeEvenColor:this._stripesEnabled?this._contrastColor:e,stripeOddColor:e,renderOccluded:this.renderOccluded,polygonOffset:!0,isDecoration:this.isDecoration}),this._handles=new je.Z,this._handles.add((0,s.YP)(()=>this.view.state.camera,()=>{this._viewChanged()}))}destroyExternalResources(){this._arrowMaterial=null,this._handles=(0,P.SC)(this._handles)}forEachExternalMaterial(e){e(this._arrowMaterial)}createGeometries(e){if(null==this._geometry?.startRenderSpace||null==this._geometry.endRenderSpace)return;const n=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);n.transformation=this._originTransform,e.addGeometry(n),this._viewChanged()}_createArrowGeometry(e,n,l,a){const c=this.view.renderCoordsHelper,v=[],f=[],u=(C,E)=>{const p=ce.WM.get();(0,o.f)(p,C,l),v.push(p),f.push(E)};if("euclidean"===a.type){a.eval(.5,this._arrowCenter);const C=ce.WM.get();c.worldUpAtPosition(this._arrowCenter,C),u(e,C),u(n,C)}else{a.eval(.5,this._arrowCenter);const C=this._arrowSubdivisions+1&-2;for(let E=0;E<C;++E){const p=E/(C-1),A=ce.WM.get(),O=ce.WM.get();a.eval(p,A),c.worldUpAtPosition(A,O),u(A,O)}}return(0,We.rh)(this._arrowMaterial,v,f)}_geometryChanged(){this.recreateGeometry()}_viewChanged(){if(this.view.ready&&this.attached&&null!=this._geometry){const e=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameters({width:this._arrowWidth*e})}}_updateArrowColor(){if(!this.attached)return;const e=this._color;this._arrowMaterial.setParameters({stripeEvenColor:this._stripesEnabled?this._contrastColor:e,outlineColor:e,stripeOddColor:e})}}var nt=i(77603),k=i(64770),ye=i(54889),Ce=i(25858),rt=i(56683),at=i(41840);let w=class extends V.Z{get _parameters(){const t=this.view.effectiveTheme,{accentColor:e,textColor:n}=t,l=(0,K.O)(e),a=(0,K.Ch)(e,.75),c=(0,K.O)((0,K.mj)(e)),v=(0,K.mj)(n,K.K6.Low);return{accentColor:l,contrastColor:c,translucentAccentColor:a,triangleLineWidth:3,geodesicProjectionLineWidth:2,guideLineWidth:2,guideStippleLengthPixels:3,directLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12,textColor:n,textBackgroundColor:(0,K.G)(v,.6),textCalloutColor:(0,K.G)(v,.5)}}get visible(){return this.analysisView.visible}get viewMode(){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:e}=this.analysisView;if(null==t||null==e||t.equals(e))return T.None;const n=this.analysisView.result;if(null==n)return T.Direct;if("geodesic"===this.actualVisualizedMeasurement)return this._requiresGeodesicGuideAt(this._startPosition)||this._requiresGeodesicGuideAt(this._endPosition)?T.ProjectedGeodesic:T.Direct;const{verticalDistance:l,horizontalDistance:a}=n,c=l.value,v=a.value;return Math.min(c/v,v/c)<this.triangleCollapseRatioThreshold?T.Direct:T.Triangle}get actualVisualizedMeasurement(){const{measurementMode:t,result:e}=this.analysisView;switch(t){case y.e.Auto:return null!=e&&e.horizontalDistance.value>fe.Y?"geodesic":"euclidean";case y.e.Euclidean:return"euclidean";case y.e.Geodesic:return"geodesic"}}get allowVisualElementsOrientationChange(){return null==this._triangleOrientationOverride}set allowVisualElementsOrientationChange(t){null==this._triangleOrientationOverride!==t&&(this._triangleOrientationOverride=null==this._triangleOrientationOverride?this._actualVisualElementsOrientation:null)}get labels(){return"geodesic"===this.actualVisualizedMeasurement?{direct:null,horizontal:this._segmentLabel,vertical:this._verticalLabel}:{direct:this._segmentLabel,horizontal:this._horizontalLabel,vertical:this._verticalLabel}}constructor(t){super(t),this._segmentVisualElement=null,this._triangleVisualElement=null,this._rightAngleQuad=null,this._projectedGeodesicLine=null,this._geodesicStartHint=null,this._geodesicEndHint=null,this._segmentLabel=null,this._verticalLabel=null,this._horizontalLabel=null,this._startPosition=(0,h.Ue)(),this._endPosition=(0,h.Ue)(),this._cornerPosition=(0,h.Ue)(),this._startPositionAtSeaLevel=(0,h.Ue)(),this._endPositionAtSeaLevel=(0,h.Ue)(),this._triangleOrientationOverride=null,this.messages=null,this.loadingMessages=!0,this.visualElementOrientation=N.Auto,this.triangleCollapseRatioThreshold=.03}initialize(){var t=this;const e=this._parameters,n={attached:!0,view:this.view,isDecoration:!0},{guideLineWidth:l,guideStippleLengthPixels:a,triangleLineWidth:c,geodesicProjectionLineWidth:v,directLabelFontSize:f,verticalLabelFontSize:u,horizontalLabelFontSize:C}=e;this._segmentVisualElement=new st({...n,geometry:null,renderOccluded:J.yD.OccludeAndTransparent}),this._triangleVisualElement=new he.r({...n,width:c,renderOccluded:J.yD.OccludeAndTransparent}),this._rightAngleQuad=new nt.R({...n,renderOccluded:J.yD.OccludeAndTransparent});const E={...n,polygonOffset:!0,renderOccluded:J.yD.OccludeAndTransparent};this._projectedGeodesicLine=new he.r({...E,width:v,stipplePattern:(0,ye.z5)(a)}),this._geodesicStartHint=new he.r({...E,width:l,stipplePattern:(0,ye.z5)(a)}),this._geodesicEndHint=new he.r({...E,width:l,stipplePattern:(0,ye.z5)(a)}),this._segmentLabel=new re.K({...n,fontSize:f}),this._verticalLabel=new re.K({...n,fontSize:u}),this._horizontalLabel=new re.K({...n,fontSize:C}),this.addHandles([(0,s.YP)(()=>{const{elevationAlignedStartPoint:p,elevationAlignedEndPoint:A}=this.analysisView,O=this.view;return{view:O,camera:O.state.camera,viewMode:this.viewMode,elevationAlignedStartPoint:p,elevationAlignedEndPoint:A,orientation:this._actualVisualElementsOrientation,visualizedMeasurement:this.actualVisualizedMeasurement,stripeLength:this._measurementArrowStripeLength}},p=>this._updateGeometryAndViewMode(p),s.tX),(0,s.YP)(()=>({visible:this.visible,viewMode:this.viewMode}),p=>this._updateVisualElementVisibility(p),s.tX),(0,s.YP)(()=>({text:this._labelsText,visualizedMeasurement:this.actualVisualizedMeasurement}),p=>this._updateLabelText(p),s.tX),(0,s.YP)(()=>({visible:this.visible,viewMode:this.viewMode}),p=>this._updateLabelVisibility(p),s.tX),(0,s.YP)(()=>this._measurementArrowStripeLength,p=>this._updateSegmentStripeLength(p),s.tX),(0,rt.qe)((0,Ue.Z)(function*(){return t._updateMessageBundle()})),(0,s.YP)(()=>this._parameters,({textBackgroundColor:p,textCalloutColor:A,textColor:O,translucentAccentColor:x,accentColor:te,contrastColor:ie})=>{const{_segmentLabel:Z,_verticalLabel:X,_horizontalLabel:oe,_triangleVisualElement:j,_rightAngleQuad:le,_projectedGeodesicLine:Ee,_geodesicStartHint:q,_geodesicEndHint:se,_segmentVisualElement:Q}=this;Z.backgroundColor=p,Z.calloutColor=A,Z.textColor=O,X.backgroundColor=p,X.calloutColor=A,X.textColor=O,oe.backgroundColor=p,oe.calloutColor=A,oe.textColor=O,j.color=x,le.color=x,Ee.color=x,q.color=x,se.color=x,Q.color=te,Q.contrastColor=ie},s.nn)]),this._updateMessageBundle()}destroy(){this._segmentVisualElement=(0,P.SC)(this._segmentVisualElement),this._triangleVisualElement=(0,P.SC)(this._triangleVisualElement),this._rightAngleQuad=(0,P.SC)(this._rightAngleQuad),this._projectedGeodesicLine=(0,P.SC)(this._projectedGeodesicLine),this._geodesicStartHint=(0,P.SC)(this._geodesicStartHint),this._geodesicEndHint=(0,P.SC)(this._geodesicEndHint),this._segmentLabel=(0,P.SC)(this._segmentLabel),this._verticalLabel=(0,P.SC)(this._verticalLabel),this._horizontalLabel=(0,P.SC)(this._horizontalLabel),this.set("view",null)}_updateVisualElementVisibility({visible:t,viewMode:e}){if(this._segmentVisualElement.visible=!1,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1,t)switch(e){case T.None:break;case T.Direct:this._segmentVisualElement.visible=!0;break;case T.Triangle:this._segmentVisualElement.visible=!0,this._triangleVisualElement.visible=!0,this._rightAngleQuad.visible=!0;break;case T.ProjectedGeodesic:this._segmentVisualElement.visible=!0,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}}_updateGeometryAndViewMode({view:t,camera:e,viewMode:n,elevationAlignedStartPoint:l,elevationAlignedEndPoint:a,orientation:c,visualizedMeasurement:v,stripeLength:f}){const u=t.renderCoordsHelper;if(null==u||null==l||null==a||l.equals(a))return;let C=this._startPosition,E=this._endPosition;u.toRenderCoords(l,C),u.toRenderCoords(a,E);const p=c===N.AboveSegment?1:-1,A=p*(u.getAltitude(E)-u.getAltitude(C));A<0&&(C=this._endPosition,E=this._startPosition);const O="geodesic"===v?new k.u(this._startPosition,this._endPosition,u.spatialReference):new k.y(this._startPosition,this._endPosition);switch(this._segmentVisualElement.geometry=O,this._updateSegmentStripeLength(f),n){case T.Direct:this._updateSegment(O,c);break;case T.Triangle:this._updateSegmentAndTriangle({view:t,camera:e,segment:O,orientation:c,startPosition:C,endPosition:E,deltaSign:p,altitudeDelta:A});break;case T.ProjectedGeodesic:this._updateSegmentAndProjection({view:t,orientation:c,startPosition:C,endPosition:E})}}_updateSegment(t,e){this._segmentLabel.anchor=e===N.AboveSegment?"top":"bottom",this._segmentLabel.geometry={type:"segment",segment:t,sampleLocation:"center"}}_updateSegmentAndTriangle({view:{renderCoordsHelper:t},camera:e,segment:n,orientation:l,startPosition:a,endPosition:c,deltaSign:v,altitudeDelta:f}){const u=this._cornerPosition;t.worldUpAtPosition(a,u),(0,o.h)(u,u,v*Math.abs(f)),(0,o.g)(u,u,a),this._triangleVisualElement.geometry=[[[a[0],a[1],a[2]],[u[0],u[1],u[2]],[c[0],c[1],c[2]]]],this._rightAngleQuad.geometry={previous:a,center:u,next:c};const C=new k.y(a,u),E=new k.y(u,c),p=function ot(t,e,n,l,a){const c=lt,v=dt;a.projectToRenderScreen(n,c),a.projectToRenderScreen(e,v);const f={segment:"bottom",horizontal:"top",vertical:c[0]<v[0]?"left":"right"};{const u=ht,C=ct;if((0,Ce.CM)(t,n,a,u),(0,Ce.CM)(t,e,a,C),(0,De.AK)(u,C)>=Re){const E=Math.sign(u[1])===Math.sign(C[1]);f.segment=E?(0,re.j)(f.vertical):f.vertical}else{const E=ut;(0,Ce.CM)(n,e,a,E),(0,De.AK)(E,C)>=Re&&(f.segment=Math.sign(E[0])===Math.sign(C[0])?(0,re.j)(f.horizontal):f.horizontal)}}if(l===N.BelowSegment){const u=C=>"top"===C?"bottom":"top";f.segment=u(f.segment),f.horizontal=u(f.horizontal),f.vertical=u(f.vertical)}return f}(a,c,u,l,e);this._segmentLabel.anchor=p.segment,this._segmentLabel.geometry={type:"segment",segment:n,sampleLocation:"center"},this._verticalLabel.geometry={type:"segment",segment:C,sampleLocation:"center"},this._verticalLabel.anchor=p.vertical,this._horizontalLabel.geometry={type:"segment",segment:E,sampleLocation:"center"},this._horizontalLabel.anchor=p.horizontal}_updateSegmentAndProjection({view:{renderCoordsHelper:t},orientation:e,startPosition:n,endPosition:l}){t.setAltitude(this._startPositionAtSeaLevel,0,n),t.setAltitude(this._endPositionAtSeaLevel,0,l);const a=new k.u(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,t.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(a),this._geodesicStartHint.setGeometryFromSegment(new k.y(this._startPositionAtSeaLevel,n)),this._geodesicEndHint.setGeometryFromSegment(new k.y(this._endPositionAtSeaLevel,l)),this._segmentLabel.geometry={type:"segment",segment:a,sampleLocation:"center"},this._segmentLabel.anchor=e===N.AboveSegment?"top":"bottom"}_updateLabelText({text:t,visualizedMeasurement:e}){null!=t?(this._segmentLabel.text="euclidean"===e?t.directDistance:t.horizontalDistance,this._horizontalLabel.text=t.horizontalDistance,this._verticalLabel.text=t.verticalDistance):(this._segmentLabel.text=null,this._horizontalLabel.text=null,this._verticalLabel.text=null),this.notifyChange("labels")}_updateLabelVisibility({visible:t,viewMode:e}){const n=this._segmentLabel,l=this._horizontalLabel,a=this._verticalLabel;if(n.visible=!1,l.visible=!1,a.visible=!1,t)switch(e){case T.Direct:n.visible=!0;break;case T.Triangle:n.visible=!0,l.visible=!0,a.visible=!0;break;case T.ProjectedGeodesic:n.visible=!0}}get _labelsText(){if(this.destroyed)return null;const t=this.messages,e=this.analysisView.result;if(null==e||null==t)return null;const{directDistance:n,horizontalDistance:l,verticalDistance:a}=e,c=this.analysisView.unit,v=f=>({directDistance:"",horizontalDistance:"",verticalDistance:"",...f});switch(c){case"metric":return v({directDistance:n&&(0,Y.Rd)(t,n),horizontalDistance:l&&(0,Y.Rd)(t,l),verticalDistance:a&&(0,Y.Wv)(t,a)});case"imperial":return v({directDistance:n&&(0,Y.Ud)(t,n),horizontalDistance:l&&(0,Y.Ud)(t,l),verticalDistance:a&&(0,Y.Zv)(t,a)});default:return v({directDistance:n&&(0,Y.VG)(t,n,c),horizontalDistance:l&&(0,Y.VG)(t,l,c),verticalDistance:a&&(0,Y.VG)(t,a,c)})}}_updateSegmentStripeLength(t){const e=this._segmentVisualElement;null!=t?(e.stripeLength=t,e.stripesEnabled=!0):e.stripesEnabled=!1}get _actualVisualElementsOrientation(){if(null!=this._triangleOrientationOverride)return this._triangleOrientationOverride;const t=this.visualElementOrientation;return t===N.Auto?this.view.state.camera.aboveGround?N.AboveSegment:N.BelowSegment:t}_requiresGeodesicGuideAt(t){const e=this.view;if(!e?.state)return!1;const l=e.renderCoordsHelper;if(!l)return!1;const a=e.state.camera.computeScreenPixelSizeAt(t);return l.getAltitude(t)/a>=10}get _measurementArrowStripeLength(){const{result:t,unit:e}=this.analysisView;if(null==t)return null;let n=null;const l=t.directDistance;switch(e){case"metric":n=l&&(0,R.nn)(l,"meters");break;case"imperial":n=l&&(0,R.nn)(l,(0,Le.Q7)(l.value,l.unit));break;default:n=l&&(0,R.nn)(l,e)}return null==n?null:(0,Me.sk)(n.value/30)*(0,Le.En)(1,n.unit,"meters")}_updateMessageBundle(){this.loadingMessages=!0,(0,at.ME)("esri/core/t9n/Units").then(t=>{this.messages=t}).finally(()=>{this.loadingMessages=!1})}get testData(){return{labels:this.labels,stripeLength:this._segmentVisualElement?.stripeLength}}};(0,d._)([(0,r.Cb)()],w.prototype,"_parameters",null),(0,d._)([(0,r.Cb)()],w.prototype,"_triangleOrientationOverride",void 0),(0,d._)([(0,r.Cb)()],w.prototype,"messages",void 0),(0,d._)([(0,r.Cb)()],w.prototype,"view",void 0),(0,d._)([(0,r.Cb)()],w.prototype,"analysis",void 0),(0,d._)([(0,r.Cb)()],w.prototype,"analysisView",void 0),(0,d._)([(0,r.Cb)()],w.prototype,"loadingMessages",void 0),(0,d._)([(0,r.Cb)()],w.prototype,"visible",null),(0,d._)([(0,r.Cb)()],w.prototype,"viewMode",null),(0,d._)([(0,r.Cb)()],w.prototype,"actualVisualizedMeasurement",null),(0,d._)([(0,r.Cb)()],w.prototype,"visualElementOrientation",void 0),(0,d._)([(0,r.Cb)()],w.prototype,"triangleCollapseRatioThreshold",void 0),(0,d._)([(0,r.Cb)()],w.prototype,"allowVisualElementsOrientationChange",null),(0,d._)([(0,r.Cb)()],w.prototype,"labels",null),(0,d._)([(0,r.Cb)()],w.prototype,"_labelsText",null),(0,d._)([(0,r.Cb)()],w.prototype,"_actualVisualElementsOrientation",null),(0,d._)([(0,r.Cb)()],w.prototype,"_measurementArrowStripeLength",null),w=(0,d._)([(0,G.j)("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementVisualization")],w);const Re=Math.cos((0,Me.Vl)(12)),lt=(0,ne.J$)(),dt=(0,ne.J$)(),ht=(0,ne.gX)(),ct=(0,ne.gX)(),ut=(0,ne.gX)();let L=class extends((0,b.p)(V.Z)){constructor(t){super(t),this.type="direct-line-measurement-view-3d",this.analysis=null,this.result=null,this.measurementMode=y.e.Auto,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}initialize(){const t=this.view,e=this.analysis;this._analysisVisualization=new w({view:t,analysis:e,analysisView:this}),this._analysisController=new $({view:t,analysis:e,viewData:this})}destroy(){this._analysisController=(0,P.SC)(this._analysisController),this._analysisVisualization=(0,P.SC)(this._analysisVisualization)}get updating(){return!!this._analysisVisualization?.loadingMessages}get viewMode(){return this._analysisVisualization.viewMode}get actualVisualizedMeasurement(){return this._analysisVisualization.actualVisualizedMeasurement}get visualElementOrientation(){return this._analysisVisualization.visualElementOrientation}set visualElementOrientation(t){this._analysisVisualization.visualElementOrientation=t}get allowVisualElementsOrientationChange(){return this._analysisVisualization.allowVisualElementsOrientationChange}set allowVisualElementsOrientationChange(t){this._analysisVisualization.allowVisualElementsOrientationChange=t}get triangleCollapseRatioThreshold(){return this._analysisVisualization.triangleCollapseRatioThreshold}set triangleCollapseRatioThreshold(t){this._analysisVisualization.triangleCollapseRatioThreshold=t}get directLabelText(){return this._analysisVisualization.labels.direct?.text??""}get horizontalLabelText(){return this._analysisVisualization.labels.horizontal?.text??""}get verticalLabelText(){return this._analysisVisualization.labels.vertical?.text??""}get unit(){return this.analysis.unit??this._defaultUnit}get testData(){return this.destroyed?{labels:null,stripeLength:null,visualization:null,controller:null}:{...this._analysisVisualization?.testData,visualization:this._analysisVisualization,controller:this._analysisController}}};(0,d._)([(0,r.Cb)()],L.prototype,"updating",null),(0,d._)([(0,r.Cb)({readOnly:!0})],L.prototype,"type",void 0),(0,d._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],L.prototype,"analysis",void 0),(0,d._)([(0,r.Cb)()],L.prototype,"result",void 0),(0,d._)([(0,r.Cb)()],L.prototype,"measurementMode",void 0),(0,d._)([(0,r.Cb)()],L.prototype,"elevationAlignedStartPoint",void 0),(0,d._)([(0,r.Cb)()],L.prototype,"elevationAlignedEndPoint",void 0),(0,d._)([(0,r.Cb)({readOnly:!0})],L.prototype,"viewMode",null),(0,d._)([(0,r.Cb)({readOnly:!0})],L.prototype,"actualVisualizedMeasurement",null),(0,d._)([(0,r.Cb)()],L.prototype,"visualElementOrientation",null),(0,d._)([(0,r.Cb)()],L.prototype,"allowVisualElementsOrientationChange",null),(0,d._)([(0,r.Cb)()],L.prototype,"triangleCollapseRatioThreshold",null),(0,d._)([(0,r.Cb)({readOnly:!0})],L.prototype,"directLabelText",null),(0,d._)([(0,r.Cb)({readOnly:!0})],L.prototype,"horizontalLabelText",null),(0,d._)([(0,r.Cb)({readOnly:!0})],L.prototype,"verticalLabelText",null),(0,d._)([(0,r.Cb)()],L.prototype,"_analysisVisualization",void 0),(0,d._)([(0,r.Cb)()],L.prototype,"_analysisController",void 0),(0,d._)([(0,r.Cb)()],L.prototype,"unit",null),(0,d._)([(0,r.Cb)(m.Y)],L.prototype,"_defaultUnit",void 0),L=(0,d._)([(0,G.j)("esri.views.3d.analysis.DirectLineMeasurementAnalysisView3D")],L);const gt=L},54865:(ee,z,i)=>{i.d(z,{G:()=>P,e:()=>r});var d=i(55915),V=i(53929);function P(S,M,U,G=!1){const m=(0,d.tryProjectWithZConversion)(S,M);return null==m?null:(m.hasZ&&!G||null==U||(m.z=(0,V.KO)(U,m)??0),m)}function r(S,M,U){U.warnOnce(`Failed to project analysis geometry (id: '${S.id}'), projection from spatial reference (wkid: '${M.wkid}') to view spatial reference is not supported. Projection may be possible after calling projection.load().`)}},87469:(ee,z,i)=>{i.d(z,{r:()=>b});var d=i(52113),V=i(74741),P=i(79800),r=i(29302),S=i(1503),M=i(53928),U=i(79020),G=i(40723),m=i(92222);class b extends M._{constructor(s,o){super(s),this._hasExternalMaterial=!1,this._hasExternalMaterial=null!=o,this._material=o??new m.U({width:1,color:(0,S.al)(1,0,1,1),stippleOffColor:null,stipplePattern:null,stipplePreferContinuous:!0,isClosed:!1,falloff:0,innerColor:null,innerWidth:1,hasPolygonOffset:!1,renderOccluded:G.yD.OccludeAndTransparent,isDecoration:!!s.isDecoration,writeDepth:!0}),this.applyProperties(s)}setGeometryFromRenderSpacePoint(s,o=1e3){this.geometry=[[[s[0]-o,s[1],s[2]],[s[0]+o,s[1],s[2]]],[[s[0],s[1]-o,s[2]],[s[0],s[1]+o,s[2]]],[[s[0],s[1],s[2]-o],[s[0],s[1],s[2]+o]]]}setGeometryFromExtent(s){const o=this.view.spatialReference,h=(0,r.Ue)(),g=(0,r.Ue)(),D=100,_=[];(0,P.s)(h,s[0],s[1],D),this.view.renderCoordsHelper.toRenderCoords(h,o,g),_.push([g[0],g[1],g[2]]),(0,P.s)(h,s[2],s[1],D),this.view.renderCoordsHelper.toRenderCoords(h,o,g),_.push([g[0],g[1],g[2]]),(0,P.s)(h,s[2],s[3],D),this.view.renderCoordsHelper.toRenderCoords(h,o,g),_.push([g[0],g[1],g[2]]),(0,P.s)(h,s[0],s[3],D),this.view.renderCoordsHelper.toRenderCoords(h,o,g),_.push([g[0],g[1],g[2]]),(0,P.s)(h,s[0],s[1],D),this.view.renderCoordsHelper.toRenderCoords(h,o,g),_.push([g[0],g[1],g[2]]),(0,P.s)(h,s[0],s[1],D),this.view.renderCoordsHelper.toRenderCoords(h,o,g),_.push([g[0],g[1],g[2]]),this.geometry=[_]}setGeometryFromFrustum(s){const o=[];s.lines.forEach(h=>{o.push([h.origin[0],h.origin[1],h.origin[2]]),o.push([h.endpoint[0],h.endpoint[1],h.endpoint[2]])}),this.geometry=[o]}setGeometryFromBoundedPlane(s){const o=[],h=s.origin,g=s.basis1,D=s.basis2,_=.5,W=(0,r.Ue)(),B=(0,r.Ue)(),H=(0,r.Ue)(),F=(0,r.Ue)();W[0]=h[0]-g[0]*_-D[0]*_,W[1]=h[1]-g[1]*_-D[1]*_,W[2]=h[2]-g[2]*_-D[2]*_,B[0]=h[0]-g[0]*_+D[0]*_,B[1]=h[1]-g[1]*_+D[1]*_,B[2]=h[2]-g[2]*_+D[2]*_,H[0]=h[0]+g[0]*_+D[0]*_,H[1]=h[1]+g[1]*_+D[1]*_,H[2]=h[2]+g[2]*_+D[2]*_,F[0]=h[0]+g[0]*_-D[0]*_,F[1]=h[1]+g[1]*_-D[1]*_,F[2]=h[2]+g[2]*_-D[2]*_,o.push([W[0],W[1],W[2]]),o.push([B[0],B[1],B[2]]),o.push([H[0],H[1],H[2]]),o.push([F[0],F[1],F[2]]),o.push([W[0],W[1],W[2]]),this.geometry=[o]}setGeometryFromSegment(s){const o=s.endRenderSpace;this.transform=(0,d.vc)(y,o);const{points:h}=s.createRenderGeometry(o,this.view.renderCoordsHelper);this.geometry=[h]}setGeometryFromSegments(s,o=r.AG){this.transform=(0,d.vc)(y,o),this.geometry=s.map(h=>h.createRenderGeometry(o,this.view.renderCoordsHelper).points)}getTransformedGeometry(){return null==this._geometry?null:this._geometry.map(s=>s.map(o=>(0,P.e)((0,r.Ue)(),o,this.transform)))}get renderOccluded(){return this._material.parameters.renderOccluded}set renderOccluded(s){this._material.setParameters({renderOccluded:s})}get geometry(){return this._geometry}set geometry(s){this._geometry=s,this.recreateGeometry()}get width(){return this._material.parameters.width}set width(s){this._material.setParameters({width:s})}get color(){return this._material.parameters.color}set color(s){const o=1===s[3];this._material.setParameters({color:(0,S.d9)(s),writeDepth:o})}get innerWidth(){return this._material.parameters.innerWidth}set innerWidth(s){this._material.setParameters({innerWidth:s})}get innerColor(){return this._material.parameters.innerColor}set innerColor(s){this._material.setParameters({innerColor:null!=s?(0,S.d9)(s):null})}get stipplePattern(){return this._material.parameters.stipplePattern}set stipplePattern(s){null!=this._material&&this._material.setParameters({stipplePattern:s})}get stippleOffColor(){return this._material.parameters.stippleOffColor}set stippleOffColor(s){this._material.setParameters({stippleOffColor:null!=s?(0,S.d9)(s):null})}get stipplePreferContinuous(){return this._material.parameters.stipplePreferContinuous}set stipplePreferContinuous(s){this._material.setParameters({stipplePreferContinuous:s})}get falloff(){return this._material.parameters.falloff}set falloff(s){this._material.setParameters({falloff:s})}get polygonOffset(){return this._material.parameters.hasPolygonOffset}set polygonOffset(s){this._material.setParameters({hasPolygonOffset:s})}createExternalResources(){}destroyExternalResources(){}createGeometries(s){for(const o of(0,U.c)(this.geometry)){const h=(0,U.Y)(this._material,o);s.addGeometry(h)}}forEachExternalMaterial(s){this._hasExternalMaterial||s(this._material)}}const y=(0,V.Ue)()},53928:(ee,z,i)=>{i.d(z,{_:()=>U});var d=i(52113),V=i(74741),P=i(68604),r=i(97272),S=i(23147),M=i(34103);class U extends P.l{constructor(m){super(m),this._resources=null,this._transform=(0,V.Ue)()}get object(){return null!=this._resources?this._resources.object:null}get transform(){return this._transform}set transform(m){(0,d.JG)(this._transform,m),null!=this._resources&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(null==this._resources)return;const m=this._resources.object,b=this.view._stage;b.removeMany(m.geometries),m.removeAllGeometries(),this.createGeometries(m),m.visible=this.visible,b.addMany(m.geometries)}createResources(){this.destroyResources();const m=this.view._stage;if(!m)return;const b=new M.F(m,{pickable:!1,updatePolicy:S.j.SYNC}),y=new r.T({castShadow:!1});y.transformation=this._transform,this.createExternalResources(),this.createGeometries(y),m.addMany(y.geometries),this.forEachExternalMaterial(R=>m.add(R)),m.add(y),b.add(y),y.visible=this.visible,this._resources={layer:b,object:y}}destroyResources(){const m=this.view._stage;null!=this._resources&&m&&(m.remove(this._resources.object),this._resources.layer.destroy(),this.forEachExternalMaterial(b=>{m.remove(b)}),m.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(m){null!=this._resources&&(this._resources.object.visible=m)}}},68604:(ee,z,i)=>{i.d(z,{l:()=>V});var d=i(32917);class V{get isDecoration(){return this._isDecoration}set isDecoration(r){this._isDecoration=r}constructor(r){this._isDecoration=!1,this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=r.view,this._handle=(0,d.YP)(()=>r.view.ready,S=>{this._resourcesCreated&&(S?this._createResources():this._destroyResources())})}applyProperties(r){let S=!1;for(const M in r)M in this?"attached"===M?S=r[M]:this[M]=r[M]:console.error("Cannot set unknown property",M);this.attached=S}destroy(){this.attached=!1,this._handle.remove()}get attached(){return this._attached}set attached(r){r!==this._attached&&this.view._stage&&(this._attached=r,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources(),this.onAttachedChange(r))}onAttachedChange(r){}get visible(){return this._visible}set visible(r){r!==this._visible&&(this._visible=r,this.attached&&this.updateVisibility(r))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.updateVisibility(this.visible)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}}}]);