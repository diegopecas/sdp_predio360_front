"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[3792],{9088:(ee,B,e)=>{e.d(B,{L:()=>S,b:()=>d});var v=e(52113),u=e(74741),x=e(95470),l=e(15331),g=e(47634),E=e(95285),V=e(65787),I=e(17625),A=e(63123),z=e(22355),f=e(16396);function d(T){const o=new z.kG;o.include(g.j,T);const{vertex:H,fragment:W}=o;return H.uniforms.add(new A.g("modelView",(m,i)=>(0,v.Iu)(b,i.camera.viewMatrix,m.origin)),new A.g("proj",(m,i)=>i.camera.projectionMatrix),new V.p("glowWidth",(m,i)=>m.glowWidth*i.camera.pixelRatio),new E.A("pixelToNDC",(m,i)=>(0,x.t8)(P,2/i.camera.fullViewport[2],2/i.camera.fullViewport[3]))),o.attributes.add(f.T.START,"vec3"),o.attributes.add(f.T.END,"vec3"),o.attributes.add(f.T.UP,"vec3"),o.attributes.add(f.T.EXTRUDE,"vec2"),o.varyings.add("uv","vec2"),o.varyings.add("vViewStart","vec3"),o.varyings.add("vViewEnd","vec3"),o.varyings.add("vViewPlane","vec4"),H.code.add(I.H`void main() {
vec3 pos = mix(start, end, extrude.x);
vec4 viewPos = modelView * vec4(pos, 1);
vec4 projPos = proj * viewPos;
vec2 ndcPos = projPos.xy / projPos.w;
vec3 viewUp = (modelView * vec4(extrude.y * up, 0)).xyz;
vec4 projPosUp = proj * vec4(viewPos.xyz + viewUp, 1);
vec2 projExtrudeDir = normalize(projPosUp.xy / projPosUp.w - ndcPos);
vec2 lxy = abs(sign(projExtrudeDir) - ndcPos);
ndcPos += length(lxy) * projExtrudeDir;
vec3 worldPlaneNormal = normalize(cross(up, normalize(end - start)));
vec3 viewPlaneNormal = (modelView * vec4(worldPlaneNormal, 0)).xyz;
vViewStart = (modelView * vec4(start, 1)).xyz;
vViewEnd = (modelView * vec4(end, 1)).xyz;
vViewPlane = vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));
float xPaddingPixels = sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;
ndcPos.x += xPaddingPixels * pixelToNDC.x;
uv = ndcPos * 0.5 + 0.5;
gl_Position = vec4(ndcPos, 0, 1);
}`),W.uniforms.add(new V.p("perScreenPixelRatio",(m,i)=>i.camera.perScreenPixelRatio)),W.code.add(I.H`float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {
vec3 origin = mix(start, end, 0.5);
vec3 basis = end - origin;
vec3 posAtOrigin = pos - origin;
float x = dot(normalize(basis), posAtOrigin);
float y = dot(plane.xyz, posAtOrigin);
float dx = max(abs(x) - length(basis), 0.0);
float dy = y;
float dist = length(vec2(dx, dy));
float width = fwidth(y);
float maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;
float pixelDist = dist / min(width, maxPixelDistance);
return abs(pixelDist);
}
void main() {
vec3 pos;
vec3 normal;
float depthDiscontinuityAlpha;
vec3 dEndStart = vViewEnd - vViewStart;
if (dot(dEndStart, dEndStart) < 1e-5) {
discard;
}
if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
discard;
}
float distance = planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);
vec4 color = laserlineProfile(distance);
float alpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, vViewPlane.xyz)));
fragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);
}`),o}const P=(0,l.Ue)(),b=(0,u.Ue)(),S=Object.freeze(Object.defineProperty({__proto__:null,build:d},Symbol.toStringTag,{value:"Module"}))},66501:(ee,B,e)=>{e.d(B,{L:()=>ne,b:()=>m,d:()=>W});var v=e(21286),u=e(95470),x=e(15331),l=e(79800),g=e(29302),E=e(63657),V=e(1503),I=e(13777),A=e(90014),z=e(97126),f=e(47634),d=e(39523),P=e(95285),b=e(97139),S=e(69960),T=e(65787),o=e(17625),H=e(22355);const W=(0,v.Vl)(6);function m(s){const p=new H.kG;p.include(d.k),p.include(f.j,s);const r=p.fragment;if(s.lineVerticalPlaneEnabled||s.heightManifoldEnabled)if(r.uniforms.add(new T.p("maxPixelDistance",(a,h)=>s.heightManifoldEnabled?2*h.camera.computeScreenPixelSizeAt(a.heightManifoldTarget):2*h.camera.computeScreenPixelSizeAt(a.lineVerticalPlaneSegment.origin))),r.code.add(o.H`float planeDistancePixels(vec4 plane, vec3 pos) {
float dist = dot(plane.xyz, pos) + plane.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`),s.spherical){const a=(L,y,ae)=>(0,l.e)(L,y.heightManifoldTarget,ae.camera.viewMatrix),h=(L,y)=>(0,l.e)(L,[0,0,0],y.camera.viewMatrix);r.uniforms.add(new S.N("heightManifoldOrigin",(L,y)=>(a(M,L,y),h(F,y),(0,l.f)(F,F,M),(0,l.n)(C,F),C[3]=(0,l.l)(F),C)),new b.J("globalOrigin",(L,y)=>h(M,y)),new T.p("cosSphericalAngleThreshold",(L,y)=>1-Math.max(2,(0,l.q)(y.camera.eye,L.heightManifoldTarget)*y.camera.perRenderPixelRatio)/(0,l.l)(L.heightManifoldTarget))),r.code.add(o.H`float globeDistancePixels(float posInGlobalOriginLength) {
float dist = abs(posInGlobalOriginLength - heightManifoldOrigin.w);
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}
float heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {
vec3 posInGlobalOriginNorm = normalize(globalOrigin - pos);
float cosAngle = dot(posInGlobalOriginNorm, heightManifoldOrigin.xyz);
vec3 posInGlobalOrigin = globalOrigin - pos;
float posInGlobalOriginLength = length(posInGlobalOrigin);
float sphericalDistance = globeDistancePixels(posInGlobalOriginLength);
float planarDistance = planeDistancePixels(heightPlane, pos);
return cosAngle < cosSphericalAngleThreshold ? sphericalDistance : planarDistance;
}`)}else r.code.add(o.H`float heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {
return planeDistancePixels(heightPlane, pos);
}`);if(s.pointDistanceEnabled&&(r.uniforms.add(new T.p("maxPixelDistance",(a,h)=>2*h.camera.computeScreenPixelSizeAt(a.pointDistanceTarget))),r.code.add(o.H`float sphereDistancePixels(vec4 sphere, vec3 pos) {
float dist = distance(sphere.xyz, pos) - sphere.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`)),s.intersectsLineEnabled&&(r.uniforms.add(new T.p("perScreenPixelRatio",(a,h)=>h.camera.perScreenPixelRatio)),r.code.add(o.H`float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {
float dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);
return abs(dist) - radius;
}`)),(s.lineVerticalPlaneEnabled||s.intersectsLineEnabled)&&r.code.add(o.H`bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {
vec3 dir = end - start;
float t2 = dot(dir, pos - start);
float l2 = dot(dir, dir);
return t2 >= 0.0 && t2 <= l2;
}`),r.code.add(o.H`void main() {
vec3 pos;
vec3 normal;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
discard;
}
vec4 color = vec4(0, 0, 0, 0);`),s.heightManifoldEnabled){r.uniforms.add(new P.A("angleCutoff",h=>i(h)),new S.N("heightPlane",(h,L)=>U(h.heightManifoldTarget,h.renderCoordsHelper.worldUpAtPosition(h.heightManifoldTarget,M),L.camera.viewMatrix)));const a=s.spherical?o.H`normalize(globalOrigin - pos)`:o.H`heightPlane.xyz`;r.code.add(o.H`
    {
      float heightManifoldAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, ${a})));
      vec4 heightManifoldColor = laserlineProfile(heightManifoldDistancePixels(heightPlane, pos));
      color = max(color, heightManifoldColor * heightManifoldAlpha);
    }
    `)}return s.pointDistanceEnabled&&(r.uniforms.add(new P.A("angleCutoff",a=>i(a)),new S.N("pointDistanceSphere",(a,h)=>function D(s,p){return(0,l.e)((0,z.g)(X),s.pointDistanceOrigin,p.camera.viewMatrix),X[3]=(0,l.q)(s.pointDistanceOrigin,s.pointDistanceTarget),X}(a,h))),r.code.add(o.H`{
float pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);
vec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);
float pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));
color = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);
}`)),s.lineVerticalPlaneEnabled&&(r.uniforms.add(new P.A("angleCutoff",a=>i(a)),new S.N("lineVerticalPlane",(a,h)=>function R(s,p){const r=(0,I.KU)(s.lineVerticalPlaneSegment,.5,M),a=s.renderCoordsHelper.worldUpAtPosition(r,te),h=(0,l.n)(F,s.lineVerticalPlaneSegment.vector),L=(0,l.b)(M,a,h);return(0,l.n)(L,L),U(s.lineVerticalPlaneSegment.origin,L,p.camera.viewMatrix)}(a,h)),new b.J("lineVerticalStart",(a,h)=>function N(s,p){const r=(0,l.c)(M,s.lineVerticalPlaneSegment.origin);return s.renderCoordsHelper.setAltitude(r,0),(0,l.e)(r,r,p.camera.viewMatrix)}(a,h)),new b.J("lineVerticalEnd",(a,h)=>function j(s,p){const r=(0,l.g)(M,s.lineVerticalPlaneSegment.origin,s.lineVerticalPlaneSegment.vector);return s.renderCoordsHelper.setAltitude(r,0),(0,l.e)(r,r,p.camera.viewMatrix)}(a,h))),r.code.add(o.H`{
if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {
float lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);
vec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);
float lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));
color = max(color, lineVerticalColor * lineVerticalAlpha);
}
}`)),s.intersectsLineEnabled&&(r.uniforms.add(new P.A("angleCutoff",a=>i(a)),new b.J("intersectsLineStart",(a,h)=>(0,l.e)(M,a.lineStartWorld,h.camera.viewMatrix)),new b.J("intersectsLineEnd",(a,h)=>(0,l.e)(M,a.lineEndWorld,h.camera.viewMatrix)),new b.J("intersectsLineDirection",(a,h)=>((0,l.c)(C,a.intersectsLineSegment.vector),C[3]=0,(0,l.n)(M,(0,E.t)(C,C,h.camera.viewMatrix)))),new T.p("intersectsLineRadius",a=>a.intersectsLineRadius)),r.code.add(o.H`{
if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {
float intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);
vec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);
float intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));
color = max(color, intersectsLineColor * intersectsLineAlpha);
}
}`)),r.code.add(o.H`fragColor = laserlineOutput(color * depthDiscontinuityAlpha);
}`),p}function i(s){return(0,u.t8)(K,Math.cos(s.angleCutoff),Math.cos(Math.max(0,s.angleCutoff-(0,v.Vl)(2))))}function U(s,p,r){return(0,l.e)(Q,s,r),(0,l.c)(C,p),C[3]=0,(0,E.t)(C,C,r),(0,A.Yq)(Q,C,ie)}const K=(0,x.Ue)(),M=(0,g.Ue)(),C=(0,V.Ue)(),te=(0,g.Ue)(),F=(0,g.Ue)(),Q=(0,g.Ue)(),ie=(0,A.Ue)(),X=(0,z.c)(),ne=Object.freeze(Object.defineProperty({__proto__:null,build:m,defaultAngleCutoff:W},Symbol.toStringTag,{value:"Module"}))},23018:(ee,B,e)=>{e.d(B,{W:()=>de});var v=e(79800),u=e(29302),x=e(13777),l=e(68604),g=e(17626),E=e(62208),V=e(77712),f=(e(8314),e(63290),e(4619),e(76898)),d=e(85072),P=e(8834),b=e(70562),S=e(59617),T=e(36344),o=e(4511),H=e(19625),W=e(15197),m=e(16396),i=e(651),D=e(91056),R=e(12407),N=e(9088),j=e(67969),U=e(2078);class K extends D.A{initializeProgram(t){return new R.$(t.rctx,K.shader.get().build(this.configuration),M)}initializePipeline(){return(0,U.sm)({blending:(0,U.if)(j.zi.ONE,j.zi.ONE_MINUS_SRC_ALPHA),colorWrite:U.BK})}}K.shader=new i.J(N.L,()=>e.e(9689).then(e.bind(e,79689)));const M=new Map([[m.T.START,0],[m.T.END,1],[m.T.UP,2],[m.T.EXTRUDE,3]]);var C=e(83994);class te{constructor(t){this._renderCoordsHelper=t,this._buffers=null,this._origin=(0,u.Ue)(),this._dirty=!1,this._count=0,this._vao=null}set vertices(t){const c=(0,T.bg)(3*t.length);let _=0;for(const k of t)c[_++]=k[0],c[_++]=k[1],c[_++]=k[2];this.buffers=[c]}set buffers(t){if(this._buffers=t,this._buffers.length>0){const c=this._buffers[0],_=3*Math.floor(c.length/3/2);(0,v.s)(this._origin,c[_],c[_+1],c[_+2])}else(0,v.s)(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(t){const c=this._ensureVAO(t);null!=c&&(t.bindVAO(c),t.drawArrays(j.MX.TRIANGLES,0,this._count))}dispose(){null!=this._vao&&this._vao.dispose()}_ensureVAO(t){return null==this._buffers?null:(null==this._vao&&(this._vao=this._createVAO(t,this._buffers)),this._ensureVertexData(this._vao,this._buffers),this._vao)}_createVAO(t,c){const _=this._createDataBuffer(c);return this._dirty=!1,new W.U(t,M,{data:(0,o.K)(ie)},{data:C.f.createVertex(t,j.l1.STATIC_DRAW,_)})}_ensureVertexData(t,c){if(!this._dirty)return;const _=this._createDataBuffer(c);t.vertexBuffers.data?.setData(_),this._dirty=!1}_numberOfRenderVertices(t){return 2*(t.length/3-1)*3}_createDataBuffer(t){const c=t.reduce((G,w)=>G+this._numberOfRenderVertices(w),0);this._count=c;const _=ie.createBuffer(c),k=this._origin;let le=0,oe=0;for(const G of t){for(let w=0;w<G.length;w+=3){const re=(0,v.s)(Q,G[w],G[w+1],G[w+2]);0===w?oe=this._renderCoordsHelper.getAltitude(re):this._renderCoordsHelper.setAltitude(re,oe);const Z=this._renderCoordsHelper.worldUpAtPosition(re,F),O=le+2*w,he=(0,v.f)(Q,re,k);if(w<G.length-3){_.up.setVec(O,Z),_.up.setVec(O+3,Z),_.up.setVec(O+5,Z);for(let J=0;J<6;J++)_.start.setVec(O+J,he);_.extrude.setValues(O,0,-1),_.extrude.setValues(O+1,1,-1),_.extrude.setValues(O+2,1,1),_.extrude.setValues(O+3,0,-1),_.extrude.setValues(O+4,1,1),_.extrude.setValues(O+5,0,1)}if(w>0){_.up.setVec(O-2,Z),_.up.setVec(O-4,Z),_.up.setVec(O-5,Z);for(let J=-6;J<0;J++)_.end.setVec(O+J,he)}}le+=this._numberOfRenderVertices(G)}return _.buffer}}const F=(0,u.Ue)(),Q=(0,u.Ue)(),ie=(0,H.U$)().vec3f(m.T.START).vec3f(m.T.END).vec3f(m.T.UP).vec2f(m.T.EXTRUDE);var X=e(81088),ne=e(5894),s=e(57623),p=e(87601);class r extends p.m{constructor(){super(...arguments),this.contrastControlEnabled=!1}}(0,g._)([(0,p.o)()],r.prototype,"contrastControlEnabled",void 0);var a=e(21286),h=e(17625),L=e(39114),y=e(66501);class ae extends h.K{constructor(){super(...arguments),this.innerColor=(0,u.al)(1,1,1),this.innerWidth=1,this.glowColor=(0,u.al)(1,.5,0),this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.75,this.globalAlphaContrastBoost=2,this.angleCutoff=(0,a.Vl)(6),this.pointDistanceOrigin=(0,u.Ue)(),this.pointDistanceTarget=(0,u.Ue)(),this.lineVerticalPlaneSegment=(0,x.Ue)(),this.intersectsLineSegment=(0,x.Ue)(),this.intersectsLineRadius=3,this.heightManifoldTarget=(0,u.Ue)(),this.lineStartWorld=(0,u.Ue)(),this.lineEndWorld=(0,u.Ue)()}}class se extends D.A{initializeProgram(t){return new R.$(t.rctx,se.shader.get().build(this.configuration),L.i)}initializePipeline(){return(0,U.sm)({blending:(0,U.if)(j.zi.ONE,j.zi.ONE_MINUS_SRC_ALPHA),colorWrite:U.BK})}}se.shader=new i.J(y.L,()=>e.e(7794).then(e.bind(e,17794)));class Y extends r{constructor(){super(...arguments),this.heightManifoldEnabled=!1,this.pointDistanceEnabled=!1,this.lineVerticalPlaneEnabled=!1,this.intersectsLineEnabled=!1,this.spherical=!1}}(0,g._)([(0,p.o)()],Y.prototype,"heightManifoldEnabled",void 0),(0,g._)([(0,p.o)()],Y.prototype,"pointDistanceEnabled",void 0),(0,g._)([(0,p.o)()],Y.prototype,"lineVerticalPlaneEnabled",void 0),(0,g._)([(0,p.o)()],Y.prototype,"intersectsLineEnabled",void 0),(0,g._)([(0,p.o)()],Y.prototype,"spherical",void 0);let $=class extends X.He{constructor(n){super(n),this._technique=null,this._heightManifoldEnabled=!1,this._pointDistanceEnabled=!1,this._lineVerticalPlaneEnabled=!1,this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._viewingMode=S.JY.Local,this._pathVerticalPlaneEnabled=!1,this._pathVerticalPlaneData=null,this._pathTechnique=null,this._passParameters=new ae,this.produces=new Map([[ne.r.LASERLINES,()=>!this.contrastControlEnabled],[ne.r.LASERLINES_CONTRAST_CONTROL,()=>this.contrastControlEnabled]])}initialize(){this._passParameters.renderCoordsHelper=this.renderCoordsHelper}consumes(){return X.of}get isDecoration(){return this._isDecoration}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(n){this._heightManifoldEnabled!==n&&(this._heightManifoldEnabled=n,this._requestRender())}get heightManifoldTarget(){return this._passParameters.heightManifoldTarget}set heightManifoldTarget(n){(0,v.c)(this._passParameters.heightManifoldTarget,n),this._requestRender()}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(n){n!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=n,this._requestRender())}get pointDistanceTarget(){return this._passParameters.pointDistanceTarget}set pointDistanceTarget(n){(0,v.c)(this._passParameters.pointDistanceTarget,n),this._requestRender()}get pointDistanceOrigin(){return this._passParameters.pointDistanceOrigin}set pointDistanceOrigin(n){(0,v.c)(this._passParameters.pointDistanceOrigin,n),this._requestRender()}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(n){n!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=n,this._requestRender())}get lineVerticalPlaneSegment(){return this._passParameters.lineVerticalPlaneSegment}set lineVerticalPlaneSegment(n){(0,x.JG)(n,this._passParameters.lineVerticalPlaneSegment),this._requestRender()}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(n){n!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=n,this._requestRender())}get intersectsLineSegment(){return this._passParameters.intersectsLineSegment}set intersectsLineSegment(n){(0,x.JG)(n,this._passParameters.intersectsLineSegment),this._requestRender()}get intersectsLineRadius(){return this._passParameters.intersectsLineRadius}set intersectsLineRadius(n){n!==this._passParameters.intersectsLineRadius&&(this._passParameters.intersectsLineRadius=n,this._requestRender())}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(n){n!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=n,this._requestRender())}get viewingMode(){return this._viewingMode}set viewingMode(n){n!==this._viewingMode&&(this._viewingMode=n,this._requestRender())}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(n){n!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=n,null!=this._pathVerticalPlaneData&&this._requestRender())}set pathVerticalPlaneVertices(n){null==this._pathVerticalPlaneData&&(this._pathVerticalPlaneData=new te(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.vertices=n,this.pathVerticalPlaneEnabled&&this._requestRender()}set pathVerticalPlaneBuffers(n){null==this._pathVerticalPlaneData&&(this._pathVerticalPlaneData=new te(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.buffers=n,this.pathVerticalPlaneEnabled&&this._requestRender()}setParameters(n){(0,s.LO)(this._passParameters,n)&&this._requestRender()}initializeRenderContext(n){this._context=n,this._techniqueRepository=n.techniqueRepository,this._techniqueConfig=new Y;const t=new r;t.contrastControlEnabled=this.contrastControlEnabled,this._pathTechnique=this._techniqueRepository.acquire(K,t)}uninitializeRenderContext(){this._technique=(0,E.RY)(this._technique),this._pathVerticalPlaneData=(0,E.M2)(this._pathVerticalPlaneData),this._pathTechnique=(0,E.RY)(this._pathTechnique)}prepareTechnique(){return this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled?(this._techniqueConfig.heightManifoldEnabled=this.heightManifoldEnabled,this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled,this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled,this._techniqueConfig.contrastControlEnabled=this.contrastControlEnabled,this._techniqueConfig.spherical=this._viewingMode===S.JY.Global,this._technique=this._techniqueRepository.releaseAndAcquire(se,this._techniqueConfig,this._technique),this._technique):this._pathTechnique}renderNode(n,t){(this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled)&&this._renderUnified(n,t),this.pathVerticalPlaneEnabled&&this._renderPath(n)}_renderUnified(n,t){const c=n.rctx;this._updatePassParameters(n),c.bindTechnique(t,n.bindParameters,this._passParameters),c.screen.draw()}_renderPath(n){null!=this._pathVerticalPlaneData&&null!=this._pathTechnique&&(n.rctx.bindTechnique(this._pathTechnique,n.bindParameters,{...this._passParameters,origin:this._pathVerticalPlaneData.origin}),this._pathVerticalPlaneData.draw(n.rctx))}_updatePassParameters(n){if(!this._intersectsLineEnabled)return;const t=n.bindParameters.camera;if(this._intersectsLineInfinite){if((0,d.iL)((0,b.re)(this._passParameters.intersectsLineSegment.origin,this._passParameters.intersectsLineSegment.vector),q),q.c0=-Number.MAX_VALUE,!(0,P.zq)(t.frustum,q))return;(0,d.Ws)(q,this._passParameters.lineStartWorld),(0,d.S$)(q,this._passParameters.lineEndWorld)}else(0,v.c)(this._passParameters.lineStartWorld,this._passParameters.intersectsLineSegment.origin),(0,v.g)(this._passParameters.lineEndWorld,this._passParameters.intersectsLineSegment.origin,this._passParameters.intersectsLineSegment.vector)}_requestRender(){this._context&&this._context.requestRender()}get test(){return{passParameters:this._passParameters}}};(0,g._)([(0,V.Cb)({constructOnly:!0})],$.prototype,"contrastControlEnabled",void 0),(0,g._)([(0,V.Cb)({constructOnly:!0})],$.prototype,"_isDecoration",void 0),(0,g._)([(0,V.Cb)({constructOnly:!0})],$.prototype,"renderCoordsHelper",void 0),$=(0,g._)([(0,f.j)("esri.views.3d.support.LaserLineRenderer")],$);const q=(0,d.Ue)();class de extends l.l{constructor(t){super(t),this._angleCutoff=y.d,this._style={},this._heightManifoldTarget=(0,u.Ue)(),this._heightManifoldEnabled=!1,this._intersectsLine=(0,x.Ue)(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProperties(t)}get testData(){return this._renderer}createResources(){this._ensureRenderer()}destroyResources(){this._disposeRenderer()}updateVisibility(){this._syncRenderer(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance()}get angleCutoff(){return this._angleCutoff}set angleCutoff(t){this._angleCutoff!==t&&(this._angleCutoff=t,this._syncAngleCutoff())}get style(){return this._style}set style(t){this._style=t,this._syncStyle()}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(t){null!=t?((0,v.c)(this._heightManifoldTarget,t),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this._syncRenderer(),this._syncHeightManifold()}set intersectsWorldUpAtLocation(t){if(null==t)return void(this.intersectsLine=null);const c=this.view.renderCoordsHelper.worldUpAtPosition(t,ce);this.intersectsLine=(0,x.al)(t,c),this.intersectsLineInfinite=!0}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(t){null!=t?((0,x.JG)(t,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this._syncIntersectsLine(),this._syncRenderer()}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(t){this._intersectsLineInfinite=t,this._syncIntersectsLineInfinite()}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(t){this._lineVerticalPlaneSegment=null!=t?(0,x.JG)(t):null,this._syncLineVerticalPlane(),this._syncRenderer()}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(t){this._pathVerticalPlaneBuffers=t,this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncRenderer()}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(t){this._pointDistanceLine=null!=t?{origin:(0,u.d9)(t.origin),target:t.target?(0,u.d9)(t.target):null}:null,this._syncPointDistance(),this._syncRenderer()}_syncRenderer(){this.attached&&this.visible&&(this._intersectsLineEnabled||this._heightManifoldEnabled||null!=this._pointDistanceLine||null!=this._pathVerticalPlaneBuffers)?this._ensureRenderer():this._disposeRenderer()}_ensureRenderer(){null==this._renderer&&(this._renderer=new $({renderCoordsHelper:this.view.renderCoordsHelper,contrastControlEnabled:!0,_isDecoration:this.isDecoration}),this._renderer.viewingMode=this.view.state.viewingMode,this._syncStyle(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncIntersectsLineInfinite(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this._renderer))}_syncStyle(){null!=this._renderer&&(this._renderer.setParameters(this._style),null!=this._style.intersectsLineRadius&&(this._renderer.intersectsLineRadius=this._style.intersectsLineRadius))}_syncAngleCutoff(){null!=this._renderer&&this._renderer.setParameters({angleCutoff:this._angleCutoff})}_syncHeightManifold(){null!=this._renderer&&(this._renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this._renderer.heightManifoldTarget=this._heightManifoldTarget))}_syncIntersectsLine(){null!=this._renderer&&(this._renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this._renderer.intersectsLineSegment=this._intersectsLine))}_syncIntersectsLineInfinite(){null!=this._renderer&&(this._renderer.intersectsLineInfinite=this._intersectsLineInfinite)}_syncPathVerticalPlane(){null!=this._renderer&&(this._renderer.pathVerticalPlaneEnabled=null!=this._pathVerticalPlaneBuffers&&this.visible,null!=this._pathVerticalPlaneBuffers&&(this._renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}_syncLineVerticalPlane(){null!=this._renderer&&(this._renderer.lineVerticalPlaneEnabled=null!=this._lineVerticalPlaneSegment&&this.visible,null!=this._lineVerticalPlaneSegment&&(this._renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}_syncPointDistance(){if(null==this._renderer)return;const t=this._pointDistanceLine,c=null!=t;this._renderer.pointDistanceEnabled=c&&null!=t.target&&this.visible,c&&(this._renderer.pointDistanceOrigin=t.origin,null!=t.target&&(this._renderer.pointDistanceTarget=t.target))}_disposeRenderer(){null!=this._renderer&&this.view._stage&&(this.view._stage.removeRenderPlugin(this._renderer),this._renderer=null)}}const ce=(0,u.Ue)()},30693:(ee,B,e)=>{e.d(B,{L:()=>T});var v=e(21286),u=e(79800),x=e(29302),l=e(63657),g=e(1503),E=e(1582),V=e(5548),I=e(26242),A=e(53928),z=e(81468),f=e(79112),d=e(8782),P=e(57521),b=e(16396),S=e(80805);class T extends A._{constructor(i){super(i),this._material=null,this._texture=null,this._geometry=null,this._size=3,this._color=(0,g.al)(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=(0,g.al)(1,1,1,1),this._elevationInfo=null,this.applyProperties(i)}get geometry(){return this._geometry}set geometry(i){this._geometry=i,this.recreateGeometry()}get size(){return this._size}set size(i){if(i!==this._size){const D=this._preferredTextureSize;this._size=i,D<this._preferredTextureSize?this.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(i){(0,l.a)(i,this._color)||((0,l.c)(this._color,i),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(i){this._pixelSnappingEnabled!==i&&(this._pixelSnappingEnabled=i,this._updateMaterial())}get primitive(){return this._primitive}set primitive(i){this._primitive!==i&&(this._primitive=i,this.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(i){i!==this._outlineSize&&(this._outlineSize=i,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(i){(0,l.a)(i,this._outlineColor)||((0,l.c)(this._outlineColor,i),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(i){this._elevationInfo=i,this.recreateGeometry()}_updateMaterial(){this._material&&this._material.setParameters(this._materialParameters)}_updateSizeAttribute(){const i=this.object;if(null==i)return;const D=i.geometries[0];if(null==D)return;const R=D.getMutableAttribute(b.T.SIZE).data,N=this._geometrySize;R[0]=N,R[1]=N,i.geometryVertexAttributeUpdated(i.geometries[0],b.T.SIZE)}get _materialParameters(){return{color:this._color,textureIsSignedDistanceField:!0,sampleSignedDistanceFieldTexelCenter:(0,d.Rg)(this._primitive),distanceFieldBoundingBox:H,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:this._texture?.id,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled,isDecoration:this.isDecoration}}get _geometrySize(){return this._size/o}createExternalResources(){this._texture=(0,d.cU)(this._primitive,this._preferredTextureSize),this._material=new S.A(this._materialParameters);const i=this.view._stage;this._texture.load(i.renderView.renderingContext),i.add(this._texture)}destroyExternalResources(){this._texture&&(this.view._stage.remove(this._texture),this._texture.dispose(),this._texture=null),this._material=null}createGeometries(i){const D=this._createRenderGeometry();null!=D&&i.addGeometry(D)}forEachExternalMaterial(i){this._material&&i(this._material)}get _preferredTextureSize(){return(0,v.uZ)(2*this._geometrySize,16,128)}calculateMapBounds(i){const D=this.object?.geometries[0];if(!D)return!1;const R=D.attributes.get(b.T.POSITION).data;return(0,E.S)(R,this.view.renderCoordsHelper.spatialReference,W,this.view.spatialReference),(0,V.G1)(i,W),!0}_createRenderGeometry(){const{geometry:i,_material:D}=this;if(null==i||null==D)return null;const{renderCoordsHelper:R,elevationProvider:N}=this.view,j=(0,z.w7)(i,N,f.o.fromElevationInfo(this.elevationInfo),R),U=(0,u.s)(I.WM.get(),i.x,i.y,j),K=I.WM.get();(0,E.S)(U,i.spatialReference,K,R.spatialReference);const M=this._geometrySize;return(0,P.dV)(D,null,K,null,[M,M],[0,0,0,1])}}const o=d.hy,H=[o/2,o/2,1-o/2,1-o/2],W=(0,x.Ue)()},47634:(ee,B,e)=>{e.d(B,{j:()=>I});var v=e(82951),u=e(39832),x=e(95285),l=e(97139),g=e(65787),E=e(17625),V=e(35387);function I(A,z){const f=A.fragment;f.include(v.S),A.include(u.GZ),f.uniforms.add(new g.p("globalAlpha",d=>d.globalAlpha),new l.J("glowColor",d=>d.glowColor),new g.p("glowWidth",(d,P)=>d.glowWidth*P.camera.pixelRatio),new g.p("glowFalloff",d=>d.glowFalloff),new l.J("innerColor",d=>d.innerColor),new g.p("innerWidth",(d,P)=>d.innerWidth*P.camera.pixelRatio),new V.A("depthMap",(d,P)=>P.linearDepth?.getTexture()),new x.A("nearFar",(d,P)=>P.camera.nearFar),new V.A("frameColor",(d,P)=>P.mainColor)),f.code.add(E.H`vec4 blendPremultiplied(vec4 source, vec4 dest) {
float oneMinusSourceAlpha = 1.0 - source.a;
return vec4(
source.rgb + dest.rgb * oneMinusSourceAlpha,
source.a + dest.a * oneMinusSourceAlpha
);
}`),f.code.add(E.H`vec4 premultipliedColor(vec3 rgb, float alpha) {
return vec4(rgb * alpha, alpha);
}`),f.code.add(E.H`vec4 laserlineProfile(float dist) {
if (dist > glowWidth) {
return vec4(0.0);
}
float innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));
float glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);
return blendPremultiplied(
premultipliedColor(innerColor, innerAlpha),
premultipliedColor(glowColor, glowAlpha)
);
}`),f.code.add(E.H`bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float depthDiscontinuityAlpha) {
float depth = linearDepthFromTexture(depthMap, uv, nearFar);
if (-depth == nearFar[0]) {
return false;
}
pos = reconstructPosition(gl_FragCoord.xy, depth);
normal = normalize(cross(dFdx(pos), dFdy(pos)));
float ddepth = fwidth(depth);
depthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);
return true;
}`),z.contrastControlEnabled?(f.uniforms.add(new g.p("globalAlphaContrastBoost",d=>null!=d.globalAlphaContrastBoost?d.globalAlphaContrastBoost:1)),f.code.add(E.H`float rgbToLuminance(vec3 color) {
return dot(vec3(0.2126, 0.7152, 0.0722), color);
}
vec4 laserlineOutput(vec4 color) {
float backgroundLuminance = rgbToLuminance(texture(frameColor, uv).rgb);
float alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);
return color * alpha;
}`)):f.code.add(E.H`vec4 laserlineOutput(vec4 color) {
return color * globalAlpha;
}`)}}}]);