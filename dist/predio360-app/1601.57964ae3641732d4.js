"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[1601],{41601:(ye,I,t)=>{t.r(I),t.d(I,{default:()=>de});var u=t(15861),a=t(17626),b=t(84792),P=t(79608),R=t(46160),j=t(26584),m=t(99959),Z=t(10699),F=t(21726),s=t(77712),O=(t(8314),t(63290)),g=(t(4619),t(76898)),f=t(44917),x=t(54024),U=t(93961),S=t(88159),C=t(552),L=t(99555),h=t(13812),E=t(30164),V=t(74154),B=t(31099),Q=t(55463),D=t(26072);class G{constructor(r,o){this.objectId=r,this.itemSource=o,this.count=0,this.layer=null,this.sortValue=void 0}}const c=new U.z(20,e=>e.destroy());let y=class extends((0,L.M)((0,C.h)((0,m.R)(f.Z)))){constructor(e){super(e),this._oidToReference=new Map,this._layerToReference=new Map,this._portals=new Map,this.layers=new R.Z,this.maximumVisibleSublayers=10,this.opacity=1,this.title="Layers In View",this.type="catalog-dynamic-group",this.visible=!0}load(e){return this.addResolvingPromise(this.parent.load()),Promise.resolve(this)}get _orderBy(){return this.parent.orderBy?.find(e=>!e.valueExpression&&e.field)??new V.Z({field:this.parent.objectIdField})}get _referenceComparator(){const e=this._orderBy,r=this.parent.fieldsIndex.get(e.field),o=(0,D.Lq)(r?.toJSON().type,"descending"===e.order);return(i,l)=>o(i.sortValue,l.sortValue)||i.objectId-i.objectId}acquireLayer(e){const r=e.getObjectId(),o=(0,S.s1)(this._oidToReference,r,()=>this._createLayerReference(e));return o.count++,(0,x.kB)(()=>{o.count--,o.count||this._disposeLayerReference(o)})}_createLayerReference(e){const r=e.getObjectId(),o=e.getAttribute(this.parent.itemSourceField),i=new G(r,o);if(c.get(o))return this._addLayer(c.pop(o),i,e),i;let l;try{l=JSON.parse(o)}catch(p){return O.Z.getLogger(this).error(p),i}return this._createLayer(l).then(p=>{this.destroyed||0===i.count?(c.get(o)||c.put(i.itemSource,p),i.layer=null):this._addLayer(p,i,e)}).catch(()=>{}),i}_addLayer(e,r,o){this._layerToReference.set(e,r),r.sortValue=o.getAttribute(this._orderBy.field),r.layer=e,e.parent=this,this.layers.add(e),this.layers.sort((i,l)=>this._referenceComparator(this._layerToReference.get(i),this._layerToReference.get(l)))}_disposeLayerReference(e){e.layer&&(this._layerToReference.delete(e.layer),this.layers.remove(e.layer),c.put(e.itemSource,e.layer)),this._oidToReference.delete(e.objectId)}_createLayer(e){var r=this;return(0,u.Z)(function*(){if(!function N(e){return"object"==typeof e&&null!=e&&"itemId"in e&&"portalUrl"in e}(e))return new(yield E.T.UnsupportedLayer());const{itemId:o,portalUrl:i}=e,l=(0,S.s1)(r._portals,i,()=>new B.Z({url:i}));return f.Z.fromPortalItem(new Q.default({id:o,portal:l}))})()}};(0,a._)([(0,s.Cb)()],y.prototype,"_orderBy",null),(0,a._)([(0,s.Cb)()],y.prototype,"_referenceComparator",null),(0,a._)([(0,s.Cb)({readOnly:!0})],y.prototype,"layers",void 0),(0,a._)([(0,s.Cb)()],y.prototype,"maximumVisibleSublayers",void 0),(0,a._)([(0,s.Cb)(h.Oh)],y.prototype,"opacity",void 0),(0,a._)([(0,s.Cb)({type:String,json:{name:"title",write:!0}})],y.prototype,"title",void 0),(0,a._)([(0,s.Cb)({json:{read:!1}})],y.prototype,"type",void 0),(0,a._)([(0,s.Cb)({type:Boolean,json:{name:"visibility",write:!0}})],y.prototype,"visible",void 0),y=(0,a._)([(0,g.j)("esri.layers.catalog.CatalogDynamicGroupLayer")],y);const M=y;var J=t(73281),A=(t(4832),t(68387),t(96794),t(69747),t(40425),t(69357),t(40342),t(73640),t(33474),t(32088)),z=t(35126),K=t(170),H=t(62667),Y=t(49430);let d=class extends((0,L.M)((0,z.b)((0,C.h)((0,m.R)(f.Z))))){constructor(e){super(e),this.labelingInfo=null,this.labelsVisible=!0,this.legendEnabled=!0,this.opacity=1,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.type="catalog-footprint",this.visible=!0}load(e){return this.addResolvingPromise(this.parent.load()),Promise.resolve(this)}get defaultPopupTemplate(){return this.createPopupTemplate()}get fields(){return this.parent.fields}get fieldsIndex(){return this.parent.fieldsIndex}get geometryType(){return this.parent.geometryType}get objectIdField(){return this.parent.objectIdField}get orderBy(){return this.parent.orderBy}createPopupTemplate(e){return(0,Y.eZ)({fields:this.parent.fields,objectIdField:this.parent.objectIdField,title:this.title},e)}createQuery(){return this.parent.createQuery()}queryFeatures(e,r){return this.parent.queryFeatures(e,r)}};(0,a._)([(0,s.Cb)({readOnly:!0})],d.prototype,"defaultPopupTemplate",null),(0,a._)([(0,s.Cb)({type:[K.Z],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:H.r,write:!0}})],d.prototype,"labelingInfo",void 0),(0,a._)([(0,s.Cb)(h.iR)],d.prototype,"labelsVisible",void 0),(0,a._)([(0,s.Cb)(h.rn)],d.prototype,"legendEnabled",void 0),(0,a._)([(0,s.Cb)(h.Oh)],d.prototype,"opacity",void 0),(0,a._)([(0,s.Cb)(h.C_)],d.prototype,"popupEnabled",void 0),(0,a._)([(0,s.Cb)({type:J.Z,json:{name:"popupInfo",write:!0}})],d.prototype,"popupTemplate",void 0),(0,a._)([(0,s.Cb)({types:A.A,json:{name:"layerDefinition.drawingInfo.renderer"}})],d.prototype,"renderer",void 0),(0,a._)([(0,s.Cb)({json:{read:!1}})],d.prototype,"type",void 0),(0,a._)([(0,s.Cb)({type:Boolean,json:{name:"visibility",write:!0}})],d.prototype,"visible",void 0),d=(0,a._)([(0,g.j)("esri.layers.catalog.CatalogFootprintLayer")],d);const W=d;var X=t(35349),$=t(56554),w=t(50085),q=t(65088),k=t(50107),_=t(58426),ee=t(49286),te=t(17165),re=t(6647),oe=t(30346),ae=t(97941),se=t(26331),ie=t(55911),ne=t(5676),v=t(96854);const T=(0,ie.v)();let n=class extends((0,_.B)((0,C.h)((0,te.c)((0,ae.n)((0,L.M)((0,oe.Q)((0,q.Y)((0,ee.q)((0,re.I)((0,m.R)((0,k.N)((0,w.V)((0,P.J)(f.Z)))))))))))))){constructor(e){super(e),this.dynamicGroupLayer=new M({parent:this}),this.fields=null,this.fieldsIndex=null,this.footprintLayer=new W({parent:this}),this.itemSourceField="cd_itemsource",this.itemTypeField="cd_itemtype",this.layers=new R.Z([this.dynamicGroupLayer,this.footprintLayer]),this.source=new X.default({layer:this}),this.type="catalog"}load(e){var r=this;const o=null!=e?e.signal:null,i=this.loadFromPortal({supportedTypes:["Feature Service"]},e).catch(Z.r9).then((0,u.Z)(function*(){if(!r.url)throw new j.Z("catalog-layer:missing-url","Catalog layer must be created with a url");if(r.url&&null==r.layerId){const l=yield r._fetchFirstValidLayerId(o);if(null==l)throw new j.Z("catalog-layer:missing-layerId","There is no Catalog Layer in the service",{service:r.url});r.layerId=l}yield r.source.load(),r.source.sourceJSON&&(r.sourceJSON=r.source.sourceJSON,r.read(r.source.sourceJSON,{origin:"service",portalItem:r.portalItem,portal:r.portalItem?.portal,url:r.parsedUrl}))})).then(()=>(0,se.nU)(this,"load",e));return this.addResolvingPromise(i),Promise.resolve(this)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("capabilities"),(this._get("createQueryVersion")??0)+1}get parsedUrl(){const e=(0,F.mN)(this.url);return null!=e&&null!=this.layerId&&(e.path=(0,F.v_)(e.path,this.layerId.toString())),e}createQuery(){const e=new v.Z,r=this.capabilities?.query;e.returnGeometry=!0,r&&(e.compactGeometryEnabled=r.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),e.outFields=["*"];const{timeOffset:o,timeExtent:i}=this;return e.timeExtent=null!=o&&null!=i?i.offset(-o.value,o.unit):i||null,e}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,r){return this.fieldsIndex.get(e)?.domain}queryFeatures(e,r){var o=this;return(0,u.Z)(function*(){const i=yield o.load(),l=yield i.source.queryFeatures(v.Z.from(e)??i.createQuery(),r);if(l?.features)for(const p of l.features)p.layer=p.sourceLayer=i.footprintLayer;return l})()}queryObjectIds(e,r){var o=this;return(0,u.Z)(function*(){return(yield o.load()).source.queryObjectIds(v.Z.from(e)??o.createQuery(),r)})()}queryFeatureCount(e,r){var o=this;return(0,u.Z)(function*(){return(yield o.load()).source.queryFeatureCount(v.Z.from(e)??o.createQuery(),r)})()}queryExtent(e,r){var o=this;return(0,u.Z)(function*(){return(yield o.load()).source.queryExtent(v.Z.from(e)??o.createQuery(),r)})()}serviceSupportsSpatialReference(e){return this.loaded&&(0,ne.D)(this,e)}read(e,r){super.read(e,r);let o=e.footprintLayer;o||"service"!==r?.origin||(o={layerDefinition:{drawingInfo:(0,$.bU)(e.geometryType)}}),this.footprintLayer.read(o,r)}_fetchFirstValidLayerId(e){return(0,b.Z)(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then(r=>{const o=r.data;if(o)return Array.isArray(o.layers)?o.layers.find(i=>"Catalog Layer"===i.type)?.id:void 0})}};(0,a._)([(0,s.Cb)({readOnly:!0})],n.prototype,"createQueryVersion",null),(0,a._)([(0,s.Cb)({...T.fields,json:{origins:{service:{name:"fields"}}}})],n.prototype,"fields",void 0),(0,a._)([(0,s.Cb)(T.fieldsIndex)],n.prototype,"fieldsIndex",void 0),(0,a._)([(0,s.Cb)({json:{read:!1,write:!1}})],n.prototype,"footprintLayer",void 0),(0,a._)([(0,s.Cb)()],n.prototype,"itemSourceField",void 0),(0,a._)([(0,s.Cb)()],n.prototype,"itemTypeField",void 0),(0,a._)([(0,s.Cb)()],n.prototype,"layers",void 0),(0,a._)([(0,s.Cb)({value:"CatalogLayer",type:["CatalogLayer"]})],n.prototype,"operationalLayerType",void 0),(0,a._)([(0,s.Cb)()],n.prototype,"outFields",void 0),(0,a._)([(0,s.Cb)({readOnly:!0})],n.prototype,"parsedUrl",null),(0,a._)([(0,s.Cb)()],n.prototype,"source",void 0),(0,a._)([(0,s.Cb)({json:{read:!1}})],n.prototype,"type",void 0),n=(0,a._)([(0,g.j)("esri.layers.CatalogLayer")],n);const de=n}}]);