"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[5602],{34013:(j,R,e)=>{e.d(R,{I:()=>I,b:()=>m});var o=e(62208),E=e(99770),C=e(13934),h=e(78925),D=e(24255),v=e(10109),f=e(67022),U=e(33726),c=e(2166),u=e(95285),S=e(65787),M=e(17625),d=e(22355),i=e(35387),l=e(44835),g=e(16396);function m(p){const P=new d.kG,{vertex:L,fragment:T}=P;return(0,c.Sv)(L,p),P.include(D.w,p),P.attributes.add(g.T.POSITION,"vec3"),P.attributes.add(g.T.UV0,"vec2"),P.varyings.add("vpos","vec3"),p.hasMultipassTerrain&&P.varyings.add("depth","float"),L.uniforms.add(new u.A("textureCoordinateScaleFactor",y=>(0,o.pC)(y.texture)&&(0,o.pC)(y.texture.descriptor.textureCoordinateScaleFactor)?y.texture.descriptor.textureCoordinateScaleFactor:E.O)),L.code.add(M.H`
    void main(void) {
      vpos = position;
      ${p.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
      vTexCoord = uv0 * textureCoordinateScaleFactor;
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),P.include(h.f5,p),P.include(v.l,p),T.uniforms.add([new i.A("tex",y=>y.texture),new S.p("opacity",y=>y.opacity)]),P.varyings.add("vTexCoord","vec2"),p.output===C.H.Alpha?T.code.add(M.H`
    void main() {
      discardBySlice(vpos);
      ${p.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

      float alpha = texture2D(tex, vTexCoord).a * opacity;
      if (alpha  < ${M.H.float(f.F)}) {
        discard;
      }

      gl_FragColor = vec4(alpha);
    }
    `):(T.include(U.Y),T.code.add(M.H`
    void main() {
      discardBySlice(vpos);
      ${p.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
      gl_FragColor = texture2D(tex, vTexCoord) * opacity;

      if (gl_FragColor.a < ${M.H.float(f.F)}) {
        discard;
      }

      gl_FragColor = highlightSlice(gl_FragColor, vpos);
      ${p.transparencyPassType===l.A.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    }
    `)),P}const I=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}))},19702:(j,R,e)=>{e.d(R,{A:()=>S});var o=e(15861),E=e(17626),C=e(54024),h=e(10699),D=e(32917),v=e(77712),c=(e(90912),e(85931),e(76898)),u=e(36947);const S=M=>{let d=class extends M{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(i){super.postscript(i),(0,u.qC)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}_validateHeightModelInfo(){var i=this;return(0,o.Z)(function*(){const l=new AbortController,g=l.signal;i.handles.add((0,C.kB)(()=>l.abort())),yield(0,D.N1)(()=>i.view.defaultsFromMap?.heightModelInfoReady,g),(0,h.k_)(g);const m=(0,u.Wt)(i.layer,i.view.heightModelInfo,i.supportsHeightUnitConversion);if(m)throw m})()}canResume(){const i=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return super.canResume()&&(!i||!i.minScale||!i.maxScale||i.minScale>=i.maxScale)}getSuspendInfo(){const i=super.getSuspendInfo(),l=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return l&&l.minScale&&l.maxScale&&l.minScale<l.maxScale&&(i.outsideScaleRange=!0),i}};return(0,E._)([(0,v.Cb)()],d.prototype,"view",void 0),(0,E._)([(0,v.Cb)()],d.prototype,"slicePlaneEnabled",void 0),d=(0,E._)([(0,c.j)("esri.views.3d.layers.LayerView3D")],d),d}},75602:(j,R,e)=>{e.r(R),e.d(R,{default:()=>H});var o=e(15861),E=e(17626),C=e(54024),h=e(62208),D=e(10699),v=e(32917),f=e(77712),u=(e(90912),e(85931),e(76898)),S=e(65401),M=e(17732),d=e(62600),i=e(19702),l=e(64835),g=e(94255),m=e(42743),I=e(41120),p=e(54840),P=e(64232),L=e(81695),T=e(23147),y=e(16396),B=e(79967),K=e(45611),O=e(67969);let W=class extends((0,i.A)(K.Z)){constructor(){var s;super(...arguments),s=this,this.type="media-3d",this.drapeSourceType=d.Lw.RasterImage,this.updatePolicy=T.j.ASYNC,this._uidToElement=new Map,this._renderedElements=new Map,this._lastDrapingExtent=null,this._update=(0,D.Ds)(function(){var a=(0,o.Z)(function*(t,n,_){const A=yield s._collectMediaElements(t,n,_);s._synchronizeRenderElements(A)});return function(t,n,_){return a.apply(this,arguments)}}(),0)}initialize(){this._renderer=this.view.basemapTerrain.overlayManager.registerGeometryDrapeSource(this);const s=()=>this._updateWithLastDrapingExtent();this.handles.add([(0,C.kB)(()=>this.view.basemapTerrain.overlayManager.unregisterDrapeSource(this)),(0,v.on)(()=>this.layer.effectiveSource,"change",s),(0,v.on)(()=>this.layer.effectiveSource,"refresh",s)]),this.updatingHandles.add(()=>this.suspended,s)}setDrapingExtent(s,a){this._lastDrapingExtent={overlays:s,spatialReference:a},this._updateWithLastDrapingExtent()}getHit(s){const a=this._uidToElement.get(s);return a?{type:"media",element:a,layer:this.layer}:null}_updateWithLastDrapingExtent(){if((0,h.Wi)(this._lastDrapingExtent)||this.suspended)return void(this._renderer&&this._synchronizeRenderElements(new Set));const{overlays:s,spatialReference:a}=this._lastDrapingExtent;this.updatingHandles.addPromise(this._update(s,a).catch(()=>{}))}_collectMediaElements(s,a,t){var n=this;return(0,o.Z)(function*(){const _=n.layer.effectiveSource;return(0,h.Wi)(_)?new Set:new Set((yield Promise.all(s.map(A=>_.queryElements((0,S.HH)(A.extent,a),{signal:t})))).flat())})()}_synchronizeRenderElements(s){this._synchronizeRenderElementsRemove(s),this._synchronizeRenderElementsAdd(s)}_synchronizeRenderElementsRemove(s){const a=new Set,t=[];this._renderedElements.forEach((n,_)=>{s.has(_)||(a.add(_),(0,h.pC)(n.renderData)&&t.push(n.renderData.renderGeometry),this._removeElement(_,n))}),this._renderer.removeGeometries(t,p.T.REMOVE)}_synchronizeRenderElementsAdd(s){for(const a of s)this._renderedElements.has(a)||this._createRenderElement(a)}_removeElement(s,{renderData:a,handle:t}){this._destroyRenderData(a),this._renderedElements.delete(s),this._uidToElement.delete(s.uid),t.remove()}_createRenderElement(s){var a=this;return(0,o.Z)(function*(){const t=new M.L({spatialReference:a.view.spatialReference,element:s}),n={renderData:null,handle:(0,C.AL)([a.updatingHandles.add(()=>s.opacity,_=>{(0,h.pC)(n.renderData)&&n.renderData.material.setParameters({opacity:_})}),a.updatingHandles.add(()=>t.coords,_=>{(0,h.pC)(n.renderData)?a._updateGeometry(n,n.renderData,_):a._initializeRenderData(t,n)}),a.updatingHandles.add(()=>s.content,()=>a._initializeRenderData(t,n)),(0,C.ed)(t)])};a._renderedElements.set(s,n),a._uidToElement.set(s.uid,s),a.updatingHandles.addPromise(s.load().catch(()=>{})),a._initializeRenderData(t,n)})()}_initializeRenderData(s,a){const{coords:t,element:n}=s;if((0,h.Wi)(t)||(0,h.Wi)(n.content))return void(a.renderData=this._destroyRenderData(a.renderData));if((0,h.pC)(a.renderData))return;const _=this._createTexture(n.content);this.view._stage.add(_);const A=this.view._stage.loadImmediate(_);(0,D.y8)(A)&&this.updatingHandles.addPromise(A);const x=new B.j({initTextureTransparent:!0,textureId:_.id,opacity:n.opacity,transparent:!0}),F=this._positionVertexBufferFromCoordinates(t),b=[0,1,2,0,2,3],z=new I.Z(x,[[y.T.POSITION,new g.a(F,3,!0)],[y.T.UV0,new g.a([0,0,1,0,1,1,0,1],2,!0)]],[[y.T.POSITION,b],[y.T.UV0,b]]),w=new P.z(z,{layerUid:this.layer.uid,graphicUid:n.uid});this._renderer.addGeometries([w],p.T.ADD),a.renderData={renderGeometry:w,texture:_,material:x}}_updateGeometry(s,a,t){if((0,h.Wi)(t))return void(s.renderData=this._destroyRenderData(s.renderData));const n=this._positionVertexBufferFromCoordinates(t);a.renderGeometry.vertexAttributes.get(y.T.POSITION).data=n,this._renderer.modifyGeometries([a.renderGeometry],p.$.GEOMETRY)}_positionVertexBufferFromCoordinates(s){const[a,t,n,_]=s.rings[0];return[a[0],a[1],l.Rn,_[0],_[1],l.Rn,n[0],n[1],l.Rn,t[0],t[1],l.Rn]}_destroyRenderData(s){return(0,h.Wi)(s)||(this.view._stage.remove(s.texture),this._renderer.removeGeometries([s.renderGeometry],p.T.REMOVE),s.material.dispose()),null}_createTexture(s){const a=s instanceof HTMLImageElement?s.naturalWidth:s.width,t=s instanceof HTMLImageElement?s.naturalHeight:s.height;return new L.x(s,{wrap:{s:O.e8.CLAMP_TO_EDGE,t:O.e8.CLAMP_TO_EDGE},preMultiplyAlpha:!0,width:a,height:t,mipmap:!0,powerOfTwoResizeMode:m.CE.STRETCH,updateCallback:()=>this.view.basemapTerrain.overlayManager.setDrawTexturesDirty()})}get test(){const s=this;return{get numberOfElements(){return s._renderedElements.size}}}};(0,E._)([(0,f.Cb)({readOnly:!0})],W.prototype,"type",void 0),(0,E._)([(0,f.Cb)()],W.prototype,"layer",void 0),W=(0,E._)([(0,u.j)("esri.views.3d.layers.MediaLayerView3D")],W);const H=W},79967:(j,R,e)=>{e.d(R,{j:()=>W});var o=e(13934),E=e(42743),C=e(33470),h=e(40723),D=e(88569),v=e(5894),f=e(2770),U=e(66131),c=e(15842),u=e(17626),M=(e(17625),e(651)),d=e(91056),i=e(87601),l=e(39114),g=e(12407),m=e(64127),I=e(44835),p=e(41528),P=e(34013),L=e(67969),T=e(2078);class B extends d.A{initializeProgram(t){return new g.$(t.rctx,B.shader.get().build(this.configuration),l.i)}_setPipelineState(t,n){const _=this.configuration,A=t===I.A.NONE,x=t===I.A.FrontFace;return(0,T.sm)({blending:_.output!==o.H.Color&&_.output!==o.H.Alpha||!_.transparent?null:A?K:(0,D.j7)(t),culling:(0,T.zp)(_.cullFace),depthTest:{func:(0,D.Bh)(t)},depthWrite:A?_.writeDepth?T.LZ:null:(0,D.K5)(t),colorWrite:T.BK,stencilWrite:_.hasOccludees?m.s3:null,stencilTest:_.hasOccludees?n?m.eD:m.RY:null,polygonOffset:A||x?null:(0,D.je)(_.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,n){return n?this._occludeePipelineState:super.getPipelineState(t,n)}}B.shader=new M.J(P.I,()=>e.e(8586).then(e.bind(e,18586)));const K=(0,T.if)(L.zi.ONE,L.zi.ONE_MINUS_SRC_ALPHA);class O extends p.W{constructor(){super(...arguments),this.output=o.H.Color,this.cullFace=E.Vr.None,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=I.A.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}(0,u._)([(0,i.o)({count:o.H.COUNT})],O.prototype,"output",void 0),(0,u._)([(0,i.o)({count:E.Vr.COUNT})],O.prototype,"cullFace",void 0),(0,u._)([(0,i.o)()],O.prototype,"hasSlicePlane",void 0),(0,u._)([(0,i.o)()],O.prototype,"transparent",void 0),(0,u._)([(0,i.o)()],O.prototype,"enableOffset",void 0),(0,u._)([(0,i.o)()],O.prototype,"writeDepth",void 0),(0,u._)([(0,i.o)()],O.prototype,"hasOccludees",void 0),(0,u._)([(0,i.o)({count:I.A.COUNT})],O.prototype,"transparencyPassType",void 0),(0,u._)([(0,i.o)()],O.prototype,"hasMultipassTerrain",void 0),(0,u._)([(0,i.o)()],O.prototype,"cullAboveGround",void 0);class W extends c.c{constructor(t){super(t,new s),this.supportsEdges=!0,this._configuration=new O}getConfiguration(t,n){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=n.transparencyPassType,this._configuration.enableOffset=n.camera.relativeElevation<D.ve,this._configuration.hasMultipassTerrain=n.multipassTerrain.enabled,this._configuration.cullAboveGround=n.multipassTerrain.cullAboveGround,this._configuration}requiresSlot(t,n){return!(n!==o.H.Color&&n!==o.H.Alpha&&n!==o.H.Highlight||t!==v.r.DRAPED_MATERIAL&&(n===o.H.Highlight?t!==v.r.OPAQUE_MATERIAL:t!==(this.parameters.transparent?this.parameters.writeDepth?v.r.TRANSPARENT_MATERIAL:v.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:v.r.OPAQUE_MATERIAL)))}createGLMaterial(t){return new H(t)}createBufferWriter(){return new f.G(U.W1)}}class H extends C.F{constructor(t){super({...t,...t.material.parameters})}_updateParameters(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(B,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:t.hasOccludees}),this._updateParameters(t))}beginSlot(t){return this._output!==o.H.Color&&this._output!==o.H.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class s extends h.Mt{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=E.Vr.None,this.hasOccludees=!1,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0}}},45611:(j,R,e)=>{e.d(R,{Z:()=>i});var o=e(17626),E=e(14517),C=e(61885),h=e(80542),D=e(61996),v=e(63290),f=e(62208),U=e(60330),c=e(77712),M=(e(90912),e(85931),e(76898));let d=class extends((0,h.p)((0,D.IG)((0,U.v)(C.Z.EventedMixin(E.Z))))){constructor(l){super(l),this.layer=null,this.parent=null}initialize(){this.when().catch(l=>{if("layerview:create-error"!==l.name){const g=this.layer&&this.layer.id||"no id",m=this.layer&&this.layer.title||"no title";v.Z.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${m}', id: '${g}')`,l)}})}get fullOpacity(){return(0,f.Pt)(this.get("layer.opacity"),1)*(0,f.Pt)(this.get("parent.fullOpacity"),1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer?.legendEnabled}get updating(){return!(!this.updatingHandles?.updating&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){return!0===this.layer?.visible}set visible(l){this._overrideIfSome("visible",l)}canResume(){return this.visible&&this.layer?.loaded&&!this.parent?.suspended&&this.view?.ready||!1}getSuspendInfo(){const l=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(l.viewNotReady=!0),this.layer&&this.layer.loaded||(l.layerNotLoaded=!0),this.visible||(l.layerInvisible=!0),l}isUpdating(){return!1}};(0,o._)([(0,c.Cb)()],d.prototype,"fullOpacity",null),(0,o._)([(0,c.Cb)()],d.prototype,"layer",void 0),(0,o._)([(0,c.Cb)()],d.prototype,"parent",void 0),(0,o._)([(0,c.Cb)({readOnly:!0})],d.prototype,"suspended",null),(0,o._)([(0,c.Cb)({readOnly:!0})],d.prototype,"suspendInfo",null),(0,o._)([(0,c.Cb)({readOnly:!0})],d.prototype,"legendEnabled",null),(0,o._)([(0,c.Cb)({type:Boolean,readOnly:!0})],d.prototype,"updating",null),(0,o._)([(0,c.Cb)({readOnly:!0})],d.prototype,"updatingProgress",null),(0,o._)([(0,c.Cb)()],d.prototype,"visible",null),(0,o._)([(0,c.Cb)()],d.prototype,"view",void 0),d=(0,o._)([(0,M.j)("esri.views.layers.LayerView")],d);const i=d}}]);