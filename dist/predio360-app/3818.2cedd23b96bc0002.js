"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[3818],{65389:(X,N,h)=>{h.d(N,{Z:()=>x});class x{constructor(w){this.size=0,this._start=0,this.maxSize=w,this._buffer=new Array(w)}get entries(){return this._buffer}enqueue(w){if(this.size===this.maxSize){const S=this._buffer[this._start];return this._buffer[this._start]=w,this._start=(this._start+1)%this.maxSize,S}return this._buffer[(this._start+this.size++)%this.maxSize]=w,null}dequeue(){if(0===this.size)return null;const w=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,w}peek(){return 0===this.size?null:this._buffer[this._start]}find(w){if(0===this.size)return null;for(const S of this._buffer)if(null!=S&&w(S))return S;return null}clear(w){let S=this.dequeue();for(;null!=S;)w&&w(S),S=this.dequeue()}}},24192:(X,N,h)=>{h.d(N,{Z:()=>W});var w,f,x=h(8314),g=h(27899);(f=w||(w={}))[f.varint=0]="varint",f[f.fixed64=1]="fixed64",f[f.delimited=2]="delimited",f[f.fixed32=5]="fixed32",f[f.unknown=99]="unknown";const S=4294967296,V=new TextDecoder("utf-8"),Z=(0,x.Z)("safari")||(0,x.Z)("ios")?6:(0,x.Z)("ff")?12:32;class W{constructor(e,n,a=0,s=(e?e.byteLength:0)){this._tag=0,this._dataType=w.unknown,this._init(e,n,a,s)}_init(e,n,a,s){this._data=e,this._dataView=n,this._pos=a,this._end=s}asUnsafe(){return this}clone(){return new W(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(e){this._pos=e}nextTag(e){for(;;){if(this._pos===this._end)return!1;const n=this._decodeVarint();if(this._tag=n>>3,this._dataType=7&n,!e||e===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const e=this._decodeVarint();return this._tag=e>>3,this._dataType=7&e,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let e=4294967295;if(e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128||(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128)||(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128)||(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128)||(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128))return e;throw new Error("Varint overflow")}getUInt64(){return this._decodeVarint()}getSInt32(){const e=this.getUInt32();return e>>>1^-(1&e)|0}getSInt64(){return this._decodeSVarint()}getBool(){const e=0!==this._data[this._pos];return this._skip(1),e}getEnum(){return this._decodeVarint()}getFixed64(){const e=this._dataView,n=this._pos,a=e.getUint32(n,!0)+e.getUint32(n+4,!0)*S;return this._skip(8),a}getSFixed64(){const e=this._dataView,n=this._pos,a=e.getUint32(n,!0)+e.getInt32(n+4,!0)*S;return this._skip(8),a}getDouble(){const e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e}getFixed32(){const e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e}getSFixed32(){const e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e}getFloat(){const e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e}getString(){const e=this._getLength(),n=this._pos,a=this._toString(this._data,n,n+e);return this._skip(e),a}getBytes(){const e=this._getLength(),n=this._pos,a=this._toBytes(this._data,n,n+e);return this._skip(e),a}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(e,n,a,s){const p=this.getMessage(),z=e(p,n,a,s);return p.release(),z}processMessage(e){const n=this.getMessage(),a=e(n);return n.release(),a}getMessage(){const e=this._getLength(),n=W.pool.acquire();return n._init(this._data,this._dataView,this._pos,this._pos+e),this._skip(e),n}release(){W.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case w.varint:this._decodeVarint();break;case w.fixed64:this._skip(8);break;case w.delimited:this._skip(this._getLength());break;case w.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(e){this._skip(e)}_skip(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e}_decodeVarint(){const e=this._data;let n=this._pos,a=0,s=0;if(this._end-n>=10)do{if(s=e[n++],a|=127&s,0==(128&s)||(s=e[n++],a|=(127&s)<<7,0==(128&s))||(s=e[n++],a|=(127&s)<<14,0==(128&s))||(s=e[n++],a|=(127&s)<<21,0==(128&s))||(s=e[n++],a+=268435456*(127&s),0==(128&s))||(s=e[n++],a+=34359738368*(127&s),0==(128&s))||(s=e[n++],a+=4398046511104*(127&s),0==(128&s))||(s=e[n++],a+=562949953421312*(127&s),0==(128&s))||(s=e[n++],a+=72057594037927940*(127&s),0==(128&s))||(s=e[n++],a+=0x8000000000000000*(127&s),0==(128&s)))break;throw new Error("Varint too long!")}while(0);else{let p=1;for(;n!==this._end&&(s=e[n],0!=(128&s));)++n,a+=(127&s)*p,p*=128;if(n===this._end)throw new Error("Varint overrun!");++n,a+=s*p}return this._pos=n,a}_decodeSVarint(){const e=this._data;let n,a=0,s=0;const p=1&e[this._pos];if(s=e[this._pos++],a|=127&s,0==(128&s)||(s=e[this._pos++],a|=(127&s)<<7,0==(128&s))||(s=e[this._pos++],a|=(127&s)<<14,0==(128&s))||(s=e[this._pos++],a|=(127&s)<<21,0==(128&s))||(s=e[this._pos++],a+=268435456*(127&s),0==(128&s))||(s=e[this._pos++],a+=34359738368*(127&s),0==(128&s))||(s=e[this._pos++],a+=4398046511104*(127&s),0==(128&s)))return p?-(a+1)/2:a/2;if(n=BigInt(a),s=e[this._pos++],n+=0x2000000000000n*BigInt(127&s),0==(128&s)||(s=e[this._pos++],n+=0x100000000000000n*BigInt(127&s),0==(128&s))||(s=e[this._pos++],n+=0x8000000000000000n*BigInt(127&s),0==(128&s)))return Number(p?-(n+1n)/2n:n/2n);throw new Error("Varint too long!")}_getLength(){if(this._dataType!==w.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(e,n,a){if((a=Math.min(this._end,a))-n>Z){const z=e.subarray(n,a);return V.decode(z)}let s="",p="";for(let z=n;z<a;++z){const B=e[z];128&B?p+="%"+B.toString(16):(s+=decodeURIComponent(p)+String.fromCharCode(B),p="")}return p.length&&(s+=decodeURIComponent(p)),s}_toBytes(e,n,a){return a=Math.min(this._end,a),new Uint8Array(e.buffer,n,a-n)}}W.pool=new g.Z(W,void 0,f=>{f._data=null,f._dataView=null})},80576:(X,N,h)=>{h.d(N,{Q:()=>Y});var x=h(17626),g=h(83761),S=(h(26584),h(8314)),Z=(h(63290),h(77712)),f=(h(4619),h(76898)),e=h(39351),n=h(21286),a=h(42797);class K{constructor(l,u,c){this._debugMap=new Map,this._width=l*c,this._height=u*c,this._pixelRatio=c;const y=Math.ceil(this._width/1),b=Math.ceil(this._height/1);this._cols=y,this._rows=b,this._cells=a.p.create(y*b)}insertMetrics(l){this._markMetrics(l)}hasCollision(l){let u=0;for(const{computedX:c,computedY:y,width:b,height:_}of l.bounds)switch(this._collide(c,y,(b+e.gj)*this._pixelRatio,(_+e.gj)*this._pixelRatio)){case 2:return 2;case 1:u++}return u===l.bounds.length?1:0}getCellId(l,u){return l+u*this._cols}has(l){return this._cells.has(l)}hasRange(l,u){return this._cells.hasRange(l,u)}set(l){this._cells.set(l)}setRange(l,u){this._cells.setRange(l,u)}_collide(l,u,c,y){const b=l-c/2,_=u-y/2,v=b+c,m=_+y;if(v<0||m<0||b>this._width||_>this._height)return 1;const I=(0,n.uZ)(Math.floor(b/1),0,this._cols),M=(0,n.uZ)(Math.floor(_/1),0,this._rows),O=(0,n.uZ)(Math.ceil(v/1),0,this._cols),T=(0,n.uZ)(Math.ceil(m/1),0,this._rows);for(let L=M;L<=T;L++)for(let C=I;C<=O;C++){const A=this.getCellId(C,L);if(this.has(A))return 2}return 0}_mark(l,u,c,y,b){const _=l-c/2,v=u-y/2,m=_+c,I=v+y,M=(0,n.uZ)(Math.floor(_/1),0,this._cols),O=(0,n.uZ)(Math.floor(v/1),0,this._rows),T=(0,n.uZ)(Math.ceil(m/1),0,this._cols),L=(0,n.uZ)(Math.ceil(I/1),0,this._rows);for(let C=O;C<=L;C++)for(let A=M;A<=T;A++){const J=this.getCellId(A,C);this._debugMap.set(J,b),this.set(J)}return!1}_markMetrics(l){for(const{computedX:u,computedY:c,width:y,height:b}of l.bounds)this._mark(u,c,(y+e.gj)*this._pixelRatio,(b+e.gj)*this._pixelRatio,l.entityTexel)}}const G=254,$=255;function Q(R,l){const u=R.children.slice();u.sort((c,y)=>c.tileAge-y.tileAge),u.forEach(c=>{null!=c.labelMetrics&&c.isReady&&l(c,c.labelMetrics)})}function et(R,l){return(!R.minScale||R.minScale>=l)&&(!R.maxScale||R.maxScale<=l)}class ot{run(l,u,c,y){const b=[];for(let _=l.length-1;_>=0;_--){const v=l[_];v.labelingCollisionInfos?.length&&b.push(...v.labelingCollisionInfos)}(0,S.Z)("esri-2d-update-debug")&&b.length&&console.debug("CollisionEngine.run"),this._transformMetrics(b),this._runCollision(b,u,c,y);for(const _ of b)_.container.requestRender()}_runCollision(l,u,c,y){const[b,_]=u.state.size,v=new K(b,_,u.pixelRatio);for(const{container:m,deconflictionEnabled:I,visible:M}of l){const O=m.attributeView;I?M?(this._prepare(m),this._collideVisible(v,m,c,y),this._collideInvisible(v,m)):Q(m,(T,L)=>{for(const C of L)O.setLabelMinZoom(C.entityTexel,$)}):Q(m,(T,L)=>{for(const C of L)et(C,c)?(O.setLabelMinZoom(C.entityTexel,0),M&&v.insertMetrics(C)):O.setLabelMinZoom(C.entityTexel,G)})}}_isFiltered(l,u,c){const y=u.getFilterFlags(l);return!((!c.hasFilter||y&e.g3)&&(null==c.featureEffect||c.featureEffect.excludedLabelsVisible||y&e.kU))}_prepare(l){const u=l.attributeView,c=new Set;Q(l,(y,b)=>{for(const _ of b){const v=_.entityTexel;if(!c.has(v)){if(c.add(v),this._isFiltered(v,u,l.layerView)){u.setLabelMinZoom(v,G);continue}0!==u.getLabelMinZoom(v)?u.setLabelMinZoom(v,$):u.setLabelMinZoom(v,0)}}})}_collideVisible(l,u,c,y){const b=u.attributeView,_=new Set;Q(u,(v,m)=>{for(let I=0;I<m.length;I++){const M=m[I].entityTexel;if(_.has(M))continue;if(v.key.level!==y){b.setLabelMinZoom(M,G),_.add(M);continue}if(!et(m[I],c)){b.setLabelMinZoom(M,G),_.add(M);continue}if(0!==b.getLabelMinZoom(M)){_.add(M);continue}let O=!1,T=!0;const L=I;let C=I;for(;C<m.length;C++){const A=m[C];if(A.entityTexel!==M)break;if(!O)switch(l.hasCollision(A)){case 1:break;case 2:O=!0,T=!1;break;case 0:T=!1}}if(!O)for(let A=L;A<C;A++)l.insertMetrics(m[A]);I=C-1,T||(_.add(M),b.setLabelMinZoom(M,O?G:0))}})}_collideInvisible(l,u){const c=u.attributeView,y=new Set;Q(u,(b,_)=>{for(let v=0;v<_.length;v++){const m=_[v].entityTexel;if(y.has(m))continue;if(c.getLabelMinZoom(m)!==$){y.add(m);continue}let I=!1,M=!0;const O=v;let T=v;for(;T<_.length;T++){const L=_[T];if(L.entityTexel!==m)break;if(!I)switch(l.hasCollision(L)){case 1:break;case 2:I=!0,M=!1;break;case 0:M=!1}}if(!I)for(let L=O;L<T;L++)l.insertMetrics(_[L]);v=T-1,M||(y.add(m),c.setLabelMinZoom(m,I?$:0))}})}_transformMetrics(l){for(const{container:u,geometryType:c,vvEvaluators:y}of l)Q(u,(b,_)=>{const v=u.attributeView,m=b.transforms.labelMat2d;m[4]=Math.round(m[4]),m[5]=Math.round(m[5]);const I="polyline"===c;for(const M of _){const{entityTexel:O,anchorX:T,anchorY:L}=M;let C=M.referenceBounds?.size??0;const A=y[0];if(null!=A){const F=A(v.getVVSize(O));C=isNaN(F)||null==F||F===1/0?C:F}const J=M.directionX*(C/2),j=M.directionY*(C/2);for(const F of M.bounds){let t=T,i=L;if(I){let o=t+F.x+J,r=i+F.y+j;o=m[0]*o+m[2]*r+m[4],r=m[1]*o+m[3]*r+m[5],F.computedX=Math.floor(o),F.computedY=Math.floor(r)}else{t=m[0]*T+m[2]*L+m[4],i=m[1]*T+m[3]*L+m[5];const r=i+F.y+j;F.computedX=t+F.x+J,F.computedY=r}}}})}}let Y=class extends g.Z{constructor(R){super(R),this._lastUpdate=0,this.collisionEngine=new ot,this.lastUpdateId=-1,this.updateRequested=!1,this.view=null}get updating(){return(0,S.Z)("esri-2d-log-updating")&&console.log(`Updating LabelManager ${this.updateRequested}:\n-> updateRequested: ${this.updateRequested}`),this.updateRequested}update(R){const l=performance.now();l-this._lastUpdate>=32?(this._lastUpdate=l,this.doUpdate(R)):this.requestUpdate()}viewChange(){this.requestUpdate()}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view?.requestUpdate())}processUpdate(R){this.updateRequested&&(this.updateRequested=!1,this.update(R))}doUpdate(R){const l=this.view;if(l)try{const u=R.state.scale,c=l.featuresTilingScheme.getClosestInfoForScale(u).level;this.collisionEngine.run(l.allLayerViews.items,R,u,c)}catch{}}};(0,x._)([(0,Z.Cb)()],Y.prototype,"updateRequested",void 0),(0,x._)([(0,Z.Cb)()],Y.prototype,"updating",null),(0,x._)([(0,Z.Cb)()],Y.prototype,"view",void 0),Y=(0,x._)([(0,f.j)("esri.views.2d.LabelManager")],Y)},22796:(X,N,h)=>{h.d(N,{Q:()=>Z});var x=h(65389),g=h(61885),w=h(8314),S=h(46593);const V=(0,w.Z)("esri-2d-profiler");class Z{constructor(f,e){if(this._events=new g.Z,this._entries=new Map,this._timings=new x.Z(10),this._currentContainer=null,this._currentPass=null,this._currentBrush=null,this._currentSummary=null,!V)return;this._ext=(0,S.mO)(f.gl,{}),this._debugOutput=e;const n=f.gl;if(!this.enableCommandLogging)return;let a;for(a in n)if("function"==typeof n[a]){const s=n[a],p=a.includes("draw");n[a]=(...z)=>(this._events.emit("command",{container:this._currentContainer,pass:this._currentPass,brush:this._currentBrush,method:a,args:z,isDrawCommand:p}),this._currentSummary&&(this._currentSummary.commands++,p&&this._currentSummary.drawCommands++),s.apply(n,z))}}get enableCommandLogging(){return!("object"==typeof V&&V.disableCommands)}recordContainerStart(f){V&&(this._currentContainer=f)}recordContainerEnd(){V&&(this._currentContainer=null)}recordPassStart(f){V&&(this._currentPass=f,this._initSummary())}recordPassEnd(){V&&(this._currentPass=null,this._emitSummary())}recordBrushStart(f){V&&(this._currentBrush=f)}recordBrushEnd(){V&&(this._currentBrush=null)}recordStart(f){if(V&&null!=this._ext){if(this._entries.has(f)){const n=this._entries.get(f),a=this._ext.resultAvailable(n.query),s=this._ext.disjoint();if(a&&!s){const p=this._ext.getResult(n.query)/1e6;let z=0;if(null!=this._timings.enqueue(p)){const G=this._timings.entries,$=G.length;let H=0;for(const Q of G)H+=Q;z=H/$}const B=p.toFixed(2),K=z?z.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed(`Frame report for ${f}, ${B} ms (${K} last 10 avg)\n${n.commandsLen} Commands (${n.drawCommands} draw)`),console.log("RenderPass breakdown: "),console.table(n.summaries),console.log("Commands: ",n.commands),console.groupEnd()):console.log(`Frame report for ${f}, ${B} ms (${K} last 10 avg)`),this._debugOutput.innerHTML=`${B} (${K})`}for(const p of n.handles)p.remove();this._ext.deleteQuery(n.query),this._entries.delete(f)}const e={name:f,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(e.handles.push(this._events.on("command",n=>{e.commandsLen++,e.commands.push(n),n.isDrawCommand&&e.drawCommands++})),e.handles.push(this._events.on("summary",n=>{e.summaries.push(n)}))),this._ext.beginTimeElapsed(e.query),this._entries.set(f,e)}}recordEnd(f){V&&null!=this._ext&&this._entries.has(f)&&this._ext.endTimeElapsed()}_initSummary(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})}_emitSummary(){this.enableCommandLogging&&this._currentSummary&&this._events.emit("summary",this._currentSummary)}}},35903:(X,N,h)=>{h.d(N,{Q:()=>g});var x=h(37977);const g={shaders:{vertexShader:(0,x.w)("bitBlit/bitBlit.vert"),fragmentShader:(0,x.w)("bitBlit/bitBlit.frag")},attributes:new Map([["a_pos",0],["a_tex",1]])}},8017:(X,N,h)=>{h.d(N,{C:()=>g,y:()=>w});var x=h(37977);const g={shaders:{vertexShader:(0,x.w)("highlight/textured.vert"),fragmentShader:(0,x.w)("highlight/highlight.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])},w={shaders:{vertexShader:(0,x.w)("highlight/textured.vert"),fragmentShader:(0,x.w)("highlight/blur.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])}},18142:(X,N,h)=>{h.d(N,{F:()=>S,c:()=>w});var x=h(37977),g=h(94299);const w={shaders:{vertexShader:(0,x.w)("magnifier/magnifier.vert"),fragmentShader:(0,x.w)("magnifier/magnifier.frag")},attributes:new Map([["a_pos",0]])};function S(V){return(0,g.H)(V,w)}},60233:(X,N,h)=>{h.d(N,{H:()=>g});var x=h(37977);const g={shaders:{vertexShader:(0,x.w)("stencil/stencil.vert"),fragmentShader:(0,x.w)("stencil/stencil.frag")},attributes:new Map([["a_pos",0]])}},69709:(X,N,h)=>{h.d(N,{Z:()=>F});var x=h(15861),g=h(17626),w=h(19389),S=h(83761),V=h(62208),Z=h(77712),n=(h(8314),h(63290),h(4619),h(76898)),a=h(72642),s=h(24926),p=h(23841),z=h(5801);const B="esri-zoom-box",K={container:`${B}__container`,overlay:`${B}__overlay`,background:`${B}__overlay-background`,box:`${B}__outline`};let $=class extends S.Z{constructor(t){super(t),this._container=null,this._overlay=null,this._backgroundShape=null,this._boxShape=null,this._box={x:0,y:0,width:0,height:0},this._rafId=null,this._redraw=this._redraw.bind(this)}destroy(){this.view=null}set view(t){this.removeAllHandles(),this._destroyOverlay(),this._set("view",t),t&&this.addHandles([t.on("drag",["Shift"],i=>this._handleDrag(i,1),z.f.INTERNAL),t.on("drag",["Shift","Ctrl"],i=>this._handleDrag(i,-1),z.f.INTERNAL)])}_start(){this._createContainer(),this._createOverlay(),this.navigation.begin()}_update(t,i,o,r){this._box.x=t,this._box.y=i,this._box.width=o,this._box.height=r,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}_end(t,i,o,r,d){const E=this.view,P=E.toMap((0,p.vW)(t+.5*o,i+.5*r));let U=Math.max(o/E.width,r/E.height);-1===d&&(U=1/U),this._destroyOverlay(),this.navigation.end(),E.goTo({center:P,scale:E.scale*U})}_updateBox(t,i,o,r){const d=this._boxShape;d.setAttributeNS(null,"x",""+t),d.setAttributeNS(null,"y",""+i),d.setAttributeNS(null,"width",""+o),d.setAttributeNS(null,"height",""+r),d.setAttributeNS(null,"class",K.box)}_updateBackground(t,i,o,r){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(t,i,o,r,this.view.width,this.view.height))}_createContainer(){const t=document.createElement("div");t.className=K.container,this.view.root.appendChild(t),this._container=t}_createOverlay(){const t=this.view.width,i=this.view.height,o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttributeNS(null,"d","M 0 0 L "+t+" 0 L "+t+" "+i+" L 0 "+i+" Z"),o.setAttributeNS(null,"class",K.background);const r=document.createElementNS("http://www.w3.org/2000/svg","rect"),d=document.createElementNS("http://www.w3.org/2000/svg","svg");d.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),d.setAttributeNS(null,"class",K.overlay),d.appendChild(o),d.appendChild(r),this._container.appendChild(d),this._backgroundShape=o,this._boxShape=r,this._overlay=d}_destroyOverlay(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null}_toSVGPath(t,i,o,r,d,E){const P=t+o,U=i+r;return"M 0 0 L "+d+" 0 L "+d+" "+E+" L 0 "+E+" ZM "+t+" "+i+" L "+t+" "+U+" L "+P+" "+U+" L "+P+" "+i+" Z"}_handleDrag(t,i){const o=t.x,r=t.y,d=t.origin.x,E=t.origin.y;let P,U,D,k;switch(o>d?(P=d,D=o-d):(P=o,D=d-o),r>E?(U=E,k=r-E):(U=r,k=E-r),t.action){case"start":this._start();break;case"update":this._update(P,U,D,k);break;case"end":this._end(P,U,D,k,i)}t.stopPropagation()}_redraw(){if(!this._rafId||(this._rafId=null,!this._overlay))return;const{x:t,y:i,width:o,height:r}=this._box;this._updateBox(t,i,o,r),this._updateBackground(t,i,o,r),this._rafId=requestAnimationFrame(this._redraw)}};(0,g._)([(0,Z.Cb)()],$.prototype,"navigation",void 0),(0,g._)([(0,Z.Cb)()],$.prototype,"view",null),$=(0,g._)([(0,n.j)("esri.views.2d.navigation.ZoomBox")],$);const H=$;h(29132);var et=h(32917),ot=h(79800),st=h(29302),Y=h(88500);let R=class extends S.Z{constructor(t){super(t),this.animationTime=0,this.momentumEstimator=new Y.G(500,6,.92),this.momentum=null,this.tmpMomentum=(0,st.Ue)(),this.momentumFinished=!1,this.viewpoint=new w.Z({targetGeometry:new a.Z,scale:0,rotation:0}),this._previousDrag=null,(0,et.gx)(()=>this.momentumFinished,()=>this.navigation.stop())}begin(t,i){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(i),this._previousDrag=i}update(t,i){this.addToEstimator(i);let o=i.center.x,r=i.center.y;const d=this._previousDrag;o=d?d.center.x-o:-o,r=d?r-d.center.y:r,t.viewpoint=(0,s.Rx)(this.viewpoint,t.viewpoint,[o||0,r||0]),this._previousDrag=i}end(t,i){this.addToEstimator(i),this.momentum=t.navigation.momentumEnabled?this.momentumEstimator.evaluateMomentum():null,this.animationTime=0,this.momentum&&this.onAnimationUpdate(t),this._previousDrag=null,this.navigation.end()}addToEstimator(t){const i=t.center.x,o=t.center.y,r=(0,p.s1)(-i,o),d=(0,st.al)(-i,o,0);this.momentumEstimator.add(r,d,.001*t.timestamp)}onAnimationUpdate(t){this.navigation.animationManager?.animateContinous(t.viewpoint,(i,o)=>{const{momentum:r,animationTime:d,tmpMomentum:E}=this,P=.001*o;if(!(this.momentumFinished=!r||r.isFinished(d))){const U=r.valueDelta(d,P);(0,ot.h)(E,r.direction,U),(0,s.Rx)(i,i,E),t.constraints.constrainByGeometry(i)}this.animationTime+=P})}stopMomentumNavigation(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())}};(0,g._)([(0,Z.Cb)()],R.prototype,"momentumFinished",void 0),(0,g._)([(0,Z.Cb)()],R.prototype,"viewpoint",void 0),(0,g._)([(0,Z.Cb)()],R.prototype,"navigation",void 0),R=(0,g._)([(0,n.j)("esri.views.2d.navigation.actions.Pan")],R);const l=R;var u=h(95470),c=h(15331),y=h(6532),b=h(35843);let _=class extends S.Z{constructor(t){super(t),this._animationTime=0,this._momentumFinished=!1,this._previousAngle=0,this._previousRadius=0,this._previousCenter=null,this._rotationMomentumEstimator=new y.y(.6,.15,.95),this._rotationDirection=1,this._startAngle=0,this._startRadius=0,this._updateTimestamp=null,this._zoomDirection=1,this._zoomMomentumEstimator=new b.D,this._zoomOnly=null,this.zoomMomentum=null,this.rotateMomentum=null,this.viewpoint=new w.Z({targetGeometry:new a.Z,scale:0,rotation:0}),this.addHandles((0,et.gx)(()=>this._momentumFinished,()=>this.navigation.stop()))}begin(t,i){this.navigation.begin(),this._rotationMomentumEstimator.reset(),this._zoomMomentumEstimator.reset(),this._zoomOnly=null,this._previousAngle=this._startAngle=i.angle,this._previousRadius=this._startRadius=i.radius,this._previousCenter=i.center,this._updateTimestamp=null,t.constraints.rotationEnabled&&this.addToRotateEstimator(0,i.timestamp),this.addToZoomEstimator(i,1)}update(t,i){null===this._updateTimestamp&&(this._updateTimestamp=i.timestamp);const o=i.angle,r=i.radius,d=i.center,E=Math.abs(180*(o-this._startAngle)/Math.PI),P=Math.abs(r-this._startRadius),U=this._startRadius/r;if(this._previousRadius&&this._previousCenter){const D=r/this._previousRadius;let k=180*(o-this._previousAngle)/Math.PI;this._rotationDirection=k>=0?1:-1,this._zoomDirection=D>=1?1:-1,t.constraints.rotationEnabled?(null===this._zoomOnly&&i.timestamp-this._updateTimestamp>200&&(this._zoomOnly=P-E>0),null===this._zoomOnly||this._zoomOnly?k=0:this.addToRotateEstimator(o-this._startAngle,i.timestamp)):k=0,this.addToZoomEstimator(i,U),this.navigation.setViewpoint([d.x,d.y],1/D,k,[this._previousCenter.x-d.x,d.y-this._previousCenter.y])}this._previousAngle=o,this._previousRadius=r,this._previousCenter=d}end(t){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=0,(this.rotateMomentum||this.zoomMomentum)&&this.onAnimationUpdate(t),this.navigation.end()}addToRotateEstimator(t,i){this._rotationMomentumEstimator.add(t,.001*i)}addToZoomEstimator(t,i){this._zoomMomentumEstimator.add(i,.001*t.timestamp)}canZoomIn(t){const o=t.constraints.effectiveMaxScale;return 0===o||t.scale>o}canZoomOut(t){const o=t.constraints.effectiveMinScale;return 0===o||t.scale<o}onAnimationUpdate(t){this.navigation.animationManager?.animateContinous(t.viewpoint,(i,o)=>{const r=!this.canZoomIn(t)&&this._zoomDirection>1||!this.canZoomOut(t)&&this._zoomDirection<1,d=!this.rotateMomentum||this.rotateMomentum.isFinished(this._animationTime),E=r||!this.zoomMomentum||this.zoomMomentum.isFinished(this._animationTime),P=.001*o;if(this._momentumFinished=d&&E,!this._momentumFinished){const U=this.rotateMomentum?Math.abs(this.rotateMomentum.valueDelta(this._animationTime,P))*this._rotationDirection*180/Math.PI:0;let D=this.zoomMomentum?Math.abs(this.zoomMomentum.valueDelta(this._animationTime,P)):1;const k=(0,c.Ue)(),q=(0,c.Ue)();if(this._previousCenter){(0,u.t8)(k,this._previousCenter.x,this._previousCenter.y),(0,s.Dq)(q,t.size,t.padding),(0,u.IH)(k,k,q);const{constraints:tt,scale:it}=t,nt=it*D;D<1&&!tt.canZoomInTo(nt)?(D=it/tt.effectiveMaxScale,this.zoomMomentum=null,this.rotateMomentum=null):D>1&&!tt.canZoomOutTo(nt)&&(D=it/tt.effectiveMinScale,this.zoomMomentum=null,this.rotateMomentum=null),(0,s.UZ)(i,t.viewpoint,D,U,k,t.size),t.constraints.constrainByGeometry(i)}}this._animationTime+=P})}stopMomentumNavigation(){(this.rotateMomentum||this.zoomMomentum)&&(this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop())}};(0,g._)([(0,Z.Cb)()],_.prototype,"_momentumFinished",void 0),(0,g._)([(0,Z.Cb)()],_.prototype,"viewpoint",void 0),(0,g._)([(0,Z.Cb)()],_.prototype,"navigation",void 0),_=(0,g._)([(0,n.j)("esri.views.2d.navigation.actions.Pinch")],_);const v=_,m=(0,c.Ue)(),I=(0,c.Ue)();let M=class extends S.Z{constructor(t){super(t),this._previousCenter=(0,c.Ue)(),this.viewpoint=new w.Z({targetGeometry:new a.Z,scale:0,rotation:0})}begin(t,i){this.navigation.begin(),(0,u.t8)(this._previousCenter,i.center.x,i.center.y)}update(t,i){const{state:{size:o,padding:r}}=t;(0,u.t8)(m,i.center.x,i.center.y),(0,s.ni)(I,o,r),t.viewpoint=(0,s.$H)(this.viewpoint,t.state.paddedViewState.viewpoint,(0,s.dI)(I,this._previousCenter,m)),(0,u.JG)(this._previousCenter,m)}end(){this.navigation.end()}};(0,g._)([(0,Z.Cb)()],M.prototype,"viewpoint",void 0),(0,g._)([(0,Z.Cb)()],M.prototype,"navigation",void 0),M=(0,g._)([(0,n.j)("esri.views.2d.actions.Rotate")],M);const O=M,T=10,C=new w.Z({targetGeometry:new a.Z}),A=[0,0];let j=class extends S.Z{constructor(t){super(t),this._endTimer=null,this._lastEventTimestamp=null,this.animationManager=null,this.interacting=!1}initialize(){this.pan=new l({navigation:this}),this.rotate=new O({navigation:this}),this.pinch=new v({navigation:this}),this.zoomBox=new H({view:this.view,navigation:this})}destroy(){this.pan=(0,V.SC)(this.pan),this.rotate=(0,V.SC)(this.rotate),this.pinch=(0,V.SC)(this.pinch),this.zoomBox=(0,V.SC)(this.zoomBox),this.animationManager=null}begin(){this.stop(),this._set("interacting",!0)}end(){this._lastEventTimestamp=performance.now(),this._startTimer(250)}zoom(t,i=this._getDefaultAnchor()){var o=this;return(0,x.Z)(function*(){if(o.begin(),o.view.constraints.snapToZoom&&o.view.constraints.effectiveLODs)return t<1?o.zoomIn(i):o.zoomOut(i);o.setViewpoint(i,t,0,[0,0])})()}zoomIn(t){var i=this;return(0,x.Z)(function*(){const o=i.view,r=o.constraints.snapToNextScale(o.scale);return i._zoomToScale(r,t)})()}zoomOut(t){var i=this;return(0,x.Z)(function*(){const o=i.view,r=o.constraints.snapToPreviousScale(o.scale);return i._zoomToScale(r,t)})()}setViewpoint(t,i,o,r){this.begin(),this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,t,i,o,r),this.end()}setViewpointImmediate(t,i=0,o=[0,0],r=this._getDefaultAnchor()){this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,r,t,i,o)}continousRotateClockwise(){this.animationManager?.animateContinous(this.view.viewpoint,i=>{(0,s.$H)(i,i,-1)})}continousRotateCounterclockwise(){this.animationManager?.animateContinous(this.view.viewpoint,i=>{(0,s.$H)(i,i,1)})}resetRotation(){this.view.constraints.rotationEnabled&&(this.view.rotation=0)}continousPanLeft(){this._continuousPan([-T,0])}continousPanRight(){this._continuousPan([T,0])}continousPanUp(){this._continuousPan([0,T])}continousPanDown(){this._continuousPan([0,-T])}continuousPanVector({x:t,y:i}){this._continuousPan([t*T,i*T])}stop(){this.pan.stopMomentumNavigation(),this.animationManager?.stop(),this.end(),null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))}_continuousPan(t){this.animationManager?.animateContinous(this.view.viewpoint,o=>{(0,s.Rx)(o,o,t),this.view.constraints.constrainByGeometry(o)})}_startTimer(t){return null!==this._endTimer||(this._endTimer=setTimeout(()=>{this._endTimer=null;const i=performance.now()-(this._lastEventTimestamp??0);i<250?this._endTimer=this._startTimer(i):this._set("interacting",!1)},t)),this._endTimer}_getDefaultAnchor(){const{size:t,padding:{left:i,right:o,top:r,bottom:d}}=this.view;return A[0]=.5*(t[0]-o+i),A[1]=.5*(t[1]-d+r),A}_zoomToScale(t,i=this._getDefaultAnchor()){var o=this;return(0,x.Z)(function*(){const{view:r}=o,{constraints:d,scale:E,viewpoint:P,size:U,padding:D}=r,k=d.canZoomInTo(t),q=d.canZoomOutTo(t);if(!(t<E&&!k||t>E&&!q))return(0,s.gG)(C,P,t/E,0,i,U,D),d.constrainByGeometry(C),r.goTo(C,{animate:!0,pickClosestTarget:!1})})()}_scaleRotateTranslateViewpoint(t,i,o,r,d){const{view:E}=this,{size:P,padding:U,constraints:D,scale:k,viewpoint:q}=E,tt=k*o,it=D.canZoomInTo(tt),nt=D.canZoomOutTo(tt);return(o<1&&!it||o>1&&!nt)&&(o=1),(0,s.Rx)(q,q,d),(0,s.gG)(t,q,o,r,i,P,U),D.constrainByGeometry(t)}};(0,g._)([(0,Z.Cb)()],j.prototype,"animationManager",void 0),(0,g._)([(0,Z.Cb)({type:Boolean,readOnly:!0})],j.prototype,"interacting",void 0),(0,g._)([(0,Z.Cb)()],j.prototype,"pan",void 0),(0,g._)([(0,Z.Cb)()],j.prototype,"pinch",void 0),(0,g._)([(0,Z.Cb)()],j.prototype,"rotate",void 0),(0,g._)([(0,Z.Cb)()],j.prototype,"view",void 0),(0,g._)([(0,Z.Cb)()],j.prototype,"zoomBox",void 0),j=(0,g._)([(0,n.j)("esri.views.2d.navigation.MapViewNavigation")],j);const F=j}}]);