"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[7566],{57566:(A,C,n)=>{n.r(C),n.d(C,{SceneLayerSnappingSource:()=>h});var c=n(15861),o=n(17626),g=n(83761),E=n(85931),w=n(10699),a=n(77712),f=(n(8314),n(63290),n(76898)),L=n(54024),m=n(62208),I=(n(4619),n(11426)),Z=n(94033),H=n(29302),k=n(42930),V=n(97126),O=n(21733),R=n(75897),x=n(70211);let u=class extends g.Z{constructor(e){super(e),this.availability=0,this._ids=new Set}destroy(){this._workerHandle.destroy(),this._workerHandle=null}initialize(){this._workerHandle=new j(this.schedule,{fetchAllEdgeLocations:(e,t)=>this._fetchAllEdgeLocations(e,t)})}fetchCandidates(e,t){var r=this;return(0,c.Z)(function*(){const i=e.coordinateHelper,{point:d}=e,s=P;r.renderCoordsHelper.toRenderCoords(d,i.spatialReference,s);const p=e.distance,y="number"==typeof p?p:p.distance,v=yield r._workerHandle.invoke({bounds:(0,V.f)(s[0],s[1],s[2],y),returnEdge:e.returnEdge,returnVertex:"none"!==e.vertexMode},t);return v.candidates.sort((S,W)=>S.distance-W.distance),v.candidates.map(S=>r._convertCandidate(i,S))})()}add(e,t){var r=this;return(0,c.Z)(function*(){r._ids.add(e.id),yield r._workerHandle.invokeMethod("add",e,t)})()}remove(e,t){var r=this;return(0,c.Z)(function*(){r._ids.delete(e.id),yield r._workerHandle.invokeMethod("remove",e,t)})()}_convertCandidate(e,t){switch(t.type){case"edge":return new R.L({objectId:t.objectId,targetPoint:this._convertRenderCoordinate(e,t.target),edgeStart:this._convertRenderCoordinate(e,t.start),edgeEnd:this._convertRenderCoordinate(e,t.end),isDraped:!1});case"vertex":return new x.x({objectId:t.objectId,targetPoint:this._convertRenderCoordinate(e,t.target),isDraped:!1})}}_convertRenderCoordinate({spatialReference:e},t){const r=(0,H.Ue)();return this.renderCoordsHelper.fromRenderCoords(t,r,e),(0,O.uo)(r)}_fetchAllEdgeLocations(e,t){var r=this;return(0,c.Z)(function*(){const i=[],d=[];for(const{id:s,uid:p}of e.components)r._ids.has(s)&&i.push((0,c.Z)(function*(){const y=yield r.fetchEdgeLocations(s,t.signal),v=y.locations.buffer;return d.push(v),{id:s,uid:p,objectIds:y.objectIds,locations:v,origin:y.origin,type:y.type}})());return{result:{components:(yield Promise.all(i)).filter(({id:s})=>r._ids.has(s))},transferList:d}})()}};(0,o._)([(0,a.Cb)({constructOnly:!0})],u.prototype,"renderCoordsHelper",void 0),(0,o._)([(0,a.Cb)({constructOnly:!0})],u.prototype,"fetchEdgeLocations",void 0),(0,o._)([(0,a.Cb)({constructOnly:!0})],u.prototype,"schedule",void 0),(0,o._)([(0,a.Cb)({readOnly:!0})],u.prototype,"availability",void 0),u=(0,o._)([(0,f.j)("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],u);class j extends k.q{constructor(t,r){super("SceneLayerSnappingSourceWorker","fetchCandidates",{},t,{strategy:"dedicated",client:r})}}const P=(0,H.Ue)();let l=class extends g.Z{get updating(){return this._updatingHandles.updating}constructor(e){super(e),this.availability=1,this._updatingHandles=new I.R,this._abortController=new AbortController}destroy(){this._tracker=(0,m.hw)(this._tracker),this._abortController=(0,m.IM)(this._abortController),this._updatingHandles.destroy()}initialize(){var e=this;const{view:t}=this,r=t.resourceController;var i;this._edgeWorker=new Z.D(b(r)),this._workerHandle=new u({renderCoordsHelper:this.view.renderCoordsHelper,schedule:b(r),fetchEdgeLocations:(i=(0,c.Z)(function*(d,s){if(null==e._tracker)throw new Error("tracker-not-initialized");return e._tracker.fetchEdgeLocations(d,e._edgeWorker,s)}),function(s,p){return i.apply(this,arguments)})}),this._updatingHandles.addPromise(this._setupLayerView()),this.addHandles([(0,L.ed)(this._workerHandle),(0,L.ed)(this._edgeWorker)])}fetchCandidates(e,t){var r=this;return(0,c.Z)(function*(){return r._workerHandle.fetchCandidates(e,t)})()}refresh(){}_setupLayerView(){var e=this;return(0,c.Z)(function*(){if(e.destroyed)return;const t=e._abortController?.signal,r=yield e.getLayerView();null==r||(0,w.Hc)(t)||(e._tracker=r.trackSnappingSources({add:(i,d)=>{e._updatingHandles.addPromise(e._workerHandle.add({id:i,bounds:d},t))},remove:i=>{e._updatingHandles.addPromise(e._workerHandle.remove({id:i},t))}}))})()}};function b(e){return t=>e.immediate.schedule(t)}(0,o._)([(0,a.Cb)({constructOnly:!0})],l.prototype,"getLayerView",void 0),(0,o._)([(0,a.Cb)({constructOnly:!0})],l.prototype,"view",void 0),(0,o._)([(0,a.Cb)({readOnly:!0})],l.prototype,"updating",null),(0,o._)([(0,a.Cb)({readOnly:!0})],l.prototype,"availability",void 0),l=(0,o._)([(0,f.j)("esri.views.interactive.snapping.featureSources.I3SSnappingSource")],l);let h=class extends g.Z{get updating(){return this._i3sSources.some(e=>e.updating)}constructor(e){super(e),this.availability=1,this._i3sSources=[]}destroy(){this._i3sSources.forEach(e=>e.destroy()),this._i3sSources.length=0}initialize(){const{view:e}=this,t=this.layerSource.layer;this._i3sSources="building-scene"===t.type?this._getBuildingSceneI3SSources(e,t):[this._getSceneLayerI3SSource(e,t)]}fetchCandidates(e,t){var r=this;return(0,c.Z)(function*(){const i=yield Promise.all(r._i3sSources.map(d=>d.fetchCandidates(e,t)));return(0,w.k_)(t),i.flat()})()}refresh(){this._i3sSources.forEach(e=>e.refresh())}_getBuildingSceneI3SSources(e,t){return t.allSublayers.toArray().map(r=>{return"building-component"===r.type?new l({getLayerView:(i=(0,c.Z)(function*(){return(yield e.whenLayerView(t)).whenSublayerView(r)}),function(){return i.apply(this,arguments)}),view:e}):null;var i}).filter(E.pC)}_getSceneLayerI3SSource(e,t){return new l({getLayerView:(r=(0,c.Z)(function*(){const i=yield e.whenLayerView(t);return"scene-layer-graphics-3d"===i.type?void 0:i}),function(){return r.apply(this,arguments)}),view:e});var r}};(0,o._)([(0,a.Cb)({constructOnly:!0})],h.prototype,"layerSource",void 0),(0,o._)([(0,a.Cb)({constructOnly:!0})],h.prototype,"view",void 0),(0,o._)([(0,a.Cb)({readOnly:!0})],h.prototype,"updating",null),(0,o._)([(0,a.Cb)({readOnly:!0})],h.prototype,"availability",void 0),h=(0,o._)([(0,f.j)("esri.views.interactive.snapping.featureSources.SceneLayerSnappingSource")],h)}}]);