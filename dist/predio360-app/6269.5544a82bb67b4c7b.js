"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[6269],{36592:(Z,b,u)=>{u.d(b,{Q:()=>C});var L=u(85931),B=u(62208),W=u(77029),j=u(14259);class C{constructor(e=9,i){this._compareMinX=S,this._compareMinY=p,this._toBBox=n=>n,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),i&&("function"==typeof i?this._toBBox=i:this._initFormat(i)),this.clear()}destroy(){this.clear(),R.prune(),Y.prune(),T.prune(),c.prune()}all(e){this._all(this._data,e)}search(e,i){let n=this._data;const h=this._toBBox;if(P(e,n))for(R.clear();n;){for(let t=0,s=n.children.length;t<s;t++){const o=n.children[t],l=n.leaf?h(o):o;P(e,l)&&(n.leaf?i(o):g(e,l)?this._all(o,i):R.push(o))}n=R.pop()}}collides(e){let i=this._data;const n=this._toBBox;if(!P(e,i))return!1;for(R.clear();i;){for(let h=0,t=i.children.length;h<t;h++){const s=i.children[h],o=i.leaf?n(s):s;if(P(e,o)){if(i.leaf||g(e,o))return!0;R.push(s)}}i=R.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let n=0,h=e.length;n<h;n++)this.insert(e[n]);return this}let i=this._build(e.slice(0,e.length),0,e.length-1,0);if(this._data.children.length)if(this._data.height===i.height)this._splitRoot(this._data,i);else{if(this._data.height<i.height){const n=this._data;this._data=i,i=n}this._insert(i,this._data.height-i.height-1,!0)}else this._data=i;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new _([]),this}remove(e){if(!e)return this;let i,n=this._data,h=null,t=0,s=!1;const o=this._toBBox(e);for(T.clear(),c.clear();n||T.length>0;){if(n||(n=(0,B.j0)(T.pop()),h=T.data[T.length-1],t=c.pop()??0,s=!0),n.leaf&&(i=(0,L.cq)(n.children,e,n.children.length,n.indexHint),-1!==i))return n.children.splice(i,1),T.push(n),this._condense(T),this;s||n.leaf||!g(n,o)?h?(t++,n=h.children[t],s=!1):n=null:(T.push(n),c.push(t),t=0,h=n,n=n.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_all(e,i){let n=e;for(Y.clear();n;){if(!0===n.leaf)for(const h of n.children)i(h);else Y.pushArray(n.children);n=Y.pop()??null}}_build(e,i,n,h){const t=n-i+1;let s=this._maxEntries;if(t<=s){const y=new _(e.slice(i,n+1));return E(y,this._toBBox),y}h||(h=Math.ceil(Math.log(t)/Math.log(s)),s=Math.ceil(t/s**(h-1)));const o=new m([]);o.height=h;const l=Math.ceil(t/s),x=l*Math.ceil(Math.sqrt(s));A(e,i,n,x,this._compareMinX);for(let y=i;y<=n;y+=x){const M=Math.min(y+x-1,n);A(e,y,M,l,this._compareMinY);for(let O=y;O<=M;O+=l){const K=Math.min(O+l-1,M);o.children.push(this._build(e,O,K,h-1))}}return E(o,this._toBBox),o}_chooseSubtree(e,i,n,h){for(;h.push(i),!0!==i.leaf&&h.length-1!==n;){let t,s=1/0,o=1/0;for(let l=0,x=i.children.length;l<x;l++){const y=i.children[l],M=I(y),O=X(e,y)-M;O<o?(o=O,s=M<s?M:s,t=y):O===o&&M<s&&(s=M,t=y)}i=t||i.children[0]}return i}_insert(e,i,n){const t=n?e:(0,this._toBBox)(e);T.clear();const s=this._chooseSubtree(t,this._data,i,T);for(s.children.push(e),D(s,t);i>=0&&T.data[i].children.length>this._maxEntries;)this._split(T,i),i--;this._adjustParentBBoxes(t,T,i)}_split(e,i){const n=e.data[i],h=n.children.length,t=this._minEntries;this._chooseSplitAxis(n,t,h);const s=this._chooseSplitIndex(n,t,h);if(!s)return void console.log("  Error: assertion failed at PooledRBush._split: no valid split index");const o=n.children.splice(s,n.children.length-s),l=n.leaf?new _(o):new m(o);l.height=n.height,E(n,this._toBBox),E(l,this._toBBox),i?e.data[i-1].children.push(l):this._splitRoot(n,l)}_splitRoot(e,i){this._data=new m([e,i]),this._data.height=e.height+1,E(this._data,this._toBBox)}_chooseSplitIndex(e,i,n){let h,t,s;h=t=1/0;for(let o=i;o<=n-i;o++){const l=v(e,0,o,this._toBBox),x=v(e,o,n,this._toBBox),y=f(l,x),M=I(l)+I(x);y<h?(h=y,s=o,t=M<t?M:t):y===h&&M<t&&(t=M,s=o)}return s}_chooseSplitAxis(e,i,n){const h=e.leaf?this._compareMinX:S,t=e.leaf?this._compareMinY:p;this._allDistMargin(e,i,n,h)<this._allDistMargin(e,i,n,t)&&e.children.sort(h)}_allDistMargin(e,i,n,h){e.children.sort(h);const t=this._toBBox,s=v(e,0,i,t),o=v(e,n-i,n,t);let l=U(s)+U(o);for(let x=i;x<n-i;x++){const y=e.children[x];D(s,e.leaf?t(y):y),l+=U(s)}for(let x=n-i-1;x>=i;x--){const y=e.children[x];D(o,e.leaf?t(y):y),l+=U(o)}return l}_adjustParentBBoxes(e,i,n){for(let h=n;h>=0;h--)D(i.data[h],e)}_condense(e){for(let i=e.length-1;i>=0;i--){const n=e.data[i];if(0===n.children.length)if(i>0){const h=e.data[i-1],t=h.children;t.splice((0,L.cq)(t,n,t.length,h.indexHint),1)}else this.clear();else E(n,this._toBBox)}}_initFormat(e){const i=["return a"," - b",";"];this._compareMinX=new Function("a","b",i.join(e[0])),this._compareMinY=new Function("a","b",i.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}function E(a,e){v(a,0,a.children.length,e,a)}function v(a,e,i,n,h){h||(h=new _([])),h.minX=1/0,h.minY=1/0,h.maxX=-1/0,h.maxY=-1/0;for(let t,s=e;s<i;s++)t=a.children[s],D(h,a.leaf?n(t):t);return h}function D(a,e){a.minX=Math.min(a.minX,e.minX),a.minY=Math.min(a.minY,e.minY),a.maxX=Math.max(a.maxX,e.maxX),a.maxY=Math.max(a.maxY,e.maxY)}function S(a,e){return a.minX-e.minX}function p(a,e){return a.minY-e.minY}function I(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function U(a){return a.maxX-a.minX+(a.maxY-a.minY)}function X(a,e){return(Math.max(e.maxX,a.maxX)-Math.min(e.minX,a.minX))*(Math.max(e.maxY,a.maxY)-Math.min(e.minY,a.minY))}function f(a,e){const i=Math.max(a.minX,e.minX),n=Math.max(a.minY,e.minY),h=Math.min(a.maxX,e.maxX),t=Math.min(a.maxY,e.maxY);return Math.max(0,h-i)*Math.max(0,t-n)}function g(a,e){return a.minX<=e.minX&&a.minY<=e.minY&&e.maxX<=a.maxX&&e.maxY<=a.maxY}function P(a,e){return e.minX<=a.maxX&&e.minY<=a.maxY&&e.maxX>=a.minX&&e.maxY>=a.minY}function A(a,e,i,n,h){const t=[e,i];for(;t.length;){const s=(0,B.j0)(t.pop()),o=(0,B.j0)(t.pop());if(s-o<=n)continue;const l=o+Math.ceil((s-o)/n/2)*n;(0,j.q)(a,l,o,s,h),t.push(o,l,l,s)}}const R=new W.Z,Y=new W.Z,T=new W.Z,c=new W.Z({deallocator:void 0});class r{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class d extends r{constructor(){super(...arguments),this.height=1,this.indexHint=new L.SO}}class _ extends d{constructor(e){super(),this.children=e,this.leaf=!0}}class m extends d{constructor(e){super(),this.children=e,this.leaf=!1}}},65629:(Z,b,u)=>{u.d(b,{SR:()=>S,Ui:()=>D});var L=u(62208),B=u(65401),W=u(32442),j=u(25748),C=u(91179),E=u(74618),v=u(37053);function D(c){return p(c,!0)}function S(c){return p(c,!1)}function p(c,r){if((0,L.Wi)(c))return null;const d=c.spatialReference,_=(0,v.C5)(d),m="toJSON"in c?c.toJSON():c;if(!_)return m;const a=(0,v.sS)(d)?102100:4326,e=E.UZ[a].maxX,i=E.UZ[a].minX;if((0,C.wp)(m))return U(m,e,i);if((0,C.aW)(m))return m.points=m.points.map(n=>U(n,e,i)),m;if((0,C.YX)(m))return function I(c,r){if(!r)return c;const d=function X(c,r){const d=[],{ymin:_,ymax:m,xmin:a,xmax:e}=c,i=c.xmax-c.xmin,[n,h]=r.valid,{x:t,frameId:s}=f(c.xmin,r),{x:o,frameId:l}=f(c.xmax,r),x=t===o&&i>0;if(i>2*h){const y={xmin:a<e?t:o,ymin:_,xmax:h,ymax:m},M={xmin:n,ymin:_,xmax:a<e?o:t,ymax:m},O={xmin:0,ymin:_,xmax:h,ymax:m},K={xmin:n,ymin:_,xmax:0,ymax:m},F=[],w=[];g(y,O)&&F.push(s),g(y,K)&&w.push(s),g(M,O)&&F.push(l),g(M,K)&&w.push(l);for(let z=s+1;z<l;z++)F.push(z),w.push(z);d.push(new R(y,[s]),new R(M,[l]),new R(O,F),new R(K,w))}else t>o||x?d.push(new R({xmin:t,ymin:_,xmax:h,ymax:m},[s]),new R({xmin:n,ymin:_,xmax:o,ymax:m},[l])):d.push(new R({xmin:t,ymin:_,xmax:o,ymax:m},[s]));return d}(c,r).map(_=>_.extent);return d.length<2?d[0]||c:d.length>2?(c.xmin=r.valid[0],c.xmax=r.valid[1],c):{rings:d.map(_=>[[_.xmin,_.ymin],[_.xmin,_.ymax],[_.xmax,_.ymax],[_.xmax,_.ymin],[_.xmin,_.ymin]])}}(m,_);if((0,C.oU)(m)||(0,C.l9)(m)){const n=(0,W.$P)(Y,m),h={xmin:n[0],ymin:n[1],xmax:n[2],ymax:n[3]},t=(0,E.XZ)(h.xmin,i)*(2*e),s=0===t?m:(0,E.Sy)(m,t);return h.xmin+=t,h.xmax+=t,h.xmax>e?A(s,e,r):h.xmin<i?A(s,i,r):s}return m}function U(c,r,d){if(Array.isArray(c)){const _=c[0];if(_>r){const m=(0,E.XZ)(_,r);c[0]=_+m*(-2*r)}else if(_<d){const m=(0,E.XZ)(_,d);c[0]=_+m*(-2*d)}}else{const _=c.x;if(_>r){const m=(0,E.XZ)(_,r);c.x+=m*(-2*r)}else if(_<d){const m=(0,E.XZ)(_,d);c.x+=m*(-2*d)}}return c}function f(c,r){const[d,_]=r.valid,m=2*_;let a,e=0;return c>_?(a=Math.ceil(Math.abs(c-_)/m),c-=a*m,e=a):c<d&&(a=Math.ceil(Math.abs(c-d)/m),c+=a*m,e=-a),{x:c,frameId:e}}function g(c,r){const{xmin:d,ymin:_,xmax:m,ymax:a}=r;return P(c,d,_)&&P(c,d,a)&&P(c,m,a)&&P(c,m,_)}function P(c,r,d){return r>=c.xmin&&r<=c.xmax&&d>=c.ymin&&d<=c.ymax}function A(c,r,d=!0){const _=!(0,C.l9)(c);if(_&&(0,j.Zy)(c),d)return(new T).cut(c,r);const m=_?c.rings:c.paths,a=_?4:2,e=m.length,i=-2*r;for(let n=0;n<e;n++){const h=m[n];if(h&&h.length>=a){const t=[];for(const s of h)t.push([s[0]+i,s[1]]);m.push(t)}}return _?c.rings=m:c.paths=m,c}class R{constructor(r,d){this.extent=r,this.frameIds=d}}const Y=(0,B.Ue)();class T{constructor(){this._linesIn=[],this._linesOut=[]}cut(r,d){let _;if(this._xCut=d,r.rings)this._closed=!0,_=r.rings,this._minPts=4;else{if(!r.paths)return null;this._closed=!1,_=r.paths,this._minPts=2}for(const a of _){if(!a||a.length<this._minPts)continue;let e=!0;for(const i of a)e?(this.moveTo(i),e=!1):this.lineTo(i);this._closed&&this.close()}this._pushLineIn(),this._pushLineOut(),_=[];for(const a of this._linesIn)a&&a.length>=this._minPts&&_.push(a);const m=-2*this._xCut;for(const a of this._linesOut)if(a&&a.length>=this._minPts){for(const e of a)e[0]+=m;_.push(a)}return this._closed?r.rings=_:r.paths=_,r}moveTo(r){this._pushLineIn(),this._pushLineOut(),this._prevSide=this._side(r[0]),this._moveTo(r[0],r[1],this._prevSide),this._prevPt=r,this._firstPt=r}lineTo(r){const d=this._side(r[0]);if(d*this._prevSide==-1){const _=this._intersect(this._prevPt,r);this._lineTo(this._xCut,_,0),this._prevSide=0,this._lineTo(r[0],r[1],d)}else this._lineTo(r[0],r[1],d);this._prevSide=d,this._prevPt=r}close(){const r=this._firstPt,d=this._prevPt;r[0]===d[0]&&r[1]===d[1]||this.lineTo(r),this._checkClosingPt(this._lineIn),this._checkClosingPt(this._lineOut)}_moveTo(r,d,_){this._closed?(this._lineIn.push([_<=0?r:this._xCut,d]),this._lineOut.push([_>=0?r:this._xCut,d])):(_<=0&&this._lineIn.push([r,d]),_>=0&&this._lineOut.push([r,d]))}_lineTo(r,d,_){this._closed?(this._addPolyVertex(this._lineIn,_<=0?r:this._xCut,d),this._addPolyVertex(this._lineOut,_>=0?r:this._xCut,d)):_<0?(0===this._prevSide&&this._pushLineOut(),this._lineIn.push([r,d])):_>0?(0===this._prevSide&&this._pushLineIn(),this._lineOut.push([r,d])):this._prevSide<0?(this._lineIn.push([r,d]),this._lineOut.push([r,d])):this._prevSide>0&&(this._lineOut.push([r,d]),this._lineIn.push([r,d]))}_addPolyVertex(r,d,_){const m=r.length;m>1&&r[m-1][0]===d&&r[m-2][0]===d?r[m-1][1]=_:r.push([d,_])}_checkClosingPt(r){const d=r.length;d>3&&r[0][0]===this._xCut&&r[d-2][0]===this._xCut&&r[1][0]===this._xCut&&(r[0][1]=r[d-2][1],r.pop())}_side(r){return r<this._xCut?-1:r>this._xCut?1:0}_intersect(r,d){return r[1]+(this._xCut-r[0])/(d[0]-r[0])*(d[1]-r[1])}_pushLineIn(){this._lineIn&&this._lineIn.length>=this._minPts&&this._linesIn.push(this._lineIn),this._lineIn=[]}_pushLineOut(){this._lineOut&&this._lineOut.length>=this._minPts&&this._linesOut.push(this._lineOut),this._lineOut=[]}}},61256:(Z,b,u)=>{u.d(b,{H:()=>D});var L=u(8314),B=u(36592),W=u(65401);const C={minX:0,minY:0,maxX:0,maxY:0};class D{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new B.Q(9,(0,L.Z)("esri-csp-restrictions")?p=>({minX:p[0],minY:p[1],maxX:p[2],maxY:p[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const p=new Array(this._idByBounds.size);let I=0;this._idByBounds.forEach((U,X)=>{p[I++]=X}),this._indexInvalid=!1,this._index.clear(),this._index.load(p)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter(p=>this._idByBounds.has(p))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const p=(0,W.cS)();for(const I of this._boundsById.values())I&&(p[0]=Math.min(I[0],p[0]),p[1]=Math.min(I[1],p[1]),p[2]=Math.max(I[2],p[2]),p[3]=Math.max(I[3],p[3]));return p}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(p){const I=this._boundsById.get(p);this._boundsById.delete(p),I&&(this._idByBounds.delete(I),this._indexInvalid||this._index.remove(I))}forEachInBounds(p,I){this._loadIndex(),function v(S,p,I){(function E(S){C.minX=S[0],C.minY=S[1],C.maxX=S[2],C.maxY=S[3]})(p),S.search(C,I)}(this._index,p,U=>I(this._idByBounds.get(U)))}get(p){return this._boundsById.get(p)}has(p){return this._boundsById.has(p)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(p,I){if(!this._indexInvalid){const U=this._boundsById.get(p);U&&(this._index.remove(U),this._idByBounds.delete(U))}this._boundsById.set(p,I),I&&(this._idByBounds.set(I,p),this._indexInvalid||(this._boundsToLoad.push(I),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},3579:(Z,b,u)=>{u.d(b,{Z:()=>U});var L=u(26584),B=u(61885),W=u(63290),j=u(62208),C=u(5548),E=u(65401),v=u(82054),D=u(61256),S=u(92794),p=u(6185);const I=(0,C.Ue)();class U{constructor(f){this.geometryInfo=f,this._boundsStore=new D.H,this._featuresById=new Map,this._markedIds=new Set,this.events=new B.Z,this.featureAdapter=S.n}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let f=0;return this._featuresById.forEach(g=>{(0,j.pC)(g.geometry)&&g.geometry.coords&&(f+=g.geometry.coords.length)}),{featureCount:this._featuresById.size,vertexCount:f/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(f){if((0,j.Wi)(this.fullBounds))return null;const[g,P,A,R]=this.fullBounds;return{xmin:g,ymin:P,xmax:A,ymax:R,spatialReference:(0,p.S2)(f)}}add(f){this._add(f),this._emitChanged()}addMany(f){for(const g of f)this._add(g);this._emitChanged()}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}removeById(f){const g=this._featuresById.get(f);return g?(this._remove(g),this._emitChanged(),g):null}removeManyById(f){this._boundsStore.invalidateIndex();for(const g of f){const P=this._featuresById.get(g);P&&this._remove(P)}this._emitChanged()}forEachBounds(f,g){for(const P of f){const A=this._boundsStore.get(P.objectId);A&&g((0,C.JR)(I,A))}}getFeature(f){return this._featuresById.get(f)}has(f){return this._featuresById.has(f)}forEach(f){this._featuresById.forEach(g=>f(g))}forEachInBounds(f,g){this._boundsStore.forEachInBounds(f,P=>{g(this._featuresById.get(P))})}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}sweep(){let f=!1;this._featuresById.forEach((g,P)=>{this._markedIds.has(P)||(f=!0,this._remove(g))}),this._markedIds.clear(),f&&this._emitChanged()}_emitChanged(){this.events.emit("changed",void 0)}_add(f){if(!f)return;const g=f.objectId;if(null==g)return void W.Z.getLogger("esri.layers.graphics.data.FeatureStore").error(new L.Z("featurestore:invalid-feature","feature id is missing",{feature:f}));const P=this._featuresById.get(g);let A;if(this._markedIds.add(g),P?(f.displayId=P.displayId,A=this._boundsStore.get(g),this._boundsStore.delete(g)):(0,j.pC)(this.onFeatureAdd)&&this.onFeatureAdd(f),(0,j.Wi)(f.geometry)||!f.geometry.coords||!f.geometry.coords.length)return this._boundsStore.set(g,null),void this._featuresById.set(g,f);A=(0,v.$)((0,j.pC)(A)?A:(0,E.Ue)(),f.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),(0,j.pC)(A)&&this._boundsStore.set(g,A),this._featuresById.set(g,f)}_remove(f){(0,j.pC)(this.onFeatureRemove)&&this.onFeatureRemove(f);const g=f.objectId;return this._markedIds.delete(g),this._boundsStore.delete(g),this._featuresById.delete(g),f}}},92794:(Z,b,u)=>{u.d(b,{n:()=>C});var L=u(62208),B=u(77044),W=u(66385),j=u(88071);const C={getObjectId:E=>E.objectId,getAttributes:E=>E.attributes,getAttribute:(E,v)=>E.attributes[v],cloneWithGeometry:(E,v)=>new W.u_(v,E.attributes,null,E.objectId),getGeometry:E=>E.geometry,getCentroid:(E,v)=>((0,L.Wi)(E.centroid)&&(E.centroid=(0,B.Y)(new j.Z,E.geometry,v.hasZ,v.hasM)),E.centroid)}},66269:(Z,b,u)=>{u.r(b),u.d(b,{GraphicsSnappingSource:()=>n});var L=u(15861),B=u(17626),W=u(14517),j=u(85931),C=u(59213),E=u(80542),v=u(62208),D=u(10699),S=u(32917),p=u(77712),U=(u(90912),u(76898)),X=u(37118),f=u(55915),g=u(65629),P=u(71774),A=u(82054),R=u(66385),Y=u(3579),T=u(58175),c=u(60507),r=u(86606),d=u(44725),_=u(9218),m=u(17936),a=u(1520),e=u(83010);const i="graphics-collections";let n=class extends((0,E.p)(W.Z)){get updating(){return this.updatingHandles.updating}get _hasZ(){const t=this.view;return(0,v.pC)(t)&&"3d"===t.type&&"map-notes"!==this.layerSource.layer.type}get _snappingElevationAligner(){const{view:t}=this,{layer:s}=this.layerSource,o=(0,v.pC)(t)&&"3d"===t.type;if(!o||"map-notes"===s.type)return(0,m.p)();const l=function(){var x=(0,L.Z)(function*(y,M){return(yield(0,D.Hl)(t.whenLayerView(s),M)).elevationAlignPointsInFeatures(y,M)});return function(M,O){return x.apply(this,arguments)}}();return(0,m.p)(o,{elevationInfo:s.elevationInfo,alignPointsInFeatures:l,spatialReference:t.spatialReference})}get _snappingElevationFilter(){const{view:t}=this,s=(0,v.pC)(t)&&"3d"===t.type&&"map-notes"!==this.layerSource.layer.type;return(0,a.c)(s)}get _symbologySnappingFetcher(){const{view:t}=this,{layer:s}=this.layerSource,o=(0,v.pC)(t)&&"3d"===t.type,l=this._extrudedPolygonSymbolsCount>0;return o&&"map-notes"!==s.type&&l?(0,e.k)(l,function(){var x=(0,L.Z)(function*(y,M){const O=yield t.whenLayerView(s);return(0,D.k_)(M),O.queryForSymbologySnapping({candidates:y,spatialReference:t.spatialReference},M)});return function(y,M){return x.apply(this,arguments)}}()):(0,e.k)()}constructor(t){super(t),this.availability=1,this._sources={multipoint:null,point:null,polygon:null,polyline:null},this._loadedWkids=new Set,this._loadedWkts=new Set,this._pendingAdds=[],this._extrudedPolygonSymbolsCount=0}destroy(){for(const t of this._pendingAdds)t.task.abort();this._pendingAdds.length=0,this._mapSources(t=>this._destroySource(t))}initialize(){this.updatingHandles.add(()=>this.getGraphicsLayers(),o=>{this.updatingHandles.removeHandles(i);for(const l of o)this._addMany(l.graphics.toArray()),this.handles.add([l.on("graphic-update",x=>this._onGraphicUpdate(x)),this.updatingHandles.addOnCollectionChange(()=>l.graphics,x=>this._onGraphicsChanged(x))],i)},S.nn);const{view:t}=this,{layer:s}=this.layerSource;(0,v.pC)(t)&&"3d"===t.type&&"map-notes"!==s.type&&this.addHandles([t.elevationProvider.on("elevation-change",({context:o})=>{(0,c.W_)(o,s.elevationInfo)&&this._snappingElevationAligner.notifyElevationSourceChange()}),(0,S.YP)(()=>s.elevationInfo,()=>this._snappingElevationAligner.notifyElevationSourceChange(),S.nn),(0,S.on)(()=>s,["edits","apply-edits","graphic-update"],()=>this._symbologySnappingFetcher.notifySymbologyChange())])}fetchCandidates(t,s){var o=this;return(0,L.Z)(function*(){const{point:l}=t,x=yield(0,D.WW)(o._mapSources(O=>o._fetchCandidatesForSource(O,t,s)));(0,D.k_)(s);const y=o._getGroundElevation,M=x.flat().map(O=>(0,_.X)(O,y));return(0,d.lQ)(l,M),M})()}get _getGroundElevation(){return(0,_.g)(this.view)}_fetchCandidatesForSource(t,s,o){var l=this;return(0,L.Z)(function*(){const x=(0,d.rh)(s,(0,v.Wg)(l.view)?.type??"2d"),y=yield t.queryEngine.executeQueryForSnapping(x,o);(0,D.k_)(o);const M=yield l._snappingElevationAligner.alignCandidates(y.candidates,o);(0,D.k_)(o);const O=yield l._symbologySnappingFetcher.fetch(M,o);(0,D.k_)(o);const K=0===O.length?M:[...M,...O];return l._snappingElevationFilter.filter(x,K)})()}refresh(){}_onGraphicUpdate(t){if(this.getGraphicsLayers().some(s=>s.graphics.includes(t.graphic)))switch(t.property){case"geometry":case"visible":this._remove(t.graphic),this._addMany([t.graphic])}}_onGraphicsChanged(t){for(const s of t.removed)this._remove(s);this._addMany(t.added)}_addMany(t){const s=[],o=new Map;for(const l of t)(0,v.Wi)(l.geometry)||(this._needsInitializeProjection(l.geometry.spatialReference)?(s.push(l.geometry.spatialReference),o.set(l.uid,l)):this._add(l));this._createPendingAdd(s,o)}_createPendingAdd(t,s){var o=this;if(!t.length)return;const l=(0,C.vr)(function(){var M=(0,L.Z)(function*(O){yield(0,f.iQ)(t.map(K=>({source:K,dest:o.spatialReference})),{signal:O}),o._markLoadedSpatialReferences(t);for(const[,K]of s)o._add(K)});return function(O){return M.apply(this,arguments)}}());this.updatingHandles.addPromise(l.promise);const x={task:l,graphics:s},y=()=>(0,j.e$)(this._pendingAdds,x);l.promise.then(y,y),this._pendingAdds.push(x)}_markLoadedSpatialReferences(t){for(const s of t)null!=s.wkid&&this._loadedWkids.add(s.wkid),null!=s.wkt&&this._loadedWkts.add(s.wkt)}_add(t){if((0,v.Wi)(t.geometry)||!t.visible)return;let s=t.geometry;if("mesh"===s.type)return;"extent"===s.type&&(s=X.Z.fromExtent(s));const o=this._ensureSource(s.type);if((0,v.Wi)(o))return;const l=this._createOptimizedFeature(t.uid,s);(0,v.Wi)(l)||(o.featureStore.add(l),(0,r.QL)(t.symbol)&&this._extrudedPolygonSymbolsCount++)}_needsInitializeProjection(t){return!(null!=t.wkid&&this._loadedWkids.has(t.wkid)||null!=t.wkt&&this._loadedWkts.has(t.wkt)||(0,f.Up)(t,this.spatialReference))}_createOptimizedFeature(t,s){const o=(0,f.iV)((0,g.SR)(s),this.spatialReference);if(!o)return null;const l=this._ensureGeometryHasZ(o),x=(0,A.GH)(l,this._hasZ,!1);return new R.u_(x,{[h]:t},null,t)}_ensureGeometryHasZ(t){if(!this._hasZ)return t;const s=l=>{for(;l.length<3;)l.push(0)},o=t.clone();switch(o.hasZ=!0,o.type){case"point":o.z=o.z??0;break;case"multipoint":o.points.forEach(s);break;case"polyline":o.paths.forEach(l=>l.forEach(s));break;case"polygon":o.rings.forEach(l=>l.forEach(s))}return o}_ensureSource(t){const s=this._sources[t];if((0,v.pC)(s))return s;const o=this._createSource(t);return this._sources[t]=o,o}_createSource(t){const s=P.M.toJSON(t),o=this._hasZ,l=new Y.Z({geometryType:s,hasZ:o,hasM:!1});return{featureStore:l,queryEngine:new T.q({featureStore:l,fields:[{name:h,type:"esriFieldTypeOID",alias:h}],geometryType:s,hasM:!1,hasZ:o,objectIdField:h,spatialReference:this.spatialReference,scheduler:(0,v.pC)(this.view)&&"3d"===this.view.type?this.view.resourceController.scheduler:null}),type:t}}_remove(t){this._mapSources(s=>this._removeFromSource(s,t));for(const s of this._pendingAdds)s.graphics.delete(t.uid),0===s.graphics.size&&s.task.abort()}_removeFromSource(t,s){t.featureStore.has(s.uid)&&(t.featureStore.removeById(s.uid),(0,r.QL)(s.symbol)&&this._extrudedPolygonSymbolsCount--)}_destroySource(t){t.queryEngine.destroy(),this._sources[t.type]=null}_mapSources(t){const{point:s,polygon:o,polyline:l,multipoint:x}=this._sources,y=[];return(0,v.pC)(s)&&y.push(t(s)),(0,v.pC)(o)&&y.push(t(o)),(0,v.pC)(l)&&y.push(t(l)),(0,v.pC)(x)&&y.push(t(x)),y}};(0,B._)([(0,p.Cb)()],n.prototype,"getGraphicsLayers",void 0),(0,B._)([(0,p.Cb)({constructOnly:!0})],n.prototype,"layerSource",void 0),(0,B._)([(0,p.Cb)({constructOnly:!0})],n.prototype,"spatialReference",void 0),(0,B._)([(0,p.Cb)({constructOnly:!0})],n.prototype,"view",void 0),(0,B._)([(0,p.Cb)({readOnly:!0})],n.prototype,"updating",null),(0,B._)([(0,p.Cb)({readOnly:!0})],n.prototype,"availability",void 0),(0,B._)([(0,p.Cb)()],n.prototype,"_hasZ",null),(0,B._)([(0,p.Cb)()],n.prototype,"_snappingElevationAligner",null),(0,B._)([(0,p.Cb)()],n.prototype,"_snappingElevationFilter",null),(0,B._)([(0,p.Cb)()],n.prototype,"_symbologySnappingFetcher",null),(0,B._)([(0,p.Cb)()],n.prototype,"_extrudedPolygonSymbolsCount",void 0),(0,B._)([(0,p.Cb)()],n.prototype,"_getGroundElevation",null),n=(0,B._)([(0,U.j)("esri.views.interactive.snapping.featureSources.GraphicsSnappingSource")],n);const h="OBJECTID"}}]);