"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[3821],{42763:(ot,Ce,C)=>{C.d(Ce,{Z:()=>q});var T=C(36082),F=C(48902);class q{constructor(x){this._observable=new F.s,this._set=new Set(x)}get size(){return(0,T.it)(this._observable),this._set.size}add(x){const w=this._set.size;return this._set.add(x),this._set.size!==w&&this._observable.notify(),this}clear(){this._set.size>0&&(this._set.clear(),this._observable.notify())}delete(x){const w=this._set.delete(x);return w&&this._observable.notify(),w}entries(){return(0,T.it)(this._observable),this._set.entries()}forEach(x,w){(0,T.it)(this._observable),this._set.forEach((Fe,Ee)=>x.call(w,Fe,Ee,this),w)}has(x){return(0,T.it)(this._observable),this._set.has(x)}keys(){return(0,T.it)(this._observable),this._set.keys()}values(){return(0,T.it)(this._observable),this._set.values()}[Symbol.iterator](){return(0,T.it)(this._observable),this._set[Symbol.iterator]()}get[Symbol.toStringTag](){return this._set[Symbol.toStringTag]}}},15572:(ot,Ce,C)=>{C.d(Ce,{GJ:()=>x,hw:()=>we,mE:()=>Ee,ne:()=>K,nn:()=>Fe,yG:()=>q});var T=C(16730);function q(H,J){return{type:(0,T.UF)(J),value:H,unit:J}}function K(H,J){return{type:(0,T.UF)(J),value:H,unit:J}}function x(H,J,$e="arithmetic"){return{type:(0,T.UF)(J),value:H,unit:J,rotationType:$e}}function Fe(H,J){const $e=Ee(H,J);return"angle"===H.type?x($e,J,H.rotationType):function F(H,J){return{type:(0,T.UF)(J),value:H,unit:J}}($e,J)}function Ee(H,J){return(0,T.En)(H.value,H.unit,J)}function we(H,J,$e){if(J===$e)return H;switch($e){case"arithmetic":case"geographic":return 90-H}}q(0,"meters"),K(0,"square-meters"),x(0,"radians"),x(0,"degrees"),x(0,"degrees","geographic")},90466:(ot,Ce,C)=>{C.d(Ce,{Rd:()=>Se,Ud:()=>Ie,VG:()=>W,Wv:()=>we,Zv:()=>Ne,sS:()=>ie});var T=C(41844),q=(C(23719),C(21286)),x=(C(15572),C(77275)),w=C(16730),Fe=C(15348);function W(O,R,Z,D=2,U="abbr"){return`${(0,Fe.uf)(R,{minimumFractionDigits:D,maximumFractionDigits:D,signDisplay:R>0?"never":"exceptZero"})} ${function Ee(O,R,Z){return O.units[R][Z]}(O,Z,U)}`}function Se(O,R,Z,D=2,U="abbr"){const z=(0,w.Y8)(R,Z);return W(O,(0,w.En)(R,Z,z),z,D,U)}function we(O,R,Z,D=2,U="abbr"){const z=(0,w.Dw)(R,Z);return W(O,(0,w.En)(R,Z,z),z,D,U)}function Ie(O,R,Z,D=2,U="abbr"){const z=(0,w.Q7)(R,Z);return W(O,(0,w.En)(R,Z,z),z,D,U)}function Ne(O,R,Z,D=2,U="abbr"){const z=(0,w.jl)(R,Z);return W(O,(0,w.En)(R,Z,z),z,D,U)}const N=["B","kB","MB","GB","TB"];function ie(O,R){let Z=0===(R=Math.round(R))?0:Math.floor(Math.log(R)/Math.log(T.Y.KILOBYTES));Z=(0,q.uZ)(Z,0,N.length-1);const D=(0,Fe.uf)(R/T.Y.KILOBYTES**Z,{maximumFractionDigits:2});return(0,x.gx)(O.units.bytes[N[Z]],{fileSize:D})}},76391:(ot,Ce,C)=>{function T(F){const q={};for(const K in F){if("declaredClass"===K)continue;const x=F[K];if(null!=x&&"function"!=typeof x)if(Array.isArray(x)){q[K]=[];for(let w=0;w<x.length;w++)q[K][w]=T(x[w])}else"object"==typeof x?x.toJSON&&(q[K]=JSON.stringify(x)):q[K]=x}return q}C.d(Ce,{A:()=>T})},2865:(ot,Ce,C)=>{C.d(Ce,{F:()=>Ee,e:()=>w});var T=C(15861),F=C(2618),q=C(20477),K=C(17253),x=C(96854);function w(de,Se,oe){return Fe.apply(this,arguments)}function Fe(){return(Fe=(0,T.Z)(function*(de,Se,oe){const we=yield Ee(de,Se,oe);return K.Z.fromJSON(we)})).apply(this,arguments)}function Ee(de,Se,oe){return W.apply(this,arguments)}function W(){return(W=(0,T.Z)(function*(de,Se,oe){const we=(0,F.en)(de),Me={...oe},Ie=x.Z.from(Se),{data:Re}=yield(0,q.JT)(we,Ie,Ie.sourceSpatialReference,Me);return Re})).apply(this,arguments)}},20477:(ot,Ce,C)=>{C.d(Ce,{Ev:()=>Ye,JT:()=>we,Vn:()=>je,Vr:()=>J,hH:()=>H,n7:()=>Ne,qp:()=>Ie});var T=C(15861),F=C(84792),q=C(21726),K=C(91179),x=C(93555),w=C(37053),Fe=C(76391),Ee=C(85262),W=C(61515);const de="Layer does not support extent calculation.";function oe(V,N){const ie=V.geometry,O=V.toJSON();delete O.compactGeometryEnabled,delete O.defaultSpatialReferenceEnabled;const R=O;let Z,D,U;if(null!=ie&&(D=ie.spatialReference,U=(0,w.B9)(D),R.geometryType=(0,K.Ji)(ie),R.geometry=function Se(V,N){if(N&&"extent"===V.type)return`${V.xmin},${V.ymin},${V.xmax},${V.ymax}`;if(N&&"point"===V.type)return`${V.x},${V.y}`;const ie=V.toJSON();return delete ie.spatialReference,JSON.stringify(ie)}(ie,V.compactGeometryEnabled),R.inSR=U),O.groupByFieldsForStatistics&&(R.groupByFieldsForStatistics=O.groupByFieldsForStatistics.join(",")),O.objectIds&&(R.objectIds=O.objectIds.join(",")),O.orderByFields&&(R.orderByFields=O.orderByFields.join(",")),!O.outFields||!O.returnDistinctValues&&(N?.returnCountOnly||N?.returnExtentOnly||N?.returnIdsOnly)?delete R.outFields:R.outFields=O.outFields.includes("*")?"*":O.outFields.join(","),O.outSR?(R.outSR=(0,w.B9)(O.outSR),Z=V.outSpatialReference):ie&&(O.returnGeometry||O.returnCentroid)&&(R.outSR=R.inSR,Z=D),O.returnGeometry&&delete O.returnGeometry,O.outStatistics&&(R.outStatistics=JSON.stringify(O.outStatistics)),O.fullText&&(R.fullText=JSON.stringify(O.fullText)),O.pixelSize&&(R.pixelSize=JSON.stringify(O.pixelSize)),O.quantizationParameters&&(V.defaultSpatialReferenceEnabled&&null!=D&&null!=V.quantizationParameters?.extent&&D.equals(V.quantizationParameters.extent.spatialReference)&&delete O.quantizationParameters.extent.spatialReference,R.quantizationParameters=JSON.stringify(O.quantizationParameters)),O.parameterValues&&(R.parameterValues=JSON.stringify(O.parameterValues)),O.rangeValues&&(R.rangeValues=JSON.stringify(O.rangeValues)),O.dynamicDataSource&&(R.layer=JSON.stringify({source:O.dynamicDataSource}),delete O.dynamicDataSource),O.timeExtent){const z=O.timeExtent,{start:ue,end:Ge}=z;null==ue&&null==Ge||(R.time=ue===Ge?ue:`${ue??"null"},${Ge??"null"}`),delete O.timeExtent}return V.defaultSpatialReferenceEnabled&&null!=D&&null!=Z&&D.equals(Z)&&(R.defaultSR=R.inSR,delete R.inSR,delete R.outSR),R}function we(V,N,ie,O){return Me.apply(this,arguments)}function Me(){return(Me=(0,T.Z)(function*(V,N,ie,O){const R=null!=N.timeExtent&&N.timeExtent.isEmpty?{data:{features:[]}}:yield je(V,N,"json",O);return(0,W.p)(N,ie,R.data),R})).apply(this,arguments)}function Ie(V,N,ie,O){return Re.apply(this,arguments)}function Re(){return(Re=(0,T.Z)(function*(V,N,ie,O){if(null!=N.timeExtent&&N.timeExtent.isEmpty)return{data:ie.createFeatureResult()};const R=yield Ne(V,N,O),Z=R;return Z.data=(0,Ee.C)(R.data,ie),Z})).apply(this,arguments)}function Ne(V,N,ie){return je(V,N,"pbf",ie)}function Ye(V,N,ie){return null!=N.timeExtent&&N.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):je(V,N,"json",ie,{returnIdsOnly:!0})}function H(V,N,ie){return null!=N.timeExtent&&N.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):je(V,N,"json",ie,{returnIdsOnly:!0,returnCountOnly:!0})}function J(V,N,ie){return $e.apply(this,arguments)}function $e(){return($e=(0,T.Z)(function*(V,N,ie){if(null!=N.timeExtent&&N.timeExtent.isEmpty)return{data:{count:0,extent:null}};const O=yield je(V,N,"json",ie,{returnExtentOnly:!0,returnCountOnly:!0}),R=O.data;if(R.hasOwnProperty("extent"))return O;if(R.features)throw new Error(de);if(R.hasOwnProperty("count"))throw new Error(de);return O})).apply(this,arguments)}function je(V,N,ie){return rt.apply(this,arguments)}function rt(){return(rt=(0,T.Z)(function*(V,N,ie,O={},R={}){const Z="string"==typeof V?(0,q.mN)(V):V,D=N.geometry?[N.geometry]:[],z=(yield(0,x.aX)(D,null,{signal:O.signal}))?.[0];null!=z&&((N=N.clone()).geometry=z);const ue=(0,Fe.A)({...Z.query,f:ie,...R,...oe(N,R)});return(0,F.Z)((0,q.v_)(Z.path,function Ue(V,N){return null!=V.formatOf3DObjects&&!(N.returnCountOnly||N.returnExtentOnly||N.returnIdsOnly)}(N,R)?"query3d":"query"),{...O,responseType:"pbf"===ie?"array-buffer":"json",query:{...ue,...O.query}})})).apply(this,arguments)}},87183:(ot,Ce,C)=>{C.d(Ce,{Z:()=>we});var de,T=C(17626),F=C(86810),q=C(77712),K=C(90912),Fe=(C(4619),C(8314),C(76898));const Se={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let oe=de=class extends F.wq{constructor(Me){super(Me),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:Me}=this,Ie=function Ee(Me){const{exifInfo:Ie,exifName:Re,tagName:Ne}=Me;if(!Ie||!Re||!Ne)return null;const Ye=Ie.find(H=>H.name===Re);return Ye?function W(Me){const{tagName:Ie,tags:Re}=Me;return Re&&Ie&&Re.find(Ye=>Ye.name===Ie)?.value||null}({tagName:Ne,tags:Ye.tags}):null}({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:Me});return Se[Ie]||null}clone(){return new de({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};(0,T._)([(0,q.Cb)({type:String})],oe.prototype,"contentType",void 0),(0,T._)([(0,q.Cb)()],oe.prototype,"exifInfo",void 0),(0,T._)([(0,q.Cb)({readOnly:!0})],oe.prototype,"orientationInfo",null),(0,T._)([(0,q.Cb)({type:K.z8})],oe.prototype,"id",void 0),(0,T._)([(0,q.Cb)({type:String})],oe.prototype,"globalId",void 0),(0,T._)([(0,q.Cb)({type:String})],oe.prototype,"keywords",void 0),(0,T._)([(0,q.Cb)({type:String})],oe.prototype,"name",void 0),(0,T._)([(0,q.Cb)({json:{read:!1}})],oe.prototype,"parentGlobalId",void 0),(0,T._)([(0,q.Cb)({json:{read:!1}})],oe.prototype,"parentObjectId",void 0),(0,T._)([(0,q.Cb)({type:K.z8})],oe.prototype,"size",void 0),(0,T._)([(0,q.Cb)({json:{read:!1}})],oe.prototype,"url",void 0),oe=de=(0,T._)([(0,Fe.j)("esri.layers.support.AttachmentInfo")],oe);const we=oe},63821:(ot,Ce,C)=>{C.r(Ce),C.d(Ce,{default:()=>sr});var T=C(15861),F=C(17626),q=C(55538),K=C(63290),x=C(32917),w=C(77712),W=(C(8314),C(4619),C(76898)),de=C(48753),oe=(C(52515),C(46160));function we(d,h,g,y){let v=null,b=1e3;"number"==typeof h?(b=h,y=g):(v=h??null,b=g);let M,I=0;const _=()=>{I=0,d.apply(y,M)},E=(...P)=>{v&&v.apply(y,P),M=P,b?I||(I=setTimeout(_,b)):_()};return E.remove=()=>{I&&(clearTimeout(I),I=0)},E.forceUpdate=()=>{I&&(clearTimeout(I),_())},E.hasPendingUpdates=()=>!!I,E}function Ne(d){switch(d?.type){case"point":return d;case"extent":return d.center;case"polygon":return d.centroid;case"multipoint":case"polyline":return d.extent?.center;default:return null}}C(29132),C(83137),C(2004);var rt=C(17456),Ue=C(66656),V=C(78109),N=C(26584),ie=C(90466),O=C(88879),R=C(83761),Z=C(87183),D=C(67736),U=C(77275),z=C(88411),ue=C(15348),Ge=C(90194),Qn=C(72469),Bt=C(51692),Kn=C(46679),Bi=C(28302);const zi=()=>K.Z.getLogger("esri.widgets.Feature.support.featureUtils"),Xn=/href=(""|'')/gi,kn=/(\{([^\{\r\n]+)\})/g,qn=/\'/g,ji=/^\s*expression\//i,es=/(\n)/gi,ts=/[\u00A0-\u9999<>\&]/gim,is=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,ns=/^(?:mailto:|tel:)/,Wi="relationships/",Hi=(0,z.Ze)("short-date-short-time");function Yi(d){if(null!=d)return(d.sourceLayer||d.layer)??void 0}function xt(d,h){return zt.apply(this,arguments)}function zt(){return(zt=(0,T.Z)(function*(d,h){return"function"==typeof d?d(h):d})).apply(this,arguments)}function Gi(d=""){if(d)return!ns.test(d.trim().toLowerCase())}function jt(d){return!!d&&ji.test(d)}function Qi(d,h){const g=function ss(d,h){if(!jt(h)||!d)return;const g=h.replace(ji,"").toLowerCase();return d.find(({name:y})=>y.toLowerCase()===g)}(h,d?.fieldName);return g?g.title||null:d?d.label||d.fieldName:null}function Ct(d,h){const g=Wt(h,d);return g?g.name:d}function Wt(d,h){return d&&"function"==typeof d.getField&&h?d.getField(h)??null:null}function Ki(d){return`${d}`.trim()}function at({attributes:d,globalAttributes:h,layer:g,text:y,expressionAttributes:v,fieldInfoMap:b}){return y?Ht({formattedAttributes:h,template:cs(y,{...h,...v,...d},g),fieldInfoMap:b}):""}function Ht({formattedAttributes:d,template:h,fieldInfoMap:g}){return Ki(function rs(d){return d.replaceAll(Xn,"")}((0,U.gx)((0,U.gx)(h,y=>function os(d,h){return`{${h.get(d.toLowerCase())?.fieldName||d}}`}(y,g)),d)))}function Yt(d,h){return d.replaceAll(kn,(g,y,v)=>{const b=Wt(h,v);return b?`{${b.name}}`:y})}function cs(d,h,g){const y=Yt(d,g);return y&&y.replaceAll(is,(v,b,M)=>function us(d,h,g){const y=(h=Ki(h))&&"{"!==h[0];return(0,U.gx)(d,function ds(d,h=!1){const g={...d};return Object.keys(g).forEach(y=>function ls(d,h,g=!1){const y=h[d];if("string"==typeof y){const v="%27",b=(g?encodeURIComponent(y):y).replaceAll(qn,v);h[d]=b}}(y,g,h)),g}(g,y||!1))}(v,b||M,h))}function Gt(d){return function ps(d){return null!=d&&"object"==typeof d&&"fieldsIndex"in d&&"geometryType"in d&&"getField"in d&&"load"in d&&"loaded"in d&&"objectIdField"in d&&"spatialReference"in d&&"type"in d&&("feature"===d.type||"scene"===d.type)&&"when"in d}(d)&&function ms(d){return null!=d&&"object"==typeof d&&"createQuery"in d&&"queryFeatureCount"in d&&"queryObjectIds"in d&&"queryRelatedFeatures"in d&&"queryRelatedFeaturesCount"in d&&"relationships"in d}(d)}function Qt(d,h,g,y){return d.trim().split(h).map(v=>(0,ue.uf)(Number(v),(0,ue.sh)(y))).join(g)}function Ji(d,h){if(d?.length&&h)return d.find(g=>g.fieldName?.toLowerCase()===h.toLowerCase())}function Xi(d){const h=[];if(!d)return h;const{fieldInfos:g,content:y}=d;return g&&h.push(...g),y&&Array.isArray(y)&&y.forEach(v=>{if("fields"===v.type){const b=v?.fieldInfos;b&&h.push(...b)}}),h}function Kt(d){return d.replaceAll(ts,h=>`&#${h.charCodeAt(0)};`)}function Ft(d){return"string"==typeof d?d.replaceAll(es,'<br class="esri-text-new-line" />'):d}function ki(d){const{value:h,fieldName:g,fieldInfos:y,fieldInfoMap:v,layer:b,graphic:M,timeZone:I}=d;if(null==h)return"";const _=function vs({fieldName:d,value:h,graphic:g,layer:y}){if(Qe(d)||!y||"function"!=typeof y.getFieldDomain)return null;const v=g&&y.getFieldDomain(d,{feature:g});return v&&"coded-value"===v.type?v.getName(h):null}({fieldName:g,value:h,graphic:M,layer:b});if(_)return _;const E=function ys({fieldName:d,graphic:h,layer:g}){if(Qe(d)||!g||"function"!=typeof g.getFeatureType)return null;const{typeIdField:y}=g;if(!y||d!==y)return null;const v=g.getFeatureType(h);return v?v.name:null}({fieldName:g,graphic:M,layer:b});if(E)return E;if(v.get(g.toLowerCase()))return function fs(d,h){const{fieldInfos:g,fieldName:y,preventPlacesFormatting:v,layer:b,timeZone:M}=h,I=Ji(g,y),_=Wt(b,y);if(I&&!(0,Ge.Ec)(y)){const P=_?.type,L=I.format?.dateFormat;if("date"===P||"date-only"===P||"time-only"===P||"timestamp-offset"===P||L)return(0,Bt.$8)(d,{format:L,fieldType:P,timeZoneOptions:{layerTimeZone:b&&"preferredTimeZone"in b?b.preferredTimeZone:null,viewTimeZone:M,datesInUnknownTimezone:!(!b||!("datesInUnknownTimezone"in b)||!b.datesInUnknownTimezone)}})}const E=I?.format;return"string"==typeof d&&(0,Ge.Ec)(y)&&E?function gs(d,h){return d=d.trim(),/\d{2}-\d{2}/.test(d)?d:d.includes(",")?Qt(d,",",", ",h):d.includes(";")?Qt(d,";","; ",h):d.includes(" ")?Qt(d," "," ",h):(0,ue.uf)(Number(d),(0,ue.sh)(h))}(d,E):"string"==typeof(d=function hs(d,h){if("string"==typeof d&&h&&null==h.dateFormat&&(null!=h.places||null!=h.digitSeparator)){const g=Number(d);if(!isNaN(g))return g}return d}(d,E))||null==d||null==E?Ft(d):(0,ue.uf)(d,v?{...(0,ue.sh)(E),minimumFractionDigits:0,maximumFractionDigits:20}:(0,ue.sh)(E))}(h,{fieldInfos:y||Array.from(v.values()),fieldName:g,layer:b,timeZone:I});const P=b?.fieldsIndex?.get(g);return P&&((0,Bt.a8)(P)||(0,Ge.sX)(P))?(0,Bt.$8)(h,{fieldType:P.type,timeZoneOptions:{layerTimeZone:b&&"preferredTimeZone"in b?b.preferredTimeZone:null,viewTimeZone:I,datesInUnknownTimezone:!(!b||!("datesInUnknownTimezone"in b)||!b.datesInUnknownTimezone)}}):Ft(h)}function Jt({fieldInfos:d,attributes:h,layer:g,graphic:y,fieldInfoMap:v,relatedInfos:b,timeZone:M}){const I={};return b?.forEach(_=>function Is({attributes:d,relatedInfo:h,fieldInfoMap:g,fieldInfos:y,layer:v,timeZone:b}){d&&h&&(h.relatedFeatures?.forEach(M=>en({attributes:d,graphic:M,relatedInfo:h,fieldInfoMap:g,fieldInfos:y,layer:v,timeZone:b})),h.relatedStatsFeatures?.forEach(M=>en({attributes:d,graphic:M,relatedInfo:h,fieldInfoMap:g,fieldInfos:y,layer:v,timeZone:b})))}({attributes:I,relatedInfo:_,fieldInfoMap:v,fieldInfos:d,layer:g,timeZone:M})),h&&Object.keys(h).forEach(_=>{I[_]=ki({fieldName:_,fieldInfos:d,fieldInfoMap:v,layer:g,value:h[_],graphic:y,timeZone:M})}),I}function qi(d,h){return Xt.apply(this,arguments)}function Xt(){return(Xt=(0,T.Z)(function*(d,h){const{layer:g,graphic:y,outFields:v,objectIds:b,returnGeometry:M,spatialReference:I}=d,_=b[0];if("number"!=typeof _&&"string"!=typeof _){const P="Could not query required fields for the specified feature. The feature's ID is invalid.",L={layer:g,graphic:y,objectId:_,requiredFields:v};return zi().warn(P,L),null}if(!(0,Qn.S1)(g)?.operations?.supportsQuery){const P="The specified layer cannot be queried. The following fields will not be available.",L={layer:g,graphic:y,requiredFields:v,returnGeometry:M};return zi().warn(P,L),null}const E=g.createQuery();return E.objectIds=b,E.outFields=v?.length?v:[g.objectIdField],E.returnGeometry=!!M,E.returnZ=!!M,E.returnM=!!M,E.outSpatialReference=I,(yield g.queryFeatures(E,h)).features[0]})).apply(this,arguments)}function kt(){return(kt=(0,T.Z)(function*(d){if(!d.expressionInfos?.length)return!1;const h=yield(0,Kn.LC)(),{arcadeUtils:{hasGeometryFunctions:g}}=h;return g(d)})).apply(this,arguments)}function qt(){return qt=(0,T.Z)(function*({graphic:d,popupTemplate:h,layer:g,spatialReference:y},v){if(!g||!h||("function"==typeof g.load&&(yield g.load(v)),!d.attributes))return;const b=d.attributes[g.objectIdField];if(null==b)return;const M=[b],I=yield h.getRequiredFields(g.fieldsIndex),_=(0,Ge.R9)(I,d),E=_?[]:I,P=h.returnGeometry||(yield function Fs(d){return kt.apply(this,arguments)}(h));if(_&&!P)return;const L=yield qi({layer:g,graphic:d,outFields:E,objectIds:M,returnGeometry:P,spatialReference:y},v);L&&(L.geometry&&(d.geometry=L.geometry),L.attributes&&(d.attributes={...d.attributes,...L.attributes}))}),qt.apply(this,arguments)}function Qe(d=""){return!!d&&d.includes(Wi)}function en({attributes:d,graphic:h,relatedInfo:g,fieldInfos:y,fieldInfoMap:v,layer:b,timeZone:M}){d&&h&&g&&Object.keys(h.attributes).forEach(I=>{const _=function Ms(d){return d?`${Wi}${d.layerId}/${d.fieldName}`:""}({layerId:g.relation.id.toString(),fieldName:I});d[_]=ki({fieldName:_,fieldInfos:y,fieldInfoMap:v,layer:b,value:h.attributes[I],graphic:h,timeZone:M})})}const tn=d=>{if(!d)return!1;const h=d.toUpperCase();return h.includes("CURRENT_TIMESTAMP")||h.includes("CURRENT_DATE")||h.includes("CURRENT_TIME")},nn=({layer:d,method:h,query:g,definitionExpression:y})=>{if(!d.capabilities?.query?.supportsCacheHint||"attachments"===h)return;const v=null!=g.where?g.where:null,b=null!=g.geometry?g.geometry:null;tn(y)||tn(v)||"extent"===b?.type||"tile"===g.resultType||(g.cacheHint=!0)};function sn(d,h,{relatedTableId:g}){const y="scene"===h.type&&h.associatedLayer?h.associatedLayer.url:h.url;return d.filter(Gt).find(v=>v!==h&&v.url===y&&v.layerId===g)}const on={editing:!1,operations:{add:!0,update:!0,delete:!0}},rn=oe.Z.ofType(Z.Z);let Oe=class extends R.Z{constructor(d){super(d),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.capabilities={...on},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new rn,this.fileInfos=new oe.Z,this.graphic=null,this.mode="view",this.filesEnabled=!1,this.addHandles((0,x.YP)(()=>this.graphic,()=>this._graphicChanged(),x.nn))}destroy(){this._attachmentLayer=null,this.graphic=null}castCapabilities(d){return{...on,...d}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:d}=this;if(!d)return!1;const h=d.layer||d.sourceLayer;return h?.loaded&&"capabilities"in h&&h.capabilities&&"operations"in h.capabilities&&"supportsResizeAttachments"in h.capabilities.operations&&h.capabilities.operations.supportsResizeAttachments||!1}getAttachments(){var d=this;return(0,T.Z)(function*(){const{_attachmentLayer:h,attachmentInfos:g}=d;if(!h||"function"!=typeof h.queryAttachments)throw new N.Z("invalid-layer","getAttachments(): A valid layer is required.");const y=d._getObjectId(),v=new D.Z({objectIds:[y],returnMetadata:!0}),b=[],M=h.queryAttachments(v).then(_=>_[y]||b).catch(()=>b);d._getAttachmentsPromise=M,d.notifyChange("state");const I=yield M;return g.removeAll(),I.length&&g.addMany(I),d._getAttachmentsPromise=null,d.notifyChange("state"),I})()}addAttachment(d,h=this.graphic){var g=this;return(0,T.Z)(function*(){const{_attachmentLayer:y,attachmentInfos:v,capabilities:b}=g;if(!h)throw new N.Z("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:h});if(!d)throw new N.Z("invalid-attachment","addAttachment(): An attachment is required.",{attachment:d});if(!b.operations?.add)throw new N.Z("invalid-capabilities","addAttachment(): add capabilities are required.");if(!y||"function"!=typeof y.addAttachment)throw new N.Z("invalid-layer","addAttachment(): A valid layer is required.");const M=y.addAttachment(h,d).then(_=>g._queryAttachment(_.objectId,h)),I=yield M;return v.add(I),I})()}deleteAttachment(d){var h=this;return(0,T.Z)(function*(){const{_attachmentLayer:g,attachmentInfos:y,graphic:v,capabilities:b}=h;if(!d)throw new N.Z("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:d});if(!b.operations?.delete)throw new N.Z("invalid-capabilities","deleteAttachment(): delete capabilities are required.");if(!g||"function"!=typeof g.deleteAttachments)throw new N.Z("invalid-layer","deleteAttachment(): A valid layer is required.");if(!v)throw new N.Z("invalid-graphic","deleteAttachment(): A graphic is required.");const M=g.deleteAttachments(v,[d.id]).then(()=>d),I=yield M;return y.remove(I),I})()}updateAttachment(d,h=this.activeAttachmentInfo){var g=this;return(0,T.Z)(function*(){const{_attachmentLayer:y,attachmentInfos:v,graphic:b,capabilities:M}=g;if(!d)throw new N.Z("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:d});if(!h)throw new N.Z("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:h});if(!M.operations?.update)throw new N.Z("invalid-capabilities","updateAttachment(): Update capabilities are required.");const I=v.indexOf(h);if(!y||"function"!=typeof y.updateAttachment)throw new N.Z("invalid-layer","updateAttachment(): A valid layer is required.");if(!b)throw new N.Z("invalid-graphic","updateAttachment(): A graphic is required.");const _=y.updateAttachment(b,h.id,d).then(P=>g._queryAttachment(P.objectId)),E=yield _;return v.splice(I,1,E),E})()}commitFiles(){var d=this;return(0,T.Z)(function*(){return yield Promise.all(d.fileInfos.items.map(h=>d.addAttachment(h.form))),d.fileInfos.removeAll(),d.getAttachments()})()}addFile(d,h){if(!d||!h)return null;const g={file:d,form:h};return this.fileInfos.add(g),g}updateFile(d,h,g=this.activeFileInfo){if(!d||!h||!g)return null;const y=this.fileInfos.indexOf(g);return y>-1&&this.fileInfos.splice(y,1,{file:d,form:h}),this.fileInfos.items[y]}deleteFile(d){const h=this.fileInfos.find(g=>g.file===d);return h?(this.fileInfos.remove(h),h):null}_queryAttachment(d,h){var g=this;return(0,T.Z)(function*(){const{_attachmentLayer:y}=g;if(!d||!y?.queryAttachments)throw new N.Z("invalid-attachment-id","Could not query attachment.");const v=g._getObjectId(h),b=new D.Z({objectIds:[v],attachmentsWhere:`AttachmentId=${d}`,returnMetadata:!0});return y.queryAttachments(b).then(M=>M[v][0])})()}_getObjectId(d=this.graphic){return d?.getObjectId()??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:d}=this,h=Yi(d);this._attachmentLayer=h?"scene"===h.type&&null!=h.associatedLayer?h.associatedLayer:h:null}};(0,F._)([(0,w.Cb)()],Oe.prototype,"capabilities",void 0),(0,F._)([(0,Ue.p)("capabilities")],Oe.prototype,"castCapabilities",null),(0,F._)([(0,w.Cb)()],Oe.prototype,"activeAttachmentInfo",void 0),(0,F._)([(0,w.Cb)()],Oe.prototype,"activeFileInfo",void 0),(0,F._)([(0,w.Cb)({readOnly:!0,type:rn})],Oe.prototype,"attachmentInfos",void 0),(0,F._)([(0,w.Cb)()],Oe.prototype,"fileInfos",void 0),(0,F._)([(0,w.Cb)({type:O.Z})],Oe.prototype,"graphic",void 0),(0,F._)([(0,w.Cb)()],Oe.prototype,"mode",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],Oe.prototype,"state",null),(0,F._)([(0,w.Cb)()],Oe.prototype,"filesEnabled",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],Oe.prototype,"supportsResizeAttachments",null),Oe=(0,F._)([(0,W.j)("esri.widgets.Attachments.AttachmentsViewModel")],Oe);const ei=Oe;var xs=C(54346);function an(d){const h=d.toLowerCase();return"image/bmp"===h||"image/emf"===h||"image/exif"===h||"image/gif"===h||"image/x-icon"===h||"image/jpeg"===h||"image/png"===h||"image/tiff"===h||"image/x-wmf"===h}var gt=C(97369),Y=C(91192),Ve=C(20177),Be=C(38570),Ze=C(25552),A=C(94450);const ln={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},te="esri-attachments",j={base:te,loaderContainer:`${te}__loader-container`,loader:`${te}__loader`,fadeIn:`${te}--fade-in`,container:`${te}__container`,containerList:`${te}__container--list`,containerPreview:`${te}__container--preview`,actions:`${te}__actions`,deleteButton:`${te}__delete-button`,addAttachmentButton:`${te}__add-attachment-button`,errorMessage:`${te}__error-message`,items:`${te}__items`,item:`${te}__item`,itemButton:`${te}__item-button`,itemMask:`${te}__item-mask`,itemMaskIcon:`${te}__item-mask--icon`,itemImage:`${te}__image`,itemImageResizable:`${te}__image--resizable`,itemLabel:`${te}__label`,itemFilename:`${te}__filename`,itemChevronIcon:`${te}__item-chevron-icon`,itemLink:`${te}__item-link`,itemLinkOverlay:`${te}__item-link-overlay`,itemLinkOverlayIcon:`${te}__item-link-overlay-icon`,itemEditIcon:`${te}__item-edit-icon`,itemAddIcon:`${te}__item-add-icon`,itemAddButton:`${te}__item-add-button`,formNode:`${te}__form-node`,fileFieldset:`${te}__file-fieldset`,fileLabel:`${te}__file-label`,fileName:`${te}__file-name`,fileInput:`${te}__file-input`,metadata:`${te}__metadata`,metadataFieldset:`${te}__metadata-fieldset`,progressBar:`${te}__progress-bar`},ti=window.CSS;let _e=class extends V.Z{constructor(d,h){super(d,h),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements={...ln},this._supportsImageOrientation=ti&&ti.supports&&ti.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}normalizeCtorArgs(d){return d?.viewModel||(d={viewModel:new ei,...d}),d}initialize(){this.addHandles([(0,x.on)(()=>this.viewModel?.attachmentInfos,"change",()=>this.scheduleRender()),(0,x.on)(()=>this.viewModel?.fileInfos,"change",()=>this.scheduleRender()),(0,x.YP)(()=>this.viewModel?.mode,()=>this._modeChanged(),x.nn)])}loadDependencies(){return(0,gt.h)({icon:()=>Promise.all([C.e(6203),C.e(8472)]).then(C.bind(C,8472))})}get capabilities(){return this.viewModel.capabilities}set capabilities(d){this.viewModel.capabilities=d}get effectiveDisplayType(){const{displayType:d}=this;return d&&"auto"!==d?d:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(d){this.viewModel.graphic=d}get label(){return this.messages?.widgetLabel??""}set label(d){this._overrideIfSome("label",d)}castVisibleElements(d){return{...ln,...d}}addAttachment(){const{_addAttachmentForm:d,viewModel:h}=this;return this._set("submitting",!0),this._set("error",null),h.addAttachment(d).then(g=>(this._set("submitting",!1),this._set("error",null),h.mode="view",g)).catch(g=>{throw this._set("submitting",!1),this._set("error",new N.Z("attachments:add-attachment",this.messages.addErrorMessage,g)),g})}deleteAttachment(d){const{viewModel:h}=this;return this._set("submitting",!0),this._set("error",null),h.deleteAttachment(d).then(g=>(this._set("submitting",!1),this._set("error",null),h.mode="view",g)).catch(g=>{throw this._set("submitting",!1),this._set("error",new N.Z("attachments:delete-attachment",this.messages.deleteErrorMessage,g)),g})}updateAttachment(){const{viewModel:d}=this,{_updateAttachmentForm:h}=this;return this._set("submitting",!0),this._set("error",null),d.updateAttachment(h).then(g=>(this._set("submitting",!1),this._set("error",null),d.mode="view",g)).catch(g=>{throw this._set("submitting",!1),this._set("error",new N.Z("attachments:update-attachment",this.messages.updateErrorMessage,g)),g})}addFile(){const d=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",d}updateFile(){const{viewModel:d}=this,h=d.updateFile(this.selectedFile,this._updateAttachmentForm,d.activeFileInfo);return d.mode="view",h}deleteFile(d){const h=this.viewModel.deleteFile(d||this.viewModel.activeFileInfo?.file);return this.viewModel.mode="view",h}render(){const{submitting:d,viewModel:h}=this,{state:g}=h;return(0,A.u)("div",{class:this.classes(j.base,Y.z.widget)},d?this._renderProgressBar():null,"loading"===g?this._renderLoading():this._renderAttachments(),this._renderErrorMessage())}_renderErrorMessage(){const{error:d,visibleElements:h}=this;return d&&h.errorMessage?(0,A.u)("div",{class:j.errorMessage,key:"error-message"},d.message):null}_renderAttachments(){const{activeFileInfo:d,mode:h,activeAttachmentInfo:g}=this.viewModel;return"add"===h?this._renderAddForm():"edit"===h?this._renderDetailsForm(g||d):this._renderAttachmentContainer()}_renderLoading(){return(0,A.u)("div",{class:j.loaderContainer,key:"loader"},(0,A.u)("div",{class:j.loader}))}_renderProgressBar(){return this.visibleElements.progressBar?(0,A.u)("div",{class:j.progressBar,key:"progress-bar"}):null}_renderAddForm(){const{submitting:d,selectedFile:h}=this,g=d||!h,y=this.visibleElements.cancelAddButton?(0,A.u)("button",{bind:this,class:this.classes(Y.z.button,Y.z.buttonTertiary,Y.z.buttonSmall,Y.z.buttonHalf,d&&Y.z.buttonDisabled),disabled:d,onclick:this._cancelForm,type:"button"},this.messages.cancel):null,v=this.visibleElements.addSubmitButton?(0,A.u)("button",{class:this.classes(Y.z.button,Y.z.buttonSecondary,Y.z.buttonSmall,Y.z.buttonHalf,{[Y.z.buttonDisabled]:g}),disabled:g,type:"submit"},this.messages.add):null,b=h?(0,A.u)("span",{class:j.fileName,key:"file-name"},h.name):null,M=(0,A.u)("form",{afterCreate:Be.Yo,afterRemoved:Be.pV,bind:this,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},(0,A.u)("fieldset",{class:j.fileFieldset},b,(0,A.u)("label",{class:this.classes(j.fileLabel,Y.z.button,Y.z.buttonSecondary)},h?this.messages.changeFile:this.messages.selectFile,(0,A.u)("input",{bind:this,class:j.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))),v,y);return(0,A.u)("div",{class:j.formNode,key:"add-form-container"},M)}_renderDetailsForm(d){const{visibleElements:h,viewModel:g,selectedFile:y,submitting:v}=this,{capabilities:b}=g,M=v||!y;let I,_,E,P;y?(I=y.type,_=y.name,E=y.size):d&&"file"in d?(I=d.file.type,_=d.file.name,E=d.file.size):d&&"contentType"in d&&(I=d.contentType,_=d.name,E=d.size,P=d.url);const L=b.editing&&b.operations?.delete&&h.deleteButton?(0,A.u)("button",{bind:this,class:this.classes(Y.z.button,Y.z.buttonSmall,Y.z.buttonTertiary,j.deleteButton,{[Y.z.buttonDisabled]:v}),disabled:v,key:"delete-button",onclick:se=>this._submitDeleteAttachment(se,d),type:"button"},this.messages.delete):void 0,S=b.editing&&b.operations?.update&&h.updateButton?(0,A.u)("button",{class:this.classes(Y.z.button,Y.z.buttonSmall,Y.z.buttonThird,{[Y.z.buttonDisabled]:M}),disabled:M,key:"update-button",type:"submit"},this.messages.update):void 0,$=this.visibleElements.cancelUpdateButton?(0,A.u)("button",{bind:this,class:this.classes(Y.z.button,Y.z.buttonSmall,Y.z.buttonTertiary,Y.z.buttonThird,{[Y.z.buttonDisabled]:v}),disabled:v,key:"cancel-button",onclick:this._cancelForm,type:"button"},this.messages.cancel):void 0,B=b.editing&&b.operations?.update?(0,A.u)("fieldset",{class:j.fileFieldset,key:"file"},(0,A.u)("span",{class:j.fileName,key:"file-name"},_),(0,A.u)("label",{class:this.classes(j.fileLabel,Y.z.button,Y.z.buttonSecondary)},this.messages.changeFile,(0,A.u)("input",{bind:this,class:j.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))):void 0,G=(0,A.u)("fieldset",{class:j.metadataFieldset,key:"size"},(0,A.u)("label",null,(0,ie.sS)(this.messagesUnits,E??0))),X=(0,A.u)("fieldset",{class:j.metadataFieldset,key:"content-type"},(0,A.u)("label",null,I)),k=null!=P?(0,A.u)("a",{class:j.itemLink,href:P,rel:"noreferrer",target:"_blank"},this._renderImageMask(d,400),(0,A.u)("div",{class:j.itemLinkOverlay},(0,A.u)("span",{class:j.itemLinkOverlayIcon},(0,A.u)("calcite-icon",{icon:"launch"})))):this._renderImageMask(d,400),le=(0,A.u)("form",{afterCreate:Be.Yo,afterRemoved:Be.pV,bind:this,"data-node-ref":"_updateAttachmentForm",onsubmit:se=>this._submitUpdateAttachment(se,d)},(0,A.u)("div",{class:j.metadata},G,X),B,(0,A.u)("div",{class:j.actions},L,$,S));return(0,A.u)("div",{class:j.formNode,key:"edit-form-container"},k,le)}_renderImageMask(d,h){return d?"file"in d?this._renderGenericImageMask(d.file.name,d.file.type):this._renderImageMaskForAttachment(d,h):null}_renderGenericImageMask(d,h){const{supportsResizeAttachments:g}=this.viewModel,y=function Ps(d){const h=(0,xs.V)("esri/themes/base/images/files/");return d?"text/plain"===d?`${h}text-32.svg`:"application/pdf"===d?`${h}pdf-32.svg`:"text/csv"===d?`${h}csv-32.svg`:"application/gpx+xml"===d?`${h}gpx-32.svg`:"application/x-dwf"===d?`${h}cad-32.svg`:"application/postscript"===d||"application/json"===d||"text/xml"===d||"model/vrml"===d?`${h}code-32.svg`:"application/x-zip-compressed"===d||"application/x-7z-compressed"===d||"application/x-gzip"===d||"application/x-tar"===d||"application/x-gtar"===d||"application/x-bzip2"===d||"application/gzip"===d||"application/x-compress"===d||"application/x-apple-diskimage"===d||"application/x-rar-compressed"===d||"application/zip"===d?`${h}zip-32.svg`:d.includes("image/")?`${h}image-32.svg`:d.includes("audio/")?`${h}sound-32.svg`:d.includes("video/")?`${h}video-32.svg`:d.includes("msexcel")||d.includes("ms-excel")||d.includes("spreadsheetml")?`${h}excel-32.svg`:d.includes("msword")||d.includes("ms-word")||d.includes("wordprocessingml")?`${h}word-32.svg`:d.includes("powerpoint")||d.includes("presentationml")?`${h}report-32.svg`:`${h}generic-32.svg`:`${h}generic-32.svg`}(h),v={[j.itemImageResizable]:g};return(0,A.u)("div",{class:this.classes(j.itemMaskIcon,j.itemMask),key:y},(0,A.u)("img",{alt:d,class:this.classes(v,j.itemImage),src:y,title:d}))}_renderImageMaskForAttachment(d,h){const{supportsResizeAttachments:g}=this.viewModel;if(!d)return null;const{contentType:y,name:v,url:b}=d;if(!g||!an(y))return this._renderGenericImageMask(v,y);const M=this._getCSSTransform(d),I=M?{transform:M,"image-orientation":"none"}:{},_=`${b}${b?.includes("?")?"&":"?"}w=${h}`,E={[j.itemImageResizable]:g};return(0,A.u)("div",{class:this.classes(j.itemMask),key:_},(0,A.u)("img",{alt:v,class:this.classes(E,j.itemImage),src:_,styles:I,title:v}))}_renderFile(d){const{file:h}=d;return(0,A.u)("li",{class:j.item,key:h},(0,A.u)("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:j.itemButton,key:"details-button",onclick:()=>this._startEditFile(d),title:this.messages.attachmentDetails,type:"button"},this._renderImageMask(d),(0,A.u)("label",{class:j.itemLabel},(0,A.u)("span",{class:j.itemFilename},h.name||this.messages.noTitle),(0,A.u)("span",{"aria-hidden":"true",class:this.classes(j.itemChevronIcon,(0,Be.dZ)(this.container)?Ve.W.left:Ve.W.right)}))))}_renderAttachmentInfo({attachmentInfo:d,displayType:h}){const{viewModel:g,effectiveDisplayType:y}=this,{capabilities:v,supportsResizeAttachments:b}=g,{contentType:M,name:I,url:_}=d,E=this._renderImageMask(d,"list"===h?48:400),P=v.editing?(0,A.u)("span",{"aria-hidden":"true",class:this.classes(j.itemChevronIcon,(0,Be.dZ)(this.container)?Ve.W.left:Ve.W.right)}):null,L=[E,"preview"===y&&b&&an(M)?null:(0,A.u)("label",{class:j.itemLabel},(0,A.u)("span",{class:j.itemFilename},I||this.messages.noTitle),P)],S=v.editing?(0,A.u)("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:j.itemButton,"data-attachment-info-id":d.id,key:"details-button",onclick:()=>this._startEditAttachment(d),title:this.messages.attachmentDetails,type:"button"},L):(0,A.u)("a",{class:j.itemButton,href:_??void 0,key:"details-link",target:"_blank"},L);return(0,A.u)("li",{class:j.item,key:d},S)}_renderAttachmentContainer(){const{effectiveDisplayType:d,viewModel:h,visibleElements:g}=this,{attachmentInfos:y,capabilities:v,fileInfos:b}=h,M=!!y?.length,I=!!b?.length,_={[j.containerList]:"preview"!==d,[j.containerPreview]:"preview"===d},E=v.editing&&v.operations?.add&&g.addButton?(0,A.u)("button",{bind:this,class:this.classes(Y.z.button,Y.z.buttonTertiary,j.addAttachmentButton),onclick:()=>this._startAddAttachment(),type:"button"},(0,A.u)("span",{"aria-hidden":"true",class:this.classes(j.itemAddIcon,Ve.W.plus)}),this.messages.add):void 0,P=M?(0,A.u)("ul",{class:j.items,key:"attachments-list"},y.toArray().map($=>this._renderAttachmentInfo({attachmentInfo:$,displayType:d}))):void 0,L=I?(0,A.u)("ul",{class:j.items,key:"file-list"},b.toArray().map($=>this._renderFile($))):void 0,S=I||M?void 0:(0,A.u)("div",{class:Y.z.empty},this.messages.noAttachments);return(0,A.u)("div",{class:this.classes(j.container,_),key:"attachments-container"},P,L,S,E)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(d){const g=d.target.files?.item(0);this._set("selectedFile",g)}_submitDeleteAttachment(d,h){d.preventDefault(),h&&("file"in h?this.deleteFile(h.file):h&&this.deleteAttachment(h))}_submitAddAttachment(d){d.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(d,h){d.preventDefault(),h&&"file"in h?this.updateFile():this.updateAttachment()}_startEditAttachment(d){const{viewModel:h}=this;h.activeFileInfo=null,h.activeAttachmentInfo=d,h.mode="edit"}_startEditFile(d){const{viewModel:h}=this;h.activeAttachmentInfo=null,h.activeFileInfo=d,h.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(d){d.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(d){const{orientationInfo:h}=d;return!this._supportsImageOrientation&&h?[h.rotation?`rotate(${h.rotation}deg)`:"",h.mirrored?"scaleX(-1)":""].join(" "):""}};(0,F._)([(0,w.Cb)()],_e.prototype,"capabilities",null),(0,F._)([(0,w.Cb)()],_e.prototype,"displayType",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],_e.prototype,"effectiveDisplayType",null),(0,F._)([(0,w.Cb)()],_e.prototype,"graphic",null),(0,F._)([(0,w.Cb)()],_e.prototype,"label",null),(0,F._)([(0,w.Cb)(),(0,Ze.H)("esri/widgets/Attachments/t9n/Attachments")],_e.prototype,"messages",void 0),(0,F._)([(0,w.Cb)(),(0,Ze.H)("esri/core/t9n/Units")],_e.prototype,"messagesUnits",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],_e.prototype,"selectedFile",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],_e.prototype,"submitting",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],_e.prototype,"error",void 0),(0,F._)([(0,w.Cb)({type:ei})],_e.prototype,"viewModel",void 0),(0,F._)([(0,w.Cb)()],_e.prototype,"visibleElements",void 0),(0,F._)([(0,Ue.p)("visibleElements")],_e.prototype,"castVisibleElements",null),_e=(0,F._)([(0,W.j)("esri.widgets.Attachments")],_e);const Ts=_e;let wt=class extends ei{constructor(d){super(d),this.description=null,this.title=null}};(0,F._)([(0,w.Cb)()],wt.prototype,"description",void 0),(0,F._)([(0,w.Cb)()],wt.prototype,"title",void 0),wt=(0,F._)([(0,W.j)("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],wt);const ii=wt;var ni=C(13065);const si="esri-feature-element-info",oi={base:si,title:`${si}__title`,description:`${si}__description`};let yt=class extends V.Z{constructor(d,h){super(d,h),this.description=null,this.headingLevel=2,this.title=null}render(){return(0,A.u)("div",{class:oi.base},this._renderTitle(),this._renderDescription())}_renderTitle(){const{title:d}=this;return d?(0,A.u)(ni.X,{class:oi.title,level:this.headingLevel},d):null}_renderDescription(){const{description:d}=this;return d?(0,A.u)("div",{class:oi.description,key:"description"},d):null}};(0,F._)([(0,w.Cb)()],yt.prototype,"description",void 0),(0,F._)([(0,w.Cb)()],yt.prototype,"headingLevel",void 0),(0,F._)([(0,w.Cb)()],yt.prototype,"title",void 0),yt=(0,F._)([(0,W.j)("esri.widgets.Feature.support.FeatureElementInfo")],yt);const Pt=yt;let We=class extends V.Z{constructor(d,h){super(d,h),this._featureElementInfo=null,this.attachmentsWidget=new Ts,this.headingLevel=2,this.viewModel=new ii}initialize(){this._featureElementInfo=new Pt,this.addHandles([(0,x.YP)(()=>[this.viewModel?.description,this.viewModel?.title,this.headingLevel],()=>this._setupFeatureElementInfo(),x.nn),(0,x.YP)(()=>this.viewModel,d=>this.attachmentsWidget.viewModel=d,x.nn)])}destroy(){this.attachmentsWidget.viewModel=null,this.attachmentsWidget.destroy(),this._featureElementInfo?.destroy()}get description(){return this.viewModel.description}set description(d){this.viewModel.description=d}get displayType(){return this.attachmentsWidget.displayType}set displayType(d){this.attachmentsWidget.displayType=d}get graphic(){return this.viewModel.graphic}set graphic(d){this.viewModel.graphic=d}get title(){return this.viewModel.title}set title(d){this.viewModel.title=d}render(){const{attachmentsWidget:d}=this;return(0,A.u)("div",{class:"esri-feature-attachments"},this._featureElementInfo?.render(),d?.render())}_setupFeatureElementInfo(){const{description:d,title:h,headingLevel:g}=this;this._featureElementInfo?.set({description:d,title:h,headingLevel:g})}};(0,F._)([(0,w.Cb)({readOnly:!0})],We.prototype,"attachmentsWidget",void 0),(0,F._)([(0,w.Cb)()],We.prototype,"description",null),(0,F._)([(0,w.Cb)()],We.prototype,"displayType",null),(0,F._)([(0,w.Cb)()],We.prototype,"graphic",null),(0,F._)([(0,w.Cb)()],We.prototype,"headingLevel",void 0),(0,F._)([(0,w.Cb)()],We.prototype,"title",null),(0,F._)([(0,w.Cb)({type:ii})],We.prototype,"viewModel",void 0),We=(0,F._)([(0,W.j)("esri.widgets.Feature.FeatureAttachments")],We);const Os=We;let it=class extends R.Z{constructor(d){super(d),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.addHandles((0,x.YP)(()=>this.creator,h=>{this._destroyContent(),this._createContent(h)},x.nn))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:d,graphic:h,destroyer:g}=this;d&&h&&(xt(g,{graphic:h}).catch(()=>null),this._set("created",null))}_createContent(d){var h=this;return(0,T.Z)(function*(){const g=h.graphic;if(!g||!d)return;const y=xt(d,{graphic:g}).catch(()=>null);h._loadingPromise=y,h.notifyChange("state");const v=yield y;y===h._loadingPromise&&(h._loadingPromise=null,h.notifyChange("state"),h._set("created",v))})()}};(0,F._)([(0,w.Cb)({readOnly:!0})],it.prototype,"created",void 0),(0,F._)([(0,w.Cb)()],it.prototype,"creator",void 0),(0,F._)([(0,w.Cb)()],it.prototype,"destroyer",void 0),(0,F._)([(0,w.Cb)({type:O.Z})],it.prototype,"graphic",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],it.prototype,"state",null),it=(0,F._)([(0,W.j)("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],it);const Tt=it;var ri=C(25469);const ai="esri-feature-content",li={base:ai,loaderContainer:`${ai}__loader-container`,loader:`${ai}__loader`};let vt=class extends V.Z{constructor(d,h){super(d,h),this.viewModel=null,this._addTargetToAnchors=g=>{Array.from(g.querySelectorAll("a")).forEach(y=>{Gi(y.href)&&!y.hasAttribute("target")&&y.setAttribute("target","_blank")})}}get creator(){return this.viewModel?.creator}set creator(d){this.viewModel&&(this.viewModel.creator=d)}get graphic(){return this.viewModel?.graphic}set graphic(d){this.viewModel&&(this.viewModel.graphic=d)}render(){const d=this.viewModel?.state;return(0,A.u)("div",{class:li.base},"loading"===d?this._renderLoading():this._renderCreated())}_renderLoading(){return(0,A.u)("div",{class:li.loaderContainer,key:"loader"},(0,A.u)("div",{class:li.loader}))}_renderCreated(){const d=this.viewModel?.created;return d?d instanceof HTMLElement?(0,A.u)("div",{afterCreate:this._attachToNode,bind:d,key:d}):(0,ri.Qd)(d)?(0,A.u)("div",{key:d},!d.destroyed&&d.render()):(0,A.u)("div",{afterCreate:this._addTargetToAnchors,innerHTML:d,key:d}):null}_attachToNode(d){d.appendChild(this)}};(0,F._)([(0,w.Cb)()],vt.prototype,"creator",null),(0,F._)([(0,w.Cb)()],vt.prototype,"graphic",null),(0,F._)([(0,w.Cb)({type:Tt})],vt.prototype,"viewModel",void 0),vt=(0,F._)([(0,W.j)("esri.widgets.Feature.FeatureContent")],vt);const Rt=vt;var Ls=C(38439),dn=C(25621);let Ke=class extends R.Z{constructor(d){super(d),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:d,fieldInfos:h}=this,g=[];return h?.forEach(y=>{if(y.hasOwnProperty("visible")&&!y.visible)return;const v=y.clone();v.label=Qi(v,d),g.push(v)}),g}};(0,F._)([(0,w.Cb)()],Ke.prototype,"attributes",void 0),(0,F._)([(0,w.Cb)({type:[Ls.Z]})],Ke.prototype,"expressionInfos",void 0),(0,F._)([(0,w.Cb)()],Ke.prototype,"description",void 0),(0,F._)([(0,w.Cb)({type:[dn.Z]})],Ke.prototype,"fieldInfos",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],Ke.prototype,"formattedFieldInfos",null),(0,F._)([(0,w.Cb)()],Ke.prototype,"title",void 0),Ke=(0,F._)([(0,W.j)("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],Ke);const Ot=Ke,Ss=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}],Lt="esri-feature-fields",St={base:Lt,fieldHeader:`${Lt}__field-header`,fieldData:`${Lt}__field-data`,fieldDataDate:`${Lt}__field-data--date`};let ze=class extends V.Z{constructor(d,h){super(d,h),this._featureElementInfo=null,this.viewModel=new Ot,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new Pt,this.addHandles((0,x.YP)(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),x.nn))}destroy(){this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(d){this.viewModel.attributes=d}get description(){return this.viewModel.description}set description(d){this.viewModel.description=d}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(d){this.viewModel.expressionInfos=d}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(d){this.viewModel.fieldInfos=d}get title(){return this.viewModel.title}set title(d){this.viewModel.title=d}render(){return(0,A.u)("div",{class:St.base},this._featureElementInfo?.render(),this._renderFields())}_renderFieldInfo(d,h){const{attributes:g}=this.viewModel,y=d.fieldName,v=d.label||y,b=g?null==g[y]?"":g[y]:"",M=!(!d.format||!d.format.dateFormat),I="number"!=typeof b||M?function Ns(d,h){if("string"!=typeof h||!h)return h;const g=Ss.find(_=>_.pattern.test(h));if(!g)return h;const y=h.match(g.pattern),b=(0,U.gx)((0,U.gx)(g.label,{messages:d,hierPart:y&&y[2]}),{appName:g.appName});return h.replace(g.pattern,`<a${g.target?` target="${g.target}"`:""} href="$1"${"_blank"===g.target?' rel="noreferrer"':""}>${b}</a>`)}(this.messagesURIUtils,b):this._forceLTR(b),_={[St.fieldDataDate]:M};return(0,A.u)("tr",{key:`fields-element-info-row-${y}-${h}`},(0,A.u)("th",{class:St.fieldHeader,innerHTML:v,key:`fields-element-info-row-header-${y}-${h}`}),(0,A.u)("td",{class:this.classes(St.fieldData,_),innerHTML:I,key:`fields-element-info-row-data-${y}-${h}`}))}_renderFields(){const{formattedFieldInfos:d}=this.viewModel;return d?.length?(0,A.u)("table",{class:Y.z.table,summary:this.messages.fieldsSummary},(0,A.u)("tbody",null,d.map((h,g)=>this._renderFieldInfo(h,g)))):null}_setupFeatureElementInfo(){const{description:d,title:h}=this;this._featureElementInfo?.set({description:d,title:h})}_forceLTR(d){return`&lrm;${d}`}};(0,F._)([(0,w.Cb)()],ze.prototype,"attributes",null),(0,F._)([(0,w.Cb)()],ze.prototype,"description",null),(0,F._)([(0,w.Cb)()],ze.prototype,"expressionInfos",null),(0,F._)([(0,w.Cb)()],ze.prototype,"fieldInfos",null),(0,F._)([(0,w.Cb)()],ze.prototype,"title",null),(0,F._)([(0,w.Cb)({type:Ot,nonNullable:!0})],ze.prototype,"viewModel",void 0),(0,F._)([(0,w.Cb)(),(0,Ze.H)("esri/widgets/Feature/t9n/Feature")],ze.prototype,"messages",void 0),(0,F._)([(0,w.Cb)(),(0,Ze.H)("esri/widgets/support/t9n/uriUtils")],ze.prototype,"messagesURIUtils",void 0),ze=(0,F._)([(0,W.j)("esri.widgets.Feature.FeatureFields")],ze);const un=ze;var Zs=C(64831),bt=C(85931),Vs=C(77891),Ds=C(84792),he=C(10699),di=(C(15283),C(2865)),ui=(C(59318),C(24263),C(21726),C(16730),C(92383),C(37053),C(5548),C(21286),C(21674),C(72854),C(72642)),ci=(C(37118),C(55214),C(74618),C(65234),C(94425),C(24192),C(17253),C(96854)),hi=C(67010),Us=(C(6871),C(60776));const cn=()=>K.Z.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),hn=new Map;function Nt(d){if(!Qe(d))return null;const[h,g]=d.split("/").slice(1);return{layerId:h,fieldName:g}}function pi(){return(pi=(0,T.Z)(function*(d,h,g,y){const v=g.layerId.toString(),{layerInfo:b,relation:M,relatedFields:I,outStatistics:_,url:E,sourceSpatialReference:P}=h,L=function Ks(d){return d?(0,bt.Tw)(d):void 0}(I),S=function Js(d){return d?(0,bt.Tw)(d,(h,g)=>JSON.stringify(h.toJSON())===JSON.stringify(g.toJSON())):void 0}(_);if(!b||!M)return null;const $=function js({originRelationship:d,relationships:h,layerId:g}){return h.find(({relatedTableId:y,id:v})=>`${y}`===g&&v===d?.id)??null}({originRelationship:M,relationships:b.relationships,layerId:v});if($?.relationshipTableId&&$.keyFieldInRelationshipTable){const G=(yield function Gs(d,h,g,y){const v=new hi.default;return v.outFields=["*"],v.relationshipId="number"==typeof h.id?h.id:parseInt(h.id,10),v.objectIds=[d.attributes[g.objectIdField]],g.queryRelatedFeatures?.(v,y)??Promise.resolve({})}(d,$,g,y))[d.attributes[g.objectIdField]];if(!G)return null;const X=G.features.map(k=>k.attributes[b.objectIdField]);if(S?.length&&b.supportsStatistics){const k=new ci.Z;k.where=function Qs(d,h,g){let y=0;const v=[];for(;y<h.length;)v.push(`${d} IN (${h.slice(y,g+y)})`),y+=g;return v.join(" OR ")}(b.objectIdField,X,1e3),k.outFields=L,k.outStatistics=S,k.sourceSpatialReference=P;const le={features:Promise.resolve(G),statsFeatures:(0,di.e)(E,k)};return(0,he.as)(le)}}const B=$?.keyField;if(B){const G=(0,Ge.H7)(function io(d,h){if(null!=d){h=h.toLowerCase();for(const g of d)if(g&&g.name.toLowerCase()===h)return g}return null}(b.fields,B)),X=function Ws(d,h){const g=h.toLowerCase();for(const y in d)if(y.toLowerCase()===g)return d[y];return null}(d.attributes,M.keyField),k=G?`${B}=${X}`:`${B}='${X}'`,le=(0,di.e)(E,new ci.Z({where:k,outFields:L,sourceSpatialReference:P}),y),se=S?.length&&b.supportsStatistics?(0,di.e)(E,new ci.Z({where:k,outFields:L,outStatistics:S,sourceSpatialReference:P}),y):null,be={features:le};return se&&(be.statsFeatures=se),(0,he.as)(be)}return null})).apply(this,arguments)}const pn={chartAnimation:!0};let pe=class extends R.Z{constructor(d){super(d),this.abilities={...pn},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(d){return{...pn,...d}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(d){this._setContentElementMedia(d)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(d){const{formattedMediaInfoCount:h}=this;this.activeMediaInfoIndex=(d+h)%h}_pageContentElementMedia(d){const{activeMediaInfoIndex:h}=this;this._setContentElementMedia(h+d)}_formatMediaInfos(){const{mediaInfos:d,layer:h}=this,g=this.attributes??{},y=this.formattedAttributes??{},v=this.expressionAttributes??{},b=this.fieldInfoMap??new Map;return d?.map(M=>{const I=M?.clone();if(!I)return null;if(I.title=at({attributes:g,fieldInfoMap:b,globalAttributes:y,expressionAttributes:v,layer:h,text:I.title}),I.caption=at({attributes:g,fieldInfoMap:b,globalAttributes:y,expressionAttributes:v,layer:h,text:I.caption}),I.altText=at({attributes:g,fieldInfoMap:b,globalAttributes:y,expressionAttributes:v,layer:h,text:I.altText}),"image"===I.type){const{value:_}=I;return this._setImageValue({value:_,formattedAttributes:y,layer:h}),I.value.sourceURL?I:void 0}if("pie-chart"===I.type||"line-chart"===I.type||"column-chart"===I.type||"bar-chart"===I.type){const{value:_}=I;return this._setChartValue({value:_,chartType:I.type,attributes:g,formattedAttributes:y,layer:h,expressionAttributes:v}),I}return null}).filter(bt.pC)??[]}_setImageValue(d){const h=this.fieldInfoMap??new Map,{value:g,formattedAttributes:y,layer:v}=d,{linkURL:b,sourceURL:M}=g;if(M){const I=Yt(M,v);g.sourceURL=Ht({formattedAttributes:y,template:I,fieldInfoMap:h})}if(b){const I=Yt(b,v);g.linkURL=Ht({formattedAttributes:y,template:I,fieldInfoMap:h})}}_setChartValue(d){const{value:h,attributes:g,formattedAttributes:y,chartType:v,layer:b,expressionAttributes:M}=d,{popupTemplate:I,relatedInfos:_}=this,{fields:E,normalizeField:P}=h,L=b;if(h.fields=function as(d,h){return d&&d.map(g=>Ct(g,h))}(E,L),P&&(h.normalizeField=Ct(P,L)),!E.some($=>!!(null!=y[$]||Qe($)&&_?.size)))return;const S=I?.fieldInfos??[];E.forEach(($,B)=>{const G=h.colors?.[B];if(Qe($))return void(h.series=[...h.series,...this._getRelatedChartInfos({fieldInfos:S,fieldName:$,formattedAttributes:y,chartType:v,value:h,color:G})]);const X=this._getChartOption({value:h,attributes:g,chartType:v,formattedAttributes:y,expressionAttributes:M,fieldName:$,fieldInfos:S,color:G});h.series.push(X)})}_getRelatedChartInfos(d){const{fieldInfos:h,fieldName:g,formattedAttributes:y,chartType:v,value:b,color:M}=d,I=[],_=Nt(g),E=_&&this.relatedInfos?.get(_.layerId.toString());if(!E)return I;const{relatedFeatures:P,relation:L}=E;if(!L||!P)return I;const{cardinality:S}=L;return P.forEach($=>{const{attributes:B}=$;B&&Object.keys(B).forEach(G=>{G===_.fieldName&&I.push(this._getChartOption({value:b,attributes:B,formattedAttributes:y,fieldName:g,chartType:v,relatedFieldName:G,hasMultipleRelatedFeatures:P?.length>1,fieldInfos:h,color:M}))})}),"one-to-many"===S||"many-to-many"===S?I:[I[0]]}_getTooltip({label:d,value:h,chartType:g}){return"pie-chart"===g?`${d}`:`${d}: ${h}`}_getChartOption(d){const{value:h,attributes:g,formattedAttributes:y,expressionAttributes:v,fieldName:b,relatedFieldName:M,fieldInfos:I,chartType:_,hasMultipleRelatedFeatures:E,color:P}=d,L=this.layer,S=this.fieldInfoMap??new Map,{normalizeField:$,tooltipField:B}=h,G=$?Qe($)?g[Nt($).fieldName]:g[$]:null,X=jt(b)&&v&&void 0!==v[b]?v[b]:M&&void 0!==g[M]?g[M]:void 0!==g[b]?g[b]:y[b],k=new Vs.Z({fieldName:b,color:P,value:void 0===X?null:X&&G?X/G:X});if(Qe(b)){const et=S.get(b.toLowerCase()),tt=B&&S.get(B.toLowerCase()),or=et?.fieldName??b,Ui=E&&B?Nt(B).fieldName:tt?.fieldName??B;return k.tooltip=this._getTooltip({label:E&&Ui?g[Ui]:y[Ui]??et?.label??et?.fieldName??M,value:E&&M?g[M]:y[or],chartType:_}),k}const le=Ji(I,b),se=Ct(b,L),be=B&&void 0!==y[B]?y[B]:Qi(le||new dn.Z({fieldName:se}),this.popupTemplate?.expressionInfos);return k.tooltip=this._getTooltip({label:be,value:y[se],chartType:_}),k}};(0,F._)([(0,w.Cb)()],pe.prototype,"abilities",void 0),(0,F._)([(0,Ue.p)("abilities")],pe.prototype,"castAbilities",null),(0,F._)([(0,w.Cb)()],pe.prototype,"activeMediaInfoIndex",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],pe.prototype,"activeMediaInfo",null),(0,F._)([(0,w.Cb)()],pe.prototype,"attributes",void 0),(0,F._)([(0,w.Cb)()],pe.prototype,"description",void 0),(0,F._)([(0,w.Cb)()],pe.prototype,"fieldInfoMap",void 0),(0,F._)([(0,w.Cb)()],pe.prototype,"formattedAttributes",void 0),(0,F._)([(0,w.Cb)()],pe.prototype,"expressionAttributes",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],pe.prototype,"formattedMediaInfos",null),(0,F._)([(0,w.Cb)()],pe.prototype,"isAggregate",void 0),(0,F._)([(0,w.Cb)()],pe.prototype,"layer",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],pe.prototype,"formattedMediaInfoCount",null),(0,F._)([(0,w.Cb)()],pe.prototype,"mediaInfos",void 0),(0,F._)([(0,w.Cb)()],pe.prototype,"popupTemplate",void 0),(0,F._)([(0,w.Cb)()],pe.prototype,"relatedInfos",void 0),(0,F._)([(0,w.Cb)()],pe.prototype,"title",void 0),pe=(0,F._)([(0,W.j)("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],pe);const lt=pe;var no=C(64183),Je=C(97059);const me="esri-feature-media",xe={base:me,mediaContainer:`${me}__container`,mediaItemContainer:`${me}__item-container`,mediaItem:`${me}__item`,mediaItemText:`${me}__item-text`,mediaItemTitle:`${me}__item-title`,mediaItemCaption:`${me}__item-caption`,mediaNavigation:`${me}__item-navigation`,mediaPagination:`${me}__pagination`,mediaPaginationText:`${me}__pagination-text`,mediaPrevious:`${me}__previous`,mediaPreviousIconLTR:`${me}__previous-icon`,mediaPreviousIconRTL:`${me}__previous-icon--rtl`,mediaNext:`${me}__next`,mediaNextIconLTR:`${me}__next-icon`,mediaNextIconRTL:`${me}__next-icon--rtl`,mediaChart:`${me}__chart`,mediaPaginationButton:`${me}__pagination-button`,mediaPaginationIcon:`${me}__pagination-icon`,mediaChartRendered:`${me}__chart--rendered`},nt="category",Mt="value";let Pe=class extends V.Z{constructor(d,h){var g;super(d,h),g=this,this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this._chartRootMap=new WeakMap,this.viewModel=new lt,this.messages=null,this._disposeChart=y=>{this._chartRootMap.get(y)?.dispose(),this._chartRootMap.delete(y)},this._createChart=function(){var y=(0,T.Z)(function*(v){const{destroyed:b,viewModel:M}=g;if(b||!M||!v)return;const{createRoot:I}=yield Promise.all([C.e(8670),C.e(8592),C.e(8230)]).then(C.bind(C,48230)),_=yield I(v);g._chartRootMap.set(v,_),g._renderChart({mediaInfo:M.activeMediaInfo,root:_})});return function(v){return y.apply(this,arguments)}}()}initialize(){this._featureElementInfo=new Pt,this.addHandles([(0,x.YP)(()=>[this.viewModel?.activeMediaInfo,this.viewModel?.activeMediaInfoIndex],()=>this._setupMediaRefreshTimer(),x.nn),(0,x.YP)(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),x.nn)])}loadDependencies(){return(0,gt.h)({icon:()=>Promise.all([C.e(6203),C.e(8472)]).then(C.bind(C,8472))})}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(d){this.viewModel.attributes=d}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(d){this.viewModel.activeMediaInfoIndex=d}get description(){return this.viewModel.description}set description(d){this.viewModel.description=d}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(d){this.viewModel.fieldInfoMap=d}get layer(){return this.viewModel.layer}set layer(d){this.viewModel.layer=d}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(d){this.viewModel.mediaInfos=d}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(d){this.viewModel.popupTemplate=d}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(d){this.viewModel.relatedInfos=d}get title(){return this.viewModel.title}set title(d){this.viewModel.title=d}render(){return(0,A.u)("div",{bind:this,class:xe.base,onkeyup:this._handleMediaKeyup},this._featureElementInfo?.render(),this._renderMedia())}_renderMedia(){const{formattedMediaInfoCount:d,activeMediaInfoIndex:h}=this.viewModel,g=this._renderMediaText();return d?(0,A.u)("div",{class:xe.mediaContainer,key:"media-element-container"},this._renderMediaInfo(),(0,A.u)("div",{class:xe.mediaNavigation},g,d>1?(0,A.u)("div",{class:xe.mediaPagination},this._renderMediaPageButton("previous"),(0,A.u)("span",{class:xe.mediaPaginationText},(0,Je.n)(this.messages.pageText,{index:h+1,total:d})),this._renderMediaPageButton("next")):null)):null}_renderMediaText(){const{activeMediaInfo:d}=this.viewModel;if(!d)return null;const h=d&&d.title?(0,A.u)("div",{class:xe.mediaItemTitle,innerHTML:d.title,key:"media-title"}):null,g=d&&d.caption?(0,A.u)("div",{class:xe.mediaItemCaption,innerHTML:d.caption,key:"media-caption"}):null;return h||g?(0,A.u)("div",{class:xe.mediaItemText,key:"media-text"},h,g):null}_renderImageMediaInfo(d){const{_refreshIntervalInfo:h}=this,{activeMediaInfoIndex:g,formattedMediaInfoCount:y}=this.viewModel,{value:v,refreshInterval:b,altText:M,title:I,type:_}=d,{sourceURL:E,linkURL:P}=v,L=Gi(P??void 0)?"_blank":"_self",S="_blank"===L?"noreferrer":"",$=b?h:null,X=(0,A.u)("img",{alt:M||I,key:`media-${_}-${g}-${y}-${$?$.timestamp:0}`,src:($?$.sourceURL:E)??void 0});return(P?(0,A.u)("a",{href:P,rel:S,target:L,title:I},X):null)??X}_renderChartMediaInfo(d){const{activeMediaInfoIndex:h,formattedMediaInfoCount:g}=this.viewModel;return(0,A.u)("div",{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:xe.mediaChart,key:`media-${d.type}-${h}-${g}`})}_renderMediaInfoType(){const{activeMediaInfo:d}=this.viewModel;return d?"image"===d.type?this._renderImageMediaInfo(d):d.type.includes("chart")?this._renderChartMediaInfo(d):null:null}_renderMediaInfo(){const{activeMediaInfo:d}=this.viewModel;return d?(0,A.u)("div",{class:xe.mediaItemContainer,key:"media-container"},(0,A.u)("div",{class:xe.mediaItem,key:"media-item-container"},this._renderMediaInfoType())):null}_renderMediaPageButton(d){if(this.viewModel.formattedMediaInfoCount<2)return null;const h="previous"===d,g=h?this.messages.previous:this.messages.next;return(0,A.u)("button",{"aria-label":g,bind:this,class:xe.mediaPaginationButton,key:h?"media-previous":"media-next",onclick:h?this._previous:this._next,tabIndex:0,title:g,type:"button"},(0,A.u)("calcite-icon",{class:xe.mediaPaginationIcon,icon:h?"chevron-left":"chevron-right",scale:"s"}))}_setupFeatureElementInfo(){const{description:d,title:h}=this;this._featureElementInfo?.set({description:d,title:h})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){if(!this.viewModel)return;const{isAggregate:d,layer:h}=this.viewModel;return d&&h?.featureReduction&&"renderer"in h.featureReduction?h.featureReduction.renderer:h?.renderer}_getSeriesColors(d){return(0,T.Z)(function*(){const{colorAm5:h}=yield Promise.all([C.e(8670),C.e(8592),C.e(3758)]).then(C.bind(C,3758)),g=new Map;return d.forEach(y=>{y.color&&g.set(y,h(y.color.toCss(!0)))}),g})()}_getRendererColors(){var d=this;return(0,T.Z)(function*(){const{colorAm5:h}=yield Promise.all([C.e(8670),C.e(8592),C.e(3758)]).then(C.bind(C,3758)),g=new Map,y=d._getRenderer();if(!y)return g;const b=yield(0,Zs.zB)(y);return b.delete("default"),Array.from(b.values()).every(M=>1===M?.length)&&Array.from(b.keys()).forEach(M=>{const I=b.get(M)?.[0]?.toCss(!0);I&&g.set(M,h(I))}),g})()}_handleMediaKeyup(d){const{key:h}=d;"ArrowLeft"===h&&(d.stopPropagation(),this.viewModel.previous()),"ArrowRight"===h&&(d.stopPropagation(),this.viewModel.next())}_canAnimateChart(){return!!this.viewModel&&!!this.viewModel.abilities.chartAnimation&&!window.matchMedia("(prefers-reduced-motion: reduce)").matches}_getChartAnimationMS(){return this._canAnimateChart()?250:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?500:0}_renderChart(d){var h=this;return(0,T.Z)(function*(){const{root:g,mediaInfo:y}=d,{value:v,type:b}=y,{ResponsiveThemeAm5:M,DarkThemeAm5:I,AnimatedThemeAm5:_,ColorSetAm5:E,ThemeAm5:P,esriChartColorSet:L}=yield Promise.all([C.e(8670),C.e(8592),C.e(3758)]).then(C.bind(C,3758)),S=P.new(g);S.rule("ColorSet").set("colors",L),S.rule("ColorSet").set("reuse",!0);const $=[M.new(g),S];(0,no.$o)()&&$.push(I.new(g)),h._canAnimateChart()&&$.push(_.new(g)),g.setThemes($);const B=yield h._getRendererColors(),G=yield h._getSeriesColors(v.series),X=E.new(g,{}),k=G.get(v.series[0]),le=k?{lineSettings:{stroke:k}}:void 0,se=v.series.map((be,Et)=>{const et=G.get(be)||B.get(be.fieldName)||X.getIndex(Et);return{[nt]:be.tooltip,[Mt]:be.value,columnSettings:{fill:et,stroke:et},...le}}).filter(be=>"pie-chart"!==b||null!=be.value&&be.value>0);"pie-chart"===b?h._createPieChart(d,se):h._createXYChart(d,se)})()}_getDirection(){return(0,Be.dZ)(this.container)?"rtl":"ltr"}_isInversed(){return!!(0,Be.dZ)(this.container)}_customizeChartTooltip(d,h="horizontal"){var g=this;return(0,T.Z)(function*(){const{colorAm5:y}=yield Promise.all([C.e(8670),C.e(8592),C.e(3758)]).then(C.bind(C,3758));d.setAll({pointerOrientation:h}),d.get("background")?.setAll({stroke:y("rgba(50, 50, 50, 1)")}),d.label.setAll({direction:g._getDirection(),oversizedBehavior:"wrap",maxWidth:200})})()}_createPieChart(d,h){var g=this;return(0,T.Z)(function*(){const{TooltipAm5:y}=yield Promise.all([C.e(8670),C.e(8592),C.e(3758)]).then(C.bind(C,3758)),{PieChartAm5:v,PieSeriesAm5:b}=yield Promise.all([C.e(8670),C.e(7254),C.e(8619)]).then(C.bind(C,58619)),{mediaInfo:M,root:I}=d,{title:_}=M,L=I.container.children.push(v.new(I,{ariaLabel:M?.altText||M?.title||"",focusable:!0,paddingBottom:5,paddingTop:5,paddingLeft:5,paddingRight:5})),S="{category}: {valuePercentTotal.formatNumber('0.00')}%\n ({value})",$=y.new(I,{labelText:S}),B=L.series.push(b.new(I,{name:_,valueField:Mt,categoryField:nt,tooltip:$}));B.ticks.template.set("forceHidden",!0),B.labels.template.set("forceHidden",!0),B.slices.template.states.create("active",{shiftRadius:5}),g._customizeChartTooltip($),B.slices.template.setAll({ariaLabel:S,focusable:!0,templateField:"columnSettings"}),B.data.setAll(h),B.appear(g._getChartSeriesAnimationMS()),L.appear(g._getChartAnimationMS()),L.root.dom.classList.toggle(xe.mediaChartRendered,!0)})()}_getMinSeriesValue(d){let h=0;return d.forEach(g=>h=Math.min(g.value,h)),h}_createColumnChart(d,h,g){var y=this;return(0,T.Z)(function*(){const{TooltipAm5:v,ScrollbarAm5:b}=yield Promise.all([C.e(8670),C.e(8592),C.e(3758)]).then(C.bind(C,3758)),{CategoryAxisAm5:M,AxisRendererXAm5:I,ValueAxisAm5:_,AxisRendererYAm5:E,ColumnSeriesAm5:P}=yield Promise.all([C.e(8670),C.e(7254),C.e(8592),C.e(8725)]).then(C.bind(C,88725)),{mediaInfo:L,root:S}=h,{value:$,title:B}=L;d.setAll({wheelX:"panX",wheelY:"zoomX"});const G=d.xAxes.push(M.new(S,{renderer:I.new(S,{inversed:y._isInversed()}),categoryField:nt}));G.get("renderer").labels.template.setAll({forceHidden:!0});const X=d.yAxes.push(_.new(S,{renderer:E.new(S,{inside:!1}),min:y._getMinSeriesValue($.series)}));X.get("renderer").labels.template.setAll({direction:y._getDirection()});const k="{categoryX}",le=v.new(S,{labelText:k}),se=d.series.push(P.new(S,{name:B,xAxis:G,yAxis:X,valueYField:Mt,categoryXField:nt,tooltip:le}));y._customizeChartTooltip(le),se.columns.template.setAll({ariaLabel:k,focusable:!0,templateField:"columnSettings"}),$.series.length>15&&d.set("scrollbarX",b.new(S,{orientation:"horizontal"})),G.data.setAll(g),se.data.setAll(g),se.appear(y._getChartSeriesAnimationMS()),d.appear(y._getChartAnimationMS())})()}_createBarChart(d,h,g){var y=this;return(0,T.Z)(function*(){const{TooltipAm5:v,ScrollbarAm5:b}=yield Promise.all([C.e(8670),C.e(8592),C.e(3758)]).then(C.bind(C,3758)),{CategoryAxisAm5:M,AxisRendererXAm5:I,ValueAxisAm5:_,AxisRendererYAm5:E,ColumnSeriesAm5:P}=yield Promise.all([C.e(8670),C.e(7254),C.e(8592),C.e(8725)]).then(C.bind(C,88725)),{mediaInfo:L,root:S}=h,{value:$,title:B}=L;d.setAll({wheelX:"panY",wheelY:"zoomY"});const G=d.yAxes.push(M.new(S,{renderer:E.new(S,{inversed:!0}),categoryField:nt}));G.get("renderer").labels.template.setAll({forceHidden:!0});const X=d.xAxes.push(_.new(S,{renderer:I.new(S,{inside:!1,inversed:y._isInversed()}),min:y._getMinSeriesValue($.series)}));X.get("renderer").labels.template.setAll({direction:y._getDirection()});const k="{categoryY}",le=v.new(S,{labelText:k}),se=d.series.push(P.new(S,{name:B,xAxis:X,yAxis:G,valueXField:Mt,categoryYField:nt,tooltip:le}));y._customizeChartTooltip(le,"vertical"),se.columns.template.setAll({ariaLabel:k,focusable:!0,templateField:"columnSettings"}),$.series.length>15&&d.set("scrollbarY",b.new(S,{orientation:"vertical"})),G.data.setAll(g),se.data.setAll(g),se.appear(y._getChartSeriesAnimationMS()),d.appear(y._getChartAnimationMS())})()}_createLineChart(d,h,g){var y=this;return(0,T.Z)(function*(){const{TooltipAm5:v,ScrollbarAm5:b}=yield Promise.all([C.e(8670),C.e(8592),C.e(3758)]).then(C.bind(C,3758)),{CategoryAxisAm5:M,AxisRendererXAm5:I,ValueAxisAm5:_,AxisRendererYAm5:E,LineSeriesAm5:P}=yield Promise.all([C.e(8670),C.e(7254),C.e(8592),C.e(8725)]).then(C.bind(C,88725)),{root:L,mediaInfo:S}=h,{value:$,title:B}=S;d.setAll({wheelX:"panX",wheelY:"zoomX"});const G=d.xAxes.push(M.new(L,{renderer:I.new(L,{inversed:y._isInversed()}),categoryField:nt}));G.get("renderer").labels.template.setAll({forceHidden:!0});const X=d.yAxes.push(_.new(L,{renderer:E.new(L,{inside:!1}),min:y._getMinSeriesValue($.series)}));X.get("renderer").labels.template.setAll({direction:y._getDirection()});const le=g[0]?.lineSettings?.stroke,se=v.new(L,{getFillFromSprite:!le,labelText:"{categoryX}"});le&&se.get("background")?.setAll({fill:le});const be=d.series.push(P.new(L,{name:B,xAxis:G,yAxis:X,valueYField:Mt,categoryXField:nt,tooltip:se}));be.strokes.template.setAll({templateField:"lineSettings"}),y._customizeChartTooltip(se,"vertical"),$.series.length>15&&d.set("scrollbarX",b.new(L,{orientation:"horizontal"})),G.data.setAll(g),be.data.setAll(g),be.appear(y._getChartSeriesAnimationMS()),d.appear(y._getChartAnimationMS())})()}_createXYChart(d,h){var g=this;return(0,T.Z)(function*(){const{XYChartAm5:y,XYCursorAm5:v}=yield Promise.all([C.e(8670),C.e(7254),C.e(8592),C.e(8725)]).then(C.bind(C,88725)),{root:b,mediaInfo:M}=d,{type:I}=M,E=b.container.children.push(y.new(b,{ariaLabel:M?.altText||M?.title||"",focusable:!0,panX:!0,panY:!0}));E.set("cursor",v.new(b,{})),"column-chart"===I&&(yield g._createColumnChart(E,d,h)),"bar-chart"===I&&(yield g._createBarChart(E,d,h)),"line-chart"===I&&(yield g._createLineChart(E,d,h)),E.root.dom.classList.toggle(xe.mediaChartRendered,!0)})()}_clearMediaRefreshTimer(){const{_refreshTimer:d}=this;d&&(clearTimeout(d),this._refreshTimer=null)}_updateMediaInfoTimestamp(d){const h=Date.now();this._refreshIntervalInfo={timestamp:h,sourceURL:d&&this._getImageSource(d,h)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:d}=this.viewModel;d&&"image"===d.type&&d.refreshInterval&&this._setRefreshTimeout(d)}_setRefreshTimeout(d){const{refreshInterval:h,value:g}=d;if(!h)return;const y=6e4*h;this._updateMediaInfoTimestamp(g.sourceURL);const v=setInterval(()=>{this._updateMediaInfoTimestamp(g.sourceURL)},y);this._refreshTimer=v}_getImageSource(d,h){const g=d.includes("?")?"&":"?",[y,v=""]=d.split("#");return`${y}${g}timestamp=${h}${v?"#":""}${v}`}};(0,F._)([(0,w.Cb)()],Pe.prototype,"_refreshIntervalInfo",void 0),(0,F._)([(0,w.Cb)()],Pe.prototype,"attributes",null),(0,F._)([(0,w.Cb)()],Pe.prototype,"activeMediaInfoIndex",null),(0,F._)([(0,w.Cb)()],Pe.prototype,"description",null),(0,F._)([(0,w.Cb)()],Pe.prototype,"fieldInfoMap",null),(0,F._)([(0,w.Cb)()],Pe.prototype,"layer",null),(0,F._)([(0,w.Cb)()],Pe.prototype,"mediaInfos",null),(0,F._)([(0,w.Cb)()],Pe.prototype,"popupTemplate",null),(0,F._)([(0,w.Cb)()],Pe.prototype,"relatedInfos",null),(0,F._)([(0,w.Cb)()],Pe.prototype,"title",null),(0,F._)([(0,w.Cb)({type:lt})],Pe.prototype,"viewModel",void 0),(0,F._)([(0,w.Cb)(),(0,Ze.H)("esri/widgets/Feature/t9n/Feature")],Pe.prototype,"messages",void 0),Pe=(0,F._)([(0,W.j)("esri.widgets.Feature.FeatureMedia")],Pe);const mn=Pe;C(55664),C(55013),C(16615),C(82561);var lo=C(75484),uo=C(64531),fn=(C(6785),C(501)),co=C(38159),ho=C(80415);const gn=()=>K.Z.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");function mo(d){return"string"==typeof d?Ft(Kt(d)):Array.isArray(d)?function fo(d){return`<ul class="esri-widget__list">${d.map(h=>`<li>${"string"==typeof h?Ft(Kt(h)):h}</li>`).join("")}</ul>`}(d):"esri.arcade.Dictionary"===d?.declaredClass?function go(d){const h=d.keys().map(g=>{const y=d.field(g);return`<tr><th>${g}</th><td>${"string"==typeof y?Ft(Kt(y)):y}</td></tr>`}).join("");return`<table class="${Y.z.table}">${h}</table>`}(d):d}function yn(){return Promise.all([C.e(337),C.e(8592),C.e(5778)]).then(C.bind(C,65778))}function vo(d){return fi.apply(this,arguments)}function fi(){return(fi=(0,T.Z)(function*({graphic:d,view:h,options:g}){const{isAggregate:y,layer:v}=d;if(!y||!v||"2d"!==h?.type)return[];const b=yield h.whenLayerView(v);if(!function yo(d){return"createQuery"in d&&"queryFeatures"in d}(b))return[];const M=b.createQuery(),I=d.getObjectId();M.aggregateIds=null!=I?[I]:[];const{features:_}=yield b.queryFeatures(M,g);return _})).apply(this,arguments)}function vn(d){return gi.apply(this,arguments)}function gi(){return(gi=(0,T.Z)(function*({expressionInfo:d,arcade:h,interceptor:g,spatialReference:y,map:v,graphic:b,location:M,view:I,options:_}){if(!d?.expression)return null;const{isAggregate:E}=b,P=(b.sourceLayer||b.layer)??void 0,L=E?"feature-reduction-popup":"popup",S=h.createArcadeProfile(L),$=h.createArcadeExecutor(d.expression,S).catch(se=>gn().error("arcade-executor-error",{error:se,expressionInfo:d})),[B,G]=yield Promise.all([vo({graphic:b,view:I,options:_}),$]);if(!G)return null;const X="feature-reduction-popup"===L?function bo({layer:d,aggregatedFeatures:h,interceptor:g}){const{fields:y,objectIdField:v,geometryType:b,spatialReference:M,displayField:I}=d;return new ho.default({fields:y,objectIdField:v,geometryType:b,spatialReference:M,displayField:I,interceptor:g,..."feature"===d.type?{templates:d.templates,typeIdField:d.typeIdField,types:d.types}:null,source:h})}({layer:P,aggregatedFeatures:B,interceptor:g}):void 0,k={..."feature-reduction-popup"===L?{$aggregatedFeatures:X}:{$datastore:P?.url,$layer:"feature"===P?.type||"subtype-sublayer"===P?.type?P:"scene"===P?.type&&null!=P.associatedLayer?P.associatedLayer:void 0,$map:v,$userInput:M,$graph:"knowledge-graph-sublayer"===P?.type?P?.parentCompositeLayer?.knowledgeGraph:void 0},$feature:b},le={abortSignal:_?.signal??void 0,interceptor:g??void 0,rawOutput:!0,spatialReference:y??void 0,timeZone:I?.timeZone};return yield G.executeAsync(k,le).catch(se=>gn().error("arcade-execution-error",{error:se,graphic:b,expressionInfo:d})).finally(()=>X?.destroy())})).apply(this,arguments)}function Co(d){return yi.apply(this,arguments)}function yi(){return(yi=(0,T.Z)(function*({expressionInfos:d,spatialReference:h,graphic:g,interceptor:y,map:v,view:b,location:M,options:I}){if(!d?.length)return{};const _=yield yn(),E={};for(const S of d)E[`expression/${S.name}`]=vn({expressionInfo:S,arcade:_,interceptor:y,spatialReference:h,map:v,graphic:g,location:M,view:b,options:I});const P=yield(0,he.as)(E),L={};for(const S in P)L[S]=mo(P[S].value);return L})).apply(this,arguments)}let Le=class extends R.Z{constructor(d){var h;super(d),h=this,this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.location=null,this.view=null,this._cancelQuery=()=>{const{_abortController:g}=this;g&&g.abort(),this._abortController=null},this._createVM=()=>{const g=this.contentElement?.type;this.contentElementViewModel?.destroy();const y="fields"===g?new Ot:"media"===g?new lt:"text"===g?new Tt:null;this._set("contentElementViewModel",y)},this._compile=(0,T.Z)(function*(){h._cancelQuery();const g=new AbortController;h._abortController=g,yield h._compileExpression(),h._abortController===g&&(h._abortController=null)}),this._compileThrottled=we(this._compile,1,this),this._compileExpression=(0,T.Z)(function*(){const{expressionInfo:g,graphic:y,interceptor:v,spatialReference:b,map:M,location:I,view:_,_abortController:E}=h;if(!g||!y)return void h._set("contentElement",null);const P=yield yn();if(E!==h._abortController)return;const L=yield vn({arcade:P,expressionInfo:g,graphic:y,location:I,interceptor:v,map:M,spatialReference:b,view:_});if(!L||"esri.arcade.Dictionary"!==L.declaredClass)return void h._set("contentElement",null);const S=yield L.castAsJsonAsync(E?.signal),$=S?.type,B="media"===$?uo.Z.fromJSON(S):"text"===$?fn.Z.fromJSON(S):"fields"===$?lo.Z.fromJSON(S):null;h._set("contentElement",B)}),this.addHandles([(0,x.YP)(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),x.nn),(0,x.YP)(()=>[this.contentElement],()=>this._createVM(),x.nn)])}initialize(){this.addHandles(this._compileThrottled)}destroy(){this._cancelQuery(),this.contentElementViewModel?.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(d){this._override("spatialReference",d)}get state(){const{_abortController:d,contentElement:h,contentElementViewModel:g}=this;return d?"loading":h||g?"ready":"disabled"}get map(){return this.view?.map??null}set map(d){this._override("map",d)}};(0,F._)([(0,w.Cb)()],Le.prototype,"_abortController",void 0),(0,F._)([(0,w.Cb)({type:co.Z})],Le.prototype,"expressionInfo",void 0),(0,F._)([(0,w.Cb)({type:O.Z})],Le.prototype,"graphic",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],Le.prototype,"contentElement",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],Le.prototype,"contentElementViewModel",void 0),(0,F._)([(0,w.Cb)()],Le.prototype,"interceptor",void 0),(0,F._)([(0,w.Cb)({type:ui.Z})],Le.prototype,"location",void 0),(0,F._)([(0,w.Cb)()],Le.prototype,"spatialReference",null),(0,F._)([(0,w.Cb)({readOnly:!0})],Le.prototype,"state",null),(0,F._)([(0,w.Cb)()],Le.prototype,"map",null),(0,F._)([(0,w.Cb)()],Le.prototype,"view",void 0),Le=(0,F._)([(0,W.j)("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],Le);const vi=Le,bi="esri-feature",Ci={base:`${bi}-expression`,loadingSpinnerContainer:`${bi}__loading-container`,spinner:`${bi}__loading-spinner`};let $t=class extends V.Z{constructor(d,h){super(d,h),this._contentWidget=null,this.viewModel=new vi}initialize(){this.addHandles((0,x.YP)(()=>this.viewModel?.contentElementViewModel,()=>this._setupExpressionWidget(),x.nn))}destroy(){this._destroyContentWidget()}render(){const{state:d}=this.viewModel;return(0,A.u)("div",{class:Ci.base},"loading"===d?this._renderLoading():"disabled"===d?null:this._contentWidget?.render())}_renderLoading(){return(0,A.u)("div",{class:Ci.loadingSpinnerContainer,key:"loading-container"},(0,A.u)("span",{class:this.classes(Ve.W.loadingIndicator,Y.z.rotating,Ci.spinner)}))}_destroyContentWidget(){const{_contentWidget:d}=this;d&&(d.viewModel=null,d.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:d,contentElement:h}=this.viewModel,g=h?.type;this._destroyContentWidget();const y=d?"fields"===g?new un({viewModel:d}):"media"===g?new mn({viewModel:d}):"text"===g?new Rt({viewModel:d}):null:null;this._contentWidget=y,this.scheduleRender()}};(0,F._)([(0,w.Cb)({type:vi})],$t.prototype,"viewModel",void 0),$t=(0,F._)([(0,W.j)("esri.widgets.Feature.FeatureExpression")],$t);const wo=$t;var Fi,Mo=C(62208),Io=C(79608),bn=C(61996);C(94573),C(50749),C(47277),(Fi||(Fi={})).TOO_SHORT="length-validation-error::too-short";const Ro=d=>{const h=[];if(d.formTemplate){const{description:g,title:y}=d.formTemplate;d.fields?.forEach(v=>{const b=y&&(0,U.pZ)(y,v.name),M=g&&(0,U.pZ)(g,v.name);(b||M)&&h.push(v.name)})}return h};let re=class extends((0,Io.J)((0,bn.IG)(R.Z))){constructor(d){var h;super(d),h=this,this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:g}=this;g&&g.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:g}=this;g&&g.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:g}=this;g&&g.abort(),this._queryPageAbortController=null},this._queryController=(0,T.Z)(function*(){h._cancelQuery();const g=new AbortController;h._queryAbortController=g,yield(0,he.R8)(h._query()),h._queryAbortController===g&&(h._queryAbortController=null)}),this._queryFeatureCountController=(0,T.Z)(function*(){h._loaded=!1,h._cancelQueryFeatureCount();const g=new AbortController;h._queryFeatureCountAbortController=g,yield(0,he.R8)(h._queryFeatureCount()),h._queryFeatureCountAbortController===g&&(h._queryFeatureCountAbortController=null),h._loaded=!0}),this._queryPageController=(0,T.Z)(function*(){const g=new AbortController;h._queryPageAbortController=g,yield(0,he.R8)(h._queryPage()),h._queryPageAbortController===g&&(h._queryPageAbortController=null)}),this._queryDebounced=(0,he.Ds)(this._queryController,100),this._queryFeatureCountDebounced=(0,he.Ds)(this._queryFeatureCountController,100),this._queryPageDebounced=(0,he.Ds)(this._queryPageController,100),this._query=(0,T.Z)(function*(){const{_queryAbortController:g,relatedFeatures:y}=h;h.featureCount&&(h._destroyRelatedFeatureViewModels(),h.featurePage=1,y.removeAll(),h.destroyed||y.addMany(h._sliceFeatures(yield h._queryRelatedFeatures({signal:g?.signal}))))}),this.addHandles([(0,x.YP)(()=>[this.displayCount,this.graphic,this.layer,this.layer?.loaded,this.map,this.orderByFields,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount],()=>this._queryDebounced(),x.nn),(0,x.YP)(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageDebounced()),(0,x.YP)(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery],()=>this._queryFeatureCountDebounced())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.removeAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(d){const{featuresPerPage:h,featureCount:g}=this,v=Math.ceil(g/h)||1;this._set("featurePage",Math.min(Math.max(d,1),v))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:d,relatedLayer:h}=this;return d&&h?.loaded?d.map(g=>{const y=g.clone();return y.field=Ct(g.field,h),y}):d??[]}get supportsCacheHint(){return!!this.layer?.capabilities?.queryRelated?.supportsCacheHint}get canLoad(){return!!this.map&&"number"==typeof this.relationshipId&&"number"==typeof this.objectId}get canQuery(){const d=this.layer?.capabilities?.queryRelated;return!!(this.relatedLayer&&this.relationship&&"number"==typeof this.relationshipId&&"number"==typeof this.objectId&&d?.supportsCount&&d?.supportsPagination)}get itemDescriptionFieldName(){return this.orderByFieldsFixedCasing[0]?.field||null}set displayCount(d){this._set("displayCount",Math.min(Math.max(d,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){return(this.objectIdField&&this.graphic?.attributes?.[this.objectIdField])??null}get objectIdField(){return this.layer?.objectIdField||null}get relatedFeatures(){return this._get("relatedFeatures")||new oe.Z}get relatedLayer(){const{layer:d,map:h,relationship:g}=this;return d?.loaded&&h&&g?function Es(d,h,g){return d&&h&&g?sn(d.allLayers,h,g)||sn(d.allTables,h,g):null}(h,d,g)??null:null}get relationship(){const{relationshipId:d,layer:h}=this;return"number"==typeof d?h?.relationships?.find(({id:g})=>g===d)??null:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new oe.Z}get state(){const{_queryAbortController:d,_queryFeatureCountAbortController:h,_queryPageAbortController:g,canQuery:y,_loaded:v,canLoad:b}=this;return h||b&&!v?"loading":d||g?"querying":y?"ready":"disabled"}getRelatedFeatureByObjectId(d){return this.relatedFeatures.find(h=>h.getObjectId()===d)}refresh(){this._queryFeatureCountDebounced()}_destroyRelatedFeatureViewModels(){this.relatedFeatureViewModels?.forEach(d=>!d.destroyed&&d.destroy()),this.relatedFeatureViewModels.removeAll()}_queryFeatureCount(){var d=this;return(0,T.Z)(function*(){const{layer:h,relatedLayer:g,relationshipId:y,objectId:v,_queryFeatureCountAbortController:b,canQuery:M,supportsCacheHint:I}=d;if(yield h?.load(),yield g?.load(),!M||!h||!g)return void d._set("featureCount",0);const _=g.createQuery(),E=new hi.default({cacheHint:I,relationshipId:y,returnGeometry:!1,objectIds:[v],where:_.where??void 0}),P=yield h.queryRelatedFeaturesCount(E,{signal:b?.signal});d._set("featureCount",P[v]||0)})()}_sliceFeatures(d){const{showAllEnabled:h,displayCount:g}=this;return h?d:g?d.slice(0,g):[]}_queryPage(){var d=this;return(0,T.Z)(function*(){const{relatedFeatures:h,featurePage:g,showAllEnabled:y,_queryPageAbortController:v,featureCount:b}=d;!y||g<2||!b||h.addMany(yield d._queryRelatedFeatures({signal:v?.signal}))})()}_queryRelatedFeatures(d){var h=this;return(0,T.Z)(function*(){const{orderByFieldsFixedCasing:g,showAllEnabled:y,featuresPerPage:v,displayCount:b,layer:M,relationshipId:I,featurePage:_,featureCount:E,relatedLayer:P,supportsCacheHint:L}=h,{canQuery:S,objectId:$}=h;if(!S||!M||!P)return[];const B=y?((_-1)*v+E)%E:0,G=y?v:b,X=P.objectIdField,k=[...g.map(tt=>tt.field),...Ro(P),X].filter(bt.pC),le=g.map(tt=>`${tt.field} ${tt.order}`),se=P.createQuery(),be=new hi.default({orderByFields:le,start:B,num:G,outFields:k,cacheHint:L,relationshipId:I,returnGeometry:!1,objectIds:[$],where:se.where??void 0}),et=(yield M.queryRelatedFeatures(be,{signal:d?.signal}))[$]?.features||[];return et.forEach(tt=>{tt.sourceLayer=P,tt.layer=P}),et})()}};(0,F._)([(0,w.Cb)()],re.prototype,"_loaded",void 0),(0,F._)([(0,w.Cb)()],re.prototype,"_queryAbortController",void 0),(0,F._)([(0,w.Cb)()],re.prototype,"_queryPageAbortController",void 0),(0,F._)([(0,w.Cb)()],re.prototype,"_queryFeatureCountAbortController",void 0),(0,F._)([(0,w.Cb)({value:1})],re.prototype,"featurePage",null),(0,F._)([(0,w.Cb)()],re.prototype,"featuresPerPage",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],re.prototype,"orderByFieldsFixedCasing",null),(0,F._)([(0,w.Cb)({readOnly:!0})],re.prototype,"supportsCacheHint",null),(0,F._)([(0,w.Cb)({readOnly:!0})],re.prototype,"canLoad",null),(0,F._)([(0,w.Cb)({readOnly:!0})],re.prototype,"canQuery",null),(0,F._)([(0,w.Cb)()],re.prototype,"description",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],re.prototype,"itemDescriptionFieldName",null),(0,F._)([(0,w.Cb)({value:3})],re.prototype,"displayCount",null),(0,F._)([(0,w.Cb)({type:O.Z})],re.prototype,"graphic",void 0),(0,F._)([(0,w.Cb)()],re.prototype,"layer",void 0),(0,F._)([(0,w.Cb)()],re.prototype,"map",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],re.prototype,"objectId",null),(0,F._)([(0,w.Cb)({readOnly:!0})],re.prototype,"objectIdField",null),(0,F._)([(0,w.Cb)()],re.prototype,"orderByFields",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],re.prototype,"relatedFeatures",null),(0,F._)([(0,w.Cb)({readOnly:!0})],re.prototype,"relatedLayer",null),(0,F._)([(0,w.Cb)({readOnly:!0})],re.prototype,"relationship",null),(0,F._)([(0,w.Cb)()],re.prototype,"featureCount",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],re.prototype,"relatedFeatureViewModels",null),(0,F._)([(0,w.Cb)()],re.prototype,"relationshipId",void 0),(0,F._)([(0,w.Cb)()],re.prototype,"showAllEnabled",void 0),(0,F._)([(0,w.Cb)()],re.prototype,"state",null),(0,F._)([(0,w.Cb)()],re.prototype,"title",void 0),re=(0,F._)([(0,W.j)("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],re);const Mi=re,It="esri-feature",_t=`${It}-relationship`,Xe={base:_t,listContainer:`${_t}__list`,listItem:`${_t}__list-item`,listItemHidden:`${_t}__list-item--hidden`,listContainerQuerying:`${_t}__list--querying`,featureObserver:`${It}__feature-observer`,stickySpinnerContainer:`${It}__sticky-loading-container`,loadingSpinnerContainer:`${It}__loading-container`,spinner:`${It}__loading-spinner`},An={title:!0,description:!0};let Te=class extends V.Z{constructor(d,h){super(d,h),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([g])=>{g?.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.headingLevel=2,this.viewModel=new Mi,this.messages=null,this.messagesCommon=null,this.visibleElements={...An},this._increaseFeaturePage=()=>{const{state:g,showAllEnabled:y,relatedFeatures:v,featuresPerPage:b,featurePage:M}=this.viewModel;"ready"===g&&y&&v.length>=b*M&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new Pt,this.addHandles([(0,x.YP)(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),x.nn),(0,x.YP)(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),(0,x.on)(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return(0,gt.h)({icon:()=>Promise.all([C.e(6203),C.e(8472)]).then(C.bind(C,8472)),list:()=>Promise.all([C.e(6203),C.e(6554),C.e(9909),C.e(3560),C.e(8592),C.e(9208)]).then(C.bind(C,69208)),"list-item":()=>Promise.all([C.e(6203),C.e(6554),C.e(8346),C.e(8592),C.e(4141)]).then(C.bind(C,94141)),notice:()=>Promise.all([C.e(6203),C.e(6554),C.e(8592),C.e(1278)]).then(C.bind(C,31278))})}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=(0,Mo.SC)(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:d,featureCount:h,displayCount:g,state:y}=this.viewModel;return!d&&!!h&&"ready"===y&&(h>g||0===g)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(d){this.viewModel.description=d}get featureCountDescription(){const{messages:d}=this,{featureCount:h}=this.viewModel;return(0,Je.n)(d?.numberRecords,{number:h})}get title(){return this.viewModel.title}set title(d){this.viewModel.title=d}castVisibleElements(d){return{...An,...d}}render(){const{state:d}=this.viewModel;return(0,A.u)("div",{class:this.classes(Xe.base,Y.z.widget)},this._featureElementInfo?.render(),"loading"===d?this._renderLoading():"disabled"===d?this._renderRelationshipNotFound():this._renderRelatedFeatures())}_renderStickyLoading(){return"querying"===this.viewModel.state?(0,A.u)("div",{class:Xe.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return(0,A.u)("span",{class:this.classes(Ve.W.loadingIndicator,Y.z.rotating,Xe.spinner)})}_renderLoading(){return(0,A.u)("div",{class:Xe.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderShowAllIconNode(){return(0,A.u)("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})}_renderChevronIconNode(){const d=(0,Be.dZ)(this.container)?"chevron-left":"chevron-right";return(0,A.u)("calcite-icon",{icon:d,scale:"s",slot:"content-end"})}_renderRelatedFeature(d){const{itemDescriptionFieldName:h}=this.viewModel,g=d.title;return d.description=h&&d.formattedAttributes?.global[h],(0,A.u)("calcite-list-item",{class:this.classes(Xe.listItem,{[Xe.listItemHidden]:"loading"===d.state}),description:d.description??"",key:d.uid,label:g,onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:d})},this._renderChevronIconNode())}_renderShowAllListItem(){return this.displayShowAllButton?(0,A.u)("calcite-list-item",{description:this.featureCountDescription,key:"show-all-item",label:this.messages?.showAll,onCalciteListItemSelect:()=>this.emit("show-all-records")},this._renderShowAllIconNode()):null}_renderNoRelatedFeaturesMessage(){return(0,A.u)("calcite-notice",{icon:"information",key:"no-related-features-message",kind:"brand",open:!0,scale:"s",width:"full"},(0,A.u)("div",{slot:"message"},this.messages?.noRelatedFeatures))}_renderFeatureObserver(){return(0,A.u)("div",{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:Xe.featureObserver,key:"feature-observer"})}_renderList(){const{relatedFeatureViewModels:d}=this.viewModel;return(0,A.u)("calcite-list",null,d.toArray().map(h=>this._renderRelatedFeature(h)),this._renderShowAllListItem())}_renderRelatedFeatures(){const{displayListItems:d}=this,{state:h}=this.viewModel;return(0,A.u)("div",{class:this.classes(Xe.listContainer,{[Xe.listContainerQuerying]:"querying"===h}),key:"list-container"},d?this._renderList():"ready"===h?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}_renderRelationshipNotFound(){return(0,A.u)("calcite-notice",{icon:"exclamation-mark-triangle",key:"relationship-not-found",kind:"danger",open:!0,scale:"s",width:"full"},(0,A.u)("div",{slot:"message"},this.messages?.relationshipNotFound))}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:d}=this.viewModel,h="related-feature-viewmodels";this.removeHandles(h),d?.forEach(g=>{this.addHandles((0,x.YP)(()=>[g.title,g.state],()=>this.scheduleRender(),x.nn),h)}),this.scheduleRender()}_setupFeatureElementInfo(){const{headingLevel:d,visibleElements:h}=this;this._featureElementInfo?.set({description:h.description&&this.description,title:h.title&&this.title,headingLevel:d})}_handleRelatedFeatureObserverChange(){var d=this;return(0,T.Z)(function*(){d._unobserveRelatedFeatureObserver();const{state:h,showAllEnabled:g}=d.viewModel;yield(0,he.e4)(0),d._relatedFeatureIntersectionObserverNode&&"ready"===h&&g&&d._relatedFeatureIntersectionObserver.observe(d._relatedFeatureIntersectionObserverNode)})()}_relatedFeatureIntersectionObserverCreated(d){this._relatedFeatureIntersectionObserverNode=d}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};(0,F._)([(0,w.Cb)()],Te.prototype,"_relatedFeatureIntersectionObserverNode",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],Te.prototype,"displayShowAllButton",null),(0,F._)([(0,w.Cb)({readOnly:!0})],Te.prototype,"displayListItems",null),(0,F._)([(0,w.Cb)()],Te.prototype,"description",null),(0,F._)([(0,w.Cb)({readOnly:!0})],Te.prototype,"featureCountDescription",null),(0,F._)([(0,w.Cb)()],Te.prototype,"headingLevel",void 0),(0,F._)([(0,w.Cb)()],Te.prototype,"title",null),(0,F._)([(0,w.Cb)({type:Mi})],Te.prototype,"viewModel",void 0),(0,F._)([(0,w.Cb)(),(0,Ze.H)("esri/widgets/Feature/t9n/Feature")],Te.prototype,"messages",void 0),(0,F._)([(0,w.Cb)(),(0,Ze.H)("esri/t9n/common")],Te.prototype,"messagesCommon",void 0),(0,F._)([(0,w.Cb)()],Te.prototype,"visibleElements",void 0),(0,F._)([(0,Ue.p)("visibleElements")],Te.prototype,"castVisibleElements",null),Te=(0,F._)([(0,W.j)("esri.widgets.Feature.FeatureRelationship")],Te);const En=Te;var At;const xn="content-view-models",Pn="relationship-view-models",Tn={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0};let ae=At=class extends((0,bn.IG)(R.Z)){constructor(d){super(d),this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=we(this._graphicChanged,1,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...Tn},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.location=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=h=>{const{abilities:g}=this;return"attachments"===h.type&&!!g.attachmentsContent||"custom"===h.type&&!!g.customContent||"fields"===h.type&&!!g.fieldsContent||"media"===h.type&&!!g.mediaContent||"text"===h.type&&!!g.textContent||"expression"===h.type&&!!g.expressionContent||"relationship"===h.type&&!!g.relationshipContent},this.addHandles((0,x.YP)(()=>[this.graphic,this._effectivePopupTemplate,this.abilities,this.timeZone],()=>this._graphicChangedThrottled(),x.nn))}initialize(){this.addHandles(this._graphicChangedThrottled)}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return null!=this.graphic?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return function Cs(d,h){const g=new Map;return d&&d.forEach(y=>{const v=Ct(y.fieldName,h);y.fieldName=v,g.set(v.toLowerCase(),y)}),g}(Xi(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return Yi(this.graphic)}castAbilities(d){return{...Tn,...d}}get isTable(){return this._sourceLayer?.isTable||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(d){this._set("graphic",d?.clone()??null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(d){this._override("spatialReference",d)}get timeZone(){return this.view?.timeZone??Bi.By}set timeZone(d){this._overrideIfSome("timeZone",d)}get map(){return this.view?.map||null}set map(d){this._override("map",d)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(d,h){const g=this.contentViewModels[d];g instanceof lt&&g.setActiveMedia(h)}nextMedia(d){const h=this.contentViewModels[d];h instanceof lt&&h.next()}previousMedia(d){const h=this.contentViewModels[d];h instanceof lt&&h.previous()}updateGeometry(){var d=this;return(0,T.Z)(function*(){const{graphic:h,spatialReference:g,_sourceLayer:y}=d;yield y?.load();const v=y?.objectIdField;if(!v||!h||!y)return;const b=h?.attributes?.[v];if(null==b)return;const M=[b];if(!h.geometry){const _=(yield qi({layer:y,graphic:h,outFields:[],objectIds:M,returnGeometry:!0,spatialReference:g}))?.geometry;_&&(h.geometry=_)}})()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}_graphicChanged(){var d=this;return(0,T.Z)(function*(){d._cancelFeatureQuery(),d._error=null,d._clear();const{graphic:h}=d;if(!h)return;const g=new AbortController;d._featureAbortController=g;try{yield d._queryFeature({signal:g.signal})}catch(y){(0,he.D_)(y)||(d._error=y,K.Z.getLogger(d).error("error","The popupTemplate could not be displayed for this feature.",{error:y,graphic:h,popupTemplate:d._effectivePopupTemplate}))}d._featureAbortController===g&&(d._featureAbortController=null)})()}_cancelFeatureQuery(){const{_featureAbortController:d}=this;d&&d.abort(),this._featureAbortController=null}_compileContentElement(d,h){return"attachments"===d.type?this._compileAttachments(d,h):"custom"===d.type?this._compileCustom(d,h):"fields"===d.type?this._compileFields(d,h):"media"===d.type?this._compileMedia(d,h):"text"===d.type?this._compileText(d,h):"expression"===d.type?this._compileExpression(d,h):"relationship"===d.type?this._compileRelationship(d,h):void 0}_compileContent(d){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(d)?d.filter(this._isAllowedContentType).map((h,g)=>this._compileContentElement(h,g)).filter(bt.pC):"string"==typeof d?this._compileText(new fn.Z({text:d}),0).text:d}_destroyContentViewModels(){this.removeHandles(Pn),this.removeHandles(xn),this.contentViewModels.forEach(d=>d&&!d.destroyed&&d.destroy()),this._set("contentViewModels",[])}_matchesFeature(d,h){const g=d?.graphic?.getObjectId(),y=h?.getObjectId();return null!=g&&null!=y&&g===y}_setRelatedFeaturesViewModels({relatedFeatureViewModels:d,relatedFeatures:h,map:g}){const{view:y,spatialReference:v}=this;h?.filter(Boolean).forEach(b=>{d.some(M=>this._matchesFeature(M,b))||d.add(new At({abilities:{relationshipContent:!1},map:g,view:y,spatialReference:v,graphic:b}))}),d.forEach(b=>{h?.find(I=>this._matchesFeature(b,I))||d.remove(b)})}_setExpressionContentVM(d,h){const g=this.formattedAttributes,{contentElement:y,contentElementViewModel:v}=d,b=y?.type;v&&b&&("fields"===b&&(this._createFieldsFormattedAttributes({contentElement:y,contentElementIndex:h,formattedAttributes:g}),v.set(this._createFieldsVMParams(y,h))),"media"===b&&(this._createMediaFormattedAttributes({contentElement:y,contentElementIndex:h,formattedAttributes:g}),v.set(this._createMediaVMParams(y,h))),"text"===b&&v.set(this._createTextVMParams(y)))}_compileRelationship(d,h){const{displayCount:g,orderByFields:y,relationshipId:v,title:b,description:M}=d,{_sourceLayer:I,graphic:_,map:E}=this;if(!Gt(I))return;const P=new Mi({displayCount:g,graphic:_,orderByFields:y,relationshipId:v,layer:I,map:E,...this._compileTitleAndDesc({title:b,description:M})});return this.contentViewModels[h]=P,this.addHandles((0,x.on)(()=>P.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(P)),Pn),d}_compileExpression(d,h){const{expressionInfo:g}=d,{graphic:y,map:v,spatialReference:b,view:M,location:I}=this,_=new vi({expressionInfo:g,graphic:y,interceptor:At.interceptor,map:v,spatialReference:b,view:M,location:I});return this.contentViewModels[h]=_,this.addHandles((0,x.YP)(()=>_.contentElementViewModel,()=>this._setExpressionContentVM(_,h),x.nn),xn),d}_compileAttachments(d,h){const{graphic:g}=this,{description:y,title:v}=d;return this.contentViewModels[h]=new ii({graphic:g,...this._compileTitleAndDesc({title:v,description:y})}),d}_compileCustom(d,h){const{graphic:g}=this,{creator:y,destroyer:v}=d;return this.contentViewModels[h]=new Tt({graphic:g,creator:y,destroyer:v}),d}_compileTitleAndDesc({title:d,description:h}){const{_fieldInfoMap:g,_sourceLayer:y,graphic:v,formattedAttributes:b}=this,M=v?.attributes,I=this._expressionAttributes,_=b.global;return{title:at({attributes:M,fieldInfoMap:g,globalAttributes:_,expressionAttributes:I,layer:y,text:d}),description:at({attributes:M,fieldInfoMap:g,globalAttributes:_,expressionAttributes:I,layer:y,text:h})}}_createFieldsVMParams(d,h){const g=this._effectivePopupTemplate,y=this.formattedAttributes,v={...y?.global,...y?.content[h]},M=(d?.fieldInfos||g?.fieldInfos)?.filter(({fieldName:P})=>jt(P)||Qe(P)||v.hasOwnProperty(P)),I=g?.expressionInfos,{description:_,title:E}=d;return{attributes:v,expressionInfos:I,fieldInfos:M,...this._compileTitleAndDesc({title:E,description:_})}}_compileFields(d,h){const g=d.clone(),y=new Ot(this._createFieldsVMParams(d,h));return this.contentViewModels[h]=y,g.fieldInfos=y.formattedFieldInfos.slice(0),g}_createMediaVMParams(d,h){const{abilities:g,graphic:y,_fieldInfoMap:v,_effectivePopupTemplate:b,relatedInfos:M,_sourceLayer:I,_expressionAttributes:_}=this,E=this.formattedAttributes,P=y?.attributes??{},{description:L,mediaInfos:S,title:$}=d;return{abilities:{chartAnimation:g.chartAnimation},activeMediaInfoIndex:d.activeMediaInfoIndex||0,attributes:P,isAggregate:y?.isAggregate,layer:I,fieldInfoMap:v,formattedAttributes:{...E?.global,...E?.content[h]},expressionAttributes:_,mediaInfos:S,popupTemplate:b,relatedInfos:M,...this._compileTitleAndDesc({title:$,description:L})}}_compileMedia(d,h){const g=d.clone(),y=new lt(this._createMediaVMParams(d,h));return g.mediaInfos=y.formattedMediaInfos.slice(0),this.contentViewModels[h]=y,g}_createTextVMParams(d){const{graphic:h,_fieldInfoMap:g,_sourceLayer:y,_expressionAttributes:v}=this;return d&&d.text&&(d.text=at({attributes:h?.attributes??{},fieldInfoMap:g,globalAttributes:this.formattedAttributes?.global??{},expressionAttributes:v,layer:y,text:d.text})),{graphic:h,creator:d.text}}_compileText(d,h){const g=d.clone();return this.contentViewModels[h]=new Tt(this._createTextVMParams(g)),g}_compileLastEditInfo(){const{_effectivePopupTemplate:d,_sourceLayer:h,graphic:g,timeZone:y}=this;if(!d)return;const{lastEditInfoEnabled:v}=d,b=h?.editFieldsInfo;return v&&b?function bs(d,h,g,y){const{creatorField:v,creationDateField:b,editorField:M,editDateField:I}=d;if(!h)return;const _=(0,Bi.Np)(y&&"preferredTimeZone"in y?y.preferredTimeZone:null,!(!y||!("datesInUnknownTimezone"in y)||!y.datesInUnknownTimezone),g,Hi,"date"),E={...Hi,..._},P=h[I];if("number"==typeof P){const S=h[M];return{type:"edit",date:(0,z.p6)(P,E),user:S}}const L=h[b];if("number"==typeof L){const S=h[v];return{type:"create",date:(0,z.p6)(L,E),user:S}}return null}(b,g?.attributes,y,h):void 0}_compileTitle(d){const{_fieldInfoMap:h,_sourceLayer:g,graphic:y,_expressionAttributes:v}=this;return at({attributes:y?.attributes??{},fieldInfoMap:h,globalAttributes:this.formattedAttributes?.global??{},expressionAttributes:v,layer:g,text:d})}_getTitle(){var d=this;return(0,T.Z)(function*(){const{_effectivePopupTemplate:h,graphic:g}=d;if(!g)return null;const y=h?.title;return xt(y,{graphic:g})})()}_getContent(){var d=this;return(0,T.Z)(function*(){const{_effectivePopupTemplate:h,graphic:g}=d;if(!g)return null;const y=h?.content;return xt(y,{graphic:g})})()}_queryFeature(d){var h=this;return(0,T.Z)(function*(){const{_featureAbortController:g,_sourceLayer:y,graphic:v,_effectivePopupTemplate:b}=h,M=h.map,I=h.view,_=h.spatialReference,E=h.location;if(g!==h._featureAbortController||!v)return;yield function ws(d,h){return qt.apply(this,arguments)}({graphic:v,popupTemplate:b,layer:y,spatialReference:_},d);const{content:{value:P},title:{value:L}}=yield(0,he.as)({content:h._getContent(),title:h._getTitle()}),{expressionAttributes:{value:S}}=yield(0,he.as)({checkForRelatedFeatures:h._checkForRelatedFeatures(d),expressionAttributes:Co({expressionInfos:b?.expressionInfos,spatialReference:_,graphic:v,map:M,interceptor:At.interceptor,view:I,options:d,location:E})});g===h._featureAbortController&&v&&(h._expressionAttributes=S,h._graphicExpressionAttributes={...v.attributes,...S},h._set("formattedAttributes",h._createFormattedAttributes(P)),h._set("title",h._compileTitle(L)),h._set("lastEditInfo",h._compileLastEditInfo()||null),h._set("content",h._compileContent(P)||null))})()}_createMediaFormattedAttributes({contentElement:d,contentElementIndex:h,formattedAttributes:g}){const{_effectivePopupTemplate:y,graphic:v,relatedInfos:b,_sourceLayer:M,_fieldInfoMap:I,_graphicExpressionAttributes:_,timeZone:E}=this;g.content[h]=Jt({fieldInfos:y?.fieldInfos,graphic:v,attributes:{..._,...d.attributes},layer:M,fieldInfoMap:I,relatedInfos:b,timeZone:E})}_createFieldsFormattedAttributes({contentElement:d,contentElementIndex:h,formattedAttributes:g}){if(d.fieldInfos){const{graphic:y,relatedInfos:v,_sourceLayer:b,_fieldInfoMap:M,_graphicExpressionAttributes:I,timeZone:_}=this;g.content[h]=Jt({fieldInfos:d.fieldInfos,graphic:y,attributes:{...I,...d.attributes},layer:b,fieldInfoMap:M,relatedInfos:v,timeZone:_})}}_createFormattedAttributes(d){const{_effectivePopupTemplate:h,graphic:g,relatedInfos:y,_sourceLayer:v,_fieldInfoMap:b,_graphicExpressionAttributes:M,timeZone:I}=this,_=h?.fieldInfos,E={global:Jt({fieldInfos:_,graphic:g,attributes:M,layer:v,fieldInfoMap:b,relatedInfos:y,timeZone:I}),content:[]};return Array.isArray(d)&&d.forEach((P,L)=>{"fields"===P.type&&this._createFieldsFormattedAttributes({contentElement:P,contentElementIndex:L,formattedAttributes:E}),"media"===P.type&&this._createMediaFormattedAttributes({contentElement:P,contentElementIndex:L,formattedAttributes:E})}),E}_checkForRelatedFeatures(d){const{graphic:h,_effectivePopupTemplate:g}=this;return this._queryRelatedInfos(h,Xi(g),d)}_queryRelatedInfos(d,h,g){var y=this;return(0,T.Z)(function*(){const{relatedInfos:v,_sourceLayer:b}=y;v.clear();const M=null!=b?.associatedLayer?yield b?.associatedLayer.load(g):b;if(!M||!d||!h.filter(P=>P&&Qe(P.fieldName))?.length)return;h.forEach(P=>y._configureRelatedInfo(P,M));const _=yield function qs({relatedInfos:d,layer:h},g){const y={};return d.forEach((v,b)=>{const{relation:M}=v;if(!M){const L=new N.Z("relation-required","A relation is required on a layer to retrieve related records.");throw cn().error(L),L}const{relatedTableId:I}=M;if("number"!=typeof I){const L=new N.Z("A related table ID is required on a layer to retrieve related records.");throw cn().error(L),L}const _=`${h.url}/${I}`,E=hn.get(_),P=E??function ks(d,h){return(0,Ds.Z)(d,{query:{f:"json"},signal:h?.signal})}(_);E||hn.set(_,P),y[b]=P}),(0,he.Hl)((0,he.as)(y),g)}({relatedInfos:v,layer:M},g);Object.keys(_).forEach(P=>{const L=v.get(P.toString()),S=_[P]?.value;L&&S&&(L.layerInfo=S.data)});const E=yield function eo({graphic:d,relatedInfos:h,layer:g},y){const v={};return h.forEach((b,M)=>{b.layerInfo&&(v[M]=function Xs(d,h,g,y){return pi.apply(this,arguments)}(d,b,g,y))}),(0,he.as)(v)}({graphic:d,relatedInfos:v,layer:M},g);Object.keys(E).forEach(P=>{!function Ys(d,h){if(!h||!d)return;const{features:g,statsFeatures:y}=d,v=g?.value;h.relatedFeatures=v?v.features:[];const b=y?.value;h.relatedStatsFeatures=b?b.features:[]}(E[P]?.value,v.get(P.toString()))})})()}_configureRelatedInfo(d,h){const{relatedInfos:g}=this,y=Nt(d.fieldName);if(!y)return;const{layerId:v,fieldName:b}=y;if(!v)return;const M=g.get(v.toString())||function Hs(d,h){const g=function zs(d,h){if(!h.relationships)return null;let g=null;const{relationships:y}=h;return y.some(v=>v.id===parseInt(d,10)&&(g=v,!0)),g}(d,h);if(g)return{url:`${h.url}/${g.relatedTableId}`,sourceSpatialReference:h.spatialReference,relation:g,relatedFields:[],outStatistics:[]}}(v,h);M&&(function to({relatedInfo:d,fieldName:h,fieldInfo:g}){if(d.relatedFields?.push(h),g.statisticType){const y=new Us.Z({statisticType:g.statisticType,onStatisticField:h,outStatisticFieldName:h});d.outStatistics?.push(y)}}({relatedInfo:M,fieldName:b,fieldInfo:d}),this.relatedInfos.set(v,M))}};ae.interceptor=new class Oo{constructor(h,g){this.preLayerQueryCallback=h,this.preRequestCallback=g,this.preLayerQueryCallback||(this.preLayerQueryCallback=y=>{}),this.preRequestCallback||(this.preLayerQueryCallback=y=>{})}}(({query:d,layer:h,method:g})=>{nn({layer:h,method:g,query:d,definitionExpression:`${h.definitionExpression} ${h.serviceDefinitionExpression}`})},({queryPayload:d,layer:h,method:g})=>{nn({layer:h,method:g,query:d,definitionExpression:`${h.definitionExpression} ${h.serviceDefinitionExpression}`})}),(0,F._)([(0,w.Cb)()],ae.prototype,"_error",void 0),(0,F._)([(0,w.Cb)()],ae.prototype,"_featureAbortController",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],ae.prototype,"_effectivePopupTemplate",null),(0,F._)([(0,w.Cb)({readOnly:!0})],ae.prototype,"_fieldInfoMap",null),(0,F._)([(0,w.Cb)({readOnly:!0})],ae.prototype,"_sourceLayer",null),(0,F._)([(0,w.Cb)()],ae.prototype,"abilities",void 0),(0,F._)([(0,Ue.p)("abilities")],ae.prototype,"castAbilities",null),(0,F._)([(0,w.Cb)({readOnly:!0})],ae.prototype,"content",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],ae.prototype,"contentViewModels",void 0),(0,F._)([(0,w.Cb)()],ae.prototype,"description",void 0),(0,F._)([(0,w.Cb)({type:Boolean})],ae.prototype,"defaultPopupTemplateEnabled",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],ae.prototype,"isTable",null),(0,F._)([(0,w.Cb)({readOnly:!0})],ae.prototype,"state",null),(0,F._)([(0,w.Cb)({readOnly:!0})],ae.prototype,"formattedAttributes",void 0),(0,F._)([(0,w.Cb)({type:O.Z,value:null})],ae.prototype,"graphic",null),(0,F._)([(0,w.Cb)({readOnly:!0})],ae.prototype,"lastEditInfo",void 0),(0,F._)([(0,w.Cb)({type:ui.Z})],ae.prototype,"location",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],ae.prototype,"relatedInfos",void 0),(0,F._)([(0,w.Cb)()],ae.prototype,"spatialReference",null),(0,F._)([(0,w.Cb)()],ae.prototype,"timeZone",null),(0,F._)([(0,w.Cb)({readOnly:!0})],ae.prototype,"title",void 0),(0,F._)([(0,w.Cb)()],ae.prototype,"map",null),(0,F._)([(0,w.Cb)({readOnly:!0})],ae.prototype,"waitingForContent",null),(0,F._)([(0,w.Cb)()],ae.prototype,"view",void 0),ae=At=(0,F._)([(0,W.j)("esri.widgets.Feature.FeatureViewModel")],ae);const Ii=ae,ye="esri-feature",ce={base:ye,container:`${ye}__size-container`,title:`${ye}__title`,main:`${ye}__main-container`,btn:`${ye}__button`,icon:`${ye}__icon`,content:`${ye}__content`,contentNode:`${ye}__content-node`,contentNodeText:`${ye}__content-node--text`,contentElement:`${ye}__content-element`,text:`${ye}__text`,lastEditedInfo:`${ye}__last-edited-info`,fields:`${ye}__fields`,fieldHeader:`${ye}__field-header`,fieldData:`${ye}__field-data`,fieldDataDate:`${ye}__field-data--date`,loadingSpinnerContainer:`${ye}__loading-container`,spinner:`${ye}__loading-spinner`},Rn=d=>{let h=class extends d{constructor(){super(...arguments),this.renderNodeContent=g=>(0,ri.Qd)(g)&&!g.destroyed?(0,A.u)("div",{class:ce.contentNode,key:g},g.render()):g instanceof HTMLElement?(0,A.u)("div",{afterCreate:this._attachToNode,bind:g,class:ce.contentNode,key:g}):(0,ri.o)(g)?(0,A.u)("div",{afterCreate:this._attachToNode,bind:g.domNode,class:ce.contentNode,key:g}):null}_attachToNode(g){g.appendChild(this)}};return h=(0,F._)([(0,W.j)("esri.widgets.Feature.ContentMixin")],h),h};var _i;const On={title:!0,content:!0,lastEditedInfo:!0},Ln="relationship-handles";let ge=_i=class extends(Rn(V.Z)){constructor(d,h){super(d,h),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.visibleElements={...On},this.viewModel=new Ii}initialize(){this.addHandles((0,x.YP)(()=>this.viewModel?.contentViewModels,()=>this._setupContentWidgets(),x.nn))}loadDependencies(){return(0,gt.h)({notice:()=>Promise.all([C.e(6203),C.e(6554),C.e(8592),C.e(1278)]).then(C.bind(C,31278))})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(d){this.viewModel.graphic=d}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(d){this.viewModel.defaultPopupTemplateEnabled=d}get isTable(){return this.viewModel.isTable}get label(){return this.messages?.widgetLabel??""}set label(d){this._overrideIfSome("label",d)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(d){this.viewModel.spatialReference=d}get timeZone(){return this.viewModel.timeZone}set timeZone(d){this.viewModel.timeZone=d}get title(){return this.viewModel.title}castVisibleElements(d){return{...On,...d}}get map(){return this.viewModel.map}set map(d){this.viewModel.map=d}get view(){return this.viewModel.view}set view(d){this.viewModel.view=d}setActiveMedia(d,h){return this.viewModel.setActiveMedia(d,h)}nextMedia(d){return this.viewModel.nextMedia(d)}previousMedia(d){return this.viewModel.previousMedia(d)}render(){const{state:d}=this.viewModel,h=(0,A.u)("div",{class:ce.container,key:"container"},this._renderTitle(),"error"===d?this._renderError():"loading"===d?this._renderLoading():this._renderContentContainer());return(0,A.u)("div",{class:this.classes(ce.base,Y.z.widget)},h)}_renderError(){const{messagesCommon:d,messages:h,visibleElements:g}=this;return(0,A.u)("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0,scale:"s"},g.title?(0,A.u)("div",{key:"error-title",slot:"title"},d.errorMessage):null,(0,A.u)("div",{key:"error-message",slot:"message"},h.loadingError))}_renderLoading(){return(0,A.u)("div",{class:ce.loadingSpinnerContainer,key:"loading-container"},(0,A.u)("span",{class:this.classes(Ve.W.loadingIndicator,Y.z.rotating,ce.spinner)}))}_renderContentContainer(){const{visibleElements:d}=this;return d.content?(0,A.u)("div",{class:ce.main},[this._renderContent(),this._renderLastEditInfo()]):null}_renderTitle(){const{visibleElements:d,title:h}=this;return d.title?(0,A.u)(ni.X,{class:ce.title,innerHTML:h,level:this.headingLevel}):null}_renderContent(){const d=this.viewModel.content,h="content";if(!d)return null;if(Array.isArray(d))return d.length?(0,A.u)("div",{class:ce.contentNode,key:`${h}-content-elements`},d.map(this._renderContentElement,this)):null;if("string"==typeof d){const g=this._contentWidgets[0];return!g||g.destroyed?null:(0,A.u)("div",{class:this.classes(ce.contentNode,ce.contentNodeText),key:`${h}-content`},g.render())}return this.renderNodeContent(d)}_renderContentElement(d,h){const{visibleElements:g}=this;if("boolean"!=typeof g.content&&!g.content?.[d.type])return null;switch(d.type){case"attachments":return this._renderAttachments(h);case"custom":return this._renderCustom(d,h);case"fields":return this._renderFields(h);case"media":return this._renderMedia(h);case"text":return this._renderText(d,h);case"expression":return this._renderExpression(h);case"relationship":return this._renderRelationship(h);default:return null}}_renderAttachments(d){const h=this._contentWidgets[d];if(!h||h.destroyed)return null;const{state:g,attachmentInfos:y}=h.viewModel;return"loading"===g||y.length>0?(0,A.u)("div",{class:this.classes(ce.contentElement),key:this._buildKey("attachments-element",d)},h.render()):null}_renderRelationship(d){const h=this._contentWidgets[d];return h&&!h.destroyed&&this.flowItems?(0,A.u)("div",{class:ce.contentElement,key:this._buildKey("relationship-element",d)},h.render()):null}_renderExpression(d){const h=this._contentWidgets[d];return!h||h.destroyed?null:(0,A.u)("div",{class:ce.contentElement,key:this._buildKey("expression-element",d)},h.render())}_renderCustom(d,h){const{creator:g}=d,y=this._contentWidgets[h];return!y||y.destroyed?null:g?(0,A.u)("div",{class:ce.contentElement,key:this._buildKey("custom-element",h)},y.render()):null}_renderFields(d){const h=this._contentWidgets[d];return!h||h.destroyed?null:(0,A.u)("div",{class:ce.contentElement,key:this._buildKey("fields-element",d)},h.render())}_renderMedia(d){const h=this._contentWidgets[d];return!h||h.destroyed?null:(0,A.u)("div",{class:ce.contentElement,key:this._buildKey("media-element",d)},h.render())}_renderLastEditInfo(){const{visibleElements:d,messages:h}=this,{lastEditInfo:g}=this.viewModel;if(!g||!d.lastEditedInfo)return null;const{date:y,user:v}=g,M=(0,Je.n)("edit"===g.type?v?h.lastEditedByUser:h.lastEdited:v?h.lastCreatedByUser:h.lastCreated,{date:y,user:v});return(0,A.u)("div",{class:this.classes(ce.lastEditedInfo,ce.contentElement),key:"edit-info-element"},M)}_renderText(d,h){const y=this._contentWidgets[h];return!y||y.destroyed?null:d.text?(0,A.u)("div",{class:this.classes(ce.contentElement,ce.text),key:this._buildKey("text-element",h)},y.render()):null}_buildKey(d,...h){return`${d}__${this.viewModel?.graphic?.uid||"0"}-${h.join("-")}`}_destroyContentWidget(d){d&&(d.viewModel=null,!d.destroyed&&d.destroy())}_destroyContentWidgets(){this.removeHandles(Ln),this._contentWidgets.forEach(d=>this._destroyContentWidget(d)),this._contentWidgets=[]}_addFeatureRelationshipHandles(d){const{flowItems:h,visibleElements:g}=this;this.addHandles([(0,x.on)(()=>d,"select-record",({featureViewModel:y})=>{h&&(y.abilities={relationshipContent:!0},h.push(new _i({flowItems:h,viewModel:y,visibleElements:g})))}),(0,x.on)(()=>d,"show-all-records",()=>{if(!h)return;const{viewModel:y}=d;y.showAllEnabled=!0;const v=new En({visibleElements:{title:!1,description:!1},viewModel:y});this._addFeatureRelationshipHandles(v),h.push(v)})],Ln)}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:d,visibleElements:h}=this,g=this.viewModel?.content,{contentViewModels:y}=this.viewModel;if(Array.isArray(g))g.forEach((v,b)=>{if("attachments"===v.type&&(this._contentWidgets[b]=new Os({displayType:v.displayType,headingLevel:h.title?d+1:d,viewModel:y[b]})),"fields"===v.type&&(this._contentWidgets[b]=new un({viewModel:y[b]})),"media"===v.type&&(this._contentWidgets[b]=new mn({viewModel:y[b]})),"text"===v.type&&(this._contentWidgets[b]=new Rt({viewModel:y[b]})),"custom"===v.type&&(this._contentWidgets[b]=new Rt({viewModel:y[b]})),"expression"===v.type&&(this._contentWidgets[b]=new wo({viewModel:y[b]})),"relationship"===v.type){const M=new En({viewModel:y[b]});this._addFeatureRelationshipHandles(M),this._contentWidgets[b]=M}},this);else{const v=y[0];v&&!v.destroyed&&(this._contentWidgets[0]=new Rt({viewModel:v}))}this.scheduleRender()}};(0,F._)([(0,w.Cb)()],ge.prototype,"graphic",null),(0,F._)([(0,w.Cb)()],ge.prototype,"defaultPopupTemplateEnabled",null),(0,F._)([(0,w.Cb)()],ge.prototype,"flowItems",void 0),(0,F._)([(0,w.Cb)()],ge.prototype,"headingLevel",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],ge.prototype,"isTable",null),(0,F._)([(0,w.Cb)()],ge.prototype,"label",null),(0,F._)([(0,w.Cb)(),(0,Ze.H)("esri/widgets/Feature/t9n/Feature")],ge.prototype,"messages",void 0),(0,F._)([(0,w.Cb)(),(0,Ze.H)("esri/t9n/common")],ge.prototype,"messagesCommon",void 0),(0,F._)([(0,w.Cb)()],ge.prototype,"spatialReference",null),(0,F._)([(0,w.Cb)()],ge.prototype,"timeZone",null),(0,F._)([(0,w.Cb)({readOnly:!0})],ge.prototype,"title",null),(0,F._)([(0,w.Cb)()],ge.prototype,"visibleElements",void 0),(0,F._)([(0,Ue.p)("visibleElements")],ge.prototype,"castVisibleElements",null),(0,F._)([(0,w.Cb)()],ge.prototype,"map",null),(0,F._)([(0,w.Cb)()],ge.prototype,"view",null),(0,F._)([(0,w.Cb)({type:Ii})],ge.prototype,"viewModel",void 0),ge=_i=(0,F._)([(0,W.j)("esri.widgets.Feature")],ge);const So=ge;var No=C(61885),Ai=C(55915);let dt=class extends No.Z.EventedAccessor{constructor(d){super(d),this.location=null,this.screenLocationEnabled=!1,this.view=null,this.addHandles([(0,x.gx)(()=>{const h=this.screenLocationEnabled?this.view:null;return h?[h.size,"3d"===h.type?h.camera:h.viewpoint]:null},()=>this.notifyChange("screenLocation")),(0,x.YP)(()=>this.screenLocation,(h,g)=>{null!=h&&null!=g&&this.emit("view-change")})])}destroy(){this.view=null}get screenLocation(){const{location:d,view:h,screenLocationEnabled:g}=this,y=h?.spatialReference,v=y?(0,Ai.projectOrLoad)(d,y).geometry:null;return g&&v&&h?.ready?h.toScreen(v):null}};(0,F._)([(0,w.Cb)()],dt.prototype,"location",void 0),(0,F._)([(0,w.Cb)()],dt.prototype,"screenLocation",null),(0,F._)([(0,w.Cb)()],dt.prototype,"screenLocationEnabled",void 0),(0,F._)([(0,w.Cb)()],dt.prototype,"view",void 0),dt=(0,F._)([(0,W.j)("esri.widgets.support.AnchorElementViewModel")],dt);const Sn=dt;let Vt=class extends Sn{constructor(d){super(d),this.visible=!1}};(0,F._)([(0,w.Cb)()],Vt.prototype,"visible",void 0),Vt=(0,F._)([(0,W.j)("esri.widgets.CompassViewModel")],Vt);const Nn=Vt,Ei="esri-spinner",xi_base=Ei,xi_spinnerStart=`${Ei}--start`,xi_spinnerFinish=`${Ei}--finish`;let ut=class extends V.Z{constructor(d,h){super(d,h),this._animationDelay=500,this._animationPromise=null,this.viewModel=new Nn}initialize(){this.addHandles((0,x.YP)(()=>this.visible,d=>this._visibleChange(d)))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(d){this.viewModel.location=d}get view(){return this.viewModel.view}set view(d){this.viewModel.view=d}get visible(){return this.viewModel.visible}set visible(d){this.viewModel.visible=d}show(d){const{location:h,promise:g}=d??{};h&&(this.viewModel.location=h),this.visible=!0,g&&g.catch(()=>{}).then(()=>this.hide())}hide(){this.visible=!1}render(){const{visible:d}=this,{screenLocation:h}=this.viewModel,g=!!h,b={[xi_spinnerStart]:d&&g,[xi_spinnerFinish]:!d&&g},M=this._getPositionStyles();return(0,A.u)("div",{class:this.classes(xi_base,b),styles:M})}_visibleChange(d){if(d)return void(this.viewModel.screenLocationEnabled=!0);const h=(0,he.e4)(this._animationDelay);this._animationPromise=h,h.catch(()=>{}).then(()=>{this._animationPromise===h&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:d,view:h}=this.viewModel;if(null==h||null==d)return{};const{padding:g}=h;return{left:d.x-g.left+"px",top:d.y-g.top+"px"}}};(0,F._)([(0,w.Cb)()],ut.prototype,"location",null),(0,F._)([(0,w.Cb)()],ut.prototype,"view",null),(0,F._)([(0,w.Cb)({type:Nn})],ut.prototype,"viewModel",void 0),(0,F._)([(0,w.Cb)()],ut.prototype,"visible",null),ut=(0,F._)([(0,W.j)("esri.widgets.Spinner")],ut);const Zo=ut,Ae="esri-features",ve={icon:`${Ae}__icon`,actionImage:`${Ae}__action-image`,base:Ae,container:`${Ae}__container`,contentContainer:`${Ae}__content-container`,contentFeature:`${Ae}__content-feature`,flowItemCollapsed:`${Ae}__flow-item--collapsed`,header:`${Ae}__header`,footer:`${Ae}__footer`,featureMenuObserver:`${Ae}__feature-menu-observer`,actionExit:`${Ae}__action--exit`,loader:`${Ae}__loader`,featuresHeading:`${Ae}__heading`,paginationActionBar:`${Ae}__pagination-action-bar`,paginationPrevious:`${Ae}__pagination-previous`,paginationNext:`${Ae}__pagination-next`};let ct=class extends V.Z{constructor(d,h){super(d,h),this.messages=null,this.closed=!1,this.closable=!0,this._handleOpenRelatedFeature=g=>{this.emit("open-related-feature",{feature:g})}}loadDependencies(){return(0,gt.h)({action:()=>Promise.all([C.e(6203),C.e(6554),C.e(8346),C.e(2573)]).then(C.bind(C,52573)),"flow-item":()=>Promise.all([C.e(6203),C.e(6554),C.e(8346),C.e(2561),C.e(9342),C.e(4792),C.e(8592),C.e(9922)]).then(C.bind(C,59922))})}render(){const{flowItems:d}=this,h=d?.toArray();return(0,A.u)(A.D,null,h?.map(g=>this._renderRelatedRecordsFlowItem(g)))}_handleCloseClick(){this.emit("close")}_handleExitClick(){this.emit("exit")}_handleRelatedRecordsBackClick(){const d=this.flowItems?.pop();d&&("showAllEnabled"in d.viewModel&&(d.viewModel.showAllEnabled=!1),d&&(d.viewModel=null,d.destroy()))}_renderRelatedRecordsFlowItem(d){const{messages:h,closable:g,closed:y}=this,v="graphic"in d&&!d.isTable;return(0,A.u)("calcite-flow-item",{bind:this,closable:g,closed:y,description:this._getRelatedRecordsFlowItemDescription(d),heading:d.title??"",key:`flow-item-${d.viewModel.uid}`,onCalciteFlowItemBack:b=>{b.preventDefault(),this._handleRelatedRecordsBackClick()},onCalciteFlowItemClose:this._handleCloseClick},(0,A.u)("calcite-action",{appearance:"transparent",bind:this,class:ve.actionExit,icon:"move-up",key:"exit-related-records-action",label:h.exitRelatedRecords,onclick:this._handleExitClick,scale:"m",slot:"header-actions-start",text:h.exitRelatedRecords,title:h.exitRelatedRecords}),v?(0,A.u)("calcite-action",{appearance:"transparent",bind:this,icon:"zoom-to-object",key:"open-related-feature-action",label:h.selectFeature,onclick:()=>this._handleOpenRelatedFeature(d),scale:"m",slot:"header-actions-end",text:h.selectFeature,title:h.selectFeature}):null,(0,A.u)("div",{class:ve.container},d.render()))}_getRelatedRecordsFlowItemDescription(d){return"featureCountDescription"in d?d.featureCountDescription:d.viewModel.description??""}};(0,F._)([(0,w.Cb)()],ct.prototype,"flowItems",void 0),(0,F._)([(0,w.Cb)(),(0,Ze.H)("esri/widgets/Features/t9n/Features")],ct.prototype,"messages",void 0),(0,F._)([(0,w.Cb)()],ct.prototype,"closed",void 0),(0,F._)([(0,w.Cb)()],ct.prototype,"closable",void 0),ct=(0,F._)([(0,W.j)("esri.widgets.Features.FeaturesRelatedRecords")],ct);const Vo=ct;C(20383);var Do=C(42763),Uo=C(46367),$n=C(44917),Zn=C(5437),Vn=C(3854),Dn=C(93579),Bo=C(59397),Un=C(10671);const ht=oe.Z.ofType({key:"type",defaultKeyValue:"button",base:Bo.Z,typeMap:{button:de.Z,toggle:Un.Z}}),st=new de.Z({icon:"magnifying-glass-plus",id:"zoom-to-feature",title:"{messages.zoom}",className:Ve.W.zoomInMagnifyingGlass}),Pi=new de.Z({icon:"trash",id:"remove-selected-feature",title:"{messages.remove}",className:Ve.W.trash}),pt=new de.Z({icon:"magnifying-glass-plus",id:"zoom-to-clustered-features",title:"{messages.zoom}",className:Ve.W.zoomInMagnifyingGlass}),ke=new Un.Z({icon:"table",id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:Ve.W.table,value:!1}),Dt=()=>K.Z.getLogger("esri.widgets.Popup.PopupViewModel"),jo=d=>{const{event:h,view:g,viewModel:y}=d,{action:v}=h;if(!v)return Promise.reject(new N.Z("trigger-action:missing-arguments","Event has no action"));const{disabled:b,id:M}=v;if(!M)return Promise.reject(new N.Z("trigger-action:invalid-action","action.id is missing"));if(b)return Promise.reject(new N.Z("trigger-action:invalid-action","Action is disabled"));if(M===st.id)return function Ho(d){return Ri.apply(this,arguments)}(y).catch(he.H9);if(M===pt.id)return function Yo(d){return Oi.apply(this,arguments)}(y);if(M===ke.id)return y.browseClusterEnabled=!y.browseClusterEnabled,y.featureMenuOpen=y.browseClusterEnabled,Promise.resolve();if(M===Pi.id){y.visible=!1;const{selectedFeature:I}=y;if(!I)return Promise.reject(new N.Z(`trigger-action:${Pi.id}`,"selectedFeature is required",{selectedFeature:I}));const{sourceLayer:_}=I;return _?_.remove(I):g?.graphics.remove(I),Promise.resolve()}return Promise.resolve()};function Bn(d){const{selectedFeature:h,location:g,view:y}=d;return y?h??g??null:null}function mt(d){return!!d&&d.isAggregate&&"cluster"===d.sourceLayer?.featureReduction?.type}function Ti(){return(Ti=(0,T.Z)(function*(d,h){if("3d"!==h?.type||!d||"esri.Graphic"!==d.declaredClass)return!0;const g=h.getViewForGraphic(d);if(g&&"whenGraphicBounds"in g){let y=null;try{y=yield g.whenGraphicBounds(d,{useViewElevation:!0})}catch{}return!y||!y.boundingBox||y.boundingBox[0]===y.boundingBox[3]&&y.boundingBox[1]===y.boundingBox[4]&&y.boundingBox[2]===y.boundingBox[5]}return!0})).apply(this,arguments)}function Ri(){return Ri=(0,T.Z)(function*(d){const{location:h,selectedFeature:g,view:y,zoomFactor:v}=d,b=Bn(d);if(!y||!b){const P=new N.Z("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:b,view:y});throw Dt().error(P),P}const M=y.scale/v,I=d.selectedFeature?.geometry,_=I??h,E=null!=_&&"point"===_.type&&(yield function Wo(d,h){return Ti.apply(this,arguments)}(g,y));st.active=!0,st.disabled=!0;try{yield d.zoomTo({target:{target:b,scale:E?M:void 0}})}catch{const L=new N.Z("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:g});Dt().error(L)}finally{st.active=!1,st.disabled=!1,d.zoomToLocation=null,E&&(d.location=_)}}),Ri.apply(this,arguments)}function Oi(){return(Oi=(0,T.Z)(function*(d){const{selectedFeature:h,view:g}=d;if("2d"!==g?.type){const M=new N.Z("zoomToCluster:invalid-view","View must be 2d MapView.",{view:g});throw Dt().error(M),M}if(!h||!mt(h)){const M=new N.Z("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:h});throw Dt().error(M),M}const[y,v]=yield Ni(g,h);pt.active=!0,pt.disabled=!0;const{extent:b}=yield y.queryExtent(v);b&&(yield d.zoomTo({target:b})),pt.active=!1,pt.disabled=!1})).apply(this,arguments)}function Li(){return(Li=(0,T.Z)(function*(d){const{view:h,selectedFeature:g}=d;if(!h||!g)return;const[y,v]=yield Ni(h,g),{extent:b}=yield y.queryExtent(v);d.selectedClusterBoundaryFeature.geometry=b,h.graphics.add(d.selectedClusterBoundaryFeature)})).apply(this,arguments)}function Si(){return(Si=(0,T.Z)(function*(d){const{selectedFeature:h,view:g}=d;if(!g||!h)return;const[y,v]=yield Ni(g,h);ke.active=!0,ke.disabled=!0;const{features:b}=yield y.queryFeatures(v);ke.active=!1,ke.disabled=!1,ke.value=!0,d?.open({features:[h].concat(b),featureMenuOpen:!0})})).apply(this,arguments)}function Ni(d,h){return $i.apply(this,arguments)}function $i(){return($i=(0,T.Z)(function*(d,h){const g=yield d.whenLayerView(h.sourceLayer),y=g.createQuery(),v=h.getObjectId();return y.aggregateIds=null!=v?[v]:[],[g,y]})).apply(this,arguments)}var Jo=C(67436),Xo=C(88493);let Ut=null,Q=class extends((0,Jo._)(Sn)){constructor(d){var h;super(d),h=this,this._pendingPromises=new Do.Z,this._fetchFeaturesController=null,this._highlightSelectedFeaturePromise=null,this._highlightActiveFeaturePromise=null,this._selectedClusterFeature=null,this._locationScaleHandle=null,this.actions=new ht,this.activeFeature=null,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.defaultPopupTemplateEnabled=!1,this.featurePage=null,this.featuresPerPage=20,this.featureMenuOpen=!1,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new O.Z({symbol:new Xo.Z({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null,this._debouncedLocationUpdate=(0,he.Ds)(function(){var g=(0,T.Z)(function*(y){const{view:v}=h,b=h.selectedFeature?.geometry?.type,M=h.location??y;if("mesh"!==b&&v&&M&&h.selectedFeature)if("point"!==b)try{const{pendingFeatures:I}=yield h._fetchFeaturesWithController({mapPoint:M}),_=(yield Promise.all(I)).flat().filter(Boolean);if(!_.length)return;if(_.length!==h.features.length){const S=h._getHighlightLayer(h.selectedFeature),$="imagery"===S?.type?void 0:S&&"objectIdField"in S?S.objectIdField||Zn.d:null;if($){const B=h.selectedFeature.getObjectId(),G=_.findIndex(X=>h._getHighlightLayer(X)?.uid===S?.uid&&X.attributes[$]===B);h.features=_,h.selectedFeatureIndex=G}}const E=_[h.selectedFeatureIndex]?.geometry,P=("mesh"!==E?.type?E:null)??h.selectedFeature.geometry,L=P?(0,Ai.project)(P,v.spatialReference):null;if(!L)return;Ut||(Ut=yield C.e(7215).then(C.bind(C,87215))),(yield Ut.intersects(L,M))||(h.location=(yield Ut.nearestCoordinate(L,M)).coordinate??M)}catch(I){(0,he.D_)(I)||K.Z.getLogger(h).error(I)}else h.location=Ne(h.selectedFeature.geometry)??M});return function(y){return g.apply(this,arguments)}}())}initialize(){this.addHandles([this.on("view-change",()=>this._autoClose()),(0,x.YP)(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),(0,x.YP)(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),(0,x.YP)(()=>this.view?.animation?.state,d=>this._animationStateChange(d)),(0,x.YP)(()=>this.location,d=>this._locationChange(d)),(0,x.YP)(()=>this.selectedFeature,d=>this._selectedFeatureChange(d)),(0,x.YP)(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),(0,x.YP)(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),(0,x.YP)(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",d=>jo({event:d,viewModel:this,view:this.view})),(0,x.gx)(()=>!this.waitingForResult,()=>this._waitingForResultChange(),x.Z_),(0,x.YP)(()=>[this.features,this.view?.map,this.view?.spatialReference,this.view?.timeZone],()=>this._updateFeatureVMs()),(0,x.YP)(()=>this.view?.scale,()=>this._viewScaleChange()),(0,x.gx)(()=>!this.visible,()=>this.browseClusterEnabled=!1),(0,x.YP)(()=>this.browseClusterEnabled,d=>d?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null,this._locationScaleHandle?.remove(),this._locationScaleHandle=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const d=this._get("allActions")||new ht;d.removeAll();const{actions:h,defaultActions:g,defaultPopupTemplateEnabled:y,includeDefaultActions:v,selectedFeature:b}=this,M=v?g.concat(h):h,I=b&&("function"==typeof b.getEffectivePopupTemplate&&b.getEffectivePopupTemplate(y)||b.popupTemplate),_=I?.actions;return(I?.overwriteActions?_:_?.concat(M)??M)?.filter(Boolean).forEach(P=>d.add(P)),d}get defaultActions(){const d=this._get("defaultActions")||new ht;return d.removeAll(),d.addMany(mt(this.selectedFeature)?[pt.clone(),ke.clone()]:[st.clone()]),d}get featureCount(){return this.features.length}set features(d){const h=d||[];this._set("features",h);const{pendingPromisesCount:g,promiseCount:y,selectedFeatureIndex:v}=this,b=y&&h.length;b&&g&&-1===v?this.selectedFeatureIndex=0:b&&-1!==v||(this.selectedFeatureIndex=h.length?0:-1)}set location(d){let h=d;const g=this.view?.spatialReference?.isWebMercator;d?.spatialReference?.isWGS84&&g&&(h=(0,Uo.$)(d)),this._set("location",h)}get pendingPromisesCount(){return this._pendingPromises.size}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(d){this._pendingPromises.clear(),this.features=[],Array.isArray(d)&&d.length?(this._set("promises",d),(d=d.slice(0)).forEach(h=>this._pendingPromises.add(h)),d.reduce((h,g)=>h.finally(()=>g.then(y=>{this._pendingPromises.has(g)&&this._updateFeatures(y)}).finally(()=>this._pendingPromises.delete(g)).catch(()=>{})),Promise.resolve())):this._set("promises",[])}get selectedFeature(){const{features:d,selectedFeatureIndex:h}=this;return-1===h?null:d[h]||null}get selectedFeatureIndex(){const d=this._get("selectedFeatureIndex");return"number"==typeof d?d:-1}set selectedFeatureIndex(d){const{featureCount:h}=this;d=isNaN(d)||d<-1||!h?-1:(d+h)%h,this.activeFeature=null,this._set("selectedFeatureIndex",d)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.view?.ready?"ready":"disabled"}get waitingForContents(){return this.featureViewModels.some(d=>d.waitingForContent)}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}centerAtLocation(){const{view:d}=this,h=Bn(this);return h&&d?this.callGoTo({target:{target:h,scale:d.scale}}):Promise.reject(new N.Z("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:h,view:d}))}zoomTo(d){return this.callGoTo(d)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(d,h){const{view:g}=this;if(!g||!d)throw new N.Z("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:d,view:g});return g.fetchPopupFeatures(d,{pointerType:h?.event?.pointerType,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:h?.signal})}open(d){const h={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...d,visible:!0},{fetchFeatures:g}=h;delete h.fetchFeatures,g&&this._setFetchFeaturesPromises(h.location);const y=["actionsMenuOpen","collapsed"];for(const v of y)delete h[v];this.set(h)}triggerAction(d){const h=this.allActions.at(d);h&&!h.disabled&&this.emit("trigger-action",{action:h})}next(){return this.selectedFeatureIndex++,this}previous(){return this.selectedFeatureIndex--,this}disableClusterBrowsing(){(function Ko(d){ke.value=!1;const h=d.features.filter(g=>mt(g));h.length&&(d.features=h)})(this),this._clearBrowsedClusterGraphics()}enableClusterBrowsing(){var d=this;return(0,T.Z)(function*(){const{view:h,selectedFeature:g}=d;"2d"===h?.type?mt(g)?(yield function Go(d){return Li.apply(this,arguments)}(d),yield function Qo(d){return Si.apply(this,arguments)}(d)):K.Z.getLogger(d).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",g):K.Z.getLogger(d).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",g)})()}handleViewClick(d){this.autoOpenEnabled&&this._fetchFeaturesAndOpen(d)}_animationStateChange(d){this.zoomToLocation||(st.disabled="waiting-for-target"===d)}_clearBrowsedClusterGraphics(){const d=[this.selectedClusterBoundaryFeature,this._selectedClusterFeature].filter(bt.pC);this.view?.graphics?.removeMany(d),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(mt(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(d){const{selectedFeature:h,updateLocationEnabled:g}=this;g&&d&&(!h||h.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:d,featureCount:h,featurePage:g,featuresPerPage:y,featureViewModels:v}=this;if(null===g)return;const b=((g-1)*y+h)%h;v.slice(b,b+y).forEach((I,_)=>{I&&(I.graphic??=d[b+_])})}_selectedFeatureChange(d){var h=this;return(0,T.Z)(function*(){const{location:g,updateLocationEnabled:y,view:v}=h;if(d&&v){if(h.browseClusterEnabled)return h._selectedClusterFeature&&(v.graphics.remove(h._selectedClusterFeature),h._selectedClusterFeature=null),mt(d)?void 0:(d.symbol=yield(0,Vn.zd)(d),h._selectedClusterFeature=d,void v.graphics.add(h._selectedClusterFeature));if(d.symbol=yield(0,Vn.zd)(d),!y&&g||!d.geometry){if(y&&!d.geometry){yield h.centerAtLocation();const b=v.center?.clone();b&&(h.location=b)}}else h.location=Ne(d.geometry)}})()}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(d){var h=this;return(0,T.Z)(function*(){const{pendingFeatures:g}=yield h._fetchFeaturesWithController({mapPoint:d});h.promises=g})()}_destroyFeatureVMs(){this.featureViewModels.forEach(d=>d&&!d.destroyed&&d.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:d,features:h,featureViewModels:g,view:y}=this;if(mt(d)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!h?.length)return;const v=g.slice(0),b=[];h.forEach((M,I)=>{if(!M)return;let _=null;if(v.some((E,P)=>(E&&E.graphic===M&&(_=E,v.splice(P,1)),!!_)),_)b[I]=_;else{const E=new Ii({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:y?.spatialReference,graphic:M===d?M:null,location:this.location,map:y?.map,view:y});b[I]=E}}),v.forEach(M=>M&&!M.destroyed&&M.destroy()),this._set("featureViewModels",b)}_getScreenPoint(d,h){var g=this;return(0,T.Z)(function*(){const{view:y}=g;yield y?.when();const v=d?.spatialReference,b=y?.spatialReference;return v&&b?(yield(0,Ai.initializeProjection)(v,b,null,h),y.toScreen(d)):null})()}_cancelFetchingFeatures(){const d=this._fetchFeaturesController;d&&d.abort(),this._fetchFeaturesController=null}_projectScreenPointAndFetchFeatures({mapPoint:d,screenPoint:h,event:g,signal:y}){var v=this;return(0,T.Z)(function*(){return v.fetchFeatures(h??(yield v._getScreenPoint(d??v.location,{signal:y})),{signal:y,event:g})})()}_fetchFeaturesWithController({mapPoint:d,screenPoint:h,event:g}){this._cancelFetchingFeatures();const y=new AbortController,{signal:v}=y;this._fetchFeaturesController=y;const b=this._projectScreenPointAndFetchFeatures({mapPoint:d,screenPoint:h,signal:v,event:g});return b.catch(()=>{}).then(()=>{this._fetchFeaturesController=null}),b}_fetchFeaturesAndOpen(d){var h=this;return(0,T.Z)(function*(){const{mapPoint:g,screenPoint:y}=d,{view:v}=h;h._locationScaleHandle?.remove(),h._locationScaleHandle=(0,x.YP)(()=>h.view?.scale,()=>h._debouncedLocationUpdate(g).catch(M=>{(0,he.D_)(M)||K.Z.getLogger(h).error(M)}));const{pendingFeatures:b}=yield h._fetchFeaturesWithController({mapPoint:g,screenPoint:y,event:d});v?.popup&&"open"in v.popup&&v.popup.open({location:g??void 0,promises:b})})()}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getLayerView(d,h){return(0,T.Z)(function*(){return yield d.when(),d.whenLayerView(h)})()}_getHighlightLayer(d){const{layer:h,sourceLayer:g}=d;return g&&"layer"in g&&g.layer?g.layer:"map-notes"===g?.type||"subtype-group"===g?.type?g:h}_getHighlightTarget(d,h,g){if(function er(d,h){return"building-scene"===d||"2d"===h&&("map-image"===d||"tile"===d||"imagery"===d||"imagery-tile"===d)}(h.type,g))return d;const y=d.getObjectId();if(null!=y)return y;const v="imagery"===h.type?void 0:"objectIdField"in h?h.objectIdField||Zn.d:null,b=d.attributes;return b&&v&&b[v]||d}_mapIncludesLayer(d){return!!this.view?.map?.allLayers?.includes(d)}_highlightActiveFeature(){var d=this;return(0,T.Z)(function*(){const h="highlight-active-feature";d.removeHandles(h);const{highlightEnabled:g,view:y,activeFeature:v,visible:b}=d;if(!(v&&y&&g&&b))return;const M=d._getHighlightLayer(v);if(!(M&&M instanceof $n.Z&&d._mapIncludesLayer(M)))return;const I=d._getLayerView(y,M);d._highlightActiveFeaturePromise=I;const _=yield I;if(!(_&&(0,Dn.tl)(_)&&d._highlightActiveFeaturePromise===I&&d.activeFeature&&d.highlightEnabled))return;const E=_.highlight(d._getHighlightTarget(v,M,y.type));d.addHandles(E,h)})()}_highlightSelectedFeature(){var d=this;return(0,T.Z)(function*(){const h="highlight-selected-feature";d.removeHandles(h);const{selectedFeature:g,highlightEnabled:y,view:v,visible:b}=d;if(!(g&&v&&y&&b))return;const M=d._getHighlightLayer(g);if(!(M&&M instanceof $n.Z&&d._mapIncludesLayer(M)))return;const I=d._getLayerView(v,M);d._highlightSelectedFeaturePromise=I;const _=yield I;if(!(_&&(0,Dn.tl)(_)&&d._highlightSelectedFeaturePromise===I&&d.selectedFeature&&d.highlightEnabled&&d.visible))return;const E=_.highlight(d._getHighlightTarget(g,M,v.type));d.addHandles(E,h)})()}_updateFeatures(d){const{features:h}=this,g=d.filter(y=>!h.includes(y));g?.length&&(this.features=h.concat(g))}};(0,F._)([(0,w.Cb)()],Q.prototype,"_fetchFeaturesController",void 0),(0,F._)([(0,w.Cb)({type:ht})],Q.prototype,"actions",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],Q.prototype,"active",null),(0,F._)([(0,w.Cb)()],Q.prototype,"activeFeature",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],Q.prototype,"allActions",null),(0,F._)([(0,w.Cb)()],Q.prototype,"autoCloseEnabled",void 0),(0,F._)([(0,w.Cb)()],Q.prototype,"autoOpenEnabled",void 0),(0,F._)([(0,w.Cb)()],Q.prototype,"browseClusterEnabled",void 0),(0,F._)([(0,w.Cb)()],Q.prototype,"content",void 0),(0,F._)([(0,w.Cb)({type:ht,readOnly:!0})],Q.prototype,"defaultActions",null),(0,F._)([(0,w.Cb)({type:Boolean})],Q.prototype,"defaultPopupTemplateEnabled",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],Q.prototype,"featureCount",null),(0,F._)([(0,w.Cb)()],Q.prototype,"featurePage",void 0),(0,F._)([(0,w.Cb)({value:[]})],Q.prototype,"features",null),(0,F._)([(0,w.Cb)()],Q.prototype,"featuresPerPage",void 0),(0,F._)([(0,w.Cb)()],Q.prototype,"featureMenuOpen",void 0),(0,F._)([(0,w.Cb)()],Q.prototype,"featureViewModelAbilities",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],Q.prototype,"featureViewModels",void 0),(0,F._)([(0,w.Cb)()],Q.prototype,"highlightEnabled",void 0),(0,F._)([(0,w.Cb)()],Q.prototype,"includeDefaultActions",void 0),(0,F._)([(0,w.Cb)({type:ui.Z})],Q.prototype,"location",null),(0,F._)([(0,w.Cb)({readOnly:!0})],Q.prototype,"pendingPromisesCount",null),(0,F._)([(0,w.Cb)({readOnly:!0})],Q.prototype,"promiseCount",null),(0,F._)([(0,w.Cb)()],Q.prototype,"promises",null),(0,F._)([(0,w.Cb)({readOnly:!0})],Q.prototype,"selectedClusterBoundaryFeature",void 0),(0,F._)([(0,w.Cb)({value:null,readOnly:!0})],Q.prototype,"selectedFeature",null),(0,F._)([(0,w.Cb)({value:-1})],Q.prototype,"selectedFeatureIndex",null),(0,F._)([(0,w.Cb)({readOnly:!0})],Q.prototype,"selectedFeatureViewModel",null),(0,F._)([(0,w.Cb)({readOnly:!0})],Q.prototype,"state",null),(0,F._)([(0,w.Cb)()],Q.prototype,"title",void 0),(0,F._)([(0,w.Cb)()],Q.prototype,"updateLocationEnabled",void 0),(0,F._)([(0,w.Cb)()],Q.prototype,"view",void 0),(0,F._)([(0,w.Cb)()],Q.prototype,"visible",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],Q.prototype,"waitingForContents",null),(0,F._)([(0,w.Cb)({readOnly:!0})],Q.prototype,"waitingForResult",null),(0,F._)([(0,w.Cb)()],Q.prototype,"zoomFactor",void 0),(0,F._)([(0,w.Cb)()],Q.prototype,"zoomToLocation",void 0),(0,F._)([(0,w.Cb)()],Q.prototype,"centerAtLocation",null),Q=(0,F._)([(0,W.j)("esri.widgets.Features.FeaturesViewModel")],Q);const Zi=Q;let He=class extends R.Z{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!1,this.featureNavigation=!0,this.flow=!0,this.heading=!0,this.spinner=!0}};(0,F._)([(0,w.Cb)({type:Boolean,nonNullable:!0})],He.prototype,"actionBar",void 0),(0,F._)([(0,w.Cb)({type:Boolean,nonNullable:!0})],He.prototype,"closeButton",void 0),(0,F._)([(0,w.Cb)({type:Boolean,nonNullable:!0})],He.prototype,"collapseButton",void 0),(0,F._)([(0,w.Cb)({type:Boolean,nonNullable:!0})],He.prototype,"featureNavigation",void 0),(0,F._)([(0,w.Cb)({type:Boolean,nonNullable:!0})],He.prototype,"flow",void 0),(0,F._)([(0,w.Cb)({type:Boolean,nonNullable:!0})],He.prototype,"heading",void 0),(0,F._)([(0,w.Cb)({type:Boolean,nonNullable:!0})],He.prototype,"spinner",void 0),He=(0,F._)([(0,W.j)("esri.widgets.Features.FeaturesVisibleElements")],He);const zn=He;var jn=C(42358);const Wn="selected-index",Hn="features-spinner";let ne=class extends(Rn(V.Z)){constructor(d,h){var g;super(d,h),g=this,this._featureMenuIntersectionObserverCallback=([y])=>{y?.isIntersecting&&null!=this.viewModel.featurePage&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._featureMenuIntersectionObserverNode=null,this._focusOn=null,this._spinner=null,this._feature=null,this._relatedRecordsFlowItems=new oe.Z,this._relatedRecordsWidget=new Vo({flowItems:this._relatedRecordsFlowItems}),this._rootFlowItemNode=null,this._featureMenuViewportNode=null,this._actionBarMenuNode=null,this.collapsed=!1,this.icon=null,this.featureNavigationTop=!1,this.headerActions=new ht,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.responsiveActionsEnabled=!1,this.viewModel=new Zi,this.visibleElements=new zn,this._renderAction=(y,v)=>{const b=this._getActionTitle(y),{type:M,active:I,uid:_,disabled:E,indicator:P}=y;return y.visible?(0,A.u)("calcite-action",{active:"toggle"===M&&y.value,appearance:"solid",bind:this,"data-action-uid":_,disabled:E,icon:this._getActionIcon(y),indicator:P,key:`action-${v}`,loading:I,onclick:this._triggerAction,scale:"s",text:b,title:this._hideActionText?b:void 0},this._getFallbackIcon(y)):null},this._openFeatureMenu=()=>{this.featureMenuOpen=!0,this._focusOn="menu-flow-item"},this._previousFeature=()=>{this.viewModel.selectedFeatureIndex--},this._nextFeature=()=>{this.viewModel.selectedFeatureIndex++},this._handleFeatureMenuBack=()=>{this.featureMenuOpen&&(this._focusOn="root-flow-item",this.featureMenuOpen=!1)},this._focusFlowItemNode=y=>{this._focusOn===y&&requestAnimationFrame((0,T.Z)(function*(){switch(y){case"menu-flow-item":yield g._featureMenuViewportNode?.setFocus();break;case"root-flow-item":yield g._rootFlowItemNode?.setFocus()}g._focusOn=null}))},this._focusFlowItemNodeThrottled=we(this._focusFlowItemNode,50),this._displaySpinnerThrottled=we(()=>this._displaySpinner(),0),this._addSelectedFeatureIndexHandle(),this.addHandles([this._displaySpinnerThrottled,this._focusFlowItemNodeThrottled,(0,x.YP)(()=>this.viewModel?.active,()=>this._toggleScreenLocationEnabled()),(0,x.YP)(()=>this.viewModel?.active,y=>this._relatedRecordsWidget.closed=!y),(0,x.YP)(()=>this.visibleElements?.closeButton,y=>this._relatedRecordsWidget.closable=y),(0,x.YP)(()=>this.visibleElements?.spinner,y=>this._spinnerEnabledChange(y)),(0,x.YP)(()=>this.viewModel?.view,(y,v)=>this._viewChange(y,v)),(0,x.YP)(()=>this.viewModel?.view?.ready,(y,v)=>this._viewReadyChange(y??!1,v??!1)),(0,x.YP)(()=>[this.viewModel?.waitingForResult,this.viewModel?.location],()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),(0,x.YP)(()=>this.viewModel?.screenLocation,()=>this._closeOpenActionMenu()),(0,x.YP)(()=>this.selectedFeatureWidget,()=>this._destroyRelatedRecordsFlowItemWidgets()),(0,x.YP)(()=>{const y=this.selectedFeatureWidget?.viewModel;return[y?.title,y?.state]},()=>this._setTitleFromFeatureWidget()),(0,x.YP)(()=>{const y=this.selectedFeatureWidget?.viewModel;return[y?.content,y?.state]},()=>this._setContentFromFeatureWidget()),(0,x.YP)(()=>this.viewModel?.featureViewModels,()=>this._featureMenuViewportScrollTop()),this._relatedRecordsWidget.on("close",()=>this.close()),this._relatedRecordsWidget.on("exit",()=>this._destroyRelatedRecordsFlowItemWidgets()),this._relatedRecordsWidget.on("open-related-feature",({feature:y})=>this._openRelatedFeature(y))])}loadDependencies(){return(0,gt.h)({action:()=>Promise.all([C.e(6203),C.e(6554),C.e(8346),C.e(2573)]).then(C.bind(C,52573)),"action-bar":()=>Promise.all([C.e(6203),C.e(6554),C.e(8346),C.e(2561),C.e(9342),C.e(4792),C.e(8592),C.e(7533)]).then(C.bind(C,67533)),"action-group":()=>Promise.all([C.e(6203),C.e(6554),C.e(8346),C.e(2561),C.e(9342),C.e(4792),C.e(8592),C.e(9758)]).then(C.bind(C,89758)),button:()=>Promise.all([C.e(6203),C.e(6554),C.e(9909),C.e(6352)]).then(C.bind(C,46352)),flow:()=>C.e(8178).then(C.bind(C,58178)),"flow-item":()=>Promise.all([C.e(6203),C.e(6554),C.e(8346),C.e(2561),C.e(9342),C.e(4792),C.e(8592),C.e(9922)]).then(C.bind(C,59922)),list:()=>Promise.all([C.e(6203),C.e(6554),C.e(9909),C.e(3560),C.e(8592),C.e(9208)]).then(C.bind(C,69208)),"list-item":()=>Promise.all([C.e(6203),C.e(6554),C.e(8346),C.e(8592),C.e(4141)]).then(C.bind(C,94141)),"list-item-group":()=>Promise.all([C.e(8592),C.e(7400)]).then(C.bind(C,27400)),loader:()=>C.e(5210).then(C.bind(C,5210))})}destroy(){this._destroyRelatedRecordsFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver?.disconnect(),this._relatedRecordsWidget?.destroy()}get _hideActionText(){if(!this.responsiveActionsEnabled)return!1;const d=this.view?.widthBreakpoint;return"xsmall"===d||"small"===d||"medium"===d}get _featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get _isCollapsed(){return this._collapseEnabled&&this.collapsed}get _collapseEnabled(){return this.visibleElements.collapseButton&&!!this.title&&!!this.content}get content(){return this.viewModel.content}set content(d){this.viewModel.content=d}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(d){this.viewModel.featureMenuOpen=d}get features(){return this.viewModel.features}set features(d){this.viewModel.features=d}get location(){return this.viewModel.location}set location(d){this.viewModel.location=d}get label(){return this.messages?.widgetLabel??""}set label(d){this._overrideIfSome("label",d)}get promises(){return this.viewModel.promises}set promises(d){this.viewModel.promises=d}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(d){this.viewModel.selectedFeatureIndex=d}get selectedFeatureWidget(){const{_feature:d,headingLevel:h,_relatedRecordsFlowItems:g}=this,{selectedFeatureViewModel:y}=this.viewModel,v={title:!1};return y?(d?(d.viewModel=y,d.visibleElements=v):this._feature=new So({flowItems:g,headingLevel:h+1,viewModel:y,visibleElements:v}),this._feature):null}get title(){return this.viewModel.title}set title(d){this.viewModel.title=d}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(d){this.viewModel.updateLocationEnabled=d}get view(){return this.viewModel.view}set view(d){this.viewModel.view=d}get visible(){return this.viewModel.visible}set visible(d){this.viewModel.visible=d}blur(){const{active:d}=this.viewModel;d?this._rootFlowItemNode?.blur():K.Z.getLogger(this).warn("Features can only be blurred when currently active.")}clear(){return this.viewModel.clear()}close(){this.viewModel.visible=!1}fetchFeatures(d,h){return this.viewModel.fetchFeatures(d,h)}focus(){const{active:d}=this.viewModel;d?this._setFocusOn():K.Z.getLogger(this).warn("Features can only be focused when currently active.")}next(){return this.viewModel.next()}open(d){this.removeHandles(Wn),this.set({collapsed:d?.collapsed??!1}),this.viewModel.open(d),this.addHandles((0,x.gx)(()=>!this.viewModel.waitingForResult,()=>this._addSelectedFeatureIndexHandle(),{once:!0}))}previous(){return this.viewModel.previous()}triggerAction(d){return this.viewModel.triggerAction(d)}render(){return(0,A.u)("div",{bind:this,class:this.classes(ve.base,Y.z.widget,Y.z.panel),onkeydown:this._onMainKeydown},this._renderHeader(),this._renderContentContainer())}_renderFeatureNavigation(){return[this._renderPagination(),this._renderFeatureMenuButton()]}_renderHeader(){return!this.featureMenuOpen&&this.featureNavigationTop&&this._featureNavigationVisible?(0,A.u)("div",{class:ve.header,key:"header-actions"},this._renderFeatureNavigation()):null}_renderFooter(){return this.featureMenuOpen||this.featureNavigationTop||!this._featureNavigationVisible?null:(0,A.u)("div",{class:ve.footer,key:"footer-actions",slot:"footer"},this._renderFeatureNavigation())}_renderFeatureMenuButton(){const{messages:d,viewModel:h}=this,{featureCount:g,selectedFeatureIndex:y,pendingPromisesCount:v}=h;return(0,A.u)("calcite-action",{appearance:"solid",bind:this,icon:"list",key:"feature-menu-button",label:d.selectFeature,loading:v>0,onclick:this._openFeatureMenu,scale:"s",text:(0,Je.n)(d.pageText,{index:(0,ue.uf)(y+1),total:(0,ue.uf)(g)}),textEnabled:!0,title:d.selectFeature})}_renderPagination(){const{previous:d,next:h}=this.messagesCommon.pagination;return(0,A.u)("calcite-action-bar",{class:ve.paginationActionBar,expandDisabled:!0,key:"pagination-action-bar",layout:"horizontal",overflowActionsDisabled:!0,scale:"s"},(0,A.u)("calcite-action-group",{scale:"s"},(0,A.u)("calcite-action",{appearance:"solid",class:ve.paginationPrevious,icon:"chevron-left",iconFlipRtl:!0,label:d,onclick:this._previousFeature,scale:"s",text:d,title:d}),(0,A.u)("calcite-action",{appearance:"solid",icon:"chevron-right",iconFlipRtl:!0,label:h,onclick:this._nextFeature,scale:"s",text:h,title:h})))}_renderFeatureMenuItem(d){const{selectedFeatureViewModel:h,featureViewModels:g}=this.viewModel,y=d===h,v=g.indexOf(d);return(0,A.u)("calcite-list-item",{bind:this,"data-feature-index":v,key:`feature-menu-item-${d.uid}`,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onmouseleave:this._removeActiveFeature,onmouseover:this._setActiveFeature,selected:y,onCalciteListItemSelect:this._selectFeature},(0,A.u)("span",{innerHTML:d.title||this.messagesCommon.untitled,slot:"content"}))}_groupResultsByLayer(){const{featureViewModels:d}=this.viewModel,h=new Map;return d.forEach(g=>{const y=g?.graphic;if(!y)return;const v=y.sourceLayer??y.layer,b=h.get(v)??[];h.set(v,[...b,g])}),h}_renderFeatureMenu(){const{featureViewModels:d}=this.viewModel,h=this._groupResultsByLayer();return d.length?(0,A.u)("calcite-list",{selectionAppearance:"icon",selectionMode:"single"},Array.from(h.keys()).map(g=>(0,A.u)("calcite-list-item-group",{heading:g?.title??this.messagesCommon.untitled,key:g?.uid||"untitled"},h.get(g)?.map(y=>this._renderFeatureMenuItem(y))))):null}_renderHeaderAction(d,h){return d.visible?(0,A.u)("calcite-action",{active:"toggle"===d.type&&d.value,appearance:"solid",bind:this,"data-action-uid":d.uid,disabled:d.disabled,icon:d.icon||"",indicator:d.indicator,key:`header-action-${h}`,loading:d.active,onclick:this._triggerHeaderAction,scale:"m",slot:"header-actions-end",text:d.title||"",title:d.title||""}):null}_renderHeaderActions(){return this.headerActions.map((d,h)=>this._renderHeaderAction(d,h)).toArray()}_renderContentFeature(){const{headingLevel:d,visibleElements:h,_isCollapsed:g,_collapseEnabled:y,featureNavigationTop:v}=this,{title:b,active:M}=this.viewModel,I=h.heading&&b?b:"";return(0,A.u)("calcite-flow-item",{afterCreate:this._storeRootFlowItemNode,afterUpdate:this._focusRootFlowItemNode,bind:this,class:this.classes({[ve.contentFeature]:!0,[ve.flowItemCollapsed]:g}),closable:h.closeButton,closed:!M,collapsed:g,collapseDirection:v?"down":"up",collapsible:y,headingLevel:d,key:"root-flow-item",onCalciteFlowItemClose:this.close,onCalciteFlowItemToggle:this._handleCollapseToggle},I?(0,A.u)(ni.X,{class:this.classes(ve.featuresHeading,Y.z.heading),innerHTML:I,key:"header-content",level:this.headingLevel,slot:"header-content"}):null,this._renderHeaderActions(),this._renderActionBar(),g?null:(0,A.u)("div",{class:this.classes(ve.container,ve.contentContainer)},this._renderContent()),this._renderFooter())}_renderFeatureMenuContainer(){const{viewModel:d,featureMenuOpen:h,messages:g,messagesCommon:y}=this,{active:v,featureViewModels:b,pendingPromisesCount:M}=d;return h?(0,A.u)("calcite-flow-item",{afterCreate:this._storeFeatureMenuFlowItemNode,afterUpdate:this._focusFeatureMenuFlowItemNode,bind:this,closable:!1,closed:!v,description:(0,Je.n)(g.total,{total:b.length}),heading:g.selectFeature,key:"feature-menu",loading:d.waitingForContents,onCalciteFlowItemBack:I=>{I.preventDefault(),this._handleFeatureMenuBack()}},M>0?(0,A.u)("calcite-loader",{class:ve.loader,inline:!0,key:"feature-menu-loader",label:y.loading,scale:"m",slot:"header-actions-end"}):null,(0,A.u)("div",{class:ve.container},this._renderFeatureMenu()),(0,A.u)("div",{afterCreate:this._featureMenuIntersectionObserverCreated,bind:this,class:ve.featureMenuObserver}),(0,A.u)("calcite-button",{appearance:"transparent",onclick:this._handleFeatureMenuBack,slot:"footer-actions",width:"full"},y.back)):null}_renderContentContainer(){const d=[this._renderContentFeature(),this._renderFeatureMenuContainer(),this._relatedRecordsWidget.render()];return this.visibleElements.flow?(0,A.u)("calcite-flow",{key:"content-container"},d):d}_getFallbackIcon(d){const{className:h,icon:g}=d;if(g)return null;const y=(0,rt.b$)({action:d,feature:this.selectedFeature}),v={[ve.icon]:!!h,[ve.actionImage]:!!y};return h&&(v[h]=!0),y||h?(0,A.u)("span",{"aria-hidden":"true",class:this.classes(ve.icon,v),key:"icon",styles:(0,rt.uS)(y)}):null}_renderActionBar(){return!this._isCollapsed&&this.visibleElements.actionBar&&this.viewModel.allActions?.length?(0,A.u)("calcite-action-bar",{expandDisabled:!0,expanded:!this._hideActionText,key:"header-action-bar",scale:"s",slot:"action-bar"},(0,A.u)("calcite-action-group",{afterCreate:d=>this._actionBarMenuNode=d,overlayPositioning:"fixed",scale:"s"},this._renderActions())):null}_renderActions(){return this.viewModel.allActions.toArray().map(this._renderAction)}_renderContent(){const d=this.viewModel?.content;return d?"string"==typeof d?(0,A.u)("div",{class:ce.contentNode,innerHTML:d,key:d}):this.renderNodeContent(d):null}_setFocusOn(){this.renderNow(),requestAnimationFrame(()=>{this._focusOn=this.featureMenuOpen?"menu-flow-item":"root-flow-item"})}_handleCollapseToggle(){this.collapsed=!this.collapsed}_openRelatedFeature(d){var h=this;return(0,T.Z)(function*(){yield d.viewModel.updateGeometry();const g=d.graphic,y=g?.geometry;if(null==y||null==g)return;h._destroyRelatedRecordsFlowItemWidgets(),yield h.viewModel.zoomTo({target:y});const v=Ne(y);h.open({features:[g],location:v??void 0})})()}_focusRootFlowItemNode(){this._focusFlowItemNodeThrottled("root-flow-item")}_focusFeatureMenuFlowItemNode(){this._focusFlowItemNodeThrottled("menu-flow-item")}_storeRootFlowItemNode(d){this._rootFlowItemNode=d,this._focusFlowItemNodeThrottled("root-flow-item")}_storeFeatureMenuFlowItemNode(d){this._featureMenuViewportNode=d,this._focusFlowItemNodeThrottled("menu-flow-item")}_setActiveFeature(d){const{viewModel:h}=this;h.activeFeature=h.features?.[d.currentTarget["data-feature-index"]]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_selectFeature(d){const h=d.currentTarget["data-feature-index"];isNaN(h)||(this.viewModel.selectedFeatureIndex=h),this._handleFeatureMenuBack()}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(d){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(d),this._featureMenuIntersectionObserverNode=d}_getActionIcon(d){return d.icon?d.icon:d.image||d.className?void 0:"question"}_getActionTitle(d){const{messages:h,selectedFeature:g,messagesCommon:y}=this,{id:v}=d,b=g?.attributes,M=d.title??"",I="zoom-to-feature"===v?(0,Je.n)(M,{messages:h}):"remove-selected-feature"===v?(0,Je.n)(M,{messages:y}):"zoom-to-clustered-features"===v||"browse-clustered-features"===v?(0,Je.n)(M,{messages:h}):d.title;return I&&b?(0,Je.n)(I,b):I??""}_onMainKeydown(d){const{key:h}=d;"ArrowLeft"===h&&(d.stopPropagation(),this._handleFeatureMenuBack(),this.previous()),"ArrowRight"===h&&(d.stopPropagation(),this._handleFeatureMenuBack(),this.next())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&this._featureMenuViewportNode.scrollContentTo({top:0})}_setContentFromFeatureWidget(){const{selectedFeatureWidget:d}=this;d&&(this.viewModel.content=d)}_setTitleFromFeatureWidget(){const{selectedFeatureWidget:d,messagesCommon:h}=this,g=d?.viewModel;d&&(this.viewModel.title="error"===g?.state?h?.errorMessage:g?.title||"")}_addSelectedFeatureIndexHandle(){const d=(0,x.YP)(()=>this.viewModel?.selectedFeatureIndex,(h,g)=>this._selectedFeatureIndexUpdated(h,g));this.addHandles(d,Wn)}_selectedFeatureIndexUpdated(d,h){const{featureCount:g}=this.viewModel;g&&d!==h&&-1!==d&&(this._destroyRelatedRecordsFlowItemWidgets(),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_triggerHeaderAction(d){const h=d.currentTarget;if(h.disabled)return;const g=h.dataset.actionUid,y=this.headerActions.find(({uid:v})=>v===g);y&&!y.disabled&&("toggle"===y?.type&&(y.value=!y.value),this.emit("trigger-header-action",{action:y}))}_triggerAction(d){const h=d.currentTarget;if(h.disabled)return;const g=h.dataset.actionUid,{allActions:y}=this.viewModel,v=y.findIndex(M=>M.uid===g),b=y.at(v);b&&"toggle"===b.type&&(b.value=!b.value),this.viewModel.triggerAction(v)}_createSpinner(d){d&&(this._spinner=new Zo({view:d}),d.ui.add(this._spinner,{key:Hn,position:"manual",internal:!0}))}_wireUpView(d){this._destroySpinner(),d&&this.visibleElements?.spinner&&this._createSpinner(d)}_hideSpinner(){const{_spinner:d}=this;d&&(d.location=null,d.hide())}_viewReadyChange(d,h){d?this._wireUpView(this.viewModel?.view):h&&this.viewModel.clear()}_viewChange(d,h){d&&h&&this.viewModel.clear()}_destroySelectedFeatureWidget(){const{_feature:d}=this;d&&(d.viewModel=null,!d.destroyed&&d.destroy()),this._feature=null}_closeOpenActionMenu(){const{_actionBarMenuNode:d}=this;d&&(d.menuOpen=!1)}_destroyRelatedRecordsFlowItemWidgets(){this._relatedRecordsFlowItems.removeAll().forEach(d=>{"showAllEnabled"in d.viewModel&&(d.viewModel.showAllEnabled=!1),d.viewModel=null,d.destroy()})}_toggleScreenLocationEnabled(){const{viewModel:d}=this;d&&(d.screenLocationEnabled=d.active)}_displaySpinner(){const{_spinner:d}=this;if(!d)return;const{location:h,waitingForResult:g}=this.viewModel;g&&h?d.show({location:h}):d.hide()}_destroySpinner(){const{_spinner:d,view:h}=this;d&&(h?.ui?.remove(d,Hn),d.destroy(),this._spinner=null)}_spinnerEnabledChange(d){this._destroySpinner(),d&&this._createSpinner(this.viewModel?.view)}};(0,F._)([(0,w.Cb)()],ne.prototype,"_focusOn",void 0),(0,F._)([(0,w.Cb)()],ne.prototype,"_relatedRecordsFlowItems",void 0),(0,F._)([(0,w.Cb)()],ne.prototype,"_hideActionText",null),(0,F._)([(0,w.Cb)()],ne.prototype,"_featureNavigationVisible",null),(0,F._)([(0,w.Cb)()],ne.prototype,"_isCollapsed",null),(0,F._)([(0,w.Cb)()],ne.prototype,"_collapseEnabled",null),(0,F._)([(0,w.Cb)()],ne.prototype,"collapsed",void 0),(0,F._)([(0,w.Cb)()],ne.prototype,"content",null),(0,F._)([(0,w.Cb)()],ne.prototype,"icon",void 0),(0,F._)([(0,w.Cb)()],ne.prototype,"featureMenuOpen",null),(0,F._)([(0,w.Cb)()],ne.prototype,"featureNavigationTop",void 0),(0,F._)([(0,w.Cb)()],ne.prototype,"features",null),(0,F._)([(0,w.Cb)({type:ht})],ne.prototype,"headerActions",void 0),(0,F._)([(0,w.Cb)()],ne.prototype,"headingLevel",void 0),(0,F._)([(0,w.Cb)()],ne.prototype,"location",null),(0,F._)([(0,w.Cb)()],ne.prototype,"label",null),(0,F._)([(0,w.Cb)(),(0,Ze.H)("esri/widgets/Features/t9n/Features")],ne.prototype,"messages",void 0),(0,F._)([(0,w.Cb)(),(0,Ze.H)("esri/t9n/common")],ne.prototype,"messagesCommon",void 0),(0,F._)([(0,w.Cb)()],ne.prototype,"promises",null),(0,F._)([(0,w.Cb)()],ne.prototype,"responsiveActionsEnabled",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],ne.prototype,"selectedFeature",null),(0,F._)([(0,w.Cb)()],ne.prototype,"selectedFeatureIndex",null),(0,F._)([(0,w.Cb)({readOnly:!0})],ne.prototype,"selectedFeatureWidget",null),(0,F._)([(0,w.Cb)()],ne.prototype,"title",null),(0,F._)([(0,w.Cb)()],ne.prototype,"updateLocationEnabled",null),(0,F._)([(0,w.Cb)()],ne.prototype,"view",null),(0,F._)([(0,w.Cb)({type:Zi}),(0,jn.s)(["triggerAction","trigger-action"])],ne.prototype,"viewModel",void 0),(0,F._)([(0,w.Cb)({type:zn,nonNullable:!0})],ne.prototype,"visibleElements",void 0),(0,F._)([(0,w.Cb)()],ne.prototype,"visible",null),ne=(0,F._)([(0,W.j)("esri.widgets.Features")],ne);const nr=ne,De="esri-popup",ft=`${De}--is-docked`,fe={base:De,main:`${De}__main-container`,shadow:`${De}--shadow`,isDocked:ft,isDockedTopLeft:`${ft}-top-left`,isDockedTopCenter:`${ft}-top-center`,isDockedTopRight:`${ft}-top-right`,isDockedBottomLeft:`${ft}-bottom-left`,isDockedBottomCenter:`${ft}-bottom-center`,isDockedBottomRight:`${ft}-bottom-right`,alignTopCenter:`${De}--aligned-top-center`,alignBottomCenter:`${De}--aligned-bottom-center`,alignTopLeft:`${De}--aligned-top-left`,alignBottomLeft:`${De}--aligned-bottom-left`,alignTopRight:`${De}--aligned-top-right`,alignBottomRight:`${De}--aligned-bottom-right`,pointer:`${De}__pointer`,pointerDirection:`${De}__pointer-direction`};let Vi=class extends Zi{constructor(d){super(d)}};Vi=(0,F._)([(0,W.j)("esri.widgets.Popup.PopupViewModel")],Vi);const Yn=Vi;let qe=class extends R.Z{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!0,this.featureNavigation=!0,this.heading=!0,this.spinner=!0}};(0,F._)([(0,w.Cb)({type:Boolean,nonNullable:!0})],qe.prototype,"actionBar",void 0),(0,F._)([(0,w.Cb)({type:Boolean,nonNullable:!0})],qe.prototype,"closeButton",void 0),(0,F._)([(0,w.Cb)({type:Boolean,nonNullable:!0})],qe.prototype,"collapseButton",void 0),(0,F._)([(0,w.Cb)({type:Boolean,nonNullable:!0})],qe.prototype,"featureNavigation",void 0),(0,F._)([(0,w.Cb)({type:Boolean,nonNullable:!0})],qe.prototype,"heading",void 0),(0,F._)([(0,w.Cb)({type:Boolean,nonNullable:!0})],qe.prototype,"spinner",void 0),qe=(0,F._)([(0,W.j)("esri.widgets.Features.PopupVisibleElements")],qe);const Di=qe,Gn={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};let ee=class extends V.Z{constructor(d,h){super(d,h),this._dockAction=new de.Z({id:"popup-dock-action"}),this._featuresWidget=new nr({responsiveActionsEnabled:!0}),this._containerNode=null,this._mainContainerNode=null,this._pointerOffsetInPx=16,this.alignment="auto",this.collapsed=!1,this.dockEnabled=!1,this.headingLevel=2,this.messages=null,this.viewModel=new Yn,this.visibleElements=new Di}initialize(){this.addHandles([(0,x.YP)(()=>[this.viewModel?.view?.widthBreakpoint,this.dockEnabled],()=>this._handleDockIcon(),x.nn),(0,x.YP)(()=>[this.dockEnabled,this.messages?.undock,this.messages?.dock],()=>this._handleDockEnabled(),x.nn),(0,x.YP)(()=>this.dockOptions,d=>{const{_dockAction:h}=this,g=this._featuresWidget.headerActions;g.remove(h),d.buttonEnabled&&g.add(h)},x.nn),(0,x.YP)(()=>this.viewModel?.screenLocation,()=>this._positionContainer()),(0,x.YP)(()=>[this.viewModel?.active,this.dockEnabled],()=>this._toggleScreenLocationEnabled()),(0,x.YP)(()=>[this.viewModel?.screenLocation,this.viewModel?.view?.padding,this.viewModel?.view?.size,this.viewModel?.active,this.viewModel?.location,this.alignment],()=>this.reposition()),(0,x.YP)(()=>this.viewModel?.view?.size,(d,h)=>this._updateDockEnabledForViewSize(d,h)),(0,x.YP)(()=>this.viewModel?.view,(d,h)=>this._viewChange(d,h)),(0,x.YP)(()=>this.viewModel?.view?.ready,(d,h)=>this._viewReadyChange(d??!1,h??!1)),(0,x.YP)(()=>this.viewModel,()=>this._featuresWidget.viewModel=this.viewModel,x.nn),(0,x.YP)(()=>this._featureNavigationTop,d=>this._featuresWidget.featureNavigationTop=d,x.nn),(0,x.YP)(()=>this.headingLevel,d=>this._featuresWidget.headingLevel=d,x.nn),(0,x.YP)(()=>this.collapsed,d=>this._featuresWidget.collapsed=d,x.nn),(0,x.YP)(()=>this.visibleElements.actionBar,d=>this._featuresWidget.visibleElements.actionBar=!!d,x.nn),(0,x.YP)(()=>this.visibleElements.closeButton,d=>this._featuresWidget.visibleElements.closeButton=!!d,x.nn),(0,x.YP)(()=>this.visibleElements.collapseButton,d=>this._featuresWidget.visibleElements.collapseButton=!!d,x.nn),(0,x.YP)(()=>this.visibleElements.heading,d=>this._featuresWidget.visibleElements.heading=!!d,x.nn),(0,x.YP)(()=>this.visibleElements.spinner,d=>this._featuresWidget.visibleElements.spinner=!!d,x.nn),(0,x.YP)(()=>this.visibleElements.featureNavigation,d=>this._featuresWidget.visibleElements.featureNavigation=!!d,x.nn),(0,x.on)(()=>this._featuresWidget,"trigger-header-action",d=>{d.action===this._dockAction&&(this.dockEnabled=!this.dockEnabled)})])}normalizeCtorArgs(d){const h={...d};return null!=d?.visibleElements&&(h.visibleElements=new Di(d.visibleElements),null!=d.collapseEnabled&&(h.visibleElements.collapseButton=d.collapseEnabled),null!=d.spinnerEnabled&&(h.visibleElements.spinner=d.spinnerEnabled)),h}destroy(){this._dockAction.destroy(),this._featuresWidget?.destroy()}get _featureNavigationTop(){const{currentAlignment:d,currentDockPosition:h}=this;return"bottom-left"===d||"bottom-center"===d||"bottom-right"===d||"top-left"===h||"top-center"===h||"top-right"===h}get actions(){return this.viewModel.actions}set actions(d){this.viewModel.actions=d}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(d){this.viewModel.autoCloseEnabled=d}get autoOpenEnabled(){return(0,q.Mr)(K.Z.getLogger(this),"autoOpenEnabled",{replacement:"MapView/SceneView.popupEnabled",version:"4.27"}),this.viewModel.autoOpenEnabled}set autoOpenEnabled(d){(0,q.Mr)(K.Z.getLogger(this),"autoOpenEnabled",{replacement:"MapView/SceneView.popupEnabled",version:"4.27"}),this.viewModel.autoOpenEnabled=d}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(d){this.viewModel.defaultPopupTemplateEnabled=d}get content(){return this.viewModel.content}set content(d){this.viewModel.content=d}get collapseEnabled(){return(0,q.Mr)(K.Z.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton}set collapseEnabled(d){(0,q.Mr)(K.Z.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton=d}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||Gn}set dockOptions(d){const h={...Gn},g=this.viewModel?.view?.breakpoints,y={};g&&(y.width=g.xsmall,y.height=g.xsmall);const v={...h,...d},b={...h.breakpoint,...y},{breakpoint:M}=v;"object"==typeof M?v.breakpoint={...b,...M}:M&&(v.breakpoint=b),this._set("dockOptions",v),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(d){this.viewModel.featureMenuOpen=d}get features(){return this.viewModel.features}set features(d){this.viewModel.features=d}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(d){this.viewModel.goToOverride=d}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(d){this.viewModel.highlightEnabled=d}get location(){return this.viewModel.location}set location(d){this.viewModel.location=d}get label(){return this.messages?.widgetLabel??""}set label(d){this._overrideIfSome("label",d)}get promises(){return this.viewModel.promises}set promises(d){this.viewModel.promises=d}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(d){this.viewModel.selectedFeatureIndex=d}get selectedFeatureWidget(){return this._featuresWidget.selectedFeatureWidget}get spinnerEnabled(){return(0,q.Mr)(K.Z.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner}set spinnerEnabled(d){(0,q.Mr)(K.Z.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner=d}get title(){return this.viewModel.title}set title(d){this.viewModel.title=d}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(d){this.viewModel.updateLocationEnabled=d}get view(){return this.viewModel.view}set view(d){this.viewModel.view=d}get visible(){return this.viewModel.visible}set visible(d){this.viewModel.visible=d}blur(){const{active:d}=this.viewModel;d||K.Z.getLogger(this).warn("Popup can only be blurred when currently active."),this._featuresWidget.blur()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(d,h){return this.viewModel.fetchFeatures(d,h)}focus(){const{active:d}=this.viewModel;d||K.Z.getLogger(this).warn("Popup can only be focused when currently active."),this.reposition(),requestAnimationFrame(()=>{this._featuresWidget.focus()})}next(){return this.viewModel.next()}open(d){this.set({collapsed:!!d&&!!d.collapsed,featureMenuOpen:!!d&&!!d.featureMenuOpen}),this.viewModel.open(d),this._shouldFocus(d)}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(d){return this.viewModel.triggerAction(d)}render(){const{dockEnabled:d,currentAlignment:h,currentDockPosition:g}=this,{active:y}=this.viewModel,M=this.selectedFeature?.layer?.title,I=this.selectedFeature?.layer?.id;return(0,A.u)("div",{afterCreate:this._positionContainer,afterUpdate:this._positionContainer,bind:this,class:this.classes(fe.base,{[fe.alignTopCenter]:"top-center"===h,[fe.alignBottomCenter]:"bottom-center"===h,[fe.alignTopLeft]:"top-left"===h,[fe.alignBottomLeft]:"bottom-left"===h,[fe.alignTopRight]:"top-right"===h,[fe.alignBottomRight]:"bottom-right"===h,[fe.isDocked]:y&&d,[fe.shadow]:y&&!d,[fe.isDockedTopLeft]:"top-left"===g,[fe.isDockedTopCenter]:"top-center"===g,[fe.isDockedTopRight]:"top-right"===g,[fe.isDockedBottomLeft]:"bottom-left"===g,[fe.isDockedBottomCenter]:"bottom-center"===g,[fe.isDockedBottomRight]:"bottom-right"===g}),"data-layer-id":I,"data-layer-title":M,role:"presentation"},y?[this._renderMainContainer(),this._renderPointer()]:null)}_renderPointer(){return this.dockEnabled?null:(0,A.u)("div",{class:fe.pointer,key:"popup-pointer",role:"presentation"},(0,A.u)("div",{class:this.classes(fe.pointerDirection,fe.shadow)}))}_renderMainContainer(){const{dockEnabled:d}=this;return(0,A.u)("div",{afterCreate:this._setMainContainerNode,afterUpdate:this._setMainContainerNode,bind:this,class:this.classes(fe.main,Y.z.widget,{[fe.shadow]:d})},this._featuresWidget.render())}_shouldFocus(d){var h=this;return(0,T.Z)(function*(){d?.shouldFocus&&(yield(0,x.N1)(()=>!0===h.viewModel?.active),h.focus())})()}_isOutsideView(d){const{popupHeight:h,popupWidth:g,screenLocation:y,side:v,view:b}=d;if(isNaN(g)||isNaN(h)||!b||!y)return!1;const M=b.padding;return"right"===v&&y.x+g/2>b.width-M.right||"left"===v&&y.x-g/2<M.left||"top"===v&&y.y-h<M.top||"bottom"===v&&y.y+h>b.height-M.bottom}_calculateAutoAlignment(d){if("auto"!==d)return d;const{_pointerOffsetInPx:h,_containerNode:g,_mainContainerNode:y,viewModel:v}=this,{screenLocation:b,view:M}=v;if(null==b||!M||!g)return"top-center";function I(se){return parseInt(se.replaceAll(/[^-\d\.]/g,""),10)}const _=y?window.getComputedStyle(y,null):null,E=_?I(_.getPropertyValue("max-height")):0,P=_?I(_.getPropertyValue("height")):0,{height:L,width:S}=g.getBoundingClientRect(),$=S+h,B=Math.max(L,E,P)+h,G=this._isOutsideView({popupHeight:B,popupWidth:$,screenLocation:b,side:"right",view:M}),X=this._isOutsideView({popupHeight:B,popupWidth:$,screenLocation:b,side:"left",view:M}),k=this._isOutsideView({popupHeight:B,popupWidth:$,screenLocation:b,side:"top",view:M}),le=this._isOutsideView({popupHeight:B,popupWidth:$,screenLocation:b,side:"bottom",view:M});return X?k?"bottom-right":"top-right":G?k?"bottom-left":"top-left":k?le?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(d){return"function"==typeof d?d.call(this):d}_getCurrentAlignment(){const{alignment:d,dockEnabled:h}=this;return h||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(d)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(d){const h=["left","right"];return(0,Be.dZ)(this.container)&&h.reverse(),d?.replace(/leading/gi,h[0]).replaceAll(/trailing/gi,h[1])}_callDockPosition(d){return"function"==typeof d?d.call(this):d}_getDockPosition(){return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(this.dockOptions?.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_calculateAutoDockPosition(d){if("auto"!==d)return d;const h=this.viewModel?.view,g=(0,Be.dZ)(this.container)?"top-left":"top-right";if(!h)return g;const y=h.padding||{left:0,right:0,top:0,bottom:0},v=h.width-y.left-y.right,{breakpoints:b}=h;return b&&v<=b.xsmall?"bottom-center":g}_getDockIcon(){const d=this._getDockPosition();if(this.dockEnabled)return"minimize";switch(d){case"top-left":case"bottom-left":return"dock-left";case"top-center":return"maximize";case"bottom-center":return"dock-bottom";default:return"dock-right"}}_handleDockIcon(){this._dockAction.icon=this._getDockIcon()}_handleDockEnabled(){this._dockAction.title=this.dockEnabled?this.messages?.undock:this.messages?.dock}_setMainContainerNode(d){this._mainContainerNode=d}_positionContainer(d=this._containerNode){if(d&&(this._containerNode=d),!this._containerNode)return;const{screenLocation:h}=this.viewModel,{width:g}=this._containerNode.getBoundingClientRect(),y=this._calculatePositionStyle(h,g);y&&Object.assign(this._containerNode.style,y)}_calculateFullWidth(d){const{currentAlignment:h,_pointerOffsetInPx:g}=this;return"top-left"===h||"bottom-left"===h||"top-right"===h||"bottom-right"===h?d+g:d}_calculateAlignmentPosition(d,h,g,y){const{currentAlignment:v,_pointerOffsetInPx:b}=this;if(!g)return;const{padding:M}=g,I=y/2,_=g.height-h,E=g.width-d;return"bottom-center"===v?{top:h+b-M.top,left:d-I-M.left}:"top-left"===v?{bottom:_+b-M.bottom,right:E+b-M.right}:"bottom-left"===v?{top:h+b-M.top,right:E+b-M.right}:"top-right"===v?{bottom:_+b-M.bottom,left:d+b-M.left}:"bottom-right"===v?{top:h+b-M.top,left:d+b-M.left}:"top-center"===v?{bottom:_+b-M.bottom,left:d-I-M.left}:void 0}_calculatePositionStyle(d,h){const{dockEnabled:g,view:y}=this;if(!y)return;if(g)return{left:"",top:"",right:"",bottom:""};if(null==d||!h)return;const v=this._calculateFullWidth(h),b=this._calculateAlignmentPosition(d.x,d.y,y,v);return b?{top:void 0!==b.top?`${b.top}px`:"auto",left:void 0!==b.left?`${b.left}px`:"auto",bottom:void 0!==b.bottom?`${b.bottom}px`:"auto",right:void 0!==b.right?`${b.right}px`:"auto"}:void 0}_viewChange(d,h){d&&h&&(this.close(),this.clear())}_viewReadyChange(d,h){d?this._wireUpView():h&&(this.close(),this.clear())}_wireUpView(){this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(d,h,g){const[y,v]=d,[b,M]=h,{width:I=0,height:_=0}=g??{};return y<=I&&b>I||y>I&&b<=I||v<=_&&M>_||v>_&&M<=_}_updateDockEnabledForViewSize(d,h){if(!d||!h)return;const g=this.viewModel?.view?.padding||{left:0,right:0,top:0,bottom:0},y=g.left+g.right,v=g.top+g.bottom,b=[],M=[];b[0]=d[0]-y,b[1]=d[1]-v,M[0]=h[0]-y,M[1]=h[1]-v;const{dockOptions:I}=this;this._dockingThresholdCrossed(b,M,I.breakpoint)&&this._setDockEnabledForViewSize(I),this._setCurrentDockPosition()}_toggleScreenLocationEnabled(){const{dockEnabled:d,viewModel:h}=this;h&&(h.screenLocationEnabled=h.active&&!d)}_shouldDockAtCurrentViewSize(d){const h=d.breakpoint,g=this.viewModel?.view?.ui;if(!g)return!1;const{width:y,height:v}=g;if(isNaN(y)||isNaN(v)||!h)return!1;const b=h.hasOwnProperty("width")&&y<=(h.width??0),M=h.hasOwnProperty("height")&&v<=(h.height??0);return b||M}_setDockEnabledForViewSize(d){d.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(d))}};(0,F._)([(0,w.Cb)({readOnly:!0})],ee.prototype,"_featureNavigationTop",null),(0,F._)([(0,w.Cb)()],ee.prototype,"actions",null),(0,F._)([(0,w.Cb)()],ee.prototype,"alignment",void 0),(0,F._)([(0,w.Cb)()],ee.prototype,"autoCloseEnabled",null),(0,F._)([(0,w.Cb)()],ee.prototype,"autoOpenEnabled",null),(0,F._)([(0,w.Cb)()],ee.prototype,"defaultPopupTemplateEnabled",null),(0,F._)([(0,w.Cb)()],ee.prototype,"content",null),(0,F._)([(0,w.Cb)()],ee.prototype,"collapsed",void 0),(0,F._)([(0,w.Cb)()],ee.prototype,"collapseEnabled",null),(0,F._)([(0,w.Cb)({readOnly:!0})],ee.prototype,"currentAlignment",null),(0,F._)([(0,w.Cb)({readOnly:!0})],ee.prototype,"currentDockPosition",null),(0,F._)([(0,w.Cb)()],ee.prototype,"dockOptions",null),(0,F._)([(0,w.Cb)()],ee.prototype,"dockEnabled",void 0),(0,F._)([(0,w.Cb)({readOnly:!0})],ee.prototype,"featureCount",null),(0,F._)([(0,w.Cb)()],ee.prototype,"featureMenuOpen",null),(0,F._)([(0,w.Cb)()],ee.prototype,"features",null),(0,F._)([(0,w.Cb)()],ee.prototype,"goToOverride",null),(0,F._)([(0,w.Cb)()],ee.prototype,"headingLevel",void 0),(0,F._)([(0,w.Cb)()],ee.prototype,"highlightEnabled",null),(0,F._)([(0,w.Cb)()],ee.prototype,"location",null),(0,F._)([(0,w.Cb)()],ee.prototype,"label",null),(0,F._)([(0,w.Cb)(),(0,Ze.H)("esri/widgets/Popup/t9n/Popup")],ee.prototype,"messages",void 0),(0,F._)([(0,w.Cb)()],ee.prototype,"promises",null),(0,F._)([(0,w.Cb)({readOnly:!0})],ee.prototype,"selectedFeature",null),(0,F._)([(0,w.Cb)()],ee.prototype,"selectedFeatureIndex",null),(0,F._)([(0,w.Cb)({readOnly:!0})],ee.prototype,"selectedFeatureWidget",null),(0,F._)([(0,w.Cb)()],ee.prototype,"spinnerEnabled",null),(0,F._)([(0,w.Cb)()],ee.prototype,"title",null),(0,F._)([(0,w.Cb)()],ee.prototype,"updateLocationEnabled",null),(0,F._)([(0,w.Cb)()],ee.prototype,"view",null),(0,F._)([(0,w.Cb)({type:Yn}),(0,jn.s)(["triggerAction","trigger-action"])],ee.prototype,"viewModel",void 0),(0,F._)([(0,w.Cb)()],ee.prototype,"visible",null),(0,F._)([(0,w.Cb)({type:Di,nonNullable:!0})],ee.prototype,"visibleElements",void 0),ee=(0,F._)([(0,W.j)("esri.widgets.Popup")],ee);const sr=ee}}]);