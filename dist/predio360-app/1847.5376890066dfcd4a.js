"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[1847],{50978:(ye,I,i)=>{i.d(I,{M:()=>Y,b:()=>z});var o=i(2166),V=i(69960),l=i(65787),d=i(17625),$=i(22355),U=i(16396);function z(k){const h=new $.kG,{vertex:f,fragment:_}=h;(0,o.Sv)(f,k),f.uniforms.add(new l.p("width",v=>v.width)),h.attributes.add(U.T.POSITION,"vec3"),h.attributes.add(U.T.NORMAL,"vec3"),h.attributes.add(U.T.UV0,"vec2"),h.attributes.add(U.T.AUXPOS1,"float"),h.varyings.add("vtc","vec2"),h.varyings.add("vlength","float"),h.varyings.add("vradius","float"),f.code.add(d.H`void main(void) {
vec3 bitangent = normal;
vtc = uv0;
vlength = auxpos1;
vradius = 0.5 * width;
vec4 pos = view * vec4(position + vradius * bitangent * uv0.y, 1.0);
gl_Position = proj * pos;
}`),_.uniforms.add([new l.p("outlineSize",v=>v.outlineSize),new V.N("outlineColor",v=>v.outlineColor),new l.p("stripeLength",v=>v.stripeLength),new V.N("stripeEvenColor",v=>v.stripeEvenColor),new V.N("stripeOddColor",v=>v.stripeOddColor)]);const S=1/Math.sqrt(2);return _.code.add(d.H`
    const float INV_SQRT2 = ${d.H.float(S)};

    vec4 arrowColor(vec2 tc, float len) {
      float d = INV_SQRT2 * (tc.x - abs(tc.y));
      d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));
      d = min(d, 1.0 - abs(tc.y));

      if (d < 0.0) {
        return vec4(0.0);
      } else if (d < outlineSize) {
        return outlineColor;
      } else {
        return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;
      }
    }

    void main(void) {
      vec2 ntc = vec2(vtc.x / vradius, vtc.y);
      vec4 color = arrowColor(ntc, vlength / vradius);
      if (color.a == 0.0) {
        discard;
      }
      gl_FragColor = color;
    }
  `),h}const Y=Object.freeze(Object.defineProperty({__proto__:null,build:z},Symbol.toStringTag,{value:"Module"}))},96212:(ye,I,i)=>{i.r(I),i.d(I,{default:()=>gt});var o=i(17626),V=i(14517),l=i(62208),d=i(77712),z=(i(90912),i(85931),i(76898)),Y=i(39691),k=i(1437),h=i(74554),f=i(72392),_=i(63290),S=i(15572),v=i(32917),b=i(84161),C=i(28093),de=i(44766),x=i(55214),j=i(55915),ce=i(81863),q=i(10049),_e=i(54865),Ae=i(68);const be="esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController",Me=_.Z.getLogger(be);let G=class extends V.Z{constructor(t){super(t),this._unitNormalizer=new Ae.D,this._handles=new f.Z,this._tempStartPosition=(0,C.c)(),this._tempEndPosition=(0,C.c)(),this._tempCornerPosition=(0,C.c)()}initialize(){const t=this.view.spatialReference,e=(0,ce.rS)(t),s=e===ce.GG?ce.wY:e;this._sphericalPCPF=s;const n=(0,j.Up)(t,s);this._unitNormalizer.spatialReference=n?s:t,this._handles.add([(0,v.YP)(()=>({viewData:this.viewData,startPoint:this.analysis.startPoint}),({viewData:a,startPoint:r})=>{a.elevationAlignedStartPoint=this._applyProjectionAndElevationAlignment(r)},v.tX),(0,v.YP)(()=>({viewData:this.viewData,endPoint:this.analysis.endPoint}),({viewData:a,endPoint:r})=>{a.elevationAlignedEndPoint=this._applyProjectionAndElevationAlignment(r)},v.tX),(0,v.YP)(()=>({result:this._computedResult,viewData:this.viewData}),({result:a,viewData:r})=>{r.result=a},v.tX)])}destroy(){this._handles=(0,l.SC)(this._handles)}_applyProjectionAndElevationAlignment(t){if((0,l.Wi)(t))return t;const{spatialReference:e,elevationProvider:s}=this.view,n=(0,_e.G)(t,e,s);return(0,l.Wi)(n)?((0,_e.e)(this.analysis,t.spatialReference,Me),null):n}get _computedResult(){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:e,measurementMode:s}=this.viewData;if((0,l.Wi)(t)||(0,l.Wi)(e))return null;const n=this._euclideanDistances(t,e),a=this._geodesicDistance(t,e,n.horizontal.value),r=s===h.e.Geodesic||s===h.e.Auto&&n.horizontal.value>1e5?"geodesic":"euclidean";return{mode:r,distance:"euclidean"===r?n.direct:a,directDistance:n.direct,horizontalDistance:n.horizontal,verticalDistance:n.vertical,geodesicDistance:a}}_euclideanDistances(t,e){const s=t.clone();s.z=e.z;const n=this._tempStartPosition,a=this._tempEndPosition,r=this._tempCornerPosition,g=this.view.spatialReference,u=this._sphericalPCPF,c=(0,j.Up)(g,u)?u:g;(0,j.KC)(t,n,c),(0,j.KC)(e,a,c),(0,j.KC)(s,r,c);const m=(0,b.i)(n,a),p=(0,b.i)(r,a),L=Math.abs(e.z-t.z),O=ae=>this._unitNormalizer.normalizeDistance(ae),w=O(m),K=O(p),ne=O(L);return{direct:(0,S.EV)(w,"meters"),horizontal:(0,S.EV)(K,"meters"),vertical:(0,S.EV)(ne,"meters")}}_geodesicDistance(t,e,s){const n=t.spatialReference,a=new x.Z({spatialReference:n});a.addPath([t,e]);const r=n.isGeographic&&(0,q.Gb)(n)?(0,q.Jf)([a],"meters")[0]:n.isWebMercator?(0,de.geodesicLength)(a,"meters"):null,g=(0,l.pC)(r)?r:this._fallbackGeodesicDistance(t,e,s);return(0,S.EV)(g,"meters")}_fallbackGeodesicDistance(t,e,s){if((0,j.UY)(t,Ce)&&(0,j.UY)(e,Pe)){const n=new q._q;return(0,q.cA)(n,Ce,Pe),n.distance}return s}};(0,o._)([(0,d.Cb)()],G.prototype,"view",void 0),(0,o._)([(0,d.Cb)()],G.prototype,"analysis",void 0),(0,o._)([(0,d.Cb)()],G.prototype,"viewData",void 0),(0,o._)([(0,d.Cb)()],G.prototype,"_computedResult",null),G=(0,o._)([(0,z.j)(be)],G);const Ce=(0,C.c)(),Pe=(0,C.c)();var P,D,t,De=i(15861),N=i(91558),T=(i(52515),i(51819)),H=i(21286),A=i(84600),X=i(23841),Ee=i(16730),Le=i(67831);(t=P||(P={}))[t.None=0]="None",t[t.Direct=1]="Direct",t[t.Triangle=2]="Triangle",t[t.ProjectedGeodesic=3]="ProjectedGeodesic",function(t){t[t.Auto=0]="Auto",t[t.AboveSegment=1]="AboveSegment",t[t.BelowSegment=2]="BelowSegment"}(D||(D={}));var he=i(495),Q=i(68063),ee=i(87469),ze=i(43703),F=i(4794),te=i(26242),Te=i(53928),Re=i(57521),W=i(40723),Ue=i(19625),xe=i(13934),je=i(60881),Ge=i(5894),R=i(16396),We=i(651),Be=i(91056),ue=i(87601),Ie=i(39114),we=i(88569),Ne=i(12407),ge=i(44835),He=i(41528),Fe=i(50978),fe=i(67969),ve=i(2078);class ie extends Be.A{constructor(e,s,n){super(e,s,n)}initializeProgram(e){return new Ne.$(e.rctx,ie.shader.get().build(this.configuration),Ie.i)}_setPipelineState(e){return(0,ve.sm)({blending:this.configuration.transparent?e===ge.A.NONE?we.wu:(0,we.j7)(e):null,polygonOffset:this.configuration.polygonOffsetEnabled?{factor:0,units:-4}:null,depthTest:{func:fe.wb.LESS},depthWrite:ve.LZ,colorWrite:ve.BK})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return fe.MX.TRIANGLE_STRIP}}ie.shader=new We.J(Fe.M,()=>i.e(3368).then(i.bind(i,3368)));class se extends He.W{constructor(){super(...arguments),this.polygonOffsetEnabled=!1,this.transparent=!1,this.transparencyPassType=ge.A.NONE}}(0,o._)([(0,ue.o)()],se.prototype,"polygonOffsetEnabled",void 0),(0,o._)([(0,ue.o)()],se.prototype,"transparent",void 0),(0,o._)([(0,ue.o)({count:ge.A.COUNT})],se.prototype,"transparencyPassType",void 0);class Ke extends W.F5{constructor(e){super(e,new Ye),this._configuration=new se}getConfiguration(e,s){return this._configuration.polygonOffsetEnabled=this.parameters.polygonOffset,this._configuration.transparent=this.parameters.stripeEvenColor[3]<1||this.parameters.stripeOddColor[3]<1||this.parameters.outlineColor[3]<1,this._configuration.transparencyPassType=s.transparencyPassType,this._configuration}dispose(){}intersect(){}requiresSlot(e,s){return s===xe.H.Color&&e===Ge.r.OPAQUE_MATERIAL}createGLMaterial(e){return new Ze(e)}createBufferWriter(){return new et}}class Ze extends je.Z{beginSlot(e){return this.ensureTechnique(ie,e)}}class Ye extends W.Mt{constructor(){super(...arguments),this.width=32,this.outlineSize=.2,this.outlineColor=(0,F.f)(1,.5,0,1),this.stripeEvenColor=(0,F.f)(1,1,1,1),this.stripeOddColor=(0,F.f)(1,.5,0,1),this.stripeLength=1,this.polygonOffset=!1}}const Xe=(0,Ue.U$)().vec3f(R.T.POSITION).vec3f(R.T.NORMAL).vec2f(R.T.UV0).f32(R.T.AUXPOS1),Qe=(0,C.c)(),Je=(0,C.c)(),$e=(0,C.c)(),ke=(0,C.c)(),qe=(0,C.c)();class et{constructor(){this.vertexBufferLayout=Xe}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 2*(e.indices.get(R.T.POSITION).length/2+1)}write(e,s,n,a,r){const g=n.vertexAttributes.get(R.T.POSITION).data,u=n.vertexAttributes.get(R.T.NORMAL).data,c=g.length/3,m=n&&n.indices&&n.indices.get(R.T.POSITION);m&&m.length!==2*(c-1)&&console.warn("MeasurementArrowMaterial does not support indices");const p=Qe,L=Je,O=$e,w=ke,K=qe,ne=a.position,ae=a.normal,re=a.uv0;let oe=0;for(let M=0;M<c;++M){const pe=3*M;if((0,b.s)(p,g[pe],g[pe+1],g[pe+2]),M<c-1){const Z=3*(M+1);(0,b.s)(L,g[Z],g[Z+1],g[Z+2]),(0,b.s)(K,u[Z],u[Z+1],u[Z+2]),(0,b.n)(K,K),(0,b.b)(O,L,p),(0,b.n)(O,O),(0,b.f)(w,K,O),(0,b.n)(w,w)}const mt=(0,b.i)(p,L);e&&s&&((0,b.m)(p,p,e),(0,b.m)(L,L,e),(0,b.m)(w,w,s));const J=r+2*M,le=J+1;ne.setVec(J,p),ne.setVec(le,p),ae.setVec(J,w),ae.setVec(le,w),re.set(J,0,oe),re.set(J,1,-1),re.set(le,0,oe),re.set(le,1,1),M<c-1&&(oe+=mt)}const vt=a.auxpos1;for(let M=0;M<2*c;++M)vt.set(r+M,oe)}}class tt extends Te._{constructor(e){super(e),this._parameters={arrowWidth:16,arrowOutlineColor:N.Z.toUnitRGBA((0,T.e9)()),arrowStripeEvenColor:N.Z.toUnitRGBA((0,T.RN)()),arrowStripeOddColor:N.Z.toUnitRGBA((0,T.e9)()),arrowSubdivisions:128},this._origin=(0,C.c)(),this._originTransform=(0,ze.c)(),this._arrowCenter=(0,C.c)(),this._renderOccluded=W.yD.OccludeAndTransparent,this._geometry=null,this._stripeLength=1,this._stripesEnabled=!0,this._opacity=1,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._arrowMaterial&&this._arrowMaterial.setParameters({renderOccluded:e}))}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this._geometryChanged()}get stripeLength(){return this._stripeLength}set stripeLength(e){this._stripeLength=e,this.attached&&this._arrowMaterial.setParameters({stripeLength:this._stripeLength})}get stripesEnabled(){return this._stripesEnabled}set stripesEnabled(e){if(this._stripesEnabled=e,this.attached){const s=this.opacity,{arrowStripeEvenColor:n,arrowStripeOddColor:a}=this._parameters,r=(0,H.H)(Oe,this._stripesEnabled?n:a,s);this._arrowMaterial.setParameters({stripeEvenColor:r})}}get opacity(){return this._opacity}set opacity(e){e!==this._opacity&&(this._opacity=e,this._updateArrowOpacity())}createExternalResources(){const{arrowStripeEvenColor:e,arrowStripeOddColor:s,arrowOutlineColor:n}=this._parameters;this._arrowMaterial=new Ke({outlineColor:n,stripeEvenColor:this._stripesEnabled?e:s,stripeOddColor:s,renderOccluded:this.renderOccluded,polygonOffset:!0}),this._handles=new f.Z,this._handles.add((0,v.YP)(()=>this.view.state.camera,()=>{this._viewChanged()}))}destroyExternalResources(){this._arrowMaterial=null,this._handles=(0,l.SC)(this._handles)}forEachExternalMaterial(e){e(this._arrowMaterial)}createGeometries(e){if((0,l.Wi)(this._geometry)||(0,l.Wi)(this._geometry.startRenderSpace)||(0,l.Wi)(this._geometry.endRenderSpace))return;const s=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);s.transformation=this._originTransform,e.addGeometry(s),this._viewChanged()}_createArrowGeometry(e,s,n,a){const r=this.view.renderCoordsHelper,g=[],u=[],c=(m,p)=>{const L=te.WM.get();(0,b.b)(L,m,n),g.push(L),u.push(p)};if("euclidean"===a.type){a.eval(.5,this._arrowCenter);const m=te.WM.get();r.worldUpAtPosition(this._arrowCenter,m),c(e,m),c(s,m)}else{a.eval(.5,this._arrowCenter);const m=this._parameters.arrowSubdivisions+1&-2;for(let p=0;p<m;++p){const L=p/(m-1),O=te.WM.get(),w=te.WM.get();a.eval(L,O),r.worldUpAtPosition(O,w),c(O,w)}}return(0,Re.rh)(this._arrowMaterial,g,u)}_geometryChanged(){this.recreateGeometry()}_viewChanged(){if(this.view.ready&&this.attached&&(0,l.pC)(this._geometry)){const e=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameters({width:this._parameters.arrowWidth*e})}}_updateArrowOpacity(){const e=this.opacity,{arrowStripeEvenColor:s,arrowStripeOddColor:n,arrowOutlineColor:a}=this._parameters,r=(0,H.H)(Oe,this._stripesEnabled?s:n,e),g=(0,H.H)(it,a,e),u=(0,H.H)(st,n,e);this._arrowMaterial.setParameters({stripeEvenColor:r,outlineColor:g,stripeOddColor:u})}}const Oe=(0,F.c)(),it=(0,F.c)(),st=(0,F.c)();var nt=i(77603),B=i(64770),me=i(54889),at=i(56683),rt=i(41840);let E=class extends V.Z{get visible(){return this.analysisView.visible}get viewMode(){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:e}=this.analysisView;if((0,l.Wi)(t)||(0,l.Wi)(e)||t.equals(e))return P.None;const s=this.analysisView.result;if((0,l.Wi)(s))return P.Direct;if("geodesic"===s.mode)return this._requiresGeodesicGuideAt(this._startPosition)||this._requiresGeodesicGuideAt(this._endPosition)?P.ProjectedGeodesic:P.Direct;const{verticalDistance:n,horizontalDistance:a}=s,r=n.value,g=a.value;return Math.min(r/g,g/r)<this.triangleCollapseRatioThreshold?P.Direct:P.Triangle}get actualVisualizedMeasurement(){if((0,l.Wi)(this.analysisView.result))switch(this.analysisView.measurementMode){case h.e.Auto:case h.e.Euclidean:default:return"euclidean";case h.e.Geodesic:return"geodesic"}return this.analysisView.result.mode}get allowVisualElementsOrientationChange(){return(0,l.Wi)(this._triangleOrientationOverride)}set allowVisualElementsOrientationChange(t){(0,l.Wi)(this._triangleOrientationOverride)!==t&&(this._triangleOrientationOverride=(0,l.Wi)(this._triangleOrientationOverride)?this._actualVisualElementsOrientation:null)}get labels(){return{direct:this._segmentLabel,horizontal:"geodesic"===this.actualVisualizedMeasurement?this._segmentLabel:this._horizontalLabel,vertical:this._verticalLabel}}constructor(t){super(t),this._params={triangleColor:N.Z.toUnitRGBA((0,T.e9)(.75)),triangleLineWidth:3,geodesicProjectionLineWidth:2,geodesicProjectionLineColor:N.Z.toUnitRGBA((0,T.e9)(.75)),guideLineWidth:2,guideStippleLengthPixels:6,direcLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12},this._handles=new f.Z,this._segmentVisualElement=null,this._triangleVisualElement=null,this._rightAngleQuad=null,this._projectedGeodesicLine=null,this._geodesicStartHint=null,this._geodesicEndHint=null,this._segmentLabel=null,this._verticalLabel=null,this._horizontalLabel=null,this._startPosition=(0,C.c)(),this._endPosition=(0,C.c)(),this._cornerPosition=(0,C.c)(),this._startPositionAtSeaLevel=(0,C.c)(),this._endPositionAtSeaLevel=(0,C.c)(),this._triangleOrientationOverride=null,this.messages=null,this.loadingMessages=!0,this.visualElementOrientation=D.Auto,this.triangleCollapseRatioThreshold=.03}initialize(){var t=this;const e=this._params,s={attached:!0,view:this.view};this._segmentVisualElement=new tt({...s,geometry:null,renderOccluded:W.yD.OccludeAndTransparent}),this._triangleVisualElement=new ee.r({...s,width:e.triangleLineWidth,color:e.triangleColor,renderOccluded:W.yD.OccludeAndTransparent}),this._rightAngleQuad=new nt.R({...s,color:N.Z.toUnitRGBA((0,T.e9)(.75)),renderOccluded:W.yD.OccludeAndTransparent});const n={...s,polygonOffset:!0,renderOccluded:W.yD.OccludeAndTransparent};this._projectedGeodesicLine=new ee.r({...n,width:e.geodesicProjectionLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:(0,me.z5)(e.guideStippleLengthPixels)}),this._geodesicStartHint=new ee.r({...n,width:e.guideLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:(0,me.z5)(e.guideStippleLengthPixels)}),this._geodesicEndHint=new ee.r({...n,width:e.guideLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:(0,me.z5)(e.guideStippleLengthPixels)});const a={...s,backgroundColor:(0,T.hU)(.6),textColor:(0,T.uu)()};this._segmentLabel=new Q.Kc({...a,fontSize:e.direcLabelFontSize}),this._verticalLabel=new Q.Kc({...a,fontSize:e.verticalLabelFontSize}),this._horizontalLabel=new Q.Kc({...a,fontSize:e.horizontalLabelFontSize}),this._handles.add([(0,v.YP)(()=>{const{elevationAlignedStartPoint:r,elevationAlignedEndPoint:g}=this.analysisView,u=this.view;return{view:u,camera:u.state.camera,viewMode:this.viewMode,elevationAlignedStartPoint:r,elevationAlignedEndPoint:g,orientation:this._actualVisualElementsOrientation,visualizedMeasurement:this.actualVisualizedMeasurement,stripeLength:this._measurementArrowStripeLength}},r=>this._updateGeometryAndViewMode(r),v.tX),(0,v.YP)(()=>({visible:this.visible,viewMode:this.viewMode}),r=>this._updateVisualElementVisibility(r),v.tX),(0,v.YP)(()=>({text:this._labelsText,visualizedMeasurement:this.actualVisualizedMeasurement}),r=>this._updateLabelText(r),v.tX),(0,v.YP)(()=>({visible:this.visible,viewMode:this.viewMode}),r=>this._updateLabelVisibility(r),v.tX),(0,v.YP)(()=>this._measurementArrowStripeLength,r=>this._updateSegmentStripeLength(r),v.tX),(0,at.qe)((0,De.Z)(function*(){return t._updateMessageBundle()}))]),this._updateMessageBundle()}destroy(){this._handles=(0,l.SC)(this._handles),this._segmentVisualElement=(0,l.SC)(this._segmentVisualElement),this._triangleVisualElement=(0,l.SC)(this._triangleVisualElement),this._rightAngleQuad=(0,l.SC)(this._rightAngleQuad),this._projectedGeodesicLine=(0,l.SC)(this._projectedGeodesicLine),this._geodesicStartHint=(0,l.SC)(this._geodesicStartHint),this._geodesicEndHint=(0,l.SC)(this._geodesicEndHint),this._segmentLabel=(0,l.SC)(this._segmentLabel),this._verticalLabel=(0,l.SC)(this._verticalLabel),this._horizontalLabel=(0,l.SC)(this._horizontalLabel),this.set("view",null)}_updateVisualElementVisibility({visible:t,viewMode:e}){if(this._segmentVisualElement.visible=!1,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1,t)switch(e){case P.None:break;case P.Direct:this._segmentVisualElement.visible=!0;break;case P.Triangle:this._segmentVisualElement.visible=!0,this._triangleVisualElement.visible=!0,this._rightAngleQuad.visible=!0;break;case P.ProjectedGeodesic:this._segmentVisualElement.visible=!0,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}}_updateGeometryAndViewMode({view:t,camera:e,viewMode:s,elevationAlignedStartPoint:n,elevationAlignedEndPoint:a,orientation:r,visualizedMeasurement:g,stripeLength:u}){const c=t.renderCoordsHelper;if((0,l.Wi)(c)||(0,l.Wi)(n)||(0,l.Wi)(a)||n.equals(a))return;let m=this._startPosition,p=this._endPosition;c.toRenderCoords(n,m),c.toRenderCoords(a,p);const L=r===D.AboveSegment?1:-1,O=L*(c.getAltitude(p)-c.getAltitude(m));O<0&&(m=this._endPosition,p=this._startPosition);const w="geodesic"===g?new B.u(this._startPosition,this._endPosition,c.spatialReference):new B.y(this._startPosition,this._endPosition);switch(this._segmentVisualElement.geometry=w,this._updateSegmentStripeLength(u),s){case P.Direct:this._updateSegment(w,r);break;case P.Triangle:this._updateSegmentAndTriangle({view:t,camera:e,segment:w,orientation:r,startPosition:m,endPosition:p,deltaSign:L,altitudeDelta:O});break;case P.ProjectedGeodesic:this._updateSegmentAndProjection({view:t,orientation:r,startPosition:m,endPosition:p})}}_updateSegment(t,e){this._segmentLabel.anchor=e===D.AboveSegment?"top":"bottom",this._segmentLabel.geometry={type:"segment",segment:t,sampleLocation:"center"}}_updateSegmentAndTriangle({view:{renderCoordsHelper:t},camera:e,segment:s,orientation:n,startPosition:a,endPosition:r,deltaSign:g,altitudeDelta:u}){const c=this._cornerPosition;t.worldUpAtPosition(a,c),(0,b.g)(c,c,g*Math.abs(u)),(0,b.a)(c,c,a),this._triangleVisualElement.geometry=[[[a[0],a[1],a[2]],[c[0],c[1],c[2]],[r[0],r[1],r[2]]]],this._rightAngleQuad.geometry={previous:a,center:c,next:r};const m=new B.y(a,c),p=new B.y(c,r),L=function ot(t,e,s,n,a){const r=lt,g=dt;a.projectToRenderScreen(s,r),a.projectToRenderScreen(e,g);const u={segment:"bottom",horizontal:"top",vertical:r[0]<g[0]?"left":"right"};{const c=ct,m=ht;if((0,he.c)(t,s,c,a),(0,he.c)(t,e,m,a),(0,Le.h)(c,m)>=Se){const p=Math.sign(c[1])===Math.sign(m[1]);u.segment=p?(0,Q.jB)(u.vertical):u.vertical}else{const p=ut;(0,he.c)(s,e,p,a),(0,Le.h)(p,m)>=Se&&(u.segment=Math.sign(p[0])===Math.sign(m[0])?(0,Q.jB)(u.horizontal):u.horizontal)}}if(n===D.BelowSegment){const c=m=>"top"===m?"bottom":"top";u.segment=c(u.segment),u.horizontal=c(u.horizontal),u.vertical=c(u.vertical)}return u}(a,r,c,n,e);this._segmentLabel.anchor=L.segment,this._segmentLabel.geometry={type:"segment",segment:s,sampleLocation:"center"},this._verticalLabel.geometry={type:"segment",segment:m,sampleLocation:"center"},this._verticalLabel.anchor=L.vertical,this._horizontalLabel.geometry={type:"segment",segment:p,sampleLocation:"center"},this._horizontalLabel.anchor=L.horizontal}_updateSegmentAndProjection({view:{renderCoordsHelper:t},orientation:e,startPosition:s,endPosition:n}){t.setAltitude(this._startPositionAtSeaLevel,0,s),t.setAltitude(this._endPositionAtSeaLevel,0,n);const a=new B.u(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,t.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(a),this._geodesicStartHint.setGeometryFromSegment(new B.y(this._startPositionAtSeaLevel,s)),this._geodesicEndHint.setGeometryFromSegment(new B.y(this._endPositionAtSeaLevel,n)),this._segmentLabel.geometry={type:"segment",segment:a,sampleLocation:"center"},this._segmentLabel.anchor=e===D.AboveSegment?"top":"bottom"}_updateLabelText({text:t,visualizedMeasurement:e}){(0,l.pC)(t)?(this._segmentLabel.text="euclidean"===e?t.euclideanDistance:t.geodesicDistance,this._horizontalLabel.text=t.horizontalDistance,this._verticalLabel.text=t.verticalDistance):(this._segmentLabel.text=null,this._horizontalLabel.text=null,this._verticalLabel.text=null),this.notifyChange("labels")}_updateLabelVisibility({visible:t,viewMode:e}){const s=this._segmentLabel,n=this._horizontalLabel,a=this._verticalLabel;if(s.visible=!1,n.visible=!1,a.visible=!1,t)switch(e){case P.Direct:s.visible=!0;break;case P.Triangle:s.visible=!0,n.visible=!0,a.visible=!0;break;case P.ProjectedGeodesic:s.visible=!0}}get _labelsText(){if(this.destroyed)return null;const t=this.messages,e=this.analysisView.result;if((0,l.Wi)(e)||(0,l.Wi)(t))return null;const{directDistance:s,horizontalDistance:n,verticalDistance:a,geodesicDistance:r}=e,g=this.analysisView.unit,u=c=>({euclideanDistance:"",geodesicDistance:"",horizontalDistance:"",verticalDistance:"",...c});switch(g){case"metric":return u({euclideanDistance:s&&(0,A.Rd)(t,s),geodesicDistance:r&&(0,A.Rd)(t,r),horizontalDistance:n&&(0,A.Rd)(t,n),verticalDistance:a&&(0,A.Wv)(t,a)});case"imperial":return u({euclideanDistance:s&&(0,A.Ud)(t,s),geodesicDistance:r&&(0,A.Ud)(t,r),horizontalDistance:n&&(0,A.Ud)(t,n),verticalDistance:a&&(0,A.Zv)(t,a)});default:return u({euclideanDistance:s&&(0,A.VG)(t,s,g),geodesicDistance:r&&(0,A.VG)(t,r,g),horizontalDistance:n&&(0,A.VG)(t,n,g),verticalDistance:a&&(0,A.VG)(t,a,g)})}}_updateSegmentStripeLength(t){const e=this._segmentVisualElement;(0,l.pC)(t)?(e.stripeLength=t,e.stripesEnabled=!0):e.stripesEnabled=!1}get _actualVisualElementsOrientation(){if((0,l.pC)(this._triangleOrientationOverride))return this._triangleOrientationOverride;const t=this.visualElementOrientation;return t===D.Auto?this.view.state.camera.aboveGround?D.AboveSegment:D.BelowSegment:t}_requiresGeodesicGuideAt(t){const e=this.view;if(!e?.state)return!1;const n=e.renderCoordsHelper,a=e.state.camera.computeScreenPixelSizeAt(t);return n.getAltitude(t)/a>=10}get _measurementArrowStripeLength(){const{result:t,unit:e}=this.analysisView;if((0,l.Wi)(t))return null;let s=null;const n=t.directDistance;switch(e){case"metric":s=n&&(0,S.nn)(n,"meters");break;case"imperial":s=n&&(0,S.nn)(n,(0,Ee.FN)(n.value,n.unit));break;default:s=n&&(0,S.nn)(n,e)}return(0,l.Wi)(s)?null:(0,H.sk)(s.value/30)*(0,Ee.En)(1,s.unit,"meters")}_updateMessageBundle(){this.loadingMessages=!0,(0,rt.ME)("esri/core/t9n/Units").then(t=>{this.messages=t}).finally(()=>{this.loadingMessages=!1})}get testData(){return{labels:this.labels,stripeLength:this._segmentVisualElement?.stripeLength}}};(0,o._)([(0,d.Cb)()],E.prototype,"_triangleOrientationOverride",void 0),(0,o._)([(0,d.Cb)()],E.prototype,"messages",void 0),(0,o._)([(0,d.Cb)()],E.prototype,"view",void 0),(0,o._)([(0,d.Cb)()],E.prototype,"analysis",void 0),(0,o._)([(0,d.Cb)()],E.prototype,"analysisView",void 0),(0,o._)([(0,d.Cb)()],E.prototype,"loadingMessages",void 0),(0,o._)([(0,d.Cb)()],E.prototype,"visible",null),(0,o._)([(0,d.Cb)()],E.prototype,"viewMode",null),(0,o._)([(0,d.Cb)()],E.prototype,"actualVisualizedMeasurement",null),(0,o._)([(0,d.Cb)()],E.prototype,"visualElementOrientation",void 0),(0,o._)([(0,d.Cb)()],E.prototype,"triangleCollapseRatioThreshold",void 0),(0,o._)([(0,d.Cb)()],E.prototype,"allowVisualElementsOrientationChange",null),(0,o._)([(0,d.Cb)()],E.prototype,"labels",null),(0,o._)([(0,d.Cb)()],E.prototype,"_labelsText",null),(0,o._)([(0,d.Cb)()],E.prototype,"_actualVisualElementsOrientation",null),(0,o._)([(0,d.Cb)()],E.prototype,"_measurementArrowStripeLength",null),E=(0,o._)([(0,z.j)("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementVisualization")],E);const Se=Math.cos((0,H.Vl)(12)),lt=(0,X.J$)(),dt=(0,X.J$)(),ct=(0,X.gX)(),ht=(0,X.gX)(),ut=(0,X.gX)();let y=class extends((0,k.p)(V.Z)){constructor(t){super(t),this.type="direct-line-measurement-view-3d",this.analysis=null,this.result=null,this.measurementMode=h.e.Auto,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}initialize(){const t=this.view,e=this.analysis;this._analysisVisualization=new E({view:t,analysis:e,analysisView:this}),this._analysisController=new G({view:t,analysis:e,viewData:this})}destroy(){this._analysisController=(0,l.SC)(this._analysisController),this._analysisVisualization=(0,l.SC)(this._analysisVisualization)}get updating(){return!!this._analysisVisualization?.loadingMessages}get viewMode(){return this._analysisVisualization.viewMode}get actualVisualizedMeasurement(){return this._analysisVisualization.actualVisualizedMeasurement}get visualElementOrientation(){return this._analysisVisualization.visualElementOrientation}set visualElementOrientation(t){this._analysisVisualization.visualElementOrientation=t}get allowVisualElementsOrientationChange(){return this._analysisVisualization.allowVisualElementsOrientationChange}set allowVisualElementsOrientationChange(t){this._analysisVisualization.allowVisualElementsOrientationChange=t}get triangleCollapseRatioThreshold(){return this._analysisVisualization.triangleCollapseRatioThreshold}set triangleCollapseRatioThreshold(t){this._analysisVisualization.triangleCollapseRatioThreshold=t}get directLabelText(){return this._analysisVisualization.labels.direct?.text??""}get horizontalLabelText(){return this._analysisVisualization.labels.horizontal?.text??""}get verticalLabelText(){return this._analysisVisualization.labels.vertical?.text??""}get unit(){return(0,l.Pt)(this.analysis.unit,this._defaultUnit)}get testData(){return this.destroyed?{labels:null,stripeLength:null,visualization:null,controller:null}:{...this._analysisVisualization?.testData,visualization:this._analysisVisualization,controller:this._analysisController}}};(0,o._)([(0,d.Cb)()],y.prototype,"updating",null),(0,o._)([(0,d.Cb)({readOnly:!0})],y.prototype,"type",void 0),(0,o._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],y.prototype,"analysis",void 0),(0,o._)([(0,d.Cb)()],y.prototype,"result",void 0),(0,o._)([(0,d.Cb)()],y.prototype,"measurementMode",void 0),(0,o._)([(0,d.Cb)()],y.prototype,"elevationAlignedStartPoint",void 0),(0,o._)([(0,d.Cb)()],y.prototype,"elevationAlignedEndPoint",void 0),(0,o._)([(0,d.Cb)({readOnly:!0})],y.prototype,"viewMode",null),(0,o._)([(0,d.Cb)({readOnly:!0})],y.prototype,"actualVisualizedMeasurement",null),(0,o._)([(0,d.Cb)()],y.prototype,"visualElementOrientation",null),(0,o._)([(0,d.Cb)()],y.prototype,"allowVisualElementsOrientationChange",null),(0,o._)([(0,d.Cb)()],y.prototype,"triangleCollapseRatioThreshold",null),(0,o._)([(0,d.Cb)({readOnly:!0})],y.prototype,"directLabelText",null),(0,o._)([(0,d.Cb)({readOnly:!0})],y.prototype,"horizontalLabelText",null),(0,o._)([(0,d.Cb)({readOnly:!0})],y.prototype,"verticalLabelText",null),(0,o._)([(0,d.Cb)()],y.prototype,"_analysisVisualization",void 0),(0,o._)([(0,d.Cb)()],y.prototype,"_analysisController",void 0),(0,o._)([(0,d.Cb)()],y.prototype,"unit",null),(0,o._)([(0,d.Cb)(Y.Y)],y.prototype,"_defaultUnit",void 0),y=(0,o._)([(0,z.j)("esri.views.3d.analysis.DirectLineMeasurementAnalysisView3D")],y);const gt=y},94375:(ye,I,i)=>{i.d(I,{O:()=>Y});var o=i(62208),V=i(32917),l=i(24425),d=i(97272),$=i(81695),U=i(23147),z=i(34103);class Y{constructor(h){this._resourceFactory=h,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return(0,o.pC)(this._resources)?this._resources.object:null}get resources(){return(0,o.pC)(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(h){h!==this._visible&&(this._visible=h,this._syncVisible())}get attached(){return this._attached}set attached(h){h!==this._attached&&(this._attached=h,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const h=this._resourceFactory.view._stage;if((0,o.Wi)(this._resources)||!h)return;const f=this._resources.object;this._resources.external.forEach(_=>{_.type!==l.U.Mesh&&_.type!==l.U.Line&&_.type!==l.U.Point||h.remove(_)}),f.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,f,this._resources.layer),this._resources.external.forEach(_=>{_.type!==l.U.Mesh&&_.type!==l.U.Line&&_.type!==l.U.Point||h.add(_)})}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const h=this._resourceFactory,f=h.view,_=f._stage;if(!_)return;const S=new z.F({pickable:!1,updatePolicy:U.j.SYNC});_.add(S);const v=new d.T({castShadow:!1}),b=h.createResources(v,S);b.forEach(x=>{_.add(x),x instanceof $.x&&_.loadImmediate(x)}),_.add(v),S.add(v);const C=h.cameraChanged,de=C?(0,V.YP)(()=>f.state.camera,x=>C(x),V.nn):null;this._resources={layer:S,object:v,external:b,cameraHandle:de},this._syncVisible()}_destroyResources(){if((0,o.Wi)(this._resources))return;const h=this._resourceFactory.view._stage;h&&(h.remove(this._resources.object),h.remove(this._resources.layer),this._resources.external.forEach(f=>h.remove(f))),this._resources.object.dispose(),this._resources.cameraHandle?.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncVisible(){(0,o.Wi)(this._resources)||(this._resources.object.visible=this._visible)}}}}]);