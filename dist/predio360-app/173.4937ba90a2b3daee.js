"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[173],{55442:(W,F,a)=>{a.d(F,{SI:()=>c,qF:()=>m,s_:()=>u}),a(8314);var P=a(63290);function c(y,T,M){if(null==y)return null;const C=T.readArcadeFeature();T.contextTimeZone=M.$view?.timeZone;try{return y.evaluate({...M,$feature:C},y.services)}catch(o){return P.Z.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",o),null}}function u(y){return null==y||y===1/0||y===-1/0||"number"==typeof y&&isNaN(y)}function m(y,T,M,C){if(null==y)return C??null;const o=T.readArcadeFeature();T.contextTimeZone=M.$view?.timeZone;const p=y.evaluate({...M,$feature:o},y.services);return u(p)?C??null:p}},3959:(W,F,a)=>{a.d(F,{c:()=>c,f:()=>P});var v=a(77275);function P(y,T){let M;if("string"==typeof y)M=(0,v.hP)(y+`-seed(${T})`);else{let C=12;M=y^T;do{M=107*(M>>8^M)+C|0}while(0!=--C)}return(1+M/(1<<31))/2}function c(y){return Math.floor(P(y,u)*m)}const u=53290320,m=10},86207:(W,F,a)=>{a.d(F,{_:()=>M});var v=a(65540),P=a(21433);class u{get length(){return this._pos}constructor(o,p){this._pos=0;const E=p?this._roundToNearest(p,o.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(E),this._buffer=new o(this._array),this._ctor=o,this._i16View=new Int16Array(this._array)}_roundToNearest(o,p){const E=Math.round(o);return 1===p?E:E+(p-E%p)}_ensureSize(o){if(this._pos+o>=this._buffer.length){const p=this._roundToNearest(1.25*(this._array.byteLength+o*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),E=new ArrayBuffer(p),A=new this._ctor(E);A.set(this._buffer,0),this._array=E,this._buffer=A,this._i16View=new Int16Array(this._array)}}ensureSize(o){this._ensureSize(o)}writeF32(o){this._ensureSize(1);const p=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=o,this._pos++,p}push(o){this._ensureSize(1);const p=this._pos;return this._buffer[this._pos++]=o,p}writeFixed(o){this._buffer[this._pos++]=o}setValue(o,p){this._buffer[o]=p}i1616Add(o,p,E){this._i16View[2*o]+=p,this._i16View[2*o+1]+=E}getValue(o){return this._buffer[o]}getValueF32(o){return new Float32Array(this._array,4*o,1)[0]}incr(o){if(this._buffer.length<o)throw new Error("Increment index overflows the target buffer");this._buffer[o]++}decr(o){this._buffer[o]--}writeRegion(o){this._ensureSize(o.length);const p=this._pos;return this._buffer.set(o,this._pos),this._pos+=o.length,p}writeManyFrom(o,p,E){this._ensureSize(E-p);for(let A=p;A!==E;A++)this.writeFixed(o._buffer[A])}buffer(){const o=this._array.slice(0,4*this._pos);return this.destroy(),o}toArray(){return[...this._buffer]}seek(o){this._pos=o}destroy(){this._array=null,this._buffer=null}}class T{constructor(o,p,E,A=0){const R=6*A*Uint32Array.BYTES_PER_ELEMENT,G=4*A*E,g=E/4,x=p.attributes.find(w=>"pos"===w.name||"position"===w.name);if(!x)throw new Error("InternalError: Unable to find position attribute");this.layout={...p,position:x},this._indices=new u(Uint32Array,R),this._vertices=new u(Uint32Array,G),this._metrics=new u(Uint32Array,0),this._metricCountOffset=this._metrics.push(0),this._strideInt=g,this._instanceId=o}serialize(o){const p=this._indices.buffer(),E=this._vertices.buffer(),A=this._metrics.length?this._metrics.buffer():null;return o.push(p,E),{instanceId:this._instanceId,layout:this.layout,indices:p,vertices:E,metrics:A}}get strideInt(){return this._strideInt}get vertexCount(){return this._vertices.length/this._strideInt}get indexCount(){return this._indices.length}get indexWriter(){return this._indices}get vertexWriter(){return this._vertices}get metricWriter(){return this._metrics}vertexEnsureSize(o){this._vertices.ensureSize(o)}indexEnsureSize(o){this._indices.ensureSize(o)}writeIndex(o){this._indices.push(o)}writeVertex(o){this._vertices.push(o)}writeVertexRegion(o){this._vertices.writeRegion(o)}writeVertexF32(o){this._vertices.writeF32(o)}writeMetric(o){this._metrics.incr(this._metricCountOffset),o.serialize(this._metrics)}}class M{constructor(o,p=0){this._id=o,this._sizeHint=p,this._entityRecordCountOffset=0,this._entityCountOffset=0,this._entityIdIndex=0,this._entitySortKeyIndex=0,this._instanceIdToVertexData=new Map,this._recordIndexStart=0,this._recordIndexCount=0,this._recordVertexStart=0,this._recordVertexCount=0,this._current={metric:null,writer:null,start:0,sortKey:0,instanceId:0,layoutHash:0,indexStart:0,vertexStart:0,textureKey:0,metricBoxLenPointer:0},this._entities=new u(Uint32Array,this._sizeHint*v.Z.byteSizeHint),this._entityCountOffset=this._entities.push(0)}get id(){return this._id}serialize(){const o=new Array,p=[],E=this._entities.buffer();for(const A of this._instanceIdToVertexData.values())p.push(A.serialize(o));return{message:{data:p,entities:E},transferList:o}}vertexCount(){return this._current.writer?.vertexCount??0}indexCount(){return this._current.writer?.indexCount??0}vertexEnsureSize(o){this._current.writer.vertexEnsureSize(o)}indexEnsureSize(o){this._current.writer.indexEnsureSize(o)}vertexWrite(o){this._current.writer.writeVertex(o)}vertexWriteRegion(o){this._current.writer.writeVertexRegion(o)}vertexWriteF32(o){this._current.writer.writeVertexF32(o)}recordBounds(o,p,E,A){}indexWrite(o){this._current.writer.writeIndex(o)}metricStart(o){this._current.metric=o}metricEnd(){this._current.metric.bounds.length&&this._current.writer.writeMetric(this._current.metric)}metricBoxWrite(o){this._current.metric.bounds.push(o)}entityStart(o,p=o){this._entityIdIndex=this._entities.push(o),this._entitySortKeyIndex=this._entities.writeF32(p),this._entityRecordCountOffset=this._entities.push(0)}entityRecordCount(){return this._entities.getValue(this._entityRecordCountOffset)}entityEnd(){0===this.entityRecordCount()?this._entities.seek(this._entityIdIndex):this._entities.incr(this._entityCountOffset)}recordCount(){return this._entities.getValue(this._entityRecordCountOffset)}recordStart(o,p,E=0){this._current.writer=this._getVertexWriter(o,p),this._current.indexStart=this._current.writer.indexCount,this._current.vertexStart=this._current.writer.vertexCount,this._current.instanceId=o,this._current.layoutHash=p.hash,this._current.textureKey=E}recordEnd(o=0){const p=this._current.vertexStart,E=this._current.writer.vertexCount-p;if(!E)return!1;const A=this._current.indexStart,R=this._current.writer.indexCount-A;return this._recordIndexStart=A,this._recordIndexCount=R,this._recordVertexStart=p,this._recordVertexCount=E,this._entities.incr(this._entityRecordCountOffset),P.Z.write(this._entities,this._current.instanceId,this._current.textureKey,A,R,p,E,o),!0}copyLast(o,p){const E=this._recordVertexStart+this._recordVertexCount;this._entities.incr(this._entityRecordCountOffset),P.Z.write(this._entities,this._current.instanceId,this._current.textureKey,this._recordIndexStart+this._recordIndexCount,this._recordIndexCount,E,this._recordVertexCount,0);const A=this._current.writer.indexWriter,R=this._current.writer.vertexWriter,G=this._recordIndexStart+this._recordIndexCount,g=this._recordVertexCount;for(let s=this._recordIndexStart;s!==G;s++){const n=A.getValue(s);A.push(n+g)}const x=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT,B=(this._recordVertexStart+this._recordVertexCount)*x;for(let s=this._recordVertexStart*x;s!==B;s++){const n=R.getValue(s);R.push(n)}const z=this._current.writer.layout.position,U=z.packPrecisionFactor??1,j=z.offset/Uint32Array.BYTES_PER_ELEMENT,i=o*U,t=p*U;for(let s=E*x;s<=R.length;s+=x)R.i1616Add(s+j,i,t);this.recordEnd()}copyLastFrom(o,p,E){const A=o._entities.getValue(o._entityIdIndex);if(A!==this._entities.getValue(this._entityIdIndex)){const n=o._entities.getValueF32(o._entitySortKeyIndex);this.entityStart(A,n)}this.recordStart(o._current.instanceId,o._current.writer.layout,o._current.textureKey);const R=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT,G=this._current.vertexStart,g=o._current.vertexStart-G,x=this._current.writer.indexWriter,w=this._current.writer.vertexWriter,B=o._current.writer.indexWriter,z=o._current.writer.vertexWriter;for(let n=o._current.indexStart;n!==B.length;n++){const l=B.getValue(n);x.push(l-g)}for(let n=o._current.vertexStart*R;n!==z.length;n++){const l=z.getValue(n);w.push(l)}const U=this._current.writer.layout.position,j=U.packPrecisionFactor??1,i=U.offset/Uint32Array.BYTES_PER_ELEMENT,t=p*j,s=E*j;for(let n=G*R;n<=w.length;n+=R)w.i1616Add(n+i,t,s);this.recordEnd()}_getVertexWriter(o,p){const{stride:E}=p,A=this._instanceIdToVertexData;return A.has(o)||A.set(o,new T(o,p,E,this._sizeHint)),A.get(o)}}},8380:(W,F,a)=>{a.d(F,{f:()=>m});var v=a(15861),P=a(77275),c=a(87526);class u{}class m extends u{constructor(T){super(),this._fetcher=T,this._controller=new AbortController,this._pendingIds=new Set,this._pendingRequests=[],this._resourceIdToResource=new Map}destory(){this._controller.abort()}get _abortOptions(){return{signal:this._controller.signal}}enqueueRequest(T){const M=(0,c.IS)(T.resource),C=(0,P.hP)(JSON.stringify(M));return this._pendingIds.has(C)||(this._pendingIds.add(C),this._pendingRequests.push({...T,resourceId:C})),C}fetchEnqueuedResources(){var T=this;return(0,v.Z)(function*(){const M=T._pendingRequests;T._pendingIds.clear(),T._pendingRequests=[];const C=yield T._fetcher.fetch(M,T._abortOptions);for(let o=0;o<C.length;o++)T._resourceIdToResource.set(M[o].resourceId,C[o])})()}fetchResourceImmediate(T){var M=this;return(0,v.Z)(function*(){const C=yield M._fetcher.fetch([T],M._abortOptions);if(1!==C.length)throw new Error("FeaturePipelineResourceProxy: failed to fetch resources");return C[0]})()}fetchDictionaryResourceImmediate(T){var M=this;return(0,v.Z)(function*(){const C=yield M._fetcher.fetchDictionary([T],M._abortOptions);if(1!==C.length)throw new Error("FeaturePipelineResourceProxy: failed to fetch dictionary resources");return C[0]})()}getResource(T){return this._resourceIdToResource.get(T)}}},24464:(W,F,a)=>{a.d(F,{fQ:()=>B,yj:()=>i});var v=a(15861),P=a(24055),c=a(85931),u=a(26584),m=a(58817),y=a(63290),T=a(3959),M=a(95860),C=a(90725);function p(s,n){return E.apply(this,arguments)}function E(){return(E=(0,v.Z)(function*(s,n,l=!1){const{defaultValue:f,valueExpressionInfo:h,value:b}=n;if(h){const{expression:D}=h,O=yield s.createComputedField({expression:D},l);return O?{...n,computed:O,defaultValue:f}:null}return{...n,computed:new C.J(b),defaultValue:f}})).apply(this,arguments)}function A(s,n){return R.apply(this,arguments)}function R(){return(R=(0,v.Z)(function*(s,n){const{defaultValue:l,valueExpressionInfo:f}=n,{expression:h}=f,b=yield s.createComputedField({expression:h});return b?{...n,computed:b,defaultValue:l}:null})).apply(this,arguments)}const G=s=>"boolean"!=typeof s&&"number"!=typeof s&&"valueExpressionInfo"in s;class x{static create(n,l,f){return(0,v.Z)(function*(){const h={},b=new Map,D=new Map,O=new Map,r=new Map,d=new Map;for(const _ in f.params){const I=f.params[_];if(null!=I&&"object"==typeof I)if(Array.isArray(I)){if("object"==typeof I[0])throw new Error(`InternalError: Cannot handle ${_}. Nested array params are not supported`);h[_]=I}else if("valueExpressionInfo"in I){if(I.value){h[_]=I.value;continue}const S=yield A(n,I);if(!S){h[_]=I.defaultValue;continue}b.set(_,S),h[_]=null}else switch(I.type){case"cim-effect-infos":if(I.effectInfos.some(S=>S.overrides.length)){D.set(_,{effects:yield Promise.all(I.effectInfos.map(function(){var S=(0,v.Z)(function*(L){const Z=L.overrides.map(V=>p(n,V));return{effect:L.effect,compiledOverrides:(yield Promise.all(Z)).filter(c.pC)}});return function(L){return S.apply(this,arguments)}}()))});break}h[_]=I.effectInfos.map(S=>S.effect);break;case"cim-marker-placement-info":I.overrides.length&&O.set(_,{placementInfo:I,compiledOverrides:(yield Promise.all(I.overrides.map(S=>p(n,S)))).filter(c.pC)}),h[_]=I.placement;break;case"text-rasterization-param":{if(I.overrides.length){const L=I.overrides.map(Z=>p(n,Z,I.useLegacyLabelEvaluationRules));r.set(_,{compiledOverrides:(yield Promise.all(L)).filter(c.pC),rasterizationParam:I,objectIdToResourceId:new Map});continue}const S={type:"cim-rasterization-info",resource:I.resource};h[_]=(yield l.fetchResourceImmediate(S))??null;break}case"sprite-rasterization-param":{if(I.overrides.length){const L=I.overrides.map(Z=>p(n,Z));r.set(_,{compiledOverrides:(yield Promise.all(L)).filter(c.pC),rasterizationParam:I,objectIdToResourceId:new Map});continue}if("animated"===I.resource.type){r.set(_,{compiledOverrides:[],rasterizationParam:I,objectIdToResourceId:new Map});continue}const S={type:"cim-rasterization-info",resource:I.resource};h[_]=(yield l.fetchResourceImmediate(S))??null;break}case"cim-marker-transform-param":{const{params:S}=I;if(S.some(n=>{for(const l in n)if(G(n[l]))return!0;return!1})){const L={compiledMarkerInfos:[]};yield Promise.all(S.map(function(){var Z=(0,v.Z)(function*(V){const N={props:{}};for(const K in V)if(G(V[K])){const H=yield A(n,V[K]);N.compiledExpressionMap||(N.compiledExpressionMap=new Map),H&&N.compiledExpressionMap.set(K,H)}else N.props[K]=V[K];L.compiledMarkerInfos.push(N)});return function(V){return Z.apply(this,arguments)}}())),d.set(_,L)}else h[_]={type:"cim-marker-transform-info",infos:S};break}default:h[_]=I}else h[_]=I}return new x(f,h,b,D,O,r,d)})()}constructor(n,l,f,h,b,D,O){this.inputMeshParams=n,this._resolvedMeshParams=l,this._dynamicProperties=f,this._dynamicEffectProperties=h,this._dynamicPlacementProperties=b,this._dynamicAsyncProperties=D,this._dynamicTransformProperties=O,this.evaluator=r=>r}get hasDynamicProperties(){return!!(this._dynamicProperties.size||this._dynamicAsyncProperties.size||this._dynamicEffectProperties.size||this._dynamicTransformProperties.size||this._dynamicPlacementProperties.size)}get evaluatedMeshParams(){return this._evaluatedMeshParams||(this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams)),this._evaluatedMeshParams}enqueueRequest(n,l,f){for(const h of this._dynamicAsyncProperties.values()){const b=(0,m.d9)(h.rasterizationParam.resource);"animated"===h.rasterizationParam.resource.type&&h.rasterizationParam.resource.randomizeStartTime&&(b.primitiveName="__RESERVED__PRIMITIVE__NAME__",b.startGroup=(0,T.c)(l.getObjectId()||0));for(const{primitiveName:O,propertyName:r,computed:d,defaultValue:_,valueExpressionInfo:I}of h.compiledOverrides)try{(0,M.mx)(b,"animated"===h.rasterizationParam.resource.type?b.primitiveName:O,r,d,l,f,_)}catch(S){y.Z.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.mesh.MeshWriterInputEvaluator").errorOnce(new u.Z("invalid-arcade-expression",`Encountered an error when evaluating the arcade expression '${I?.expression}' (primitive: '${O}', property: '${r}')`,S))}const D=n.enqueueRequest({type:"cim-rasterization-info",resource:b});h.objectIdToResourceId.set(l.getObjectId(),D)}}evaluateMeshParams(n,l,f){for(const[h,b]of this._dynamicProperties.entries())this._resolvedMeshParams[h]=b.computed.readWithDefault(l,f,b.defaultValue);for(const[h,b]of this._dynamicPlacementProperties.entries())for(const{computed:D,defaultValue:O,propertyName:r}of b.compiledOverrides){const d=D.readWithDefault(l,f,O);b.placementInfo.placement[r]=d,this._resolvedMeshParams[h]=b.placementInfo.placement}for(const[h,b]of this._dynamicEffectProperties.entries())for(const D of b.effects){for(const{computed:O,defaultValue:r,propertyName:d}of D.compiledOverrides){const _=O.readWithDefault(l,f,r);D.effect[d]=_}this._resolvedMeshParams[h]=b.effects.map(O=>O.effect)}for(const[h,b]of this._dynamicTransformProperties.entries()){const D={type:"cim-marker-transform-info",infos:[]};for(const O of b.compiledMarkerInfos){const r={...O.props};if(O.compiledExpressionMap)for(const[d,_]of O.compiledExpressionMap){const I=_.computed.readWithDefault(l,f,_.defaultValue);r[d]="number"==typeof I||"boolean"==typeof I?I:_.defaultValue}D.infos.push(r)}this._resolvedMeshParams[h]=D}for(const[h,b]of this._dynamicAsyncProperties.entries()){const D=b.objectIdToResourceId.get(l.getObjectId());if(null==D)continue;const O=n.getResource(D);this._resolvedMeshParams[h]=O}return this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams),this.evaluatedMeshParams}}var w=a(24962);function B(s,n,l,f,h,b,D){return z.apply(this,arguments)}function z(){return(z=(0,v.Z)(function*(s,n,l,f,h,b,D){const O=w.U[l],r=yield x.create(s,n,h),d=new O.constructor(f,r,b,D);return yield d.loadDependencies(),d})).apply(this,arguments)}function i(s,n,l,f){return t.apply(this,arguments)}function t(){return(t=(0,v.Z)(function*(s,n,l,f){return Promise.all(l.map(h=>B(s,n,h.meshWriterName,(0,P.G)(h.id),h.options,f,h.optionalAttributes)))})).apply(this,arguments)}},95404:(W,F,a)=>{a.d(F,{t:()=>v});class v{getObjectId(c){return c.getObjectId()}getAttributes(c){return c.readAttributes()}getAttribute(c,u){return c.readAttribute(u)}getAttributeAsTimestamp(c,u){return c.readAttributeAsTimestamp(u)}cloneWithGeometry(c,u){return c}getGeometry(c){return c.readGeometryWorldSpace()}getCentroid(c,u){return c.readCentroidForDisplay()}}v.Shared=new v},55486:(W,F,a)=>{a.d(F,{X:()=>v});class v{destroy(){}}},28269:(W,F,a)=>{a.d(F,{p:()=>j});var v=a(15861),P=a(26584),c=a(8314),u=a(63290),m=a(84682),y=a(72571),T=a(39351),M=a(99666),C=a(87526),o=a(36519);class A{constructor(t){this.data=t,this._referenceCount=0}increment(){this._referenceCount+=1}decrement(){this._referenceCount-=1}empty(){return 0===this._referenceCount}}class R{constructor(){this._freeIdsGenerationA=[],this._freeIdsGenerationB=[],this._idCounter=1,this._freeIds=this._freeIdsGenerationA,this._objectIdToDisplayId=new Map}createIdForObjectId(t){let s=this._objectIdToDisplayId.get(t);return s?s.increment():(s=new A((0,M.QS)(this._getFreeId(),!1)),s.increment(),this._objectIdToDisplayId.set(t,s)),s.data}releaseIdForObjectId(t){const s=this._objectIdToDisplayId.get(t);s&&(s.decrement(),s.empty()&&(this._objectIdToDisplayId.delete(t),this._freeIds.push(s.data)))}releaseAll(){for(const t of this._objectIdToDisplayId.values())this._freeIds.push(t.data);this._objectIdToDisplayId.clear()}incrementGeneration(){this._freeIds=this._freeIds===this._freeIdsGenerationA?this._freeIdsGenerationB:this._freeIdsGenerationA}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}}var G=a(70236),g=a(67969);const w=()=>u.Z.getLogger("esri.views.layers.2d.features.support.AttributeStore"),B=(!1,w(),()=>null),z_sharedArrayBuffer=(0,c.Z)("esri-shared-array-buffer");(0,c.Z)("esri-atomics");class U{constructor(t,s,n){this.size=0,this.texelSize=4,this.dirtyStart=0,this.dirtyEnd=0;const{pixelType:l,layout:f,textureOnly:h}=s;this.textureOnly=h||!1,this.pixelType=l,this.layout=f,this._resetRange(),this.size=t,this.isLocal=n,h||(this.data=this._initData(l,t))}get buffer(){return this.data?.buffer}unsetComponentAllTexels(t,s){const n=this.data;for(let l=0;l<this.size*this.size;l++)n[l*this.texelSize+t]&=~s;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(t,s){const n=this.data;for(let l=0;l<this.size*this.size;l++)n[l*this.texelSize+t]|=255&s;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponent(t,s,n){const l=this.data;for(const f of n)l[f*this.texelSize+t]|=s,this.dirtyStart=Math.min(this.dirtyStart,f),this.dirtyEnd=Math.max(this.dirtyEnd,f)}setComponentTexel(t,s,n){this.data[n*this.texelSize+t]|=s,this.dirtyStart=Math.min(this.dirtyStart,n),this.dirtyEnd=Math.max(this.dirtyEnd,n)}unsetComponentTexel(t,s,n){this.data[n*this.texelSize+t]&=~s,this.dirtyStart=Math.min(this.dirtyStart,n),this.dirtyEnd=Math.max(this.dirtyEnd,n)}getData(t,s){const n=(0,M.jL)(t);return this.data[n*this.texelSize+s]}setData(t,s,n){const l=(0,M.jL)(t);this.layout&1<<s?null!=this.data&&(this.data[l*this.texelSize+s]=n,this.dirtyStart=Math.min(this.dirtyStart,l),this.dirtyEnd=Math.max(this.dirtyEnd,l)):w().error("mapview-attributes-store","Tried to set a value for a texel's readonly component")}expand(t){if(this.size=t,!this.textureOnly){const s=this._initData(this.pixelType,t);s.set(this.data),this.data=s}}toMessage(){const t=this.dirtyStart,s=this.dirtyEnd,n=this.texelSize;if(t>s)return null;this._resetRange();const f=this.pixelType,h=this.layout;return{start:t,end:s,data:!this.isLocal&&this.data.slice(t*n,(s+1)*n)||null,pixelType:f,layout:h}}_initData(t,s){const n=ArrayBuffer,l=(0,C.UK)(t),f=new l(new n(s*s*4*l.BYTES_PER_ELEMENT));for(let h=0;h<f.length;h+=4)f[h+1]=255;return f}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}}class j{constructor(t){this._client=t,this._filters=[],this._blocks=new Array,this._attributeComputeInfo=null,this._abortController=new AbortController,this._size=T._8,this._idsToHighlight=new Map,this._referencesScale=!1,this._referencesGeometry=!1,this._initialized=!1,this.version=0,this._idGenerator=new R,this._epoch=1}destroy(){this._abortController.abort()}_initialize(){if(null!=this._blockDescriptors)return;const t=g.Br.FLOAT;B(`Creating AttributeStore ${z_sharedArrayBuffer?"with":"without"} shared memory`),this._blockDescriptors=[{pixelType:g.Br.UNSIGNED_BYTE,layout:1},{pixelType:g.Br.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:g.Br.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:t,layout:15},{pixelType:t,layout:15},{pixelType:t,layout:15},{pixelType:t,layout:15}],this._blocks=this._blockDescriptors.map(()=>null)}get referencesScale(){return this._referencesScale}get referencesGeometry(){return this._referencesGeometry}get _signal(){return this._abortController.signal}get hasHighlight(){return this._idsToHighlight.size>0}createDisplayIdForObjectId(t){return this._idGenerator.createIdForObjectId(t)}releaseDisplayIdForObjectId(t){return this._idGenerator.releaseIdForObjectId(t)}incrementDisplayIdGeneration(){this._idGenerator.incrementGeneration()}releaseAllIds(){this._idGenerator.releaseAll()}update(t,s,n,l,f=0){var h=this;return(0,v.Z)(function*(){const b=(0,m.Hg)(h._schema,t);if(h.version=f,b&&((0,c.Z)("esri-2d-update-debug")&&console.debug(`Version[${f}] AttributeStore.update`,{changed:b}),h._schema=t,h._attributeComputeInfo=null,h._initialize(),null!=t))if(n&&(h._filters=yield Promise.all(t.filters.map(D=>D?G.Z.create({geometryType:n.geometryType,hasM:!1,hasZ:!1,timeInfo:n.timeInfo,fieldsIndex:n.fieldsIndex,spatialReference:l??n.spatialReference,filterJSON:D}):null))),"subtype"!==t.type)h._attributeComputeInfo={isSubtype:!1,map:new Map},yield Promise.all(t.bindings.map(function(){var D=(0,v.Z)(function*(O){const r=yield h._bind(s,O);h._referencesGeometry=h._referencesGeometry||(r?.referencesGeometry()??!1),h._referencesScale=h._referencesScale||(r?.referencesScale()??!1)});return function(O){return D.apply(this,arguments)}}()));else{h._attributeComputeInfo={isSubtype:!0,subtypeField:t.subtypeField,map:new Map},h._referencesScale=!1,h._referencesGeometry=!1;for(const D in t.bindings){const O=t.bindings[D];yield Promise.all(O.map(function(){var r=(0,v.Z)(function*(d){const _=yield h._bind(s,d,parseInt(D,10));h._referencesGeometry=h._referencesGeometry||(_?.referencesGeometry()??!1),h._referencesScale=h._referencesScale||(_?.referencesScale()??!1)});return function(d){return r.apply(this,arguments)}}()))}}})()}setHighlight(t,s){const n=this._getBlock(0);n.unsetComponentAllTexels(0,(1<<y.Oo.length)-1);for(const{displayId:l,highlightFlags:f}of t){if(null==l)continue;const h=(0,M.jL)(l);n.setComponent(0,f,[h])}this._idsToHighlight.clear();for(const{objectId:l,highlightFlags:f}of t)this._idsToHighlight.set(l,f);for(const{objectId:l,highlightFlags:f}of s)this._idsToHighlight.set(l,f)}setData(t,s,n,l){const f=(0,M.jL)(t);this._ensureSizeForTexel(f),this._getBlock(s).setData(t,n,l)}getData(t,s,n){return this._getBlock(s).getData(t,n)}getHighlightFlags(t){return this._idsToHighlight.get(t)||0}unsetAttributeData(t){const s=(0,M.jL)(t);this._getBlock(0).setData(s,0,0)}setAttributeData(t,s,n){const l=(0,M.jL)(t);this._ensureSizeForTexel(l),this._getBlock(0).setData(l,0,this.getFilterFlags(s));const f=this._attributeComputeInfo;let D=null;f&&(D=f.isSubtype?f.map.get(s.readAttribute(f.subtypeField)):f.map,D?.size&&D.forEach((O,r)=>{const d=1*r%4,_=Math.floor(1*r/4),I=this._getBlock(_+T.wi.VV);let S=O.field?.read(s,n);O.valueRepresentation&&(S=function x(i,t){if(!i||!t)return i;switch(t){case"radius":case"distance":return 2*i;case"diameter":case"width":return i;case"area":return Math.sqrt(i)}return i}(S,O.valueRepresentation)),(null===S||isNaN(S)||S===1/0||S===-1/0)&&(S=o.k9),I.setData(l,d,S)}))}get epoch(){return this._epoch}sendUpdates(){var t=this;return(0,v.Z)(function*(){const s=t._blocks.map(l=>null!=l?l.toMessage():null),n=t._getInitArgs();(0,c.Z)("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.start"),yield t._client.update({initArgs:n,blockData:s,version:t.version,sendUpdateEpoch:t._epoch},t._signal),t._epoch+=1,(0,c.Z)("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.end")})()}_ensureSizeForTexel(t){for(;t>=this._size*this._size;)if(this._expand())return}_bind(t,s,n){var l=this;return(0,v.Z)(function*(){const f=yield t.createComputedField(s),{valueRepresentation:h}=s,b=l._attributeComputeInfo;if(b.isSubtype){const D=b.map.get(n)??new Map;D.set(s.binding,{field:f,valueRepresentation:h}),b.map.set(n,D)}else b.map.set(s.binding,{field:f,valueRepresentation:h});return f})()}_getInitArgs(){return this._initialized?null:(this._initialized=!0,this._getBlock(T.wi.Animation),this._getBlock(T.wi.GPGPU),{blockSize:this._size,blockDescriptors:this._blocks.map(t=>null!=t?{textureOnly:t.textureOnly,buffer:t.buffer,pixelType:t.pixelType}:null)})}_getBlock(t){const s=this._blocks[t];if(null!=s)return s;B(`Initializing AttributeBlock at index ${t}`);const n=new U(this._size,this._blockDescriptors[t],this._client.isLocal);return this._blocks[t]=n,this._initialized=!1,n}_expand(){if(this._size<this._schema.capabilities.maxTextureSize){const t=this._size<<=1;B("Expanding block size to",t,this._blocks);for(const s of this._blocks)s?.expand(t);return this._initialized=!1,this._size=t,0}return w().error(new P.Z("mapview-limitations","Maximum number of onscreen features exceeded.")),-1}isVisible(t){return!!(this._getBlock(0).getData(t,0)&1<<y.Oo.length)}getFilterFlags(t){let s=0;for(let l=0;l<this._filters.length;l++){const h=this._filters[l];s|=(1<<l&&null!=h&&!h.check(t)?0:1)<<l}let n=0;if(this._idsToHighlight.size){const l=t.getObjectId();n=this.getHighlightFlags(l)}return s<<y.Oo.length|n}}},46836:(W,F,a)=>{a.d(F,{O:()=>U});var v=a(15861),P=a(26584),c=a(63290),u=a(5548),m=a(99666),y=a(55486);class T extends y.X{constructor(i){super(),this._field=i}resize(i){throw new Error("Method not implemented.")}read(i,t){return i.readAttribute(this._field)}readWithDefault(i,t){return i.readAttribute(this._field)}referencesScale(){return!1}referencesGeometry(){return!1}}var M=a(77275),C=a(46679),o=a(55442);class p extends y.X{static create(i,t){return(0,v.Z)(function*(){const s=yield(0,C.Yi)(i,t.spatialReference,t.fields),n=(0,M.hP)(i);return new p(s,n)})()}constructor(i,t){super(),this._compiled=i,this._cacheKey=t}resize(i){}read(i,t){return this.referencesScale()||"system"!==t.$view.timeZone?(0,o.SI)(this._compiled,i,t):this._readCached(i,t)}readWithDefault(i,t,s){return this.referencesScale()||"system"!==t.$view.timeZone?(0,o.qF)(this._compiled,i,t,s):this._readWithDefaultCached(i,t,s)}referencesScale(){return this._compiled?.referencesScale()??!1}referencesGeometry(){return this._compiled?.referencesGeometry()??!1}_readCached(i,t){if(i.setCache(this._cacheKey),i.hasCachedValue())return i.getCachedValue();const s=(0,o.SI)(this._compiled,i,t);return i.setCachedValue(s),s}_readWithDefaultCached(i,t,s){if(i.setCache(this._cacheKey),i.hasCachedValue())return i.getCachedValue();const n=(0,o.qF)(this._compiled,i,t,s);return i.setCachedValue(n),n}}var E=a(22445),A=a(86793);class R extends y.X{static create(i,t){return(0,v.Z)(function*(){const s=(0,A.UG)(i);return new R(n=>s.replaceAll(/{[^}]*}/g,l=>{const f=l.slice(1,-1),h=n.metadata.fieldsIndex.get(f);if(null==h)return l;const b=n.readAttribute(f);return null==b?"":(0,E.B)(b,h)}))})()}constructor(i){super(),this._evaluator=i}resize(i){}read(i,t){return this._evaluator(i)}readWithDefault(i,t,s){const n=this._evaluator(i);return(0,o.s_)(n)?s:n}referencesScale(){return!1}referencesGeometry(){return!1}}class G extends y.X{constructor(i,t){super(),this._field=i,this._normalizationInfo=t}resize(i){throw new Error("Method not implemented.")}read(i,t){return this._readNormalized(i)}readWithDefault(i,t){return this._readNormalized(i)}referencesScale(){return!1}referencesGeometry(){return!1}_readNormalized(i){const t=i.readAttribute(this._field);if(null==t)return null;const{normalizationField:s,normalizationTotal:n,normalizationType:l}=this._normalizationInfo,f=i.readAttribute(s);switch(l??"esriNormalizeByField"){case"esriNormalizeByField":return f?f?t/f:void 0:null;case"esriNormalizeByLog":return Math.log(t)*Math.LOG10E;case"esriNormalizeByPercentOfTotal":return n?t/n*100:null}}}var g=a(42797),x=a(69050);const w=()=>c.Z.getLogger("esri.views.2d.layers.features.support.ComputedAttributeStorage"),B=4294967295;function z(j,i,t){if(!(j.length>i))for(;j.length<=i;)j.push(t)}class U{constructor(i){this._numerics=[],this._strings=[],this._allocatedSize=256,this._bitsets=[],this._instanceIds=[],this._bounds=[],this._dirtyBitset=this.getBitset(this.createBitset()),this.compilationOptions=i}createBitset(){const i=this._bitsets.length;return this._bitsets.push(g.p.create(this._allocatedSize,m.Ht)),i+1}createComputedField(i,t=!1){var s=this;return(0,v.Z)(function*(){if(i.expression)try{if(!s.compilationOptions)throw new Error("InternalError: Compilation options not defined");return t?R.create(i.expression,s.compilationOptions):yield p.create(i.expression,s.compilationOptions)}catch(l){const f=new P.Z("featurelayer","Failed to compile arcade expression",{error:l,expression:i.expression});return w().error(f),null}if(i.normalizationType||i.normalizationField)return new G(i.field,i);if(i.field)return new T(i.field);const n=new P.Z("featurelayer","Unable to create computed field. No expression or field found",{info:i});return w().error(n),null})()}createWhereClause(i){var t=this;return(0,v.Z)(function*(){return i?(0,x.y)(i,t.compilationOptions.fields):null})()}getBitset(i){return this._bitsets[i-1]}getComputedNumeric(i,t){return this.getComputedNumericAtIndex(i&m.Ht,0)}setComputedNumeric(i,t,s){return this.setComputedNumericAtIndex(i&m.Ht,s,0)}getComputedString(i,t){return this.getComputedStringAtIndex(i&m.Ht,0)}setComputedString(i,t,s){return this.setComputedStringAtIndex(i&m.Ht,0,s)}getComputedNumericAtIndex(i,t){const s=i&m.Ht;return this._ensureNumeric(t,s),this._numerics[t][s]}setComputedNumericAtIndex(i,t,s){const n=i&m.Ht;this._ensureNumeric(t,n),this._numerics[t][n]=s}getPackedChunkId(i){const t=i&m.Ht;return this._ensureInstanceId(t),this._instanceIds[t]}setPackedChunkId(i,t){const s=i&m.Ht;this._ensureInstanceId(s),this._instanceIds[s]=t}getComputedStringAtIndex(i,t){const s=i&m.Ht;return this._ensureString(t,s),this._strings[t][s]}setComputedStringAtIndex(i,t,s){const n=i&m.Ht;this._ensureString(t,n),this._strings[t][n]=s}getXMin(i){return this._bounds[4*(i&m.Ht)]}getYMin(i){return this._bounds[4*(i&m.Ht)+1]}getXMax(i){return this._bounds[4*(i&m.Ht)+2]}getYMax(i){return this._bounds[4*(i&m.Ht)+3]}setBounds(i,t,s=!1){const n=i&m.Ht;if(!s&&!this._dirtyBitset.has(i))return this._bounds[4*n]!==B;this._dirtyBitset.unset(i);const l=t.readGeometryWorldSpace();if(z(this._bounds,4*n+4,0),!l||!l.coords.length)return this._bounds[4*n]=B,this._bounds[4*n+1]=B,this._bounds[4*n+2]=B,this._bounds[4*n+3]=B,!1;let f=1/0,h=1/0,b=-1/0,D=-1/0;return l.forEachVertex((O,r)=>{f=Math.min(f,O),h=Math.min(h,r),b=Math.max(b,O),D=Math.max(D,r)}),this._bounds[4*n]=f,this._bounds[4*n+1]=h,this._bounds[4*n+2]=b,this._bounds[4*n+3]=D,!0}getBounds(i,t){const s=this.getXMin(t),n=this.getYMin(t),l=this.getXMax(t),f=this.getYMax(t);return(0,u.bZ)(i,s,n,l,f),s!==B}_ensureNumeric(i,t){this._numerics[i]||(this._numerics[i]=[]),z(this._numerics[i],t,0)}_ensureInstanceId(i){z(this._instanceIds,i,0)}_ensureString(i,t){this._strings[i]||(this._strings[i]=[]),z(this._strings[i],t,null)}}},90725:(W,F,a)=>{a.d(F,{J:()=>P});var v=a(55486);class P extends v.X{constructor(u){super(),this._value=u}resize(u){}read(u,m){return this._value}readWithDefault(u,m,y){return this._value}referencesScale(){return!1}referencesGeometry(){return!1}}},70236:(W,F,a)=>{a.d(F,{Z:()=>R});var v=a(15861),P=a(26584),c=a(63290),u=a(65401),m=a(32442),y=a(56541),T=a(53023),M=a(76530),C=a(96854),o=a(95404),p=a(69050);class R{constructor(g){this._geometryBounds=(0,u.Ue)(),this._idToVisibility=new Map,this._serviceInfo=g}static create(g){return(0,v.Z)(function*(){const x=new R(g);return yield x.update(g.filterJSON,g.spatialReference),x})()}get hash(){return this._hash}check(g){return this._applyFilter(g)}clear(){const g=this._resetAllHiddenIds();return this.update(),{show:g,hide:[]}}invalidate(){this._idToVisibility.forEach((g,x)=>{this._idToVisibility.set(x,0)})}setKnownIds(g){for(const x of g)this._idToVisibility.set(x,1)}setTrue(g){const x=[],w=[],B=new Set(g);return this._idToVisibility.forEach((z,U)=>{const j=!!(1&this._idToVisibility.get(U)),i=B.has(U);!j&&i?x.push(U):j&&!i&&w.push(U),this._idToVisibility.set(U,i?3:0)}),{show:x,hide:w}}createQuery(){const{geometry:g,spatialRel:x,where:w,timeExtent:B,objectIds:z}=this;return C.Z.fromJSON({geometry:g,spatialRel:x,where:w,timeExtent:B,objectIds:z})}update(g,x){var w=this;return(0,v.Z)(function*(){w._hash=JSON.stringify(g);const B=yield(0,y.j6)(g,null,x);yield Promise.all([w._setGeometryFilter(B),w._setIdFilter(B),w._setAttributeFilter(B),w._setTimeFilter(B)])})()}_setAttributeFilter(g){var x=this;return(0,v.Z)(function*(){if(!g?.where)return x._clause=null,void(x.where=null);x._clause=yield(0,p.y)(g.where,x._serviceInfo.fieldsIndex),x.where=g.where})()}_setIdFilter(g){this._idsToShow=g?.objectIds&&new Set(g.objectIds),this._idsToHide=g?.hiddenIds&&new Set(g.hiddenIds),this.objectIds=g?.objectIds}_setGeometryFilter(g){var x=this;return(0,v.Z)(function*(){if(!g?.geometry)return x._spatialQueryOperator=null,x.geometry=null,void(x.spatialRel=null);const w=g.geometry,B=g.spatialRel||"esriSpatialRelIntersects",z=yield(0,T.cW)(B,w,x._serviceInfo.geometryType,x._serviceInfo.hasZ,x._serviceInfo.hasM);(0,m.$P)(x._geometryBounds,w),x._spatialQueryOperator=z,x.geometry=w,x.spatialRel=B})()}_setTimeFilter(g){if(this.timeExtent=this._timeOperator=null,g?.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=g.timeExtent,this._timeOperator=(0,M.y)(this._serviceInfo.timeInfo,g.timeExtent,o.t.Shared);else{const x=new P.Z("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",g.timeExtent);c.Z.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter").error(x)}}_applyFilter(g){return this._filterByGeometry(g)&&this._filterById(g)&&this._filterByTime(g)&&this._filterByExpression(g)}_filterByExpression(g){return!this.where||this._clause(g)}_filterById(g){return(!this._idsToHide?.size||!this._idsToHide.has(g.getObjectId()))&&(!this._idsToShow?.size||this._idsToShow.has(g.getObjectId()))}_filterByGeometry(g){if(!this.geometry)return!0;const x=g.readGeometryWorldSpace();return!!x&&this._spatialQueryOperator(x)}_filterByTime(g){return null==this._timeOperator||this._timeOperator(g)}_resetAllHiddenIds(){const g=[];return this._idToVisibility.forEach((x,w)=>{1&x||(this._idToVisibility.set(w,1),g.push(w))}),g}}},44222:(W,F,a)=>{a.d(F,{A:()=>c,m:()=>u});var v=a(65234),P=a(60466);class c{constructor(y){this._options=y,this._fieldsIndex="fieldsIndex"in y?P.Z.fromJSON(y.fieldsIndex):new P.Z(y.fields),y.spatialReference&&(this._spatialReference=v.Z.fromJSON(y.spatialReference)),this._arcadeSchema={fields:this.fieldsIndex.fields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,objectIdField:this.objectIdField,globalIdField:this._options.globalIdField,spatialReference:this._spatialReference,timeInfo:this._options.timeInfo,typeIdField:this._options.typeIdField??void 0,types:this._options.types??void 0,subtypeField:this._options.subtypeField,subtypes:this._options.subtypes??void 0}}get fieldsIndex(){return this._fieldsIndex}get geometryType(){return this._options.geometryType}get timeInfo(){return this._options.timeInfo}get objectIdField(){return this._options.objectIdField}get globalIdField(){return this._options.globalIdField}get arcadeSchema(){return this._arcadeSchema}get spatialReference(){return this._spatialReference}get timeReferenceUnknownClient(){return this._options.timeReferenceUnknownClient}}class u extends c{static create(y){return new u({fields:[],objectIdField:"uid",geometryType:null,spatialReference:y,globalIdField:null,subtypeField:null,subtypes:null,timeInfo:null,typeIdField:null,types:null,timeReferenceUnknownClient:null})}}},2854:(W,F,a)=>{a.d(F,{j:()=>P});var v=a(42797);class P{constructor(u){this._valid=v.p.create(u),this._data=new Array(u)}has(u){return this._valid.has(u)}set(u,m){this._valid.set(u),this._data[u]=m}get(u){return this._data[u]}}},25208:(W,F,a)=>{a.d(F,{s:()=>D}),a(29132);var P=a(91365),c=a(8314),u=a(62208),m=a(31910),y=a(29535),T=a(33359),M=a(5548),C=a(21164),o=a(77044),p=a(82054),E=a(66385),A=a(88071),R=a(28302),G=a(2854),g=a(42797),x=a(91179);const w=(0,c.Z)("featurelayer-simplify-thresholds")??[.5,.5,.5,.5],B=w[0],z=w[1],U=w[2],j=w[3],i=(0,c.Z)("featurelayer-simplify-payload-size-factors")??[1,2,4],t=i[0],s=i[1],n=i[2],l=(0,c.Z)("featurelayer-simplify-mobile-factor")??2,f=(0,c.Z)("esri-mobile"),h=4294967295;class D{constructor(r){this.metadata=r,this.type="FeatureSetReader",this._deleted=null,this._joined=[],this._objectIdToIndex=null,this._boundsBuffer=[],this._caches=new Map,this.arcadeDeclaredClass="esri.arcade.Feature",this._contextTimeZone=null}get isEmpty(){return null!=this._deleted&&this._deleted.countSet()===this.getSize()}getAreaSimplificationThreshold(r,d){let _=1;const I=f?l:1;d>4e6?_=n*I:d>1e6?_=s*I:d>5e5?_=t*I:d>1e5&&(_=I);let S=0;return r>4e3?S=j*_:r>2e3?S=U*_:r>100?S=z:r>15&&(S=B),S}parseTimestampOffset(r){return r}getBounds(r){if(function b(O,r,d){if(!(O.length>r))for(;O.length<=r;)O.push(d)}(this._boundsBuffer,4*this.getIndex()+4,0),this.getBoundsXMin()===h)return!1;if(0===this.getBoundsXMin()){const L=this.readGeometryWorldSpace();if(!L)return this.setBoundsXMin(h),!1;let Z=1/0,V=1/0,N=-1/0,K=-1/0;return L.forEachVertex((H,Y)=>{Z=Math.min(Z,H),V=Math.min(V,Y),N=Math.max(N,H),K=Math.max(K,Y)}),this.setBoundsXMin(Z),this.setBoundsYMin(V),this.setBoundsXMax(N),this.setBoundsYMax(K),(0,M.bZ)(r,Z,V,N,K),!0}const d=this.getBoundsXMin(),_=this.getBoundsYMin(),I=this.getBoundsXMax(),S=this.getBoundsYMax();return(0,M.bZ)(r,d,_,I,S),!0}getBoundsXMin(){return this._boundsBuffer[4*this.getIndex()]}setBoundsXMin(r){this._boundsBuffer[4*this.getIndex()]=r}getBoundsYMin(){return this._boundsBuffer[4*this.getIndex()+1]}setBoundsYMin(r){this._boundsBuffer[4*this.getIndex()+1]=r}getBoundsXMax(){return this._boundsBuffer[4*this.getIndex()+2]}setBoundsXMax(r){this._boundsBuffer[4*this.getIndex()+2]=r}getBoundsYMax(){return this._boundsBuffer[4*this.getIndex()+3]}setBoundsYMax(r){this._boundsBuffer[4*this.getIndex()+3]=r}readAttributeAsTimestamp(r){const d=this.readAttribute(r);return"string"==typeof d?new Date(d).getTime():"number"==typeof d||null==d?d:null}readAttribute(r,d=!1){const _=this._readAttribute(r,d);if(void 0!==_)return _;for(const I of this._joined){I.setIndex(this.getIndex());const S=I._readAttribute(r,d);if(void 0!==S)return S}}readAttributes(){const r=this._readAttributes();for(const d of this._joined){d.setIndex(this.getIndex());const _=d._readAttributes();for(const I of Object.keys(_))r[I]=_[I]}return r}joinAttributes(r){this._joined.push(r)}removeIds(r){if(null==this._objectIdToIndex){const _=new Map,I=this.getCursor();for(;I.next();){const S=I.getObjectId();(0,u.O3)(S),_.set(S,I.getIndex())}this._objectIdToIndex=_}const d=this._objectIdToIndex;for(const _ of r.values())d.has(_)&&this._removeAtIndex(d.get(_))}readOptimizedFeatureWorldSpace(){const r=this.readGeometryWorldSpace(),d=this.readAttributes(),_=this.readCentroidWorldSpace(),I=new E.u_(r,d,_);return I.objectId=this.getObjectId(),I.displayId=this.getDisplayId(),I}readLegacyFeatureForDisplay(){const r=this.readCentroidForDisplay();return{attributes:this.readAttributes(),geometry:this.readLegacyGeometryForDisplay(),centroid:(r&&{x:r.coords[0],y:r.coords[1]})??null}}readLegacyFeatureWorldSpace(){const r=this.readCentroidWorldSpace();return{attributes:this.readAttributes(),geometry:this._readLegacyGeometryWorldSpace(),centroid:(r&&{x:r.coords[0],y:r.coords[1]})??null}}readLegacyGeometryForDisplay(){const r=this.readGeometryForDisplay();return(0,p.di)(r,this.geometryType,!1,!1)}readXForDisplay(){return this._readX()}readYForDisplay(){return this._readY()}readXWorldSpace(){const r=this._readX(),d=this.getInTransform();return null==d?r:r*d.scale[0]+d.translate[0]}readYWorldSpace(){const r=this._readY(),d=this.getInTransform();return null==d?r:d.translate[1]-r*d.scale[1]}readGeometryForDisplay(){const r=this._readGeometryDeltaDecoded(!0);if(!r){const d=this._createGeometryFromServerCentroid();return d?d.deltaDecode():null}return r}readGeometryWorldSpace(){let r=this._readGeometry();if(r||(r=this._createGeometryFromServerCentroid()),!r)return null;const d=r.clone(),_=this.getInTransform();return null!=_&&(0,p.$g)(d,d,this.hasZ,this.hasM,_),d}readCentroidForDisplay(){const r=this.readGeometryForDisplay();return r?this._computeDisplayCentroid(r):this._readServerCentroid()}readCentroidWorldSpace(){const r=this.readGeometryForDisplay(),d=r?this._computeDisplayCentroid(r):this._readServerCentroid();if(!d)return null;const _=d.clone(),I=this.getInTransform();return null!=I&&(0,p.$g)(_,_,this.hasZ,this.hasM,I),_}setCache(r){let d=this._caches.get(r);null==d&&(d=new G.j(this.getSize()),this._caches.set(r,d)),this._activeCache=d}setCachedValue(r){this._activeCache.set(this.getIndex(),r)}hasCachedValue(){return this._activeCache.has(this.getIndex())}getCachedValue(){return this._activeCache.get(this.getIndex())}_readGeometryDeltaDecoded(r){const d=this._readGeometry(r);return"esriGeometryPoint"!==this.geometryType&&d&&this.getInTransform()?d.deltaDecode():d}get contextTimeZone(){return this._contextTimeZone}set contextTimeZone(r){this._contextTimeZone=r}readArcadeFeature(){return this}hasField(r){return this.fields.has(r)||this._joined.some(d=>d.hasField(r))}geometry(){const r=this.readGeometryWorldSpace(),d=(0,p.di)(r,this.geometryType,this.hasZ,this.hasM),_=(0,x.im)(d);if(_){if(!this.metadata.spatialReference)throw new Error("InternalError: Expected spatial reference to be defined");_.spatialReference=this.metadata.spatialReference}return _}autocastArcadeDate(r,d){return d&&d instanceof Date?this.isUnknownDateTimeField(r)?P.iG.unknownDateJSToArcadeDate(d):P.iG.dateJSAndZoneToArcadeDate(d,this.contextTimeZone??R.By):d}isUnknownDateTimeField(r){return this.metadata.fieldsIndex.getTimeZone(r)===R._4}field(r){let d=this.fields.get(r);if(d)switch(d.type){case"date-only":case"esriFieldTypeDateOnly":return m.u.fromReader(this.readAttribute(r,!1));case"time-only":case"esriFieldTypeTimeOnly":return y.n.fromReader(this.readAttribute(r,!1));case"esriFieldTypeTimestampOffset":case"timestamp-offset":return P.iG.fromReaderAsTimeStampOffset(this.readAttribute(r,!1));case"date":case"esriFieldTypeDate":return this.autocastArcadeDate(r,this.readAttribute(r,!0));default:return this.readAttribute(r,!1)}for(const _ of this._joined)if(_.setIndex(this.getIndex()),d=_.fields.get(r),d)switch(d.type){case"date-only":case"esriFieldTypeDateOnly":return m.u.fromReader(_._readAttribute(r,!1));case"time-only":case"esriFieldTypeTimeOnly":return y.n.fromReader(_._readAttribute(r,!1));case"esriFieldTypeTimestampOffset":case"timestamp-offset":return P.iG.fromReaderAsTimeStampOffset(_._readAttribute(r,!1));case"date":case"esriFieldTypeDate":return this.autocastArcadeDate(r,_._readAttribute(r,!0));default:return this.readAttribute(r,!1)}throw new Error(`Field ${r} does not exist`)}setField(r,d){throw new Error("Unable to update feature attribute values, feature is readonly")}keys(){return this.fields.fields.map(r=>r.name)}castToText(r=!1){if(!r)return JSON.stringify(this.readLegacyFeatureForDisplay());const d=this.readLegacyFeatureForDisplay();if(!d)return JSON.stringify(null);const _={geometry:d.geometry,attributes:{...d.attributes??{}}};for(const I in _.attributes){const S=_.attributes[I];S instanceof Date&&(_.attributes[I]=S.getTime())}return JSON.stringify(_)}gdbVersion(){return null}fullSchema(){return this.metadata.arcadeSchema}castAsJson(r=null){return{attributes:this._readAttributes(),geometry:!0===r?.keepGeometryType?this.geometry():this.geometry()?.toJSON()??null}}castAsJsonAsync(r=null,d=null){return Promise.resolve(this.castAsJson(d))}_getExists(){return null==this._deleted||!this._deleted.has(this.getIndex())}_computeDisplayCentroid(r){if(null==this.getInTransform())return(0,o.Y)(new A.Z,r,this.hasM,this.hasZ);const d=T.z.fromOptimized(r,this.geometryType);d.yFactor*=-1;const _=(0,C.r)(d);return _?(_[1]*=-1,new A.Z([],_)):null}copyInto(r){r._joined=this._joined,r._deleted=this._deleted,r._objectIdToIndex=this._objectIdToIndex,r._boundsBuffer=this._boundsBuffer,r._activeCache=this._activeCache,r._caches=this._caches,r._contextTimeZone=this._contextTimeZone}_readLegacyGeometryWorldSpace(){const r=this.readGeometryWorldSpace();return(0,p.di)(r,this.geometryType,!1,!1)}_createGeometryFromServerCentroid(){const r=this._readServerCentroid();if(!r)return null;const[d,_]=r.coords;return this._createQuantizedExtrudedGeometry(d,_)}_createQuantizedExtrudedGeometry(r,d){return"esriGeometryPolyline"===this.geometryType?this._createQuantizedExtrudedLine(r,d):this._createQuantizedExtrudedQuad(r,d)}_createQuantizedExtrudedQuad(r,d){return new A.Z([5],[r-1,d,1,-1,1,1,-1,1,-1,-1])}_createQuantizedExtrudedLine(r,d){return new A.Z([2],[r-1,d+1,1,-1])}_removeAtIndex(r){null==this._deleted&&(this._deleted=g.p.create(this.getSize())),this._deleted.set(r)}}},42797:(W,F,a)=>{a.d(F,{p:()=>v});class v{static fromBuffer(c,u){return new v(c,u)}static create(c,u=4294967295){const m=new Uint32Array(Math.ceil(c/32));return new v(m,u)}constructor(c,u){this._mask=0,this._buf=c,this._mask=u}_getIndex(c){return Math.floor(c/32)}has(c){const u=this._mask&c;return!!(this._buf[this._getIndex(u)]&1<<u%32)}hasRange(c,u){let m=c,y=u;for(;m%32&&m!==y;){if(this.has(m))return!0;m++}for(;y%32&&m!==y;){if(this.has(m))return!0;y--}if(m===y)return!1;for(let T=m/32;T!==y/32;T++)if(this._buf[T])return!0;return!1}set(c){const u=this._mask&c,m=this._getIndex(u);this._buf[m]|=1<<u%32}setRange(c,u){let m=c,y=u;for(;m%32&&m!==y;)this.set(m++);for(;y%32&&m!==y;)this.set(y--);if(m!==y)for(let T=m/32;T!==y/32;T++)this._buf[T]=4294967295}unset(c){const u=this._mask&c,m=this._getIndex(u);this._buf[m]&=4294967295^1<<u%32}resize(c){const u=this._buf,m=new Uint32Array(Math.ceil(c/32));m.set(u),this._buf=m}or(c){for(let u=0;u<this._buf.length;u++)this._buf[u]|=c._buf[u];return this}and(c){for(let u=0;u<this._buf.length;u++)this._buf[u]&=c._buf[u];return this}xor(c){for(let u=0;u<this._buf.length;u++)this._buf[u]^=c._buf[u];return this}ior(c){for(let u=0;u<this._buf.length;u++)this._buf[u]|=~c._buf[u];return this}iand(c){for(let u=0;u<this._buf.length;u++)this._buf[u]&=~c._buf[u];return this}ixor(c){for(let u=0;u<this._buf.length;u++)this._buf[u]^=~c._buf[u];return this}any(){for(let c=0;c<this._buf.length;c++)if(this._buf[c])return!0;return!1}copy(c){for(let u=0;u<this._buf.length;u++)this._buf[u]=c._buf[u];return this}clone(){return new v(this._buf.slice(),this._mask)}clear(){for(let c=0;c<this._buf.length;c++)this._buf[c]=0;return this}forEachSet(c){for(let u=0;u<this._buf.length;u++){let m=this._buf[u],y=32*u;if(m)for(;m;)1&m&&c(y),m>>>=1,y++}}countSet(){let c=0;return this.forEachSet(u=>{c++}),c}}},69050:(W,F,a)=>{a.d(F,{y:()=>T});var v=a(15861),P=a(26584),c=a(63290),u=a(95737);const m=()=>c.Z.getLogger("esri.views.2d.layers.features.support.whereUtils"),y={getAttribute:(C,o)=>C.readAttribute(o)};function T(C,o){return M.apply(this,arguments)}function M(){return(M=(0,v.Z)(function*(C,o){try{const p=yield(0,u.E)(C,o);if(!p.isStandardized){const E=new P.Z("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",p);m().error(E)}return E=>{const A=E.readArcadeFeature();try{return p.testFeature(A,y)}catch{return m().warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",C),!0}}}catch{return m().warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",C),E=>!0}})).apply(this,arguments)}}}]);