"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[5349,1e3],{96603:(Fe,N,o)=>{o.d(N,{CP:()=>H,JG:()=>K,LL:()=>V,NZ:()=>$,fV:()=>C,vj:()=>ce,yT:()=>de,zE:()=>ue});var m=o(15861),Q=o(84792),ie=o(85931),g=o(10699),M=o(35391);class H{constructor(p,F,S){this.assetName=p,this.assetMimeType=F,this.parts=S}equals(p){return this===p||this.assetName===p.assetName&&this.assetMimeType===p.assetMimeType&&(0,ie.fS)(this.parts,p.parts,(F,S)=>F.equals(S))}isOnService(p){return this.parts.every(F=>F.isOnService(p))}makeHash(){let p="";for(const F of this.parts)p+=F.partHash;return p}toBlob(p){var F=this;return(0,m.Z)(function*(){const{parts:S}=F;if(1===S.length)return S[0].toBlob(p);const ee=yield Promise.all(S.map(w=>w.toBlob(p)));return(0,g.k_)(p),new Blob(ee)})()}}class V{constructor(p,F){this.partUrl=p,this.partHash=F}equals(p){return this===p||this.partUrl===p.partUrl&&this.partHash===p.partHash}isOnService(p){return this.partUrl.startsWith(`${p.path}/assets/`)}toBlob(p){var F=this;return(0,m.Z)(function*(){const{data:S}=yield(0,Q.Z)(F.partUrl,{responseType:"blob"});return(0,g.k_)(p),S})()}}function $(f){return function D(f){return!!f&&(Array.isArray(f)?f.some(q):q(f))}(f?.source)}function X(f){return!!Array.isArray(f)&&f.every(p=>p instanceof H)}const Y=/^(model\/gltf\+json)|(model\/gltf-binary)$/,O=/\.(gltf|glb)/i;function q(f){if(f instanceof File){const{type:p,name:F}=f;return Y.test(p)||O.test(F)}return Y.test(f.assetMimeType)||O.test(f.assetName)}function K(f,p){if(!f)return!1;const{source:F}=f;return function le(f,p){return Array.isArray(f)?f.length>0&&f.every(S=>k(S,p)):k(f,p)}(F,p)}function C(f,p){if(f===p)return!0;const{source:F}=f,{source:S}=p;if(F===S)return!0;if(X(F)&&X(S)){if(F.length!==S.length)return!1;const ee=(L,re)=>L.assetName<re.assetName?-1:L.assetName>re.assetName?1:0,w=[...F].sort(ee),te=[...S].sort(ee);for(let L=0;L<w.length;++L)if(!w[L].equals(te[L]))return!1;return!0}return!1}function k(f,p){return f instanceof H&&f.isOnService(p)}function ce(f,p){return f instanceof File?(0,M.dm)(f,p):(0,M.S0)(f.assetMimeType,p)??(0,M.Ow)(f.assetName,p)}function ue(f){return Array.isArray(f)?f:[f]}function de(f){return!!f.original}},87757:(Fe,N,o)=>{o.d(N,{g:()=>m});const m={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},81913:(Fe,N,o)=>{o.r(N),o.d(N,{applyEdits:()=>f,checkEditingCapabilities:()=>be,isFeatureIdentifierArrayWithGlobalId:()=>de,isFeatureIdentifierArrayWithObjectId:()=>ce,isFeatureIdentifierWithGlobalId:()=>ue,isFeatureIdentifierWithObjectId:()=>k,normalizeCollections:()=>j,normalizeEdits:()=>ne,normalizeGeometries:()=>Ae,shallowCloneFeature:()=>ge,uploadAssets:()=>pe});var m=o(15861),Q=o(88879),ie=o(46160),g=o(26584),M=o(58817),H=o(63290),V=o(10699),$=o(21726),X=o(35948),Y=o(93555),O=o(37053),D=o(6733),q=o(90194),K=o(35391),C=o(72469);function le(s){return null!=s?.applyEdits}function k(s){return"object"==typeof s&&null!=s&&"objectId"in s&&!!s.objectId}function ce(s){return s.every(k)}function ue(s){return"object"==typeof s&&null!=s&&"globalId"in s&&!!s.globalId}function de(s){return s.every(ue)}function f(s,n,d){return p.apply(this,arguments)}function p(){return p=(0,m.Z)(function*(s,n,d,l={}){let c;const W=l.gdbVersion??("gdbVersion"in s?s.gdbVersion:null);(0,D.lQ)(s)&&s.url?c=(0,D.jF)(s.url,s.layerId,W,"original-and-current-features"===l.returnServiceEditsOption):(c=(0,V.hh)(),c.promise.then(b=>{(b.addedFeatures.length||b.updatedFeatures.length||b.deletedFeatures.length||b.addedAttachments.length||b.updatedAttachments.length||b.deletedAttachments.length)&&s.emit("edits",b)}),s.emit("apply-edits",{result:c.promise}));try{const{results:v,edits:b}=yield function F(s,n,d,l){return S.apply(this,arguments)}(s,n,d,l),U=T=>T.filter(t=>!t.error).map(M.d9),se={edits:b,addedFeatures:U(v.addFeatureResults),updatedFeatures:U(v.updateFeatureResults),deletedFeatures:U(v.deleteFeatureResults),addedAttachments:U(v.addAttachmentResults),updatedAttachments:U(v.updateAttachmentResults),deletedAttachments:U(v.deleteAttachmentResults),exceededTransferLimit:!1,historicMoment:v.editMoment?new Date(v.editMoment):null,globalIdToObjectId:l.globalIdToObjectId};return v.editedFeatureResults?.length&&(se.editedFeatures=v.editedFeatureResults),c.resolve(se),v}catch(v){throw c.reject(v),v}}),p.apply(this,arguments)}function S(){return S=(0,m.Z)(function*(s,n,d,l){if(yield s.load(),!le(n))throw new g.Z(`${s.type}-layer:no-editing-support`,"Layer source does not support applyEdits capability",{layer:s});if(!(0,C.ln)(s))throw new g.Z(`${s.type}-layer:editing-disabled`,"Editing is disabled for layer",{layer:s});const{edits:c,options:A}=yield function ee(s,n,d){return w.apply(this,arguments)}(s,d,l);return c.addFeatures?.length||c.updateFeatures?.length||c.deleteFeatures?.length||c.addAttachments?.length||c.updateAttachments?.length||c.deleteAttachments?.length?{edits:c,results:yield n.applyEdits(c,A)}:{edits:c,results:{addFeatureResults:[],updateFeatureResults:[],deleteFeatureResults:[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}}),S.apply(this,arguments)}function w(){return w=(0,m.Z)(function*(s,n,d){const l=(0,C.S1)(s),W=null!=s.infoFor3D;if(be(n,l,d,!(!n||!(n.addFeatures||n.updateFeatures||n.deleteFeatures)),!(!n||!(n.addAttachments||n.updateAttachments||n.deleteAttachments)),`${s.type}-layer`),!l.data.isVersioned&&d?.gdbVersion)throw new g.Z(`${s.type}-layer:invalid-parameter`,"'gdbVersion' is applicable only if the layer supports versioned data. See: 'capabilities.data.isVersioned'");if(!l.editing.supportsRollbackOnFailure&&d?.rollbackOnFailureEnabled)throw new g.Z(`${s.type}-layer:invalid-parameter`,"This layer does not support 'rollbackOnFailureEnabled' parameter. See: 'capabilities.editing.supportsRollbackOnFailure'");const v={...d};if(null!=v.rollbackOnFailureEnabled||l.editing.supportsRollbackOnFailure||(v.rollbackOnFailureEnabled=!0),v.rollbackOnFailureEnabled||"original-and-current-features"!==v.returnServiceEditsOption||(!1===v.rollbackOnFailureEnabled&&H.Z.getLogger("esri.layers.graphics.editingSupport").warn(`${s.type}-layer:invalid-parameter`,"'original-and-current-features' is valid for 'returnServiceEditsOption' only when 'rollBackOnFailure' is true, but 'rollBackOnFailure' was set to false. 'rollBackOnFailure' has been overwritten and set to true."),v.rollbackOnFailureEnabled=!0),!l.editing.supportsReturnServiceEditsInSourceSpatialReference&&v.returnServiceEditsInSourceSR)throw new g.Z(`${s.type}-layer:invalid-parameter`,"This layer does not support 'returnServiceEditsInSourceSR' parameter. See: 'capabilities.editing.supportsReturnServiceEditsInSourceSpatialReference'");if(v.returnServiceEditsInSourceSR&&"original-and-current-features"!==v.returnServiceEditsOption)throw new g.Z(`${s.type}-layer:invalid-parameter`,"'returnServiceEditsInSourceSR' is valid only when 'returnServiceEditsOption' is set to 'original-and-current-features'");const b=ne(n,l,`${s.type}-layer`),U=d?.globalIdUsed||W,se=s.fields.filter(T=>"big-integer"===T.type||"oid"===T.type&&(T.length||0)>=8);if(U){const{globalIdField:T}=s;if(null==T)throw new g.Z(`${s.type}-layer:invalid-parameter`,"Layer does not specify a global id field.");b.addFeatures.forEach(t=>function fe(s,n){const{attributes:d}=s;null==d[n]&&(d[n]=(0,X.zS)())}(t,T))}return b.addFeatures.forEach(T=>function re(s,n,d,l){te(s,n,d,l),L(s,n)}(T,s,U,se)),b.updateFeatures.forEach(T=>function ye(s,n,d,l){te(s,n,d,l),L(s,n);const c=(0,C.S1)(n);if("geometry"in s&&null!=s.geometry&&!c?.editing.supportsGeometryUpdate)throw new g.Z(`${n.type}-layer:unsupported-operation`,"Layer does not support geometry updates.")}(T,s,U,se)),b.deleteFeatures.forEach(T=>function Ie(s,n,d,l){te(s,n,d,l)}(T,s,U,se)),b.addAttachments.forEach(T=>he(T,s)),b.updateAttachments.forEach(T=>he(T,s)),W&&(yield function Oe(s,n){return ve.apply(this,arguments)}(b,s)),{edits:yield Ae(b),options:v}}),w.apply(this,arguments)}function te(s,n,d,l){if(d){if("attributes"in s&&!s.attributes[n.globalIdField])throw new g.Z(`${n.type}-layer:invalid-parameter`,`Feature should have '${n.globalIdField}' when 'globalIdUsed' is true`);if(!("attributes"in s)&&!s.globalId)throw new g.Z(`${n.type}-layer:invalid-parameter`,"`'globalId' of the feature should be passed when 'globalIdUsed' is true")}if(l.length&&"attributes"in s)for(const c of l){const A=s.attributes[c.name];if(void 0!==A&&!(0,q.d2)(c,A))throw new g.Z(`${n.type}-layer:invalid-parameter`,`Big-integer field '${c.name}' of the feature must be less than ${Number.MAX_SAFE_INTEGER}`,{feature:s})}if("geometry"in s&&null!=s.geometry){if(s.geometry.hasZ&&!1===n.capabilities?.data.supportsZ)throw new g.Z(`${n.type}-layer:z-unsupported`,"Layer does not support z values while feature has z values.");if(s.geometry.hasM&&!1===n.capabilities?.data.supportsM)throw new g.Z(`${n.type}-layer:m-unsupported`,"Layer does not support m values while feature has m values.")}}function L(s,n){if("geometry"in s&&"mesh"===s.geometry?.type&&null!=n.infoFor3D&&null!=n.spatialReference){const{geometry:d}=s,{spatialReference:l,vertexSpace:c}=d,A=n.spatialReference,W="local"===c.type,v=(0,O.sT)(A),b=(0,O.fS)(A,l),U=b||(0,O.oR)(A)&&((0,O.oR)(l)||(0,O.sS)(l));if(!(W&&v&&U||!W&&!v&&b))throw new g.Z(`${n.type}-layer:mesh-unsupported`,`Uploading a mesh with a ${c.type} vertex space and a spatial reference wkid:${l.wkid} to a layer with a spatial reference wkid:${A.wkid} is not supported.`)}}function he(s,n){const{feature:d,attachment:l}=s;if(!d||"attributes"in d&&!d.attributes[n.globalIdField])throw new g.Z(`${n.type}-layer:invalid-parameter`,"Attachment should have reference to a feature with 'globalId'");if(!("attributes"in d)&&!d.globalId)throw new g.Z(`${n.type}-layer:invalid-parameter`,"Attachment should have reference to 'globalId' of the parent feature");if(!l.globalId)throw new g.Z(`${n.type}-layer:invalid-parameter`,"Attachment should have 'globalId'");if(!l.data&&!l.uploadId)throw new g.Z(`${n.type}-layer:invalid-parameter`,"Attachment should have 'data' or 'uploadId'");if(!(l.data instanceof File&&l.data.name||l.name))throw new g.Z(`${n.type}-layer:invalid-parameter`,"'name' is required when attachment is specified as Base64 encoded string using 'data'");if(!n.capabilities?.editing.supportsUploadWithItemId&&l.uploadId)throw new g.Z(`${n.type}-layer:invalid-parameter`,"This layer does not support 'uploadId' parameter. See: 'capabilities.editing.supportsUploadWithItemId'");if("string"==typeof l.data){const c=(0,$.sJ)(l.data);if(c&&!c.isBase64)throw new g.Z(`${n.type}-layer:invalid-parameter`,"Attachment 'data' should be a Blob, File or Base64 encoded string")}}function Ae(s){return me.apply(this,arguments)}function me(){return(me=(0,m.Z)(function*(s){const n=s.addFeatures??[],d=s.updateFeatures??[],l=n.concat(d).map(v=>v.geometry),c=yield(0,Y.aX)(l),A=n.length,W=d.length;return c.slice(0,A).forEach((v,b)=>n[b].geometry=v),c.slice(A,A+W).forEach((v,b)=>d[b].geometry=v),s})).apply(this,arguments)}function j(s){return{addFeatures:Array.from(s?.addFeatures??[]),updateFeatures:Array.from(s?.updateFeatures??[]),deleteFeatures:s&&ie.Z.isCollection(s.deleteFeatures)?s.deleteFeatures.toArray():s.deleteFeatures||[],addAttachments:s.addAttachments||[],updateAttachments:s.updateAttachments||[],deleteAttachments:s.deleteAttachments||[]}}function ne(s,n,d){const l=j(s);if(l.addFeatures?.length&&!n.operations.supportsAdd)throw new g.Z(`${d}:unsupported-operation`,"Layer does not support adding features.");if(l.updateFeatures?.length&&!n.operations.supportsUpdate)throw new g.Z(`${d}:unsupported-operation`,"Layer does not support updating features.");if(l.deleteFeatures?.length&&!n.operations.supportsDelete)throw new g.Z(`${d}:unsupported-operation`,"Layer does not support deleting features.");return l.addFeatures=l.addFeatures.map(ge),l.updateFeatures=l.updateFeatures.map(ge),l.addAssetFeatures=[],l}function be(s,n,d,l,c,A){if(!s||!l&&!c)throw new g.Z(`${A}:missing-parameters`,"'addFeatures', 'updateFeatures', 'deleteFeatures', 'addAttachments', 'updateAttachments' or 'deleteAttachments' parameter is required");if(!n.editing.supportsGlobalId&&d?.globalIdUsed)throw new g.Z(`${A}:invalid-parameter`,"This layer does not support 'globalIdUsed' parameter. See: 'capabilities.editing.supportsGlobalId'");if(!n.editing.supportsGlobalId&&c)throw new g.Z(`${A}:invalid-parameter`,"'addAttachments', 'updateAttachments' and 'deleteAttachments' are applicable only if the layer supports global ids. See: 'capabilities.editing.supportsGlobalId'");if(!d?.globalIdUsed&&c)throw new g.Z(`${A}:invalid-parameter`,"When 'addAttachments', 'updateAttachments' or 'deleteAttachments' is specified, globalIdUsed should be set to true")}function ge(s){const n=new Q.Z;return s.attributes||(s.attributes={}),n.geometry=s.geometry,n.attributes=s.attributes,n}function ve(){return(ve=(0,m.Z)(function*(s,n){if(null==n.infoFor3D)return;const{infoFor3D:d}=n,l=(0,K.S0)("model/gltf-binary",d.supportedFormats)??(0,K.Ow)("glb",d.supportedFormats);if(!l||!d.editFormats.includes(l))throw new g.Z(`${n.type}-layer:binary-gltf-asset-not-supported`,"3DObjectFeatureLayer requires binary glTF (.glb) support for updating mesh geometry.");s.addAssetFeatures??=[];const{addAssetFeatures:c}=s;for(const A of s.addFeatures??[])Re(A)&&c.push(A);for(const A of s.updateFeatures??[])Re(A)&&c.push(A)})).apply(this,arguments)}function Re(s){return"mesh"===s?.geometry?.type}function pe(s,n,d,l){if(!le(n))throw new g.Z(`${s.type}-layer:no-editing-support`,"Layer source does not support applyEdits capability",{layer:s});if(!n.uploadAssets)throw new g.Z(`${s.type}-layer:no-asset-upload-support`,"Layer source does not support uploadAssets capability",{layer:s});return n.uploadAssets(d,l)}},35349:(Fe,N,o)=>{o.r(N),o.d(N,{default:()=>T});var m=o(15861),Q=o(17626),g=(o(29132),o(24263)),M=o(84792),H=o(97478),V=o(85931),$=o(26584),X=o(8314),Y=o(2076),O=o(47996),D=o(63290),q=o(94113),K=o(10699),C=o(21726),le=o(35948),k=o(77712),ce=o(76898),ue=o(2004),de=o(17727),f=o(96603),p=o(88879),F=o(16730),S=o(55915),ee=o(91179),w=o(37053),te=o(81913);function L(t,r,e){return re.apply(this,arguments)}function re(){return(re=(0,m.Z)(function*(t,r,e){const{geometry:a}=r,i={...r.attributes};if(null!=e&&"mesh"===a?.type){const{transformFieldRoles:u}=e,{origin:y,spatialReference:h,transform:R,vertexSpace:E}=a,Z="local"===E.type,_=t.spatialReference,z=_.isGeographic,G=(0,w.fS)(_,h),oe=G||(0,w.oR)(_)&&((0,w.oR)(h)||(0,w.sS)(h));if(!(Z&&z&&oe||!Z&&!z&&G))return null;const B=(0,S.projectWithoutEngine)(y,h,_);if(null==B)return null;if(i[u.originX]=B.x,i[u.originY]=B.y,i[u.originZ]=B.z??0,null!=R){const{translation:I,scale:ae,rotation:x}=R,J=Z?1:(0,F.r6)(h)/(0,F.r6)(_);i[u.translationX]=I[0]*J,i[u.translationY]=I[2]*J,i[u.translationZ]=-I[1]*J,i[u.scaleX]=ae[0],i[u.scaleY]=ae[2],i[u.scaleZ]=ae[1],i[u.rotationX]=x[0],i[u.rotationY]=x[2],i[u.rotationZ]=-x[1],i[u.rotationDeg]=x[3]}return{attributes:i}}return null==a?{attributes:i}:"mesh"===a.type||"extent"===a.type?null:{geometry:a.toJSON(),attributes:i}})).apply(this,arguments)}function ye(){return(ye=(0,m.Z)(function*(t,r){const e=yield Promise.all((r.addAttachments??[]).map(u=>he(t,u))),a=yield Promise.all((r.updateAttachments??[]).map(u=>he(t,u))),i=r.deleteAttachments??[];return e.length||a.length||i.length?{adds:e,updates:a,deletes:[...i]}:null})).apply(this,arguments)}function he(t,r){return fe.apply(this,arguments)}function fe(){return(fe=(0,m.Z)(function*(t,r){const{feature:e,attachment:a}=r,{globalId:i,name:u,contentType:y,data:h,uploadId:R}=a,E={globalId:i};if(e&&("attributes"in e?E.parentGlobalId=e.attributes?.[t.globalIdField]:e.globalId&&(E.parentGlobalId=e.globalId)),R)E.uploadId=R;else if(h){const Z=yield(0,C.IR)(h);Z&&(E.contentType=Z.mediaType,E.data=Z.data),h instanceof File&&(E.name=h.name)}return u&&(E.name=u),y&&(E.contentType=y),E})).apply(this,arguments)}function j(t){const r=!0===t.success?null:t.error||{code:void 0,description:void 0};return{objectId:t.objectId,globalId:t.globalId,error:r?new $.Z("feature-layer-source:edit-failure",r.description,{code:r.code}):null}}function ne(t,r){return new p.Z({attributes:t.attributes,geometry:(0,ee.im)({...t.geometry,spatialReference:r})})}function be(t,r){return{adds:t?.adds?.map(e=>ne(e,r))||[],updates:t?.updates?.map(e=>({original:ne(e[0],r),current:ne(e[1],r)}))||[],deletes:t?.deletes?.map(e=>ne(e,r))||[],spatialReference:r}}var Oe=o(56554),ve=o(4802),Re=o(38305),pe=o(26331),s=o(35391),n=o(2865),d=o(20514),l=o(96854),c=o(67385),A=o(65234);const W=new Y.X({originalAndCurrentFeatures:"original-and-current-features",none:"none"}),v=new Set(["Feature Layer","Oriented Imagery Layer","Table","Catalog Layer"]),b=new Y.X({Started:"published",Publishing:"publishing",Stopped:"unavailable"});let U=class extends O.Z{constructor(){var t;super(...arguments),t=this,this.type="feature-layer",this.refresh=(0,K.Ds)((0,m.Z)(function*(){yield t.load();const r=t.sourceJSON.editingInfo?.lastEditDate;if(null==r)return{dataChanged:!0,updates:{}};try{yield t._fetchService(null)}catch{return{dataChanged:!0,updates:{}}}const e=r!==t.sourceJSON.editingInfo?.lastEditDate;return{dataChanged:e,updates:e?{editingInfo:t.sourceJSON.editingInfo,extent:t.sourceJSON.extent}:null}})),this._ongoingAssetUploads=new Map}load(t){const e=this._fetchService(this.layer.sourceJSON,{...t}).then(()=>this.layer.setUserPrivileges(this.sourceJSON.serviceItemId,t)).then(()=>this._ensureLatestMetadata(t));return this.addResolvingPromise(e),Promise.resolve(this)}get queryTask(){const{capabilities:t,parsedUrl:r,dynamicDataSource:e,infoFor3D:a,gdbVersion:i,spatialReference:u,fieldsIndex:y}=this.layer,h=(0,X.Z)("featurelayer-pbf")&&t?.query.supportsFormatPBF&&null==a;return new ve.Z({url:r.path,pbfSupported:h,fieldsIndex:y,infoFor3D:a,dynamicDataSource:e,gdbVersion:i,sourceSpatialReference:u,queryAttachmentsSupported:t?.operations?.supportsQueryAttachments??!1})}addAttachment(t,r){var e=this;return(0,m.Z)(function*(){yield e.load();const{layer:a}=e;yield(0,pe.nU)(a,"editing");const i=t.attributes[a.objectIdField],u=a.parsedUrl.path+"/"+i+"/addAttachment",y=e._getLayerRequestOptions(),h=e._getFormDataForAttachment(r,y.query);try{return j((yield(0,M.Z)(u,{body:h})).data.addAttachmentResult)}catch(R){throw e._createAttachmentErrorResult(i,R)}})()}updateAttachment(t,r,e){var a=this;return(0,m.Z)(function*(){yield a.load();const{layer:i}=a;yield(0,pe.nU)(i,"editing");const u=t.attributes[i.objectIdField],y=i.parsedUrl.path+"/"+u+"/updateAttachment",h=a._getLayerRequestOptions({query:{attachmentId:r}}),R=a._getFormDataForAttachment(e,h.query);try{return j((yield(0,M.Z)(y,{body:R})).data.updateAttachmentResult)}catch(E){throw a._createAttachmentErrorResult(u,E)}})()}applyEdits(t,r){var e=this;return(0,m.Z)(function*(){yield e.load();const{layer:a}=e;yield(0,pe.nU)(a,"editing");const i=a.infoFor3D,u=null!=i,y=u||(r?.globalIdUsed??!1),h=u?yield e._uploadMeshesAndGetAssetMapEditsJSON(t):null,R=t.addFeatures?.map(P=>L(e.layer,P,i))??[],E=(yield Promise.all(R)).filter(V.pC),Z=t.updateFeatures?.map(P=>L(e.layer,P,i))??[],_=(yield Promise.all(Z)).filter(V.pC),z=function Ae(t,r,e){if(!r||0===r.length)return[];if(e&&(0,te.isFeatureIdentifierArrayWithGlobalId)(r))return r.map(i=>i.globalId);if((0,te.isFeatureIdentifierArrayWithObjectId)(r))return r.map(i=>i.objectId);const a=e?t.globalIdField:t.objectIdField;return a?r.map(i=>i.getAttribute(a)):[]}(e.layer,t.deleteFeatures,y);(0,d.P)(E,_,a.spatialReference);const G=yield function Ie(t,r){return ye.apply(this,arguments)}(e.layer,t),oe=a.capabilities.editing.supportsAsyncApplyEdits&&u,B=r?.gdbVersion||a.gdbVersion,I={gdbVersion:B,rollbackOnFailure:r?.rollbackOnFailureEnabled,useGlobalIds:y,returnEditMoment:r?.returnEditMoment,usePreviousEditMoment:r?.usePreviousEditMoment,async:oe};yield(0,c.Px)(e.layer.url,B,!0);const ae=(0,c.JV)(e.layer.url,B||null);if(yield(0,c.r9)(a.url,B,a.historicMoment))throw new $.Z("feature-layer-source:historic-version","Editing a historic version is not allowed");r?.returnServiceEditsOption?(I.edits=JSON.stringify([{id:a.layerId,adds:E,updates:_,deletes:z,attachments:G,assetMaps:h}]),I.returnServiceEditsOption=W.toJSON(r?.returnServiceEditsOption),I.returnServiceEditsInSourceSR=r?.returnServiceEditsInSourceSR):(I.adds=E.length?JSON.stringify(E):null,I.updates=_.length?JSON.stringify(_):null,I.deletes=z.length?y?JSON.stringify(z):z.join(","):null,I.attachments=G&&JSON.stringify(G),I.assetMaps=null!=h?JSON.stringify(h):void 0);const x=e._getLayerRequestOptions({method:"post",query:I});ae&&(x.authMode="immediate",x.query.returnEditMoment=!0,x.query.sessionId=c.U8);const J=r?.returnServiceEditsOption?a.url:a.parsedUrl.path;let Ee;try{Ee=oe?yield e._asyncApplyEdits(J+"/applyEdits",x):yield(0,M.Z)(J+"/applyEdits",x)}catch(P){if(!function ge(t){const r=t.details.raw,a=+r.extendedCode;return 500==+r.code&&(-2147217144===a||-2147467261===a)}(P))throw P;x.authMode="immediate",Ee=oe?yield e._asyncApplyEdits(J+"/applyEdits",x):yield(0,M.Z)(J+"/applyEdits",x)}return!a.capabilities.operations?.supportsEditing&&a.effectiveCapabilities?.operations?.supportsEditing&&(yield g.id?.findCredential(a.url)?.refreshToken()),e._createEditsResult(Ee)})()}deleteAttachments(t,r){var e=this;return(0,m.Z)(function*(){yield e.load();const{layer:a}=e;yield(0,pe.nU)(a,"editing");const i=t.attributes[a.objectIdField],u=a.parsedUrl.path+"/"+i+"/deleteAttachments";try{return(yield(0,M.Z)(u,e._getLayerRequestOptions({query:{attachmentIds:r.join(",")},method:"post"}))).data.deleteAttachmentResults.map(j)}catch(y){throw e._createAttachmentErrorResult(i,y)}})()}fetchRecomputedExtents(t={}){var r=this;return this.load({signal:t.signal}).then((0,m.Z)(function*(){const a=r._getLayerRequestOptions({...t,query:{returnUpdates:!0}}),{layerId:i,url:u}=r.layer,{data:y}=yield(0,M.Z)(`${u}/${i}`,a),{id:h,extent:R,fullExtent:E,timeExtent:Z}=y,_=R||E;return{id:h,fullExtent:_&&ue.Z.fromJSON(_),timeExtent:Z&&H.Z.fromJSON({start:Z[0],end:Z[1]})}}))}queryAttachments(t,r={}){var e=this;return(0,m.Z)(function*(){yield e.load();const a=e._getLayerRequestOptions(r);return e.queryTask.executeAttachmentQuery(t,a)})()}queryFeatures(t,r){var e=this;return(0,m.Z)(function*(){yield e.load();const a=yield e.queryTask.execute(t,{...r,query:e._createRequestQueryOptions(r)});return t.outStatistics?.length&&a.features.length&&a.features.forEach(i=>{const u=i.attributes;t.outStatistics?.forEach(({outStatisticFieldName:y})=>{if(y){const h=y.toLowerCase();h&&h in u&&y!==h&&(u[y]=u[h],delete u[h])}})}),a})()}queryFeaturesJSON(t,r){var e=this;return(0,m.Z)(function*(){return yield e.load(),e.queryTask.executeJSON(t,{...r,query:e._createRequestQueryOptions(r)})})()}queryObjectIds(t,r){var e=this;return(0,m.Z)(function*(){return yield e.load(),e.queryTask.executeForIds(t,{...r,query:e._createRequestQueryOptions(r)})})()}queryFeatureCount(t,r){var e=this;return(0,m.Z)(function*(){return yield e.load(),e.queryTask.executeForCount(t,{...r,query:e._createRequestQueryOptions(r)})})()}queryExtent(t,r){var e=this;return(0,m.Z)(function*(){return yield e.load(),e.queryTask.executeForExtent(t,{...r,query:e._createRequestQueryOptions(r)})})()}queryRelatedFeatures(t,r){var e=this;return(0,m.Z)(function*(){return yield e.load(),e.queryTask.executeRelationshipQuery(t,{...r,query:e._createRequestQueryOptions(r)})})()}queryRelatedFeaturesCount(t,r){var e=this;return(0,m.Z)(function*(){return yield e.load(),e.queryTask.executeRelationshipQueryForCount(t,{...r,query:e._createRequestQueryOptions(r)})})()}queryTopFeatures(t,r){var e=this;return(0,m.Z)(function*(){return yield e.load(),e.queryTask.executeTopFeaturesQuery(t,{...r,query:e._createRequestQueryOptions(r)})})()}queryTopObjectIds(t,r){var e=this;return(0,m.Z)(function*(){return yield e.load(),e.queryTask.executeForTopIds(t,{...r,query:e._createRequestQueryOptions(r)})})()}queryTopExtents(t,r){var e=this;return(0,m.Z)(function*(){return yield e.load(),e.queryTask.executeForTopExtents(t,{...r,query:e._createRequestQueryOptions(r)})})()}queryTopCount(t,r){var e=this;return(0,m.Z)(function*(){return yield e.load(),e.queryTask.executeForTopCount(t,{...r,query:e._createRequestQueryOptions(r)})})()}fetchPublishingStatus(){var t=this;return(0,m.Z)(function*(){if(!(0,Re.M8)(t.layer.url))return"unavailable";const r=(0,C.v_)(t.layer.url,"status"),e=yield(0,M.Z)(r,{query:{f:"json"}});return b.fromJSON(e.data.status)})()}uploadAssets(t,r){var e=this;return(0,m.Z)(function*(){const{uploadAssets:a}=yield Promise.all([o.e(8592),o.e(6954)]).then(o.bind(o,66954));return a(t,{layer:e.layer,ongoingUploads:e._ongoingAssetUploads},r)})()}_asyncApplyEdits(t,r){return(0,m.Z)(function*(){const e=(yield(0,M.Z)(t,r)).data.statusUrl;for(;;){const a=(yield(0,M.Z)(e,{query:{f:"json"},responseType:"json"})).data;switch(a.status){case"Completed":return(0,M.Z)(a.resultUrl,{query:{f:"json"},responseType:"json"});case"CompletedWithErrors":throw new $.Z("async-applyEdits-failed","asynchronous applyEdits call failed.");case"Failed ImportChanges":case"InProgress":case"Pending":case"ExportAttachments":case"ExportChanges":case"ExportingData":case"ExportingSnapshot":case"ImportAttachments":case"ProvisioningReplica":case"UnRegisteringReplica":break;default:throw new $.Z("async-applyEdits-failed","asynchronous applyEdits call failed (undefined response status)")}yield(0,K.e4)(se)}})()}_createRequestQueryOptions(t){const r={...this.layer.customParameters,token:this.layer.apiKey,...t?.query};return this.layer.datesInUnknownTimezone&&(r.timeReferenceUnknownClient=!0),r}_fetchService(t,r){var e=this;return(0,m.Z)(function*(){if(!t){const i={};(0,X.Z)("featurelayer-advanced-symbols")&&(i.returnAdvancedSymbols=!0),r?.cacheBust&&(i._ts=Date.now());const{data:u}=yield(0,M.Z)(e.layer.parsedUrl.path,e._getLayerRequestOptions({query:i,signal:r?.signal}));t=u}e.sourceJSON=yield e._patchServiceJSON(t,r?.signal);const a=t.type;if(!v.has(a))throw new $.Z("feature-layer-source:unsupported-type",`Source type "${a}" is not supported`)})()}_patchServiceJSON(t,r){var e=this;return(0,m.Z)(function*(){if("Table"!==t.type&&t.geometryType&&!t?.drawingInfo?.renderer&&!t.defaultSymbol){const a=(0,Oe.bU)(t.geometryType).renderer;(0,q.RB)("drawingInfo.renderer",a,t)}if("esriGeometryMultiPatch"===t.geometryType&&t.infoFor3D&&(t.geometryType="mesh"),null==t.extent)try{const{data:a}=yield(0,M.Z)(e.layer.url,e._getLayerRequestOptions({signal:r}));a.spatialReference&&(t.extent={xmin:0,ymin:0,xmax:0,ymax:0,spatialReference:a.spatialReference})}catch(a){(0,K.r9)(a)}return t})()}_ensureLatestMetadata(t){var r=this;return(0,m.Z)(function*(){if(r.layer.userHasUpdateItemPrivileges&&r.sourceJSON.cacheMaxAge>0)return r._fetchService(null,{...t,cacheBust:!0})})()}_uploadMeshesAndGetAssetMapEditsJSON(t){var r=this;return(0,m.Z)(function*(){const{addAssetFeatures:e}=t;if(!e?.length)return null;const a=yield r._filterRedundantAssetMaps(e);if(!e?.length)return null;const i=new Array,u=new Map;for(const y of a){const{geometry:h}=y,{vertexSpace:R}=h;if((0,de.zZ)(R))i.push(h);else{const E=(0,de.wm)(h);u.set(E,h),y.geometry=E,i.push(E)}}yield r.uploadAssets(i);for(const[y,h]of u)h.addExternalSources(y.metadata.externalSources.items);return{adds:r._getAssetMapEditsJSON(a),updates:[],deletes:[]}})()}_getAssetMapEditsJSON(t){const r=new Array,e=this.layer.globalIdField,a=this.layer.parsedUrl;for(const i of t){const u=i.geometry,{metadata:y}=u,h=y.getExternalSourcesOnService(a),R=i.getAttribute(e);if(0===h.length){D.Z.getLogger(this).error(`Skipping feature ${R}. The mesh it is associated with has not been uploaded to the service and cannot be mapped to it.`);continue}const{source:E}=h.find(f.yT)??h[0];for(const Z of E)1===Z.parts.length?r.push({globalId:(0,le.zS)(),parentGlobalId:R,assetName:Z.assetName,assetHash:Z.parts[0].partHash,flags:[]}):D.Z.getLogger(this).error(`Skipping asset ${Z.assetName}. It does not have exactly one part, so we cannot map it to a feature.`)}return r}_createEditsResult(t){const r=t.data,{layerId:e}=this.layer,a=[];let i=null;if(Array.isArray(r))for(const y of r)a.push({id:y.id,editedFeatures:y.editedFeatures}),y.id===e&&(i={addResults:y.addResults??[],updateResults:y.updateResults??[],deleteResults:y.deleteResults??[],attachments:y.attachments,editMoment:y.editMoment});else i=r;const u=function me(t){const r=t?.assetMaps;if(r){for(const i of r.addResults)i.success||D.Z.getLogger("esri.layers.graphics.sources.support.sourceUtils").error(`Failed to map asset to feature with globalId ${i.globalId}.`);for(const i of r.updateResults)i.success||D.Z.getLogger("esri.layers.graphics.sources.support.sourceUtils").error(`Failed to map asset to feature with globalId ${i.globalId}.`)}const e=t?.attachments,a={addFeatureResults:t?.addResults?.map(j)??[],updateFeatureResults:t?.updateResults?.map(j)??[],deleteFeatureResults:t?.deleteResults?.map(j)??[],addAttachmentResults:e?.addResults?e.addResults.map(j):[],updateAttachmentResults:e?.updateResults?e.updateResults.map(j):[],deleteAttachmentResults:e?.deleteResults?e.deleteResults.map(j):[]};return t?.editMoment&&(a.editMoment=t.editMoment),a}(i);if(a.length>0){u.editedFeatureResults=[];for(const y of a){const{editedFeatures:h}=y,R=h?.spatialReference?new A.Z(h.spatialReference):null;u.editedFeatureResults.push({layerId:y.id,editedFeatures:be(h,R)})}}return u}_createAttachmentErrorResult(t,r){return{objectId:t,globalId:null,error:new $.Z("feature-layer-source:attachment-failure",r.details.messages?.[0]||r.message,{code:r.details.httpStatus||r.details.messageCode})}}_getFormDataForAttachment(t,r){const e=t instanceof FormData?t:t&&t.elements?new FormData(t):null;if(e)for(const a in r){const i=r[a];null!=i&&(e.set?e.set(a,i):e.append(a,i))}return e}_getLayerRequestOptions(t={}){const{parsedUrl:r,gdbVersion:e,dynamicDataSource:a}=this.layer;return{...t,query:{gdbVersion:e,layer:a?JSON.stringify({source:a}):void 0,...r.query,f:"json",...this._createRequestQueryOptions(t)},responseType:"json"}}_filterRedundantAssetMaps(t){var r=this;return(0,m.Z)(function*(){const{layer:e}=r,{globalIdField:a,infoFor3D:i,parsedUrl:u}=e;if(null==i||null==a)return t;const y=(0,s.$6)(i);if(null==y)return t;const h=(0,C.v_)(u.path,`../${y.id}`),R=new Array,E=new Array;for(const I of t)I.geometry.metadata.getExternalSourcesOnService(u).length>0?E.push(I):R.push(I);const Z=E.map(I=>I.getAttribute(a)).filter(V.pC);if(0===Z.length)return t;const{assetMapFieldRoles:{parentGlobalId:_,assetHash:z}}=i,G=new l.Z;G.where=`${_} IN (${Z.map(I=>`'${I}'`)})`,G.outFields=[z,_],G.returnGeometry=!1;const oe=yield(0,n.e)(h,G),{features:B}=oe;return 0===B.length?t:[...R,...E.filter(I=>{const ae=I.getAttribute(a);if(!ae)return!0;const{metadata:x}=I.geometry,J=B.filter(P=>P.getAttribute(_)===ae);if(0===J.length)return!0;const Ee=J.map(P=>P.getAttribute(z));return x.getExternalSourcesOnService(u).flatMap(({source:P})=>P.flatMap(Se=>Se.parts.map(Ze=>Ze.partHash))).some(P=>Ee.every(Se=>P!==Se))})]})()}};(0,Q._)([(0,k.Cb)()],U.prototype,"type",void 0),(0,Q._)([(0,k.Cb)({constructOnly:!0})],U.prototype,"layer",void 0),(0,Q._)([(0,k.Cb)({readOnly:!0})],U.prototype,"queryTask",null),U=(0,Q._)([(0,ce.j)("esri.layers.graphics.sources.FeatureLayerSource")],U);const se=1e3,T=U},56554:(Fe,N,o)=>{o.d(N,{Dm:()=>$,Hq:()=>X,MS:()=>Y,bU:()=>M});var m=o(8314),Q=o(58817),ie=o(87757),g=o(24837);function M(O){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===O||"esriGeometryMultipoint"===O?g.I4:"esriGeometryPolyline"===O?g.ET:g.lF}}}const H=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let V=1;function $(O,D){if((0,m.Z)("esri-csp-restrictions"))return()=>({[D]:null,...O});try{let q=`this.${D} = null;`;for(const C in O)q+=`this${H.test(C)?`.${C}`:`["${C}"]`} = ${JSON.stringify(O[C])};`;const K=new Function(`\n      return class AttributesClass$${V++} {\n        constructor() {\n          ${q};\n        }\n      }\n    `)();return()=>new K}catch{return()=>({[D]:null,...O})}}function X(O={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,Q.d9)(O)}}]}function Y(O,D){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:O},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:D,supportsDelete:D,supportsEditing:D,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:D,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:ie.g,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:D,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}}}]);