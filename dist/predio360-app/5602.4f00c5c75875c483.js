"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[5602],{128:(mt,Q,s)=>{s.d(Q,{B:()=>v});var r=s(26584),H=s(50011),lt=s(22558),N=s(21726),w=s(35948),l=s(34117),ct=s(31283),$=s(77712),M=s(61556),R=s(29840);function v(a){const b=a?.origins??[void 0];return(C,E)=>{const f=function yt(a,b,C){if("resource"===a?.type)return function ft(a,b,C){const E=(0,l.Oe)(b,C);return{type:String,read:(f,_,P)=>{const y=(0,R.r)(f,_,P);return E.type===String?y:"function"==typeof E.type?new E.type({url:y}):void 0},write:{writer(f,_,P,y){if(!y?.resources)return"string"==typeof f?void(_[P]=(0,R.t)(f,y)):void(_[P]=f.write({},y));const L=function bt(a){return null==a?null:"string"==typeof a?a:a.url}(f),F=(0,R.t)(L,{...y,verifyItemRelativeUrls:y?.verifyItemRelativeUrls?{writtenUrls:y.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},R.M.NO),X=E.type!==String&&(!(0,lt.l)(this)||y?.origin&&this.originIdOf(C)>(0,ct.M9)(y.origin)),B={object:this,propertyName:C,value:f,targetUrl:F,dest:_,targetPropertyName:P,context:y,params:a};y?.portalItem&&F&&!(0,N.YP)(F)?X&&a?.contentAddressed?ht(B):X?function ut(a){const{context:b,targetUrl:C,params:E,value:f,dest:_,targetPropertyName:P}=a;if(!b.portalItem)return;const y=b.portalItem.resourceFromPath(C),L=J(f,C,b),F=(0,M.B)(L),X=(0,N.Ml)(y.path),B=E?.compress??!1;F===X?(b.resources&&tt({...a,resource:y,content:L,compress:B,updates:b.resources.toUpdate}),_[P]=C):ht(a)}(B):function Ct({context:a,targetUrl:b,dest:C,targetPropertyName:E}){a.portalItem&&a.resources&&(a.resources.toKeep.push({resource:a.portalItem.resourceFromPath(b),compress:!1}),C[E]=b)}(B):y?.portalItem&&(null==F||null!=(0,R.i)(F)||(0,N.jc)(F)||X)?ht(B):_[P]=F}}}}(a,b,C);switch(a?.type??"other"){case"other":return{read:!0,write:!0};case"url":{const{read:E,write:f}=R.b;return{read:E,write:f}}}}(a,C,E);for(const _ of b){const P=(0,$.CJ)(C,_,E);for(const y in f)P[y]=f[y]}}}function ht(a){const{targetUrl:b,params:C,value:E,context:f,dest:_,targetPropertyName:P}=a;if(!f.portalItem)return;const y=(0,R.p)(b),L=J(E,b,f);if(C?.contentAddressed&&"json"!==L.type)return void f.messages?.push(new r.Z("persistable:contentAddressingUnsupported",`Property "${P}" is trying to serializing a resource with content of type ${L.type} with content addressing. Content addressing is only supported for json resources.`,{content:L}));const F=C?.contentAddressed&&"json"===L.type?(0,H.F)(L.jsonString):y?.filename??(0,w.DO)(),X=(0,N.v_)(C?.prefix??y?.prefix,F),B=`${X}.${(0,M.B)(L)}`;if(C?.contentAddressed&&f.resources&&"json"===L.type){const q=f.resources.toKeep.find(({resource:A})=>A.path===B)??f.resources.toAdd.find(({resource:A})=>A.path===B);if(q)return void(_[P]=q.resource.itemRelativeUrl)}const nt=f.portalItem.resourceFromPath(B);(0,N.jc)(b)&&f.resources&&f.resources.pendingOperations.push((0,N.gi)(b).then(q=>{nt.path=`${X}.${(0,M.B)({type:"blob",blob:q})}`,_[P]=nt.itemRelativeUrl}).catch(()=>{}));const it=C?.compress??!1;f.resources&&tt({...a,resource:nt,content:L,compress:it,updates:f.resources.toAdd}),_[P]=nt.itemRelativeUrl}function tt({object:a,propertyName:b,updates:C,resource:E,content:f,compress:_}){C.push({resource:E,content:f,compress:_,finish:y=>{!function j(a,b,C){"string"==typeof a[b]?a[b]=C.url:a[b].url=C.url}(a,b,y)}})}function J(a,b,C){return"string"==typeof a?{type:"url",url:b}:{type:"json",jsonString:JSON.stringify(a.toJSON(C))}}},22558:(mt,Q,s)=>{function r(H){return H&&"getAtOrigin"in H&&"originOf"in H}s.d(Q,{l:()=>r})},61556:(mt,Q,s)=>{s.d(Q,{B:()=>H});var r=s(21726);function H(M){return w[function lt(M){return"json"===M.type?"application/json":"blob"===M.type?M.blob.type:function N(M){const R=(0,r.Ml)(M);return $[R]||l}(M.url)}(M)]||ct}const w={},l="text/plain",ct=w[l],$={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const M in $)w[$[M]]=M},67322:(mt,Q,s)=>{s.r(Q),s.d(Q,{default:()=>be});var r=s(17626),H=s(83761),lt=s(46160),N=s(61885),w=s(62208),l=s(77712),$=(s(8314),s(63290)),R=(s(4619),s(76898)),v=s(29302),yt=s(1437),ft=s(15861),ut=(s(29132),s(8425)),Ct=s(59213),tt=s(72392),J=s(54024),bt=s(10699),j=s(32917),a=s(79800),b=s(11426),C=s(55915),E=s(51707),f=s(65401),_=s(70562),P=s(60507);let y=class extends H.Z{constructor(t){super(t),this.target=null,this.intersectedGraphic=null,this.intersectedLocation=null,this.elevationAlignedTargetLocation=null,this.visible=void 0}};(0,r._)([(0,l.Cb)()],y.prototype,"target",void 0),(0,r._)([(0,l.Cb)()],y.prototype,"intersectedGraphic",void 0),(0,r._)([(0,l.Cb)()],y.prototype,"intersectedLocation",void 0),(0,r._)([(0,l.Cb)()],y.prototype,"elevationAlignedTargetLocation",void 0),(0,r._)([(0,l.Cb)({type:Boolean})],y.prototype,"visible",void 0),y=(0,r._)([(0,R.j)("esri.views.3d.analysis.LineOfSightAnalysisResult")],y);let L=class extends H.Z{constructor(t){super(t),this.elevationAlignedTargetLocation=null,this.inputPoints={isValid:!1,observer:(0,v.Ue)(),observerSurfaceNormal:null,observerFeatureId:null,target:(0,v.Ue)(),targetSurfaceNormal:null,targetFeatureId:null,observerAdjusted:(0,v.Ue)(),targetAdjusted:(0,v.Ue)()},this.computationResult={start:(0,v.Ue)(),end:(0,v.Ue)(),intersection:(0,v.Ue)(),isValid:!1,isTargetVisible:!1},this.result=null}notifyResultChanged(){this.notifyChange("computationResult")}notifyInputPointsChanged(){this.notifyChange("inputPoints")}};(0,r._)([(0,l.Cb)()],L.prototype,"target",void 0),(0,r._)([(0,l.Cb)()],L.prototype,"elevationAlignedTargetLocation",void 0),(0,r._)([(0,l.Cb)()],L.prototype,"inputPoints",void 0),(0,r._)([(0,l.Cb)()],L.prototype,"computationResult",void 0),(0,r._)([(0,l.Cb)()],L.prototype,"result",void 0),L=(0,r._)([(0,R.j)("esri.views.3d.analysis.LineOfSight.LineOfSightComputation")],L);var q,F=s(23841),X=s(26242),B=s(38114),nt=s(85931),it=s(58817);let A=q=class extends H.Z{constructor(t){super(t)}clone(){return new q({type:this.type,id:(0,it.d9)(this.id),mapPoint:(0,it.d9)(this.mapPoint),renderPoint:(0,v.d9)(this.renderPoint),normal:(0,it.d9)(this.normal),ray:(0,it.d9)(this.ray),graphic:this.graphic})}equals(t){return this.type===t.type&&this.id===t.id&&(0,w._W)(this.mapPoint,t.mapPoint)&&(0,a.G)(this.renderPoint,t.renderPoint)&&(0,nt.fS)(this.normal,t.normal)&&(0,_.fS)(this.ray,t.ray)&&this.graphic===t.graphic}};(0,r._)([(0,l.Cb)()],A.prototype,"type",void 0),(0,r._)([(0,l.Cb)({constructOnly:!0})],A.prototype,"id",void 0),(0,r._)([(0,l.Cb)({constructOnly:!0})],A.prototype,"mapPoint",void 0),(0,r._)([(0,l.Cb)({constructOnly:!0})],A.prototype,"renderPoint",void 0),(0,r._)([(0,l.Cb)({constructOnly:!0})],A.prototype,"normal",void 0),(0,r._)([(0,l.Cb)({constructOnly:!0})],A.prototype,"graphic",void 0),(0,r._)([(0,l.Cb)({constructOnly:!0})],A.prototype,"ray",void 0),A=q=(0,r._)([(0,R.j)("esri.views.3d.analysis.LineOfSight.LineOfSightIntersectionResult")],A);var Lt=s(77926),$t=s(26046),Jt=s(90793),Xt=s(62483),Y=s(67857),st=s(93867),St=s(72642);let ot=class extends H.Z{constructor(t){super(t),this._terrainIntersectionOptionsLayerUids=new Set(["terrain"])}initialize(){this.intersector=(0,Xt.Z8)(this.view.state.viewingMode),this.intersector.options.hud=!1,this.intersector.options.store=Y.eC.MIN}getScreenPointIntersection(t){const e=(0,F.md)(t,X.qW.get()),n=(0,$t.u4)(this.view.state.camera,e,_t);return this._getRayIntersection(n)}_getRayIntersection(t,e){if(null==t||null==this.view.sceneIntersectionHelper)return null;const{intersector:n}=this;n.options.store=Y.eC.MIN,this.view.sceneIntersectionHelper.intersectToolIntersectorRay(t,n,e);const i=n.results.min,u=(0,v.Ue)();if(!i.getIntersectionPoint(u)||null!=e?.maxDistance&&(0,a.a)(u,t.origin)>e.maxDistance**2)return null;const d=this.view.renderCoordsHelper.fromRenderCoords(u,new St.Z({spatialReference:this.view.spatialReference})),c=(0,v.d9)(i.normal);if((0,Lt.GS)(i))return new A({type:Y.q7.OBJECT,id:`${i.target.layerUid}/${i.target.nodeIndex}/${i.target.componentIndex}`,mapPoint:d,renderPoint:u,normal:c,ray:(0,_.JG)(t),graphic:null});if((0,Lt.BF)(i))return new A({type:Y.q7.OBJECT,id:`${i.target.layerUid}/${i.target.graphicUid}`,mapPoint:d,renderPoint:u,normal:c,ray:(0,_.JG)(t),graphic:null});if((0,Jt.TX)(i))return new A({type:Y.q7.TERRAIN,id:i.target.lij.slice(),mapPoint:d,renderPoint:u,normal:c,ray:(0,_.JG)(t),graphic:null});const g=(0,st.tB)(i,this.view);if(null!=g){const m=g.layer,p=g.sourceLayer;let h;return h=p&&"scene"===p.type?(0,B.MS)(g,p.objectIdField):g.uid,new A({type:Y.q7.OBJECT,id:`${m?.uid}/${h}`,mapPoint:d,renderPoint:u,normal:c,ray:(0,_.JG)(t),graphic:g})}return null}updateFromGroundIntersection(t,e,n){const i=Yt,u=kt,d=Qt,c=Et;(0,a.c)(u,t),this.view.renderCoordsHelper.worldUpAtPosition(u,d),(0,a.n)(d,d);const g=this.view.basemapTerrain.visibleElevationBounds,m=(e>=0?1:-1)*((g?Math.abs(g.max-g.min):100)+Math.abs(e));(0,a.h)(c,d,m),(0,a.g)(i,u,c),(0,_.zk)(i,u,_t);const p=this._getRayIntersection(_t,{include:this._terrainIntersectionOptionsLayerUids,maxDistance:m});if(null!=p){const h=Et;return(0,a.h)(h,d,e),(0,a.g)(n,p.renderPoint,h),(0,v.d9)(p.normal)}return(0,a.c)(n,t),null}};(0,r._)([(0,l.Cb)()],ot.prototype,"view",void 0),(0,r._)([(0,l.Cb)()],ot.prototype,"intersector",void 0),ot=(0,r._)([(0,R.j)("esri.views.3d.analysis.LineOfSight.LineOfSightRayIntersector")],ot);const Yt=(0,v.Ue)(),kt=(0,v.Ue)(),Qt=(0,v.Ue)(),Et=(0,v.Ue)(),_t=(0,_.Ue)();var wt=s(54865),rt=s(87091);let V=class extends(N.Z.EventedMixin(H.Z)){constructor(t){super(t),this.updateOnCameraChange=!0,this._observerGroundOffsetRenderSpace=0,this._effectiveObserverElevationMode="absolute-height",this._observerFeatureId=null,this._updatingHandles=new b.R,this._frameTask=rt.sq,this._computationHandles=new tt.Z,this._externalObserverUpdate=!0}initialize(){const t=this.view.resourceController?.scheduler;this._frameTask=t?t.registerTask(rt.T8.LINE_OF_SIGHT_TOOL):rt.sq,this._intersector=new ot({view:this.view}),this.addHandles([this._connectObserver(),this._connectComputations(),this._connectTargets()])}destroy(){this._computationHandles.destroy(),this._computations.removeAll(),this._updatingHandles.destroy()}get updating(){return this._frameTask.updating||this._updatingHandles.updating}get priority(){return this._frameTask.priority}set priority(t){this._frameTask.priority=t}get _computations(){return this.analysisViewData.computations}get _elevationAlignedObserverPositionRenderSpace(){return this.analysisViewData.observerEngineLocation}set _elevationAlignedObserverPositionRenderSpace(t){this.analysisViewData.observerEngineLocation=t}get _screenPixelSize(){return this.view.state.camera.computeScreenPixelSizeAt(this._elevationAlignedObserverPositionRenderSpace)}_computeResult(t){const e=t.computation,{inputPoints:n,computationResult:i}=e,{observerAdjusted:u,targetAdjusted:d}=n,{start:c,end:g}=i;(0,a.c)(c,u),(0,a.c)(g,d),this._canCompute(e)?this._computeIntersection(t):this._interpolateIntersection(t),e.notifyResultChanged(),this.emit("result-changed",{target:t.computation.target,result:e.result})}_updateAdjustedPointsFromFeatures(t){const e=this.view,{sceneIntersectionHelper:n}=e,{inputPoints:i}=t,{observerAdjusted:u,observerFeatureId:d,targetFeatureId:c,targetAdjusted:g}=i;if(null==d&&null==c)return;const m=(0,a.q)(u,g),p=this._intersector.intersector,h=(0,_.zk)(i.observer,i.target,Rt);p.options.store=Y.eC.ALL,n.intersectToolIntersectorRay(h,p);let T=null,O=null,z=null,D=null;for(const Z of p.results.all){const S=(0,st.tB)(Z,this.view);if(null==S||null==Z.distanceInRenderSpace)continue;const K=(0,ut.pD)(S);null!=K&&(null!=d&&K===d&&(null==T&&(T=this._getFeatureDistanceThreshold(Z,e,m)),Z.distanceInRenderSpace<T&&(z=Z)),null!=c&&K===c&&(null==O&&(O=this._getFeatureDistanceThreshold(Z,e,m)),null==D&&Z.distanceInRenderSpace<m&&m-Z.distanceInRenderSpace<O&&(D=Z)))}null!=z&&z.getIntersectionPoint(u)&&(i.observerSurfaceNormal=z.getTransformedNormal((0,v.Ue)())),null!=D&&D.getIntersectionPoint(g)&&(i.targetSurfaceNormal=D.getTransformedNormal((0,v.Ue)()))}_getFeatureDistanceThreshold(t,e,n){if((0,st._s)(t)){const i=(0,st.VB)(t,e);if(null!=i)return Math.min(i*te,n)}return 1e-5*n}_adjustStartEndPositions(t){const e=this._screenPixelSize,n=this.view,{inputPoints:i}=t,{observer:u,observerSurfaceNormal:d,target:c,targetSurfaceNormal:g,observerAdjusted:m,targetAdjusted:p}=i,h=pt;(0,a.c)(m,u),(0,a.c)(p,c),this._updateAdjustedPointsFromFeatures(t),null!=d?(0,a.c)(h,d):(0,a.f)(h,p,m);const T=e;(0,a.n)(h,h),(0,a.h)(h,h,Math.min(T,1)),(0,a.g)(m,m,h),null!=g?(0,a.c)(h,g):(0,a.f)(h,m,p);const O=n.state.camera.computeScreenPixelSizeAt(p);(0,a.n)(h,h),(0,a.h)(h,h,Math.min(O,1)),(0,a.g)(p,p,h)}_computeIntersection({computation:t,interpolationInfo:e}){const{view:n}=this,{sceneIntersectionHelper:i,renderCoordsHelper:u}=n;if(null==i)return;const d=this._intersector.intersector,{computationResult:c,inputPoints:g}=t,{observer:m,target:p}=g,{start:h,end:T}=c,O=(0,_.zk)(h,T,Rt);d.options.store=Y.eC.MIN,i.intersectToolIntersectorRay(O,d);const z=d.results.min,D=c.intersection,Z=pt;let S=!0;if(null!=z&&z.getIntersectionPoint(D)){(0,a.c)(e.originalIntersection,D),(0,a.c)(e.originalObserver,h),(0,a.c)(e.originalTarget,T),u.fromRenderCoords(D,Z,n.spatialReference);const G=1-(0,a.o)(T,p)/(0,a.o)(h,p);S=(0,a.o)(m,D)>=G*(0,a.o)(m,p)}const K=new St.Z(Z,n.spatialReference);{const{result:G,target:k}=t;null!=G?(G.target=k,G.intersectedGraphic=S?null:(0,st.tB)(z,n),G.intersectedLocation=S?null:K,G.visible=S):t.result=new y({target:k,elevationAlignedTargetLocation:t.elevationAlignedTargetLocation,intersectedGraphic:S?null:(0,st.tB)(z,n),intersectedLocation:S?null:K,visible:S})}c.isValid=g.isValid=!0,c.isTargetVisible=S}_interpolateIntersection({computation:t,interpolationInfo:e}){const{computationResult:n,inputPoints:i}=t,{start:u,end:d,intersection:c}=n,{originalIntersection:g,originalObserver:m,originalTarget:p}=e;if((0,a.c)(c,g),i.isValid){const h=pt,T=(0,a.o)(m,g)/(0,a.o)(m,p);(0,a.z)(h,u,m),(0,a.h)(h,h,1-T),(0,a.g)(c,c,h),(0,a.z)(h,d,p),(0,a.h)(h,h,T),(0,a.g)(c,c,h),n.isValid=!0}else t.result=null,n.isValid=!1,n.isTargetVisible=!1}_canCompute(t){const n=this.view.frustum;if(null==this.analysisViewData.elevationAlignedObserver||null==t.elevationAlignedTargetLocation||null==n)return!1;const{observerAdjusted:i,targetAdjusted:u}=t.inputPoints,d=n.intersectsPoint(i),c=n.intersectsPoint(u);return d&&c}_onObserverPositionChange(t,e,n,i,u){if(this._externalObserverUpdate=u,null==t)return this.analysisViewData.elevationAlignedObserver=null,void(this._observerFeatureId=null);if(null==e)return(0,wt.e)(this.analysis,t.spatialReference,$.Z.getLogger(this)),void(this.analysisViewData.elevationAlignedObserver=null);const d=this._getEffectiveElevationInfo(e,n),{absoluteZ:c,elevation:g}=(0,P.tq)(e.x,e.y,e.z,this.view.spatialReference,this.view,d),m=e.clone();m.z=c,this._effectiveObserverElevationMode=d.mode,this.analysisViewData.elevationAlignedObserver=m;const p=(0,v.Ue)();this.view.renderCoordsHelper.toRenderCoords(m,p),this._elevationAlignedObserverPositionRenderSpace=p,this._observerGroundOffsetRenderSpace=c-g,this._observerFeatureId=(0,ut.pD)(i),this.priority=rt.T8.LINE_OF_SIGHT_TOOL_INTERACTIVE}_onObserverRenderSpacePositionChangeForComputation(t,e,n,i,u){const{inputPoints:d}=t;switch((0,a.c)(d.observer,e),d.observerFeatureId=u,d.observerSurfaceNormal=null,i){case"on-the-ground":case"relative-to-ground":{const c=this._intersector.updateFromGroundIntersection(d.observer,n,d.observer);null==d.observerFeatureId&&(d.observerSurfaceNormal=c)}}this._adjustStartEndPositions(t),t.notifyInputPointsChanged(),this.priority=rt.T8.LINE_OF_SIGHT_TOOL_INTERACTIVE}_onTargetPositionChange(t,e,n,i,u,d=!0){const c=t.inputPoints;if(d&&(c.isValid=!1),null==n)return null!=e&&(0,wt.e)(this.analysis,e.spatialReference,$.Z.getLogger(this)),t.elevationAlignedTargetLocation=null,void t.notifyInputPointsChanged();const g=this._getEffectiveElevationInfo(n,i),{absoluteZ:m,elevation:p}=(0,P.tq)(n.x,n.y,n.z,this.view.spatialReference,this.view,g),h=n.clone();switch(h.z=m,t.elevationAlignedTargetLocation=h,this.view.renderCoordsHelper.toRenderCoords(t.elevationAlignedTargetLocation,c.target),c.targetFeatureId=(0,ut.pD)(u),c.targetSurfaceNormal=null,g.mode){case"on-the-ground":case"relative-to-ground":{const T=this._intersector.updateFromGroundIntersection(c.target,m-p,c.target);null==c.targetFeatureId&&(c.targetSurfaceNormal=T)}}this._adjustStartEndPositions(t),t.notifyInputPointsChanged(),this.priority=rt.T8.LINE_OF_SIGHT_TOOL_INTERACTIVE}_connectComputationToTarget(t){return(0,J.AL)([this._updatingHandles.add(()=>({computation:t,targetPosition:t.target.position,targetElevationInfo:t.target.elevationInfo,targetFeatureInfo:t.target.feature,projectedTargetPosition:(0,C.projectOrLoad)(t.target.position,this.view.spatialReference)}),({computation:e,targetPosition:n,targetElevationInfo:i,targetFeatureInfo:u,projectedTargetPosition:d})=>{null==d.pending?this._onTargetPositionChange(e,n,d.geometry,i,u):this._updatingHandles.addPromise(d.pending)},j.nn)])}_connectComputationToObserver(t){return this._updatingHandles.add(()=>({computation:t,observer:this.analysisViewData.elevationAlignedObserver}),({computation:e})=>{this._externalObserverUpdate&&(e.inputPoints.isValid=!1,e.notifyInputPointsChanged())},j.nn)}_connectComputationToRenderSpaceObserver(t){return this._updatingHandles.add(()=>({computation:t,observer:this._elevationAlignedObserverPositionRenderSpace,observerGroundOffset:this._observerGroundOffsetRenderSpace,observerElevationMode:this._effectiveObserverElevationMode,observerFeatureId:this._observerFeatureId}),({computation:e,observer:n,observerGroundOffset:i,observerElevationMode:u,observerFeatureId:d})=>{this._onObserverRenderSpacePositionChangeForComputation(e,n,i,u,d)},j.nn)}_connectComputationToCamera(t){return this._updatingHandles.add(()=>({camera:this.view.state.camera,isDirty:this._isCameraDirty}),({isDirty:e})=>{!this.updateOnCameraChange||t.inputPoints.isValid&&!e||t.notifyInputPointsChanged()})}_connectComputationToSlicePlane(t){return this._updatingHandles.add(()=>this.view.slicePlane,()=>{t.inputPoints.isValid=!1,t.notifyInputPointsChanged()})}_connectComputationToElevation(t){const e=(n,i)=>{const u=this.analysis.observer,d=t.target;let c=null,g=null,m=null,p=null,h=null,T=null;if(null!=u?.position){const O=(0,C.projectOrLoad)(u.position,this.view.spatialReference);if(null!=O.pending)return this._updatingHandles.addPromise(O.pending),void O.pending.finally(()=>e(n,i));c=O.geometry,g=u.elevationInfo,m=u.feature}if(null!=d.position){const O=(0,C.projectOrLoad)(d.position,this.view.spatialReference);if(null!=O.pending)return this._updatingHandles.addPromise(O.pending),void O.pending.finally(()=>e(n,i));p=O.geometry,h=d.elevationInfo,T=d.feature}null==c&&null==p||((0,E.d)(n,i,gt,this.view.spatialReference),null!=c&&(0,f.Qn)(gt,c)&&this._onObserverPositionChange(null!=u?u.position:null,c,g,m,!1),null!=p&&(0,f.Qn)(gt,p)&&this._onTargetPositionChange(t,d.position,p,h,T,!1),null!=c&&null!=p&&(0,f.I7)(gt,c,p)&&t.notifyInputPointsChanged())};return this.view.elevationProvider.on("elevation-change",({extent:n,spatialReference:i})=>e(n,i))}_connectComputationToTask(t){var e=this;let n=null;const i={computation:t,interpolationInfo:{originalIntersection:(0,v.Ue)(),originalObserver:(0,v.Ue)(),originalTarget:(0,v.Ue)()}};return(0,J.AL)([this._updatingHandles.add(()=>t.inputPoints,()=>{n=(0,w.IM)(n),n=(0,Ct.vr)(function(){var u=(0,ft.Z)(function*(d){yield(0,bt.R8)(e._frameTask.schedule(()=>e._computeResult(i),d))});return function(d){return u.apply(this,arguments)}}())},{initial:!0,equals:()=>!1}),(0,J.kB)(()=>n=(0,w.IM)(n))])}_connectComputation(t){const e=this._computationHandles;e.has(t)||e.add([this._connectComputationToTarget(t),this._connectComputationToObserver(t),this._connectComputationToRenderSpaceObserver(t),this._connectComputationToCamera(t),this._connectComputationToSlicePlane(t),this._connectComputationToElevation(t),this._connectComputationToTask(t)],t)}_disconnectComputation(t){this._computationHandles.remove(t)}_onComputationCollectionChange({added:t,removed:e}){for(const n of e)this._disconnectComputation(n);for(const n of t)this._connectComputation(n)}_onTargetCollectionChange({added:t,removed:e}){for(const n of e)this._removeTarget(n);for(const n of t)this._addTarget(n)}_onCursorTargetChange(t,e){null!=e&&this._removeTarget(e),null!=t&&this._addTarget(t)}_addTarget(t){this._computations.some(e=>e.target===t)||this._computations.add(new L({target:t}))}_removeTarget(t){const e=this._computations.findIndex(n=>n.target===t);this._computations.removeAt(e)}_connectObserver(){return(0,J.AL)([this._updatingHandles.add(()=>({observerPosition:null!=this.analysis.observer?this.analysis.observer.position:null,projectedObserverPosition:(0,C.projectOrLoad)(null!=this.analysis.observer?this.analysis.observer.position:null,this.view.spatialReference),observerElevationInfo:null!=this.analysis.observer?this.analysis.observer.elevationInfo:null,observerFeatureInfo:null!=this.analysis.observer?this.analysis.observer.feature:null}),({observerPosition:t,projectedObserverPosition:e,observerElevationInfo:n,observerFeatureInfo:i})=>{null==e.pending?this._onObserverPositionChange(t,e.geometry,n,i,!0):this._updatingHandles.addPromise(e.pending)},j.nn)])}_connectComputations(){return this._updatingHandles.addOnCollectionChange(()=>this._computations,t=>this._onComputationCollectionChange(t),{initial:!0,final:!0})}_connectTargets(){return(0,J.AL)([this._updatingHandles.addOnCollectionChange(()=>this.analysis.targets,t=>this._onTargetCollectionChange(t),{initial:!0,final:!0}),this._updatingHandles.add(()=>this.analysisViewData.cursorTarget,(t,e)=>{this._onCursorTargetChange(t,e)})])}get _isCameraDirty(){const t=this.analysisViewData.elevationAlignedObserver,{view:e}=this,{renderCoordsHelper:n}=e;if(null==t||null==n)return!1;const i=pt;n.toRenderCoords(t,i);const u=e.state.camera.computeScreenPixelSizeAt(i);return Math.abs((u-this._screenPixelSize)/this._screenPixelSize)>qt}_getEffectiveElevationInfo(t,e){return t.hasZ?e??{mode:"absolute-height",offset:0}:{mode:"on-the-ground",offset:0}}};(0,r._)([(0,l.Cb)({constructOnly:!0})],V.prototype,"analysis",void 0),(0,r._)([(0,l.Cb)({constructOnly:!0})],V.prototype,"analysisViewData",void 0),(0,r._)([(0,l.Cb)({constructOnly:!0})],V.prototype,"view",void 0),(0,r._)([(0,l.Cb)()],V.prototype,"updating",null),(0,r._)([(0,l.Cb)()],V.prototype,"priority",null),(0,r._)([(0,l.Cb)()],V.prototype,"updateOnCameraChange",void 0),(0,r._)([(0,l.Cb)()],V.prototype,"_computations",null),(0,r._)([(0,l.Cb)()],V.prototype,"_elevationAlignedObserverPositionRenderSpace",null),(0,r._)([(0,l.Cb)()],V.prototype,"_observerGroundOffsetRenderSpace",void 0),(0,r._)([(0,l.Cb)()],V.prototype,"_effectiveObserverElevationMode",void 0),(0,r._)([(0,l.Cb)()],V.prototype,"_observerFeatureId",void 0),(0,r._)([(0,l.Cb)()],V.prototype,"_screenPixelSize",null),(0,r._)([(0,l.Cb)({readOnly:!0})],V.prototype,"_updatingHandles",void 0),(0,r._)([(0,l.Cb)()],V.prototype,"_frameTask",void 0),(0,r._)([(0,l.Cb)()],V.prototype,"_isCameraDirty",null),V=(0,r._)([(0,R.j)("esri.views.3d.analysis.LineOfSight.LineOfSightController")],V);const qt=.1,pt=(0,v.Ue)(),Rt=(0,_.Ue)(),gt=(0,f.cS)(),te=.05;var I=s(91558),Vt=s(61642),At=s(57574),Dt=s(13777),Mt=s(82706),Ut=s(78260);const ne=new class ee{constructor(){this.glowWidth=8,this.innerWidth=.75}},oe=new class se{constructor(){this.size=.5}};function Ht(t){return(0,Ut.Ch)(t.accentColor,.75)}const ae=new class re{constructor(){this.size=.5,this.visibleColor=new I.Z([3,252,111,.75]),this.occludedColor=new I.Z([252,3,69,.75]),this.undefinedColor=new I.Z([127,127,127,.75])}},vt=new class le{constructor(){this.innerWidth=2,this.outerWidth=8,this.visibleInnerColor=new I.Z([3,252,111,1]),this.visibleOuterColor=new I.Z([3,252,111,.15]),this.occludedInnerColor=new I.Z([252,3,69,1]),this.occludedOuterColor=new I.Z([252,3,69,.1]),this.undefinedInnerColor=new I.Z([255,255,255,1]),this.undefinedOuterColor=new I.Z([127,127,127,.2])}};var jt=s(45403),xt=s(19142),zt=s(40345);function Zt(t,e){let n=null;const i=t.events.on("grab-changed",u=>{null!=n&&(n.remove(),n=null),"start"===u.action&&(n=t.disableDisplay()),e&&e(u)});return(0,J.kB)(()=>{n?.remove(),i.remove()})}var Ft=s(57521),at=s(33786);class ue extends jt.Z{constructor(e,n){const i=(0,xt.EA)(Ht(e.effectiveTheme)),u=(0,Ft.PI)(i,oe.size,32,32),d=new zt.r(u);super({view:e,renderObjects:[d],metadata:n,elevationInfo:{mode:"absolute-height",offset:0}}),Zt(this),this.themeHandle=(0,j.YP)(()=>({color:Ht(e.effectiveTheme)}),c=>{i.setParameters(c)})}destroy(){this.themeHandle.remove(),super.destroy()}}class de extends jt.Z{constructor(e,n){const{size:i,visibleColor:u,occludedColor:d,undefinedColor:c}=ae;super({view:e,renderObjects:[Ot(i,u,at.jg.Custom1),Ot(i,d,at.jg.Custom2),Ot(i,c,at.jg.Custom3)],metadata:n,elevationInfo:{mode:"absolute-height",offset:0}}),Zt(this)}}function Ot(t,e,n){return new zt.r((0,Ft.PI)((0,xt.EA)(I.Z.toUnitRGBA(e)),t,32,32),n)}var et,t,ce=s(23018),he=(s(45458),s(58997)),Bt=s(30260),Gt=s(41900),Tt=s(85112);(t=et||(et={})).Ready="ready",t.Creating="creating",t.Created="created";let x=class extends he.f{constructor(t){super(t),this.removeIncompleteOnCancel=!1,this.analysisViewData=null,this._latestPointerMovePointerType=null,this._laserlineVisualElement=null,this._grabbedManipulator=null,this._analysisHandles=new tt.Z,this._updatingHandles=new b.R,this._manipulatorHandles=new tt.Z,this._targetTrackerManipulator=null}initialize(){this._intersector=new ot({view:this.view}),this.addHandles((0,j.YP)(()=>this.state,t=>{t===et.Created&&this.finishToolCreation()},j.tX)),this._observerManipulator=this._createObserverManipulator(),this._createLaserLine(),this.addHandles([this._updatingHandles.add(()=>this.analysisViewData?.elevationAlignedObserver,t=>this._onObserverLocationChange(t),j.nn),this._updatingHandles.add(()=>function ie(t){const e=t.accentColor;return{glowColor:e,innerColor:(0,Ut.mj)(e),globalAlpha:.75*e.a}}(this.view.effectiveTheme),({glowColor:t,innerColor:e,globalAlpha:n})=>this._updateLaserLineStyle(t,e,n),j.nn),this._updatingHandles.add(()=>this._laserLineRendererDependencies(),t=>this._updateLaserLineRenderer(t)),this._connectComputations(),this._updatingHandles.addWhen(()=>!this._shouldRenderTracker,()=>this._clearCursorTracker(),j.nn)])}destroy(){this._updatingHandles=(0,w.SC)(this._updatingHandles),this._manipulatorHandles=(0,w.SC)(this._manipulatorHandles),this._analysisHandles=(0,w.SC)(this._analysisHandles),this._observerManipulator=null,this._clearCursorTracker(),this._removeLaserLine(),this._intersector=null,this._set("analysis",null)}get state(){return this.active?this.hasGrabbedManipulators?et.Created:et.Creating:null!=this.analysis.observer?.position?et.Created:et.Ready}get cursor(){return this.active&&this._showTracker?"crosshair":null}get updating(){return null!=this.analysisViewData&&this.analysisViewData.updating||this._updatingHandles.updating}get _showTracker(){return this.active&&"mouse"===this._latestPointerMovePointerType}get _shouldRenderTracker(){return this._showTracker&&null!=this.analysis.observer?.position&&!this.hasGrabbedManipulators}continue(){this.view.activeTool=this}stop(){this.view.activeTool=null}onEditableChange(){this.analysisViewData.editable=this.internallyEditable}onInputEvent(t){switch(t.type){case"immediate-double-click":this._doubleClickHandler(t);break;case"key-down":this._keyDownHandler(t);break;case"pointer-move":this._pointerMoveHandler(t)}}onInputEventAfter(t){"immediate-click"===t.type&&this._clickHandler(t)}onShow(){}onHide(){}onDeactivate(){this._clearCursorTracker()}_connectComputations(){return this._updatingHandles.addOnCollectionChange(()=>this.analysisViewData.computations,t=>this._onComputationsCollectionChange(t),{initial:!0,final:!0})}_onComputationsCollectionChange({added:t,removed:e}){for(const n of e)this._disconnectComputation(n);for(const n of t)this._connectComputation(n)}_connectComputation(t){if(this.destroyed)return void $.Z.getLogger(this).warn("Attempting to connect an analysis to a destroyed LineOfSight tool. Ignoring.");const e=this._analysisHandles;if(e.has(t))return;const n=this._createTargetManipulator(t.target);null==this._targetTrackerManipulator&&n.metadata.target===this.analysisViewData.cursorTarget&&(this._targetTrackerManipulator=n,this._targetTrackerManipulator.available=!1,this._targetTrackerManipulator.interactive=!1,this._updateLaserLineRenderer()),e.add([this._updatingHandles.add(()=>this._getLineOfSightManipulatorStateDependencies(t),()=>this._updateManipulatorState(n,t),j.nn),this._updatingHandles.add(()=>t.elevationAlignedTargetLocation,i=>this._onTargetLocationChange(i,n),j.nn)],t)}_disconnectComputation(t){if(this.destroyed)return void $.Z.getLogger(this).warn("Attempting to disconnect an analysis from a destroyed LineOfSight tool. Ignoring.");this._analysisHandles.remove(t);const e=this._getTargetManipulator(t.target);null!=e&&(this.manipulators.remove(e),this._manipulatorHandles.remove(e),null!=this._targetTrackerManipulator&&this._targetTrackerManipulator===e&&(this._targetTrackerManipulator=null))}_clearCursorTracker(){this.analysisViewData.cursorTarget=(0,w.SC)(this.analysisViewData.cursorTarget)}_createTargetManipulator(t){const n=new de(this.view,{target:t,type:"target"});return this._manipulatorHandles.add([this._createTargetManipulatorDragPipeline(n),n.events.on("grab-changed",i=>this._manipulatorGrabChanged(n,i)),n.events.on("immediate-click",i=>this._manipulatorClick(n,i))],n),this.manipulators.add(n),null!=t.position?n.elevationAlignedLocation=t.position:n.available=!1,n}_getTargetManipulator(t){let e=null;return this.manipulators.forEach(n=>{const i=n.manipulator;null==e&&"target"===i.metadata.type&&i.metadata.target===t&&(e=i)}),e}_createObserverManipulator(){const t=new ue(this.view,{type:"observer",intersection:null});return this._manipulatorHandles.add([this._createObserverManipulatorDragPipeline(t),t.events.on("grab-changed",e=>this._manipulatorGrabChanged(t,e)),t.events.on("immediate-click",e=>this._manipulatorClick(t,e))],t),this.manipulators.add(t),t}_screenToIntersection(){return t=>{const e=this._intersector.getScreenPointIntersection(t.screenEnd);return null==e?null:{...t,intersection:e}}}_createTargetManipulatorDragPipeline(t){return(0,Bt.Xd)(t,(e,n,i)=>{n.next(this._screenToIntersection()).next(this._updateTargetDragStep(t)).next(()=>this._updateLaserLineRenderer()),i.next(this._cancelTargetDragStep(t.metadata.target)).next(()=>this._updateLaserLineRenderer())})}_createObserverManipulatorDragPipeline(t){return(0,Bt.Xd)(t,(e,n,i)=>{n.next(this._screenToIntersection()).next(this._updateObserverDragStep()).next(()=>this._updateLaserLineRenderer()),i.next(this._cancelObserverDragStep()).next(()=>this._updateLaserLineRenderer())})}_updateObserverDragStep(){return t=>(null!=t.intersection.mapPoint?(null==this.analysis.observer&&(this.analysis.observer=new Vt.Z),this._updateFromIntersection(this.analysis.observer,t.intersection)):this.analysis.observer=null,t)}_cancelObserverDragStep(){const t=null!=this.analysis.observer?.position?this.analysis.observer.clone():null;return e=>(this.analysis.observer=t,e)}_updateTargetDragStep(t){return e=>{this._updateFromIntersection(t.metadata.target,e.intersection);const n=e.intersection.mapPoint;return null!=n&&(t.elevationAlignedLocation=n),e}}_cancelTargetDragStep(t){const e=t.position?.clone();return n=>(t.position=e,n)}_manipulatorGrabChanged(t,e){switch(e.action){case"start":this._grabbedManipulator=t;break;case"end":this._grabbedManipulator===t&&(this._grabbedManipulator=null)}}_updateManipulatorState(t,e){const{isValid:n,isTargetVisible:i}=e.computationResult;t.state=n?i?at.jg.Custom1:at.jg.Custom2:at.jg.Custom3}_getLineOfSightManipulatorStateDependencies(t){const{isValid:e,isTargetVisible:n}=t.computationResult;return{isValid:e,isTargetVisible:n}}_laserLineRendererDependencies(){return{laserlineVisualElement:this._laserlineVisualElement,grabbedManipulator:this._grabbedManipulator,shouldRenderTracker:this._shouldRenderTracker,observerPosition:null!=this.analysis.observer?this.analysis.observer.position:null,visible:this.visible}}_updateLaserLineRenderer(t=this._laserLineRendererDependencies()){const{laserlineVisualElement:e,grabbedManipulator:n,shouldRenderTracker:i,observerPosition:u,visible:d}=t;if(null==e)return;const c=n??(i&&null!=u?this._targetTrackerManipulator:null);null!=c&&d?(e.visible=!0,e.heightManifoldTarget=c.renderLocation,e.lineVerticalPlaneSegment=c!==this._observerManipulator?(0,Dt.zk)(this._observerManipulator.renderLocation,c.renderLocation,pe):null):(e.visible=!1,e.heightManifoldTarget=null,e.lineVerticalPlaneSegment=null)}_createLaserLine(){this._removeLaserLine();const{glowWidth:t,innerWidth:e}=ne;this._laserlineVisualElement=new ce.W({view:this.view,attached:!0,visible:this.visible,style:{glowWidth:t,innerWidth:e},isDecoration:!0})}_removeLaserLine(){null!=this._laserlineVisualElement&&(this._laserlineVisualElement.destroy(),this._laserlineVisualElement=null)}_updateLaserLineStyle(t,e,n){const i=this._laserlineVisualElement;null!=i&&(i.style={...i.style,glowColor:I.Z.toUnitRGB(t),innerColor:I.Z.toUnitRGB(e),globalAlpha:n})}_onObserverLocationChange(t){null!=t?(this._observerManipulator.metadata.intersection=null,this._observerManipulator.available=!0,this._observerManipulator.elevationAlignedLocation=t):this._observerManipulator.available=!1}_onTargetLocationChange(t,e){null!=t?(e.elevationAlignedLocation=t,e!==this._targetTrackerManipulator&&(e.available=!0)):e.available=!1}_addPointFromClickEvent(t){const e=this._intersector.getScreenPointIntersection(t);if(null!=e?.mapPoint)if(null!=this.analysis.observer?.position){this._clearCursorTracker();const n=new At.Z;this._updateFromIntersection(n,e),this.analysis.targets.add(n)}else{const n=new Vt.Z;this._updateFromIntersection(n,e),this.analysis.observer=n}}_clickHandler(t){this.active&&t.button!==Tt.t.Right&&(this._addPointFromClickEvent((0,Gt.vT)(t)),t.stopPropagation())}_doubleClickHandler(t){this.active&&t.button!==Tt.t.Right&&(this.stop(),t.stopPropagation())}_keyDownHandler(t){this.active&&"Escape"===t.key&&(this.stop(),t.stopPropagation())}_pointerMoveHandler(t){if(this.hasGrabbedManipulators||(this._latestPointerMovePointerType=t.pointerType,this._updateLaserLineRenderer(),!this._showTracker||null==this.analysis.observer?.position))return;const e=(0,Gt.vT)(t),n=this._intersector.getScreenPointIntersection(e);null!=n?.mapPoint&&(null==this.analysisViewData.cursorTarget&&(this.analysisViewData.cursorTarget=new At.Z),this._updateFromIntersection(this.analysisViewData.cursorTarget,n),this._updateLaserLineRenderer())}_updateFromIntersection(t,e){if(null==e.mapPoint)return t.position=null,t.elevationInfo=null,void(t.feature=null);switch(e.type){case Y.q7.OBJECT:if(null!=e.graphic){const i=e.graphic,u=(0,P.RL)(i);"on-the-ground"===u.mode&&(u.mode="relative-to-ground",u.offset=0),t.elevationInfo=new Mt.Z(u),t.feature=i}else t.elevationInfo=null,t.feature=null;break;case Y.q7.TERRAIN:t.elevationInfo=new Mt.Z({mode:"on-the-ground"}),t.feature=null;break;default:t.elevationInfo=null,t.feature=null}const n=e.mapPoint.clone();n.z=(0,P.vQ)(this.view,n,{mode:"absolute-height",offset:0},t.elevationInfo),t.position=n}_manipulatorClick(t,e){if("observer"===t.metadata.type||t.grabbing||t.dragging||e.button!==Tt.t.Right||this.analysis.targets.length<=1)return;const{target:n}=t.metadata;this.analysis.targets.remove(n),e.stopPropagation()}get testInfo(){return{laserLineVisualElement:this._laserlineVisualElement,getTargetManipulator:t=>this._getTargetManipulator(t)}}};(0,r._)([(0,l.Cb)({constructOnly:!0})],x.prototype,"view",void 0),(0,r._)([(0,l.Cb)({constructOnly:!0})],x.prototype,"analysis",void 0),(0,r._)([(0,l.Cb)({readOnly:!0})],x.prototype,"state",null),(0,r._)([(0,l.Cb)({readOnly:!0})],x.prototype,"cursor",null),(0,r._)([(0,l.Cb)()],x.prototype,"removeIncompleteOnCancel",void 0),(0,r._)([(0,l.Cb)({readOnly:!0})],x.prototype,"updating",null),(0,r._)([(0,l.Cb)({constructOnly:!0})],x.prototype,"analysisViewData",void 0),(0,r._)([(0,l.Cb)({readOnly:!0})],x.prototype,"_showTracker",null),(0,r._)([(0,l.Cb)()],x.prototype,"_latestPointerMovePointerType",void 0),(0,r._)([(0,l.Cb)()],x.prototype,"_shouldRenderTracker",null),(0,r._)([(0,l.Cb)()],x.prototype,"_laserlineVisualElement",void 0),(0,r._)([(0,l.Cb)()],x.prototype,"_grabbedManipulator",void 0),x=(0,r._)([(0,R.j)("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightTool")],x);const pe=(0,Dt.Ue)();var ge=s(74741);class ve{constructor(e,n,i,u){this.visibleLineVisualElement=e,this.occludedLineVisualElement=n,this.undefinedLineVisualElement=i,this.targetVisualElement=u}destroy(){this.visibleLineVisualElement.destroy(),this.occludedLineVisualElement.destroy(),this.undefinedLineVisualElement.destroy(),this.targetVisualElement.destroy()}}var It=s(87469),Nt=s(30693),Pt=s(40723);let W=class extends H.Z{constructor(t){super(t),this._lineOfSightVisualElements=new Array,this._computationHandles=new tt.Z,this._updatingHandles=new b.R}initialize(){this.addHandles(this._connectComputations()),this._createObserverVisualization()}destroy(){this._updatingHandles=(0,w.SC)(this._updatingHandles),this._computationHandles=(0,w.SC)(this._computationHandles),this._observerVisualElement=(0,w.SC)(this._observerVisualElement)}get visible(){return this.analysisViewData.visible}get updating(){return this._updatingHandles.updating}get interactiveAndEditable(){return this.analysisViewData.interactive&&this.analysisViewData.editable}get test(){return{disablePartialOcclusion:()=>{for(const t of this._lineOfSightVisualElements)t.visibleLineVisualElement.renderOccluded=Pt.yD.Occlude,t.occludedLineVisualElement.renderOccluded=Pt.yD.Occlude,t.undefinedLineVisualElement.renderOccluded=Pt.yD.Occlude},visualizations:this._lineOfSightVisualElements}}_createLineOfSightVisualization(){const t=vt,e=this.view,n=this.isDecoration,i={view:e,attached:!0,width:t.outerWidth,innerWidth:t.innerWidth,isDecoration:n},u=I.Z.toUnitRGBA(t.visibleOuterColor),d=I.Z.toUnitRGBA(t.visibleInnerColor),c=I.Z.toUnitRGBA(t.occludedOuterColor),g=I.Z.toUnitRGBA(t.occludedInnerColor),m=I.Z.toUnitRGBA(t.undefinedOuterColor),p=I.Z.toUnitRGBA(t.undefinedInnerColor),h=new It.r({...i,color:u,innerColor:d}),T=new It.r({...i,color:c,innerColor:g}),O=new It.r({...i,color:m,innerColor:p}),z=new Nt.L({view:e,attached:!0,...Wt,size:8,isDecoration:n}),D=new ve(h,T,O,z);return this._lineOfSightVisualElements.push(D),D}_destroyLineOfSightVisualization(t){t.destroy(),this._lineOfSightVisualElements.splice(this._lineOfSightVisualElements.indexOf(t),1)}_updateLineOfSightVisualization(t,e,n){const i=vt,{computationResult:u,inputPoints:d}=t,{start:c,end:g,intersection:m,isValid:p,isTargetVisible:h}=u,{observer:T}=d,O=Ce;O[12]=T[0],O[13]=T[1],O[14]=T[2];const z=(0,a.f)(me,c,T),D=(0,a.f)(ye,g,T),Z=(0,a.f)(fe,m,T),{visibleLineVisualElement:S,occludedLineVisualElement:K,undefinedLineVisualElement:G,targetVisualElement:k}=e,dt=this.visible&&!(null==this.analysisViewData.elevationAlignedObserver||null==t.elevationAlignedTargetLocation);S.visible=dt,K.visible=dt,G.visible=dt,k.visible=dt,k.attached=!n.interactiveAndEditable,dt&&(S.geometry=null,K.geometry=null,G.geometry=null,k.geometry=t.elevationAlignedTargetLocation,p?h?(S.geometry=[[(0,v.nI)(z),(0,v.nI)(D)]],S.transform=O,S.color=I.Z.toUnitRGBA(i.visibleOuterColor),k.color=I.Z.toUnitRGBA(i.visibleInnerColor)):(S.geometry=[[(0,v.nI)(z),(0,v.nI)(Z)]],S.transform=O,S.color=I.Z.toUnitRGBA(i.occludedOuterColor),K.geometry=[[(0,v.nI)(Z),(0,v.nI)(D)]],K.transform=O,k.color=I.Z.toUnitRGBA(i.occludedInnerColor)):(G.geometry=[[(0,v.nI)(z),(0,v.nI)(D)]],G.transform=O,k.color=I.Z.toUnitRGBA(i.undefinedInnerColor)))}_getLineOfSightVisualizationDependencies(t){const{computationResult:e}=t,{occludedOuterColor:n,visibleOuterColor:i}=vt;return{computationResult:e,occludedOuterColor:n,visibleOuterColor:i,visible:this.visible,interactiveAndEditable:this.interactiveAndEditable}}_connectComputation(t){const e=this._computationHandles;if(e.has(t))return;const n=this._createLineOfSightVisualization();e.add([this._updatingHandles.add(()=>this._getLineOfSightVisualizationDependencies(t),i=>this._updateLineOfSightVisualization(t,n,i),{initial:!0,equals:()=>!1}),(0,J.kB)(()=>this._destroyLineOfSightVisualization(n))],t)}_disconnectComputation(t){this._computationHandles.remove(t)}_connectComputations(){return this._updatingHandles.addOnCollectionChange(()=>this.analysisViewData.computations,t=>this._onComputationsCollectionChange(t),{initial:!0,final:!0})}_onComputationsCollectionChange({added:t,removed:e}){for(const n of e)this._disconnectComputation(n);for(const n of t)this._connectComputation(n)}_createObserverVisualization(){const t=I.Z.toUnitRGBA(vt.visibleInnerColor),e=new Nt.L({view:this.view,color:t,...Wt,isDecoration:this.isDecoration});this._observerVisualElement=e,this.addHandles(this._updatingHandles.add(()=>({observer:this.analysisViewData.elevationAlignedObserver,interactiveAndEditable:this.interactiveAndEditable,visible:this.visible}),({observer:n,interactiveAndEditable:i,visible:u})=>{null!=n&&!i&&u?(e.geometry=n,this._observerVisualElement.attached=!0):e.attached=!1},j.nn))}};(0,r._)([(0,l.Cb)({constructOnly:!0})],W.prototype,"analysis",void 0),(0,r._)([(0,l.Cb)({constructOnly:!0})],W.prototype,"analysisViewData",void 0),(0,r._)([(0,l.Cb)({constructOnly:!0})],W.prototype,"view",void 0),(0,r._)([(0,l.Cb)({readOnly:!0})],W.prototype,"visible",null),(0,r._)([(0,l.Cb)({constructOnly:!0})],W.prototype,"isDecoration",void 0),(0,r._)([(0,l.Cb)()],W.prototype,"updating",null),(0,r._)([(0,l.Cb)()],W.prototype,"interactiveAndEditable",null),(0,r._)([(0,l.Cb)()],W.prototype,"test",null),W=(0,r._)([(0,R.j)("esri.views.3d.analysis.LineOfSight.LineOfSightVisualization")],W);const Wt={size:6,pixelSnappingEnabled:!1,primitive:"circle",elevationInfo:{mode:"absolute-height",offset:0},outlineSize:0},me=(0,v.Ue)(),ye=(0,v.Ue)(),fe=(0,v.Ue)(),Ce=(0,ge.Ue)();var Kt=s(95925);let U=class extends((0,yt.p)(N.Z.EventedMixin(H.Z))){constructor(t){super(t),this.type="line-of-sight-view-3d",this.analysis=null,this.tool=null,this.computations=new lt.Z,this.elevationAlignedObserver=null,this.observerEngineLocation=(0,v.Ue)(),this.cursorTarget=null,this.editable=!0}initialize(){const t=this.view,e=this.analysis;this._analysisController=new V({analysis:e,analysisViewData:this,view:t}),this._analysisVisualization=new W({analysis:e,analysisViewData:this,view:t,isDecoration:!this.parent}),this.addHandles([this._analysisController.on("result-changed",n=>{n.target!==this.cursorTarget&&this.emit("result-changed",n)}),(0,Kt.Lp)(this,x)])}destroy(){(0,Kt.Yq)(this),this._analysisController=(0,w.SC)(this._analysisController),this._analysisVisualization=(0,w.SC)(this._analysisVisualization)}get results(){return this.computations.map(t=>t.result)}get priority(){return this._analysisController.priority}set priority(t){this._analysisController.priority=t}get updating(){return null!=this._analysisController&&this._analysisController.updating||null!=this._analysisVisualization&&this._analysisVisualization.updating}getResultForTarget(t){return this.computations.find(e=>e.target===t)?.result}get testInfo(){return{visualization:this._analysisVisualization,controller:this._analysisController}}};(0,r._)([(0,l.Cb)({readOnly:!0})],U.prototype,"type",void 0),(0,r._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],U.prototype,"analysis",void 0),(0,r._)([(0,l.Cb)()],U.prototype,"tool",void 0),(0,r._)([(0,l.Cb)({readOnly:!0})],U.prototype,"results",null),(0,r._)([(0,l.Cb)()],U.prototype,"priority",null),(0,r._)([(0,l.Cb)()],U.prototype,"computations",void 0),(0,r._)([(0,l.Cb)()],U.prototype,"elevationAlignedObserver",void 0),(0,r._)([(0,l.Cb)()],U.prototype,"observerEngineLocation",void 0),(0,r._)([(0,l.Cb)()],U.prototype,"cursorTarget",void 0),(0,r._)([(0,l.Cb)()],U.prototype,"updating",null),(0,r._)([(0,l.Cb)()],U.prototype,"editable",void 0),(0,r._)([(0,l.Cb)()],U.prototype,"_analysisController",void 0),(0,r._)([(0,l.Cb)()],U.prototype,"_analysisVisualization",void 0),U=(0,r._)([(0,R.j)("esri.views.3d.analysis.LineOfSightAnalysisView3D")],U);const be=U}}]);