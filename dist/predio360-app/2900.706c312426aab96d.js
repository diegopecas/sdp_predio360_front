"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[2900],{90301:(D,x,e)=>{e.d(x,{JZ:()=>m,RL:()=>v,eY:()=>l});var p=e(15861),_=e(62208),f=e(10699),a=e(30217),g=e(49966),u=e(9545),R=e(57477),c=e(14403),o=e(57596),d=e(67969),i=e(55086);function m(h){return h&&"render"in h}function v(h){const t=document.createElement("canvas");return t.width=h.width,t.height=h.height,h.render(t.getContext("2d")),t}class l extends R.s{constructor(t=null,n){super(),this.blendFunction="standard",this._sourceWidth=0,this._sourceHeight=0,this._textureInvalidated=!1,this._texture=null,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.immutable=n.immutable??!1,this.requestRenderOnSourceChangedEnabled=n.requestRenderOnSourceChangedEnabled??!0,this.source=t,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null),(0,_.pC)(this._uploadStatus)&&(this._uploadStatus.controller.abort(),this._uploadStatus=null)}get isSourceScaled(){return this.width!==this._sourceWidth||this.height!==this._sourceHeight}get height(){return void 0!==this._height?this._height:this._sourceHeight}set height(t){this._height=t}get source(){return this._source}set source(t){null==t&&null==this._source||(this._source=t,this._source instanceof HTMLImageElement?(this._sourceHeight=this._source.naturalHeight,this._sourceWidth=this._source.naturalWidth):this._source&&(this._sourceHeight=this._source.height,this._sourceWidth=this._source.width),this.invalidateTexture())}get width(){return void 0!==this._width?this._width:this._sourceWidth}set width(t){this._width=t}beforeRender(t){super.beforeRender(t),this.updateTexture(t)}setSourceAsync(t,n){var s=this;return(0,p.Z)(function*(){(0,_.pC)(s._uploadStatus)&&s._uploadStatus.controller.abort();const P=new AbortController,E=(0,f.hh)();return(0,f.$F)(n,()=>P.abort()),(0,f.$F)(P,T=>E.reject(T)),s._uploadStatus={controller:P,resolver:E},s.source=t,E.promise})()}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRenderOnSourceChangedEnabled&&this.requestRender())}updateTransitionProperties(t,n){t>=64&&(this.fadeTransitionEnabled=!1,this.inFadeTransition=!1),super.updateTransitionProperties(t,n)}setTransform(t){const n=(0,a.g)(this.transforms.dvs),[s,P]=t.toScreenNoRotation([0,0],[this.x,this.y]),E=this.resolution/this.pixelRatio/t.resolution,T=E*this.width,y=E*this.height,B=Math.PI*this.rotation/180;(0,a.h)(n,n,(0,u.f)(s,P)),(0,a.h)(n,n,(0,u.f)(T/2,y/2)),(0,a.r)(n,n,-B),(0,a.h)(n,n,(0,u.f)(-T/2,-y/2)),(0,a.k)(n,n,(0,u.f)(T,y)),(0,a.m)(this.transforms.dvs,t.displayViewMat3,n)}setSamplingProfile(t){this._texture&&(t.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(t.samplingMode))}bind(t,n){this._texture&&t.bindTexture(this._texture,n)}updateTexture({context:t,painter:n}){var s=this;return(0,p.Z)(function*(){if(!s._textureInvalidated)return;if(s._textureInvalidated=!1,s._texture||(s._texture=s._createTexture(t)),!s.source)return void s._texture.setData(null);s._texture.resize(s._sourceWidth,s._sourceHeight);const P=function r(h){return m(h)?h instanceof c.Z?(0,_.yw)(h.getRenderedRasterPixels(),t=>t.renderedRasterPixels):v(h):h}(s.source);try{if((0,_.pC)(s._uploadStatus)){const{controller:E,resolver:T}=s._uploadStatus,y={signal:E.signal},{width:B,height:I}=s,M=s._texture;yield n.textureUploadManager.enqueueTextureUpdate({data:P,texture:M,width:B,height:I},y),T.resolve(),s._uploadStatus=null}else s._texture.setData(P);s.ready()}catch(E){(0,f.H9)(E)}})()}onDetach(){this.destroy()}_createTransforms(){return{dvs:(0,g.c)()}}_createTexture(t){const n=this.immutable&&t.type===o.zO.WEBGL2;return new i.x(t,{target:d.No.TEXTURE_2D,pixelFormat:d.VI.RGBA,internalFormat:n?d.lP.RGBA8:d.VI.RGBA,dataType:d.Br.UNSIGNED_BYTE,wrapMode:d.e8.CLAMP_TO_EDGE,isImmutable:n,width:this._sourceWidth,height:this._sourceHeight})}}},71379:(D,x,e)=>{e.d(x,{s:()=>o});var p=e(65401),_=e(49966),f=e(90301),a=e(43783);class g extends a.I{constructor(i,m,v,r,l,h,t=null){super(i,m,v,r,l,h),this.bitmap=new f.eY(t,{immutable:!1,requestRenderOnSourceChangedEnabled:!1}),this.bitmap.coordScale=[l,h],this.bitmap.once("isReady",()=>this.ready())}destroy(){super.destroy(),this.bitmap.destroy()}beforeRender(i){super.beforeRender(i),this.bitmap.beforeRender(i)}afterRender(i){super.afterRender(i),this.bitmap.afterRender(i)}set stencilRef(i){this.bitmap.stencilRef=i}get stencilRef(){return this.bitmap.stencilRef}_createTransforms(){return{dvs:(0,_.c)(),tileMat3:(0,_.c)()}}setTransform(i){super.setTransform(i),this.bitmap.transforms.dvs=this.transforms.dvs}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap&&(this.bitmap.stage=null)}}var u=e(91894),R=e(39406),c=e(26268);class o extends c.Z{get requiresDedicatedFBO(){return this.children.some(i=>"additive"===i.bitmap.blendFunction)}createTile(i){const m=this._tileInfoView.getTileBounds((0,p.Ue)(),i),v=this._tileInfoView.getTileResolution(i.level),[r,l]=this._tileInfoView.tileInfo.size;return new g(i,v,m[0],m[3],r,l)}prepareRenderPasses(i){const m=i.registerRenderPass({name:"bitmap (tile)",brushes:[u.U.bitmap],target:()=>this.children.map(v=>v.bitmap),drawPhase:R.jx.MAP});return[...super.prepareRenderPasses(i),m]}doRender(i){this.visible&&i.drawPhase===R.jx.MAP&&super.doRender(i)}}},14403:(D,x,e)=>{e.d(x,{Z:()=>_});var p=e(62208);class _{constructor(a,g,u){this.pixelBlock=a,this.extent=g,this.originalPixelBlock=u}get width(){return(0,p.pC)(this.pixelBlock)?this.pixelBlock.width:0}get height(){return(0,p.pC)(this.pixelBlock)?this.pixelBlock.height:0}render(a){const g=this.pixelBlock;if((0,p.Wi)(g))return;const u=this.filter({extent:this.extent,pixelBlock:this.originalPixelBlock??g});if((0,p.Wi)(u.pixelBlock))return;u.pixelBlock.maskIsAlpha&&(u.pixelBlock.premultiplyAlpha=!0);const R=u.pixelBlock.getAsRGBA(),c=a.createImageData(u.pixelBlock.width,u.pixelBlock.height);c.data.set(R),a.putImageData(c,0,0)}getRenderedRasterPixels(){const a=this.filter({extent:this.extent,pixelBlock:this.pixelBlock});return(0,p.Wi)(a.pixelBlock)?null:(a.pixelBlock.maskIsAlpha&&(a.pixelBlock.premultiplyAlpha=!0),{width:a.pixelBlock.width,height:a.pixelBlock.height,renderedRasterPixels:new Uint8Array(a.pixelBlock.getAsRGBA().buffer)})}}},26268:(D,x,e)=>{e.d(x,{Z:()=>R});var p=e(8314),_=e(39406),f=e(44589),a=e(8650),g=e(13382);const u=(c,o)=>c.key.level-o.key.level!=0?c.key.level-o.key.level:c.key.row-o.key.row!=0?c.key.row-o.key.row:c.key.col-o.key.col;class R extends f.Z{constructor(o){super(),this._tileInfoView=o}get requiresDedicatedFBO(){return!1}renderChildren(o){this.sortChildren(u),this.setStencilReference(o),super.renderChildren(o)}createRenderParams(o){const{state:d}=o,i=super.createRenderParams(o);return i.requiredLevel=this._tileInfoView.getClosestInfoForScale(d.scale).level,i.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(d.scale),i}prepareRenderPasses(o){const d=super.prepareRenderPasses(o);return d.push(o.registerRenderPass({name:"stencil",brushes:[g.Z],drawPhase:_.jx.DEBUG|_.jx.MAP|_.jx.HIGHLIGHT,target:()=>this.getStencilTarget()})),(0,p.Z)("esri-tiles-debug")&&d.push(o.registerRenderPass({name:"tileInfo",brushes:[a.Z],drawPhase:_.jx.DEBUG,target:()=>this.children})),d}getStencilTarget(){return this.children}setStencilReference(o){let d=1;for(const i of this.children)i.stencilRef=d++}}},32900:(D,x,e)=>{e.r(x),e.d(x,{default:()=>v});var p=e(17626),R=(e(63290),e(90912),e(85931),e(26584),e(8314),e(76898)),c=e(36859),o=e(71379),d=e(84225);class i{constructor(){this.gradient=null,this.height=512,this.intensities=null,this.width=512}render(l){(0,c.hy)(l,512,this.intensities,this.gradient,this.minDensity,this.maxDensity)}}let m=class extends d.Z{constructor(r){super(r),this._intensityInfo={minDensity:0,maxDensity:0},this.type="heatmap",this.featuresView={attributeView:{initialize:()=>{},requestUpdate:()=>{}},requestRender:()=>{}},this._container=new o.s(r.tileInfoView)}createTile(r){const l=this._container.createTile(r);return this.tileInfoView.getTileCoords(l.bitmap,r),l.bitmap.resolution=this.tileInfoView.getTileResolution(r),l}onConfigUpdate(){const r=this.layer.renderer;if("heatmap"===r.type){const{minDensity:l,maxDensity:h,colorStops:t}=r;this._intensityInfo.minDensity=l,this._intensityInfo.maxDensity=h,this._gradient=(0,c.uI)(t),this.tiles.forEach(n=>{const s=n.bitmap.source;s&&(s.minDensity=l,s.maxDensity=h,s.gradient=this._gradient,n.bitmap.invalidateTexture())})}}hitTest(){return Promise.resolve([])}install(r){r.addChild(this._container)}uninstall(r){this._container.removeAllChildren(),r.removeChild(this._container)}disposeTile(r){this._container.removeChild(r),r.destroy()}supportsRenderer(r){return r&&"heatmap"===r.type}onTileData(r){const l=this.tiles.get(r.tileKey);if(!l)return;const h=r.intensityInfo,{minDensity:t,maxDensity:n}=this._intensityInfo,s=l.bitmap.source||new i;s.intensities=h&&h.matrix||null,s.minDensity=t,s.maxDensity=n,s.gradient=this._gradient,l.bitmap.source=s,this._container.addChild(l),this._container.requestRender(),this.requestUpdate()}onTileError(r){console.error(r)}lockGPUUploads(){}unlockGPUUploads(){}fetchResource(r,l){return console.error(r),Promise.reject()}};m=(0,p._)([(0,R.j)("esri.views.2d.layers.features.tileRenderers.HeatmapTileRenderer")],m);const v=m}}]);