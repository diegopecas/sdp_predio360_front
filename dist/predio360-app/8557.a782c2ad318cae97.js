"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[8557],{36592:(it,Pe,x)=>{x.d(Pe,{Q:()=>Ne});var ee=x(85931),O=x(77029),Ze=x(14259);class Ne{constructor(E=9,v){this._compareMinX=$,this._compareMinY=ve,this._toBBox=I=>I,this._maxEntries=Math.max(4,E||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),v&&("function"==typeof v?this._toBBox=v:this._initFormat(v)),this.clear()}destroy(){this.clear(),ie.prune(),Ae.prune(),Te.prune(),Be.prune()}all(E){this._all(this._data,E)}search(E,v){let I=this._data;const S=this._toBBox;if(H(E,I))for(ie.clear();I;){for(let j=0,W=I.children.length;j<W;j++){const V=I.children[j],se=I.leaf?S(V):V;H(E,se)&&(I.leaf?v(V):P(E,se)?this._all(V,v):ie.push(V))}I=ie.pop()}}collides(E){let v=this._data;const I=this._toBBox;if(!H(E,v))return!1;for(ie.clear();v;){for(let S=0,j=v.children.length;S<j;S++){const W=v.children[S],V=v.leaf?I(W):W;if(H(E,V)){if(v.leaf||P(E,V))return!0;ie.push(W)}}v=ie.pop()}return!1}load(E){if(!E.length)return this;if(E.length<this._minEntries){for(let I=0,S=E.length;I<S;I++)this.insert(E[I]);return this}let v=this._build(E.slice(0,E.length),0,E.length-1,0);if(this._data.children.length)if(this._data.height===v.height)this._splitRoot(this._data,v);else{if(this._data.height<v.height){const I=this._data;this._data=v,v=I}this._insert(v,this._data.height-v.height-1,!0)}else this._data=v;return this}insert(E){return E&&this._insert(E,this._data.height-1),this}clear(){return this._data=new ze([]),this}remove(E){if(!E)return this;let v,I=this._data,S=null,j=0,W=!1;const V=this._toBBox(E);for(Te.clear(),Be.clear();I||Te.length>0;){if(I||(I=Te.pop(),S=Te.data[Te.length-1],j=Be.pop()??0,W=!0),I.leaf&&(v=(0,ee.cq)(I.children,E,I.children.length,I.indexHint),-1!==v))return I.children.splice(v,1),Te.push(I),this._condense(Te),this;W||I.leaf||!P(I,V)?S?(j++,I=S.children[j],W=!1):I=null:(Te.push(I),Be.push(j),j=0,S=I,I=I.children[0])}return this}toJSON(){return this._data}fromJSON(E){return this._data=E,this}_all(E,v){let I=E;for(Ae.clear();I;){if(!0===I.leaf)for(const S of I.children)v(S);else Ae.pushArray(I.children);I=Ae.pop()??null}}_build(E,v,I,S){const j=I-v+1;let W=this._maxEntries;if(j<=W){const pe=new ze(E.slice(v,I+1));return de(pe,this._toBBox),pe}S||(S=Math.ceil(Math.log(j)/Math.log(W)),W=Math.ceil(j/W**(S-1)));const V=new qe([]);V.height=S;const se=Math.ceil(j/W),Ee=se*Math.ceil(Math.sqrt(W));ue(E,v,I,Ee,this._compareMinX);for(let pe=v;pe<=I;pe+=Ee){const Ie=Math.min(pe+Ee-1,I);ue(E,pe,Ie,se,this._compareMinY);for(let Ge=pe;Ge<=Ie;Ge+=se){const ht=Math.min(Ge+se-1,Ie);V.children.push(this._build(E,Ge,ht,S-1))}}return de(V,this._toBBox),V}_chooseSubtree(E,v,I,S){for(;S.push(v),!0!==v.leaf&&S.length-1!==I;){let j,W=1/0,V=1/0;for(let se=0,Ee=v.children.length;se<Ee;se++){const pe=v.children[se],Ie=J(pe),Ge=oe(E,pe)-Ie;Ge<V?(V=Ge,W=Ie<W?Ie:W,j=pe):Ge===V&&Ie<W&&(W=Ie,j=pe)}v=j||v.children[0]}return v}_insert(E,v,I){const j=I?E:(0,this._toBBox)(E);Te.clear();const W=this._chooseSubtree(j,this._data,v,Te);for(W.children.push(E),we(W,j);v>=0&&Te.data[v].children.length>this._maxEntries;)this._split(Te,v),v--;this._adjustParentBBoxes(j,Te,v)}_split(E,v){const I=E.data[v],S=I.children.length,j=this._minEntries;this._chooseSplitAxis(I,j,S);const W=this._chooseSplitIndex(I,j,S);if(!W)return void console.log("  Error: assertion failed at PooledRBush._split: no valid split index");const V=I.children.splice(W,I.children.length-W),se=I.leaf?new ze(V):new qe(V);se.height=I.height,de(I,this._toBBox),de(se,this._toBBox),v?E.data[v-1].children.push(se):this._splitRoot(I,se)}_splitRoot(E,v){this._data=new qe([E,v]),this._data.height=E.height+1,de(this._data,this._toBBox)}_chooseSplitIndex(E,v,I){let S,j,W;S=j=1/0;for(let V=v;V<=I-v;V++){const se=Me(E,0,V,this._toBBox),Ee=Me(E,V,I,this._toBBox),pe=Fe(se,Ee),Ie=J(se)+J(Ee);pe<S?(S=pe,W=V,j=Ie<j?Ie:j):pe===S&&Ie<j&&(j=Ie,W=V)}return W}_chooseSplitAxis(E,v,I){const S=E.leaf?this._compareMinX:$,j=E.leaf?this._compareMinY:ve;this._allDistMargin(E,v,I,S)<this._allDistMargin(E,v,I,j)&&E.children.sort(S)}_allDistMargin(E,v,I,S){E.children.sort(S);const j=this._toBBox,W=Me(E,0,v,j),V=Me(E,I-v,I,j);let se=X(W)+X(V);for(let Ee=v;Ee<I-v;Ee++){const pe=E.children[Ee];we(W,E.leaf?j(pe):pe),se+=X(W)}for(let Ee=I-v-1;Ee>=v;Ee--){const pe=E.children[Ee];we(V,E.leaf?j(pe):pe),se+=X(V)}return se}_adjustParentBBoxes(E,v,I){for(let S=I;S>=0;S--)we(v.data[S],E)}_condense(E){for(let v=E.length-1;v>=0;v--){const I=E.data[v];if(0===I.children.length)if(v>0){const S=E.data[v-1],j=S.children;j.splice((0,ee.cq)(j,I,j.length,S.indexHint),1)}else this.clear();else de(I,this._toBBox)}}_initFormat(E){const v=["return a"," - b",";"];this._compareMinX=new Function("a","b",v.join(E[0])),this._compareMinY=new Function("a","b",v.join(E[1])),this._toBBox=new Function("a","return {minX: a"+E[0]+", minY: a"+E[1]+", maxX: a"+E[2]+", maxY: a"+E[3]+"};")}}function de(Z,E){Me(Z,0,Z.children.length,E,Z)}function Me(Z,E,v,I,S){S||(S=new ze([])),S.minX=1/0,S.minY=1/0,S.maxX=-1/0,S.maxY=-1/0;for(let j,W=E;W<v;W++)j=Z.children[W],we(S,Z.leaf?I(j):j);return S}function we(Z,E){Z.minX=Math.min(Z.minX,E.minX),Z.minY=Math.min(Z.minY,E.minY),Z.maxX=Math.max(Z.maxX,E.maxX),Z.maxY=Math.max(Z.maxY,E.maxY)}function $(Z,E){return Z.minX-E.minX}function ve(Z,E){return Z.minY-E.minY}function J(Z){return(Z.maxX-Z.minX)*(Z.maxY-Z.minY)}function X(Z){return Z.maxX-Z.minX+(Z.maxY-Z.minY)}function oe(Z,E){return(Math.max(E.maxX,Z.maxX)-Math.min(E.minX,Z.minX))*(Math.max(E.maxY,Z.maxY)-Math.min(E.minY,Z.minY))}function Fe(Z,E){const v=Math.max(Z.minX,E.minX),I=Math.max(Z.minY,E.minY),S=Math.min(Z.maxX,E.maxX),j=Math.min(Z.maxY,E.maxY);return Math.max(0,S-v)*Math.max(0,j-I)}function P(Z,E){return Z.minX<=E.minX&&Z.minY<=E.minY&&E.maxX<=Z.maxX&&E.maxY<=Z.maxY}function H(Z,E){return E.minX<=Z.maxX&&E.minY<=Z.maxY&&E.maxX>=Z.minX&&E.maxY>=Z.minY}function ue(Z,E,v,I,S){const j=[E,v];for(;j.length;){const W=j.pop(),V=j.pop();if(W-V<=I)continue;const se=V+Math.ceil((W-V)/I/2)*I;(0,Ze.q)(Z,se,V,W,S),j.push(V,se,se,W)}}const ie=new O.Z,Ae=new O.Z,Te=new O.Z,Be=new O.Z({deallocator:void 0});class He{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class Ve extends He{constructor(){super(...arguments),this.height=1,this.indexHint=new ee.SO}}class ze extends Ve{constructor(E){super(),this.children=E,this.leaf=!0}}class qe extends Ve{constructor(E){super(),this.children=E,this.leaf=!1}}},98557:(it,Pe,x)=>{x.r(Pe),x.d(Pe,{default:()=>Gn});var ee=x(15861),O=x(17626),Ne=(x(29132),x(46160)),de=x(26584),Me=x(63290),we=x(10699),$=x(77712),X=(x(8314),x(4619),x(76898)),oe=x(83274),Fe=x(44917),P=x(82054),H=x(88071),ue=x(83761),ie=x(88159),Ae=x(95737),Te=x(37118),Be=x(55915),He=x(37053),Ve=x(66385),ze=x(91179);class E{constructor(){this._featureLookup=new Map}static getInstance(){return E.instance||(E.instance=new E),E.instance}static resetInstance(){E.instance&&(E.instance=null)}deleteFromStore(u){u.forEach(T=>{this._featureLookup.delete(T)})}readFromStoreByList(u){const T=[];return u.forEach(g=>{const C=this.readFromStoreById(g);C&&T.push(C)}),T}readFromStoreById(u){return this._featureLookup.get(u)??null}writeToStore(u,T,g){const C=[];return u.forEach(M=>{if(!M?.id)return;M.properties||(M.properties=[]);let L,b=null;if(g&&M.properties[g]&&(b=(0,P.GH)(M.properties[g])),"originId"in M&&"destinationId"in M&&(M.properties.ESRI__ORIGIN_ID=M.originId,M.properties.ESRI__DESTINATION_ID=M.destinationId),M.properties[T]=M.id,M.id&&this._featureLookup.has(M.id)&&this._featureLookup.get(M.id).attributes){const D=this._featureLookup.get(M.id),_=JSON.parse(JSON.stringify(Object.assign(D.attributes,M.properties)));g&&M.properties[g]&&(_[g]=(0,ze.im)(M.properties[g])),L=new Ve.u_(b?JSON.parse(JSON.stringify(b)):D?.geometry?JSON.parse(JSON.stringify(D.geometry)):null,_,null,M.properties[T])}else L=new Ve.u_(b?JSON.parse(JSON.stringify(b)):null,M.properties,null,M.properties[T]);this._featureLookup.set(M.id,L),C.push(L)}),C}}x(84792);var rt,h,Zt,jt,Yt,Ht,$t,zt,I=x(77689),S=x(39537);function cn(h){if(!h.spatialReference.isWGS84)throw new de.Z("knowledge-graph:layer-support-utils","The extentToInBoundsRings function only supports WGS84 spatial references.");let u;return u=h.xmax>180&&h.xmin<180?[[[h.xmin,h.ymin],[h.xmin,h.ymax],[180,h.ymax],[180,h.ymin],[h.xmin,h.ymin]],[[-180,h.ymin],[-180,h.ymax],[h.xmax-360,h.ymax],[h.xmax-360,h.ymin],[-180,h.ymin]]]:h.xmax>180&&h.xmin>180?[[[h.xmin-360,h.ymin],[h.xmin-360,h.ymax],[h.xmax-360,h.ymax],[h.xmax-360,h.ymin],[h.xmin-360,h.ymin]]]:h.xmax>-180&&h.xmin<-180?[[[h.xmin+360,h.ymin],[h.xmin+360,h.ymax],[180,h.ymax],[180,h.ymin],[h.xmin+360,h.ymin]],[[-180,h.ymin],[-180,h.ymax],[h.xmax,h.ymax],[h.xmax,h.ymin],[-180,h.ymin]]]:h.xmax<-180&&h.xmin<-180?[[[h.xmin+360,h.ymin],[h.xmin+360,h.ymax],[h.xmax+360,h.ymax],[h.xmax+360,h.ymin],[h.xmin+360,h.ymin]]]:[[[h.xmin,h.ymin],[h.xmin,h.ymax],[h.xmax,h.ymax],[h.xmax,h.ymin],[h.xmin,h.ymin]]],u}function pt(){return pt=(0,ee.Z)(function*(h,u){const T=[],g=new Map,C=[];if(u.dataModel?.relationshipTypes)for(const M of u.dataModel.relationshipTypes)M.name&&g.set(M.name,[]);for(const M of h)g.has(M.typeName)&&g.get(M.typeName)?.push(M.id);for(const[M,L]of g){if(L.length<1)continue;const b=new S.Z({openCypherQuery:`MATCH (n)-[r:${M}]->(m) WHERE id(r) in $ids RETURN id(n), labels(n)[0], id(m), labels(m)[0]`,bindParameters:{ids:L}});C.push((0,I.executeQueryStreaming)(u,b).then(function(){var D=(0,ee.Z)(function*(_){const N=_.resultRowsStream.getReader();for(;;){const{done:F,value:U}=yield N.read();if(F)break;for(const R of U)T.push({id:R[0],typeName:R[1]}),T.push({id:R[2],typeName:R[3]})}});return function(_){return D.apply(this,arguments)}}()))}return yield Promise.all(C),T}),pt.apply(this,arguments)}x(65234),(h=rt||(rt={})).ELEMENTUID="ELEMENTUID",h.TYPENAME="TYPENAME",function(h){h[h.ELEMENTUID=0]="ELEMENTUID",h[h.TYPENAME=1]="TYPENAME"}(Zt||(Zt={})),function(h){h[h.ELEMENTUID=0]="ELEMENTUID",h[h.TYPENAME=1]="TYPENAME",h[h.FROMUID=2]="FROMUID",h[h.TOUID=3]="TOUID"}(jt||(jt={})),x(95450),x(40900),function(h){h[h.featureResult=0]="featureResult",h[h.countResult=1]="countResult",h[h.idsResult=2]="idsResult"}(Yt||(Yt={})),function(h){h[h.upperLeft=0]="upperLeft",h[h.lowerLeft=1]="lowerLeft"}(Ht||(Ht={})),function(h){h[h.sqlTypeBigInt=0]="sqlTypeBigInt",h[h.sqlTypeBinary=1]="sqlTypeBinary",h[h.sqlTypeBit=2]="sqlTypeBit",h[h.sqlTypeChar=3]="sqlTypeChar",h[h.sqlTypeDate=4]="sqlTypeDate",h[h.sqlTypeDecimal=5]="sqlTypeDecimal",h[h.sqlTypeDouble=6]="sqlTypeDouble",h[h.sqlTypeFloat=7]="sqlTypeFloat",h[h.sqlTypeGeometry=8]="sqlTypeGeometry",h[h.sqlTypeGUID=9]="sqlTypeGUID",h[h.sqlTypeInteger=10]="sqlTypeInteger",h[h.sqlTypeLongNVarchar=11]="sqlTypeLongNVarchar",h[h.sqlTypeLongVarbinary=12]="sqlTypeLongVarbinary",h[h.sqlTypeLongVarchar=13]="sqlTypeLongVarchar",h[h.sqlTypeNChar=14]="sqlTypeNChar",h[h.sqlTypeNVarChar=15]="sqlTypeNVarChar",h[h.sqlTypeOther=16]="sqlTypeOther",h[h.sqlTypeReal=17]="sqlTypeReal",h[h.sqlTypeSmallInt=18]="sqlTypeSmallInt",h[h.sqlTypeSqlXml=19]="sqlTypeSqlXml",h[h.sqlTypeTime=20]="sqlTypeTime",h[h.sqlTypeTimestamp=21]="sqlTypeTimestamp",h[h.sqlTypeTimestamp2=22]="sqlTypeTimestamp2",h[h.sqlTypeTinyInt=23]="sqlTypeTinyInt",h[h.sqlTypeVarbinary=24]="sqlTypeVarbinary",h[h.sqlTypeVarchar=25]="sqlTypeVarchar"}($t||($t={})),function(h){h[h.OID_ARRAY=0]="OID_ARRAY",h[h.GLOBALID_ARRAY=1]="GLOBALID_ARRAY",h[h.STRING_ARRAY=2]="STRING_ARRAY",h[h.IDENTIFIER_ARRAY=3]="IDENTIFIER_ARRAY"}(zt||(zt={}));var Qe=x(96854),et=x(2004);const he="ESRI__ID",st="ESRI__ORIGIN_ID",ot="ESRI__DESTINATION_ID",Ce="ESRI__LAYOUT_GEOMETRY",Et="ESRI__AGGREGATION_COUNT";let Se=class extends ue.Z{constructor(h){super(h),this._processingCacheUpdatesLookup=new Map,this.knowledgeGraph=null,this.inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},this.entityTypeNames=new Set,this.relationshipTypeNames=new Set,this.geographicLookup=new Map,this.sublayerCaches=new Map,this.nodeConnectionsLookup=new Map,this.relationshipConnectionsLookup=new Map,this.memberIdTypeLookup=new Map;const u=new Map;h.knowledgeGraph.dataModel.entityTypes?.forEach(T=>{T.name&&(u.set(T.name,"entity"),this._processingCacheUpdatesLookup.set(T.name,[]),h.inclusionModeDefinition&&!h.inclusionModeDefinition?.generateAllSublayers||this.entityTypeNames.add(T.name),T.properties?.forEach(g=>{g.geometryType&&"esriGeometryNull"!==g.geometryType&&this.geographicLookup.set(T.name,{name:g.name??"",geometryType:g.geometryType})}))}),h.knowledgeGraph.dataModel.relationshipTypes?.forEach(T=>{T.name&&(u.set(T.name,"relationship"),this._processingCacheUpdatesLookup.set(T.name,[]),h.inclusionModeDefinition&&!h.inclusionModeDefinition?.generateAllSublayers||this.relationshipTypeNames.add(T.name),T.properties?.forEach(g=>{g.geometryType&&"esriGeometryNull"!==g.geometryType&&this.geographicLookup.set(T.name,{name:g.name??"",geometryType:g.geometryType})}))}),h.inclusionModeDefinition?.namedTypeDefinitions.forEach((T,g)=>{if("entity"===u.get(g))this.entityTypeNames.add(g);else{if("relationship"!==u.get(g))return Me.Z.getLogger(this).warn(`A named type, ${g}, was in the inclusion list that wasn't in the data model and will be removed`),void h.inclusionModeDefinition?.namedTypeDefinitions.delete(g);this.relationshipTypeNames.add(g)}const C=new Map;T.members?.forEach(M=>{(0,ie.s1)(this.memberIdTypeLookup,M.id,()=>new Set).add(g);const L=this.getById(M.id);L&&C.set(M.id,L)}),this.sublayerCaches.set(g,C)})}addToLayer(h){h.forEach(({typeName:u,id:T})=>{if(!this.inclusionModeDefinition)throw new de.Z("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(this.inclusionModeDefinition.namedTypeDefinitions.has(u)){if(this.inclusionModeDefinition.namedTypeDefinitions.has(u)){const g=this.inclusionModeDefinition.namedTypeDefinitions.get(u);g.members||(g.members=new Map),g.members.set(T,{id:T}),(0,ie.s1)(this.memberIdTypeLookup,T,()=>new Set).add(u)}}else{const g=new Map;g.set(T,{id:T}),this.inclusionModeDefinition.namedTypeDefinitions.set(u,{useAllData:!1,members:g}),(0,ie.s1)(this.memberIdTypeLookup,T,()=>new Set).add(u)}})}getById(h){return E.getInstance().readFromStoreById(h)}getData(h,u,T){var g=this;return(0,ee.Z)(function*(){if(u.objectType.name&&g.inclusionModeDefinition?.namedTypeDefinitions&&g.inclusionModeDefinition.namedTypeDefinitions.size>0&&!g.inclusionModeDefinition.namedTypeDefinitions.has(u.objectType.name))return[];let C;if(C=h||new Qe.Z({where:"1=1",outFields:["*"]}),"link-chart"===u.parentCompositeLayer.type){const M=u.parentCompositeLayer,L=g._processingCacheUpdatesLookup.get(u.objectType.name??""),b=C.outFields,D=C.geometry;let _="",N="";D&&D.extent&&(_=(0,oe.fC)(D.extent.ymin,D.extent.xmin,12),N=(0,oe.fC)(D.extent.ymax,D.extent.xmax,12)),b&&1===b.length&&b[0]===he&&"1=1"===C.where||(yield Promise.all(L??[]));const F=g.sublayerCaches.has(u.objectType.name??"")?Array.from(g.sublayerCaches.get(u.objectType.name)?.values()):[],U=[];return F.forEach(R=>{if(R.geometry=g.relationshipTypeNames.has(u.objectType.name)?M.relationshipLinkChartDiagramLookup.get(R.attributes[u.objectIdField]):M.entityLinkChartDiagramLookup.get(R.attributes[u.objectIdField]),R.attributes[Ce]=R.geometry,_&&N){const ae=M.linkChartGeohashLookup.get(R.attributes[u.objectIdField]);ae?ae>=_&&ae<=N&&U.push(R):U.push(R)}else U.push(R)}),U}return g.retrieveDataFromService(C,u,T)})()}getConnectedRecordIds(h,u){var T=this;return(0,ee.Z)(function*(){const g=[];let C="";const M=[],L=new Map;if(h.forEach(b=>{if(T.memberIdTypeLookup.has(b))for(const D of T.memberIdTypeLookup.get(b)){if(!T.entityTypeNames.has(D))return;L.has(D)?L.get(D)?.push(b):L.set(D,[b])}}),u&&0!==u?.length){for(const b of u)C=C+b+"|";C=C.slice(0,-1)}return L.forEach((b,D)=>{let _;_=u&&0!==u?.length?`MATCH (n:${D})-[r:${C}]-(m) WHERE id(n) IN $ids RETURN id(r), type(r), id(m), labels(m)[0]`:`MATCH (n:${D})-[r]-(m) WHERE id(n) IN $ids RETURN id(r), type(r), id(m), labels(m)[0]`;const N=new Promise(F=>{(0,ee.Z)(function*(){const U=(yield(0,I.executeQueryStreaming)(T.knowledgeGraph,new S.Z({openCypherQuery:_,bindParameters:{ids:b}}))).resultRowsStream.getReader();try{for(;;){const{done:R,value:ae}=yield U.read();if(R)break;for(let w=0;w<ae.length;w++){const G=ae[w];g.push({id:G[0],typeName:G[1]}),g.push({id:G[2],typeName:G[3]})}}}catch(R){if("AbortError"!==R.name)throw R;Me.Z.getLogger(T).info("Request aborted as expected")}})().then(()=>{F()})});M.push(N)}),T.refreshCacheContent(),yield Promise.all(M),g})()}refreshCacheContent(h,u,T,g=!0){var C=this;return(0,ee.Z)(function*(){const M=E.getInstance(),L=[],b=new Map,D=new Map;C.knowledgeGraph.dataModel.entityTypes?.forEach(_=>{_.name&&D.set(_.name,_)}),C.knowledgeGraph.dataModel.relationshipTypes?.forEach(_=>{_.name&&D.set(_.name,_)}),h||C.inclusionModeDefinition?h?h.forEach(_=>{if(C.memberIdTypeLookup.has(_))for(const N of C.memberIdTypeLookup.get(_))b.has(N)?b.get(N)?.push(_):b.set(N,[_])}):C.inclusionModeDefinition?.namedTypeDefinitions?.forEach((_,N)=>{_.useAllData?b.set(N,null):_.members&&_.members.forEach(F=>{b.has(N)&&null!==b.get(N)?b.get(N)?.push(F.id):b.set(N,[F.id])})}):(C.knowledgeGraph.dataModel.entityTypes?.forEach(_=>{_.name&&b.set(_.name,null)}),C.knowledgeGraph.dataModel.entityTypes?.forEach(_=>{_.name&&b.set(_.name,null)}));for(const[_,N]of b){const F=new Promise(U=>{(function(){var ae=(0,ee.Z)(function*(){const w=new Set,G=[];let ne,q="",ce=!1;if(u||D.get(_)?.properties?.forEach(Q=>{Q.name&&w.add(Q.name)}),T&&C.geographicLookup.has(_)){const Q=C.geographicLookup.get(_)?.name;Q&&w.add(Q)}if(C.entityTypeNames.has(_))q=`MATCH (n:${_}) ${N?"WHERE id(n) IN $ids ":""}return ID(n)`,w.forEach(Q=>{q+=`, n.${Q}`,G.push(Q)});else{if(!C.relationshipTypeNames.has(_))throw new de.Z("knowledge-graph:layer-data-manager",`The graph type of ${_} could not be determined. Was this type set in the KG data model and inclusion definition?`);ce=!0,q=`MATCH ()-[n:${_}]->() ${N?"WHERE id(n) IN $ids ":""}return ID(n), id(startNode(n)), id(endNode(n))`,w.forEach(Q=>{q+=`, n.${Q}`,G.push(Q)})}ne=new S.Z(N?{openCypherQuery:q,bindParameters:{ids:N}}:{openCypherQuery:q});const Y=(yield(0,I.executeQueryStreaming)(C.knowledgeGraph,ne)).resultRowsStream.getReader();for(;;){const{done:Q,value:re}=yield Y.read();if(Q)break;const A=[];for(let ye=0;ye<re.length;ye++){const be=re[ye];let me=0,De=0;const k={properties:{}};for(k.id=be[me],me++,De++,ce&&(k.originId=be[me],me++,De++,k.destinationId=be[me],me++,De++,(0,ie.s1)(C.nodeConnectionsLookup,k.originId,()=>new Set).add(k.id),(0,ie.s1)(C.nodeConnectionsLookup,k.destinationId,()=>new Set).add(k.id),(0,ie.s1)(C.relationshipConnectionsLookup,k.id,()=>[k.originId,k.destinationId]));me<be.length;me++)k.properties[G[me-De]]=be[me];A.push(k)}const le=M.writeToStore(A,he,C.geographicLookup.get(_)?.name);C.sublayerCaches.has(_)||C.sublayerCaches.set(_,new Map),g&&!C.inclusionModeDefinition?.namedTypeDefinitions.has(_)&&C.inclusionModeDefinition?.namedTypeDefinitions.set(_,{useAllData:!1,members:new Map}),g&&!C.inclusionModeDefinition?.namedTypeDefinitions.get(_).members&&(C.inclusionModeDefinition.namedTypeDefinitions.get(_).members=new Map);const K=C.sublayerCaches.get(_);le.forEach(ye=>{K?.set(ye.attributes[he],ye),g&&!C.inclusionModeDefinition?.namedTypeDefinitions.get(_).members.has(ye.attributes[he])&&(C.inclusionModeDefinition?.namedTypeDefinitions.get(_).members.set(ye.attributes[he],{id:ye.attributes[he]}),(0,ie.s1)(C.memberIdTypeLookup,ye.attributes[he],()=>new Set).add(_))})}});return function(){return ae.apply(this,arguments)}})()().then(()=>{U(null)})});L.push(F),C._processingCacheUpdatesLookup.get(_)?.push(F)}yield Promise.all(L)})()}removeFromLayer(h){const u=new Set,T=new Set(h.map(g=>g.id));for(const g of h)u.add(g.typeName),1===this.memberIdTypeLookup.get(g.id)?.size?this.memberIdTypeLookup.delete(g.id):this.memberIdTypeLookup.get(g.id)?.delete(g.typeName),this.inclusionModeDefinition?.namedTypeDefinitions.forEach((C,M)=>{M===g.typeName&&C.members?.has(g.id)&&C.members.delete(g.id)});u.forEach(g=>{this.sublayerCaches.get(g)?.forEach((C,M)=>{T.has(M)&&this.sublayerCaches.get(g)?.delete(M)})})}retrieveDataFromService(h,u,T){var g=this;return(0,ee.Z)(function*(){const C=E.getInstance(),M=new Set,L=[];let b,D="",_=[];const N="relationship"===u.graphType,F=g.inclusionModeDefinition?.namedTypeDefinitions?.get(u.objectType.name)?.useAllData,U=u.parentCompositeLayer.sublayerIdsCache.get(u.objectType.name);let R=!F&&U?Array.from(U).sort():null;if(g.inclusionModeDefinition?.namedTypeDefinitions?.get(u.objectType.name)?.useAllData)g.inclusionModeDefinition?.namedTypeDefinitions?.get(u.objectType.name)?.useAllData&&null!=h.objectIds&&(R=h.objectIds);else if(null!=h.objectIds&&R&&R.length>0){const w=h.objectIds;h.objectIds=R.filter(G=>w.includes(G))}else if(null!=h.objectIds)R=h.objectIds;else{if(g.inclusionModeDefinition?.namedTypeDefinitions.has(u.objectType.name)&&(!g.inclusionModeDefinition.namedTypeDefinitions.get(u.objectType.name)?.members||g.inclusionModeDefinition.namedTypeDefinitions.get(u.objectType.name)?.members?.size<1))return h.objectIds=[],[];h.objectIds=R}if(null!=h.outFields){const w=h.outFields;w.includes("*")?u.fields.forEach(G=>{M.add(G.name)}):w.forEach(G=>{G!==he&&G!==u.geometryFieldName&&M.add(G)})}if(null!=h.geometry){const w=h.geometry;let G;const ne=u.parentCompositeLayer.dataManager.knowledgeGraph.serviceDefinition,q=ne?.spatialReference,ce=ne?.serviceCapabilities?.geometryCapabilities;let Y=ce?.geometryMaxBoundingRectangleSizeX,Q=ce?.geometryMaxBoundingRectangleSizeY;if(w?.extent?.spatialReference&&!w.spatialReference?.isWGS84?(yield(0,Be.initializeProjection)(w.extent.spatialReference,He.YU),G=(0,Be.project)(w.extent,He.YU)):G=w.extent,Y&&Q&&q){if(4326!==q.wkid){const re=new et.Z({spatialReference:q,xmax:Y,ymax:Q}),A=(0,Be.project)(re,He.YU);Y=A.xmax,Q=A.ymax}if(G.xmax-G.xmin>Y)throw new de.Z("knowledge-graph:layer-data-manager",`Extent x bounds should be within ${Y}\xb0 latitude, limit exceeded`);if(G.ymax-G.ymin>Q)throw new de.Z("knowledge-graph:layer-data-manager",`Extent y bounds should be within ${Q}\xb0 longitude, limit exceeded`)}if(null!=h.where&&"1=1"!==h.where){const re=yield(0,Ae.E)(h.where.toUpperCase(),u.fieldsIndex);u.fields.forEach(A=>{re.fieldNames.includes(A.name)&&M.add(A.name)})}D=N?`Match ()-[n:${u.objectType.name}]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.${u.geometryFieldName}) return ID(n), id(startNode(r)), id(endNode(r))`:`Match (n:${u.objectType.name}) WHERE esri.graph.ST_Intersects($param_filter_geom, n.${u.geometryFieldName}) return ID(n)`,u.geometryFieldName&&M.add(u.geometryFieldName),M.forEach(re=>{D+=`, n.${re}`,L.push(re)}),b=new S.Z({openCypherQuery:D,bindParameters:{param_filter_geom:new Te.Z({rings:cn(G)})}})}else{let w="";if(null!=h.where&&"1=1"!==h.where){const q=yield(0,Ae.E)(h.where,u.fieldsIndex);u.fields.forEach(A=>{q.fieldNames.includes(A.name)&&M.add(A.name)});const ce=new Set(["column-reference","string","number","binary-expression"]),Y=new Set(["=","<","<=","<>",">",">=","AND","OR","LIKE"]);let Q=!1;const re=A=>{if("column-reference"===A.type)return`n.${A.column}`;if("string"===A.type)return`'${A.value}'`;if("number"===A.type)return`${A.value}`;if("binary-expression"===A.type&&ce.has(A.left.type)&&ce.has(A.right.type)&&Y.has(A.operator))return`${re(A.left)} ${A.operator} ${re(A.right)}`;if("binary-expression"===A.type&&"LIKE"===A.operator){let le="";if("function"===A.left.type&&"column-reference"===A.left.args.value[0].type)le+=`lower(n.${A.left.args.value[0].column})`;else{if("column-reference"!==A.left.type)return Q=!0,"";le+=`lower(n.${A.left.column})`}if(le+=" CONTAINS (","string"!==A.right.type)return Q=!0,"";{let K=A.right.value;"%"===K.charAt(0)&&(K=K.slice(1)),"%"===K.charAt(K.length-1)&&(K=K.slice(0,-1)),le+=`'${K.toLowerCase()}')`}return le}return Q=!0,""};w=re(q.parseTree),Q&&(w="")}let G="";G=N?`Match ()-[n:${u.objectType.name}]->()`:`Match (n:${u.objectType.name})`;let ne=!1;R&&(ne=!0,G+=" WHERE ID(n) IN $ids"),w&&(G+=ne?" AND":" WHERE",G+=` ${w}`),G+=" return ID(n)",N&&(G+=", id(startNode(n)), id(endNode(n))"),h.returnGeometry&&u.geometryFieldName&&M.add(u.geometryFieldName),M.forEach(q=>{G+=`, n.${q}`,L.push(q)}),b=new S.Z(R?{openCypherQuery:G,bindParameters:{ids:R}}:{openCypherQuery:G})}const ae=(yield(0,I.executeQueryStreaming)(u.parentCompositeLayer.dataManager.knowledgeGraph,b,T)).resultRowsStream.getReader();for(;;){const{done:w,value:G}=yield ae.read();if(w)break;const ne=[];for(let q=0;q<G.length;q++){const ce=G[q];let Y=0,Q=0;const re={properties:{}};for(re.id=ce[Y],Y++,Q++,N&&(re.originId=ce[Y],Y++,Q++,re.destinationId=ce[Y],Y++,Q++);Y<ce.length;Y++)re.properties[L[Y-Q]]=ce[Y];ne.push(re)}_=_.concat(C.writeToStore(ne,he,u.parentCompositeLayer.dataManager.geographicLookup.get(u.objectType.name)?.name))}return _})()}};(0,O._)([(0,$.Cb)()],Se.prototype,"knowledgeGraph",void 0),(0,O._)([(0,$.Cb)()],Se.prototype,"inclusionModeDefinition",void 0),(0,O._)([(0,$.Cb)()],Se.prototype,"entityTypeNames",void 0),(0,O._)([(0,$.Cb)()],Se.prototype,"relationshipTypeNames",void 0),(0,O._)([(0,$.Cb)()],Se.prototype,"geographicLookup",void 0),(0,O._)([(0,$.Cb)()],Se.prototype,"sublayerCaches",void 0),(0,O._)([(0,$.Cb)()],Se.prototype,"nodeConnectionsLookup",void 0),(0,O._)([(0,$.Cb)()],Se.prototype,"relationshipConnectionsLookup",void 0),(0,O._)([(0,$.Cb)()],Se.prototype,"memberIdTypeLookup",void 0),Se=(0,O._)([(0,X.j)("esri.rest.knowledgeGraph.knowledgeGraphLayer.KnowledgeGraphLayerDataManager")],Se);var Cn=x(73281),bt=(x(4832),x(68387),x(96794),x(69747),x(40425),x(69357),x(40342),x(73640),x(33474)),Mn=x(32088),Ln=(x(97347),x(3579)),En=x(73771),lt=x(56554);const tn=(0,x(55911).v)(),_n=h=>{let u=class extends h{constructor(){super(...arguments),this.fields=[],this.fieldsIndex=null}};return(0,O._)([(0,$.Cb)(tn.fields)],u.prototype,"fields",void 0),(0,O._)([(0,$.Cb)(tn.fieldsIndex)],u.prototype,"fieldsIndex",void 0),u=(0,O._)([(0,X.j)("esri.layers.knowledgeGraphLayer.KnowledgeGraphSublayerBase")],u),u};var nn=x(552),xn=x(33491),In=x(30346),an=x(99555),Dn=x(13812),_t=x(36255),vn=x(90194),wn=x(17253),kn=x(49430),Nn=x(97856),xt=x(55214),We=x(71774);let ge=class extends((0,xn.M)(_n((0,nn.h)((0,an.M)((0,In.Q)(Fe.Z)))))){constructor(h){if(super(h),this.capabilities=(0,lt.MS)(!1,!1),this.definitionExpression="",this.displayField="",this.elevationInfo=null,this.geometryType=null,this.geometryFieldName=null,this.graphType=null,this.hasM=!1,this.hasZ=!1,this.labelsVisible=null,this.labelingInfo=null,this.objectIdField=he,this.objectType=null,this.parentCompositeLayer=null,this.popupEnabled=!0,this.popupTemplate=null,this.source={openPorts:()=>this.load().then(()=>{const u=new MessageChannel;return new Nn.Z(u.port1,{channel:u,client:{queryFeatures:(T,g={})=>{const C=Qe.Z.fromJSON(T);return this.queryFeaturesJSON(C,g)}}}),[u.port2]})},this.type="knowledge-graph-sublayer","link-chart"===h.parentCompositeLayer.type)this.geometryType="relationship"===h.graphType?"polyline":"point",this.geometryFieldName=Ce;else if(h.parentCompositeLayer.dataManager.geographicLookup.get(h.objectType.name)?.geometryType&&"esriGeometryNull"!==h.parentCompositeLayer.dataManager.geographicLookup.get(h.objectType.name)?.geometryType){const u=h.parentCompositeLayer.dataManager.geographicLookup.get(h.objectType.name);this.geometryFieldName=u?.name??null,this.geometryType=u?.geometryType?We.M.fromJSON(u.geometryType):null;const T=u?.name,g=T?h.objectType.properties?.[T]:null;g?(this.hasM=g.hasM??!1,this.hasZ=g.hasZ??!1):(this.hasM=!1,this.hasZ=!1)}else this.geometryType=null;h.objectType.properties?.forEach(u=>{let g=u.fieldType;"esriFieldTypeOID"===g&&(g="esriFieldTypeInteger"),this.fields.push(_t.Z.fromJSON({name:u.name,type:g,alias:u.alias,defaultValue:null,editable:u.editable,nullable:u.nullable}))}),this.fields.push(_t.Z.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1})),this.fields.push(_t.Z.fromJSON({name:Et,type:"esriFieldTypeInteger",alias:Et,editable:!1})),this._set("fields",[...this.fields]),h.parentCompositeLayer.dataManager.knowledgeGraph.dataModel?.spatialReference&&(this.spatialReference=h.parentCompositeLayer.dataManager.knowledgeGraph.dataModel.spatialReference),this.renderer=(0,bt.i)("link-chart"===h.parentCompositeLayer.type?"relationship"===h.graphType?(0,lt.bU)(We.M.toJSON("polyline")).renderer:(0,lt.bU)(We.M.toJSON("point")).renderer:(0,lt.bU)(We.M.toJSON(this.geometryType)).renderer)}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(h){(0,vn.YN)(h,this.fieldsIndex),this._set("renderer",h)}createPopupTemplate(h){return(0,kn.eZ)(this,h)}createQuery(){return new Qe.Z({where:"1=1",outFields:["*"]})}getField(h){for(let u=0;u<this.fields.length;u++)if(this.fields[u].name===h)return this.fields[u];return null}getFieldDomain(h,u){return null}queryFeatures(h,u){var T=this;return(0,ee.Z)(function*(){const{resolvedQuery:g,queryEngine:C}=yield T._setupQueryObjects(h),M=wn.Z.fromJSON(yield C.executeQuery(g.toJSON(),u?.signal));return M.features.forEach(L=>{L.sourceLayer=T}),M})()}queryFeaturesJSON(h,u){var T=this;return(0,ee.Z)(function*(){const{resolvedQuery:g,queryEngine:C}=yield T._setupQueryObjects(h);return yield C.executeQuery(g.toJSON(),u?.signal)})()}queryFeatureCount(h,u){var T=this;return(0,ee.Z)(function*(){const{resolvedQuery:g,queryEngine:C}=yield T._setupQueryObjects(h);return C.executeQueryForCount(g.toJSON(),u?.signal)})()}queryExtent(h={},u){var T=this;return(0,ee.Z)(function*(){const g={...h,returnGeometry:!0},{resolvedQuery:C,queryEngine:M}=yield T._setupQueryObjects(g),L=yield M.executeQueryForExtent(C.toJSON(),u?.signal);let b;return b=null!=L.extent?.xmin&&null!=L.extent?.xmax&&null!=L.extent?.ymin&&null!=L.extent?.ymax?new et.Z(L.extent):new et.Z,{count:L.count,extent:b}})()}queryObjectIds(h,u){var T=this;return(0,ee.Z)(function*(){const g=Qe.Z.from(h);let C;if("link-chart"===T.parentCompositeLayer.type&&T._cachedQueryEngine)C=T._cachedQueryEngine;else{const M=yield T.parentCompositeLayer.dataManager.getData(g,T,u);C=T.loadQueryEngine(M)}return C.executeQueryForIds(g.toJSON(),u?.signal)})()}loadQueryEngine(h){const u=new Ln.Z({geometryType:We.M.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),T=new En.q({fieldsIndex:this.fieldsIndex.toJSON(),geometryType:We.M.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:this.spatialReference.toJSON(),timeInfo:null,featureStore:u});return T.featureStore.addMany(h),T}refreshCachedQueryEngine(){var h=this;return(0,ee.Z)(function*(){const u=yield h.parentCompositeLayer.dataManager.getData(new Qe.Z({where:"1=1",outFields:[he]}),h);h._cachedQueryEngine=h.loadQueryEngine(u)})()}_setupQueryObjects(h,u){var T=this;return(0,ee.Z)(function*(){const g=Qe.Z.from(h),C=g.geometry;let M;if(C&&!C.spatialReference?.isWGS84&&(yield(0,Be.initializeProjection)(C.spatialReference,He.YU),g.geometry=(0,Be.project)(C instanceof Te.Z||C instanceof xt.Z?C:C.extent,He.YU)),"link-chart"===T.parentCompositeLayer.type&&T._cachedQueryEngine)M=T._cachedQueryEngine;else{const L=yield T.parentCompositeLayer.dataManager.getData(g,T,u);M=T.loadQueryEngine(L)}return{resolvedQuery:g,queryEngine:M}})()}};(0,O._)([(0,$.Cb)()],ge.prototype,"capabilities",void 0),(0,O._)([(0,$.Cb)({readOnly:!0})],ge.prototype,"defaultPopupTemplate",null),(0,O._)([(0,$.Cb)()],ge.prototype,"definitionExpression",void 0),(0,O._)([(0,$.Cb)()],ge.prototype,"displayField",void 0),(0,O._)([(0,$.Cb)()],ge.prototype,"elevationInfo",void 0),(0,O._)([(0,$.Cb)()],ge.prototype,"geometryType",void 0),(0,O._)([(0,$.Cb)()],ge.prototype,"geometryFieldName",void 0),(0,O._)([(0,$.Cb)()],ge.prototype,"graphType",void 0),(0,O._)([(0,$.Cb)()],ge.prototype,"hasM",void 0),(0,O._)([(0,$.Cb)()],ge.prototype,"hasZ",void 0),(0,O._)([(0,$.Cb)()],ge.prototype,"labelsVisible",void 0),(0,O._)([(0,$.Cb)()],ge.prototype,"labelingInfo",void 0),(0,O._)([(0,$.Cb)()],ge.prototype,"objectIdField",void 0),(0,O._)([(0,$.Cb)()],ge.prototype,"objectType",void 0),(0,O._)([(0,$.Cb)()],ge.prototype,"parentCompositeLayer",void 0),(0,O._)([(0,$.Cb)(Dn.C_)],ge.prototype,"popupEnabled",void 0),(0,O._)([(0,$.Cb)({type:Cn.Z,json:{name:"popupInfo",write:!0}})],ge.prototype,"popupTemplate",void 0),(0,O._)([(0,$.Cb)({types:Mn.A,json:{write:{target:"layerDefinition.drawingInfo.renderer"}}})],ge.prototype,"renderer",null),(0,O._)([(0,$.Cb)()],ge.prototype,"source",void 0),(0,O._)([(0,$.Cb)({json:{read:!1}})],ge.prototype,"type",void 0),ge=(0,O._)([(0,X.j)("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],ge);const It=ge;var Rn=x(54346);let Dt,te=null;var Oe,dt;function Xe(h,u,T,g,C,M){const L=T.length,b=C.length,D=Float64Array.BYTES_PER_ELEMENT,_=Uint32Array.BYTES_PER_ELEMENT,N=Uint8Array.BYTES_PER_ELEMENT,R=te._malloc(15+L*(N+2*D)+b*(2*_));try{const ae=R+16-R%16,w=ae+L*D,G=w+L*D,ne=G+b*_,q=ne+b*_,ce=()=>[te.HEAPF64.subarray(ae>>3,(ae>>3)+L),te.HEAPF64.subarray(w>>3,(w>>3)+L),te.HEAPU32.subarray(G>>2,(G>>2)+b),te.HEAPU32.subarray(ne>>2,(ne>>2)+b),te.HEAPU8.subarray(q,q+L)],[Y,Q,re,A,le]=ce();Y.set(T),Q.set(g),re.set(C),A.set(M),le.set(u);let K=h(L,q,ae,w,b,G,ne),ye=null;if(K){const B=te.getLayoutLinksTypes(),Le=te.getLayoutLinksVerticesEndIndices(),ke=te.getLayoutLinksVertices(),_e=te.countLayoutLinksVertices();!b||B&&Le?_e&&!ke?K=!1:ye={types:new Uint8Array(te.HEAPU8.subarray(B,B+b)),vertexEndIndex:new Uint32Array(te.HEAPU32.subarray(Le>>2,(Le>>2)+b)),vertices:new Float64Array(te.HEAPF64.subarray(ke>>3,(ke>>3)+2*_e))}:K=!1}const[be,me,De,k,z]=ce();return T.set(be),g.set(me),C.set(De),M.set(k),u.set(z),{success:K,links:ye}}finally{te._free(R),te.cleanupLayout()}}(function(h){h[h.None=0]="None",h[h.IsMovable=1]="IsMovable",h[h.IsGeographic=2]="IsGeographic",h[h.IsRoot=4]="IsRoot"})(Oe||(Oe={})),function(h){h[h.Regular=0]="Regular",h[h.Orthogonal=1]="Orthogonal",h[h.Curved=2]="Curved",h[h.Recursive=3]="Recursive"}(dt||(dt={}));var vt,wt,kt,Nt,Rt,At,ln,dn;(function(h){h.getMinIdealEdgeLength=function u(){return te.getMinIdealEdgeLength()},h.apply=function T(g,C,M,L,b,D=2,_=1,N=-1){return Xe((F,U,R,ae,w,G,ne)=>te.applyForceDirectedLayout(F,U,R,ae,w,G,ne,D,_,N),g,C,M,L,b)}})(vt||(vt={})),function(h){h.apply=function u(T,g,C,M,L,b=2,D=1,_=-1){return Xe((N,F,U,R,ae,w,G)=>te.applyCommunityLayout(N,F,U,R,ae,w,G,b,D,_),T,g,C,M,L)}}(wt||(wt={})),function(h){h.apply=function u(T,g,C,M,L){return Xe(te.applySimpleLayout,T,g,C,M,L)}}(kt||(kt={})),function(h){h.apply=function u(T,g,C,M,L){return Xe(te.applyHierarchicalLayout,T,g,C,M,L)}}(Nt||(Nt={})),function(h){h.apply=function u(T,g,C,M,L){return Xe(te.applyRadialTreeLayout,T,g,C,M,L)}}(Rt||(Rt={})),function(h){h.apply=function u(T,g,C,M,L){return Xe(te.applySmartTreeLayout,T,g,C,M,L)}}(At||(At={})),function(h){h[h.Undirected=0]="Undirected",h[h.Directed=1]="Directed",h[h.Reversed=2]="Reversed"}(ln||(ln={})),function(h){h[h.ByCC_Raw=0]="ByCC_Raw",h[h.ByCC_NormalizeGlobally=1]="ByCC_NormalizeGlobally",h[h.ByCC_NormalizeByCC=2]="ByCC_NormalizeByCC"}(dn||(dn={}));var Fn=x(92816),Pn=x(61131),hn=x(72642);let xe=class extends((0,nn.h)((0,an.M)(Fe.Z))){constructor(h){if(super(h),this.dataPreloadedInLocalCache=!1,this.defaultLinkChartConfig=null,this._currentLinkChartConfig={layoutMode:"RADIAL_TREE"},this._graphTypeLookup=new Map,this.dataManager=null,this.knowledgeGraph=null,this.layers=new Ne.Z,this.entityLinkChartDiagramLookup=new Map,this.relationshipLinkChartDiagramLookup=new Map,this.linkChartExtent=new et.Z({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7}),this.linkChartGeohashLookup=new Map,this.memberEntityTypes=null,this.memberRelationshipTypes=null,this.sublayerIdsCache=new Map,this.tables=new Ne.Z,this.type="link-chart",this._originalInclusionList=h.inclusionModeDefinition,h.dataPreloadedInLocalCache&&!h.inclusionModeDefinition)throw new de.Z("knowledge-graph:linkchart-layer-constructor","If creating a link chart composite layer and configured that data is already loaded in the cache, you must specify an inclusion list so the Composite Layer knows what records belong to it")}normalizeCtorArgs(h){return{url:h.url,title:h.title,dataPreloadedInLocalCache:h.dataPreloadedInLocalCache,defaultLinkChartConfig:h.defaultLinkChartConfig}}_initializeLayerProperties(h){if(!this.title&&this.url){const M=this.url.split("/");this.title=M[M.length-2]}const u=new Set;let T=[],g=[];if(h.inclusionModeDefinition&&(!h.inclusionModeDefinition.namedTypeDefinitions||h.inclusionModeDefinition.namedTypeDefinitions.size<1))throw new de.Z("knowledge-graph:composite-layer-constructor","If an explicit inclusion definition is defined, at least one namedTypeDefinition must also be defined");h.knowledgeGraph.dataModel.entityTypes?.forEach(M=>{M.name&&this._graphTypeLookup.set(M.name,M)}),h.knowledgeGraph.dataModel.relationshipTypes?.forEach(M=>{M.name&&this._graphTypeLookup.set(M.name,M)}),h.inclusionModeDefinition?.generateAllSublayers?(T=h.knowledgeGraph.dataModel.entityTypes??[],g=h.knowledgeGraph.dataModel.relationshipTypes??[]):h.inclusionModeDefinition?.namedTypeDefinitions&&h.inclusionModeDefinition?.namedTypeDefinitions.size>0?h.inclusionModeDefinition?.namedTypeDefinitions.forEach((M,L)=>{if(!this._graphTypeLookup.get(L))return Me.Z.getLogger(this).warn(`A named type, ${L}, was in the inclusion list that wasn't in the data model and will be removed`),void h.inclusionModeDefinition?.namedTypeDefinitions.delete(L);this._graphTypeLookup.get(L)instanceof Pn.Z||"strictOrigin"in this._graphTypeLookup.get(L)?u.has(L)||(u.add(L),g.push(this._graphTypeLookup.get(L))):this._graphTypeLookup.get(L)instanceof Fn.Z||"properties"in this._graphTypeLookup.get(L)?u.has(L)||(u.add(L),T.push(this._graphTypeLookup.get(L))):(Me.Z.getLogger(this).warn(`A named type, ${L}, was in the inclusion list that wasn't properly modeled and will be removed`),h.inclusionModeDefinition?.namedTypeDefinitions.delete(L))}):(T=h.knowledgeGraph.dataModel.entityTypes??[],g=h.knowledgeGraph.dataModel.relationshipTypes??[]);const C=new Se({knowledgeGraph:h.knowledgeGraph,inclusionModeDefinition:h.inclusionModeDefinition});this.knowledgeGraph=h.knowledgeGraph,this.memberEntityTypes=T,this.memberRelationshipTypes=g,this.dataManager=C}load(h){var u=this;return this.addResolvingPromise(new Promise(T=>{(0,I.fetchKnowledgeGraph)(this.url).then(g=>{this._initializeLayerProperties({knowledgeGraph:g,inclusionModeDefinition:this._originalInclusionList}),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.size||(this.dataManager.inclusionModeDefinition={generateAllSublayers:!1,namedTypeDefinitions:new Map},this.dataManager.knowledgeGraph.dataModel.entityTypes?.forEach(C=>{C.name&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.set(C.name,{useAllData:!0})}),this.dataManager.knowledgeGraph.dataModel.relationshipTypes?.forEach(C=>{C.name&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.set(C.name,{useAllData:!0})})),this.dataPreloadedInLocalCache?(this.loadLayerAssumingLocalCache(),this.dataManager.inclusionModeDefinition&&(this.dataManager.inclusionModeDefinition.generateAllSublayers=!1),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach(C=>{C.useAllData=!1,C.members?.forEach(M=>{let L;L=M.linkChartLocation instanceof H.Z?M.linkChartLocation:M.linkChartLocation?(0,P.GH)(M.linkChartLocation):null,L&&2===L.coords.length&&0===L.lengths.length?(this.linkChartGeohashLookup.set(M.id,(0,oe.fC)(L.coords[1],L.coords[0],12)),this.entityLinkChartDiagramLookup.set(M.id,L)):(this.linkChartGeohashLookup.set(M.id,""),this.relationshipLinkChartDiagramLookup.set(M.id,L))}),this.addResolvingPromise(this._initializeDiagram().then((0,ee.Z)(function*(){u.layers.forEach(function(){var M=(0,ee.Z)(function*(L){yield L.refreshCachedQueryEngine()});return function(L){return M.apply(this,arguments)}}()),u.tables.forEach(function(){var M=(0,ee.Z)(function*(L){yield L.refreshCachedQueryEngine()});return function(L){return M.apply(this,arguments)}}())})))})):this.addResolvingPromise(this.dataManager.refreshCacheContent(void 0,!1,"GEOGRAPHIC"===this.defaultLinkChartConfig?.layoutMode,!0).then((0,ee.Z)(function*(){(0,we.k_)(h);const M=[],L=[];u.loadLayerAssumingLocalCache(),u.dataManager.inclusionModeDefinition&&(u.dataManager.inclusionModeDefinition.generateAllSublayers=!1,u.dataManager.inclusionModeDefinition.namedTypeDefinitions.forEach(b=>{b.useAllData=!1})),yield u._initializeDiagram(),u.layers.forEach(b=>{L.push(b.refreshCachedQueryEngine()),M.push(new Promise(D=>{b.on("layerview-create",()=>{D(null)})}))}),u.tables.forEach(b=>{L.push(b.refreshCachedQueryEngine())}),yield Promise.all(L)}))),T(null)})})),Promise.resolve(this)}addRecords(h,u){var T=this;return(0,ee.Z)(function*(){let g=[];u?.cascadeAddRelationshipEndNodes&&T.dataManager.knowledgeGraph.dataModel&&(g=yield function yn(h,u){return pt.apply(this,arguments)}(h,T.dataManager.knowledgeGraph));const C=h.concat(g).filter(M=>!T.sublayerIdsCache.get(M.typeName)?.has(M.id));yield T._handleNewRecords(C)})()}removeRecords(h,{cascadeRemoveRelationships:u=!0,recalculateLayout:T=!1}={cascadeRemoveRelationships:!0,recalculateLayout:!1}){var g=this;return(0,ee.Z)(function*(){let C=[];for(const L of h)!1===g.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.get(L.typeName)?.useAllData&&g.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.get(L.typeName)?.members?.has(L.id)&&C.push(L);if(u){const L=new Set,b=[];for(const D of C)if(g.dataManager.nodeConnectionsLookup.has(D.id))for(const _ of g.dataManager.nodeConnectionsLookup.get(D.id))L.add(_);for(const D of L)if(g.dataManager.memberIdTypeLookup.has(D))for(const _ of g.dataManager.memberIdTypeLookup.get(D))g.dataManager.relationshipTypeNames.has(_)&&b.push({id:D,typeName:_});C=C.concat(b)}g.dataManager.removeFromLayer(C);for(const L of C)g.sublayerIdsCache.get(L.typeName)?.delete(L.id),g.dataManager.relationshipTypeNames.has(L.typeName)?g.relationshipLinkChartDiagramLookup.delete(L.id):g.entityLinkChartDiagramLookup.delete(L.id);T&&(yield g.calculateLinkChartLayout(g._currentLinkChartConfig.layoutMode,{}));const M=[];return g.layers.forEach(L=>{M.push(L.refreshCachedQueryEngine())}),yield Promise.all(M),g._refreshNamedTypes(),C})()}expand(h,u){var T=this;return(0,ee.Z)(function*(){const g=yield T.dataManager.getConnectedRecordIds(h,u),C=g.filter(M=>!T.sublayerIdsCache.get(M.typeName)?.has(M.id));return yield T._handleNewRecords(g),{records:C}})()}loadLayerAssumingLocalCache(){this.memberRelationshipTypes.forEach(h=>{const u=new It({objectType:h,parentCompositeLayer:this,graphType:"relationship",title:h.name});u.geometryType?this.layers.push(u):this.tables.push(u),this.dataManager.sublayerCaches.has(h.name)||this.dataManager.sublayerCaches.set(h.name,new Map)}),this.memberEntityTypes.forEach(h=>{const u=new It({objectType:h,parentCompositeLayer:this,graphType:"entity",title:h.name});u.geometryType?this.layers.push(u):this.tables.push(u),this.dataManager.sublayerCaches.has(h.name)||this.dataManager.sublayerCaches.set(h.name,new Map)}),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach((h,u)=>{const T=((h,u,T)=>(h.has(u)||h.set(u,new Set),h.get(u)))(this.sublayerIdsCache,u);h.members?.forEach(g=>{if(T.add(g.id),g.linkChartLocation)if(g.linkChartLocation instanceof H.Z)this.dataManager.relationshipTypeNames.has(u)?this.relationshipLinkChartDiagramLookup.set(g.id,g.linkChartLocation):this.entityLinkChartDiagramLookup.set(g.id,g.linkChartLocation),this.linkChartGeohashLookup.set(g.id,2===g.linkChartLocation.coords.length&&0===g.linkChartLocation.lengths.length?(0,oe.fC)(g.linkChartLocation.coords[1],g.linkChartLocation.coords[0],12):"");else{const C=(0,P.GH)(g.linkChartLocation);this.dataManager.relationshipTypeNames.has(u)?this.relationshipLinkChartDiagramLookup.set(g.id,g.linkChartLocation?C:null):this.entityLinkChartDiagramLookup.set(g.id,g.linkChartLocation?C:null),this.linkChartGeohashLookup.set(g.id,"x"in g.linkChartLocation&&"y"in g.linkChartLocation?(0,oe.fC)(g.linkChartLocation.x,g.linkChartLocation.y,12):"")}})})}calculateLinkChartLayout(h="RADIAL_TREE",u){var T=this;return(0,ee.Z)(function*(){const g=[],C=[],M=[];T.dataManager.sublayerCaches.forEach((k,z)=>{T.dataManager.entityTypeNames.has(z)?k.forEach(B=>{g.push({typeName:z,feature:B})}):T.dataManager.relationshipTypeNames.has(z)&&k.forEach(B=>{C.push({typeName:z,feature:B})})}),T.entityLinkChartDiagramLookup=new Map,T.relationshipLinkChartDiagramLookup=new Map;const L=new Map,b=new Map,D=new Map,_=new Map,N=new Uint8Array(g.length),F=new Float64Array(g.length),U=new Float64Array(g.length),R=new Uint32Array(C.length),ae=new Uint32Array(C.length),w=[],ne=new et.Z({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7});let q,ce="FORCE_DIRECTED",Y=0,Q=0;switch(ce="GEOGRAPHIC"===h?"FORCE_DIRECTED":h,ce){case"FORCE_DIRECTED":q=vt.apply;break;case"COMMUNITY":q=wt.apply;break;case"HIERARCHICAL":q=Nt.apply;break;case"RADIAL_TREE":q=Rt.apply;break;case"SMART_TREE":q=At.apply;break;default:q=kt.apply}g.forEach(({typeName:k,feature:z})=>{if(u?.lockedNodeLocations?.has(z.attributes[he])){N[Y]="GEOGRAPHIC"===h&&T.dataManager.geographicLookup.has(k)?Oe.IsGeographic:Oe.None;const B=u.lockedNodeLocations.get(z.attributes[he]);F[Y]=B.x,U[Y]=B.y}else if("GEOGRAPHIC"===h&&T.dataManager.geographicLookup.has(k)){N[Y]=Oe.IsGeographic;let B=null;const Le=z.attributes[T.dataManager.geographicLookup.get(k).name];switch(T.dataManager.geographicLookup.get(k)?.geometryType){case"esriGeometryPoint":F[Y]=Le?.x,U[Y]=Le?.y;break;case"esriGeometryPolygon":B=Le?.centroid,null!=B?.x&&null!=B?.y?(F[Y]=B.x,U[Y]=B.y):N[Y]=Oe.IsMovable;break;case"esriGeometryPolyline":case"esriGeometryMultipoint":B=Le?.extent?.center,null!=B?.x&&null!=B?.y?(F[Y]=B.x,U[Y]=B.y):N[Y]=Oe.IsMovable;break;default:N[Y]=Oe.IsMovable}(null==F[Y]||null==U[Y]||Number.isNaN(F[Y])||Number.isNaN(U[Y]))&&(N[Y]=Oe.IsMovable,F[Y]=0,U[Y]=0)}else N[Y]=Oe.IsMovable,F[Y]=0,U[Y]=0;_.set(z.attributes[he],Y),w[Y]={feature:z,typeName:k},Y++});let re=!1;const A=new Map;C.forEach(k=>{const z=k.feature.attributes[st],B=k.feature.attributes[ot],Le=_.get(z),ke=_.get(B);if(void 0!==Le&&void 0!==ke){const _e=z+"-"+B,Re=A.get(_e);Re?.has(k.typeName)||(R[Q]=Le,ae[Q]=ke,void 0===Re?A.set(_e,new Map([[k.typeName,Q]])):Re.set(k.typeName,Q),Q++),M.push(k)}else re=!0,T.relationshipLinkChartDiagramLookup.set(z,null),T.linkChartGeohashLookup.set(z,null)}),re&&Me.Z.getLogger(T).warn("A relationship is a member of this layer that has either origin or destination entity nodes that are not members. The diagram geometry will be set to null"),yield function An(){return Dt||(Dt=x.e(1466).then(x.bind(x,31466)).then(h=>h.l).then(({default:h})=>h({locateFile:u=>(0,Rn.V)(`esri/libs/linkchartlayout/${u}`)})).then(h=>{!function Sn(h){te=h}(h)}),Dt)}();const{success:le,links:K}=q(N,F,U,R.subarray(0,Q),ae.subarray(0,Q));if(!le)throw new de.Z("knowledge-graph:layout-failed","Attempting to arrange the records in the specified layout failed");for(let k=0;k<w.length;k++){if(U[k]>84.9999?U[k]=84.9999:U[k]<-84.9999&&(U[k]=-84.9999),F[k]>179.9999?F[k]=179.9999:F[k]<-179.9999&&(F[k]=-179.9999),w[k].feature.attributes[Ce]=new hn.Z(F[k],U[k]),L.has(w[k].typeName))L.get(w[k].typeName)?.set(w[k].feature.attributes[he],w[k].feature);else{const B=new Map;B.set(w[k].feature.attributes[he],w[k].feature),L.set(w[k].typeName,B)}D.set(w[k].feature.attributes[he],w[k].feature);const z=(0,P.GH)(w[k].feature.attributes[Ce]);T.entityLinkChartDiagramLookup.set(w[k].feature.attributes[he],w[k].feature.attributes[Ce]?z:null),T.linkChartGeohashLookup.set(w[k].feature.attributes[he],(0,oe.fC)(w[k].feature.attributes[Ce].y,w[k].feature.attributes[Ce].x,12)),w[k].feature.attributes[Ce].x<ne.xmin&&(ne.xmin=w[k].feature.attributes[Ce].x),w[k].feature.attributes[Ce].x>ne.xmax&&(ne.xmax=w[k].feature.attributes[Ce].x),w[k].feature.attributes[Ce].y<ne.ymin&&(ne.ymin=w[k].feature.attributes[Ce].y),w[k].feature.attributes[Ce].y>ne.ymax&&(ne.ymax=w[k].feature.attributes[Ce].y)}if(T.linkChartExtent.xmin=ne.xmin,T.linkChartExtent.xmax=ne.xmax,T.linkChartExtent.ymin=ne.ymin,T.linkChartExtent.ymax=ne.ymax,!K)throw new de.Z("knowledge-graph:layout-failed","Attempting to retrieve link geometry from diagram engine failed");const ye=new Map,be=new Map,me=new Map,De=new Set;for(let k=0;k<M.length;k++){const z=[],B=M[k],Le=B.feature.attributes[st],ke=B.feature.attributes[ot],_e=Le+"-"+ke,Re=A.get(_e).get(B.typeName),je=0===Re?0:K?.vertexEndIndex[Re-1];if(!De.has(Re)){if(De.add(Re),K.types[Re]===dt.Recursive){const fe=[K.vertices[2*je],K.vertices[2*je+1]],at=[K.vertices[2*(je+1)],K.vertices[2*(je+1)+1]],Ye=[.5*(fe[0]+at[0]),.5*(fe[1]+at[1])],Je=[Ye[0]-fe[0],Ye[1]-fe[1]],Gt=[Ye[0]+Je[1],Ye[1]-Je[0]],Ot=[Ye[0]-Je[1],Ye[1]+Je[0]];z.push(fe),z.push(Gt),z.push(at),z.push(Ot),z.push(fe)}else{if(K.types[Re]!==dt.Regular){Me.Z.getLogger(T).warn("A relationship generated an unsupported link geometry type.  It will not be rendered");continue}for(let fe=je;fe<K.vertexEndIndex[Re];fe++)z.push([K.vertices[2*fe],K.vertices[2*fe+1]])}const Ue=w[_.get(Le)]?.feature.attributes[Ce],Ke=w[_.get(ke)]?.feature.attributes[Ce];z[0][0]===Ue.x&&z[0][1]===Ue.y||(z[0]=[Ue.x,Ue.y]),z[z.length-1][0]===Ke.x&&z[z.length-1][1]===Ke.y||(z[z.length-1]=[Ke.x,Ke.y]);for(let fe=1;fe<z.length-1;fe++)z[fe][1]>85.5?z[fe][1]=85.5:z[fe][1]<-85.5&&(z[fe][1]=-85.5),z[fe][0]>179.9999?z[fe][0]=179.9999:z[fe][0]<-179.9999&&(z[fe][0]=-179.9999);ye.has(_e)?ye.get(_e).push(z):ye.set(_e,[z])}const St=ye.get(_e);be.has(_e)||(be.set(_e,new Map),me.set(_e,new Map));const tt=be.get(_e),nt=me.get(_e);tt.has(B.typeName)||(tt.set(B.typeName,St.shift()),nt.set(B.typeName,0));const Ft=tt.get(B.typeName);nt.set(B.typeName,nt.get(B.typeName)+1);const Pt=new xt.Z({paths:Ft});if(B.feature.attributes[Ce]=Pt,b.has(B.typeName))b.get(B.typeName)?.set(B.feature.attributes[he],B.feature);else{const Ue=new Map;Ue.set(B.feature.attributes[he],B.feature),b.set(B.typeName,Ue)}D.set(B.feature.attributes[he],B.feature);const Bt=(0,P.GH)(B.feature.attributes[Ce]);T.relationshipLinkChartDiagramLookup.set(B.feature.attributes[he],B.feature.attributes[Ce]?Bt:null),T.linkChartGeohashLookup.set(B.feature.attributes[he],"")}for(const k of M)k.feature.attributes[Et]=me.get(k.feature.attributes[st]+"-"+k.feature.attributes[ot])?.get(k.typeName)??null;return T._currentLinkChartConfig={layoutMode:h},{nodes:L,links:b,idMap:D}})()}applyNewLinkChartLayout(h="RADIAL_TREE",u){var T=this;return(0,ee.Z)(function*(){const g=[];yield T.calculateLinkChartLayout(h,u),T.layers.forEach(C=>{g.push(C.refreshCachedQueryEngine())}),yield Promise.all(g),T._refreshNamedTypes()})()}getCurrentNodeLocations(){const h=new Map;return this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.forEach(u=>{u?.members?.forEach(T=>{const g=T.linkChartLocation;let C;g&&(C="x"in g?{x:g.x,y:g.y}:{x:g.coords[0],y:g.coords[1]},h.set(T.id,new hn.Z({x:C.x,y:C.y})))})}),h}synchronizeInclusionListWithCache(){var h=this;return(0,ee.Z)(function*(){return new Promise(u=>{h.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach((T,g)=>{if(T.useAllData=!1,T.members&&T.members.size>0){if(!h.dataManager.sublayerCaches.get(g))return;const C=new Set(Array.from(h.dataManager.sublayerCaches.get(g).keys()));Array.from(T.members.keys()).filter(M=>!C.has(M)).forEach(M=>{T.members?.delete(M)})}}),u()})})()}refreshLinkChartCache(h){var u=this;return(0,ee.Z)(function*(){yield u.dataManager.refreshCacheContent(h);const T=[];u.layers.forEach(g=>{T.push(g.refreshCachedQueryEngine())}),yield Promise.all(T),u._refreshNamedTypes()})()}_handleNewRecords(h){var u=this;return(0,ee.Z)(function*(){const T=[];u.dataManager.addToLayer(h);for(const g of h)u.sublayerIdsCache.has(g.typeName)||(u.sublayerIdsCache.set(g.typeName,new Set),T.push(g.typeName)),u.sublayerIdsCache.get(g.typeName).add(g.id);for(const g of T)if(u._graphTypeLookup.has(g)){const C=u._graphTypeLookup.get(g),M="endPoints"in C?"relationship":"entity",L=new It({objectType:C,parentCompositeLayer:u,graphType:M,title:g});"entity"===M?u.dataManager.entityTypeNames.add(g):u.dataManager.relationshipTypeNames.add(g),L.geometryType?u.layers.push(L):u.tables.push(L),u.dataManager.sublayerCaches.set(g,new Map)}yield u.dataManager.refreshCacheContent(h.map(g=>g.id)),yield u.applyNewLinkChartLayout(u._currentLinkChartConfig.layoutMode)})()}_initializeDiagram(){var h=this;return(0,ee.Z)(function*(){h.defaultLinkChartConfig?h.defaultLinkChartConfig.doNotRecalculateLayout?(h.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.forEach((u,T)=>{u?.members?.forEach(g=>{const C=g.linkChartLocation;let M;const L=g.id;if(!C)return;M="x"in C?{x:C.x,y:C.y}:{x:C.coords[0],y:C.coords[1]};const b=(0,P.GH)(M);h.dataManager.relationshipTypeNames.has(T)?h.relationshipLinkChartDiagramLookup.set(L,b):h.entityLinkChartDiagramLookup.set(L,b),h.linkChartGeohashLookup.set(L,(0,oe.fC)(M.x,M.y,12)),h.linkChartExtent.xmin>M.x&&(h.linkChartExtent.xmin=M.x),h.linkChartExtent.xmax<M.x&&(h.linkChartExtent.xmax=M.x),h.linkChartExtent.ymin>M.y&&(h.linkChartExtent.ymin=M.y),h.linkChartExtent.ymax<M.y&&(h.linkChartExtent.ymax=M.y)})}),h.memberRelationshipTypes.forEach(u=>{u.name&&h.dataManager.sublayerCaches.get(u.name)?.forEach(T=>{const g=h.relationshipLinkChartDiagramLookup.get(T.attributes[st]),C=h.relationshipLinkChartDiagramLookup.get(T.attributes[ot]);if(g&&C){const M=(0,P.GH)(new xt.Z({paths:[[g.coords[0],g.coords[1]],[C.coords[0],C.coords[1]]]}));h.relationshipLinkChartDiagramLookup.set(T.attributes[he],M)}else h.relationshipLinkChartDiagramLookup.set(T.attributes[he],null);h.linkChartGeohashLookup.set(T.attributes[he],"")})})):yield h.calculateLinkChartLayout(h.defaultLinkChartConfig.layoutMode,{lockedNodeLocations:h.getCurrentNodeLocations()}):yield h.calculateLinkChartLayout("RADIAL_TREE",{lockedNodeLocations:h.getCurrentNodeLocations()})})()}_refreshNamedTypes(){for(const h of this.layers)h.emit("refresh",{dataChanged:!0});for(const h of this.tables)h.emit("refresh",{dataChanged:!0})}};(0,O._)([(0,$.Cb)()],xe.prototype,"dataPreloadedInLocalCache",void 0),(0,O._)([(0,$.Cb)()],xe.prototype,"defaultLinkChartConfig",void 0),(0,O._)([(0,$.Cb)()],xe.prototype,"dataManager",void 0),(0,O._)([(0,$.Cb)()],xe.prototype,"knowledgeGraph",void 0),(0,O._)([(0,$.Cb)()],xe.prototype,"layers",void 0),(0,O._)([(0,$.Cb)()],xe.prototype,"entityLinkChartDiagramLookup",void 0),(0,O._)([(0,$.Cb)()],xe.prototype,"relationshipLinkChartDiagramLookup",void 0),(0,O._)([(0,$.Cb)()],xe.prototype,"linkChartExtent",void 0),(0,O._)([(0,$.Cb)()],xe.prototype,"linkChartGeohashLookup",void 0),(0,O._)([(0,$.Cb)()],xe.prototype,"memberEntityTypes",void 0),(0,O._)([(0,$.Cb)()],xe.prototype,"memberRelationshipTypes",void 0),(0,O._)([(0,$.Cb)()],xe.prototype,"sublayerIdsCache",void 0),(0,O._)([(0,$.Cb)()],xe.prototype,"tables",void 0),(0,O._)([(0,$.Cb)({json:{read:!1}})],xe.prototype,"type",void 0),xe=(0,O._)([(0,X.j)("esri.layers.LinkChartLayer")],xe);const Gn=xe},61256:(it,Pe,x)=>{x.d(Pe,{H:()=>$});var ee=x(8314),O=x(36592),Ze=x(65401);const de={minX:0,minY:0,maxX:0,maxY:0};class ${constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new O.Q(9,(0,ee.Z)("esri-csp-restrictions")?J=>({minX:J[0],minY:J[1],maxX:J[2],maxY:J[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const J=new Array(this._idByBounds.size);let X=0;this._idByBounds.forEach((oe,Fe)=>{J[X++]=Fe}),this._indexInvalid=!1,this._index.clear(),this._index.load(J)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter(J=>this._idByBounds.has(J))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const J=(0,Ze.cS)();for(const X of this._boundsById.values())X&&(J[0]=Math.min(X[0],J[0]),J[1]=Math.min(X[1],J[1]),J[2]=Math.max(X[2],J[2]),J[3]=Math.max(X[3],J[3]));return J}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(J){const X=this._boundsById.get(J);this._boundsById.delete(J),X&&(this._idByBounds.delete(X),this._indexInvalid||this._index.remove(X))}forEachInBounds(J,X){this._loadIndex(),function we(ve,J,X){(function Me(ve){de.minX=ve[0],de.minY=ve[1],de.maxX=ve[2],de.maxY=ve[3]})(J),ve.search(de,X)}(this._index,J,oe=>X(this._idByBounds.get(oe)))}get(J){return this._boundsById.get(J)}has(J){return this._boundsById.has(J)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(J,X){if(!this._indexInvalid){const oe=this._boundsById.get(J);oe&&(this._index.remove(oe),this._idByBounds.delete(oe))}this._boundsById.set(J,X),X&&(this._idByBounds.set(X,J),this._indexInvalid||(this._boundsToLoad.push(X),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},3579:(it,Pe,x)=>{x.d(Pe,{Z:()=>oe});var ee=x(85931),O=x(26584),Ze=x(61885),Ne=x(63290),de=x(5548),Me=x(65401),we=x(82054),$=x(61256),ve=x(16983),J=x(92794);const X=(0,de.Ue)();class oe{constructor(P){this.geometryInfo=P,this._boundsStore=new $.H,this._featuresById=new Map,this._markedIds=new Set,this.events=new Ze.Z,this.featureAdapter=J.n}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let P=0;return this._featuresById.forEach(H=>{null!=H.geometry&&H.geometry.coords&&(P+=H.geometry.coords.length)}),{featureCount:this._featuresById.size,vertexCount:P/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(P){if(null==this.fullBounds)return null;const[H,ue,ie,Ae]=this.fullBounds;return{xmin:H,ymin:ue,xmax:ie,ymax:Ae,spatialReference:(0,ve.S2)(P)}}add(P){this._add(P),this._emitChanged()}addMany(P){for(const H of P)this._add(H);this._emitChanged()}upsertMany(P){const H=P.map(ue=>this._upsert(ue));return this._emitChanged(),H.filter(ee.pC)}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}removeById(P){const H=this._featuresById.get(P);return H?(this._remove(H),this._emitChanged(),H):null}removeManyById(P){this._boundsStore.invalidateIndex();for(const H of P){const ue=this._featuresById.get(H);ue&&this._remove(ue)}this._emitChanged()}forEachBounds(P,H){for(const ue of P){const ie=this._boundsStore.get(ue.objectId);ie&&H((0,de.JR)(X,ie))}}getFeature(P){return this._featuresById.get(P)}has(P){return this._featuresById.has(P)}forEach(P){this._featuresById.forEach(H=>P(H))}forEachInBounds(P,H){this._boundsStore.forEachInBounds(P,ue=>{H(this._featuresById.get(ue))})}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}sweep(){let P=!1;this._featuresById.forEach((H,ue)=>{this._markedIds.has(ue)||(P=!0,this._remove(H))}),this._markedIds.clear(),P&&this._emitChanged()}_emitChanged(){this.events.emit("changed",void 0)}_add(P){if(!P)return;const H=P.objectId;if(null==H)return void Ne.Z.getLogger("esri.layers.graphics.data.FeatureStore").error(new O.Z("featurestore:invalid-feature","feature id is missing",{feature:P}));const ue=this._featuresById.get(H);let ie;if(this._markedIds.add(H),ue?(P.displayId=ue.displayId,ie=this._boundsStore.get(H),this._boundsStore.delete(H)):null!=this.onFeatureAdd&&this.onFeatureAdd(P),!P.geometry?.coords?.length)return this._boundsStore.set(H,null),void this._featuresById.set(H,P);ie=(0,we.$)(ie??(0,Me.Ue)(),P.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),null!=ie&&this._boundsStore.set(H,ie),this._featuresById.set(H,P)}_upsert(P){const H=P?.objectId;if(null==H)return Ne.Z.getLogger("esri.layers.graphics.data.FeatureStore").error(new O.Z("featurestore:invalid-feature","feature id is missing",{feature:P})),null;const ue=this._featuresById.get(H);if(!ue)return this._add(P),P;this._markedIds.add(H);const{geometry:ie,attributes:Ae}=P;for(const Te in Ae)ue.attributes[Te]=Ae[Te];return ie&&(ue.geometry=ie,this._boundsStore.set(H,(0,we.$)((0,Me.Ue)(),ie,this.geometryInfo.hasZ,this.geometryInfo.hasM)??null)),ue}_remove(P){null!=this.onFeatureRemove&&this.onFeatureRemove(P);const H=P.objectId;return this._markedIds.delete(H),this._boundsStore.delete(H),this._featuresById.delete(H),P}}},56554:(it,Pe,x)=>{x.d(Pe,{Dm:()=>$,Hq:()=>ve,MS:()=>J,bU:()=>de});var ee=x(8314),O=x(58817),Ze=x(87757),Ne=x(24837);function de(X){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===X||"esriGeometryMultipoint"===X?Ne.I4:"esriGeometryPolyline"===X?Ne.ET:Ne.lF}}}const Me=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let we=1;function $(X,oe){if((0,ee.Z)("esri-csp-restrictions"))return()=>({[oe]:null,...X});try{let Fe=`this.${oe} = null;`;for(const H in X)Fe+=`this${Me.test(H)?`.${H}`:`["${H}"]`} = ${JSON.stringify(X[H])};`;const P=new Function(`\n      return class AttributesClass$${we++} {\n        constructor() {\n          ${Fe};\n        }\n      }\n    `)();return()=>new P}catch{return()=>({[oe]:null,...X})}}function ve(X={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,O.d9)(X)}}]}function J(X,oe){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:X},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:oe,supportsDelete:oe,supportsEditing:oe,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:oe,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:Ze.g,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:oe,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}}}]);