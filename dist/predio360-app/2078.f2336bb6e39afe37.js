"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[2078],{25665:(O,B,i)=>{i.d(B,{b:()=>j});var z=i(15861),E=i(26584),S=i(8314),A=i(63290),T=i(10699),u=i(39351),w=i(99666),d=i(87526),o=i(67969),D=i(85775),_=i(18952),U=i(31548);class V{constructor(t,e,s){this._texture=null,this._lastTexture=null,this._fbos={},this.texelSize=4;const{buffer:a,pixelType:l,textureOnly:g}=t,f=(0,d.UK)(l);this.blockIndex=s,this.pixelType=l,this.size=e,this.textureOnly=g,g||(this.data=new f(a)),this._resetRange()}destroy(){this._texture?.dispose();for(const t in this._fbos){const e=this._fbos[t];e&&("0"===t&&e.detachColorTexture(),e.dispose()),this._fbos[t]=null}this._texture=null}get _textureDesc(){const t=new U.X;return t.wrapMode=o.e8.CLAMP_TO_EDGE,t.samplingMode=o.cw.NEAREST,t.dataType=this.pixelType,t.width=this.size,t.height=this.size,t}setData(t,e,s){const a=(0,w.jL)(t),l=this.data,g=a*this.texelSize+e;!l||g>=l.length||(l[g]=s,this.dirtyStart=Math.min(this.dirtyStart,a),this.dirtyEnd=Math.max(this.dirtyEnd,a))}getData(t,e){if(null==this.data)return null;const s=(0,w.jL)(t)*this.texelSize+e;return!this.data||s>=this.data.length?null:this.data[s]}getTexture(t){return this._texture??this._initTexture(t)}getFBO(t,e=0){if(!this._fbos[e]){const s=0===e?this.getTexture(t):this._textureDesc;this._fbos[e]=new D.X(t,s)}return this._fbos[e]}get hasDirty(){return this.dirtyEnd>=this.dirtyStart}updateTexture(t,e){try{const s=this.dirtyStart,a=this.dirtyEnd;if(!this.hasDirty)return;(0,S.Z)("esri-2d-update-debug")&&console.debug(`Version[${e}] AttributeStoreView.updateTexture`,{start:s,end:a,firstBytes:new Uint8Array(this.data.buffer.slice(0,16)),block:this}),this._resetRange();const l=this.data.buffer,g=this.getTexture(t),f=4,y=(s-s%this.size)/this.size,n=y,p=(a-a%this.size)/this.size,M=y*this.size*f,x=(this.size+p*this.size)*f-M,m=(0,d.UK)(this.pixelType),c=new m(l,M*m.BYTES_PER_ELEMENT,x),b=this.size,v=p-n+1;if(v>this.size)return void A.Z.getLogger("esri.views.2d.engine.webgl.AttributeStoreView").error(new E.Z("mapview-webgl","Out-of-bounds index when updating AttributeData"));g.updateData(0,0,n,b,v,c)}catch{}}update(t){const{data:e,start:s,end:a}=t;if(null!=e&&null!=this.data){const l=this.data,g=s*this.texelSize;for(let f=0;f<e.length;f++)t.layout&1<<f%this.texelSize&&(l[g+f]=e[f])}this.dirtyStart=Math.min(this.dirtyStart,s),this.dirtyEnd=Math.max(this.dirtyEnd,a)}resize(t,e){const s=this.size;if(this.size=e,this.textureOnly)return void(s!==this.size&&(this._lastTexture=this._texture,this._texture=null));const a=(0,d.UK)(this.pixelType);this.destroy(),this.data=new a(t.buffer)}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}_initTexture(t){const e=new _.x(t,this._textureDesc,this.data??void 0);if(null!=this._lastTexture&&this._fbos[0]){const s=this._lastTexture.descriptor.width,a=this._lastTexture.descriptor.height,l=this._lastTexture.descriptor.dataType,g=this._lastTexture.descriptor.pixelFormat,f=this.getFBO(t),y=(0,d.Yw)(l),r=new((0,d.UK)(l))(new ArrayBuffer(s*a*y*this.texelSize)),n=t.getBoundFramebufferObject(),{x:h,y:p,width:M,height:x}=t.getViewport();t.bindFramebuffer(f),f.readPixels(0,0,s,a,g,l,r),e.updateData(0,0,0,2*s,a/2,r),t.setViewport(h,p,M,x),t.bindFramebuffer(n)}return this.destroy(),this._texture=e,this._texture}}class P{constructor(){this.size=0,this._pendingAttributeUpdates=[],this._version=0,this._epoch=0,this._locked=!1}_initialize(t){if(!t)throw new Error("InternalError: initArgs must be defined");const e=t.blockDescriptors;if(this.size=t.blockSize,(0,S.Z)("esri-2d-update-debug")&&console.debug("AttributeStoreView.initialize",{message:t}),null==this._data)this._data=e.map((s,a)=>null!=s?new V(s,this.size,a):null);else for(let s=0;s<this._data.length;s++){const a=this._data[s],l=e[s];null!=l&&(null==a?this._data[s]=new V(l,this.size,s):a.resize(l,this.size))}}destroy(){for(const t of this._data??[])t?.destroy();this._defaultTexture?.dispose();for(const{resolver:t}of this._pendingAttributeUpdates)t.reject("AttributeStore destroyed");this._pendingAttributeUpdates=[]}isEmpty(){return null==this._data}getBlock(t){return null==this._data?null:this._data[t]}setLabelMinZoom(t,e){this.setData(t,0,1,e)}getLabelMinZoom(t){return this.getData(t,0,1,255)}getFilterFlags(t){return this.getData(t,0,0,0)}getVVSize(t){return this.getData(t,u.wi.VV,0,0)}getData(t,e,s,a){if(!this._data)return 0;const l=this._data[e];return null==l?0:l.getData(t,s)??a}setData(t,e,s,a){this._data[e].setData(t,s,a)}lockTextureUploads(){this._locked=!0}unlockTextureUploads(){this._locked=!1,this.update()}requestUpdate(t){var e=this;return(0,z.Z)(function*(){const s=(0,T.hh)();s.promise=s.promise.catch(a=>{(0,S.Z)("esri-2d-update-debug")&&console.error("AttributeStoreView.requestUpdate rejected",a)}),e._version=t.version,e._pendingAttributeUpdates.push({inner:t,resolver:s}),(0,S.Z)("esri-2d-update-debug")&&console.debug(`Version[${e._version}] AttributeStoreView.requestUpdate`,{message:t})})()}get currentEpoch(){return this._epoch}update(){if(this._locked)return;const t=this._pendingAttributeUpdates;this._pendingAttributeUpdates=[];for(const{inner:e,resolver:s}of t){const{blockData:a,initArgs:l,sendUpdateEpoch:g,version:f}=e;(0,S.Z)("esri-2d-update-debug")&&console.debug(`Version[${this._version}] Epoch[${g}] AttributeStoreView.applyUpdate`),this._version=f,this._epoch=g,null!=l&&this._initialize(l);const y=this._data;for(let r=0;r<a.length;r++){const n=a[r],h=y[r];null!=h&&null!=n&&((0,S.Z)("esri-2d-update-debug")&&console.debug(`Version[${this._version}] CpuBlock[${r}] AttributeStoreView.update`,{block:n}),h.update(n))}s.resolve()}}getUniforms(t){return{filterFlags:{texture:this._getTexture(t,u.wi.FilterFlags),unit:u.NY},animation:{texture:this._getTexture(t,u.wi.Animation),unit:u.zZ},gpgpu:{texture:this._getTexture(t,u.wi.GPGPU),unit:u.cz},visualVariableData:{texture:this._getTexture(t,u.wi.VV),unit:u.bm},dataDriven0:{texture:this._getTexture(t,u.wi.DD0),unit:u.j1},dataDriven1:{texture:this._getTexture(t,u.wi.DD1),unit:u.Ly},dataDriven2:{texture:this._getTexture(t,u.wi.DD2),unit:u.ce},size:this.size}}_getTexture(t,e){const s=this._data?.[e];return s?(s.updateTexture(t,this._version),s.getTexture(t)):this._getDefaultTexture(t)}_getDefaultTexture(t){if(null==this._defaultTexture){const e=new U.X;e.wrapMode=o.e8.CLAMP_TO_EDGE,e.samplingMode=o.cw.NEAREST,e.width=1,e.height=1,this._defaultTexture=new _.x(t,e,new Uint8Array(4))}return this._defaultTexture}}var C=i(26268);class j extends C.Z{constructor(t){super(t),this._statisticsByLevel=new Map,this.attributeView=new P}destroy(){this.children.forEach(t=>t.destroy()),this.removeAllChildren(),this.attributeView.destroy()}doRender(t){t.context.capabilities.enable("textureFloat"),super.doRender(t)}createRenderParams(t){const e=super.createRenderParams(t);return e.attributeView=this.attributeView,e.instanceStore=this._instanceStore,e.statisticsByLevel=this._statisticsByLevel,e}}},26268:(O,B,i)=>{i.d(B,{Z:()=>w});var z=i(8314),E=i(39406),S=i(44589),A=i(13382),T=i(7590);const u=(d,o)=>d.key.level-o.key.level!=0?d.key.level-o.key.level:d.key.row-o.key.row!=0?d.key.row-o.key.row:d.key.col-o.key.col;class w extends S.Z{constructor(o){super(),this._tileInfoView=o}renderChildren(o){this.sortChildren(u),this.setStencilReference(o),super.renderChildren(o)}createRenderParams(o){const{state:D}=o,_=super.createRenderParams(o);return _.requiredLevel=this._tileInfoView.getClosestInfoForScale(D.scale).level,_.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(D.scale),_}prepareRenderPasses(o){const D=super.prepareRenderPasses(o);return D.push(o.registerRenderPass({name:"stencil",brushes:[A.Z],drawPhase:E.jx.DEBUG|E.jx.MAP|E.jx.HIGHLIGHT|E.jx.LABEL,target:()=>this.getStencilTarget()})),(0,z.Z)("esri-tiles-debug")&&D.push(o.registerRenderPass({name:"tileInfo",brushes:[T.Z],drawPhase:E.jx.DEBUG,target:()=>this.children})),D}getStencilTarget(){return this.children}setStencilReference(o){let D=1;for(const _ of this.children)_.stencilRef=D++}}},4151:(O,B,i)=>{i.d(B,{o:()=>E});var z=i(24055);class E{constructor(A,T,u,w,d){this._instanceId=A,this.techniqueRef=T,this._meshWriterName=u,this._input=w,this.optionalAttributes=d}get instanceId(){return(0,z.G)(this._instanceId)}createMeshInfo(A){return{id:this._instanceId,meshWriterName:this._meshWriterName,options:A,optionalAttributes:this.optionalAttributes}}getInput(){return this._input}setInput(A){this._input=A}}},12078:(O,B,i)=>{i.d(B,{K:()=>f});var z=i(62208),E=i(25665),S=i(39406),A=i(4151),T=i(33428),u=i(24055);let w=0;function d(y,r,n){return new A.o((0,u.W)(w++),y,y.meshWriter.name,r,n)}const o={geometry:{visualVariableColor:null,visualVariableOpacity:null,visualVariableSizeMinMaxValue:null,visualVariableSizeScaleStops:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null,visualVariableRotation:null}};class D{constructor(){this.instances={fill:d(T.k2.fill,o,{zoomRange:!0}),marker:d(T.k2.marker,o,{zoomRange:!0}),line:d(T.k2.line,o,{zoomRange:!0}),text:d(T.k2.text,o,{zoomRange:!0,referenceSymbol:!1,clipAngle:!1}),complexFill:d(T.k2.complexFill,o,{zoomRange:!0}),texturedLine:d(T.k2.texturedLine,o,{zoomRange:!0})},this._instancesById=Object.values(this.instances).reduce((r,n)=>(r.set(n.instanceId,n),r),new Map)}getInstance(r){return this._instancesById.get(r)}}var _=i(86274),U=i(2753),L=i(86416),V=i(48310),P=i(93555),C=i(57477),j=i(87526),I=i(83994),t=i(67969),e=i(49353);const s=Math.PI/180;class l extends C.s{constructor(r){super(),this._program=null,this._vao=null,this._vertexBuffer=null,this._indexBuffer=null,this._dvsMat3=(0,U.Ue)(),this._localOrigin={x:0,y:0},this._getBounds=r}destroy(){this._vao&&(this._vao.dispose(),this._vao=null,this._vertexBuffer=null,this._indexBuffer=null),this._program=(0,z.M2)(this._program)}doRender(r){const{context:n}=r,h=this._getBounds();if(h.length<1)return;this._createShaderProgram(n),this._updateMatricesAndLocalOrigin(r),this._updateBufferData(n,h),n.setBlendingEnabled(!0),n.setDepthTestEnabled(!1),n.setStencilWriteMask(0),n.setStencilTestEnabled(!1),n.setBlendFunction(t.zi.ONE,t.zi.ONE_MINUS_SRC_ALPHA),n.setColorMask(!0,!0,!0,!0);const p=this._program;n.bindVAO(this._vao),n.useProgram(p),p.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),n.gl.lineWidth(1),n.drawElements(t.MX.LINES,8*h.length,t.g.UNSIGNED_INT,0),n.bindVAO()}_createTransforms(){return{displayViewScreenMat3:(0,U.Ue)()}}_createShaderProgram(r){this._program||(this._program=r.programCache.acquire("precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos = u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position = vec4(pos.xy, 0.0, 1.0);\n        }","precision mediump float;\n      void main() {\n        gl_FragColor = vec4(0.75, 0.0, 0.0, 0.75);\n      }",g().attributes))}_updateMatricesAndLocalOrigin(r){const{state:n}=r,{displayMat3:h,size:p,resolution:M,pixelRatio:x,rotation:m,viewpoint:c}=n,b=s*m,{x:v,y:W}=c.targetGeometry,N=(0,P.or)(v,n.spatialReference);this._localOrigin.x=N,this._localOrigin.y=W;const Z=x*p[0],F=x*p[1],G=M*Z,k=M*F,R=(0,_.yR)(this._dvsMat3);(0,_.Jp)(R,R,h),(0,_.Iu)(R,R,(0,L.al)(Z/2,F/2)),(0,_.bA)(R,R,(0,V.al)(p[0]/G,-F/k,1)),(0,_.U1)(R,R,-b)}_updateBufferData(r,n){const{x:h,y:p}=this._localOrigin,x=new Float32Array(8*n.length),m=new Uint32Array(8*n.length);let c=0,b=0;for(const v of n)v&&(x[2*c]=v[0]-h,x[2*c+1]=v[1]-p,x[2*c+2]=v[0]-h,x[2*c+3]=v[3]-p,x[2*c+4]=v[2]-h,x[2*c+5]=v[3]-p,x[2*c+6]=v[2]-h,x[2*c+7]=v[1]-p,m[b]=c+0,m[b+1]=c+3,m[b+2]=c+3,m[b+3]=c+2,m[b+4]=c+2,m[b+5]=c+1,m[b+6]=c+1,m[b+7]=c+0,c+=4,b+=8);if(this._vertexBuffer?this._vertexBuffer.setData(x.buffer):this._vertexBuffer=I.f.createVertex(r,t.l1.DYNAMIC_DRAW,x.buffer),this._indexBuffer?this._indexBuffer.setData(m):this._indexBuffer=I.f.createIndex(r,t.l1.DYNAMIC_DRAW,m),!this._vao){const v=g();this._vao=new e.U(r,v.attributes,v.bufferLayouts,{geometry:this._vertexBuffer},this._indexBuffer)}}}const g=()=>(0,j.cM)("bounds",{geometry:[{location:0,name:"a_position",count:2,type:t.g.FLOAT}]});class f extends E.b{constructor(r){super(r),this._instanceStore=new D,this.checkHighlight=()=>!0}destroy(){super.destroy(),this._boundsRenderer=(0,z.SC)(this._boundsRenderer)}get instanceStore(){return this._instanceStore}enableRenderingBounds(r){this._boundsRenderer=new l(r),this.requestRender()}get hasHighlight(){return this.checkHighlight()}onTileData(r,n){r.onMessage(n),this.contains(r)||this.addChild(r),this.requestRender()}_renderChildren(r,n){r.selection=n;for(const h of this.children)h.visible&&h.getDisplayList(r.drawPhase,this._instanceStore,S.gl.STRICT_ORDER)?.render(r)}}}}]);