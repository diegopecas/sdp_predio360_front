"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[6344],{84537:(ne,J,l)=>{l.d(J,{VF:()=>A,Uf:()=>Ne});var M=l(15861),u=l(17626),G=l(88879),N=l(83761),D=l(85931),Q=l(46160),f=l(26584),x=l(54024),S=l(8314),F=l(88159),C=l(10699),L=l(32917),j=l(16730),c=l(77712),E=(l(63290),l(76898)),B=l(2004),U=l(83137),fe=l(90194),X=l(59990);function Y(r,e){return e?"xoffset"in e&&e.xoffset?Math.max(r,Math.abs(e.xoffset)):"yoffset"in e&&e.yoffset?Math.max(r,Math.abs(e.yoffset||0)):r:r}function se(r,e){return"number"==typeof r?r:r?.stops?.length?function de(r){let e=0,n=0;for(let i=0;i<r.length;i++){const s=r[i].size;"number"==typeof s&&(e+=s,n++)}return e/n}(r.stops):e}function ie(r){const e=r?.renderer,n=r?.pointerType,i="touch"===n?9:6;if(!e)return i;const s="visualVariables"in e?function he(r,e){if(!e)return r;const n=e.filter(p=>"size"===p.type).map(p=>{const{maxSize:g,minSize:a}=p;return(se(g,r)+se(a,r))/2});let i=0;const s=n.length;if(0===s)return r;for(let p=0;p<s;p++)i+=n[p];const o=Math.floor(i/s);return Math.max(o,r)}(i,e.visualVariables):i;if("simple"===e.type)return Y(s,e.symbol);if("unique-value"===e.type){let o=s;return e.uniqueValueInfos?.forEach(p=>{o=Y(o,p.symbol)}),o}if("class-breaks"===e.type){let o=s;return e.classBreakInfos.forEach(p=>{o=Y(o,p.symbol)}),o}return s}var me=l(84792),ge=l(93555),k=l(2618),ve=l(95737),oe=l(91179),be=l(37053),xe=l(13410);var q,Pe=l(29132),Me=l(97478),le=l(86810),Ce=l(90912),ae=(l(4619),l(99433)),Re=l(65234);let h=q=class extends le.wq{static from(r){return(0,Ce.TJ)(q,r)}constructor(r){super(r),this.dpi=96,this.floors=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=null,this.height=400,this.historicMoment=null,this.layerIds=null,this.layerOption="top",this.mapExtent=null,this.maxAllowableOffset=null,this.returnFieldName=!0,this.returnGeometry=!1,this.returnM=!1,this.returnUnformattedValues=!0,this.returnZ=!1,this.spatialReference=null,this.sublayers=null,this.timeExtent=null,this.tolerance=null,this.width=400}writeHistoricMoment(r,e){e.historicMoment=r&&r.getTime()}};(0,u._)([(0,c.Cb)({type:Number,json:{write:!0}})],h.prototype,"dpi",void 0),(0,u._)([(0,c.Cb)()],h.prototype,"floors",void 0),(0,u._)([(0,c.Cb)({type:String,json:{write:!0}})],h.prototype,"gdbVersion",void 0),(0,u._)([(0,c.Cb)({types:Pe.qM,json:{read:oe.im,write:!0}})],h.prototype,"geometry",void 0),(0,u._)([(0,c.Cb)({type:Number,json:{write:!0}})],h.prototype,"geometryPrecision",void 0),(0,u._)([(0,c.Cb)({type:Number,json:{write:!0}})],h.prototype,"height",void 0),(0,u._)([(0,c.Cb)({type:Date})],h.prototype,"historicMoment",void 0),(0,u._)([(0,ae.c)("historicMoment")],h.prototype,"writeHistoricMoment",null),(0,u._)([(0,c.Cb)({type:[Number],json:{write:!0}})],h.prototype,"layerIds",void 0),(0,u._)([(0,c.Cb)({type:["top","visible","all","popup"],json:{write:!0}})],h.prototype,"layerOption",void 0),(0,u._)([(0,c.Cb)({type:B.Z,json:{write:!0}})],h.prototype,"mapExtent",void 0),(0,u._)([(0,c.Cb)({type:Number,json:{write:!0}})],h.prototype,"maxAllowableOffset",void 0),(0,u._)([(0,c.Cb)({type:Boolean,json:{write:!0}})],h.prototype,"returnFieldName",void 0),(0,u._)([(0,c.Cb)({type:Boolean,json:{write:!0}})],h.prototype,"returnGeometry",void 0),(0,u._)([(0,c.Cb)({type:Boolean,json:{write:!0}})],h.prototype,"returnM",void 0),(0,u._)([(0,c.Cb)({type:Boolean,json:{write:!0}})],h.prototype,"returnUnformattedValues",void 0),(0,u._)([(0,c.Cb)({type:Boolean,json:{write:!0}})],h.prototype,"returnZ",void 0),(0,u._)([(0,c.Cb)({type:Re.Z,json:{write:!0}})],h.prototype,"spatialReference",void 0),(0,u._)([(0,c.Cb)()],h.prototype,"sublayers",void 0),(0,u._)([(0,c.Cb)({type:Me.Z,json:{write:!0}})],h.prototype,"timeExtent",void 0),(0,u._)([(0,c.Cb)({type:Number,json:{write:!0}})],h.prototype,"tolerance",void 0),(0,u._)([(0,c.Cb)({type:Number,json:{write:!0}})],h.prototype,"width",void 0),h=q=(0,u._)([(0,E.j)("esri.rest.support.IdentifyParameters")],h);const ue=h;var Fe=l(68653),Oe=l(71774);let Z=class extends le.wq{constructor(r){super(r),this.displayFieldName=null,this.feature=null,this.layerId=null,this.layerName=null}readFeature(r,e){return G.Z.fromJSON({attributes:{...e.attributes},geometry:{...e.geometry}})}writeFeature(r,e){if(!r)return;const{attributes:n,geometry:i}=r;n&&(e.attributes={...n}),null!=i&&(e.geometry=i.toJSON(),e.geometryType=Oe.P.toJSON(i.type))}};(0,u._)([(0,c.Cb)({type:String,json:{write:!0}})],Z.prototype,"displayFieldName",void 0),(0,u._)([(0,c.Cb)({type:G.Z})],Z.prototype,"feature",void 0),(0,u._)([(0,Fe.r)("feature",["attributes","geometry"])],Z.prototype,"readFeature",null),(0,u._)([(0,ae.c)("feature")],Z.prototype,"writeFeature",null),(0,u._)([(0,c.Cb)({type:Number,json:{write:!0}})],Z.prototype,"layerId",void 0),(0,u._)([(0,c.Cb)({type:String,json:{write:!0}})],Z.prototype,"layerName",void 0),Z=(0,u._)([(0,E.j)("esri.rest.support.IdentifyResult")],Z);const Te=Z;function _(){return(_=(0,M.Z)(function*(r,e,n){const i=(e=function je(r){return ue.from(r)}(e)).geometry?[e.geometry]:[],s=(0,k.en)(r);return s.path+="/identify",(0,ge.aX)(i).then(o=>{const p=function Ee(r,e){const{dpi:n,gdbVersion:i,geometry:s,geometryPrecision:o,height:p,historicMoment:g,layerOption:a,mapExtent:b,maxAllowableOffset:y,returnFieldName:m,returnGeometry:d,returnUnformattedValues:I,returnZ:v,spatialReference:w,timeExtent:R,tolerance:P,width:O}=r.toJSON(),{dynamicLayers:V,layerDefs:K,layerIds:H}=function Se(r){const{mapExtent:e,floors:n,width:i,sublayers:s,layerIds:o,layerOption:p,gdbVersion:g}=r,a=s?.find(v=>null!=v.layer)?.layer?.serviceSublayers,b="popup"===p,y={},m=(0,U.yZ)({extent:e,width:i,spatialReference:e?.spatialReference}),d=[],I=v=>{if(v.visible&&(0===m||(0===v.minScale||m<=v.minScale)&&(0===v.maxScale||m>=v.maxScale)))if(v.sublayers)v.sublayers.forEach(I);else{if(!1===o?.includes(v.id)||b&&(!v.popupTemplate||!v.popupEnabled))return;d.unshift(v)}};if(s?.forEach(I),s&&!d.length)y.layerIds=[];else{const v=(0,xe.FN)(d,a,g),w=d.map(R=>{const P=(0,X.f)(n,R);return R.toExportImageJSON(P)});if(v)y.dynamicLayers=JSON.stringify(w);else{if(s){let P=d.map(({id:O})=>O);o&&(P=P.filter(O=>o.includes(O))),y.layerIds=P}else o?.length&&(y.layerIds=o);const R=function Ie(r,e){const n=!!r?.length,i=e.filter(s=>null!=s.definitionExpression||n&&null!=s.floorInfo);return i.length?i.map(s=>{const o=(0,X.f)(r,s),p=(0,ve._)(o,s.definitionExpression);return{id:s.id,definitionExpression:p??void 0}}):null}(n,d);if(null!=R&&R.length){const P={};for(const O of R)O.definitionExpression&&(P[O.id]=O.definitionExpression);Object.keys(P).length&&(y.layerDefs=JSON.stringify(P))}}}return y}(r),z=null!=e?.geometry?e.geometry:null,T={historicMoment:g,geometryPrecision:o,maxAllowableOffset:y,returnFieldName:m,returnGeometry:d,returnUnformattedValues:I,returnZ:v,tolerance:P},W=z&&z.toJSON()||s;T.imageDisplay=`${O},${p},${n}`,i&&(T.gdbVersion=i),W&&(delete W.spatialReference,T.geometry=JSON.stringify(W),T.geometryType=(0,oe.Ji)(W));const ce=w??W?.spatialReference??b?.spatialReference;if(ce&&(T.sr=(0,be.B9)(ce)),T.time=R?[R.start,R.end].join(","):null,b){const{xmin:Be,ymin:He,xmax:ze,ymax:Je}=b;T.mapExtent=`${Be},${He},${ze},${Je}`}return K&&(T.layerDefs=K),V&&!K&&(T.dynamicLayers=V),T.layers="popup"===a?"visible":a,H&&!V&&(T.layers+=`:${H.join(",")}`),T}(e,{geometry:o?.[0]}),g=(0,k.cv)({...s.query,f:"json",...p}),a=(0,k.lA)(g,n);return(0,me.Z)(s.path,a).then(we).then(b=>function Ze(r,e){if(!e?.length)return r;const n=new Map;e.forEach(function i(s){n.set(s.id,s),s.sublayers&&s.sublayers.forEach(i)});for(const s of r.results)s.feature.sourceLayer=n.get(s.layerId);return r}(b,e.sublayers))})})).apply(this,arguments)}function we(r){const e=r.data;return e.results=e.results||[],e.exceededTransferLimit=Boolean(e.exceededTransferLimit),e.results=e.results.map(n=>Te.fromJSON(n)),e}var Ge=l(46679),pe=l(57213),ye=l(10023);let ee=null;function Ne(r,e){return"tile"===e.type||"map-image"===e.type}let A=class extends N.Z{constructor(r){var e;super(r),e=this,this._featuresResolutions=new WeakMap,this.highlightGraphics=null,this.highlightGraphicUpdated=null,this.updateHighlightedFeatures=(0,C.Ds)(function(){var n=(0,M.Z)(function*(i){e.destroyed||e.updatingHandles.addPromise(e._updateHighlightedFeaturesGeometries(i).catch(()=>{}))});return function(i){return n.apply(this,arguments)}}())}initialize(){const r=e=>{this.updatingHandles.addPromise(this._updateHighlightedFeaturesSymbols(e).catch(()=>{})),this.updateHighlightedFeatures(this._highlightGeometriesResolution)};this.addHandles([(0,L.on)(()=>this.highlightGraphics,"change",e=>r(e.added),{onListenerAdd:e=>r(e)})])}fetchPopupFeaturesAtLocation(r,e){var n=this;return(0,M.Z)(function*(){const{layerView:{layer:i,view:{scale:s}}}=n;if(!r)throw new f.Z("fetchPopupFeatures:invalid-area","Nothing to fetch without area",{layer:i});const o=function Ae(r,e,n){const i=[];if(!r)return i;const s=o=>{if(o.visible&&(0===o.minScale||e<=o.minScale)&&(0===o.maxScale||e>=o.maxScale))if(o.sublayers)o.sublayers.forEach(s);else if(o.popupEnabled){const a=(0,ye.V5)(o,{...n,defaultPopupTemplateEnabled:!1});null!=a&&i.unshift({sublayer:o,popupTemplate:a})}};return r.map(s),i}(i.sublayers,s,e);if(!o.length)return[];const p=yield function Le(r,e){return te.apply(this,arguments)}(i,o);if(!((i.capabilities?.operations?.supportsIdentify??1)&&i.version>=10.5||p))throw new f.Z("fetchPopupFeatures:not-supported","query operation is disabled for this service",{layer:i});return p?n._fetchPopupFeaturesUsingQueries(r,o,e):n._fetchPopupFeaturesUsingIdentify(r,o,e)})()}clearHighlights(){this.highlightGraphics?.removeAll()}highlight(r){const e=this.highlightGraphics;if(!e)return(0,x.kB)();let n=null;if(r instanceof G.Z?n=[r]:Q.Z.isCollection(r)&&r.length>0?n=r.toArray():Array.isArray(r)&&r.length>0&&(n=r),n=n?.filter(D.pC),!n?.length)return(0,x.kB)();for(const i of n){const s=i.sourceLayer;null!=s&&"geometryType"in s&&"point"===s.geometryType&&(i.visible=!1)}return e.addMany(n),(0,x.kB)(()=>e.removeMany(n??[]))}_updateHighlightedFeaturesSymbols(r){var e=this;return(0,M.Z)(function*(){const{layerView:{view:n},highlightGraphics:i,highlightGraphicUpdated:s}=e;if(i&&s)for(const o of r){const p=o.sourceLayer&&"renderer"in o.sourceLayer&&o.sourceLayer.renderer;o.sourceLayer&&"geometryType"in o.sourceLayer&&"point"===o.sourceLayer.geometryType&&p&&"getSymbolAsync"in p&&p.getSymbolAsync(o).then(function(){var g=(0,M.Z)(function*(a){a||=new pe.Z;let b=null;const y="visualVariables"in p?p.visualVariables?.find(m=>"size"===m.type):void 0;y&&(ee||(ee=(yield Promise.resolve().then(l.bind(l,81808))).getSize),b=ee(y,o,{view:n.type,scale:n.scale,shape:"simple-marker"===a.type?a.style:null})),b||="width"in a&&"height"in a&&null!=a.width&&null!=a.height?Math.max(a.width,a.height):"size"in a?a.size:16,i.includes(o)&&(o.symbol=new pe.Z({style:"square",size:b,xoffset:"xoffset"in a?a.xoffset:0,yoffset:"yoffset"in a?a.yoffset:0}),s(o,"symbol"),o.visible=!0)});return function(a){return g.apply(this,arguments)}}())}})()}_updateHighlightedFeaturesGeometries(r){var e=this;return(0,M.Z)(function*(){const{layerView:{layer:n,view:i},highlightGraphics:s,highlightGraphicUpdated:o}=e;if(e._highlightGeometriesResolution=r,!o||!s?.length||!n.capabilities.operations.supportsQuery)return;const p=e._getTargetResolution(r),g=new Map;for(const y of s)(!e._featuresResolutions.has(y)||e._featuresResolutions.get(y)>p)&&(0,F.s1)(g,y.sourceLayer,()=>new Map).set(y.getObjectId(),y);const a=Array.from(g,([y,m])=>{const d=y.createQuery();return d.objectIds=[...m.keys()],d.outFields=[y.objectIdField],d.returnGeometry=!0,d.maxAllowableOffset=p,d.outSpatialReference=i.spatialReference,y.queryFeatures(d)}),b=yield Promise.all(a);if(!e.destroyed)for(const{features:y}of b)for(const m of y){const I=g.get(m.sourceLayer).get(m.getObjectId());I&&s.includes(I)&&(I.geometry=m.geometry,o(I,"geometry"),e._featuresResolutions.set(I,p))}})()}_getTargetResolution(r){const e=r*(0,j.c9)(this.layerView.view.spatialReference),n=e/16;return n<=10?0:r/e*n}_fetchPopupFeaturesUsingIdentify(r,e,n){var i=this;return(0,M.Z)(function*(){const s=yield i._createIdentifyParameters(r,e,n);if(null==s)return[];const{results:o}=yield function Ue(r,e,n){return _.apply(this,arguments)}(i.layerView.layer.parsedUrl,s,n);return o.map(p=>p.feature)})()}_createIdentifyParameters(r,e,n){var i=this;return(0,M.Z)(function*(){const{floors:s,layer:o,timeExtent:p,view:{spatialReference:g,scale:a}}=i.layerView;if(!e.length)return null;yield Promise.all(e.map(({sublayer:v})=>v.load(n).catch(()=>{})));const b=Math.min((0,S.Z)("mapservice-popup-identify-max-tolerance"),o.allSublayers.reduce((v,w)=>w.renderer?ie({renderer:w.renderer,pointerType:n?.pointerType}):v,2)),y=i.createFetchPopupFeaturesQueryGeometry(r,b),m=(0,U.dp)(a,g),d=Math.round(y.width/m),I=new B.Z({xmin:y.center.x-m*d,ymin:y.center.y-m*d,xmax:y.center.x+m*d,ymax:y.center.y+m*d,spatialReference:y.spatialReference});return new ue({floors:s,gdbVersion:"gdbVersion"in o?o.gdbVersion:void 0,geometry:r,height:d,layerOption:"popup",mapExtent:I,returnGeometry:!0,spatialReference:g,sublayers:o.sublayers,timeExtent:p,tolerance:b,width:d})})()}_fetchPopupFeaturesUsingQueries(r,e,n){var i=this;return(0,M.Z)(function*(){const{layerView:{floors:s,timeExtent:o}}=i,p=e.map(function(){var g=(0,M.Z)(function*({sublayer:a,popupTemplate:b}){if(yield a.load(n).catch(()=>{}),a.capabilities&&!a.capabilities.operations.supportsQuery)return[];const y=a.createQuery(),m=ie({renderer:a.renderer,pointerType:n?.pointerType}),d=i.createFetchPopupFeaturesQueryGeometry(r,m),I=new Set,[v]=yield Promise.all([(0,ye.e7)(a,b),a.renderer?.collectRequiredFields(I,a.fieldsIndex)]);(0,C.k_)(n),(0,fe.gd)(I,a.fieldsIndex,v);const w=Array.from(I).sort();if(y.geometry=d,y.outFields=w,y.timeExtent=o,s){const H=s.clone(),z=(0,X.f)(H,a);null!=z&&(y.where=y.where?`(${y.where}) AND (${z})`:z)}const R=i._getTargetResolution(d.width/m),P=yield function Ve(r){return r.expressionInfos?.length||Array.isArray(r.content)&&r.content.some(e=>"expression"===e.type)?(0,Ge.LC)():Promise.resolve()}(b);(0,C.k_)(n);const O="point"===a.geometryType||P&&P.arcadeUtils.hasGeometryOperations(b);O||(y.maxAllowableOffset=R);let{features:V}=yield a.queryFeatures(y,n);const K=O?0:R;V=yield function De(r,e,n){return re.apply(this,arguments)}(a,V,n);for(const H of V)i._featuresResolutions.set(H,K);return V});return function(a){return g.apply(this,arguments)}}());return(yield Promise.allSettled(p)).reduce((g,a)=>"fulfilled"===a.status?[...g,...a.value]:g,[]).filter(D.pC)})()}};function te(){return(te=(0,M.Z)(function*(r,e){if(r.capabilities?.operations?.supportsQuery)return!0;try{return yield Promise.any(e.map(({sublayer:n})=>n.load().then(()=>n.capabilities.operations.supportsQuery)))}catch{return!1}})).apply(this,arguments)}function re(){return(re=(0,M.Z)(function*(r,e,n){const i=r.renderer;return i&&"defaultSymbol"in i&&!i.defaultSymbol&&(e=i.valueExpression?yield Promise.all(e.map(s=>i.getSymbolAsync(s,n).then(o=>o?s:null))).then(s=>s.filter(o=>null!=o)):e.filter(s=>null!=i.getSymbol(s))),e})).apply(this,arguments)}(0,u._)([(0,c.Cb)({constructOnly:!0})],A.prototype,"createFetchPopupFeaturesQueryGeometry",void 0),(0,u._)([(0,c.Cb)({constructOnly:!0})],A.prototype,"layerView",void 0),(0,u._)([(0,c.Cb)({constructOnly:!0})],A.prototype,"highlightGraphics",void 0),(0,u._)([(0,c.Cb)({constructOnly:!0})],A.prototype,"highlightGraphicUpdated",void 0),(0,u._)([(0,c.Cb)({constructOnly:!0})],A.prototype,"updatingHandles",void 0),A=(0,u._)([(0,E.j)("esri.views.layers.support.MapService")],A)},10023:(ne,J,l)=>{l.d(J,{V5:()=>D,e7:()=>G,zc:()=>Q});var M=l(15861),u=l(90194);function G(f){return N.apply(this,arguments)}function N(){return(N=(0,M.Z)(function*(f,x=f.popupTemplate){if(null==x)return[];const S=yield x.getRequiredFields(f.fieldsIndex),{lastEditInfoEnabled:F}=x,{objectIdField:C,typeIdField:L,globalIdField:j,relationships:c}=f;if(S.includes("*"))return["*"];const $=F?(0,u.CH)(f):[],E=(0,u.Q0)(f.fieldsIndex,[...S,...$]);return L&&E.push(L),E&&C&&f.fieldsIndex?.has(C)&&!E.includes(C)&&E.push(C),E&&j&&f.fieldsIndex?.has(j)&&!E.includes(j)&&E.push(j),c&&c.forEach(B=>{const{keyField:U}=B;E&&U&&f.fieldsIndex?.has(U)&&!E.includes(U)&&E.push(U)}),E})).apply(this,arguments)}function D(f,x){return f.popupTemplate?f.popupTemplate:null!=x&&x.defaultPopupTemplateEnabled&&null!=f.defaultPopupTemplate?f.defaultPopupTemplate:null}function Q(f,x){return null!=D(f,{defaultPopupTemplateEnabled:x})}},94672:(ne,J,l)=>{l.d(J,{K:()=>N}),l(29132);var u=l(16730),G=l(2004);function N(f,x,S,F=new G.Z){let C=0;if("2d"===S.type)C=x*(S.resolution??0);else if("3d"===S.type){const B=S.overlayPixelSizeInMapUnits(f),U=S.basemapSpatialReference;C=null==U||U.equals(S.spatialReference)?x*B:(0,u.c9)(U)/(0,u.c9)(S.spatialReference)}const L=f.x-C,j=f.y-C,c=f.x+C,$=f.y+C,{spatialReference:E}=S;return F.xmin=Math.min(L,c),F.ymin=Math.min(j,$),F.xmax=Math.max(L,c),F.ymax=Math.max(j,$),F.spatialReference=E,F}new G.Z}}]);