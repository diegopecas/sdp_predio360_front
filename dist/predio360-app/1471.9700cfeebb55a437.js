"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[1471],{7508:(Je,Pe,C)=>{function ne(){return new Float32Array(4)}function D(ve){const He=new Float32Array(4);return He[0]=ve[0],He[1]=ve[1],He[2]=ve[2],He[3]=ve[3],He}function X(ve,He,L,K){const Ze=new Float32Array(4);return Ze[0]=ve,Ze[1]=He,Ze[2]=L,Ze[3]=K,Ze}function G(){return ne()}function te(){return X(1,1,1,1)}function V(){return X(1,0,0,0)}function T(){return X(0,1,0,0)}function Ee(){return X(0,0,1,0)}function qe(){return X(0,0,0,1)}C.d(Pe,{al:()=>X,d9:()=>D});const se=G(),Qe=te(),de=V(),ee=T(),H=Ee(),Re=qe();Object.freeze(Object.defineProperty({__proto__:null,ONES:Qe,UNIT_W:Re,UNIT_X:de,UNIT_Y:ee,UNIT_Z:H,ZEROS:se,clone:D,create:ne,createView:function Z(ve,He){return new Float32Array(ve,He,4)},fromValues:X,ones:te,unitW:qe,unitX:V,unitY:T,unitZ:Ee,zeros:G},Symbol.toStringTag,{value:"Module"}))},75618:(Je,Pe,C)=>{function ne(X){let Z,G,te=[],V=!1;return function T(...Ee){return V&&Z===this&&function D(X,Z){if(X.length!==Z.length)return!1;for(let G=0;G<X.length;++G)if(X[G]!==Z[G])return!1;return!0}(Ee,te)||(G=X.apply(this,Ee),Z=this,te=Ee,V=!0),G}}C.d(Pe,{H:()=>ne})},21471:(Je,Pe,C)=>{C.r(Pe),C.d(Pe,{default:()=>io});var Ue,h,ne=C(15861),D=C(17626),X=C(83761),Z=C(54024),G=C(63290),te=C(62208),V=C(32917),T=C(77712),se=(C(8314),C(4619),C(76898)),Qe=C(1437),de=C(97662),ee=C(16730),H=C(75775),Re=C(21286),fe=C(15572),ve=C(52113),He=C(74741),L=C(79800),K=C(29302),Ze=C(78172),ge=C(26242),ie=C(41967),ue=C(84786),_e=C(64770),Ve=C(1582),Ae=C(37053),Ke=C(66601);function Ht(h,l,p){const g=W(h,l,p,Ue.Direct);return null!=g?(0,fe.yG)(g.direct,g.unit):null}function W(h,l,p,g){const m=(0,Ke.m)(p),v=(0,ee.j5)(m);if(null==v)return null;const S=l[2]-h[2];if(g===Ue.Vertical)return{verticalSigned:S,unit:v};if(!(0,Ve.S)(h,p,he,m)||!(0,Ve.S)(l,p,oe,m))return null;if(g===Ue.Direct)return{direct:(0,L.q)(oe,he),unit:v};if((0,L.s)(pe,h[0],h[1],l[2]),!(0,Ve.S)(pe,p,pe,m))return null;const M=(0,L.q)(pe,oe);return g===Ue.Horizontal?{horizontal:M,unit:v}:{direct:(0,L.q)(oe,he),horizontal:M,vertical:Math.abs(S),unit:v}}(h=Ue||(Ue={}))[h.Direct=0]="Direct",h[h.Horizontal=1]="Horizontal",h[h.Vertical=2]="Vertical";const B=(0,K.Ue)(),J=(0,K.Ue)(),he=(0,K.Ue)(),oe=(0,K.Ue)(),pe=(0,K.Ue)();C(29132);var ze=C(44766);C(94008),(0,K.Ue)();var De=C(16319),xe=C(10049),je=C(91622),We=C(65234);function Xt(h,l,p){return(0,je.T)(p,ji,mi,Ii,h,l,p)}function ji(h,l,p){return(0,fe.yG)((0,xe.cA)(Dn,h,l,p).distance,"meters")}function mi(h,l,p){return(0,fe.yG)((0,ze.geodesicLength)(function ut(h,l,p){return{type:"polyline",spatialReference:p,paths:[[[...h],[...l]]]}}(h,l,p),"meters"),"meters")}function Ii(h,l,p){return(0,De.k)(h,p,rt)&&(0,De.k)(l,p,ht)?(0,fe.yG)((0,xe.cA)(Dn,rt,ht,We.Z.WGS84).distance,"meters"):null}const Dn=new xe._q,Qt=(0,K.Ue)(),$t=(0,K.Ue)(),rt=(0,K.Ue)(),ht=(0,K.Ue)();function gt(h,l){return function dt(h,l){if(!(0,Ae.fS)(h.spatialReference,l.spatialReference))return null;const{spatialReference:p}=h;return Qt[0]=h.x,Qt[1]=h.y,Qt[2]=h.hasZ?h.z:0,$t[0]=l.x,$t[1]=l.y,$t[2]=l.hasZ?l.z:0,Xt(Qt,$t,p)}(h,l)??function Gt(h,l){const{spatialReference:p}=h;return(0,Ae.fS)(p,l.spatialReference)?(B[0]=h.x,B[1]=h.y,B[2]=h.hasZ?h.z:0,J[0]=l.x,J[1]=l.y,J[2]=l.hasZ?l.z:0,function Cn(h,l,p){const g=W(h,l,p,Ue.Horizontal);return null!=g?(0,fe.yG)(g.horizontal,g.unit):null}(B,J,p)):null}(h,l)}function Ft(h){const{elevationAlignedStartPoint:l,elevationAlignedEndPoint:p,dimension:{offset:g,measureType:m,orientation:v}}=h;return{elevationAlignedStartPoint:l,elevationAlignedEndPoint:p,offset:g,measureType:m,orientation:v}}function Rn({elevationAlignedStartPoint:h,elevationAlignedEndPoint:l,offset:p,measureType:g,orientation:m},v,S=null){if(null==h||null==l)return null;const M=k(S?.directSegment??new _e.y,{elevationAlignedStartPoint:h,elevationAlignedEndPoint:l},v),P=S?.primaryOffsetAxis??(0,K.Ue)();tt(P,{measureType:g,elevationAlignedStartPoint:h,elevationAlignedEndPoint:l,directSegment:M,orientation:m,renderCoordsHelper:v});const R=S?.dimensionSegment??new _e.y;return On({elevationAlignedStartPoint:h,elevationAlignedEndPoint:l})&&g===de.n.Vertical?((0,L.c)(R.startRenderSpace,M.startRenderSpace),(0,L.c)(R.endRenderSpace,M.endRenderSpace)):Qn(R,{offsetAxis:P,offset:p,relativeToSegment:M,renderCoordsHelper:v}),{elevationAlignedStartPoint:h,elevationAlignedEndPoint:l,directSegment:M,dimensionSegment:R,primaryOffsetAxis:P,spatialReference:v.spatialReference}}function Gn(h,l,p,g){return l===O.Start?((0,L.c)(h.startRenderSpace,p.startRenderSpace),(0,L.c)(h.endRenderSpace,g.startRenderSpace)):((0,L.c)(h.startRenderSpace,p.endRenderSpace),(0,L.c)(h.endRenderSpace,g.endRenderSpace)),h}var O;function w(h,l,p,g){switch(l){case de.n.Direct:return k(h,p,g);case de.n.Horizontal:case de.n.Vertical:{const{elevationAlignedStartPoint:m,elevationAlignedEndPoint:v,dimension:S,geometry:M}=p;let P;S.measureType===de.n.Direct?(P=function re(h,l){const p=h.directSegment.eval(.5,ge.WM.get()),g=l.worldUpAtPosition(p,ge.WM.get()),m=h.dimensionSegment.eval(.5,ge.WM.get()),v=(0,L.z)(ge.WM.get(),m,p);return!(0,L.G)(v,K.AG)&&(0,L.k)(v,g)>0}(M,g)===m.z>v.z,l===de.n.Horizontal&&(P=!P)):P=!function ae(h){const{startRenderSpace:l,endRenderSpace:p}=h.dimensionSegment,{startRenderSpace:g,endRenderSpace:m}=h.directSegment;return(0,L.w)(g,l)<(0,L.w)(m,p)}(M);const[R,b]=P?[m,v]:[v,m],U=(0,ue.WG)(b,Te);return l===de.n.Horizontal?U.z=R.z:(U.x=R.x,U.y=R.y),g.toRenderCoords(R,h.startRenderSpace),g.toRenderCoords(U,h.endRenderSpace),h}}}function k(h,l,p){return p.toRenderCoords(l.elevationAlignedStartPoint,h.startRenderSpace),p.toRenderCoords(l.elevationAlignedEndPoint,h.endRenderSpace),h}(0,K.Ue)(),(0,K.Ue)(),function(h){h[h.Start=0]="Start",h[h.End=1]="End"}(O||(O={}));const Te=(0,ie.T)(0,0,0,null),Be=new _e.y;function tt(h,l){const{measureType:p,elevationAlignedStartPoint:g,elevationAlignedEndPoint:m,directSegment:{startRenderSpace:v,endRenderSpace:S},directSegment:M,renderCoordsHelper:P}=l,R=M.eval(.5,ge.WM.get()),b=P.worldUpAtPosition(R,ge.WM.get()),U=P.worldBasisAtPosition(R,Ze.R.Y,ge.WM.get());switch(p){case de.n.Horizontal:(0,L.c)(h,b);break;case de.n.Vertical:(0,L.k)(v,b)<(0,L.k)(S,b)?(0,L.z)(h,S,v):(0,L.z)(h,v,S),(0,L.b)(h,h,b),(0,L.b)(h,h,b);break;case de.n.Direct:{const j=l.orientation??0;if(On({elevationAlignedStartPoint:g,elevationAlignedEndPoint:m}))(0,ve.Us)(cn,-(0,Re.Vl)(j),b),(0,L.e)(h,U,cn);else{const Y=(0,L.z)(ge.WM.get(),S,v),le=(0,L.b)(ge.WM.get(),Y,b);(0,L.b)(le,le,Y),(0,ve.Us)(cn,(0,Re.Vl)(j),Y),(0,L.e)(h,le,cn)}break}}return(0,L.G)(h,K.AG)?(0,L.c)(h,U):(0,L.n)(h,h)}const cn=(0,He.Ue)();function On({elevationAlignedStartPoint:h,elevationAlignedEndPoint:l}){return null!=h&&null!=l&&h.x===l.x&&h.y===l.y}function Qn(h,l){const{offsetAxis:p,offset:g,relativeToSegment:{startRenderSpace:m,endRenderSpace:v},relativeToSegment:S,renderCoordsHelper:M}=l,P=g/M.unitInMeters,[R,b]=function $n(h,l,p,g=0){const m=(0,L.k)(l,p),v=(0,L.k)(h,p),S=Math.abs(m-v)+g;return m>v?[S,g]:[g,S]}(m,v,p,P);return(0,L.r)(h.startRenderSpace,S.startRenderSpace,p,R),(0,L.r)(h.endRenderSpace,S.endRenderSpace,p,b),h}function dn(h,l,p){const g=l.directSegment.eval(.5,ge.WM.get());return p.worldUpAtPosition(g,h)}function un(h,l){const{startRenderSpace:p,endRenderSpace:g}=l.directSegment;return(0,L.z)(h,g,p)}function Hn(h,l,p={invert:!1}){const{startRenderSpace:g,endRenderSpace:m}=l.dimensionSegment;return p.invert?(0,L.z)(h,g,m):(0,L.z)(h,m,g)}function hn(h,l){const p=h.directSegment.eval(.5,ge.WM.get());return l.headingAtPosition(p,h.primaryOffsetAxis)}const xn=(0,K.Ue)();function pn(h){const{elevationAlignedStartPoint:l,elevationAlignedEndPoint:p}=h;if(null==l||null==p)return!1;const g=function Vt(h,l){const{spatialReference:p}=h;return(0,Ae.fS)(p,l.spatialReference)?(B[0]=h.x,B[1]=h.y,B[2]=h.hasZ?h.z:0,J[0]=l.x,J[1]=l.y,J[2]=l.hasZ?l.z:0,Ht(B,J,p)):null}(l,p);return null!=g&&(0,fe.nn)(g,"meters").value>je.Y}function wt(h){return null!=h.geometry}let Pt=class extends X.Z{constructor(h){super(h)}initialize(){const h=(0,V.wZ)(()=>this.analysisViewData.computations,({computation:l})=>this._watchComputation(l));this.addHandles((0,Z.ed)(h))}get analysis(){return this.analysisViewData.analysis}get _defaultUnit(){return(0,H.R)(this.view)}_watchComputation(h){return(0,V.YP)(()=>Ft(h),l=>{const{measureType:p}=l;if(pn(l)&&p!==de.n.Direct){const m=Math.round((0,ee.En)(je.Y,"meters","kilometers"));return G.Z.getLogger(this).warnOnce(`A ${p} dimension in the analysis (id: '${this.analysis.id}') will not display, because only direct dimensions can measure lengths greater than ${m} km. Update the measureType of the affected dimension to "direct" to display it.`),void(h.geometry=null)}const g=Rn(l,this.view.renderCoordsHelper,h.geometry);h.geometry=g,h.result.length=function St(h,l,p){if(null==h)return null;let g;if(l===de.n.Horizontal)g=gt(h.elevationAlignedStartPoint,h.elevationAlignedEndPoint);else{const{startRenderSpace:v,endRenderSpace:S}=h.dimensionSegment;g=Ht(v,S,h.spatialReference)}if(null==g)return null;const m=l===de.n.Vertical?(0,ee.yv)(g.value,g.unit,p):(0,ee.wd)(g.value,g.unit,p);return(0,fe.nn)(g,m)}(g,p,this._defaultUnit)},V.tX)}};(0,D._)([(0,T.Cb)({constructOnly:!0})],Pt.prototype,"analysisViewData",void 0),(0,D._)([(0,T.Cb)({constructOnly:!0})],Pt.prototype,"view",void 0),(0,D._)([(0,T.Cb)()],Pt.prototype,"analysis",null),(0,D._)([(0,T.Cb)()],Pt.prototype,"_defaultUnit",null),Pt=(0,D._)([(0,se.j)("esri.views.3d.analysis.Dimension.support.DimensionController")],Pt);var Tn=C(84244),Ye=C(91558),fn=C(23719),ot=C(23841),Jt=C(1503),Nt=C(90014),vi=C(78260);function qn(h){return(0,vi.G)(h.accentColor,.5)}function Ys(h){return(0,vi.mj)(h.accentColor)}const ks=new Ye.Z([127,127,127,.5]),Hi=.8,Qs=6,Js=18,qs=2,er=.3,tr=2,Ni=5;var ei=C(45403),Mt=C(19142),At=C(40345),bn=C(8859),lr=C(81805),Wi=C(94255),cr=C(41120),Lt=C(57521),be=C(40723),qt=C(16396),Bi=C(79967),Ut=C(92222),zt=C(30260),Et=C(33786),gn=C(72642);class dr{constructor(l){this.start=l.start,this.end=l.end,this.offset=l.offset,this.heading=l.heading,this.rotation=l.rotation,this.direct=l.direct,this.horizontal=l.horizontal,this.vertical=l.vertical}manipulatorName(l){return Object.keys(this).find(p=>this.hasOwnProperty(p)&&l===this[p])}values(){return[this.start,this.end,this.offset,this.heading,this.rotation,this.direct,this.horizontal,this.vertical]}forEachMeasureTypeManipulator(l){for(const p of de.V)l(this.manipulatorForMeasureType(p),p)}manipulatorForMeasureType(l){switch(l){case de.n.Direct:return this.direct;case de.n.Horizontal:return this.horizontal;case de.n.Vertical:return this.vertical}}}class ur extends ei.Z{constructor(l,p){const g=(0,Mt.EA)(Ye.Z.toUnitRGBA(qn(l.effectiveTheme))),m=[new At.r((0,Lt.PI)(g,1,32,32),Zt)];super({view:l,renderObjects:m,metadata:p.metadata,available:!1,grabCursor:"crosshair",radius:5,collisionPriority:1}),this._themeHandle=(0,V.YP)(()=>({color:Ye.Z.toUnitRGBA(qn(l.effectiveTheme))}),v=>g.setParameters(v))}destroy(){this._themeHandle.remove(),super.destroy()}}class Ki extends ei.Z{constructor(l,{lineSizePt:p,material:g,metadata:m}){super({view:l,autoScaleRenderObjects:!1,collisionPriority:1,metadata:m}),this._options={calloutColor:(0,Jt.Ue)(),lineSizePt:p,material:g},this._themeHandle=(0,V.YP)(()=>Ye.Z.toUnitRGBA(qn(l.effectiveTheme)),v=>{this._options.calloutColor=v,es(this,Yi({...this._options,metadata:this.metadata}))},V.nn)}update({lineSizePt:l,material:p}){this._options.lineSizePt=l,this._options.material=p,es(this,Yi({...this._options,metadata:this.metadata}))}destroy(){this._themeHandle.remove(),super.destroy()}}function Yi({calloutColor:h,lineSizePt:l,material:p,metadata:g}){return{calloutLength:.25*lr.M_*Hi*(0,ot.F2)(l)+Js,calloutColor:h,calloutWidth:qs,customStateMask:Zt,discScale:er,focusMultiplier:tr,material:p,metadata:g}}function ki(h){const{cancel:l,computation:p,settingHeading:g,steps:m,view:v}=h;if(!wt(p))return;const{renderCoordsHelper:S}=v,{dimension:M,geometry:P}=p,R=(0,K.Ue)(),b=Ji((0,K.Ue)(),P,P.directSegment,S),U=qi(ge.WM.get(),{forHeading:g,geometry:P,renderCoordsHelper:S}),j=(0,Nt.Yq)(b,U,(0,Nt.Ue)()),Y=g?M.orientation??hn(P,v.renderCoordsHelper):M.orientation??0;m.next((0,bn._N)(v,j)).next(le=>{"start"===le.action&&(0,L.c)(R,le.renderStart);const me=(0,Nt.st)(j),Me=(0,Mt.Gd)(R,le.renderEnd,b,me);let ke=Y-(0,Re.BV)(Me);g||(ke=function _r(h){const l=fn.BV.normalize(h)%90;return l<Ni?h-l:90-l<Ni?h+(90-l):h}(ke)),M.orientation=ke}),l.next((0,zt.di)(M,["orientation"]))}function Xi(h,l,p,g){const m=(0,L.f)(ge.WM.get(),p.endRenderSpace,p.startRenderSpace);(0,L.b)(m,m,g);const v=(0,Nt.Yq)(p.startRenderSpace,m,(0,Nt.Ue)()),S=(0,Nt.Yq)(p.startRenderSpace,g,(0,Nt.Ue)()),M=l.offset;let P,R=0;const b=new zt.hM;return b.next((0,bn._N)(h,v)).next(U=>{"start"===U.action&&(R=(0,Nt.jH)(S,U.renderStart));const j=((0,Nt.jH)(S,U.renderEnd)-R)*h.renderCoordsHelper.unitInMeters;l.offset=M+j,P=U}),U=>(b.execute(U),P)}function Qi(h,l){const{directSegment:p}=h,{renderCoordsHelper:g}=l,m=dn(ge.WM.get(),h,g),v=un(ge.WM.get(),h),S=(0,L.b)(ge.WM.get(),v,m),{viewForward:M}=l.state.camera;(0,L.k)(S,M)>0&&(0,L.h)(S,S,-1);const P=p.eval(.5,ge.WM.get());return g.headingAtPosition(P,S)}function $i(h,l,p,{forHeading:g}){const{dimension:m,geometry:v}=l,{primaryOffsetAxis:S}=v,M=(0,L.h)(Cr,S,m.offset>=0?1:-1),P=qi(Dr,{forHeading:g,geometry:v,renderCoordsHelper:p});(0,L.b)(P,P,M);const R=(0,Mt.Aq)(M,P,K.AG,ti);h.modelTransform=R,h.renderLocation=Ji(Fn,v,v.dimensionSegment,p)}const Cr=(0,K.Ue)(),Dr=(0,K.Ue)();function Ji(h,l,p,g){const{startRenderSpace:m,endRenderSpace:v}=p,S=function Or(h,l){const p=un(xr,h),g=dn(Tr,h,l);return(0,L.k)(p,g)>0}(l,g)?m:v;return(0,L.c)(h,S)}function qi(h,{forHeading:l,geometry:p,renderCoordsHelper:g}){return l?dn(h,p,g):Hn(h,p,{invert:!0})}const xr=(0,K.Ue)(),Tr=(0,K.Ue)();function yi(h){return(0,ot.F2)(h)+Qs}function es(h,l){const p=l.material??new Bi.j({transparent:!0,writeDepth:!1,textureId:l.texture?.id,renderOccluded:be.yD.Opaque,isDecoration:!0}),g=l.focusMultiplier??Mt.vQ.focusMultiplier,m=l.calloutLength??Mt.vQ.calloutLength,v=Mt.vQ.discRadius*(l.discScale??1),S=v*g,M=(Y,le)=>{const me=[0,1,2,2,3,0];return new cr.Z(le,[[qt.T.POSITION,new Wi.a([m-Y,-Y,0,m+Y,-Y,0,m+Y,Y,0,m-Y,Y,0],me,3,!0)],[qt.T.UV0,new Wi.a([0,0,1,0,1,1,0,1],me,2,!0)]])},R=new Ut.U({width:l.calloutWidth??Mt.vQ.calloutWidth,color:l.calloutColor,renderOccluded:be.yD.OccludeAndTransparent,isDecoration:!0}),b=(0,Lt.rh)(R,[[0,0,0],[m-v,0,0]]),U=(0,Lt.rh)(R,[[0,0,0],[m-S,0,0]]),j=l.customStateMask??Et.jg.None;h.collisionType={type:"disc",direction:[0,0,1],offset:[m,0,0]},h.focusMultiplier=g,h.metadata=l.metadata,h.radius=v,h.renderObjects=[new At.r(M(v,p),Et.Q9.Unfocused|j),new At.r(b,Et.Q9.Unfocused|j),new At.r(M(S,p),Et.Q9.Focused|j),new At.r(U,Et.Q9.Focused|j)]}const Zt=Et.jg.Custom1,Fn=(0,K.Ue)(),_i=(0,K.Ue)(),ti=(0,He.Ue)(),ts=new _e.y;var mt,wr=C(69186),ns=C(72392),Si=C(58817),Ar=C(75618),jt=C(10699),is=C(11426);function ss(h,l,p){const{constraint:g,elevationAlignedStartPoint:m,elevationAlignedEndPoint:v,unconstrainedGeometry:S,view:M}=p,{dimension:P,previousConstraint:R,preConstraintProperties:b}=h;if(null==m||null==v)return;const U=()=>{"startPoint"in l?P.startPoint=l.startPoint:"endPoint"in l&&(P.endPoint=l.endPoint)};if(null==g)U(),null!=R&&null!=b&&(P.measureType=b.measureType,P.orientation=b.orientation);else switch(P.measureType=de.n.Direct,g){case mt.Horizontal:if(g!==R&&(P.orientation=0),"startPoint"in l){const j=l.startPoint;null!=j&&(j.z=v.z),P.startPoint=j}else if("endPoint"in l){const j=l.endPoint;null!=j&&(j.z=m.z),P.endPoint=j}break;case mt.Vertical:if(g!==R&&(P.orientation=Qi(S,M)),"startPoint"in l){const j=l.startPoint;null!=j&&(j.x=v.x,j.y=v.y),P.startPoint=j}else if("endPoint"in l){const j=l.endPoint;null!=j&&(j.x=m.x,j.y=m.y),P.endPoint=j}break;case mt.Direct:g!==R&&null!=b&&(P.orientation=b.orientation),U()}h.previousConstraint=g,h.unconstrainedGeometry=S}!function(h){h[h.Horizontal=0]="Horizontal",h[h.Vertical=1]="Vertical",h[h.Direct=2]="Direct"}(mt||(mt={}));var jr=C(33515),Fe=C(60507),Ct=C(63657),wn=C(7508),ni=C(85072),Ir=C(8834),Wt=C(13777),ii=C(70562),rs=C(75814),Vr=C(23018),Pi=C(65900),as=C(64232);class Gr extends rs.i{constructor(l){super(l),this._ray=(0,ii.Ue)(),this._isWorldDown=!1,this._start=(0,K.Ue)(),this._end=(0,K.al)(1,0,0),this._width=1,this._color=(0,wn.al)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,wn.al)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=Dt.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=be.yD.OccludeAndTransparent,this._fadedExtensions=cs,this._laserline=new Vr.W({view:this.view,isDecoration:l.isDecoration}),this.applyProperties(l)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(l){return{view:l,createResources:p=>this._createObject3DResources(p),destroyResources:p=>this._destroyExternalResources(p),recreateGeometry:(p,g)=>this._recreateObject3DGeometry(p,g),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(l){return{view:l,createResources:()=>this._createDrapedResources(),destroyResources:p=>this._destroyExternalResources(p),recreateGeometry:p=>this._recreateDrapedGeometry(p)}}updateVisibility(l){super.updateVisibility(l),this._laserline.visible=l}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(l){this._isWorldDown=!0,(0,L.c)(this._start,l),this.view.renderCoordsHelper.worldUpAtPosition(l,this._end),(0,L.f)(this._end,l,this._end),(0,ii.zk)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(l){this._isWorldDown=!1,(0,L.j)(this._start,l)||((0,L.c)(this._start,l),(0,ii.zk)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(l){this._isWorldDown=!1,(0,L.j)(this._end,l)||((0,L.c)(this._end,l),(0,ii.zk)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(l){l!==this._width&&(this._width=l,this._updateMaterial())}get color(){return this._color}set color(l){(0,Ct.a)(l,this._color)||((0,Ct.c)(this._color,l),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(l){l!==this._polygonOffset&&(this._polygonOffset=l,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(l){this._writeDepthEnabled!==l&&(this._writeDepthEnabled=l,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(l){l!==this._innerWidth&&(this._innerWidth=l,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(l){(0,Ct.a)(l,this._innerColor)||((0,Ct.c)(this._innerColor,l),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(l){const p=null!=l!=(null!=this._stipplePattern);this._stipplePattern=l,p?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(l){null!=l&&null!=this._stippleOffColor&&(0,Ct.a)(l,this._stippleOffColor)||(this._stippleOffColor=null!=l?(0,wn.d9)(l):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(l){l!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=l,this._updateMaterial())}get falloff(){return this._falloff}set falloff(l){l!==this._falloff&&(this._falloff=l,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(l){l!==this._extensionType&&(this._extensionType=l,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&null!=this._laserlineStyle&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(l){this._laserlineStyle=l,this._laserline.attached=this._laserlineAttached,null!=l&&(this._laserline.style=l)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(l){this._laserlineEnabled!==l&&(this._laserlineEnabled=l,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(l){l!==this._renderOccluded&&(this._renderOccluded=l,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===be.yD.OccludeAndTransparentStencil?be.yD.OccludeAndTransparent:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(l){this._fadedExtensions=l??cs,this.recreateGeometry()}_updateMaterial(){const{materialParameters:l}=this;this.object3dResources.resources?.material.setParameters(l),this.drapedResources.resources?.material.setParameters(l)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration,writeDepth:this._writeDepthEnabled}}_createObject3DResources(l){const p=new Ut.U(this.materialParameters),g=new Array;return this._createObject3DGeometry(p,l,g),{material:p,geometries:g,forEach:m=>{m(p),g.forEach(m)}}}_destroyExternalResources(l){l.geometries=[]}_recreateObject3DGeometry(l,p){l.geometries.length=0,this._createObject3DGeometry(l.material,p,l.geometries)}_createObject3DGeometry(l,p,g){const m=this._createGeometry(l);g.push(m),p.addGeometry(m),this._updateVerticesObject3D(p)}_createDrapedResources(){const l=new Ut.U(this.materialParameters);return{material:l,geometries:[this._createDrapedGeometry(l)]}}_recreateDrapedGeometry(l){l.geometries=[this._createDrapedGeometry(l.material)]}_createDrapedGeometry(l){const p=this._createGeometry(l);return this._updateVerticesDraped(p),new as.z(p)}_createGeometry(l){const p=this.extensionType===Dt.FADED,g=p?[(0,K.Ue)(),(0,K.Ue)(),(0,K.Ue)(),(0,K.Ue)()]:[(0,K.Ue)(),(0,K.Ue)()];return(0,Lt.rh)(l,g,null,p?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const l=this.object3dResources.object;l&&this._updateVerticesObject3D(l)}}_updateVerticesObject3D(l){const p=this._lineSegment;this._updateVertexAttributesObject3D(l,p),this._laserline.intersectsLine=p}_updateVerticesDraped(l){this._updateVertexAttributesDraped(l,this._lineSegment)}get _lineSegment(){return this._extensionType===Dt.FADED?this._updateLineSegmentFinite(os):this._updateLineSegmentInfinite(this._extensionType,os)}_updateLineSegmentFinite(l){return(0,Wt.zk)(this._start,this._end,l)}_updateLineSegmentInfinite(l,p){const g=this.view.state.camera;switch((0,ni.iL)(this._ray,en),l){case Dt.LINE:en.c0=-Number.MAX_VALUE;break;case Dt.RAY:case Dt.GROUND_RAY:{const S=this._ray.origin,M=this.view.elevationProvider.getElevation(S[0],S[1],S[2],this.view.renderCoordsHelper.spatialReference,"ground")??0,P=this.view.renderCoordsHelper.getAltitude(S);this._isWorldDown&&P<M&&(0,L.F)(en.ray.direction,en.ray.direction),this._extensionType===Dt.GROUND_RAY&&null!=M&&(en.c1=Math.abs(P-M));break}}if(!(0,Ir.zq)(g.frustum,en))return this._updateLineSegmentFinite(p);const m=(0,ni.Ws)(en,mn),v=(0,ni.S$)(en,Hr);return(0,Wt.zk)(m,v,p)}_updateVertexAttributesObject3D(l,p){const g=l.geometries[0].getMutableAttribute(qt.T.POSITION)?.data;if(!g)return;let m=0;for(const v of this._lineVertices(p))g[m++]=v[0],g[m++]=v[1],g[m++]=v[2];l.geometryVertexAttributeUpdated(l.geometries[0],qt.T.POSITION)}_updateVertexAttributesDraped(l,p){const g=l.getMutableAttribute(qt.T.POSITION)?.data;if(!g)return;let m=0;for(const v of this._lineVertices(p))g[m++]=v[0],g[m++]=v[1],g[m++]=Pi.gi;l.invalidateBoundingInfo()}*_lineVertices(l){this.extensionType===Dt.FADED?(yield(0,Wt.KU)(l,-this.fadedExtensions.start,mn),yield(0,Wt.KU)(l,0,mn),yield(0,Wt.KU)(l,1,mn),yield(0,Wt.KU)(l,1+this.fadedExtensions.end,mn)):(yield(0,Wt.KU)(l,0,mn),yield(0,Wt.KU)(l,1,mn))}}const en=(0,ni.Ue)(),mn=(0,K.Ue)(),Hr=(0,K.Ue)(),os=(0,Wt.Ue)();var Dt;!function(h){h[h.LINE=0]="LINE",h[h.RAY=1]="RAY",h[h.GROUND_RAY=2]="GROUND_RAY",h[h.FADED=3]="FADED"}(Dt||(Dt={}));const ls=1/3,cs={start:ls,end:ls};var Ie=C(95470),tn=C(15331);class Fr extends rs.i{constructor(l){super(l),this._location=(0,K.Ue)(),this._direction=(0,K.al)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,wn.al)(1,0,1,1),this._renderOccluded=be.yD.OccludeAndTransparent,this.applyProperties(l)}createObject3DResourceFactory(l){return{view:l,createResources:p=>this._createObject3DResources(p),destroyResources:p=>this._destroyObject3DResources(p),recreateGeometry:(p,g)=>this._recreateObject3DGeometry(p,g),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(l){return{view:l,createResources:()=>this._createDrapedResources(),destroyResources:p=>this._destroyDrapedResources(p),recreateGeometry:p=>this._recreateDrapedGeometry(p)}}get location(){return this._location}set location(l){(0,L.j)(this._location,l)||((0,L.c)(this._location,l),this._updateGeometry())}get direction(){return this._direction}set direction(l){(0,L.j)(this._direction,l)||((0,L.c)(this._direction,l),this._updateGeometry())}setDirectionFromPoints(l,p){(0,L.n)(this._direction,(0,L.f)(this._direction,p,l)),this._updateGeometry()}get width(){return this._width}set width(l){l!==this._width&&(this._width=l,this._updateMaterial())}get offset(){return this._offset}set offset(l){l!==this._offset&&(this._offset=l,this._updateGeometry())}get length(){return this._length}set length(l){l!==this._length&&(this._length=l,this._updateGeometry())}get color(){return this._color}set color(l){(0,Ct.a)(l,this._color)||((0,Ct.c)(this._color,l),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(l){l!==this._renderOccluded&&(this._renderOccluded=l,this._updateMaterial())}_createObject3DResources(l){const p=new Ut.U(this.materialParameters),g=new Array;return this._createObject3DGeometry(p,l,g),{material:p,geometries:g,forEach:m=>{m(p),g.forEach(m)}}}_destroyObject3DResources(l){l.geometries.length=0}_recreateObject3DGeometry(l,p){l.geometries.length=0,this._createObject3DGeometry(l.material,p,l.geometries)}_createObject3DGeometry(l,p,g){const[m,v]=this._createGeometries(l);p.addGeometry(m),p.addGeometry(v),g.push(m),g.push(v),this._updateVerticesObject3D(p)}_createDrapedResources(){const l=new Ut.U(this.materialParameters),p=(0,V.YP)(()=>this.view.state.contentPixelRatio,()=>{this.drapedResources.recreateGeometry()});return{material:l,geometries:this._createDrapedGeometry(l),pixelRatioHandle:p}}_destroyDrapedResources(l){l.pixelRatioHandle.remove(),l.geometries=[]}_recreateDrapedGeometry(l){l.geometries=this._createDrapedGeometry(l.material)}_createDrapedGeometry(l){const p=this._createGeometries(l);return this._updateVerticesDraped(p),p.map(g=>new as.z(g))}_createGeometries(l){return[(0,Lt.rh)(l,[(0,K.Ue)(),(0,K.Ue)()]),(0,Lt.rh)(l,[(0,K.Ue)(),(0,K.Ue)()])]}_updateMaterial(){const{materialParameters:l}=this;this.object3dResources.resources?.material.setParameters(l),this.drapedResources.resources?.material.setParameters(l)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const l=this.object3dResources.object;l&&this._updateVerticesObject3D(l)}}_updateVerticesObject3D(l){const p=this.view.state.camera;p.projectToScreen(this.location,ri),(0,L.g)(It,this.location,this.direction),p.projectToScreen(It,An),(0,Ie.Fv)(An,(0,Ie.$X)(An,An,ri)),this._updateVertexAttributesObject3D(p,l,0,ri,An,1),this._updateVertexAttributesObject3D(p,l,1,ri,An,-1)}_updateVertexAttributesObject3D(l,p,g,m,v,S){const M=p.geometries[g],P=M.getMutableAttribute(qt.T.POSITION)?.data;if(!P)return;const{start:R,end:b}=this._computeStartEnd(v,m,S,this.offset,this.width,this.length);l.unprojectFromScreen((0,ot.c$)(R),It),P[0]=It[0],P[1]=It[1],P[2]=It[2],l.unprojectFromScreen((0,ot.c$)(b),It),P[3]=It[0],P[4]=It[1],P[5]=It[2],p.geometryVertexAttributeUpdated(M,qt.T.POSITION)}_updateVerticesDraped(l){const{view:{basemapTerrain:{overlayManager:p},state:{contentPixelRatio:g}}}=this,{location:m,width:v,length:S,offset:M}=this,P=Nr;P.spatialReference=p.renderer.spatialReference,P.x=m[0],P.y=m[1];const R=this.view.overlayPixelSizeInMapUnits(P)*g,b=v*R,U=S*R,j=M*R;this._updateVertexAttributesDraped(l[0],b,U,j,-1),this._updateVertexAttributesDraped(l[1],b,U,j,1)}_updateVertexAttributesDraped(l,p,g,m,v){const S=l.getMutableAttribute(qt.T.POSITION)?.data;if(!S)return;const{location:M,direction:P}=this,{start:R,end:b}=this._computeStartEnd(P,M,v,m,p,g);S[0]=R[0],S[1]=R[1],S[2]=Pi.gi,S[3]=b[0],S[4]=b[1],S[5]=Pi.gi,l.invalidateBoundingInfo()}_computeStartEnd(l,p,g,m,v,S){const M=(0,Ie.bA)(ds,(0,Ie.t8)(ds,l[1]*g,l[0]*-g),m+v/2),P=(0,Ie.IH)(si,(0,Ie.IH)(si,(0,Ie.IH)(si,p,(0,Ie.bA)(si,l,S/2)),M),M);return{start:P,end:(0,Ie.IH)(us,P,(0,Ie.bA)(us,l,-S))}}}const It=(0,K.Ue)(),ds=(0,tn.Ue)(),si=(0,tn.Ue)(),us=(0,tn.Ue)(),ri=(0,ot.s1)(),An=(0,ot.s1)(),Nr=(0,ie.T)(0,0,void 0,null);var hs=C(30693),Zr=C(77603),Mi=C(62600),$=C(21733),ps=C(86810);let Rt=class extends ps.wq{constructor(){super(...arguments),this.enabled=!0}};(0,D._)([(0,T.Cb)({type:Boolean})],Rt.prototype,"enabled",void 0),Rt=(0,D._)([(0,se.j)("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],Rt);let Le=class extends ps.wq{constructor(h){super(h),this.lineSnapper=new Rt,this.parallelLineSnapper=new Rt,this.rightAngleSnapper=new Rt,this.rightAngleTriangleSnapper=new Rt,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new Ye.Z([255,127,0]),this.orangeTransparent=new Ye.Z([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};(0,D._)([(0,T.Cb)({type:Rt,constructOnly:!0,nonNullable:!0,json:{write:!0}})],Le.prototype,"lineSnapper",void 0),(0,D._)([(0,T.Cb)({type:Rt,constructOnly:!0,nonNullable:!0,json:{write:!0}})],Le.prototype,"parallelLineSnapper",void 0),(0,D._)([(0,T.Cb)({type:Rt,constructOnly:!0,nonNullable:!0,json:{write:!0}})],Le.prototype,"rightAngleSnapper",void 0),(0,D._)([(0,T.Cb)({type:Rt,constructOnly:!0,nonNullable:!0,json:{write:!0}})],Le.prototype,"rightAngleTriangleSnapper",void 0),(0,D._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],Le.prototype,"shortLineThreshold",void 0),(0,D._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],Le.prototype,"distance",void 0),(0,D._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],Le.prototype,"pointThreshold",void 0),(0,D._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],Le.prototype,"intersectionParallelLineThreshold",void 0),(0,D._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],Le.prototype,"parallelLineThreshold",void 0),(0,D._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Le.prototype,"verticalLineThresholdMeters",void 0),(0,D._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],Le.prototype,"touchSensitivityMultiplier",void 0),(0,D._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],Le.prototype,"pointOnLineThreshold",void 0),(0,D._)([(0,T.Cb)({type:Ye.Z,nonNullable:!0})],Le.prototype,"orange",void 0),(0,D._)([(0,T.Cb)({type:Ye.Z,nonNullable:!0})],Le.prototype,"orangeTransparent",void 0),(0,D._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],Le.prototype,"lineHintWidthReference",void 0),(0,D._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],Le.prototype,"lineHintWidthTarget",void 0),(0,D._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Le.prototype,"lineHintFadedExtensions",void 0),(0,D._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],Le.prototype,"parallelLineHintWidth",void 0),(0,D._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],Le.prototype,"parallelLineHintLength",void 0),(0,D._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],Le.prototype,"parallelLineHintOffset",void 0),(0,D._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],Le.prototype,"rightAngleHintSize",void 0),(0,D._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],Le.prototype,"rightAngleHintOutlineSize",void 0),(0,D._)([(0,T.Cb)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],Le.prototype,"satisfiesConstraintScreenThreshold",void 0),Le=(0,D._)([(0,se.j)("esri.views.interactive.snapping.Settings.Defaults")],Le);const Ne=new Le;var nt=C(26352),we=C(44725),Ei=C(5286);class ai extends Ei.r{constructor(l,p,g=nt.B.ALL){super(p,g),this.intersectionPoint=l}equals(l){return l instanceof ai&&(0,L.j)(this.intersectionPoint,l.intersectionPoint)}}var Ot=C(62160);class oi extends Ei.r{constructor(l,p,g,m=nt.B.ALL){super(g,m),this.lineStart=l,this.lineEnd=p}equals(l){return l instanceof oi&&(0,L.j)(this.lineStart,l.lineStart)&&(0,L.j)(this.lineEnd,l.lineEnd)}}var Wr=C(19038);class Nn extends Ei.r{constructor(l,p,g,m,v=nt.B.ALL){super(m,v),this.previousVertex=l,this.centerVertex=p,this.nextVertex=g}equals(l){return l instanceof Nn&&(0,L.j)(this.previousVertex,l.previousVertex)&&(0,L.j)(this.centerVertex,l.centerVertex)&&(0,L.j)(this.nextVertex,l.nextVertex)}}class Br{draw(l,p){const g=this._getUniqueHints(l),m=this.sortUniqueHints(g),v=[];for(const S of m)S instanceof ai&&v.push(this.visualizeIntersectionPoint(S,p)),S instanceof Ot.w&&v.push(this.visualizeLine(S,p)),S instanceof oi&&v.push(this.visualizeParallelSign(S,p)),S instanceof Nn&&v.push(this.visualizeRightAngleQuad(S,p)),S instanceof Wr.n&&v.push(this.visualizePoint(S,p));return(0,Z.AL)(v)}sortUniqueHints(l){return l}_getUniqueHints(l){const p=[];for(const g of l){let m=!0;for(const v of p)if(g.equals(v)){m=!1;break}m&&p.push(g)}return p}}var Xe=C(25858);class Kr extends Br{sortUniqueHints(l){return l.sort((p,g)=>(g instanceof Ot.w?g.length:0)-(p instanceof Ot.w?p.length:0))}visualizeIntersectionPoint(l,p){const{spatialReference:g,view:m}=p,v=Zn(p);return(0,Z.ed)(new hs.L({view:m,primitive:"circle",geometry:(0,$.Ju)(l.intersectionPoint,g),elevationInfo:l.isDraped?Fe.tR:Fe.jG,size:20,outlineSize:2,color:v.intersectionPointColor,outlineColor:v.intersectionPointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizePoint(l,p){const{view:g,spatialReference:m}=p,v=Zn(p),S=nn(l.point,l.domain,p);return(0,Z.ed)(new hs.L({view:g,primitive:"circle",geometry:(0,$.Ju)(S,m),elevationInfo:li(l,p),size:20,outlineSize:2,color:v.pointColor,outlineColor:v.pointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizeLine(l,p){const{view:g,spatialReference:m}=p,v=Zn(p),S=nn(l.lineStart,l.domain,p),M=nn(l.lineEnd,l.domain,p);return(0,Z.ed)(this._createLineSegmentHint(l.type,S,M,m,li(l,p),g,v,l.isDraped,l.fadeLeft,l.fadeRight))}visualizeParallelSign(l,p){const{view:g,spatialReference:m}=p,v=Zn(p),{isDraped:S}=l,M=li(l,p),P=nn(l.lineStart,l.domain,p),R=nn(l.lineEnd,l.domain,p),b=vn(P,m,M,g,S),U=vn(R,m,M,g,S),j=(0,L.m)(U,b,U,.5),Y=new Fr({view:g,attached:!1,offset:Ne.parallelLineHintOffset,length:Ne.parallelLineHintLength,width:Ne.parallelLineHintWidth,color:v.parallelSignColor,location:j,renderOccluded:S?be.yD.OccludeAndTransparent:be.yD.Opaque,isDraped:S,renderGroup:Mi.eZ.SnappingHint,isDecoration:!0});return Y.setDirectionFromPoints(b,j),Y.attached=!0,(0,Z.ed)(Y)}visualizeRightAngleQuad(l,p){const{view:g,spatialReference:m}=p,v=Zn(p),S=li(l,p),{isDraped:M}=l,P=nn(l.previousVertex,l.domain,p),R=nn(l.centerVertex,l.domain,p),b=nn(l.nextVertex,l.domain,p),U=vn(P,m,S,g,M),j=vn(R,m,S,g,M),Y=vn(b,m,S,g,M);return(0,Z.ed)(new Zr.R({view:g,attached:!0,color:M?v.rightAngleColorDraped:v.rightAngleColor,renderOccluded:M?be.yD.OccludeAndTransparent:be.yD.Transparent,outlineRenderOccluded:M?be.yD.OccludeAndTransparent:be.yD.Opaque,outlineColor:v.rightAngleOutlineColor,outlineSize:Ne.rightAngleHintOutlineSize,size:Ne.rightAngleHintSize,isDraped:M,geometry:{previous:U,center:j,next:Y},renderGroup:Mi.eZ.SnappingHint,isDecoration:!0}))}_createLineSegmentHint(l,p,g,m,v,S,M,P=!1,R=!0,b=!0){const U=vn(p,m,v,S,P),j=vn(g,m,v,S,P),Y=new Gr({view:S,extensionType:Dt.FADED,start:U,end:j,isDraped:P,color:M.lineColor,renderOccluded:P?be.yD.OccludeAndTransparent:be.yD.Opaque,renderGroup:Mi.eZ.SnappingHint,isDecoration:!0});switch(l){case we.ze.TARGET:Y.width=Ne.lineHintWidthTarget,Y.fadedExtensions={start:0,end:Ne.lineHintFadedExtensions};break;case we.ze.REFERENCE_EXTENSION:Y.width=Ne.lineHintWidthReference,Y.fadedExtensions={start:0,end:0};break;case we.ze.REFERENCE:Y.width=Ne.lineHintWidthReference,Y.fadedExtensions={start:R?Ne.lineHintFadedExtensions:0,end:b?Ne.lineHintFadedExtensions:0}}return Y.attached=!0,Y}}function Zn(h){const{effectiveTheme:l}=h.view,p=Ye.Z.toUnitRGBA(l.accentColor),g=[0,0,0,0];return{intersectionPointColor:g,intersectionPointOutlineColor:p,pointColor:g,pointOutlineColor:p,lineColor:p,lineOutlineColor:void 0,parallelSignColor:p,rightAngleColor:p,rightAngleColorDraped:Ye.Z.toUnitRGBA((0,vi.G)(l.accentColor,.5)),rightAngleOutlineColor:p}}function nn(h,l,p){const g=fs(l,p);return null==g?h:(0,$.Ue)(h[0],h[1],g)}function li(h,l){return null!=fs(h.domain,l)?l.selfSnappingZ.elevationInfo:h.isDraped?Fe.tR:Fe.jG}function fs(h,{selfSnappingZ:l}){return h===nt.B.SELF&&null!=l?l.value:null}function vn(h,l,p,g,m){const v=(0,K.Ue)();return m?(0,Ve.S)(h,l,v,g.basemapTerrain.overlayManager.renderer.spatialReference):(0,Xe.RS)(h,l,p,g,v),v}var yn=C(87469),gs=C(53928),Yr=C(79112),ms=C(36344),kr=C(81468),vs=C(42743),ys=C(81040);class Qr extends gs._{constructor(l){super(l),this.view=null,this._renderOccluded=be.yD.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=(0,Jt.nI)([1,127/255,0,1]),this._size=11,this._outlineColor=(0,Jt.nI)([0,0,0,.5]),this._outlineSize=1,this._elevationInfo=null,this.applyProperties(l)}get renderOccluded(){return this._renderOccluded}set renderOccluded(l){l!==this._renderOccluded&&(this._renderOccluded=l,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(l){this._vertices=l,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(l){this._spatialReference=l,this.recreateGeometry()}get color(){return this._color}set color(l){(0,Ct.a)(l,this._color)||((0,Ct.c)(this._color,l),this._updateMaterial())}get size(){return this._size}set size(l){l!==this._size&&(this._size=l,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(l){(0,Ct.a)(l,this._outlineColor)||((0,Ct.c)(this._outlineColor,l),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(l){l!==this._outlineSize&&(this._outlineSize=l,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(l){this._elevationInfo=l,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,screenSizeScale:this.size,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const l=this.vertices;if(null==l||0===l.length)return[];const m=function Xr(h,l,p,g,m){const v=(0,ms.bg)(3*h.length),S=(0,ms.bg)(v.length);h.forEach((R,b)=>{v[3*b]=R[0],v[3*b+1]=R[1],v[3*b+2]=R.length>2?R[2]:0});const M=(0,kr.rR)(v,l,0,S,0,v,0,v.length/3,p,g,m);return{numVertices:h.length,position:v,mapPositions:S,projectionSuccess:null!=M,sampledElevation:M}}(l,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,Yr.o.fromElevationInfo(this.elevationInfo)),v=[],S=m.numVertices,M=m.position;for(let P=0;P<S;++P){const R=(0,L.s)($r,M[3*P],M[3*P+1],M[3*P+2]),b=_s(this._vertexMaterial,.5,R),U=_s(this._vertexOutlineMaterial,.5,R);v.push({vertexGeometry:b,vertexOutlineGeometry:U})}return v}createGeometries(l){const p=this._createRenderGeometries();for(const{vertexGeometry:g,vertexOutlineGeometry:m}of p)l.addGeometry(g),l.addGeometry(m)}createExternalResources(){this._vertexMaterial=new ys.Q({...this._vertexMaterialParameters,writeDepth:!0,cullFace:vs.Vr.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new ys.Q({...this._vertexOutlineMaterialParameters,forceTransparentMode:!0,writeDepth:!0,cullFace:vs.Vr.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(l){l(this._vertexMaterial),l(this._vertexOutlineMaterial)}}const $r=(0,K.Ue)();function _s(h,l,p){return(0,Lt.PI)(h,l,16,16,{offset:p})}var ci=C(54889),Jr=C(50017),qr=C(466),ea=C(97737),ta=C(79682),sn=C(46160);let rn=class extends X.Z{constructor(h){super(h),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new sn.Z}};(0,D._)([(0,T.Cb)({constructOnly:!0})],rn.prototype,"layer",void 0),(0,D._)([(0,T.Cb)()],rn.prototype,"enabled",void 0),(0,D._)([(0,T.Cb)()],rn.prototype,"updating",void 0),(0,D._)([(0,T.Cb)()],rn.prototype,"availability",void 0),(0,D._)([(0,T.Cb)()],rn.prototype,"sublayerSources",void 0),rn=(0,D._)([(0,se.j)("esri.views.interactive.snapping.FeatureSnappingLayerSource")],rn);const Ci=rn;var na=C(85931);let $e=class extends X.Z{constructor(h){super(h),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new sn.Z,this.distance=Ne.distance,this.touchSensitivityMultiplier=Ne.touchSensitivityMultiplier,this.constraintsActive=!1}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){const h=this.featureSources;h.some(Ps)&&G.Z.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const l=h.filter(sa),p=this._get("_effectiveFeatureSources")?.filter(Ps)??new sn.Z;for(const M of l){const P=p.find(R=>R.layer===M.layer.parent);if(P)P.sublayerSources.includes(M)||P.sublayerSources.add(M);else if(M.layer.parent){const R=new Ci({layer:M.layer.parent});R.sublayerSources.add(M),p.add(R)}}for(const M of p){const P=M.sublayerSources.filter(R=>!l.includes(R));M.sublayerSources.removeMany(P)}p.removeMany(p.filter(M=>0===M.sublayerSources.length));const g=h.filter(ia),m=this._get("_effectiveFeatureSources")??new sn.Z,{added:v,removed:S}=(0,na.e5)(m.toArray(),[...g,...p]);return m.removeMany(S),m.addMany(v),m}};(0,D._)([(0,T.Cb)()],$e.prototype,"enabled",void 0),(0,D._)([(0,T.Cb)()],$e.prototype,"enabledToggled",void 0),(0,D._)([(0,T.Cb)()],$e.prototype,"forceDisabled",void 0),(0,D._)([(0,T.Cb)()],$e.prototype,"selfEnabled",void 0),(0,D._)([(0,T.Cb)()],$e.prototype,"featureEnabled",void 0),(0,D._)([(0,T.Cb)({type:sn.Z.ofType(Ci)})],$e.prototype,"featureSources",void 0),(0,D._)([(0,T.Cb)()],$e.prototype,"distance",void 0),(0,D._)([(0,T.Cb)()],$e.prototype,"touchSensitivityMultiplier",void 0),(0,D._)([(0,T.Cb)()],$e.prototype,"constraintsActive",void 0),(0,D._)([(0,T.Cb)({readOnly:!0})],$e.prototype,"effectiveEnabled",null),(0,D._)([(0,T.Cb)({readOnly:!0})],$e.prototype,"effectiveSelfEnabled",null),(0,D._)([(0,T.Cb)({readOnly:!0})],$e.prototype,"effectiveFeatureEnabled",null),(0,D._)([(0,T.Cb)({readOnly:!0})],$e.prototype,"_effectiveFeatureSources",null),$e=(0,D._)([(0,se.j)("esri.views.interactive.snapping.SnappingOptions")],$e);const Ss=$e;function Ps(h){return"subtype-group"===h.layer.type}function ia(h){return"subtype-group"!==h.layer.type}function sa(h){return"subtype-sublayer"===h.layer.type}var aa=C(86670),Ln=C(55475),Ms=C(95737),di=C(98624),oa=C(59990),_n=C(72469),la=C(93579);let vt=class extends X.Z{get layerView(){return this.view?.allLayerViews?.find(h=>h.layer===this.layer)}get valid(){return this._valid}get subtypeFilter(){const{layer:h,snappingSource:l}=this;if(!(0,_n.e9)(h)||!h.subtypes?.length)return{mode:"not-in-use",filter:null};const p=l.layerSource.sublayerSources.filter(m=>m.enabled&&m.layer.visible&&(0,la.rs)(this.view?.scale,m.layer.effectiveScaleRange.minScale,m.layer.effectiveScaleRange.maxScale)).map(m=>m.layer.subtypeCode);if(!p.length)return{mode:"none-visible",filter:null};if(p.length===h.subtypes.length)return{mode:"all-visible",filter:null};const g=h.fieldsIndex.get(h.subtypeField)?.name??h.subtypeField;return 1===p.length?{mode:"in-use",filter:`${g} = ${p.getItemAt(0)}`}:{mode:"in-use",filter:`${g} IN (${p.join(", ")})`}}get floorFilter(){const{view:h,layer:l}=this;return h&&l?(0,oa.c)({view:h,layer:l}):null}constructor(h){super(h),this.rulesTable=null,this._valid=!1}initialize(){if(!this.snappingSource||!this.layer)return;const{layer:h,snappingSource:l}=this;"refresh"in h&&this.addHandles(h.on("refresh",()=>l.refresh())),this.loadRules(),this.addHandles([(0,V.YP)(()=>l.updating,p=>l.layerSource.updating=p,V.tX),(0,V.YP)(()=>l.availability,p=>l.layerSource.availability=p,V.tX)])}getFetchCandidatesParameters(h,l,p){if(!this.valid)return[];const{layer:g,layerView:m,floorFilter:v,rulesTable:S,subtypeFilter:M}=this,P={distance:p,mode:this.view?.type??"2d",point:h,coordinateHelper:l.coordinateHelper,...this._types,filter:m&&"filter"in m?m.filter:null};if(v&&(P.filter=Di(P.filter,v)),"not-in-use"!==M.mode&&"all-visible"!==M.mode){if("none-visible"===M.mode)return[];P.filter?P.filter.where=(0,Ms._)(P.filter.where,M.mode):P.filter=new di.Z({where:M.filter})}const R=l.feature,b="subtype-sublayer"===R?.sourceLayer?.type?R.sourceLayer.parent:R?.sourceLayer;if(S&&R&&(0,we.n0)(this.view?.map)&&((0,_n.Te)(g)||(0,_n.e9)(g))&&g.layerId&&((0,_n.Te)(b)||(0,_n.e9)(b))&&this.view.map.utilityNetworks?.find(U=>U.isUtilityLayer(b))){if("loaded"!==S.loadStatus)return[];const U=[],j=g.layerId,Y=S.getFeatureSQL(b,R)?.[j];if(!Y)return[];const le=Y.anyVertex;let me=Y.endVertex;return me&&le&&me===le&&(me=""),me&&U.push({...P,returnEdge:!1,vertexMode:"ends",filter:Di(P.filter,me)}),le&&U.push({...P,returnEdge:!1,vertexMode:"all",filter:Di(P.filter,le)}),U}return[P]}loadRules(){var h=this;return(0,ne.Z)(function*(){const{layer:l,view:p}=h;if(l&&p&&(0,we.n0)(p?.map)&&((0,_n.Te)(l)||(0,_n.e9)(l))){const g=p.map.utilityNetworks?.find(m=>m.isUtilityLayer(l));if(g)try{h.rulesTable=yield g.getRulesTable(),yield h.rulesTable?.load()}catch{return void G.Z.getLogger("esri.views.interactive.snapping.FeatureSnappingSourceInfo").error("Failed to load rules table for snapping source",l.title)}}h._valid=!0})()}get _types(){return{returnEdge:!0,vertexMode:"all"}}remove(){this.destroy()}destroy(){this.snappingSource?.destroy()}};function Di(h,l){return new di.Z(null==h?{where:l}:h.where?{where:(0,Ms._)(h.where,l)}:{where:l})}(0,D._)([(0,T.Cb)({constructOnly:!0})],vt.prototype,"layer",void 0),(0,D._)([(0,T.Cb)({constructOnly:!0})],vt.prototype,"snappingSource",void 0),(0,D._)([(0,T.Cb)({constructOnly:!0})],vt.prototype,"view",void 0),(0,D._)([(0,T.Cb)()],vt.prototype,"layerView",null),(0,D._)([(0,T.Cb)()],vt.prototype,"rulesTable",void 0),(0,D._)([(0,T.Cb)()],vt.prototype,"valid",null),(0,D._)([(0,T.Cb)()],vt.prototype,"subtypeFilter",null),(0,D._)([(0,T.Cb)()],vt.prototype,"floorFilter",null),(0,D._)([(0,T.Cb)()],vt.prototype,"_valid",void 0),vt=(0,D._)([(0,se.j)("esri.views.interactive.snapping.FeatureSnappingSourceInfo")],vt);var Un,ca=C(61430),Es=C(75897),da=C(97979),Wn=C(22823);class Ri extends Wn.j{constructor({targetPoint:l,constraint:p,previousVertex:g,otherVertex:m,otherVertexType:v,objectId:S,isDraped:M}){super(l,p,M,nt.B.SELF),this.previousVertex=g,this.otherVertex=m,this.otherVertexType=v,this.objectId=S}get hints(){const l=this.previousVertex,p=this.otherVertexType===Un.CENTER?this.otherVertex:this.targetPoint,g=this.otherVertexType===Un.CENTER?this.targetPoint:this.otherVertex;return[new Ot.w(we.ze.TARGET,p,g,this.isDraped,this.domain),new Ot.w(we.ze.REFERENCE,l,p,this.isDraped,this.domain),new Nn(this.previousVertex,p,g,this.isDraped,this.domain)]}}!function(h){h[h.NEXT=0]="NEXT",h[h.CENTER=1]="CENTER"}(Un||(Un={}));let Bt=class extends X.Z{get updating(){return this._snappingSources.some(h=>null==h||h.valid&&h.snappingSource.updating)||this._updatingHandles.updating}constructor(h){super(h),this.options=null,this._domain=nt.B.FEATURE,this._updatingHandles=new is.R,this._sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null},notes:{module:null,loader:null},scene:{module:null,loader:null}}}initialize(){const h=(0,V.TP)(()=>this.options?._effectiveFeatureSources,(l,p)=>this._createSourceInfo(l,p));this._snappingSources=h,this.addHandles((0,Z.ed)(h))}destroy(){this._set("options",null),this._updatingHandles.destroy()}fetchCandidates(h,l,p,g){var m=this;return(0,ne.Z)(function*(){if(!(l&m._domain&&null!=m.options&&m.options.effectiveFeatureEnabled))return[];const v=[],S=m._computeScreenSizeDistanceParameters(h,p);for(const P of m._snappingSources){if(null==P||!P.valid||!P.snappingSource.layerSource.enabled||P.layerView?.suspended)continue;const R=P.getFetchCandidatesParameters(h,p,S);for(const b of R)v.push(P.snappingSource.fetchCandidates(b,g).then(U=>U.filter(j=>!m._candidateIsExcluded(P.snappingSource,j,p.excludeFeature))))}const M=(yield(0,jt.OT)(v)).flat();return m._addRightAngleCandidates(M,h,S,p),(0,jt.k_)(g),(0,we.lQ)(h,M),M})()}_addRightAngleCandidates(h,l,p,g){const m=null!=g.vertexHandle?g.vertexHandle.rightEdge?.rightVertex?.pos:null!=g.editGeometryOperations&&"polygon"===g.editGeometryOperations.data.type?g.editGeometryOperations.data.components[0]?.getFirstVertex()?.pos:null,v=null!=g.vertexHandle?g.vertexHandle.leftEdge?.leftVertex?.pos:null!=g.editGeometryOperations?g.editGeometryOperations.data.components[0]?.getLastVertex()?.pos:null,{view:S}=this,M=(0,$.j7)(m,S,g),P=(0,$.j7)(v,S,g),R=h.length;for(let b=0;b<R;b++)this._addRightAngleCandidate(h[b],P,l,p,h),this._addRightAngleCandidate(h[b],M,l,p,h)}_addRightAngleCandidate(h,l,p,g,m){if(null==l||!function ua(h){return(h instanceof Es.L||h instanceof ca.k)&&!function ha({constraint:{start:h,end:l}}){const p=(0,L.a)(h,l),g=(0,Ie.bI)((0,$.eR)(h),(0,$.eR)(l));return p<(0,aa.bn)()||g/p<fa}(h)}(h))return;const v=h.constraint.closestTo(l),S=(v[0]-p[0])/g.x,M=(v[1]-p[1])/g.y,{start:P,end:R}=h.constraint;if(S*S+M*M<=1){const b=new Ri({targetPoint:v,otherVertex:l,otherVertexType:Un.NEXT,previousVertex:(0,Ie.bI)((0,$.eR)(v),(0,$.eR)(P))>(0,Ie.bI)((0,$.eR)(v),(0,$.eR)(R))?P:R,constraint:new Ln.aU(l,v),objectId:h.objectId,isDraped:h.isDraped});m.push(b)}}_computeScreenSizeDistanceParameters(h,l){let p=null!=this.options?this.options.distance*("touch"===l.pointer?this.options.touchSensitivityMultiplier:1):0;return null==this.view?{x:p,y:p,z:p,distance:p}:"2d"===this.view.type?(p*=this.view.resolution,{x:p,y:p,z:p,distance:p}):this._computeScreenSizeDistanceParameters3D(h,p,this.view,l)}_computeScreenSizeDistanceParameters3D(h,l,p,g){const{spatialReference:m}=g;p.renderCoordsHelper.toRenderCoords(h,m,Cs);const v=p.state.camera.computeScreenPixelSizeAt(Cs),S=v*p.renderCoordsHelper.unitInMeters,M=S/(0,ee.c9)(m),P=S/(0,ee._R)(m),R=l*M,b=l*P,U=(0,Xe.Rs)(h,m,Fe.jG,p),j=U?Oi(U,h,M,0,0,p,g):0,Y=U?Oi(U,h,0,M,0,p,g):0,le=U?Oi(U,h,0,0,P,p,g):0;return{x:0===j?0:R/j,y:0===Y?0:R/Y,z:0===le?0:b/le,distance:v*l}}_candidateIsExcluded(h,l,p){if(null==p)return!1;const g=this._getCandidateObjectId(l);if(null==g)return!1;const m=h.layerSource.layer;return"graphics"===m.type?p.uid===g:p.sourceLayer===m&&!(!p.attributes||!("objectIdField"in m))&&p.attributes[m.objectIdField]===g}_getCandidateObjectId(h){return h instanceof da.a?h.objectId:null}_createSourceInfo(h,l){var p=this;return(0,ne.Z)(function*(){const g=h.layer;g.loaded||(yield g.load(),(0,jt.k_)(l));const{view:m}=p,v=yield p._createFeatureSnappingSourceType(h);return(0,jt.k_)(l),new vt(null==v?{}:{snappingSource:v,view:m,layer:g})})()}_createFeatureSnappingSourceType(h){var l=this;return(0,ne.Z)(function*(){switch(h.layer.type){case"feature":case"geojson":case"csv":case"oriented-imagery":case"subtype-group":case"wfs":return l._createFeatureSnappingSourceFeatureLayer(h);case"graphics":return l._createFeatureSnappingSourceGraphicsLayer(h);case"map-notes":return l._createFeatureSnappingSourceMapNotesLayer(h);case"scene":case"building-scene":return l._createFeatureSnappingSourceSceneLayer(h)}return null})()}_createFeatureSnappingSourceSceneLayer(h){var l=this;return(0,ne.Z)(function*(){const{view:p}=l;return null==p||"3d"!==p.type?null:new((yield l._getSourceModule("scene")).SceneLayerSnappingSource)({layerSource:h,view:p})})()}_createFeatureSnappingSourceFeatureLayer(h){var l=this;return(0,ne.Z)(function*(){switch(h.layer.source?.type){case"feature-layer":case"oriented-imagery":return new((yield l._getSourceModule("featureService")).FeatureServiceSnappingSource)({spatialReference:l.spatialReference,view:l.view,layerSource:h});case"memory":case"csv":case"geojson":case"wfs":return"mesh"===h.layer.geometryType?null:new((yield l._getSourceModule("featureCollection")).FeatureCollectionSnappingSource)({layerSource:h,view:l.view})}return null})()}_createFeatureSnappingSourceGraphicsLayer(h){var l=this;return(0,ne.Z)(function*(){return new((yield l._getSourceModule("graphics")).GraphicsSnappingSource)({getGraphicsLayers:()=>[h.layer],spatialReference:l.spatialReference,view:l.view,layerSource:h})})()}_createFeatureSnappingSourceMapNotesLayer(h){var l=this;return(0,ne.Z)(function*(){return new((yield l._getSourceModule("notes")).GraphicsSnappingSource)({getGraphicsLayers:()=>h.layer.sublayers?.toArray()??[],spatialReference:l.spatialReference,view:l.view,layerSource:h})})()}_getSourceModule(h){var l=this;return(0,ne.Z)(function*(){const p=l._sourceModules[h];if(null==p.loader){const g=l._loadSourceModule(h);l._sourceModules[h]={module:null,loader:g};const v=yield g;return l._sourceModules[h]={module:v,loader:g},v}return null==p.module?p.loader:p.module})()}_loadSourceModule(h){const l=this._updatingHandles;switch(h){case"featureService":return l.addPromise(Promise.all([C.e(8592),C.e(8740)]).then(C.bind(C,78740)));case"featureCollection":return l.addPromise(Promise.all([C.e(8592),C.e(8176)]).then(C.bind(C,78176)));case"graphics":case"notes":return l.addPromise(Promise.all([C.e(337),C.e(2507),C.e(774),C.e(6072),C.e(7758),C.e(8592),C.e(6269)]).then(C.bind(C,66269)));case"scene":return l.addPromise(Promise.all([C.e(8592),C.e(7566)]).then(C.bind(C,57566)))}}get test(){return{snappingSources:this._snappingSources}}};function Oi(h,l,p,g,m,v,{spatialReference:S}){const M=(0,L.c)(pa,l);M[0]+=p,M[1]+=g,M[2]+=m;const P=(0,Xe.Rs)(M,S,Fe.jG,v);return P?(0,we.fG)(P,h):1/0}(0,D._)([(0,T.Cb)({constructOnly:!0})],Bt.prototype,"spatialReference",void 0),(0,D._)([(0,T.Cb)({constructOnly:!0})],Bt.prototype,"view",void 0),(0,D._)([(0,T.Cb)()],Bt.prototype,"options",void 0),(0,D._)([(0,T.Cb)({readOnly:!0})],Bt.prototype,"updating",null),(0,D._)([(0,T.Cb)()],Bt.prototype,"_snappingSources",void 0),Bt=(0,D._)([(0,se.j)("esri.views.interactive.snapping.FeatureSnappingEngine")],Bt);const Cs=(0,K.Ue)(),pa=(0,K.Ue)(),fa=1e-4;var xt,ga=C(61885),xi=C(55915);class ui{constructor(l,p){this.view=l,this.options=p,this.squaredShortLineThreshold=Ne.shortLineThreshold*Ne.shortLineThreshold}snap(l,p){return null!=p.vertexHandle?"vertex"!==p.vertexHandle.type?[]:this.snapExistingVertex(l,p):this.snapNewVertex(l,p)}edgeExceedsShortLineThreshold(l,p){return this.exceedsShortLineThreshold((0,$.j7)(l.leftVertex.pos,this.view,p),(0,$.j7)(l.rightVertex.pos,this.view,p),p)}exceedsShortLineThreshold(l,p,{spatialReference:g}){return 0===this.squaredShortLineThreshold||(0,we.Bb)((0,Xe.Rs)(p,g,Fe.jG,this.view),(0,Xe.Rs)(l,g,Fe.jG,this.view))>this.squaredShortLineThreshold}isVertical(l,p,{spatialReference:g}){const m=(0,ee.c9)(g);return(0,Ie.TE)((0,$.eR)(l),(0,$.eR)(p))*m<Ne.verticalLineThresholdMeters}squaredProximityThreshold(l){return"touch"===l?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:l,touchSensitivityMultiplier:p}=this.options,g=l*p;return g*g}}class Ds extends Wn.j{constructor({lineStart:l,lineEnd:p,targetPoint:g,isDraped:m}){super(g,new Ln.jg(l,p),m,nt.B.SELF),this._referenceLineHint=new Ot.w(we.ze.REFERENCE_EXTENSION,l,p,m,this.domain)}get hints(){return[this._referenceLineHint,new Ot.w(we.ze.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}}!function(h){h.Absolute="absolute",h.Relative="relative",h.RelativeBilateral="relative-bilateral"}(xt||(xt={})),(0,K.Ue)(),(0,K.Ue)();const Bn=(()=>{const h=(0,tn.Ue)(),l=(0,K.Ue)(),p=(0,K.Ue)();return(g,m,v,S)=>{if((0,L.j)(g,m))return;const M=(0,xe.Lc)(v),P=(0,xe.Lc)(S);if(M&&P&&(0,Ae.fS)(M,P)&&(0,Ve.S)(g,v,l,M)&&(0,Ve.S)(m,S,p,P)){const{azimuth:b}=(0,xe.cA)(va,l,p,M);return null!=b?(0,ee.En)(b,"degrees","radians"):void 0}h[0]=m[0]-g[0],h[1]=m[1]-g[1];let R=(0,Ie.EU)(tn.IO,h);return h[0]<0&&(R=ya-R),R}})(),xs=(()=>{const h=(0,K.Ue)();return(l,p,g,m,v,S="geodesic")=>{(0,L.c)(h,p);const M=function Ts(h){return null!=h?(0,fe.hw)((0,ee.En)(h.value,h.unit,"degrees"),h.rotationType,"geographic"):void 0}(v);if("geodesic"===S){const Y=(0,xe.Lc)(g);if(Y&&(0,Ve.S)(h,g,h,Y))return(0,xe.TB)(l,h,M,m,Y),l[2]=p[2],!!(0,Ve.S)(l,Y,l,g)}const P=(0,fe.hw)(M,"geographic","arithmetic"),R=(0,ee.En)(P,"degrees","radians"),b=p[0]+m*Math.cos(R),U=p[1]+m*Math.sin(R);return(0,L.s)(l,b,U,p[2]),!0}})();const va=new xe._q,ya=2*Math.PI;new fn.pE(-180,180);var Sa=C(26362),Kn=C(396);class Pa extends ui{snapNewVertex(l,p){const g=p.editGeometryOperations.data.components[0],m=g.edges.length,v=[];if(m<1)return v;const{spatialReference:S}=p,M=(0,Xe.Rs)(l,S,Fe.jG,this.view),{view:P}=this,R=g.edges[m-1];let b=R;do{if(this.edgeExceedsShortLineThreshold(b,p)){const U=(0,we._j)(b,P,p);this._processCandidateProposal(U.left,U.right,l,M,p,v)}b=b.leftVertex.leftEdge}while(b&&b!==R);return v}snapExistingVertex(l,p){const g=[],m=p.vertexHandle,v=m.component;if(v.edges.length<2)return g;const{view:S}=this,{spatialReference:M}=p,P=(0,Xe.Rs)(l,M,Fe.jG,S),R=m.leftEdge,b=m.rightEdge;R&&b&&this.edgeExceedsShortLineThreshold(R,p)&&this.edgeExceedsShortLineThreshold(b,p)&&this._processCandidateProposal((0,$.j7)(R.leftVertex.pos,S,p),(0,$.j7)(b.rightVertex.pos,S,p),l,P,p,g);const U=v.edges[0];let j=U;do{if(j!==m.leftEdge&&j!==m.rightEdge&&this.edgeExceedsShortLineThreshold(j,p)){const Y=(0,we._j)(j,S,p);this._processCandidateProposal(Y.left,Y.right,l,P,p,g)}j=j.rightVertex.rightEdge}while(j&&j!==U);return g}_processCandidateProposal(l,p,g,m,v,S){const{spatialReference:M,pointer:P}=v,R=(0,K.Ue)();this._projectedLine(R,l,p,g,v);const b=(0,$.uo)(R);(0,we.Bb)(m,(0,Xe.Rs)(b,M,Fe.jG,this.view))<this.squaredProximityThreshold(P)&&S.push(new Ds({lineStart:l,lineEnd:p,targetPoint:b,isDraped:"on-the-ground"===v.elevationInfo?.mode}))}_projectedLine(l,p,g,m,v){this._projectToLineGeodesic(l,p,g,m,v)||this._projectToLinePlanar(l,m,p,g)}_projectToLineGeodesic(l,p,g,m,{spatialReference:v}){const S=Bn(p,g,v,v);if(null==S)return!1;const M=Bn(g,m,v,v);if(null==M)return!1;const P=Xt(g,m,v);if(null==P)return!1;const R=Math.abs(fn.Q4.shortestSignedDiff(S,M))>Math.PI/2?fn.c5.normalize(S+Math.PI):S;return xs(l,g,v,(0,fe.mE)(P,"meters"),(0,fe.GJ)(R,"radians","geographic"),"geodesic"),l[2]=m[2],!0}_projectToLinePlanar(l,p,g,m){(0,Sa.ZE)(p,{start:g,end:m,type:Kn.SP.LINE},l),l[2]=p[2]}}class ws extends Wn.j{constructor({referenceLine:l,lineStart:p,targetPoint:g,isDraped:m}){const v=(0,K.d9)(p),{left:S,right:M}=l;(0,L.f)(v,(0,L.g)(v,v,M),S),super(g,new Ln.jg(p,(0,$.uo)(v)),m,nt.B.SELF),this._referenceLines=[{edge:l,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new Ot.w(we.ze.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new oi(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(l=>new Ot.w(we.ze.REFERENCE,l.edge.left,l.edge.right,this.isDraped,this.domain,l.fadeLeft,l.fadeRight))]}addReferenceLine(l){const p={edge:l,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(g=>{(0,L.j)(l.right,g.edge.left)&&(g.fadeLeft=!1,p.fadeRight=!1),(0,L.j)(l.right,g.edge.right)&&(g.fadeRight=!1,p.fadeRight=!1),(0,L.j)(l.left,g.edge.right)&&(g.fadeRight=!1,p.fadeLeft=!1),(0,L.j)(l.left,g.edge.left)&&(g.fadeLeft=!1,p.fadeLeft=!1)}),this._referenceLines.push(p)}}class Ma extends ui{snapNewVertex(l,p){const g=p.editGeometryOperations.data.components[0],m=g.edges.length,v=g.vertices.length,S=[];if(m<2)return S;const{view:M}=this,P=(0,Xe.Rs)(l,p.spatialReference,Fe.jG,M),R=(0,$.j7)(g.vertices[v-1].pos,M,p),b=(0,$.j7)(g.vertices[0].pos,M,p),U=g.edges[m-1];let j=U;do{if(this.edgeExceedsShortLineThreshold(j,p)){const Y=(0,we._j)(j,M,p);this._checkEdgeForParallelLines(Y,R,l,P,p,S),this._checkEdgeForParallelLines(Y,b,l,P,p,S)}j=j.leftVertex.leftEdge}while(j&&j!==U);return S}snapExistingVertex(l,p){const g=[],m=p.vertexHandle,v=m.component;if(v.edges.length<3)return g;const{view:S}=this,M=(0,Xe.Rs)(l,p.spatialReference,Fe.jG,S),P=m.leftEdge,R=m.rightEdge,b=v.vertices[0],U=(0,$.j7)(b.pos,S,p),Y=v.vertices[v.vertices.length-1],le=(0,$.j7)(Y.pos,S,p),me=v.edges[0];let Me=me;do{if(Me!==P&&Me!==R&&this.edgeExceedsShortLineThreshold(Me,p)){const ke=(0,we._j)(Me,S,p);P&&this._checkEdgeForParallelLines(ke,(0,$.j7)(P.leftVertex.pos,S,p),l,M,p,g),R&&this._checkEdgeForParallelLines(ke,(0,$.j7)(R.rightVertex.pos,S,p),l,M,p,g),m===b?this._checkEdgeForParallelLines(ke,le,l,M,p,g):m===Y&&this._checkEdgeForParallelLines(ke,U,l,M,p,g)}Me=Me.rightVertex.rightEdge}while(Me&&Me!==me);return g}_checkEdgeForParallelLines(l,p,g,m,v,S){const M=l.left,P=l.right;if((0,Kn.k0)(Sn,(0,$.eR)(p),(0,$.eR)(M),(0,$.eR)(P)),(0,Ie.bI)(Sn,(0,$.eR)(p))<Ne.parallelLineThreshold)return;(0,Kn.k0)(Sn,(0,$.eR)(g),(0,$.eR)(M),(0,$.eR)(P),(0,$.eR)(p));const{spatialReference:R,pointer:b}=v,U=(0,$.al)(Sn[0],Sn[1],g[2]);if((0,we.Bb)(m,(0,Xe.Rs)(U,R,Fe.jG,this.view))<this.squaredProximityThreshold(b)){if(this.isVertical(U,p,v)||this.isVertical(M,P,v)||this._parallelToPreviousCandidate(l,S))return;S.push(new ws({referenceLine:l,lineStart:p,targetPoint:U,isDraped:"on-the-ground"===v.elevationInfo?.mode}))}}_parallelToPreviousCandidate(l,p){const g=l.left,m=l.right;for(const v of p)if((0,Kn.k0)(Sn,(0,$.eR)(m),(0,$.eR)(v.constraint.start),(0,$.eR)(v.constraint.end),(0,$.eR)(g)),(0,Ie.bI)(Sn,(0,$.eR)(m))<Ne.parallelLineThreshold)return v.addReferenceLine(l),!0;return!1}}const Sn=(0,tn.Ue)();class Ea extends ui{snapNewVertex(l,p){const g=p.editGeometryOperations.data.components[0],m=[];if(g.vertices.length<2)return m;const{view:v}=this,S=(0,Xe.Rs)(l,p.spatialReference,Fe.jG,v),M=g.vertices.at(-1);this._checkForSnappingCandidate(m,M.leftEdge,M,M.leftEdge.leftVertex,l,S,p);const P=g.vertices[0];return this._checkForSnappingCandidate(m,P.rightEdge,P,P.rightEdge.rightVertex,l,S,p),m}snapExistingVertex(l,p){const g=[],m=p.vertexHandle;if(m.component.vertices.length<3)return g;const{view:v}=this,S=(0,Xe.Rs)(l,p.spatialReference,Fe.jG,v),M=m.leftEdge,P=m.rightEdge;if(M?.leftVertex.leftEdge){const R=M.leftVertex.leftEdge;this._checkForSnappingCandidate(g,R,R.rightVertex,R.leftVertex,l,S,p)}if(P?.rightVertex.rightEdge){const R=P.rightVertex.rightEdge;this._checkForSnappingCandidate(g,R,R.leftVertex,R.rightVertex,l,S,p)}return g}_checkForSnappingCandidate(l,p,g,m,v,S,M){if(!this.edgeExceedsShortLineThreshold(p,M))return;const P=this.view,R=(0,$.j7)(g.pos,P,M),b=(0,$.j7)(m.pos,P,M);this._checkForSnappingCandidateNormalized(l,b,R,v,S,M)}_checkForSnappingCandidateNormalized(l,p,g,m,v,S){this._projectionRay(As,p,g,m,S),this._checkForSnappingCandidateAlongProjectedRay(l,p,g,As,m,v,S)}_projectionRay(l,p,g,m,v){this._projectionRayGeodesic(l,p,g,m,v)||this._projectionRayPlanar(l,p,g)}_projectionRayGeodesic(l,p,g,m,{spatialReference:v}){const S=Bn(p,g,v,v);if(null==S)return!1;const M=Bn(g,m,v,v);if(null==M)return!1;const P=Math.sign(fn.c5.shortestSignedDiff(S,M))*Math.PI*.5,R=(0,fe.GJ)(S+P,"radians","geographic"),b=(0,K.Ue)(),U=Xt(g,m,v);return null!=U&&(xs(b,g,v,(0,fe.mE)(U,"meters"),R,"geodesic"),(0,L.f)(l,b,g),!0)}_projectionRayPlanar(l,p,g){const m=(0,Ie.$X)(bi,(0,$.eR)(g),(0,$.eR)(p));(0,L.s)(l,m[1],-m[0],0)}_checkForSnappingCandidateAlongProjectedRay(l,p,g,m,v,S,M){const{spatialReference:P,pointer:R}=M,b=(0,Ie.$X)(bi,(0,$.eR)(v),(0,$.eR)(g)),U=(0,Ie.AK)(m,b)/(0,Ie.we)(m),j=(0,Ie.od)(bi,(0,$.eR)(g),m,U),Y=(0,$.al)(j[0],j[1],v[2]);if((0,we.Bb)(S,(0,Xe.Rs)(Y,P,Fe.jG,this.view))>this.squaredProximityThreshold(R)||this.isVertical(Y,g,M)||this.isVertical(g,p,M))return;const le=(0,L.r)((0,K.Ue)(),g,m,Math.sign(U));l.push(new Ri({targetPoint:Y,constraint:new Ln.aU(g,(0,$.uo)(le)),previousVertex:p,otherVertex:g,otherVertexType:Un.CENTER,isDraped:"on-the-ground"===M.elevationInfo?.mode}))}}const bi=(0,tn.Ue)(),As=(0,K.Ue)();class Ca extends Wn.j{constructor({targetPoint:l,point1:p,point2:g,isDraped:m}){super(l,new Ln.kt((0,$.uo)((0,L.m)((0,K.Ue)(),p,g,.5)),.5*(0,Ie.TE)((0,$.eR)(p),(0,$.eR)(g))),m,nt.B.SELF),this._p1=p,this._p2=g}get hints(){return[new Ot.w(we.ze.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new Ot.w(we.ze.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new Nn(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}}class Da extends ui{snapNewVertex(l,p){const g=p.editGeometryOperations.data.components[0],m=[],v=g.vertices.length;if("polygon"!==p.editGeometryOperations.data.type||v<2)return m;const{view:S}=this,P=g.vertices[v-1],R=(0,$.j7)(g.vertices[0].pos,S,p),b=(0,$.j7)(P.pos,S,p);return this._processCandidateProposal(R,b,l,p,m),m}snapExistingVertex(l,p){const g=[],m=p.vertexHandle,v=m.component;if(v.edges.length<2||"polyline"===p.editGeometryOperations.data.type&&(0===m.index||m.index===v.vertices.length-1))return g;const{view:S}=this,M=(0,$.j7)(m.leftEdge.leftVertex.pos,S,p),P=(0,$.j7)(m.rightEdge.rightVertex.pos,S,p);return this._processCandidateProposal(M,P,l,p,g),g}_processCandidateProposal(l,p,g,m,v){if(!this.exceedsShortLineThreshold(l,p,m))return;const S=(0,Ie.t7)(Ls,(0,$.eR)(l),(0,$.eR)(p),.5),M=.5*(0,Ie.TE)((0,$.eR)(l),(0,$.eR)(p)),P=(0,Kn.xO)(Ls,(0,$.eR)(g),S,M),R=(0,$.al)(P[0],P[1],g[2]),{spatialReference:b,pointer:U}=m,j=(0,Xe.Rs)(g,b,Fe.jG,this.view);if((0,we.Bb)(j,(0,Xe.Rs)(R,b,Fe.jG,this.view))<this.squaredProximityThreshold(U)){if(this.isVertical(l,R,m)||this.isVertical(R,p,m))return;v.push(new Ca({targetPoint:R,point1:l,point2:p,isDraped:"on-the-ground"===m.elevationInfo?.mode}))}}}const Ls=(0,tn.Ue)();let zn=class extends X.Z{constructor(h){super(h),this.updating=!1,this._snappers=new sn.Z,this._domain=nt.B.SELF}initialize(){this._snappers.push(new Ma(this.view,this.options),new Pa(this.view,this.options),new Ea(this.view,this.options),new Da(this.view,this.options))}set options(h){this._set("options",h);for(const l of this._snappers)l.options=h}fetchCandidates(h,l,p){var g=this;return(0,ne.Z)(function*(){if(!(l&g._domain&&g.options.effectiveSelfEnabled))return[];const m=[];for(const v of g._snappers.items)for(const S of v.snap(h,p))m.push(S);return(0,we.lQ)(h,m),m})()}};function Ra(h,l){return[new zn({view:h,options:l}),new Bt({view:h,options:l,spatialReference:h.spatialReference})]}(0,D._)([(0,T.Cb)({readOnly:!0})],zn.prototype,"updating",void 0),(0,D._)([(0,T.Cb)({constructOnly:!0})],zn.prototype,"view",void 0),(0,D._)([(0,T.Cb)()],zn.prototype,"options",null),zn=(0,D._)([(0,se.j)("esri.views.interactive.snapping.SelfSnappingEngine")],zn);class hi extends Wn.j{constructor(l,p,g,m){super(l,new Ln.Hk(l),m,nt.B.ALL),this.first=p,this.second=g}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new ai(this.targetPoint,this.isDraped,this.domain)]}}let Tt=class extends(ga.Z.EventedMixin(X.Z)){constructor(h){super(h),this.options=new Ss,this.snappingEnginesFactory=Ra,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Kt.MAIN}initialize(){this.addHandles([(0,V.YP)(()=>{const{effectiveFeatureEnabled:h,effectiveSelfEnabled:l,touchSensitivityMultiplier:p,distance:g,constraintsActive:m}=this.options;return{effectiveFeatureEnabled:h,effectiveSelfEnabled:l,touchSensitivityMultiplier:p,distance:g,constraintsActive:m}},()=>{this.doneSnapping(),this.emit("changed")},V.Z_),(0,V.YP)(()=>this.options,h=>{for(const l of this._engines)l.options=h},V.Z_),(0,V.YP)(()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory}),({viewReady:h,snappingEnginesFactory:l})=>this._recreateEngines(h,l),V.tX)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some(h=>h.updating)}_recreateEngines(h,l){if(this._destroyEngines(),!h)return;const{view:p,options:g}=this;this._engines=l(p,g)}_destroyEngines(){for(const h of this._engines)h.destroy();this._engines=[]}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:h,touchSensitivityMultiplier:l}=this.options,p=h*l;return p*p}get _squaredSatisfiesConstraintThreshold(){return Ne.satisfiesConstraintScreenThreshold*Ne.satisfiesConstraintScreenThreshold}snap(h){return function Oa(h){return null!=h.scenePoint}(h)?this._snapMultiPoint(h):this._snapSinglePoint(h)}update(h){const{point:l,context:p}=h;this._removeVisualization();const g=this._currentMainCandidate;if(null==g)return l;const m=this._selectUpdateInput(h);if(null==m)return l;const{spatialReference:v}=p,S=(0,xi.project)(m,v);if(null==S)return l;const{view:M}=this,{elevationInfo:P,visualizer:R}=p,b=[],U=(0,$.SN)(S,M,P),j=g.constraint.closestTo(U);if(!this._arePointsWithinScreenThreshold(U,j,p))return this._resetSnappingState(),l;g.targetPoint=j,b.push(...g.hints);for(const Y of this._currentOtherActiveCandidates)Y.targetPoint=j,b.push(...Y.hints);return null!=R&&this.addHandles(R.draw(b,{spatialReference:v,elevationInfo:xa(p),view:M,selfSnappingZ:p.selfSnappingZ}),pi),(0,$.aK)(j,M,l,p)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:h,scenePoint:l}){switch(this._currentSnappedType){case Kt.MAIN:return h;case Kt.SCENE:return l}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Kt.MAIN}_removeVisualization(){this.removeHandles(pi)}_snapSinglePoint({point:h,context:l,signal:p}){var g=this;return(0,ne.Z)(function*(){const{view:m}=g,{elevationInfo:v}=l,S=(0,$.SN)(h,m,v),M=yield g._fetchCandidates(S,nt.B.ALL,l,p);return g._createSnapResult(S,Kt.MAIN,M,m,h,l,p)})()}_snapMultiPoint({point:h,scenePoint:l,context:p,signal:g}){var m=this;return(0,ne.Z)(function*(){const{view:v}=m,{coordinateHelper:S,elevationInfo:M,spatialReference:P}=p;yield(0,xi.initializeProjection)(l.spatialReference,P);const R=(0,xi.project)(l,P),b=(0,$.SN)(R,v,M),U=yield m._fetchCandidates(b,nt.B.FEATURE,p,g);if(U.length>0){const le=yield m._fetchCandidates(b,nt.B.SELF,p,g);return m._createSnapResult(b,Kt.SCENE,[...U,...le],v,R,p,g)}const j=(0,$.SN)(h,v,M),Y=yield m._fetchCandidates(j,nt.B.SELF,p,g);return m._createSnapResult(j,Kt.MAIN,Y,v,{z:S.hasZ()&&h.hasZ?h.z??0:void 0,m:S.hasM()&&h.hasM?h.m??0:void 0},p,g)})()}_fetchCandidates(h,l,p,g){var m=this;return(0,ne.Z)(function*(){return(yield Promise.all(m._engines.map(v=>v.fetchCandidates(h,l,p,g)))).flat()})()}_createSnapResult(h,l,p,g,m,v,S){return{get valid(){return!(0,jt.Hc)(S)},apply:()=>{const{spatialReference:M}=v,{snappedPoint:P,hints:R}=this._processCandidates(h,l,p,v);return this._removeVisualization(),null!=v.visualizer&&this.addHandles(v.visualizer.draw(R,{spatialReference:M,elevationInfo:Fe.jG,view:g,selfSnappingZ:v.selfSnappingZ}),pi),(0,$.aK)(P,g,m,v)}}}_processCandidates(h,l,p,g){if(p.length<1)return this.doneSnapping(),{snappedPoint:h,hints:[]};this._currentSnappedType!==l&&this._resetSnappingState(),(0,we.lQ)(h,p);const m=this._currentMainCandidate;if(null!=m){const v=this._findOldConstraintInNewCandidates(m,p);if(v>=0){if(!(p[v]instanceof hi))return this._intersectWithOtherCandidates(v,p,h,l,g);if(this._arePointsWithinScreenThreshold(h,m.targetPoint,g))return this._updateSnappingCandidate(m,l,p,g)}}return this._intersectWithOtherCandidates(0,p,h,l,g)}_findOldConstraintInNewCandidates(h,l){return h instanceof hi?this._findOldCandidateIndex(l,h.first)>=0&&this._findOldCandidateIndex(l,h.second)>=0?0:-1:this._findOldCandidateIndex(l,h)}_intersectWithOtherCandidates(h,l,p,g,m){const{coordinateHelper:v}=m,S=l[h],M=[];for(let P=0;P<l.length;++P){if(P===h)continue;const R=l[P],b=S.constraint.intersect(R.constraint);if(b)for(const U of b.closestPoints(S.targetPoint))M.push([new hi(U,S,R,R.isDraped),this._squaredScreenDistance(p,U,v)])}return M.length>0&&(M.sort((P,R)=>P[1]-R[1]),M[0][1]<this._squaredPointProximityThreshold(m.pointer))?this._updateSnappingCandidate(M[0][0],g,l,m):this.options.constraintsActive&&(S instanceof Ds||S instanceof Es.L||S instanceof Ri||S instanceof ws)?{snappedPoint:p,hints:[]}:this._updateSnappingCandidate(S,g,l,m)}_updateSnappingCandidate(h,l,p,g){this.doneSnapping(),this._currentMainCandidate=h,this._currentSnappedType=l;const m=this._currentMainCandidate.targetPoint,v=[];v.push(...h.hints);for(const S of p){if(h instanceof hi){if(S.constraint.equals(h.first.constraint)||S.constraint.equals(h.second.constraint))continue}else if(S.constraint.equals(h.constraint))continue;const M=S.constraint.closestTo(m);this._squaredScreenDistance(M,m,g.coordinateHelper)<this._squaredSatisfiesConstraintThreshold&&(S.targetPoint=m,this._currentOtherActiveCandidates.push(S),v.push(...S.hints))}return{snappedPoint:m,hints:v}}_squaredPointProximityThreshold(h){return"touch"===h?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(h,l,p){return this._squaredScreenDistance(h,l,p.coordinateHelper)<this._squaredPointProximityThreshold(p.pointer)}_squaredScreenDistance(h,l,p){return(0,we.Bb)(this._toScreen(h,p),this._toScreen(l,p))}_toScreen(h,l){return(0,Xe.Rs)(h,l.spatialReference,Fe.jG,this.view)}_findOldCandidateIndex(h,l){let p=-1;for(let g=0;g<h.length;++g)if(l.constraint.equals(h[g].constraint)){p=g;break}return p}get test(){return{visualizationsActive:this.hasHandles(pi),engines:this._engines}}};var Kt;(0,D._)([(0,T.Cb)({constructOnly:!0})],Tt.prototype,"view",void 0),(0,D._)([(0,T.Cb)()],Tt.prototype,"options",void 0),(0,D._)([(0,T.Cb)({readOnly:!0})],Tt.prototype,"updating",null),(0,D._)([(0,T.Cb)()],Tt.prototype,"snappingEnginesFactory",void 0),(0,D._)([(0,T.Cb)()],Tt.prototype,"_engines",void 0),(0,D._)([(0,T.Cb)()],Tt.prototype,"_squaredMouseProximityThreshold",null),(0,D._)([(0,T.Cb)()],Tt.prototype,"_squaredTouchProximityThreshold",null),(0,D._)([(0,T.Cb)()],Tt.prototype,"_squaredSatisfiesConstraintThreshold",null),Tt=(0,D._)([(0,se.j)("esri.views.interactive.snapping.SnappingManager")],Tt),function(h){h[h.MAIN=0]="MAIN",h[h.SCENE=1]="SCENE"}(Kt||(Kt={}));const pi="visualization-handle";function xa({coordinateHelper:h,elevationInfo:l}){return h.hasZ()?Fe.jG:l}const fi=new Map;class Us{constructor(l){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.editGeometryOperations=l.editGeometryOperations,this.elevationInfo=l.elevationInfo,this.pointer=l.pointer,this.vertexHandle=l.vertexHandle,this.excludeFeature=l.excludeFeature,this.feature=l.feature,this.visualizer=l.visualizer,this.selfSnappingZ=l.selfSnappingZ}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}get spatialReference(){return this.coordinateHelper.spatialReference}}var Aa=C(53639),gi=C(87091);function zs(h,[l,p,g]){const m=(0,ue.WG)(h);return m.x+=l,m.y+=p,m.hasZ&&(m.z+=g),m}function wi(h,l){return[h.x-l.x,h.y-l.y,h.hasZ&&l.hasZ?h.z-l.z:0]}function js(h,l,[p,g,m],v){h.x=l.x+p,h.y=l.y+g,v&&h.hasZ&&l.hasZ&&(h.z=l.z+m)}function Is(h){return h}let Pn=class extends X.Z{constructor(h){var l;super(h),l=this,this.constrainResult=p=>p,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=(0,jt.Ds)(function(){var p=(0,ne.Z)(function*(g,m,v,S){const M=l._frameTask;if(null==M)return;const P=yield M.schedule(()=>m.snap({...g,context:v,signal:S}),S);P.valid&&(yield M.schedule(()=>{l.stagedPoint=P.apply(),g!==l._snapPoints&&null!=l._snapPoints&&(l.stagedPoint=m.update({...l._snapPoints,context:v}))},S))});return function(g,m,v,S){return p.apply(this,arguments)}}())}get stagedPoint(){return this._stagedPoint}set stagedPoint(h){this._stagedPoint=this.constrainResult(h)}initialize(){const h="3d"===this.view.type?this.view?.resourceController?.scheduler:null;this._frameTask=null!=h?h.registerTask(gi.T8.SNAPPING):gi.sq}destroy(){this._abortController=(0,te.IM)(this._abortController),this._frameTask=(0,te.hw)(this._frameTask)}update(h,l,p){this._snapPoints=h;const{point:g,scenePoint:m}=h,v=l.update({point:g,scenePoint:m,context:p});return this.stagedPoint=v,v}snap(h,l,p){var g=this;return(0,ne.Z)(function*(){const{point:m,scenePoint:v}=h;return g.stagedPoint=l.update({point:m,scenePoint:v,context:p}),g._snapPoints=h,null==g._abortController&&(g._abortController=new AbortController),g._snap(h,l,p,g._abortController.signal)})()}snapAgainNearPreviousMapPoint(h,l){var p=this;return(0,ne.Z)(function*(){null!=p._snapPoints&&(yield p.snap(p._snapPoints,h,l))})()}abort(){this._abortController=(0,te.IM)(this._abortController),this._snapPoints=null}};(0,D._)([(0,T.Cb)({constructOnly:!0})],Pn.prototype,"view",void 0),(0,D._)([(0,T.Cb)()],Pn.prototype,"stagedPoint",null),(0,D._)([(0,T.Cb)()],Pn.prototype,"constrainResult",void 0),(0,D._)([(0,T.Cb)()],Pn.prototype,"_stagedPoint",void 0),Pn=(0,D._)([(0,se.j)("esri.views.interactive.snapping.SnappingOperation")],Pn);let it=class extends X.Z{constructor(h){super(h),this._stagedDimension=null,this._computationManipulators=new Map,this._computationHandles=new ns.Z,this._orientationManipulatorTexture=null,this._updatingHandles=new is.R,this._getSnappingContext=(0,Ar.H)(g=>new Us({elevationInfo:{mode:"absolute-height",offset:0},pointer:g,editGeometryOperations:new ea.c(new qr.XE("point",(0,Jr.Y6)(!0,!1,this.view.spatialReference))),visualizer:new Kr}));const{view:l}=h;this._snappingManagerResult=function Ta(h){if(!fi.has(h)){const g=function ra(h,l){const p=new Ss({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:l?.distance??Ne.distance,touchSensitivityMultiplier:l?.touchSensitivityMultiplier??Ne.touchSensitivityMultiplier});return{...(0,V.YP)(()=>h.map?.allLayers?.toArray()??[],g=>{p.featureSources=new sn.Z(g.map(m=>new Ci({layer:m,enabled:!0})))},V.nn),options:p}}(h,{distance:10}),m=function wa(h,l){return new Tt({view:h,options:l,snappingEnginesFactory:(p,g)=>[new Bt({view:h,spatialReference:h.spatialReference,options:g})]})}(h,g.options);fi.set(h,{referenceCount:0,snappingManager:m,remove:()=>{g.remove(),m.destroy()}})}const l=fi.get(h);l.referenceCount++;const p=(0,Z.kB)(()=>function ba(h,l){l.referenceCount--,l.referenceCount>0||(0,ta.Y)(()=>{0===l.referenceCount&&(l.remove(),fi.delete(h))})}(h,l));return{snappingManager:l.snappingManager,...p}}(l),this.addHandles(this._snappingManagerResult),this._unfocusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._focusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._thinOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._thinOffsetManipulatorMaterial.setParameters({stipplePattern:(0,ci.z5)(2)}),this._constraintSnappingIndicator=new yn.r({view:l,attached:!0,width:1,renderOccluded:be.yD.OccludeAndTransparent,stipplePattern:(0,ci.z5)(5),isDecoration:!0});const p=Ye.Z.toUnitRGBA(ks);this._stagedStartIndicator=new Qr({view:l,attached:!1,elevationInfo:{mode:"absolute-height",offset:0},spatialReference:h.view.renderCoordsHelper.spatialReference,color:p,size:10,outlineSize:0,renderOccluded:be.yD.OccludeAndTransparent,isDecoration:!0})}initialize(){const{view:h}=this;this._snappingOperation=new Pn({view:h});const l=!h._stage?.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result;this._orientationManipulatorMaterial=new Bi.j({transparent:!0,writeDepth:!1,renderOccluded:be.yD.Opaque,isDecoration:!0}),this.addHandles((0,V.YP)(()=>({accentColor:qn(h.effectiveTheme),contrastColor:Ys(h.effectiveTheme)}),({accentColor:g,contrastColor:m})=>{const v=this._orientationManipulatorTexture,S=(0,jr.O)(h.textures,{accentColor:g,contrastColor:m,preMultiplyAlpha:l});this._orientationManipulatorMaterial.setParameters({textureId:S.texture.id}),this._orientationManipulatorTexture=S,v?.release();const M=Ye.Z.toUnitRGBA(g);this._unfocusedOffsetManipulatorMaterial.setParameters({color:M}),this._focusedOffsetManipulatorMaterial.setParameters({color:M}),this._thinOffsetManipulatorMaterial.setParameters({color:M}),this._constraintSnappingIndicator.color=M},V.nn));const p=(0,V.wZ)(()=>this.analysisViewData.computations,({computation:g})=>this._createManipulators(g));this.addHandles((0,Z.ed)(p)),this.addHandles([(0,V.YP)(()=>({stagedPoint:this._snappingOperation.stagedPoint,stagedComputation:this._stagedComputation}),({stagedPoint:g,stagedComputation:m})=>{if(null==m||null==g)return;const v=(0,ue.WG)(g,new gn.Z);this._applyPointUpdate(m,{endPoint:v})},V.Z_),(0,V.YP)(()=>({stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator}),(g,m)=>{const{stagedDimension:v,selectedComputation:S,firstGrabbedManipulator:M}=g;if(v===m?.stagedDimension&&M===m?.firstGrabbedManipulator){for(const P of[S,m?.selectedComputation])if(null!=P){const R=this._computationManipulators.get(P);null!=R&&this._updateManipulators(P,R,g)}}else for(const[P,R]of this._computationManipulators)this._updateManipulators(P,R,g)},V.tX),(0,V.YP)(()=>this.analysis.style.lineSize,g=>{this._updateManipulatorStyle(g)},V.nn),(0,V.YP)(()=>this.view.state.camera,()=>{null!=this._stagedComputation&&this._updateStagedDimensionOffset(this._stagedComputation)}),(0,V.YP)(()=>{const g=this._stagedComputation;if(!g)return null;const m=g.elevationAlignedStartPoint,v=(0,K.Ue)();return null!=m&&this.view.renderCoordsHelper.toRenderCoords(m,v)?v:null},g=>{null!=g?(this._stagedStartIndicator.vertices=[g],this._stagedStartIndicator.attached=!0):this._stagedStartIndicator.attached=!1})]),this.addHandles(this._constraintHandles),this.addHandles(this._snappingIndicatorHandles),(0,we.Ob)(this,()=>{const g=this._activeComputation;if(null==g||null!=this._stagedComputation){const S=this._getSnappingContext(this.view.inputManager.latestPointerType??"mouse");this._updatingHandles.addPromise((0,jt.R8)(this._snappingOperation.snapAgainNearPreviousMapPoint(this._snappingManager,S)))}if(null!=g){const{start:v,end:S}=this._computationManipulators.get(g);(v.grabbing||S.grabbing)&&function zr(h,l,{constraint:p,view:g}){const{unconstrainedGeometry:m}=h;if(null==m)return;const{renderCoordsHelper:v,spatialReference:S}=g,{startRenderSpace:M,endRenderSpace:P}=m.directSegment,R=v.fromRenderCoords(M,new gn.Z({spatialReference:S})),b=v.fromRenderCoords(P,new gn.Z({spatialReference:S}));let U;U="start"===l?{startPoint:R}:{endPoint:b},ss(h,U,{constraint:p,elevationAlignedStartPoint:h.elevationAlignedStartPoint,elevationAlignedEndPoint:h.elevationAlignedEndPoint,unconstrainedGeometry:m,view:g})}(g,v.grabbing?"start":"end",{constraint:this._computeConstraint(g),view:this.view})}})}destroy(){this._snappingOperation=(0,te.SC)(this._snappingOperation),this._computationHandles.destroy(),this._constraintSnappingIndicator.destroy(),this._stagedStartIndicator.destroy(),this._orientationManipulatorTexture?.release()}get updating(){return this._updatingHandles.updating||this._snappingManager.updating}get firstGrabbedManipulator(){return this.parentTool.firstGrabbedManipulator}get hasGrabbedManipulators(){return this.parentTool.hasGrabbedManipulators}get snappingOptions(){return this._snappingManager.options}get _snappingManager(){return this._snappingManagerResult.snappingManager}get _activeComputation(){if(null!=this._stagedComputation)return this._stagedComputation;const{selectedComputation:h}=this.analysisViewData;return this.hasGrabbedManipulators&&null!=h?h:null}get _stagedComputation(){const h=this._stagedDimension,l=this.analysisViewData.computations.at(-1)?.computation;return null==h||null==l||l.dimension!==h?null:l}get _constraintHandles(){return[(0,V.gx)(()=>this.analysisViewData.selectedComputation,h=>{h.previousConstraint=this._computeConstraint(h)},{...V.tX,equals:Si.fS}),(0,V.YP)(()=>{const h=this._activeComputation;if(null==h)return null;const{measureType:l,orientation:p}=h.dimension;return{measureType:l,orientation:p,computation:h}},(h,l)=>{if(null!=h&&null==l){const{measureType:p,orientation:g,computation:m}=h;switch(m.previousConstraint){case mt.Horizontal:m.preConstraintProperties={measureType:de.n.Horizontal,orientation:0};break;case mt.Vertical:m.preConstraintProperties={measureType:de.n.Vertical,orientation:0};break;case mt.Direct:m.preConstraintProperties={measureType:de.n.Direct,orientation:g};break;default:m.preConstraintProperties={measureType:p,orientation:g}}}null==h&&null!=l&&(l.computation.preConstraintProperties=null)},V.Z_)]}get _snappingIndicatorHandles(){const h="snapping-indicator-event-handles";return[(0,V.YP)(()=>({stagedComputation:this._stagedComputation,activeComputation:this._activeComputation}),({stagedComputation:l,activeComputation:p})=>{const g=this._constraintSnappingIndicator;if(this.removeHandles(h),null!=p)if(p===l)g.attached=!0;else{const{start:m,end:v}=this._computationManipulators.get(p),S=()=>{g.attached=m.grabbing||v.grabbing};S(),this.addHandles([m.events.on("grab-changed",S),v.events.on("grab-changed",S)],h)}else g.attached=!1}),(0,V.YP)(()=>{const l=this._activeComputation;return null!=l?{geometry:l.geometry,constraint:l.previousConstraint}:{}},({geometry:l,constraint:p})=>{const g=this._constraintSnappingIndicator;null!=l&&null!=p&&p!==mt.Direct?(g.visible=!0,g.setGeometryFromSegment(l.directSegment)):g.visible=!1})]}removeStaged(){return null!=this._stagedDimension&&(this.analysis.dimensions.remove(this._stagedDimension),this._stagedDimension=null,!0)}onDeactivate(){this.removeStaged(),this._resetSnappingState()}onClick(h){const{_stagedDimension:l}=this;if(null==l){const p=this._onUnstagedClick(h);return this.analysis.dimensions.add(p),null}return this._onStagedClick(h),l}onPointerMove({mapPoint:h,pointerType:l}){if("touch"===l)return;const p=this._getSnappingContext(l);this._updatingHandles.addPromise((0,jt.R8)(this._snappingOperation.snap({point:h},this._snappingManager,p)))}onManipulatorSelectionChanged(){null!=this.analysisViewData.selectedComputation&&(this._computationManipulators.get(this.analysisViewData.selectedComputation).offset.selected||(this.analysisViewData.selectedDimension=null))}_onUnstagedClick({mapPoint:h,pointerType:l}){let p=h;if("mouse"===l){const m=this._getSnappingContext(l);p=this._snappingManager.update({point:h,context:m})}const g=new wr.Z({startPoint:(0,ue.WG)(p,new gn.Z),endPoint:null,measureType:de.n.Horizontal});return this._stagedDimension=g,this._resetSnappingState(),g}_onStagedClick({mapPoint:h,pointerType:l}){const p=this._stagedComputation;if(null==p)return;let g=h;if("mouse"===l){const v=this._getSnappingContext(l);g=this._snappingManager.update({point:h,context:v})}const m=(0,ue.WG)(g,new gn.Z);this._applyPointUpdate(p,{endPoint:m}),this._stagedDimension=null,this._resetSnappingState()}_resetSnappingState(){this._snappingManager.doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null}_createManipulators(h){const l=this._setupPointManipulator(h,{isStart:!0}),p=this._setupPointManipulator(h,{isStart:!1}),g=this._setupOffsetManipulator(h),m=this._setupHeadingManipulator(h),v=this._setupRotationManipulator(h),S=this._setupMeasureTypeManipulator(h,de.n.Direct),M=this._setupMeasureTypeManipulator(h,de.n.Horizontal),P=this._setupMeasureTypeManipulator(h,de.n.Vertical),R=new dr({start:l,end:p,offset:g,heading:m,rotation:v,direct:S,horizontal:M,vertical:P});return this._setupComputationToManipulatorsSync(h,R),this._computationManipulators.set(h,R),this.manipulators.addMany(R.values()),{manipulators:R,remove:()=>{this._computationHandles.remove(h),this._computationManipulators.delete(h);for(const b of R.values())this.manipulators.remove(b)}}}_setupComputationToManipulatorsSync(h,l){this._computationHandles.add([(0,V.YP)(()=>h.geometry,()=>this._updateManipulators(h,l),{...V.tX,equals:Si.fS})],h)}_setupPointManipulator(h,l){const{view:p}=this,{dimension:g}=h,m=new ur(p,{metadata:g}),v=function fr(h,{isStart:l,createSnappingPipelineStep:p,dimension:g,onUpdate:m,view:v}){const S=l?"startPoint":"endPoint";return[(0,zt.Xd)(h,(P,R,b,U)=>{const j=(0,bn.J4)(P),{snappingStep:Y,cancelSnapping:le}=p(U);b=b.next(j).next((0,zt.di)(g,[S,"measureType","orientation"])).next(le),R.next(j).next((0,bn.gv)(v)).next(...Y).next(me=>{const Me=(0,ue.WG)(me.mapEnd,new gn.Z);m("startPoint"===S?{startPoint:Me}:{endPoint:Me})})})]}(m,{isStart:l.isStart,createSnappingPipelineStep:S=>function La({predicate:h=(()=>!0),snappingManager:l,snappingContext:p,updatingHandles:g,useZ:m=!0}){const v=new zt.hM;if(null==l)return{snappingStep:[Is,v],cancelSnapping:Is};let S,M=null,P=null,R=null;const b=()=>{M=(0,te.IM)(M),l.doneSnapping(),P?.frameTask.remove(),P=null,S=(0,te.hw)(S),R=null},U=function Ua(h,l,p){return(0,jt.Ds)(function(){var g=(0,ne.Z)(function*({frameTask:m,point:v,scenePoint:S,context:M,event:P,delta:R,getLastState:b},U){const j=yield m.schedule(()=>h.snap({point:v,scenePoint:S,context:M,signal:U}),U);if(j.valid){let Y=yield m.schedule(()=>j.apply(),U);const le=b();null!=le.point&&v!==le.point&&(Y=h.update({point:le.point,scenePoint:le.scenePoint,context:M})),null!=le.updatePoint&&(0,Aa.kg)(Y,le.updatePoint)||(js(P.mapEnd,Y,R,l),p.execute(P))}});return function(m,v){return g.apply(this,arguments)}}())}(l,m,v);let j=null,Y=null,le=null;return{snappingStep:[me=>{if(!h(me))return me;const{action:Me}=me;if("start"===Me){const{info:ke}=me,Li=function za(h){return"3d"===h.type?h.resourceController.scheduler.registerTask(gi.T8.SNAPPING):gi.sq}(l.view);if(P=function ja(h,l,p){return{context:new Us({editGeometryOperations:h.editGeometryOperations,elevationInfo:h.elevationInfo,pointer:h.pointer,vertexHandle:null!=l.info?l.info.handle:null,excludeFeature:h.excludeFeature,feature:h.feature,visualizer:h.visualizer}),originalPos:null!=l.snapOrigin?h.coordinateHelper.vectorToDehydratedPoint(l.snapOrigin):l.mapStart,originalScenePos:null!=l.scenePoints?l.scenePoints.sceneStart:null,frameTask:p}}(p,me,Li),P.context.selfSnappingZ=null,!m&&null!=ke){const kn=function Va(h,l){if(!h.hasZ())return null;const p=l.vertices;let g=null;for(const m of p){const v=h.getZ(m.pos);if(null!=g&&null!=v&&Math.abs(v-g)>1e-6)return null;null==g&&(g=v)}return g}(p.coordinateHelper,ke.handle.component);null!=kn&&(P.context.selfSnappingZ={value:kn,elevationInfo:p.elevationInfo??Fe.jG})}}if(null!=P){const{context:ke,originalScenePos:Li,originalPos:kn}=P,{mapEnd:Zs,mapStart:Ws,scenePoints:so}=me,Ui=zs(kn,wi(Zs,Ws)),Bs=wi(Ws,kn),ro={...me,action:"update"},ao=P.context,zi=function Ia(h,l){return null==h||null==l?null:zs(h,wi(l.sceneEnd,l.sceneStart))}(Li,so),Ks=l.update({point:Ui,scenePoint:zi,context:ke});if(le=Ks,js(Zs,Ks,Bs,m),j=Ui,Y=zi,"end"!==Me){const{frameTask:oo}=P;null==M&&(M=new AbortController),R=lo=>{g.addPromise((0,jt.R8)(U({frameTask:oo,event:ro,context:ao,point:Ui,scenePoint:zi,delta:Bs,getLastState:()=>({point:j,scenePoint:Y,updatePoint:lo.forceUpdate?null:le})},M.signal)))},R({forceUpdate:!1}),null==S&&(S=(0,V.YP)(()=>l.options.effectiveEnabled,()=>R?.({forceUpdate:!0})))}}return"end"===Me&&b(),me},v],cancelSnapping:me=>(b(),me)}}({snappingContext:this._getSnappingContext(S),snappingManager:this._snappingManager,updatingHandles:this._updatingHandles}),dimension:g,onUpdate:S=>this._applyPointUpdate(h,S),view:p});return this._computationHandles.add(v,h),m}_setupOffsetManipulator(h){const{view:l}=this,p=function hr(h,l){const p=[(0,K.al)(-.5,0,0),(0,K.al)(.5,0,0)],g=(0,Lt.rh)(l.unfocusedMaterial,p.map(v=>(0,L.h)((0,K.Ue)(),v,.5))),m=g.instantiate({material:l.focusedMaterial});return new ei.Z({view:h,renderObjects:[new At.r(g,Et.Q9.Unfocused|Et.Q9.Selected|Zt),new At.r(m,Et.Q9.Focused|Zt)],collisionType:{type:"line",paths:[p]},radius:yi(l.lineSizePt)/2,metadata:l.metadata,available:!1,...Mt.X9})}(l,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,metadata:h.dimension}),g=function gr(h,{computation:l,view:p}){return[(0,zt.Xd)(h,(g,m,v)=>{if(!wt(l)||!g.selected)return;const{geometry:S,dimension:M}=l,P=(0,bn.J4)(g);m.next(P).next(Xi(p,M,S.dimensionSegment,S.primaryOffsetAxis)),v.next(P).next((0,zt.di)(M,["offset"]))})]}(p,{computation:h,view:l});return this._computationHandles.add(g,h),p}_setupHeadingManipulator(h){const{view:l}=this,p=new Ki(l,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:h.dimension}),g=function mr(h,{computation:l,view:p}){return[(0,zt.Xd)(h,(g,m,v)=>{ki({cancel:v,computation:l,settingHeading:!0,steps:m,view:p})})]}(p,{computation:h,view:l});return this._computationHandles.add(g,h),p}_setupRotationManipulator(h){const{view:l}=this,p=new Ki(l,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:h.dimension}),g=function vr(h,{computation:l,view:p}){return[(0,zt.Xd)(h,(g,m,v)=>{ki({cancel:v,computation:l,settingHeading:!1,steps:m,view:p})}),h.events.on("immediate-click",g=>{!function yr(h,l,p){const{dimension:g,geometry:m}=l;if(90===g.orientation||270===g.orientation)return g.orientation=0,void h.stopPropagation();if(null==m)return;const{renderCoordsHelper:v}=p,S=Rn({...Ft(l),orientation:90},v),M=Rn({...Ft(l),orientation:270},v);if(null==S||null==M)return;const P=hn(S,v),R=hn(M,v),b=Qi(m,p),U=fn.BV.shortestSignedDiff(b,P),j=fn.BV.shortestSignedDiff(b,R);g.orientation=Math.abs(U)<Math.abs(j)?90:270,h.stopPropagation()}(g,l,p)})]}(p,{computation:h,view:l});return this._computationHandles.add(g,h),p}_setupMeasureTypeManipulator(h,l){const{view:p}=this,g=function pr(h,l){const p=[(0,K.al)(-.5,0,0),(0,K.al)(.5,0,0)],g=(0,Lt.rh)(l.thinOffsetManipulatorMaterial,p),m=(0,Lt.rh)(l.unfocusedMaterial,p.map(S=>(0,L.h)((0,K.Ue)(),S,.5))),v=m.instantiate({material:l.focusedMaterial});return new ei.Z({view:h,renderObjects:[new At.r(m,Et.Q9.Unfocused|Zt),new At.r(v,Et.Q9.Focused|Zt),new At.r(g,Zt)],collisionType:{type:"line",paths:[p]},radius:yi(l.lineSizePt)/2,available:!1,metadata:l.metadata,...Mt.X9})}(p,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,thinOffsetManipulatorMaterial:this._thinOffsetManipulatorMaterial,metadata:h.dimension}),m=function Sr(h,{computation:l,manipulatorMeasureType:p,view:g}){let m=de.n.Direct,v=0,S=0;return[h.events.on("grab-changed",M=>{if("start"!==M.action||!wt(l))return;const{dimension:P,geometry:R}=l;m=P.measureType,v=P.offset,S=P.orientation;const b=(0,L.c)(ge.WM.get(),h.renderLocation);P.measureType=p,P.offset=function ye(h,l,p,g){const{directSegment:m}=p,v=tt(ge.WM.get(),{measureType:l,directSegment:m,renderCoordsHelper:g}),S=Qn(Be,{offsetAxis:v,offset:0,relativeToSegment:m,renderCoordsHelper:g}).eval(.5,ge.WM.get()),M=(0,L.z)(ge.WM.get(),h,S);return(0,L.k)(M,v)*g.unitInMeters}(b,p,R,g.renderCoordsHelper),P.orientation=0}),(0,zt.Xd)(h,(M,P,R)=>{if(!wt(l))return;const{geometry:b,dimension:U}=l,{renderCoordsHelper:j}=g,Y=w(ts,p,l,j),le=tt(ge.WM.get(),{measureType:p,directSegment:b.directSegment,renderCoordsHelper:j}),me=(0,bn.J4)(M);P.next(me).next(Xi(g,U,Y,le)),R.next(me).next(Me=>(U.measureType=m,U.offset=v,U.orientation=S,Me))})]}(g,{computation:h,manipulatorMeasureType:l,view:p});return this._computationHandles.add(m,h),g}_updateManipulators(h,l,p={stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator}){const{stagedDimension:g,selectedComputation:m,firstGrabbedManipulator:v}=p,{start:S,end:M,offset:P,heading:R,rotation:b}=l,U=m===h,j=wt(h),{dimension:Y}=h;for(const Me of l.values()){const ke=j&&null==g&&(null==v||Me===v);Me===P?(Me.available=ke,Me.selected=U):Me.available=ke&&U}if(!j)return;null!=this._computeConstraint(h)?l.forEachMeasureTypeManipulator(Me=>Me.available=!1):l.manipulatorForMeasureType(Y.measureType).available=!1;for(const Me of[R,b])Y.measureType===de.n.Direct&&0!==Y.offset||(Me.available=!1);On(h)?b.available=!1:R.available=!1;const{geometry:le}=h;S.renderLocation=le.directSegment.startRenderSpace,M.renderLocation=le.directSegment.endRenderSpace;const{renderCoordsHelper:me}=this.view;(function Pr(h,l,p){const{dimensionSegment:g,primaryOffsetAxis:m}=l,v=Hn(Fn,l),S=(0,L.j)(v,K.AG)?(0,ve.yR)(ti):(0,Mt.Aq)(v,m,K.AG,ti),M=Math.max((0,L.l)(v),.1/p.unitInMeters);(0,ve.bA)(S,S,(0,L.s)(Fn,M,M,M)),h.modelTransform=S,h.renderLocation=g.eval(.5,Fn)})(P,le,me),R.available&&function Mr(h,l,p){$i(h,l,p,{forHeading:!0})}(R,h,me),b.available&&function Er(h,l,p){$i(h,l,p,{forHeading:!1})}(b,h,me),l.forEachMeasureTypeManipulator((Me,ke)=>{Me.available&&function Rr(h,l,p,g){const{geometry:m}=l,v=w(ts,p,l,g),S=tt(Fn,{measureType:p,directSegment:m.directSegment,renderCoordsHelper:g}),M=(0,L.z)(_i,v.endRenderSpace,v.startRenderSpace),P=(0,Mt.Aq)(M,S,K.AG,ti),R=(0,L.l)(M);(0,ve.bA)(P,P,(0,L.s)(_i,R,R,R)),h.modelTransform=P,h.renderLocation=v.eval(.5,_i)}(Me,h,ke,me)})}_updateManipulatorStyle(h){const l=function br(h){return(0,ot.F2)(h)+4}(h),p=yi(h),g={lineSizePt:h,material:this._orientationManipulatorMaterial};for(const{offset:m,heading:v,rotation:S}of this._computationManipulators.values())m.radius=p/2,v.update(g),S.update(g);this._unfocusedOffsetManipulatorMaterial.setParameters({width:l}),this._focusedOffsetManipulatorMaterial.setParameters({width:p})}_applyPointUpdate(h,l){const{view:p}=this,g=Ft(h);"startPoint"in l&&(g.elevationAlignedStartPoint=l.startPoint),"endPoint"in l&&(g.elevationAlignedEndPoint=l.endPoint);const m=Rn(g,p.renderCoordsHelper);if(null==m)return;const v=this._computeConstraint({...g,geometry:m});ss(h,l,{...g,constraint:v,unconstrainedGeometry:m,view:p}),h===this._stagedComputation&&this._updateStagedDimensionOffset(h)}_updateStagedDimensionOffset(h){if(null==h.geometry)return;h.geometry.directSegment.eval(.5,Vs);const l=this.view.state.camera.computeScreenPixelSizeAt(Vs);h.dimension.offset=50*l}_computeConstraint(h){return function Ur(h,l){if(pn(h))return mt.Direct;if(!h.enabled)return null;const{geometry:p}=h;if(null==p||(0,L.j)(p.directSegment.startRenderSpace,p.directSegment.endRenderSpace))return null;const{camera:g}=l.state,m=dn(ge.WM.get(),p,l.renderCoordsHelper),v=un(ge.WM.get(),p),S=(0,L.h)(ge.WM.get(),m,(0,L.k)(v,m)),M=(0,L.f)(ge.WM.get(),v,S),P=(0,L.p)(M),R=(0,L.p)(S),{startRenderSpace:b,endRenderSpace:U}=p.directSegment,j=Math.max(10*g.computeScreenPixelSizeAt(b),10*g.computeScreenPixelSizeAt(U))**2;return P<j?mt.Vertical:R<j?mt.Horizontal:null}(function Lr(h,l){return{enabled:l.effectiveFeatureEnabled,elevationAlignedStartPoint:h.elevationAlignedStartPoint,elevationAlignedEndPoint:h.elevationAlignedEndPoint,geometry:h.geometry}}(h,this._snappingManager.options),this.view)}_createOffsetManipulatorMaterial(){return new Ut.U({width:1,renderOccluded:be.yD.OccludeAndTransparent,writeDepth:!1,hasPolygonOffset:!0,isDecoration:!0})}get testInfo(){const h=l=>this.analysisViewData.computations.find(({computation:p})=>p.dimension===l)?.computation;return{disableManipulatorPartialOcclusion:()=>{this._stagedStartIndicator.renderOccluded=be.yD.Occlude,this.manipulators.forEach(({manipulator:l})=>{for(const{geometry:p}of l.renderObjects)p.material.setParameters({renderOccluded:be.yD.Occlude})})},getManipulatorsForDimension:l=>this._computationManipulators.get(h(l)),getComputationForDimension:l=>h(l),getConstraintForDimension:l=>{const p=h(l);return null!=p?this._computeConstraint(p):null},stagedDimension:this._stagedDimension,stagedStartIndicator:this._stagedStartIndicator,constraintSnappingIndicator:this._constraintSnappingIndicator,snappingManager:this._snappingManager}}};(0,D._)([(0,T.Cb)({constructOnly:!0})],it.prototype,"analysis",void 0),(0,D._)([(0,T.Cb)({constructOnly:!0})],it.prototype,"analysisViewData",void 0),(0,D._)([(0,T.Cb)({constructOnly:!0})],it.prototype,"manipulators",void 0),(0,D._)([(0,T.Cb)({constructOnly:!0})],it.prototype,"parentTool",void 0),(0,D._)([(0,T.Cb)({constructOnly:!0,nonNullable:!0})],it.prototype,"view",void 0),(0,D._)([(0,T.Cb)({readOnly:!0})],it.prototype,"updating",null),(0,D._)([(0,T.Cb)()],it.prototype,"firstGrabbedManipulator",null),(0,D._)([(0,T.Cb)()],it.prototype,"hasGrabbedManipulators",null),(0,D._)([(0,T.Cb)()],it.prototype,"snappingOptions",null),(0,D._)([(0,T.Cb)()],it.prototype,"_stagedDimension",void 0),(0,D._)([(0,T.Cb)()],it.prototype,"_activeComputation",null),(0,D._)([(0,T.Cb)()],it.prototype,"_stagedComputation",null),it=(0,D._)([(0,se.j)("esri.views.3d.analysis.Dimension.LengthDimensionSubTool")],it);const Vs=(0,K.Ue)();var jn,Ga=C(58997),Gs=C(72791),Ha=C(59278),Fa=C(41900);!function(h){h.Ready="ready",h.Creating="creating",h.Created="created"}(jn||(jn={}));let pt=class extends Ga.f{constructor(h){super(h),this.automaticManipulatorSelection=!1,this.removeIncompleteOnCancel=!1,this._pointerMoveTimerMs=2500,this._prevPointerMoveTimeout=null}initialize(){this._intersector=(0,Ha.w)(this.view.state.viewingMode),this._lengthDimensionSubTool=new it({analysis:this.analysis,analysisViewData:this.analysisViewData,manipulators:this.manipulators,parentTool:this,view:this.view}),this.addHandles([(0,Z.ed)(this._lengthDimensionSubTool),(0,Z.kB)(()=>this._clearPointerMoveTimeout()),(0,V.YP)(()=>this.state,h=>{h===jn.Created&&this.finishToolCreation()},V.tX),(0,V.gx)(()=>this.firstGrabbedManipulator,h=>{this.selectedDimension=h.metadata},V.tX),(0,V.YP)(()=>this.selectedDimension,()=>this._resetPointerMoveTimeout(),V.tX)])}get state(){return this.analysis.dimensions.some(h=>"length"===h.type)?null!=this._activeSubTool?jn.Creating:jn.Created:jn.Ready}get updating(){return this._lengthDimensionSubTool.updating}get cursor(){return this.active?"crosshair":null}get selectedDimension(){return this.analysisViewData.selectedDimension}set selectedDimension(h){this.analysisViewData.selectedDimension=h}onInputEvent(h){switch(h.type){case"immediate-click":this._clickHandler(h);break;case"immediate-double-click":this._doubleClickHandler(h);break;case"pointer-move":this._pointerMoveHandler(h);break;case"key-down":if(Gs.Sn.cancel===h.key){if(null!=this._activeSubTool&&this._activeSubTool.removeStaged())return void h.stopPropagation();this.active||(this.selectedDimension=null)}else Gs.Sn.delete.includes(h.key)&&this._deleteKeyHandler()}}onActivate(){this._activeSubTool=this._lengthDimensionSubTool}onDeactivate(){null!=this._activeSubTool&&(this._activeSubTool.onDeactivate(),this._activeSubTool=null)}onShow(){this._resetPointerMoveTimeout()}onManipulatorSelectionChanged(){this._lengthDimensionSubTool.onManipulatorSelectionChanged()}onHide(){this.selectedDimension=null}_clickHandler(h){if(this.hasFocusedManipulators)return void h.stopPropagation();if(null==this._activeSubTool)return;const l=this._intersectScreen(h);null!=l&&(this.selectedDimension=this._activeSubTool.onClick({mapPoint:l,pointerType:h.pointerType}),h.stopPropagation())}_doubleClickHandler(h){this.active&&(this.view.activeTool=null,h.stopPropagation())}_pointerMoveHandler(h){if(this._resetPointerMoveTimeout(),null==this._activeSubTool||this.hasFocusedManipulators)return;const l=this._intersectScreen(h);null!=l&&this._activeSubTool.onPointerMove({mapPoint:l,pointerType:h.pointerType})}_deleteKeyHandler(){null!=this._activeSubTool&&this._activeSubTool.removeStaged(),this._removeSelected()}_intersectScreen(h){const l=(0,Fa.Sj)(h);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(l,this._intersector);const p=this._intersector.results.min,g=ge.WM.get();return p.getIntersectionPoint(g)?this.view.renderCoordsHelper.fromRenderCoords(g,new gn.Z({spatialReference:this.view.spatialReference})):null}_removeSelected(){null!=this.selectedDimension&&(this.analysis.dimensions.remove(this.selectedDimension),this.selectedDimension=null)}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=(0,te.hw)(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.manipulators.forEach(h=>h.manipulator.state|=Zt),this._prevPointerMoveTimeout=Tn.m.setTimeout(()=>{this.manipulators.forEach(h=>h.manipulator.state&=~Zt)},this._pointerMoveTimerMs)}get testInfo(){return{...this._lengthDimensionSubTool.testInfo,setManipulatorAutoHideDelay:h=>{this._pointerMoveTimerMs=h,this._resetPointerMoveTimeout()}}}};(0,D._)([(0,T.Cb)({constructOnly:!0})],pt.prototype,"view",void 0),(0,D._)([(0,T.Cb)({constructOnly:!0})],pt.prototype,"analysis",void 0),(0,D._)([(0,T.Cb)({readOnly:!0})],pt.prototype,"state",null),(0,D._)([(0,T.Cb)({readOnly:!0})],pt.prototype,"updating",null),(0,D._)([(0,T.Cb)({readOnly:!0})],pt.prototype,"cursor",null),(0,D._)([(0,T.Cb)({constructOnly:!0})],pt.prototype,"analysisViewData",void 0),(0,D._)([(0,T.Cb)()],pt.prototype,"selectedDimension",null),(0,D._)([(0,T.Cb)()],pt.prototype,"automaticManipulatorSelection",void 0),(0,D._)([(0,T.Cb)()],pt.prototype,"_activeSubTool",void 0),(0,D._)([(0,T.Cb)()],pt.prototype,"_lengthDimensionSubTool",void 0),pt=(0,D._)([(0,se.j)("esri.views.3d.analysis.Dimension.DimensionTool")],pt),C(52515);var Na=C(84600),Za=C(68063),Hs=C(79020),Fs=C(70591);class Wa extends gs._{constructor(l,p){super(l),this._hasExternalMaterial=!1,this._renderOccluded=be.yD.OccludeAndTransparent,this._width=1,this._color=(0,wn.al)(1,0,1,1),this._placement="end",this._markerPrimitive="arrow",this._material=p,this._hasExternalMaterial=null!=p,this.applyProperties(l)}setGeometryFromSegment(l,p){const g=l.endRenderSpace;this.transform=(0,ve.vc)(Ba,g),this._normal=p;const{points:m}=l.createRenderGeometry(g,this.view.renderCoordsHelper);this.geometry=[m]}get renderOccluded(){return null!=this._material?this._material.parameters.renderOccluded:this._renderOccluded}set renderOccluded(l){this._renderOccluded=l,null!=this._material&&this._material.setParameters({renderOccluded:l})}get geometry(){return this._geometry}set geometry(l){this._geometry=l,this.recreateGeometry()}get normal(){return this._normal}set normal(l){this._normal=l,this.recreateGeometry()}get width(){return null!=this._material?this._material.parameters.width:this._width}set width(l){this._width=l,null!=this._material&&this._material.setParameters({width:l})}get color(){return null!=this._material?this._material.parameters.color:this._color}set color(l){this._color=(0,wn.d9)(l),null!=this._material&&this._material.setParameters({color:this._color})}get placement(){return null!=this._material?this._material.parameters.placement:this._placement}set placement(l){this._placement=l,null!=this._material&&this._material.setParameters({placement:this._placement})}get markerPrimitive(){return this._material?.parameters.markerPrimitive??this._markerPrimitive}set markerPrimitive(l){this._markerPrimitive=l,null!=this._material&&this._material.setParameters({markerPrimitive:l})}createExternalResources(){this._hasExternalMaterial||(this._material=new Fs.X({width:this._width,color:this._color,placement:this._placement,renderOccluded:this._renderOccluded,markerPrimitive:this._markerPrimitive,isDecoration:this.isDecoration}))}destroyExternalResources(){this._hasExternalMaterial||(this._material=null)}createGeometries(l){for(const p of(0,Hs.c)(this.geometry,this.normal)){const g=(0,Hs.Y)(this._material,p);l.addGeometry(g)}}forEachExternalMaterial(l){this._hasExternalMaterial||l(this._material)}}const Ba=(0,He.Ue)();class Ka{set visible(l){for(const p of this._visualElements.values())p.attached=l}constructor(l){this.destroyed=!1,this._handles=new ns.Z,this._messages=null,this._labelSegment=new _e.y;const{analysis:p,computation:g,view:m,messages:v,isDecoration:S}=l;this.analysis=p,this.computation=g,this.view=m,this._messages=v;const M=l.visible,P={view:m,attached:M,isDecoration:S},{fontSize:R,textColor:b,textBackgroundColor:U}=p.style;this._visualElements=new Qa({marker:new Wa(P,l.markerMaterial),dimension:new yn.r(P,l.dimensionLineMaterial),startOffset:new yn.r(P,l.offsetLineMaterial),endOffset:new yn.r(P,l.offsetLineMaterial),dimensionSmall:new yn.r(P,l.smallDimensionLineMaterial),startOffsetSmall:new yn.r(P,l.smallOffsetLineMaterial),endOffsetSmall:new yn.r(P,l.smallOffsetLineMaterial),label:new Za.K({view:m,attached:M,distance:0,geometry:{type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1},fontSize:(0,ot.F2)(R),textColor:b.clone(),backgroundColor:U.clone(),isDecoration:S})}),this._handles.add([(0,V.YP)(()=>g.geometry,j=>{this.updateCameraDependentElements(m.state.camera,j,p.style),null!=g.geometry&&this._updateLines(g.geometry)},{...V.nn,equals:Si.fS}),(0,V.YP)(()=>g.length,j=>this._updateLabelContent(j),V.nn)])}destroy(){this.destroyed=!0,this._handles=(0,te.SC)(this._handles);for(const l of this._visualElements.values())l.destroy()}get testInfo(){return{dimensionVisualElement:this._visualElements.dimension,label:this._visualElements.label}}_updateLines(l){const p=Gn(Ya,O.Start,l.directSegment,l.dimensionSegment),g=Gn(ka,O.End,l.directSegment,l.dimensionSegment),m=this._visualElements;m.marker.setGeometryFromSegment(l.dimensionSegment,l.primaryOffsetAxis),m.dimension.setGeometryFromSegment(l.dimensionSegment),m.startOffset.setGeometryFromSegment(p),m.endOffset.setGeometryFromSegment(g),m.dimensionSmall.setGeometryFromSegment(l.dimensionSegment),m.startOffsetSmall.setGeometryFromSegment(p),m.endOffsetSmall.setGeometryFromSegment(g)}updateCameraDependentElements(l,p,g){const m=this._visualElements;if(null==p){for(const me of m.values())me.visible=!1;return}const v=l.computeScreenPixelSizeAt(p.dimensionSegment.eval(.5,Xa)),S=function Jn(h,l){return(0,L.p)(Hn(xn,h))/l**2}(p,v),M=S<(2*(0,ot.F2)(g.lineSize))**2,P=!M;m.marker.visible=P,m.dimension.visible=P,m.startOffset.visible=P,m.endOffset.visible=P,m.dimensionSmall.visible=M,m.startOffsetSmall.visible=M,m.endOffsetSmall.visible=M;const R=5*(0,ot.F2)(g.fontSize),{label:b}=m;if(b.visible=S>=R**2,!b.visible)return;const{dimensionSegment:U,primaryOffsetAxis:j}=p,{offset:Y}=this.computation.dimension,le=(Math.sign(Y)>=0?1:-1)*this._labelOffsetPx(g)*v;(function _(h,l,p,g){(0,L.r)(h.startRenderSpace,l.startRenderSpace,p,g),(0,L.r)(h.endRenderSpace,l.endRenderSpace,p,g)})(this._labelSegment,U,j,le),b.updateLabelPosition()}updateLabelStyle(l){const{label:p}=this._visualElements;p.fontSize=(0,ot.F2)(l.fontSize),p.textColor=l.textColor,p.backgroundColor=l.textBackgroundColor}updateUnitsMessages(l){this._messages=l;const{length:p}=this.computation;this._updateLabelContent(p)}_updateLabelContent(l){const{label:p}=this._visualElements;p.text=null!=l&&null!=this._messages?(0,Na.VG)(this._messages,l,l.unit):""}_labelOffsetPx(l){return 1.5*(0,ot.F2)(l.fontSize)+20+(0,ot.F2)(l.lineSize/2)}}const Ya=new _e.y,ka=new _e.y,Xa=(0,K.Ue)();class Qa{constructor(l){this.marker=l.marker,this.dimension=l.dimension,this.startOffset=l.startOffset,this.endOffset=l.endOffset,this.dimensionSmall=l.dimensionSmall,this.startOffsetSmall=l.startOffsetSmall,this.endOffsetSmall=l.endOffsetSmall,this.label=l.label}values(){return[this.marker,this.dimension,this.startOffset,this.endOffset,this.dimensionSmall,this.startOffsetSmall,this.endOffsetSmall,this.label]}}var $a=C(46359),Ja=C(56683),qa=C(41840);let Yt=class extends X.Z{get analysis(){return this.analysisViewData.analysis}get visible(){return this.analysisViewData.visible}constructor(h){super(h),this.loadingMessages=!1,this._messages=null}initialize(){const h=this.isDecoration;this._markerMaterial=new Fs.X({width:1,anchor:$a.i5.Tip,color:Jt.AG,placement:"begin-end",worldSpace:!0,hideOnShortSegments:!0,hasTip:!0,renderOccluded:be.yD.OccludeAndTransparent,markerPrimitive:"triangle",isDecoration:h}),this._dimensionLineMaterial=new Ut.U({width:1,color:Jt.AG,renderOccluded:be.yD.OccludeAndTransparent,markerParameters:this._markerMaterial.parameters,isDecoration:h}),this._offsetLineMaterial=new Ut.U({width:1,color:Jt.AG,renderOccluded:be.yD.OccludeAndTransparent,stipplePattern:(0,ci.z5)(5),isDecoration:h}),this._smallDimensionLineMaterial=new Ut.U({width:1,color:Jt.AG,renderOccluded:be.yD.OccludeAndTransparent,isDecoration:h}),this._smallOffsetLineMaterial=new Ut.U({width:1,color:Jt.AG,renderOccluded:be.yD.OccludeAndTransparent,stipplePattern:(0,ci.z5)(5),isDecoration:h});for(const p of this._lineMaterials())this.view._stage.add(p),this.addHandles((0,Z.kB)(()=>{this.view._stage?.remove(p)}));const l=(0,V.wZ)(()=>this.analysisViewData.computations,({computation:p})=>this._createVisualization(p));this._dimensionVisualizations=l,this.addHandles([(0,Z.ed)(l),(0,V.YP)(()=>Ye.Z.toUnitRGBA(this.analysis.style.color),p=>{for(const g of this._lineMaterials())g.setParameters({color:p})},V.tX),(0,V.YP)(()=>this.analysis.style.lineSize,p=>{const g=(0,ot.F2)(p);this._markerMaterial.setParameters({width:g*Hi}),this._dimensionLineMaterial.setParameters({width:g,markerParameters:this._markerMaterial.parameters});const m=Math.max(.25*g,1);this._offsetLineMaterial.setParameters({width:m})},V.tX),(0,V.YP)(()=>({camera:this.view.state.camera,style:eo(this.analysis)}),({camera:p,style:g})=>{for(const{visualization:m}of this._dimensionVisualizations)m.updateCameraDependentElements(p,m.computation.geometry,g),m.updateLabelStyle(g)}),(0,V.YP)(()=>this.visible,p=>{for(const{visualization:g}of this._dimensionVisualizations)g.visible=p})]),this.addHandles([(0,Ja.qe)(()=>this._updateMessageBundle()),(0,V.gx)(()=>!this.loadingMessages,()=>{for(const{visualization:p}of this._dimensionVisualizations)p.updateUnitsMessages(this._messages)},V.Z_)]),this._updateMessageBundle()}get testInfo(){return{visualizations:this._dimensionVisualizations.items.map(({visualization:h})=>h),disablePartialOcclusion:()=>{for(const h of this._lineMaterials())h.setParameters({renderOccluded:be.yD.Occlude})}}}_createVisualization(h){const l=new Ka({analysis:this.analysis,computation:h,view:this.view,visible:this.visible,markerMaterial:this._markerMaterial,dimensionLineMaterial:this._dimensionLineMaterial,offsetLineMaterial:this._offsetLineMaterial,smallDimensionLineMaterial:this._smallDimensionLineMaterial,smallOffsetLineMaterial:this._smallOffsetLineMaterial,messages:this._messages,isDecoration:this.isDecoration});return{visualization:l,remove:()=>l.destroy()}}_lineMaterials(){return[this._markerMaterial,this._dimensionLineMaterial,this._offsetLineMaterial,this._smallDimensionLineMaterial,this._smallOffsetLineMaterial]}_updateMessageBundle(){var h=this;return(0,ne.Z)(function*(){h.loadingMessages=!0;try{h._messages=yield(0,qa.ME)("esri/core/t9n/Units")}finally{h.loadingMessages=!1}})()}};function eo(h){const{fontSize:l,lineSize:p,textColor:g,textBackgroundColor:m}=h.style;return{fontSize:l,lineSize:p,textBackgroundColor:m.clone(),textColor:g.clone()}}(0,D._)([(0,T.Cb)({constructOnly:!0})],Yt.prototype,"analysisViewData",void 0),(0,D._)([(0,T.Cb)({constructOnly:!0,nonNullable:!0})],Yt.prototype,"view",void 0),(0,D._)([(0,T.Cb)({constructOnly:!0})],Yt.prototype,"isDecoration",void 0),(0,D._)([(0,T.Cb)()],Yt.prototype,"analysis",null),(0,D._)([(0,T.Cb)()],Yt.prototype,"visible",null),(0,D._)([(0,T.Cb)()],Yt.prototype,"loadingMessages",void 0),Yt=(0,D._)([(0,se.j)("esri.views.3d.analysis.Dimension.DimensionVisualization")],Yt);let Yn=class extends X.Z{constructor(h){super(h),this.dimension=null,this.length=null}};(0,D._)([(0,T.Cb)({constructOnly:!0,nonNullable:!0})],Yn.prototype,"dimension",void 0),(0,D._)([(0,T.Cb)()],Yn.prototype,"length",void 0),Yn=(0,D._)([(0,se.j)("esri.views.3d.analysis.LengthDimensionResult")],Yn);const to=Yn;let ft=class extends X.Z{constructor(h){super(h),this.geometry=null,this.unconstrainedGeometry=null,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}normalizeCtorArgs(h){const{dimension:l,...p}=h;return{result:new to({dimension:l}),...p}}initialize(){this.addHandles([(0,V.YP)(()=>this.dimension.startPoint,h=>this.elevationAlignedStartPoint=this.projectAndAlignPoint(h),V.tX),(0,V.YP)(()=>this.dimension.endPoint,h=>this.elevationAlignedEndPoint=this.projectAndAlignPoint(h),V.tX)])}get dimension(){return this.result.dimension}get length(){return this.result.length}};(0,D._)([(0,T.Cb)({constructOnly:!0,nonNullable:!0})],ft.prototype,"result",void 0),(0,D._)([(0,T.Cb)({constructOnly:!0,nonNullable:!0})],ft.prototype,"projectAndAlignPoint",void 0),(0,D._)([(0,T.Cb)()],ft.prototype,"dimension",null),(0,D._)([(0,T.Cb)()],ft.prototype,"length",null),(0,D._)([(0,T.Cb)()],ft.prototype,"geometry",void 0),(0,D._)([(0,T.Cb)()],ft.prototype,"unconstrainedGeometry",void 0),(0,D._)([(0,T.Cb)()],ft.prototype,"elevationAlignedStartPoint",void 0),(0,D._)([(0,T.Cb)()],ft.prototype,"elevationAlignedEndPoint",void 0),(0,D._)([(0,T.Cb)()],ft.prototype,"preConstraintProperties",void 0),(0,D._)([(0,T.Cb)()],ft.prototype,"previousConstraint",void 0),ft=(0,D._)([(0,se.j)("esri.views.3d.analysis.LengthDimensionComputation")],ft);var Ns=C(54865),Ai=C(95925);const no=h=>{let l=class extends h{constructor(...p){super(...p),this.analysis=null,this.tool=null,this.selectedDimension=null,this.interactive=!1,this.visible=null}get results(){return new sn.Z}createLengthDimensions(p){throw new Error("Method not implemented.")}};return(0,D._)([(0,T.Cb)({constructOnly:!0})],l.prototype,"view",void 0),(0,D._)([(0,T.Cb)({constructOnly:!0,nonNullable:!0})],l.prototype,"analysis",void 0),(0,D._)([(0,T.Cb)()],l.prototype,"tool",void 0),(0,D._)([(0,T.Cb)({readOnly:!0})],l.prototype,"results",null),(0,D._)([(0,T.Cb)()],l.prototype,"selectedDimension",void 0),(0,D._)([(0,T.Cb)()],l.prototype,"interactive",void 0),(0,D._)([(0,T.Cb)()],l.prototype,"visible",void 0),l=(0,D._)([(0,se.j)("esri.views.analysis.DimensionAnalysisView")],l),l};let lt=class extends(no((0,Qe.p)(X.Z))){constructor(h){super(h),this.type="dimension-view-3d",this.tool=null,this.selectedDimension=null,this._dimensionsToComputations=new Map,this._placementTask=null,this._projectAndAlignPoint=null}initialize(){this._projectAndAlignPoint=l=>{if(null==l)return null;const{spatialReference:p,elevationProvider:g}=this.view,m=(0,Ns.G)(l,p,g);return null==m&&(0,Ns.e)(this.analysis,l.spatialReference,G.Z.getLogger(this)),m};const h=(0,V.wZ)(()=>this.analysis.dimensions,l=>this._createComputation(l));this.computations=h,this.addHandles([(0,Ai.Lp)(this,pt),(0,Z.ed)(h)]),this._analysisVisualization=new Yt({analysisViewData:this,view:this.view,isDecoration:!this.parent}),this._analysisController=new Pt({analysisViewData:this,view:this.view})}destroy(){this._placementTask=(0,te.IM)(this._placementTask),this._analysisVisualization=(0,te.SC)(this._analysisVisualization),(0,Ai.Yq)(this)}get updating(){return this._analysisVisualization?.loadingMessages??!1}get results(){return this.analysis.dimensions.map(h=>this._dimensionsToComputations.get(h).result)}get selectedComputation(){const{selectedDimension:h}=this;return null==h?null:this._dimensionsToComputations.get(h)}get testInfo(){return{visualization:this._analysisVisualization,controller:this._analysisController}}createLengthDimensions(h){var l=this;return(0,ne.Z)(function*(){return l.selectedDimension=null,l._placementTask=(0,te.IM)(l._placementTask),l._placementTask=(0,Ai.Er)(l,h),l._placementTask.promise})()}_createComputation(h){const{_dimensionsToComputations:l}=this,p=new ft({dimension:h,projectAndAlignPoint:this._projectAndAlignPoint});return l.set(h,p),{computation:p,remove:()=>this._removeComputation(p)}}_removeComputation(h){const{dimension:l}=h;l===this.selectedDimension&&(this.selectedDimension=null),this._dimensionsToComputations.delete(l),h.destroy()}};(0,D._)([(0,T.Cb)({readOnly:!0})],lt.prototype,"type",void 0),(0,D._)([(0,T.Cb)()],lt.prototype,"tool",void 0),(0,D._)([(0,T.Cb)()],lt.prototype,"updating",null),(0,D._)([(0,T.Cb)({readOnly:!0})],lt.prototype,"results",null),(0,D._)([(0,T.Cb)()],lt.prototype,"computations",void 0),(0,D._)([(0,T.Cb)()],lt.prototype,"selectedDimension",void 0),(0,D._)([(0,T.Cb)()],lt.prototype,"selectedComputation",null),(0,D._)([(0,T.Cb)()],lt.prototype,"_analysisVisualization",void 0),(0,D._)([(0,T.Cb)()],lt.prototype,"_analysisController",void 0),(0,D._)([(0,T.Cb)()],lt.prototype,"_dimensionsToComputations",void 0),(0,D._)([(0,T.Cb)()],lt.prototype,"_placementTask",void 0),lt=(0,D._)([(0,se.j)("esri.views.3d.analysis.DimensionAnalysisView3D")],lt);const io=lt},72791:(Je,Pe,C)=>{C.d(Pe,{Kj:()=>D,Sn:()=>ne});const ne={redo:"r",undo:"z",center:"Alt",constraint:"Shift",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "},D={toggle:"Control"}},55475:(Je,Pe,C)=>{C.d(Pe,{Hk:()=>ve,M8:()=>Mn,aU:()=>Vt,jg:()=>Gt,kt:()=>ge,ku:()=>L});var ne=C(85931),D=C(21286),X=C(95470),Z=C(15331),G=C(79800),te=C(29302),V=C(63657),T=C(1503),qe=(C(37299),C(10049)),se=C(90014),Qe=C(97126),de=C(98943),ee=C(21733),H=C(26362),Re=C(396);class fe{intersect(_){return W(this,_)}closestPoints(_){return[this.closestTo(_)]}}class ve extends fe{constructor(_){super(),this.point=_}equals(_){return this===_||rt(_)&&(0,G.j)(this.point,_.point)}closestTo(){return(0,ee.d9)(this.point)}}class He extends fe{constructor(_,w,k){super(),this.start=_,this.end=w,this.lineLike={start:_,end:w,type:k}}equals(_){return this===_||ht(_)&&this.lineLike.type===_.lineLike.type&&(0,G.j)(this.start,_.start)&&(0,G.j)(this.end,_.end)}closestTo(_){const w=(0,H.ZE)(_,this.lineLike);return(0,ee.uo)(w)}}class L extends He{constructor(_,w){super(_,w,Re.SP.LINE)}}class K extends He{constructor(_,w){super(_,w,Re.SP.RAY)}}class Ze extends fe{constructor(_){super(),this.constraints=_}equals(_){return this===_||$t(_)&&(0,ne.fS)(this.constraints,_.constraints,(w,k)=>w.equals(k))}closestTo(_){let w,k=1/0;for(const re of this.constraints){const ae=re.closestTo(_),Te=(0,G.a)(_,ae);Te<k&&(k=Te,w=ae)}return w?(0,ee.d9)(w):_}closestPoints(_){return this.constraints.flatMap(w=>w===this?[]:w.closestPoints(_))}}class ge extends fe{constructor(_,w){super(),this.center=_,this.radius=w}equals(_){return this===_||_t(_)&&this.center[0]===_.center[0]&&this.center[1]===_.center[1]&&this.radius===_.radius}closestTo(_){const w=(0,H.sc)(_,this.center,this.radius);return(0,ee.uo)(w)}}class ie extends fe{constructor(_,w){super(),this.center=_,this.radius=w}equals(_){return this===_||et(_)&&(0,G.j)(this.center,_.center)&&this.radius===_.radius}closestTo(_){const w=(0,H.sc)(_,this.center,this.radius);return w[2]=this.center[2],(0,ee.uo)(w)}asCircle(){return new ue((0,ee.d9)(this.center),this.radius,(0,ee.al)(0,0,1))}}class ue extends fe{constructor(_,w,k,re){super(),this.center=_,this.radius=w,this.normal=k,this.slicePlane=re}equals(_){return this===_||at(_)&&(0,G.j)(this.center,_.center)&&(0,G.j)(this.normal,_.normal)&&this.radius===_.radius}closestTo(_){const{center:w,radius:k}=this;(0,se.nF)(this.getPlane(Ve),_,_e);const re=(0,G.z)(_e,_e,w),ae=(0,G.p)(re);if((0,H.hA)(ae,0))return(0,ee.d9)(_);const Te=k/Math.sqrt(ae),ye=(0,G.r)((0,te.Ue)(),w,re,Te),{slicePlane:Be}=this;return Be&&!(0,H.zf)(Be,ye)?oe(Be,this)?.closestTo(_)??(0,ee.d9)(_):(0,ee.uo)(ye)}getPlane(_=(0,se.Ue)()){return(0,se.Yq)(this.center,this.normal,_)}}const _e=(0,te.Ue)(),Ve=(0,se.Ue)();class Ae extends fe{constructor(_){super(),this.z=_}equals(_){return this===_||bt(_)&&this.z===_.z}closestTo(_){return(0,ee.uo)((0,te.al)(_[0],_[1],this.z))}getPlane(_=(0,se.Ue)()){return(0,G.s)(Ke,0,0,this.z),(0,se.Yq)(Ke,te.eG,_)}}const Ke=(0,te.Ue)();class Ue extends fe{constructor(_,w,k){super(),this.start=_,this.end=w,this.planeLike={start:(0,ee.eR)(_),end:(0,ee.eR)(w),type:k}}equals(_){return this===_||gt(_)&&this.planeLike.type===_.planeLike.type&&(0,G.j)(this.start,_.start)&&(0,G.j)(this.end,_.end)}closestTo(_){return(0,ee.uo)((0,H.z9)(_,this.planeLike))}closestEndTo(_){const{start:w,end:k}=this.planeLike;return Math.sign((0,X.AK)((0,X.$X)(Se,k,w),(0,X.$X)(an,(0,ee.eR)(_),w)))>0?this.end:this.start}getPlane(_=(0,se.Ue)()){const w=(0,G.c)(yt,this.end);return w[2]+=1,(0,se.zk)(this.start,this.end,w,_)}getSlicePlane(_=(0,se.Ue)()){const{start:w,end:k,type:re}=this.planeLike;if(re===H.Jk.PLANE)return;const ae=(0,G.s)(yt,w[0],w[1],0),Te=(0,G.s)(kt,k[0],k[1],0),ye=(0,G.f)(kt,Te,ae);return(0,se.Yq)(ae,ye,_),_}}const Se=(0,Z.Ue)(),an=(0,Z.Ue)(),yt=(0,te.Ue)(),kt=(0,te.Ue)();class Vt extends Ue{constructor(_,w){super(_,w,H.Jk.HALF_PLANE)}}class Gt extends Ue{constructor(_,w){super(_,w,H.Jk.PLANE)}}class on extends fe{constructor(_,w){super(),this.sphere=(0,Qe.k)(_,w)}equals(_){return this===_||St(_)&&(0,Qe.l)(this.sphere,_.sphere)}closestTo(_){const w=(0,Qe.p)(this.sphere,_,(0,te.Ue)());return(0,ee.uo)(w)}get center(){return(0,Qe.g)(this.sphere)}get radius(){return this.sphere[3]}}class Mn extends fe{constructor(_,w,k){super(),this.start=_,this.end=w,this.getZ=k,this.planeLike={start:(0,ee.eR)(_),end:(0,ee.eR)(w),type:H.Jk.PLANE}}equals(_){return this===_||Ft(_)&&(0,G.j)(this.start,_.start)&&(0,G.j)(this.end,_.end)&&this.getZ===_.getZ}closestTo(_){return function In(O,_){const w=(0,H.z9)(_,O.planeLike);return w[2]=O.getZ(w[0],w[1])??Gn,(0,ee.uo)(w)}(this,_)}addIfOnTheGround(_,w){for(const k of w){const re=this.getZ(k[0],k[1])??0;(0,H.hA)(k[2],re)&&(k[2]=re,_.push(k))}}}function W(O,_){if($t(O)){const w=[];for(const k of O.constraints){const re=k.intersect(_);re&&w.push(re)}return Qt(w)}if($t(_))return W(_,O);if(Ft(O))return Xn(O,_);if(Ft(_))return Xn(_,O);if(rt(O)){const{point:w}=O;if(rt(_))return(0,G.j)(w,_.point)?O:void 0;const k=_.closestTo(w);return(0,G.G)(k,w)?O:void 0}if(ht(O)){if(rt(_))return W(_,O);if(ht(_))return ut((0,H.Au)(O.lineLike,_.lineLike));if(bt(_))return B(O,_);if(gt(_))return ut((0,H.fK)(_.planeLike,O.lineLike));if(_t(_))return ut((0,H.CJ)(O.lineLike,_.center,_.radius));if(at(_))return ut((0,H.UG)(O.lineLike,_));if(et(_))return function J({lineLike:O},{center:_,radius:w}){const k=_[2];return ut((0,H.CJ)(O,_,w).filter(re=>(0,H.hA)(re[2],k)))}(O,_);if(St(_))return function he({lineLike:O},{sphere:_}){return ut((0,Qe.m)(_,O.start,O.end))}(O,_)}else if(bt(O)){if(rt(_)||ht(_))return W(_,O);if(bt(_))return function pe(O,_){return(0,H.hA)(O.z,_.z)?O:void 0}(O,_);if(gt(_))return function ce({z:O},{planeLike:_}){const[w,k]=_.start,[re,ae]=_.end,Te=(0,ee.al)(w,k,O),ye=(0,ee.al)(re,ae,O);return _.type===H.Jk.PLANE?new L(Te,ye):new K(Te,ye)}(O,_);if(_t(_))return function ze(O,_){const[w,k]=_.center;return new ie((0,ee.al)(w,k,O.z),_.radius)}(O,_);if(at(_))return Oe(O,_);if(et(_))return function Ce(O,_){return(0,H.hA)(_.center[2],O.z)?_:void 0}(O,_);if(St(_))return function Ge(O,{center:_,radius:w}){const k=Math.abs(_[2]-O.z);if(k>w&&!(0,H.hA)(k,w))return;const re=(0,ee.al)(_[0],_[1],O.z),ae=Math.sqrt(w**2-k**2);return(0,H.hA)(ae,0)?void 0:new ie(re,ae)}(O,_)}else if(gt(O)){if(rt(_)||ht(_)||bt(_))return W(_,O);if(gt(_))return Vn((0,H.Nn)(O.planeLike,_.planeLike));if(_t(_))return Vn((0,H.SD)(O.planeLike,_.center,_.radius));if(at(_))return xe(O,_);if(et(_))return De(O,_);if(St(_))return je(O,_)}else if(_t(O)){if(rt(_)||ht(_)||bt(_)||gt(_))return W(_,O);if(_t(_))return Vn((0,H.Yf)((0,ee.eR)(O.center),O.radius,(0,ee.eR)(_.center),_.radius));if(at(_))return;if(et(_))return function st(O,_){const w=(0,X.bI)((0,ee.eR)(O.center),(0,ee.eR)(_.center));return(0,H.hA)(w,0)&&(0,H.hA)(O.radius,_.radius)?_:Dn((0,H.Yf)((0,ee.eR)(O.center),O.radius,(0,ee.eR)(_.center),_.radius),_.center[2])}(O,_);if(St(_))return}else if(at(O)){if(rt(_)||ht(_)||bt(_)||gt(_)||_t(_))return W(_,O);if(at(_))return;if(et(_))return void _.asCircle();if(St(_))return}else if(et(O)){if(rt(_)||ht(_)||bt(_)||gt(_)||_t(_)||at(_))return W(_,O);if(et(_))return function mi(O,_){if(!(0,H.$7)(O.center,_.center))return;const w=(0,X.bI)((0,ee.eR)(O.center),(0,ee.eR)(_.center));return(0,H.hA)(w,0)&&(0,H.hA)(O.radius,_.radius)?O:Dn((0,H.Yf)((0,ee.eR)(O.center),O.radius,(0,ee.eR)(_.center),_.radius),O.center[2])}(_,O);if(St(_))return}else if(St(O)){if(rt(_)||ht(_)||bt(_)||gt(_)||_t(_)||et(_))return W(_,O);if(St(_))return}}new qe._q,new qe._q;const B=(()=>{const O=(0,se.Ue)();return(_,w)=>{const{start:k,end:re}=_;if((0,H.$7)(k,re)&&(0,H.hA)(k[2],w.z))return _;const ae=(0,te.Ue)();return(0,se.fn)(w.getPlane(O),k,re,ae)?new ve((0,ee.uo)(ae)):void 0}})(),oe=(()=>{const O=(0,T.Ue)(),_=(0,te.Ue)(),w=(0,te.Ue)();return(k,re,ae)=>{const{normal:Te,center:ye,radius:Be}=re;(0,de._F)(Te,_,w);const tt=(0,se.st)(k),cn=Be*(0,G.k)(tt,_),On=Be*(0,G.k)(tt,w);(0,V.s)(O,ye[0],ye[1],ye[2],1);const Qn=(0,V.g)(k,O),$n=Math.hypot(cn,On),dn=(0,H.hA)($n,0);if((0,H.hA)((0,se.TE)(k,ye),0)){if(dn)return re;if((0,H.hA)(Be,0))return!ae||(0,H.zf)(ae,ye)?new ve((0,ee.d9)(ye)):void 0;(0,G.b)(_,tt,Te),(0,G.n)(_,_);const Pt=new Array,Tn=(0,te.d9)(ye);(0,G.r)(Tn,Tn,_,Be),ae&&!(0,H.zf)(ae,Tn)||Pt.push(Tn);const Ye=(0,te.d9)(ye);return(0,G.r)(Ye,Ye,_,-Be),ae&&!(0,H.zf)(ae,Ye)||Pt.push(Ye),ut(Pt)}if(dn)return;const un=-Qn/$n;if(Math.abs(un)>1||(0,H.hA)(un,1))return;const Hn=Math.atan(cn/On),hn=(0,D.Kt)(un)-Hn,Jn=Math.PI-hn,xn=new Array,pn=(0,te.Ue)();(0,G.r)(pn,ye,_,Be*Math.cos(hn)),(0,G.r)(pn,pn,w,Be*Math.sin(hn)),xn.push(pn);const wt=(0,te.Ue)();return(0,G.r)(wt,ye,_,Be*Math.cos(Jn)),(0,G.r)(wt,wt,w,Be*Math.sin(Jn)),xn.push(wt),ut(ae?(0,H.rq)(ae,xn):xn)}})(),Oe=(()=>{const O=(0,se.Ue)();return(_,w)=>oe(_.getPlane(O),w,w.slicePlane)})(),De=(()=>{const O=(0,se.Ue)();return(_,{center:w,radius:k})=>{const re=(0,H.SD)(_.planeLike,w,k),ae=w[2];_.getSlicePlane(O);const Te=new Array;for(const[ye,Be]of re){const tt=[ye,Be,ae];(0,H.zf)(O,tt)&&Te.push(tt)}return ut(Te)}})(),xe=(()=>{const O=(0,se.Ue)(),_=(0,se.Ue)();return(w,k)=>oe(w.getPlane(O),k,w.getSlicePlane(_))})(),je=(()=>{const O=(0,se.Ue)();return(_,{center:w,radius:k})=>{const re=_.getPlane(O),ae=(0,se.jH)(re,w),Te=Math.abs(ae);if(Te>k&&!(0,H.hA)(Te,k))return;const ye=(0,te.d9)((0,se.st)(re)),Be=(0,G.r)((0,te.Ue)(),w,ye,ae),tt=Math.sqrt(k**2-ae**2);return(0,H.hA)(tt,0)?new ve((0,ee.uo)((0,se.nF)(re,w,(0,te.Ue)()))):new ue((0,ee.uo)(Be),tt,ye,_.getSlicePlane())}})();function Xn(O,_){const{planeLike:w,getZ:k}=O,re=new Array;if(rt(_))O.addIfOnTheGround(re,(0,H.hm)(w,_.point));else if(ht(_))O.addIfOnTheGround(re,(0,H.fK)(w,_.lineLike));else if(_t(_))for(const[ae,Te]of(0,H.SD)(w,_.center,_.radius)){const ye=k(ae,Te);null!=ye&&re.push((0,te.al)(ae,Te,ye))}else if(gt(_)||Ft(_))for(const[ae,Te]of(0,H.Nn)(w,_.planeLike)){const ye=k(ae,Te)??Gn;re.push((0,te.al)(ae,Te,ye))}return ut(re)}function Vn(O){return Qt(O.map(([_,w])=>{const k=(0,ee.al)(_,w,0),re=(0,ee.al)(_,w,1);return new L(k,re)}))}function ut(O){return Qt(O.map(_=>_?new ve((0,ee.uo)(_)):void 0))}function Dn(O,_){return ut(O.map(([w,k])=>[w,k,_]))}function Qt(O){if(0!==O.length)return 1===O.length?O[0]??void 0:new Ze(O.filter(ne.pC))}function $t(O){return O instanceof Ze}function rt(O){return O instanceof ve}function ht(O){return O instanceof He}function bt(O){return O instanceof Ae}function gt(O){return O instanceof Ue}function _t(O){return O instanceof ge}function et(O){return O instanceof ie}function at(O){return O instanceof ue}function St(O){return O instanceof on}function Ft(O){return O instanceof Mn}const Gn=0},21733:(Je,Pe,C)=>{C.d(Pe,{Ju:()=>Qe,SN:()=>se,Ue:()=>Z,aK:()=>de,al:()=>T,d9:()=>Ee,eR:()=>te,j7:()=>qe,uo:()=>G});var ne=C(29302),D=C(41967),X=C(60507);function Z(H,Re,fe){return(0,ne.al)(H,Re,fe)}function G(H){return H}function te(H){return H}function T(H,Re,fe){return(0,ne.al)(H,Re,fe)}function Ee(H){return(0,ne.d9)(H)}function qe(H,Re,{coordinateHelper:fe,elevationInfo:ve}){return H?se(fe.vectorToDehydratedPoint(H,ee),Re,ve):null}function se(H,Re,fe){if(null==H)return null;if(null==Re)return(0,ne.al)(H.x,H.y,H.z??0);if("2d"===Re.type)return(0,ne.al)(H.x,H.y,0);const ve=(0,X.vQ)(Re,H,fe,X.jG)??0;return(0,ne.al)(H.x,H.y,ve)}function Qe(H,Re){return(0,D.T)(H[0],H[1],H[2],Re)}function de(H,Re,{z:fe,m:ve},He){const{spatialReference:L,elevationInfo:K}=He;let Ze;Ze=null==fe&&null==ve?void 0:null==Re||"2d"===Re.type?fe??void 0:(0,X.zx)(Re,H,L,X.jG,K)??0;const ge=(0,D.T)(H[0],H[1],Ze,L);return null!=ve&&(ge.m=ve,ge.hasM=!0),ge}const ee=(0,D.T)(0,0,0,null)},26352:(Je,Pe,C)=>{var ne,D;C.d(Pe,{B:()=>ne}),(D=ne||(ne={}))[D.FEATURE=1]="FEATURE",D[D.SELF=2]="SELF",D[D.ALL=3]="ALL"},61430:(Je,Pe,C)=>{C.d(Pe,{k:()=>G});var ne=C(55475),D=C(44725),X=C(97979),Z=C(62160);class G extends X.a{constructor(V){super({...V,isDraped:!0,constraint:new ne.M8(V.edgeStart,V.edgeEnd,V.getGroundElevation)})}get hints(){return[new Z.w(D.ze.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},75897:(Je,Pe,C)=>{C.d(Pe,{L:()=>G});var ne=C(55475),D=C(44725),X=C(97979),Z=C(62160);class G extends X.a{constructor(V){super({...V,constraint:new ne.ku(V.edgeStart,V.edgeEnd)})}get hints(){return[new Z.w(D.ze.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},97979:(Je,Pe,C)=>{C.d(Pe,{a:()=>X});var ne=C(26352),D=C(22823);class X extends D.j{constructor({targetPoint:G,objectId:te,constraint:V,isDraped:T}){super(G,V,T,ne.B.FEATURE),this.objectId=te}}},22823:(Je,Pe,C)=>{C.d(Pe,{j:()=>ne});class ne{constructor(X,Z,G,te){this.targetPoint=X,this.constraint=Z,this.isDraped=G,this.domain=te}}},62160:(Je,Pe,C)=>{C.d(Pe,{w:()=>te}),C(8314),C(63290);var X=C(79800),Z=C(26352),G=C(5286);class te extends G.r{constructor(T,Ee,qe,se,Qe=Z.B.ALL,de=!0,ee=!0){super(se,Qe),this.type=T,this.lineStart=Ee,this.lineEnd=qe,this.fadeLeft=de,this.fadeRight=ee}equals(T){return T instanceof te&&this.type===T.type&&(0,X.j)(this.lineStart,T.lineStart)&&(0,X.j)(this.lineEnd,T.lineEnd)&&this.fadeLeft===T.fadeLeft&&this.fadeRight===T.fadeRight}get length(){return(0,X.q)(this.lineStart,this.lineEnd)}}},19038:(Je,Pe,C)=>{C.d(Pe,{n:()=>X});var ne=C(79800),D=C(5286);class X extends D.r{constructor(G,te,V){super(te,V),this.point=G}equals(G){return G instanceof X&&(0,ne.j)(this.point,G.point)}}},5286:(Je,Pe,C)=>{C.d(Pe,{r:()=>ne});class ne{constructor(X,Z){this.isDraped=X,this.domain=Z}}},44725:(Je,Pe,C)=>{C.d(Pe,{Bb:()=>de,ML:()=>L,Ob:()=>Ze,_j:()=>He,fG:()=>ee,lQ:()=>H,n0:()=>ge,rh:()=>fe,ze:()=>Re});var Re,ie,ne=C(32917),D=C(28862),X=C(95737),Z=C(28170),G=C(79800),te=C(41967),V=C(96854),T=C(5801),Ee=C(72791),qe=C(21733),se=C(99911);function de(ie,ue){const _e=ie.x-ue.x,Ve=ie.y-ue.y;return _e*_e+Ve*Ve}function ee(ie,ue){return Math.sqrt(de(ie,ue))}function H(ie,ue){ue.sort((_e,Ve)=>(0,G.a)(_e.targetPoint,ie)-(0,G.a)(Ve.targetPoint,ie))}function fe({point:ie,distance:ue,returnEdge:_e,vertexMode:Ve,coordinateHelper:{spatialReference:Ae},filter:Ke},Ue,Se){return Se=null!=Se?Se.clone():new V.Z({where:"1=1"}),Ke&&(Se.geometry=Ke.geometry,Se.distance=Ke.distance,Se.spatialRelationship=Ke.spatialRelationship,Se.where=(0,X._)(Se.where,Ke.where),Se.timeExtent=(0,Z.Ov)(Se.timeExtent,Ke.timeExtent),Se.objectIds=function ve(ie,ue){return ie||ue?ue?ie?Array.from((0,D.jV)(new Set(ie),new Set(ue))):ue:ie:null}(Se.objectIds,Ke.objectIds)),{point:(0,te.T)(ie[0],ie[1],ie[2],Ae.toJSON()),mode:Ue,distance:ue,returnEdge:_e,vertexMode:Ve,query:Se.toJSON()}}function He(ie,ue,_e){return{left:(0,qe.j7)(ie.leftVertex.pos,ue,_e),right:(0,qe.j7)(ie.rightVertex.pos,ue,_e)}}function L(ie){return ie.createQuery()}(ie=Re||(Re={}))[ie.TARGET=0]="TARGET",ie[ie.REFERENCE=1]="REFERENCE",ie[ie.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION";const K=Symbol("snapping-toggle");function Ze(ie,ue=(()=>{})){const _e=(0,ne.YP)(()=>({view:ie.view,snappingOptions:ie.snappingOptions}),({view:Ve,snappingOptions:Ae})=>{if(ie.removeHandles(K),!Ve||!Ae)return;const Ke=T.f.TOOL,Ue=[Ve.on("key-down",Se=>{Se.key!==Ee.Kj.toggle||Se.repeat||(Ae.enabledToggled=!0,ue())},Ke),Ve.on("key-up",Se=>{Se.key===Ee.Kj.toggle&&(Ae.enabledToggled=!1,ue())},Ke),Ve.on("pointer-move",Se=>{const an=Se.native.ctrlKey;Ae.enabledToggled!==an&&(Ae.enabledToggled=an,ue())},Ke)];ie.addHandles(Ue,K)},ne.tX);ie.addHandles(_e)}function ge(ie){return(0,se.s)(ie)&&"utilityNetworks"in ie&&!!ie.utilityNetworks?.length}},26362:(Je,Pe,C)=>{C.d(Pe,{$7:()=>Ve,Au:()=>Ze,CJ:()=>K,Jk:()=>Se,Nn:()=>de,SD:()=>qe,UG:()=>L,Yf:()=>ue,ZE:()=>ve,fK:()=>se,hA:()=>Ae,hm:()=>Qe,rq:()=>Ke,sc:()=>Re,z9:()=>ee,zf:()=>Ue});var ne=C(21286),D=C(95470),X=C(15331),Z=C(79800),G=C(29302),te=C(86670),V=C(90014),T=C(98943),Ee=C(396);function qe({start:W,end:B,type:J},he,oe){const pe=[],ce=(0,D.$X)(yt,B,W),ze=(0,D.$X)(kt,W,he),Ce=(0,D.we)(ce),Oe=2*(0,D.AK)(ce,ze),Ge=Oe*Oe-4*Ce*((0,D.we)(ze)-oe*oe);if(0===Ge){const De=-Oe/(2*Ce);(J===Se.PLANE||De>=0)&&pe.push((0,D.od)((0,X.Ue)(),W,ce,De))}else if(Ge>0){const De=Math.sqrt(Ge),xe=(-Oe+De)/(2*Ce);(J===Se.PLANE||xe>=0)&&pe.push((0,D.od)((0,X.Ue)(),W,ce,xe));const je=(-Oe-De)/(2*Ce);(J===Se.PLANE||je>=0)&&pe.push((0,D.od)((0,X.Ue)(),W,ce,je))}return pe}function se(W,B){const J=W.start,oe=(0,D.$X)(yt,W.end,J),pe=(0,Z.s)(Gt,-oe[1],oe[0],0),ce=B.start,Ce=(0,Z.z)(on,B.end,ce),Oe=(0,Z.k)(Ce,pe),Ge=(0,Z.s)(Mn,J[0],J[1],0),De=(0,Z.z)(En,Ge,ce),xe=(0,Z.k)(De,pe),je=(0,te.bn)();if(Math.abs(Oe)<je)return Math.abs(xe),[];const We=(0,Z.r)(ct,ce,Ce,xe/Oe);if(B.type===Ee.SP.RAY){const st=(0,Z.z)(Ht,We,ce);if((0,Z.k)(st,Ce)<-je)return[]}if(W.type===Se.HALF_PLANE){const st=(0,D.lu)(kt,We,J);if((0,D.AK)(st,oe)<-je)return[]}return[(0,G.d9)(We)]}function Qe(W,B){return function ge({start:W,end:B,type:J},he){const oe=(0,Z.z)(Vt,he,W),pe=(0,Z.z)(Gt,B,W),ce=(0,Z.b)(on,pe,oe),ze=(0,Z.x)(ce)/(0,Z.x)(pe),Ce=(0,te.bn)();if(ze<Ce)switch(J){case Ee.SP.LINE:return[(0,G.d9)(he)];case Ee.SP.RAY:return(0,Z.k)(pe,oe)<-Ce?[]:[(0,G.d9)(he)]}return[]}(_e(ln,B[2],W),B)}function de(W,B){return Ze(_e(ln,0,W),_e(In,0,B)).map(([he,oe])=>(0,X.al)(he,oe))}function ee(W,B){return ve(W,_e(ln,W[2],B))}function Re(W,B,J){const he=(0,D.$X)(yt,W,B),oe=(0,D.kE)(he),pe=0===oe?1:J/oe,ce=(0,G.Ue)();return(0,D.od)(ce,B,he,pe),ce[2]=W[2],ce}function ve(W,{start:B,end:J,type:he},oe=(0,G.Ue)()){const pe=(0,Z.z)(Vt,W,B),ce=(0,Z.z)(Gt,J,B),ze=(0,Z.k)(pe,ce)/(0,Z.k)(ce,ce);return(0,Z.r)(oe,B,ce,he===Ee.SP.RAY?Math.max(ze,0):ze)}const L=(()=>{const W=(0,G.Ue)(),B=(0,G.Ue)(),J=(0,G.Ue)();return({start:he,end:oe},{center:pe,radius:ce,normal:ze,slicePlane:Ce})=>{const Oe=(0,V.Yq)(pe,ze,Cn);if(Ae((0,V.TE)(Oe,he),0)&&Ae((0,V.TE)(Oe,oe),0)){(0,T._F)(ze,W,B);const De=(We,st)=>((0,Z.f)(J,st,pe),(0,D.t8)(We,(0,Z.k)(J,W),(0,Z.k)(J,B)),We),xe=(0,Ee.UG)({start:De(yt,he),end:De(kt,oe),type:Ee.SP.LINE},X.AG,ce),je=[];for(const[We,st]of xe){const dt=(0,Z.c)((0,G.Ue)(),pe);(0,Z.r)(dt,dt,W,We),(0,Z.r)(dt,dt,B,st),Ce&&!Ue(Ce,dt)||je.push(dt)}return je}const Ge=(0,G.Ue)();return(0,V.fn)(Oe,he,oe,Ge)?!Ae((0,Z.q)(Ge,pe),ce)||Ce&&!Ue(Ce,Ge)?[]:[Ge]:[]}})();function K({start:W,end:B,type:J},he,oe){const pe=[],ce=(0,Z.f)(Vt,B,W),ze=(0,D.$X)(kt,W,he),Ce=(0,D.we)(ce),Oe=2*(0,D.AK)(ce,ze),Ge=Oe*Oe-4*Ce*((0,D.we)(ze)-oe*oe);if(0===Ge){const De=-Oe/(2*Ce);(J===Ee.SP.LINE||De>=0)&&pe.push((0,Z.r)((0,G.Ue)(),W,ce,De))}else if(Ge>0){const De=Math.sqrt(Ge),xe=(-Oe+De)/(2*Ce);(J===Ee.SP.LINE||xe>=0)&&pe.push((0,Z.r)((0,G.Ue)(),W,ce,xe));const je=(-Oe-De)/(2*Ce);(J===Ee.SP.LINE||je>=0)&&pe.push((0,Z.r)((0,G.Ue)(),W,ce,je))}return pe}function Ze(W,B){const J=W.start,oe=B.start,pe=B.end,ce=(0,Z.z)(Vt,W.end,J),ze=(0,Z.z)(Gt,pe,oe),Ce=(0,Z.z)(on,oe,J),Oe=(0,Z.b)(Mn,ce,ze);if(!Ae((0,Z.k)(Ce,Oe),0))return[];const Ge=(0,Z.x)(Oe);if(Ae(Ge,0))return[];const De=(0,Z.b)(En,Ce,ze),xe=(0,Z.k)(De,Oe)/Ge,je=(0,Z.r)(ct,J,ce,xe);if(W.type===Ee.SP.RAY){const We=(0,Z.z)(Ht,je,J);if((0,Z.k)(ce,We)<-(0,te.bn)())return[]}if(B.type===Ee.SP.RAY){const We=(0,Z.z)(Ht,je,oe);if((0,Z.k)(ze,We)<-(0,te.bn)())return[]}return[(0,G.d9)(je)]}function ue(W,B,J,he){const[oe,pe]=W,[ce,ze]=J,Ce=ce-oe,Oe=ze-pe,Ge=Ce*Ce+Oe*Oe,De=Math.sqrt(Ge);if(De>B+he)return[];if(De<Math.abs(B-he))return[];if(Ae(De,0)&&Ae(B,he))return[];const xe=(B*B-he*he+Ge)/(2*De),je=Math.sqrt(B*B-xe*xe),We=je*Oe/De,st=je*Ce/De,[dt,Xt]=(0,D.t7)(yt,W,J,xe/De);return Ae(We,st)?[(0,X.al)(dt,Xt)]:[(0,X.al)(dt+We,Xt-st),(0,X.al)(dt-We,Xt+st)]}function _e(W,B,{start:J,end:he,type:oe}){return(0,Z.s)(W.start,J[0],J[1],B),(0,Z.s)(W.end,he[0],he[1],B),W.type=an[oe],W}function Ve(W,B){return Ae(W[2],B[2])}function Ae(W,B){return(0,ne.W8)(Math.abs(W-B),0,(0,te.bn)())}function Ke(W,B){return B.filter(J=>Ue(W,J))}function Ue(W,B){return(0,V.Ac)(W,B)}var Se,W;(W=Se||(Se={}))[W.PLANE=0]="PLANE",W[W.HALF_PLANE=1]="HALF_PLANE";const an={[Se.PLANE]:Ee.SP.LINE,[Se.HALF_PLANE]:Ee.SP.RAY},yt=(0,X.Ue)(),kt=(0,X.Ue)(),Vt=(0,G.Ue)(),Gt=(0,G.Ue)(),on=(0,G.Ue)(),Mn=(0,G.Ue)(),En=(0,G.Ue)(),ct=(0,G.Ue)(),Ht=(0,G.Ue)(),Cn=(0,V.Ue)(),ln={start:(0,G.Ue)(),end:(0,G.Ue)(),type:Ee.SP.LINE},In={start:(0,G.Ue)(),end:(0,G.Ue)(),type:Ee.SP.LINE}}}]);