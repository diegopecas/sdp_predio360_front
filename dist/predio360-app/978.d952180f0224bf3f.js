"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[978],{65389:(K,B,d)=>{d.d(B,{Z:()=>v});var w=d(62208);class v{constructor(o){this.size=0,this._start=0,this.maxSize=o,this._buffer=new Array(o)}get entries(){return this._buffer}enqueue(o){if(this.size===this.maxSize){const s=this._buffer[this._start];return this._buffer[this._start]=o,this._start=(this._start+1)%this.maxSize,s}return this._buffer[(this._start+this.size++)%this.maxSize]=o,null}dequeue(){if(0===this.size)return null;const o=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,o}peek(){return 0===this.size?null:this._buffer[this._start]}find(o){if(0===this.size)return null;for(const s of this._buffer)if((0,w.pC)(s)&&o(s))return s;return null}clear(o){let s=this.dequeue();for(;(0,w.pC)(s);)o&&o(s),s=this.dequeue()}}},28082:(K,B,d)=>{d.d(B,{H:()=>y});var w=d(15861),v=d(26584),C=d(8314),o=d(63290),s=d(62208),m=d(10699),i=d(39351),u=d(99666),a=d(87526),E=d(31982),R=d(67969),P=d(85775),V=d(55086);const O=o.Z.getLogger("esri.views.2d.engine.webgl.AttributeStoreView"),F=(0,E.g)(E.J,O);class c{constructor(r,_,f){this._texture=null,this._lastTexture=null,this._fbos={},this.texelSize=4;const{buffer:p,pixelType:x,textureOnly:D}=r,S=(0,a.UK)(x);this.shared=f,this.pixelType=x,this.size=_,this.textureOnly=D,D||(this.data=new S((0,s.Wg)(p))),this._resetRange()}destroy(){(0,s.yw)(this._texture,r=>r.dispose());for(const r in this._fbos)(0,s.yw)(this._fbos[r],_=>{"0"===r&&_.detachColorTexture(),_.dispose()}),this._fbos[r]=null;this._texture=null}get _textureDesc(){return{target:R.No.TEXTURE_2D,wrapMode:R.e8.CLAMP_TO_EDGE,pixelFormat:R.VI.RGBA,dataType:this.pixelType,samplingMode:R.cw.NEAREST,width:this.size,height:this.size}}setData(r,_,f){const p=(0,u.jL)(r),x=(0,s.Wg)(this.data),D=p*this.texelSize+_;!x||D>=x.length||(x[D]=f,this.dirtyStart=Math.min(this.dirtyStart,p),this.dirtyEnd=Math.max(this.dirtyEnd,p))}getData(r,_){if((0,s.Wi)(this.data))return null;const f=(0,u.jL)(r)*this.texelSize+_;return!this.data||f>=this.data.length?null:this.data[f]}getTexture(r){return(0,s.Pt)(this._texture,()=>this._initTexture(r))}getFBO(r,_=0){if((0,s.Wi)(this._fbos[_])){const f={colorTarget:R.Lm.TEXTURE,depthStencilTarget:R.OU.NONE},p=0===_?this.getTexture(r):this._textureDesc;this._fbos[_]=new P.X(r,f,p)}return this._fbos[_]}get locked(){return!(this.pixelType!==R.Br.UNSIGNED_BYTE||!this.shared||this.textureOnly||!(0,C.Z)("esri-atomics")||!this.data)&&1===Atomics.load(this.data,0)}get hasDirty(){return this.dirtyEnd>=this.dirtyStart}updateTexture(r,_){if(!this.locked){try{const f=this.dirtyStart,p=this.dirtyEnd;if(!this.hasDirty)return;this._resetRange();const x=(0,s.Wg)(this.data).buffer,D=this.getTexture(r),S=4,z=(f-f%this.size)/this.size,N=z,Z=(p-p%this.size)/this.size,Y=z*this.size*S,$=(this.size+Z*this.size)*S-Y,H=(0,a.UK)(this.pixelType),Q=new H(x,Y*H.BYTES_PER_ELEMENT,$),q=this.size,J=Z-N+1;if(J>this.size)return void O.error(new v.Z("mapview-webgl","Out-of-bounds index when updating AttributeData"));D.updateData(0,0,N,q,J,Q)}catch{}_()}}update(r){const{data:_,start:f,end:p}=r;if((0,s.pC)(_)&&(0,s.pC)(this.data)){const x=this.data,D=f*this.texelSize;for(let S=0;S<_.length;S++)r.layout&1<<S%this.texelSize&&(x[D+S]=_[S])}this.dirtyStart=Math.min(this.dirtyStart,f),this.dirtyEnd=Math.max(this.dirtyEnd,p)}resize(r,_){const f=this.size;if(this.size=_,this.textureOnly)return void(f!==this.size&&(this._lastTexture=this._texture,this._texture=null));const p=(0,a.UK)(this.pixelType);this.destroy(),this.data=new p((0,s.Wg)(r.buffer))}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}_initTexture(r){const _=new V.x(r,this._textureDesc,(0,s.Pt)(this.data,void 0));if((0,s.pC)(this._lastTexture)&&this._fbos[0]){const f=this._lastTexture.descriptor.width,p=this._lastTexture.descriptor.height,x=this._lastTexture.descriptor.dataType,D=this._lastTexture.descriptor.pixelFormat,S=this.getFBO(r),z=(0,a.Yw)(x),G=new((0,a.UK)(x))(new ArrayBuffer(f*p*z*this.texelSize)),N=r.getBoundFramebufferObject(),{x:X,y:Z,width:Y,height:$}=r.getViewport();r.bindFramebuffer(S),S.readPixels(0,0,f,p,D,x,G),_.updateData(0,0,0,2*f,p/2,G),r.setViewport(X,Z,Y,$),r.bindFramebuffer(N)}return this.destroy(),this._texture=_,this._texture}}class y{constructor(r){this._onUpdate=r,this._initialized=!1,this._forceNextUpload=!1,this._locked=!1}initialize(r){const{blocks:_,shared:f,size:p}=r;if(this.shared=f,this.size=p,F("Initializing AttributeStoreView",r),(0,s.Wi)(this._data))this._data=(0,s.Fd)(_,x=>new c(x,p,f));else for(let x=0;x<this._data.length;x++){const D=this._data[x],S=_[x];(0,s.pC)(S)&&((0,s.Wi)(D)?this._data[x]=new c(S,p,f):D.resize(S,p))}this._initialized=!0}destroy(){(0,s.yw)(this._data,r=>(0,s.Fd)(r,_=>_.destroy())),(0,s.yw)(this._defaultTexture,r=>r.dispose())}isEmpty(){return(0,s.Wi)(this._data)}isUpdating(){const r=(0,s.pC)(this._pendingAttributeUpdate),_=r;return(0,C.Z)("esri-2d-log-updating")&&console.log(`Updating AttributeStoreView ${_}\n  -> hasPendingUpdate ${r}`),_}getBlock(r){return(0,s.Wi)(this._data)?null:this._data[r]}setLabelMinZoom(r,_){this.setData(r,0,1,_)}getLabelMinZoom(r){return this.getData(r,0,1,255)}getFilterFlags(r){return this.getData(r,0,0,0)}getVVSize(r){return this.getData(r,i.aK,0,0)}getData(r,_,f,p){if(!this._data)return 0;const x=(0,s.Wg)(this._data)[_];if((0,s.Wi)(x))return 0;const D=x.getData(r,f);return(0,s.pC)(D)?D:p}setData(r,_,f,p){const x=(0,s.Wg)(this._data)[_];(0,s.Wg)(x).setData(r,f,p)}lockTextureUpload(){this._locked=!0}unlockTextureUpload(){this._locked=!1}forceTextureUpload(){this._forceNextUpload=!0}requestUpdate(r){var _=this;return(0,w.Z)(function*(){if(_._pendingAttributeUpdate)return void O.error(new v.Z("mapview-webgl","Tried to update attribute data with a pending update"));const f=(0,m.hh)();return F("AttributeStoreView Update Requested",r),_._pendingAttributeUpdate={data:r,resolver:f},_._onUpdate(),f.promise})()}update(){if(this._initialized&&(0,s.pC)(this._pendingAttributeUpdate)){(0,C.Z)("esri-2d-update-debug")&&console.debug("AttributeStoreView::update");const{data:r,resolver:_}=this._pendingAttributeUpdate,f=(0,s.Wg)(this._data);for(let p=0;p<r.blocks.length;p++){const x=r.blocks[p];(0,s.yw)(f[p],S=>(0,s.yw)(x,z=>{F(`Updating block ${p}`,z),S.update(z)}))}this._pendingAttributeUpdate=null,_(),this._onUpdate()}}bindTextures(r,_=!0){const f=this._getDefaultTexture(r);if(!this._initialized)return r.bindTexture(f,i.iJ),void(_&&(r.bindTexture(f,i.nM),r.bindTexture(f,i.Ij),r.bindTexture(f,i.f2),r.bindTexture(f,i.By),r.bindTexture(f,i.mx),r.bindTexture(f,i.Xj)));const p=(0,s.Wg)(this._data);this._locked&&!this._forceNextUpload||((0,s.JR)(p,x=>x.updateTexture(r,()=>this._onUpdate())),this._forceNextUpload=!1),r.bindTexture((0,s.R2)(p[i._5],f,x=>x.getTexture(r)),i.iJ),_&&(r.bindTexture((0,s.R2)(p[i.pU],f,x=>x.getTexture(r)),i.Xj),r.bindTexture((0,s.R2)(p[i.xl],f,x=>x.getTexture(r)),i.nM),r.bindTexture((0,s.R2)(p[i.aK],f,x=>x.getTexture(r)),i.Ij),r.bindTexture((0,s.R2)(p[i.lK],f,x=>x.getTexture(r)),i.f2),r.bindTexture((0,s.R2)(p[i.By],f,x=>x.getTexture(r)),i.By),r.bindTexture((0,s.R2)(p[i.mx],f,x=>x.getTexture(r)),i.mx))}_getDefaultTexture(r){return(0,s.Wi)(this._defaultTexture)&&(this._defaultTexture=new V.x(r,{wrapMode:R.e8.CLAMP_TO_EDGE,pixelFormat:R.VI.RGBA,dataType:R.Br.UNSIGNED_BYTE,samplingMode:R.cw.NEAREST,width:1,height:1},new Uint8Array(4))),this._defaultTexture}}},2172:(K,B,d)=>{d.d(B,{Q:()=>i,g:()=>s});var w=d(8314),v=d(62208),C=d(31823);const o=(0,w.Z)("esri-2d-log-allocations");class s{constructor(a,E){this._array=a,this._pool=E}get array(){return this._array}get length(){return this._array.length}static create(a,E){const R=E.acquire(a);return new s(R,E)}expand(a){const E=this._pool.acquire(a);E.set(this._array),this._pool.release(this._array),this._array=E}destroy(){this._pool.release(this._array)}set(a,E){this._array.set(a._array,E)}slice(){const a=this._pool.acquire(this._array.byteLength);return a.set(this._array),new s(a,this._pool)}}class m{constructor(){this._data=new ArrayBuffer(m.BYTE_LENGTH),this._freeList=new C.m({start:0,end:this._data.byteLength})}static get BYTE_LENGTH(){return 64e6}get buffer(){return this._data}allocate(a){const E=this._freeList.firstFit(a);return(0,v.Wi)(E)?null:new Uint32Array(this._data,E,a/Uint32Array.BYTES_PER_ELEMENT)}free(a){this._freeList.free(a.byteOffset,a.byteLength)}}class i{constructor(){this._bytesAllocated=0,this._pages=[],this._pagesByBuffer=new Map,this._addPage()}destroy(){this._pages=[],this._pagesByBuffer=null}get _bytesTotal(){return this._pages.length*m.BYTE_LENGTH}acquire(a){if(this._bytesAllocated+=a,o&&console.log(`Allocating ${a}, (${this._bytesAllocated} / ${this._bytesTotal})`),a>m.BYTE_LENGTH)return new Uint32Array(a/Uint32Array.BYTES_PER_ELEMENT);for(const E of this._pages){const R=E.allocate(a);if((0,v.pC)(R))return R}return(0,v.s3)(this._addPage().allocate(a),"Expected to allocate page")}release(a){this._bytesAllocated-=a.byteLength,o&&console.log(`Freeing ${a.byteLength}, (${this._bytesAllocated} / ${this._bytesTotal})`);const E=this._pagesByBuffer.get(a.buffer);E&&E.free(a)}_addPage(){const a=new m;return this._pages.push(a),this._pagesByBuffer.set(a.buffer,a),a}}},99666:(K,B,d)=>{d.d(B,{KS:()=>a,PX:()=>s,QS:()=>R,_I:()=>w,jL:()=>u,nE:()=>E,vs:()=>i,xp:()=>m});const w=8388607,v=8388608,s=0,m=1,i=P=>(P&v)>>>23,u=P=>P&w,a=P=>i(P)===m?254:255;function E(P){return i(P)===m}function R(P,V){return((V?v:0)|P)>>>0}},26268:(K,B,d)=>{d.d(B,{Z:()=>i});var w=d(8314),v=d(39406),C=d(44589),o=d(8650),s=d(13382);const m=(u,a)=>u.key.level-a.key.level!=0?u.key.level-a.key.level:u.key.row-a.key.row!=0?u.key.row-a.key.row:u.key.col-a.key.col;class i extends C.Z{constructor(a){super(),this._tileInfoView=a}get requiresDedicatedFBO(){return!1}renderChildren(a){this.sortChildren(m),this.setStencilReference(a),super.renderChildren(a)}createRenderParams(a){const{state:E}=a,R=super.createRenderParams(a);return R.requiredLevel=this._tileInfoView.getClosestInfoForScale(E.scale).level,R.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(E.scale),R}prepareRenderPasses(a){const E=super.prepareRenderPasses(a);return E.push(a.registerRenderPass({name:"stencil",brushes:[s.Z],drawPhase:v.jx.DEBUG|v.jx.MAP|v.jx.HIGHLIGHT,target:()=>this.getStencilTarget()})),(0,w.Z)("esri-tiles-debug")&&E.push(a.registerRenderPass({name:"tileInfo",brushes:[o.Z],drawPhase:v.jx.DEBUG,target:()=>this.children})),E}getStencilTarget(){return this.children}setStencilReference(a){let E=1;for(const R of this.children)R.stencilRef=E++}}},29443:(K,B,d)=>{d.d(B,{o:()=>u});var w=d(31478),v=d(12225),C=d(30217),o=d(49966),s=d(39351),m=d(43783);class u extends m.I{constructor(E,R,P,V){super(E,R,P,V,s.I_,s.I_)}destroy(){super.destroy(),this._transforms&&u.TransformCache.release(this.key.hash)}setTransform(E){const R=this.resolution/E.resolution,P=this.transforms.tileMat3,[V,O]=E.toScreenNoRotation([0,0],[this.x,this.y]),F=this.width/this.rangeX*R,c=this.height/this.rangeY*R;(0,C.s)(P,F,0,0,0,c,0,V,O,1),(0,C.m)(this.transforms.dvs,E.displayViewMat3,P);const y=this.transforms.labelMat2d,T=window.devicePixelRatio,r=(0,w.d)((0,v.c)(),F*T,0,0,c*T,V*T,O*T);(0,w.m)(y,E.viewMat2d,r)}_createTransforms(){return u.TransformCache.acquire(this.key.hash)}}u.TransformCache=new class i{acquire(E){return{refCount:1,version:-1,labelMat2d:(0,v.c)(),tileMat3:(0,o.c)(),dvs:(0,o.c)()}}release(E){}}},37633:(K,B,d)=>{d.d(B,{$:()=>o});var w=d(62208),v=d(39351);const C=2147483647;class o{constructor(i){this._head=i,this._cursor=i}static from(i,u=0,a=i.byteLength/s.BYTES_PER_RECORD-u){const E=new s(new Int32Array(i,u*s.BYTES_PER_RECORD,a*s.ELEMENTS_PER_RECORD));return new o(E)}size(){let i=this._cursor,u=0;for(;i;)u+=i.size(),i=i._link;return u}get id(){return this._cursor.id}set id(i){this._cursor.id=i}get materialKey(){return this._cursor.materialKey}set materialKey(i){this._cursor.materialKey=i}get insertAfter(){return this._cursor.insertAfter}get indexFrom(){return this._cursor.indexFrom}set indexFrom(i){this._cursor.indexFrom=i}get indexCount(){return this._cursor.indexCount}set indexCount(i){this._cursor.indexCount=i}get vertexFrom(){return this._cursor.vertexFrom}set vertexFrom(i){this._cursor.vertexFrom=i}get vertexCount(){return this._cursor.vertexCount}set vertexCount(i){this._cursor.vertexCount=i}get sortKey(){return this._cursor.sortKey}set sortKey(i){this._cursor.sortKey=i}get index(){return this._cursor._indexStart+this._cursor._index}seekIndex(i){let u=i;for(this._cursor=this._head;this._cursor;){const a=this._cursor.size();if(u<a)return this._cursor._index=u,!0;u-=a,this._cursor=this._cursor._link}return!1}forEach(i){const u=this.getCursor();for(;u.next();)i(u)}link(i){if(!this._head)return void(this._head=i._head);let u=this._head;for(;u._link;)u=u._link;u._link=i._head,u._link._indexStart=u._indexStart+u.size()}getCursor(){return this.copy()}lookup(i){for(this._cursor=this._head;this._cursor&&!this._cursor.lookup(i);){if(!this._cursor._link)return!1;this._cursor=this._cursor._link}return!!this._cursor}copy(){const i=new o(this._head?.copy());if(!i._head)return i;let u=i._head,a=i._head._link;for(;a;)u._link=a.copy(),u=a,a=u._link;return i}next(){return!!this._cursor&&(!!this._cursor.next()||!!this._cursor._link&&(this._cursor=this._cursor._link,this.next()))}peekId(){return this._cursor.peekId()??this._cursor._link.peekId()}delete(i){let u=this._head,a=null;for(;u;){if(u.delete(i))return u.isEmpty()&&((0,w.pC)(a)&&(a._link=u._link),u===this._head&&(this._head=u._link),u===this._cursor&&(this._cursor=u._link)),!0;a=u,u=u._link}return!1}}o.ELEMENTS_PER_RECORD=v.XJ,o.BYTES_PER_RECORD=o.ELEMENTS_PER_RECORD*Int32Array.BYTES_PER_ELEMENT;class s{constructor(i){this._link=null,this._index=-1,this._indexStart=0,this._packedRecordsF32=null,this._deletedCount=0,this._offsets={instance:null},this._packedRecords=i}static from(i,u=0,a=i.byteLength/this.BYTES_PER_RECORD-u){return new s(new Int32Array(i,u*this.BYTES_PER_RECORD,a*this.ELEMENTS_PER_RECORD))}delete(i){const u=this._index,a=this.lookup(i);if(a)for(this.id=C,++this._deletedCount;this.next()&&this.id===i;)this.id=C,++this._deletedCount;return this._index=u,a}isEmpty(){return this._deletedCount===this.size()}link(i){this._link?this._link.link(i):this._link=i}lookup(i){if((0,w.Wi)(this._offsets.instance)){this._offsets.instance=new Map;const a=this.copy();a._index=-1;let E=0;for(;a.next();)a.id!==E&&(this._offsets.instance.set(a.id,a._index),E=a.id)}if(!this._offsets.instance.has(i))return!1;const u=this._index;return this._index=this._offsets.instance.get(i),this.id!==C||(this._index=u,!1)}get id(){return this._packedRecords[this._index*s.ELEMENTS_PER_RECORD]}set id(i){this._packedRecords[this._index*s.ELEMENTS_PER_RECORD]=i}get materialKey(){return this._packedRecords[this._index*s.ELEMENTS_PER_RECORD+1]}set materialKey(i){this._packedRecords[this._index*s.ELEMENTS_PER_RECORD+1]=i}get insertAfter(){return this._packedRecords[this._index*s.ELEMENTS_PER_RECORD+2]}get indexFrom(){return this._packedRecords[this._index*s.ELEMENTS_PER_RECORD+3]}set indexFrom(i){this._packedRecords[this._index*s.ELEMENTS_PER_RECORD+3]=i}get indexCount(){return this._packedRecords[this._index*s.ELEMENTS_PER_RECORD+4]}set indexCount(i){this._packedRecords[this._index*s.ELEMENTS_PER_RECORD+4]=i}get vertexFrom(){return this._packedRecords[this._index*s.ELEMENTS_PER_RECORD+5]}set vertexFrom(i){this._packedRecords[this._index*s.ELEMENTS_PER_RECORD+5]=i}get vertexCount(){return this._packedRecords[this._index*s.ELEMENTS_PER_RECORD+6]}set vertexCount(i){this._packedRecords[this._index*s.ELEMENTS_PER_RECORD+6]=i}get sortKey(){return this._packedRecordsF32||(this._packedRecordsF32=new Float32Array(this._packedRecords.buffer)),this._packedRecordsF32[this._index*s.ELEMENTS_PER_RECORD+7]}set sortKey(i){this._packedRecordsF32||(this._packedRecordsF32=new Float32Array(this._packedRecords.buffer)),this._packedRecordsF32[this._index*s.ELEMENTS_PER_RECORD+7]=i}get index(){return this._index}size(){return this._packedRecords.length/s.ELEMENTS_PER_RECORD}next(){for(;++this._index<this.size()&&this.id===C;);return this._index<this.size()}peekId(){const i=(this._index+1)*s.ELEMENTS_PER_RECORD;return i>=this._packedRecords.length?0:this._packedRecords[i]}getCursor(){return this.copy()}copy(){const i=new s(this._packedRecords);return i._indexStart=this._indexStart,i._link=this._link,i._index=this._index,i._offsets=this._offsets,i._deletedCount=this._deletedCount,i}}s.ELEMENTS_PER_RECORD=v.XJ,s.BYTES_PER_RECORD=s.ELEMENTS_PER_RECORD*Int32Array.BYTES_PER_ELEMENT},31823:(K,B,d)=>{d.d(B,{a:()=>v,m:()=>C});var w=d(62208);class v{constructor(s){if(this.next=null,!Array.isArray(s))return void(this.data=s);this.data=s[0];let m=this;for(let i=1;i<s.length;i++)m.next=new v([s[i]]),m=m.next}*values(){let s=this;for(;s;)yield s.data,s=s.next}forEach(s){let m=this;for(;m;)s(m.data),m=m.next}find(s){return s(this.data)?this:this.next?.find(s)}max(s,m=this){const i=s(this.data)>s(m.data)?this:m;return this.next?this.next.max(s,i):i}remove(s,m=null){return this===s?m?(m.next=this.next,m):this.next:this.next?.remove(s,this)??null}get last(){return this.next?this.next.last:this}}class C{constructor(s){this._head=null,(0,w.Wi)(s)||(this._head=new v(s))}get head(){return this._head}maxAvailableSpace(){if((0,w.Wi)(this._head))return 0;const s=this._head.max(m=>m.end-m.start);return s.data.end-s.data.start}firstFit(s){if((0,w.Wi)(this._head))return null;let m=null,i=this._head;for(;i;){const u=i.data.end-i.data.start;if(u===s)return m?m.next=i.next:this._head=i.next,i.data.start;if(u>s){const a=i.data.start;return i.data.start+=s,a}m=i,i=i.next}return null}free(s,m){const i=s+m;if((0,w.Wi)(this._head)){const R=new v({start:s,end:i});return void(this._head=R)}if(i<=this._head.data.start){if(i===this._head.data.start)return void(this._head.data.start-=m);const R=new v({start:s,end:i});return R.next=this._head,void(this._head=R)}let u=this._head,a=u.next;for(;a;){if(a.data.start>=i){if(u.data.end===s)return u.data.end+=m,u.data.end===a.data.start?(u.data.end+=a.data.end-a.data.start,void(u.next=a.next)):void 0;if(a.data.start===i)return void(a.data.start-=m);const R=new v({start:s,end:i});return R.next=u.next,void(u.next=R)}u=a,a=a.next}if(s===u.data.end)return void(u.data.end+=m);const E=new v({start:s,end:i});u.next=E}}},31982:(K,B,d)=>{d.d(B,{J:()=>v,g:()=>w});const w=(C,o)=>C&&((...s)=>o.warn("DEBUG:",...s))||(()=>null),v=!1},58803:(K,B,d)=>{d.r(B),d.d(B,{default:()=>ft});var w=d(15861),v=d(17626),C=d(8314),o=d(62208),s=d(10699),E=(d(63290),d(90912),d(85931),d(26584),d(76898)),R=d(65401),P=d(65389),V=d(12225),O=d(39406),F=d(87526),c=d(29443);const T=4294967296;class r{constructor(t){this._savedCursor=null,this._savedOffset=null,this._head=t,this._cursor=t}static from(t){const e=_.from(new Float32Array(t));return new r(e)}get id(){return this._cursor.id}get baseZoom(){return this._cursor.baseZoom}get anchorX(){return this._cursor.anchorX}get anchorY(){return this._cursor.anchorY}get directionX(){return this._cursor.directionX}get directionY(){return this._cursor.directionY}get size(){return this._cursor.size}get materialKey(){return this._cursor.materialKey}get boundsCount(){return this._cursor.boundsCount}computedMinZoom(){return this._cursor.computedMinZoom()}setComputedMinZoom(t){return this._cursor.setComputedMinZoom(t)}boundsComputedAnchorX(t){return this._cursor.boundsComputedAnchorX(t)}boundsComputedAnchorY(t){return this._cursor.boundsComputedAnchorY(t)}setBoundsComputedAnchorX(t,e){return this._cursor.setBoundsComputedAnchorX(t,e)}setBoundsComputedAnchorY(t,e){return this._cursor.setBoundsComputedAnchorY(t,e)}boundsX(t){return this._cursor.boundsX(t)}boundsY(t){return this._cursor.boundsY(t)}boundsWidth(t){return this._cursor.boundsWidth(t)}boundsHeight(t){return this._cursor.boundsHeight(t)}link(t){if((0,o.pC)(t._head))return this._cursor.link(t._head)}getCursor(){return this.copy()}copy(){const t=new r(this._head?.copy());if(!t._head)return t;let e=t._head,n=t._head._link;for(;n;)e._link=n.copy(),e=n,n=e._link;return t}peekId(){return this._cursor.peekId()??this._cursor._link.peekId()}nextId(){const t=this.id;for(;t===this.id;)if(!this.next())return!1;return!0}save(){this._savedCursor=this._cursor,this._savedOffset=this._cursor._offset}restore(){this._savedCursor&&(this._cursor=this._savedCursor),null!=this._savedOffset&&(this._cursor._offset=this._savedOffset)}next(){if(!this._cursor)return!1;if(!this._cursor.next()){if(!this._cursor._link)return!1;this._cursor=this._cursor._link,this._cursor._offset=0}return!0}lookup(t){for(this._cursor=this._head;this._cursor&&!this._cursor.lookup(t);){if(!this._cursor._link)return!1;this._cursor=this._cursor._link}return!!this._cursor}delete(t){let e=this._head,n=null;for(;e;){if(e.delete(t))return e.isEmpty()&&(0,o.pC)(n)&&(n._link=e._link),!0;n=e,e=e._link}return!1}}class _{constructor(t){this._offset=-1,this._link=null,this._count=0,this._deletedCount=0,this._offsets={instance:null},this._buffer=t}static from(t){return new _(new Float32Array(t))}isEmpty(){return this._deletedCount===this.count}get count(){return this._count||(this._count=this._computeCount()),this._count}get id(){return this._buffer[this._offset+0]}set id(t){this._buffer[this._offset+0]=t}get baseZoom(){return this._buffer[this._offset+1]}get anchorX(){return this._buffer[this._offset+2]}get anchorY(){return this._buffer[this._offset+3]}get directionX(){return this._buffer[this._offset+4]}get directionY(){return this._buffer[this._offset+5]}get size(){return this._buffer[this._offset+6]}get materialKey(){return this._buffer[this._offset+7]}computedMinZoom(){return this._buffer[this._offset+8]}setComputedMinZoom(t){this._buffer[this._offset+8]=t}get boundsCount(){return this._buffer[this._offset+9]}boundsComputedAnchorX(t){return this._buffer[this._offset+10+6*t+0]}boundsComputedAnchorY(t){return this._buffer[this._offset+10+6*t+1]}setBoundsComputedAnchorX(t,e){this._buffer[this._offset+10+6*t+0]=e}setBoundsComputedAnchorY(t,e){this._buffer[this._offset+10+6*t+1]=e}boundsX(t){return this._buffer[this._offset+10+6*t+2]}boundsY(t){return this._buffer[this._offset+10+6*t+3]}boundsWidth(t){return this._buffer[this._offset+10+6*t+4]}boundsHeight(t){return this._buffer[this._offset+10+6*t+5]}link(t){let e=this;for(;e._link;)e=e._link;e._link=t}getCursor(){return this.copy()}copy(){const t=new _(this._buffer);return t._link=this._link,t._offset=this._offset,t._deletedCount=this._deletedCount,t._offsets=this._offsets,t._count=this._count,t}peekId(){const t=this._offset+10+6*this.boundsCount+0;return t>=this._buffer.length?0:this._buffer[t]}next(){let t=0;for(;this._offset<this._buffer.length&&t++<100&&(-1===this._offset?this._offset=0:this._offset+=10+6*this.boundsCount,this.id===T););return this.id!==T&&this._offset<this._buffer.length}delete(t){const e=this._offset,n=this.lookup(t);if(n)for(this.id=4294967295,++this._deletedCount;this.next()&&this.id===t;)this.id=4294967295,++this._deletedCount;return this._offset=e,n}lookup(t){const e=this._offset;if((0,o.Wi)(this._offsets.instance)){this._offsets.instance=new Map;const n=this.copy();n._offset=-1;let h=0;for(;n.next();)n.id!==h&&(this._offsets.instance.set(n.id,n._offset),h=n.id)}return!!this._offsets.instance.has(t)&&(this._offset=this._offsets.instance.get(t),this.id!==T||(this._offset=e,!1))}_computeCount(){const t=this._offset;let e=0;for(this._offset=-1;this.next();)e++;return this._offset=t,e}}var f=d(31823);class p{constructor(t,e,n,h,l){this.target=t,this.geometryType=e,this.materialKey=n,this.indexFrom=h,this.indexCount=l}get indexEnd(){return this.indexFrom+this.indexCount}extend(t){this.indexCount+=t}}class x{constructor(t,e){this.geometryType=0,this._target=t,this.geometryType=e}static from(t,e,n,h){const l=new x(t,e);if((0,o.pC)(h))for(const g of h)n.seekIndex(g),l.addRecord(n);else for(;n.next();)l.addRecord(n);return l}addRecord(t){const e=this._target,n=this.geometryType,h=t.materialKey;let l=t.indexFrom,g=t.indexCount;if(g||(l=t.vertexFrom,g=t.vertexCount),(0,o.Wi)(this._head)){const k=new p(e,n,h,l,g);return void(this._head=new f.a(k))}let A=null,U=this._head;for(;U;){if(l<U.data.indexFrom)return this._insert(h,l,g,A,U);A=U,U=U.next}this._insert(h,l,g,A,null)}forEach(t){(0,o.pC)(this._head)&&this._head.forEach(t)}*infos(){if((0,o.pC)(this._head))for(const t of this._head.values())yield t}_insert(t,e,n,h,l){if((0,o.Wi)(h)&&(0,o.Wi)(l)){const g=new p(this._target,this.geometryType,t,e,n);this._head=new f.a(g)}return(0,o.Wi)(h)&&(0,o.pC)(l)?this._insertAtHead(t,e,n,l):(0,o.pC)(h)&&(0,o.Wi)(l)?this._insertAtEnd(t,e,n,h):(0,o.pC)(h)&&(0,o.pC)(l)?this._insertAtMiddle(t,e,n,h,l):void 0}_insertAtHead(t,e,n,h){if(t===h.data.materialKey&&e+n===h.data.indexFrom)h.data.indexFrom=e,h.data.indexCount+=n;else{const g=new p(this._target,this.geometryType,t,e,n);this._head=new f.a(g),this._head.next=h}}_insertAtEnd(t,e,n,h){if(h.data.materialKey===t&&h.data.indexEnd===e)h.data.indexCount+=n;else{const l=new p(this._target,this.geometryType,t,e,n),g=new f.a(l);h.next=g}}_insertAtMiddle(t,e,n,h,l){const g=e+n;if(h.data.materialKey===t&&h.data.indexEnd===e)h.data.indexCount+=n,h.data.materialKey===l.data.materialKey&&h.data.indexEnd===l.data.indexFrom&&(h.data.indexCount+=l.data.indexCount,h.next=l.next);else if(t===l.data.materialKey&&g===l.data.indexFrom)l.data.indexFrom=e,l.data.indexCount+=n;else{const L=new p(this._target,this.geometryType,t,e,n),M=new f.a(L);h.next=M,M.next=l}}}var D=d(2172),S=d(83994),z=d(67969);class Z{constructor(t,e,n,h){const l=D.g.create(e*n*Uint32Array.BYTES_PER_ELEMENT,h);this.size=e,this.strideInt=n,this.bufferType=t,this.dirty={start:1/0,end:0},this._gpu=null,this._cpu=l,this.clear()}get elementSize(){return this._cpu.length/this.strideInt}get invalidated(){return this.bufferSize>0&&!this._gpu}get invalidatedComputeBuffer(){return this.bufferSize>0&&!this._gpuComputeTriangles}invalidate(){this._invalidateTriangleBuffer(),(0,o.yw)(this._gpu,t=>t.dispose()),this._gpu=null}_invalidateTriangleBuffer(){(0,o.yw)(this._gpuComputeTriangles,t=>t.dispose()),this._gpuComputeTriangles=null}destroy(){(0,o.yw)(this._gpu,t=>t.dispose()),(0,o.yw)(this._gpuComputeTriangles,t=>t.dispose()),(0,o.yw)(this._cpu,t=>t.destroy()),(0,o.yw)(this._cpu2,t=>t.destroy())}clear(){this.dirty.start=1/0,this.dirty.end=0,this.freeList=new f.m({start:0,end:this._cpu.length/this.strideInt}),this.fillPointer=0}ensure(t){if(!(this.maxAvailableSpace()>=t)&&t*this.strideInt>this._cpu.length-this.fillPointer){this.invalidate();const e=this._cpu.length/this.strideInt,n=Math.round(1.25*(e+t));this._cpu.expand(n*this.strideInt*Uint32Array.BYTES_PER_ELEMENT),this.freeList.free(e,n-e)}}set(t,e){this._cpu.array[t]!==e&&(this._cpu.array[t]=e,this.dirty.start=Math.min(t,this.dirty.start),this.dirty.end=Math.max(t,this.dirty.end))}getGPUBuffer(t,e=!1){if(!this.bufferSize)return null;if(e){if("index"!==this.bufferType)throw new Error("Tired to get triangle buffer, but target is not an index buffer");return(0,o.Wi)(this._gpuComputeTriangles)&&(this._gpuComputeTriangles=this._createComputeBuffer(t)),this._gpuComputeTriangles}return(0,o.Wi)(this._gpu)&&(this._gpu=this._createBuffer(t)),this._gpu}getCPUBuffer(){if(!this._cpu2){const t=this._cpu.slice();this._cpu2=t}return this._cpu2.length!==this._cpu.length&&this._cpu2.expand(this._cpu.length*this._cpu.array.BYTES_PER_ELEMENT),this._cpu2.set(this._cpu),this._cpu2}get bufferSize(){return this._cpu.length/this.strideInt}maxAvailableSpace(){return this.freeList.maxAvailableSpace()}insert(t,e,n,h){const l=n*this.strideInt;if(!l)return 0;const g=e*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,L=new Uint32Array(t,g,l),M=(0,o.s3)(this.freeList.firstFit(n),"First fit region must be defined")*this.strideInt,A=l,U=M/this.strideInt-e;if(0!==h)for(let k=0;k<L.length;k++)L[k]+=h;return this._cpu.array.set(L,M),this.dirty.start=Math.min(this.dirty.start,M),this.dirty.end=Math.max(this.dirty.end,M+A),this.fillPointer=Math.max(this.fillPointer,M+A),U}free(t,e,n){const h=t*this.strideInt,l=(t+e)*this.strideInt;if(!0===n)for(let g=t;g!==t+e;g++)this._cpu.array[g*this.strideInt]=2147450879;this.dirty.start=Math.min(this.dirty.start,h),this.dirty.end=Math.max(this.dirty.end,l),this.freeList.free(t,e)}upload(){if(this.dirty.end){if(this._invalidateTriangleBuffer(),(0,o.Wi)(this._gpu))return this.dirty.start=1/0,void(this.dirty.end=0);this._gpu.setSubData(this._cpu.array,this.dirty.start,this.dirty.start,this.dirty.end),this.dirty.start=1/0,this.dirty.end=0}}_createBuffer(t){const e=z.l1.DYNAMIC_DRAW;return"index"===this.bufferType?S.f.createIndex(t,e,this._cpu.array):S.f.createVertex(t,e,this._cpu.array)}_createComputeBuffer(t){const e=z.l1.DYNAMIC_DRAW,n=new Uint32Array(this.fillPointer/3);for(let h=0;h<this.fillPointer;h+=3)n[h/3]=this._cpu.array[h];return S.f.createIndex(t,e,n)}}var Y=d(37633),$=d(49353);class q{constructor(t,e){this._vaos=new Map,this._indicesInvalid=!1,this.geometryType=t,this._stage=e}destroy(){for(const[t,e]of this._vaos)(0,o.pC)(e)&&e.dispose(!1);this._indexBuffer=(0,o.SC)(this._indexBuffer),this._vertexBuffer=(0,o.SC)(this._vertexBuffer)}insert(t,e,n){if(!t.records.byteLength)return;const h=t.stride;if(this._vertexBuffer&&this._indexBuffer){const g=t.vertices.byteLength/h;this._indexBuffer.ensure(t.indices.byteLength/4),this._vertexBuffer.ensure(g);const{vertices:L,indices:M}=t,A=Y.$.from(t.records),U=this._vertexBuffer.insert(L,0,L.byteLength/h,0),k=this._indexBuffer.insert(M,0,M.byteLength/4,U);if(A.forEach(W=>{W.indexFrom+=k,W.vertexFrom+=U}),(0,o.s3)(this._records,"Expected records to be defined").link(A),e)this._indicesInvalid=!0;else if(this._displayList){const W=A.getCursor();for(;W.next();)this._displayList.addRecord(W)}}else{const l=t.indices.byteLength/4,g=t.vertices.byteLength/h,L=h/Uint32Array.BYTES_PER_ELEMENT,M=this._stage.bufferPool;this._records=Y.$.from(t.records),this._indexBuffer=new Z("index",l,1,M),this._vertexBuffer=new Z("vertex",g,L,M),this._indexBuffer.insert(t.indices,0,t.indices.byteLength/4,0),this._vertexBuffer.insert(t.vertices,0,t.vertices.byteLength/h,0),e&&(this._indicesInvalid=!0)}}remove(t){if(!(0,o.Wi)(this._records))for(const e of t){const n=this._records.getCursor();if(!n.lookup(e))continue;const h=n.indexFrom,l=n.vertexFrom;let g=n.indexCount,L=n.vertexCount;for(;n.next()&&n.id===e;)g+=n.indexCount,L+=n.vertexCount;this._indexBuffer.free(h,g),this._vertexBuffer.free(l,L,!0),this._records.delete(e)}}getVAO(t,e,n,h){if(!this._vertexBuffer||!this._indexBuffer||(0,o.Wi)(this._records)||!this._vertexBuffer.bufferSize)return null;const l=h?1:0;let g=this._vaos.get(l);(this._vertexBuffer.invalidated||this._indexBuffer.invalidated||h&&this._indexBuffer.invalidatedComputeBuffer)&&((0,o.yw)(g,A=>A.dispose(!1)),g=null),this._vertexBuffer.upload(),this._indexBuffer.upload();const L=this._indexBuffer.getGPUBuffer(t,1===l),M=this._vertexBuffer.getGPUBuffer(t);return g||(g=new $.U(t,n,e,{geometry:M},L),this._vaos.set(l,g)),g}forEachCommand(t){if(!(0,o.Wi)(this._records)){if(this._sortIndices(this._records),!this._displayList){const e=this._cursorIndexOrder;this._displayList=x.from(this,this.geometryType,this._records.getCursor(),e)}this._displayList.forEach(t)}}_sortIndices(t){const e=!!this._indexBuffer.bufferSize;if(!this._indicesInvalid)return;this._indicesInvalid=!1;let n=0;const h=t.getCursor(),l=[],g=[],L=[];for(;h.next();)g.push(h.index),L.push(h.sortKey),l.push(h.id);g.sort((U,k)=>{const W=L[k],j=L[U];return j===W?l[k]-l[U]:W-j});const M=t.getCursor(),A=e?this._indexBuffer.getCPUBuffer():this._vertexBuffer.getCPUBuffer();for(const U of g){if(!M.seekIndex(U))throw new Error("Expected to find index");if(e){const{indexFrom:k,indexCount:W}=M;M.indexFrom=n;for(let j=0;j<W;j++)this._indexBuffer.set(n++,A.array[k+j])}else{const{vertexFrom:k,vertexCount:W}=M,j=this._vertexBuffer.strideInt,it=k*j,ct=it+W*j;M.vertexFrom=n/j;for(let et=it;et<ct;et++)this._vertexBuffer.set(n++,A.array[et])}}this._cursorIndexOrder=g,this._displayList=null}}let nt=0;class at extends c.o{constructor(t,e,n,h,l,g){super(t,e,n,h),this.instanceId=nt++,this.patchCount=0,this._renderState={current:{geometry:new Map,metrics:null},next:null,swap:!1,swapFrames:0,locked:!1},this._patches=new P.Z(100),this._bufferPatches=new P.Z(100),this._lastCommitTime=0,this.transforms.labelMat2d=(0,V.c)(),this._store=l,this._requestLabelUpdate=g}destroy(){super.destroy(),this._renderState.current.geometry.forEach(t=>t.destroy()),(0,o.pC)(this._renderState.next)&&this._renderState.next.geometry.forEach(t=>t.destroy()),this._renderState.current=null,this._renderState.next=null}get labelMetrics(){return this._renderState.current.metrics}get hasData(){return!!this._renderState.current.geometry.size}getGeometry(t){return this._renderState.current.geometry.get(t)}patch(t,e){this.patchCount++,t.clear&&this._patches.size>=50&&this._dropPatches();const n=t;e&&n.addOrUpdate&&this.key.id!==n.addOrUpdate.tileKeyOrigin?this._bufferPatches.enqueue(n):(n.sort=n.sort&&!e,this._patches.enqueue(n)),this.requestRender()}commit(t){if(this._lastCommitTime!==t.time){this._lastCommitTime=t.time;for(let e=0;e<4;e++)this._updateMesh(),this.isReady&&this._updateBufferMesh();this._renderState.swap&&(this._swapRenderStates(),this.requestRender())}}lock(){this._renderState.locked=!0}unlock(){this._renderState.locked=!1,this._flushUpdates(),this._swap()}_swapRenderStates(){if(this._renderState.next){if(this._renderState.locked)return this._renderState.swap=!0,void this.requestRender();this._renderState.swap=!0,this._swap()}}_swap(){this._renderState.swap&&(this._renderState.swap=!1,(0,o.pC)(this._renderState.next)&&(this._renderState.current.geometry.forEach(t=>t.destroy()),this._renderState.current=this._renderState.next,this._renderState.next=null,this._requestLabelUpdate()))}_flushUpdates(){let t=this._patches.maxSize;for(;this._patches.size&&t--;)this._updateMesh(),this._swap()}_updateBufferMesh(){const t=this._bufferPatches.peek();if(!(0,o.pC)(t)||!t.clear||null===this._renderState.next)for(;this._bufferPatches.size;){const e=this._bufferPatches.dequeue();(0,o.pC)(e)&&this._patchBuffer(e)}}_updateMesh(){const t=this._patches.dequeue();if((0,o.pC)(t)){if((0,C.Z)("esri-2d-update-debug")){const e=t,n=e.addOrUpdate?.tileKeyOrigin,h=this.key.id===n?"SELF":n;let l="";for(let g=0;g<5;g++)l+=e.addOrUpdate?.data[g]?.records?.byteLength?1:0;console.debug(this.key.id,"FeatureTile:patch",`[clear: ${e.clear} origin: ${h}, end:${e.end} data:${l}]`)}!0===t.clear&&((0,o.pC)(this._renderState.next)&&(this._renderState.next.geometry.forEach(e=>e.destroy()),this._renderState.next=null),this._renderState.next={geometry:new Map,metrics:null},(0,C.Z)("esri-2d-update-debug")&&console.debug(this.key.id,"FeatureTile:_updateMesh - Creating new renderState")),this.requestRender(),this._patch(t),t.end&&((0,C.Z)("esri-2d-update-debug")&&console.debug(this.key.id,"FeatureTile:_updateMesh - Encountered end message"),this.ready(),this._swapRenderStates())}}_patch(t){(0,F.Z_)(e=>{this._remove(e,t.remove),this._insert(e,t,!1)})}_patchBuffer(t){(0,F.Z_)(e=>{this._insert(e,t,!0)})}_insert(t,e,n){try{const h=(0,o.Pt)(this._renderState.next,this._renderState.current),l=e.addOrUpdate?.data[t],g=h.geometry;if((0,o.Wi)(l))return;g.has(t)||((0,C.Z)("esri-2d-update-debug")&&console.debug(this.key.id,`FeatureTile:_insert - Creating geometry buffer ${t}`),g.set(t,new q(t,this.stage))),(0,C.Z)("esri-2d-update-debug")&&console.debug(this.key.id,`FeatureTile:_insert - Inserting into ${t}, version=${e.addOrUpdate?.version} stride=${l.stride}`),g.get(t).insert(l,e.sort,n),t===O.LW.LABEL&&this._insertLabelMetrics(e.type,l.metrics,e.clear)}catch{}}_insertLabelMetrics(t,e,n){const h=(0,o.Pt)(this._renderState.next,this._renderState.current);if((0,o.Wi)(e))return;const l=r.from(e);if((0,o.Wi)(h.metrics))h.metrics=l;else{if("update"===t){const g=l.getCursor();for(;g.next();)h.metrics.delete(g.id)}h.metrics.link(l)}}_remove(t,e){const n=(0,o.Pt)(this._renderState.next,this._renderState.current).geometry.get(t);e&&e.length&&n&&(n.remove(e),this._removeLabelMetrics(e))}_removeLabelMetrics(t){const{metrics:e}=(0,o.Pt)(this._renderState.next,this._renderState.current);if(!(0,o.Wi)(e)&&t.length)for(const n of t)for(;e.delete(n););}_dropPatches(){const t=new Array;let e=!1;for(;this._patches.size;){const n=this._patches.dequeue();if((0,o.Wi)(n))break;if(n.clear){if(e)break;e=!0}t.push(n)}this._patches.clear(),t.forEach(n=>this._patches.enqueue(n))}}var ht=d(22418),ot=d(84225),dt=d(6257),I=d(91894),ut=d(47123);const _t=(0,C.Z)("featurelayer-order-by-server-enabled");class lt extends ut.T{constructor(t,e,n,h){super(t),this._hitTestsRequests=[],this._layer=n,this._layerView=e,this._onUpdate=h}renderChildren(t){this.attributeView.update(),this.hasAnimation&&t.painter.effects.integrate.draw(t,t.attributeView),super.renderChildren(t)}hasEmptyAttributeView(){return this.attributeView.isEmpty()}isUpdating(){return this.attributeView.isUpdating()}hitTest(t){let e=this._hitTestsRequests.find(({x:h,y:l})=>h===t.x&&l===t.y);const n=(0,s.hh)();return e?e.resolvers.push(n):(e={x:t.x,y:t.y,resolvers:[n]},this._hitTestsRequests.push(e)),this.requestRender(),n.promise}onTileData(t,e){const n=_t&&"orderBy"in this._layer&&this._layer.orderBy;t.patch(e,!!n&&this._layerView.orderByFields===(n&&n?.length&&!n[0].valueExpression&&n[0].field)),this.contains(t)||this.addChild(t),this.requestRender()}onTileError(t){this.contains(t)||this.addChild(t)}updateTransitionProperties(t,e){super.updateTransitionProperties(t,e),this._layerView.featureEffectView.transitionStep(t,e),this._layerView.featureEffectView.transitioning&&this.requestRender()}doRender(t){const{minScale:e,maxScale:n}=this._layer.effectiveScaleRange,h=t.state.scale;h<=(e||1/0)&&h>=n&&super.doRender(t)}afterRender(t){super.afterRender(t),this._hitTestsRequests.length&&this.requestRender()}onAttributeStoreUpdate(){this.hasLabels&&this._layerView.view.labelManager.requestUpdate(),this._onUpdate()}get hasAnimation(){return this.hasLabels}setStencilReference(t){const{rendererSchema:e}=t.rendererInfo;if("dot-density"===e?.type&&e?.dotSize>1||"heatmap"===e?.type)for(const h of this.children)h.stencilRef=h.key.level+1;else super.setStencilReference(t)}get hasLabels(){if("sublayers"in this._layer)return this._layer.sublayers.some(n=>!!n.labelingInfo?.length&&n.labelsVisible);const t=this._layer.featureReduction;return this._layer.labelingInfo&&this._layer.labelingInfo.length&&this._layer.labelsVisible||!!(t&&"labelingInfo"in t&&t.labelsVisible&&t.labelingInfo&&t.labelingInfo.length)}prepareRenderPasses(t){const e=t.registerRenderPass({name:"label",brushes:[I.U.label],target:()=>this.hasLabels?this.children:null,drawPhase:O.jx.LABEL|O.jx.LABEL_ALPHA}),n=t.registerRenderPass({name:"geometry",brushes:[I.U.fill,I.U.dotDensity,I.U.line,I.U.marker,I.U.heatmap,I.U.pieChart,I.U.text],target:()=>this.children,enableDefaultDraw:()=>!this._layerView.featureEffectView.hasEffects,effects:[{apply:t.effects.outsideEffect,enable:()=>this._layerView.featureEffectView.hasEffects,args:()=>this._layerView.featureEffectView.excludedEffects},{apply:t.effects.insideEffect,enable:()=>this._layerView.featureEffectView.hasEffects,args:()=>this._layerView.featureEffectView.includedEffects},{apply:t.effects.hittest,enable:()=>!!this._hitTestsRequests.length,args:()=>this._hitTestsRequests}]}),h=t.registerRenderPass({name:"highlight",brushes:[I.U.fill,I.U.dotDensity,I.U.line,I.U.marker,I.U.pieChart,I.U.text],target:()=>this.children,drawPhase:O.jx.HIGHLIGHT,enableDefaultDraw:()=>!1,effects:[{apply:t.effects.highlight,enable:()=>!!this._layerView.hasHighlight()}]});return[...super.prepareRenderPasses(t),n,h,e]}}let tt=class extends ot.Z{constructor(){super(...arguments),this.type="symbol"}install(b){const e=new lt(this.tileInfoView,this.layerView,this.layer,()=>this.notifyChange("updating"));this.featuresView=e,b.addChild(e)}uninstall(b){b.removeChild(this.featuresView),this.featuresView=(0,o.SC)(this.featuresView)}fetchResource(b,t){const{url:e}=b,n=this.featuresView.stage;try{return n.resourceManager.fetchResource(e,{signal:t.signal})}catch(h){return(0,s.D_)(h)?Promise.resolve({width:0,height:0}):Promise.reject(h)}}isUpdating(){const b=super.isUpdating(),t=!this.featuresView||this.featuresView.isUpdating(),e=this.featuresView?.hasEmptyAttributeView(),n=b||t||b&&e;return(0,C.Z)("esri-2d-log-updating")&&console.log(`Updating SymbolTileRenderer ${n}\n  -> updatingTiles ${b}\n  -> hasFeaturesView ${!!this.featuresView}\n  -> updatingFeaturesView ${t}`),n}hitTest(b){return this.featuresView.hitTest(b)}supportsRenderer(b){return null!=b&&["simple","class-breaks","unique-value","dot-density","dictionary","heatmap","pie-chart"].includes(b.type)}onConfigUpdate(b){let t=null;if(b&&"visualVariables"in b){const e=((0,ht.aR)(b).visualVariables||[]).map(n=>{const h=n.clone();return"normalizationField"in n&&(h.normalizationField=null),n.valueExpression&&"$view.scale"!==n.valueExpression&&(h.valueExpression=null,h.field="nop"),h});t=(0,dt.I)(e)}this.featuresView.setRendererInfo(b,t,this.layerView.featureEffect)}onTileData(b){const t=this.tiles.get(b.tileKey);t&&b.data&&this.featuresView.onTileData(t,b.data),this.layerView.view.labelManager.requestUpdate()}onTileError(b){const t=this.tiles.get(b.tileKey);t&&this.featuresView.onTileError(t)}forceAttributeTextureUpload(){this.featuresView.attributeView.forceTextureUpload()}lockGPUUploads(){this.featuresView.attributeView.lockTextureUpload(),this.tiles.forEach(b=>b.lock())}unlockGPUUploads(){this.featuresView.attributeView.unlockTextureUpload(),this.tiles.forEach(b=>b.unlock())}getMaterialItems(b){var t=this;return(0,w.Z)(function*(){return t.featuresView.getMaterialItems(b)})()}invalidateLabels(){this.featuresView.hasLabels&&this.layerView.view.labelManager.requestUpdate()}createTile(b){const t=this.tileInfoView.getTileBounds((0,R.Ue)(),b),n=this.tileInfoView.getTileResolution(b.level);return new at(b,n,t[0],t[3],this.featuresView.attributeView,()=>this.layerView.view.labelManager.requestUpdate())}disposeTile(b){this.featuresView.removeChild(b),b.destroy(),this.layerView.view.labelManager.requestUpdate()}};tt=(0,v._)([(0,E.j)("esri.views.2d.layers.features.tileRenderers.SymbolTileRenderer")],tt);const ft=tt},6257:(K,B,d)=>{d.d(B,{I:()=>P,qc:()=>i});var w=d(62208),v=d(23841),C=d(81295),o=d(39351),s=d(39406),m=d(25310);function i(c,y){if(!c||!y)return c;switch(y){case"radius":case"distance":return 2*c;case"diameter":case"width":return c;case"area":return Math.sqrt(c)}return c}function a(c){return(c??[]).map(y=>function u(c){return{value:c.value,size:(0,v.t_)(c.size)}}(y))}function E(c){return"string"==typeof c||"number"==typeof c?(0,v.t_)(c):{type:"size",expression:c.expression,stops:a(c.stops)}}const R=c=>{const y=[],T=[],r=a(c),_=r.length;for(let f=0;f<6;f++){const p=r[Math.min(f,_-1)];y.push(p.value),T.push(null==p.size?o.AI:(0,v.F2)(p.size))}return{values:new Float32Array(y),sizes:new Float32Array(T)}};function P(c){const y=c&&c.length>0?{}:null,T=y?{}:null;if(!y||!T)return{vvFields:y,vvRanges:T};for(const r of c)if(r.field&&(y[r.type]=r.field),"size"===r.type){T.size||(T.size={});const _=r;switch((0,m.a)(_)){case s.X.SIZE_MINMAX_VALUE:T.size.minMaxValue={minDataValue:_.minDataValue,maxDataValue:_.maxDataValue,minSize:E(_.minSize),maxSize:E(_.maxSize)};break;case s.X.SIZE_SCALE_STOPS:T.size.scaleStops={stops:a(_.stops)};break;case s.X.SIZE_FIELD_STOPS:if(_.levels){const f={};for(const p in _.levels)f[p]=R(_.levels[p]);T.size.fieldStops={type:"level-dependent",levels:f}}else T.size.fieldStops={type:"static",...R(_.stops)};break;case s.X.SIZE_UNIT_VALUE:T.size.unitValue={unit:_.valueUnit,valueRepresentation:_.valueRepresentation??void 0}}}else"color"===r.type?T.color=F(r):"opacity"===r.type?T.opacity=V(r):"rotation"===r.type&&(T.rotation={type:r.rotationType});return{vvFields:y,vvRanges:T}}function V(c){const y={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"==typeof c.field){if(!c.stops)return null;{if(c.stops.length>8)return null;const T=c.stops;for(let r=0;r<8;++r){const _=T[Math.min(r,T.length-1)];y.values[r]=_.value,y.opacities[r]=_.opacity}}}else{if(!(c.stops&&c.stops.length>=0))return null;{const T=c.stops&&c.stops.length>=0?c.stops[0].opacity:0;for(let r=0;r<8;r++)y.values[r]=1/0,y.opacities[r]=T}}return y}function O(c,y,T){c[4*y+0]=T.r/255,c[4*y+1]=T.g/255,c[4*y+2]=T.b/255,c[4*y+3]=T.a}function F(c){if((0,w.Wi)(c)||c.normalizationField)return null;const y={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if("string"==typeof c.field){if(!c.stops)return null;{if(c.stops.length>8)return null;y.field=c.field;const T=c.stops;for(let r=0;r<8;++r){const _=T[Math.min(r,T.length-1)];y.values[r]=_.value,O(y.colors,r,_.color)}}}else{if(!(c.stops&&c.stops.length>=0))return null;{const T=c.stops&&c.stops.length>=0&&c.stops[0].color;for(let r=0;r<8;r++)y.values[r]=1/0,O(y.colors,r,T)}}for(let T=0;T<32;T+=4)(0,C.pr)(y.colors,T,!0);return y}}}]);