"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[137],{58774:(Wt,ct,m)=>{m.d(ct,{b:()=>Q,j:()=>W});var x=m(15861),y=m(54346),f=m(8314);const b=128e3;let Y=null,X=null;function W(){return tt.apply(this,arguments)}function tt(){return tt=(0,x.Z)(function*(){return Y||(Y=function $(){return Z.apply(this,arguments)}()),Y}),tt.apply(this,arguments)}function Z(){return(Z=(0,x.Z)(function*(){X=yield((0,f.Z)("esri-csp-restrictions")?yield m.e(71).then(m.bind(m,10071)).then(U=>U.l):yield m.e(9507).then(m.bind(m,99507)).then(U=>U.l)).default({locateFile:U=>(0,y.V)(`esri/core/libs/libtess/${U}`)})})).apply(this,arguments)}function Q(j,U){const w=Math.max(j.length,b);return X.triangulate(j,U,w)}},92087:(Wt,ct,m)=>{m.d(ct,{L:()=>y,v:()=>x});const x=15.5,y=1024},73608:(Wt,ct,m)=>{m.d(ct,{j:()=>W});var x=m(33359),y=m(2362),f=m(29214),b=m(73282),Y=m(35909);class W{static executeEffects($,Z,Q,j){const w=(0,Y.Tg)($);let T=new f.z(Z);for(const v of $){const O=(0,b.h)(v);O&&(T=O.execute(T,v,1.3333333333333333,Q,j,w))}return T}static applyEffects($,Z,Q){if(!$)return Z;const j=(0,Y.Tg)($);let U,w=new f.z(x.z.fromJSONCIM(Z));for(const O of $){const L=(0,b.h)(O);L&&(w=L.execute(w,O,1,null,Q,j))}const T=[];let v=null;for(;U=w.next();)T.push(...(0,y.M)(U)),v=U.geometryType;return 0===T.length||null===v?null:"esriGeometryPolygon"===v?{rings:T}:{paths:T}}}},99666:(Wt,ct,m)=>{m.d(ct,{Ht:()=>x,QS:()=>Q,jL:()=>tt});const x=8388607,y=8388608,tt=j=>j&x;function Q(j,U){return((U?y:0)|j)>>>0}},46519:(Wt,ct,m)=>{m.d(ct,{z:()=>U});var x=m(7547),y=m(39351);function f(w,T){return w.x===T.x&&w.y===T.y}function Y(w,T){return w.x=T.y,w.y=-T.x,w}function X(w,T){return w.x=-T.y,w.y=T.x,w}function W(w,T){return w.x=T.x,w.y=T.y,w}function tt(w,T){return w.x=-T.x,w.y=-T.y,w}function $(w){return Math.sqrt(w.x*w.x+w.y*w.y)}function Z(w,T){return w.x*T.y-w.y*T.x}function Q(w,T){return w.x*T.x+w.y*T.y}function j(w,T,v,O){return w.x=T.x*v+T.y*O,w.y=T.x*O-T.y*v,w}class U{constructor(T,v,O){this._writeVertex=T,this._writeTriangle=v,this._canUseThinTessellation=O,this._prevNormal={x:void 0,y:void 0},this._nextNormal={x:void 0,y:void 0},this._textureNormalLeft={x:0,y:1},this._textureNormalRight={x:0,y:-1},this._textureNormal={x:void 0,y:void 0},this._joinNormal={x:void 0,y:void 0},this._inner={x:void 0,y:void 0},this._outer={x:void 0,y:void 0},this._roundStart={x:void 0,y:void 0},this._roundEnd={x:void 0,y:void 0},this._startBreak={x:void 0,y:void 0},this._endBreak={x:void 0,y:void 0},this._innerPrev={x:void 0,y:void 0},this._innerNext={x:void 0,y:void 0},this._bevelStart={x:void 0,y:void 0},this._bevelEnd={x:void 0,y:void 0},this._bevelMiddle={x:void 0,y:void 0}}tessellate(T,v,O=this._canUseThinTessellation){(function b(w){if(!w)return;const T=w.length;if(T<=1)return;let v=0;for(let O=1;O<T;O++)f(w[O],w[v])||++v===O||(w[v]=w[O]);w.length=v+1})(T),O&&v.halfWidth<y.do&&!v.offset?this._tessellateThin(T,v):this._tessellate(T,v)}_tessellateThin(T,v){if(T.length<2)return;const O=v.wrapDistance||65535;let L=v.initialDistance||0,G=!1,rt=T[0].x,J=T[0].y;const A=T.length;for(let nt=1;nt<A;++nt){G&&(G=!1,L=0);let at=T[nt].x,H=T[nt].y,ht=at-rt,lt=H-J,xt=Math.sqrt(ht*ht+lt*lt);if(ht/=xt,lt/=xt,L+xt>O){G=!0;const B=(O-L)/xt;xt=O-L,at=(1-B)*rt+B*at,H=(1-B)*J+B*H,--nt}const pt=this._writeVertex(rt,J,0,0,ht,lt,lt,-ht,0,-1,L),vt=this._writeVertex(rt,J,0,0,ht,lt,-lt,ht,0,1,L);L+=xt;const _t=this._writeVertex(at,H,0,0,ht,lt,lt,-ht,0,-1,L),V=this._writeVertex(at,H,0,0,ht,lt,-lt,ht,0,1,L);this._writeTriangle(pt,vt,_t),this._writeTriangle(vt,_t,V),rt=at,J=H}}_tessellate(T,v){const L=T[T.length-1],G=f(T[0],L);if(T.length<(G?3:2))return;const J=v.pixelCoordRatio,A=null!=v.capType?v.capType:x.RL.BUTT,nt=null!=v.joinType?v.joinType:x.AH.MITER,at=null!=v.miterLimit?Math.min(v.miterLimit,4):2,H=null!=v.roundLimit?Math.min(v.roundLimit,1.05):1.05,ht=null!=v.halfWidth?v.halfWidth:2,lt=!!v.textured;let xt,pt,vt,_t=null;const V=this._prevNormal,B=this._nextNormal;let At=-1,Bt=-1;const yt=this._joinNormal;let wt,Ot;const zt=this._textureNormalLeft,Qt=this._textureNormalRight,Dt=this._textureNormal;let gt=-1,Rt=-1;const Jt=v.wrapDistance||65535;let it=v.initialDistance||0;const p=this._writeVertex,g=this._writeTriangle,D=(K,st,mt,ut,Et,Mt)=>{const Ut=p(pt,vt,wt,Ot,mt,ut,K,st,Et,Mt,it);return gt>=0&&Rt>=0&&Ut>=0&&g(gt,Rt,Ut),gt=Rt,Rt=Ut,Ut};G&&(xt=T[T.length-2],B.x=L.x-xt.x,B.y=L.y-xt.y,Bt=$(B),B.x/=Bt,B.y/=Bt);let F=!1;for(let K=0;K<T.length;++K){if(F&&(F=!1,it=0),xt&&(V.x=-B.x,V.y=-B.y,At=Bt,it+At>Jt&&(F=!0)),F){const Pt=(Jt-it)/At;At=Jt-it,xt={x:(1-Pt)*xt.x+Pt*T[K].x,y:(1-Pt)*xt.y+Pt*T[K].y},--K}else xt=T[K];pt=xt.x,vt=xt.y;const st=K<=0&&!F,mt=K===T.length-1;if(st||(it+=At),_t=mt?G?T[1]:null:T[K+1],_t?(B.x=_t.x-pt,B.y=_t.y-vt,Bt=$(B),B.x/=Bt,B.y/=Bt):(B.x=void 0,B.y=void 0),!G){if(st){X(yt,B),wt=yt.x,Ot=yt.y,A===x.RL.SQUARE&&(D(-B.y-B.x,B.x-B.y,B.x,B.y,0,-1),D(B.y-B.x,-B.x-B.y,B.x,B.y,0,1)),A===x.RL.ROUND&&(D(-B.y-B.x,B.x-B.y,B.x,B.y,-1,-1),D(B.y-B.x,-B.x-B.y,B.x,B.y,-1,1)),A!==x.RL.ROUND&&A!==x.RL.BUTT||(D(-B.y,B.x,B.x,B.y,0,-1),D(B.y,-B.x,B.x,B.y,0,1));continue}if(mt){Y(yt,V),wt=yt.x,Ot=yt.y,A!==x.RL.ROUND&&A!==x.RL.BUTT||(D(V.y,-V.x,-V.x,-V.y,0,-1),D(-V.y,V.x,-V.x,-V.y,0,1)),A===x.RL.SQUARE&&(D(V.y-V.x,-V.x-V.y,-V.x,-V.y,0,-1),D(-V.y-V.x,V.x-V.y,-V.x,-V.y,0,1)),A===x.RL.ROUND&&(D(V.y-V.x,-V.x-V.y,-V.x,-V.y,1,-1),D(-V.y-V.x,V.x-V.y,-V.x,-V.y,1,1));continue}}let ut,Et,Mt=-Z(V,B);if(Math.abs(Mt)<.01)Q(V,B)>0?(yt.x=V.x,yt.y=V.y,Mt=1,ut=Number.MAX_VALUE,Et=!0):(X(yt,B),Mt=1,ut=1,Et=!1);else{yt.x=(V.x+B.x)/Mt,yt.y=(V.y+B.y)/Mt,ut=$(yt);const Pt=(ut-1)*ht*J;Et=ut>4||Pt>At&&Pt>Bt}wt=yt.x,Ot=yt.y;let Ut=nt;switch(nt){case x.AH.BEVEL:ut<1.05&&(Ut=x.AH.MITER);break;case x.AH.ROUND:ut<H&&(Ut=x.AH.MITER);break;case x.AH.MITER:ut>at&&(Ut=x.AH.BEVEL)}switch(Ut){case x.AH.MITER:if(D(yt.x,yt.y,-V.x,-V.y,0,-1),D(-yt.x,-yt.y,-V.x,-V.y,0,1),mt)break;if(lt){const Pt=F?0:it;gt=this._writeVertex(pt,vt,wt,Ot,B.x,B.y,yt.x,yt.y,0,-1,Pt),Rt=this._writeVertex(pt,vt,wt,Ot,B.x,B.y,-yt.x,-yt.y,0,1,Pt)}break;case x.AH.BEVEL:{const Pt=Mt<0;let Vt,N,Ft,Ct;if(Pt){const Nt=gt;gt=Rt,Rt=Nt,Vt=zt,N=Qt}else Vt=Qt,N=zt;if(Et)Ft=Pt?X(this._innerPrev,V):Y(this._innerPrev,V),Ct=Pt?Y(this._innerNext,B):X(this._innerNext,B);else{const Nt=Pt?tt(this._inner,yt):W(this._inner,yt);Ft=Nt,Ct=Nt}const ot=Pt?Y(this._bevelStart,V):X(this._bevelStart,V);D(Ft.x,Ft.y,-V.x,-V.y,Vt.x,Vt.y);const Kt=D(ot.x,ot.y,-V.x,-V.y,N.x,N.y);if(mt)break;const jt=Pt?X(this._bevelEnd,B):Y(this._bevelEnd,B);if(Et){const Nt=this._writeVertex(pt,vt,wt,Ot,-V.x,-V.y,0,0,0,0,it);gt=this._writeVertex(pt,vt,wt,Ot,B.x,B.y,Ct.x,Ct.y,Vt.x,Vt.y,it),Rt=this._writeVertex(pt,vt,wt,Ot,B.x,B.y,jt.x,jt.y,N.x,N.y,it),this._writeTriangle(Kt,Nt,Rt)}else{if(lt){const Nt=this._bevelMiddle;Nt.x=(ot.x+jt.x)/2,Nt.y=(ot.y+jt.y)/2,j(Dt,Nt,-V.x,-V.y),D(Nt.x,Nt.y,-V.x,-V.y,Dt.x,Dt.y),j(Dt,Nt,B.x,B.y),gt=this._writeVertex(pt,vt,wt,Ot,B.x,B.y,Nt.x,Nt.y,Dt.x,Dt.y,it),Rt=this._writeVertex(pt,vt,wt,Ot,B.x,B.y,Ct.x,Ct.y,Vt.x,Vt.y,it)}else{const Nt=gt;gt=Rt,Rt=Nt}D(jt.x,jt.y,B.x,B.y,N.x,N.y)}if(Pt){const Nt=gt;gt=Rt,Rt=Nt}break}case x.AH.ROUND:{const Pt=Mt<0;let Vt,N;if(Pt){const Xt=gt;gt=Rt,Rt=Xt,Vt=zt,N=Qt}else Vt=Qt,N=zt;const Ft=Pt?tt(this._inner,yt):W(this._inner,yt);let Ct,ot;Et?(Ct=Pt?X(this._innerPrev,V):Y(this._innerPrev,V),ot=Pt?Y(this._innerNext,B):X(this._innerNext,B)):(Ct=Ft,ot=Ft);const Kt=Pt?Y(this._roundStart,V):X(this._roundStart,V),jt=Pt?X(this._roundEnd,B):Y(this._roundEnd,B),Nt=D(Ct.x,Ct.y,-V.x,-V.y,Vt.x,Vt.y),qt=D(Kt.x,Kt.y,-V.x,-V.y,N.x,N.y);if(mt)break;const ne=this._writeVertex(pt,vt,wt,Ot,-V.x,-V.y,0,0,0,0,it);Et||this._writeTriangle(gt,Rt,ne);const se=tt(this._outer,Ft),ie=this._writeVertex(pt,vt,wt,Ot,B.x,B.y,jt.x,jt.y,N.x,N.y,it);let de,fe;const bt=ut>2;if(bt){let Xt;ut!==Number.MAX_VALUE?(se.x/=ut,se.y/=ut,Xt=Q(V,se),Xt=(ut*(Xt*Xt-1)+1)/Xt):Xt=-1,de=Pt?Y(this._startBreak,V):X(this._startBreak,V),de.x+=V.x*Xt,de.y+=V.y*Xt,fe=Pt?X(this._endBreak,B):Y(this._endBreak,B),fe.x+=B.x*Xt,fe.y+=B.y*Xt}j(Dt,se,-V.x,-V.y);const te=this._writeVertex(pt,vt,wt,Ot,-V.x,-V.y,se.x,se.y,Dt.x,Dt.y,it);j(Dt,se,B.x,B.y);const pe=lt?this._writeVertex(pt,vt,wt,Ot,B.x,B.y,se.x,se.y,Dt.x,Dt.y,it):te,oe=ne,ae=lt?this._writeVertex(pt,vt,wt,Ot,B.x,B.y,0,0,0,0,it):ne;let Gt=-1,ye=-1;if(bt&&(j(Dt,de,-V.x,-V.y),Gt=this._writeVertex(pt,vt,wt,Ot,-V.x,-V.y,de.x,de.y,Dt.x,Dt.y,it),j(Dt,fe,B.x,B.y),ye=this._writeVertex(pt,vt,wt,Ot,B.x,B.y,fe.x,fe.y,Dt.x,Dt.y,it)),lt?bt?(this._writeTriangle(oe,qt,Gt),this._writeTriangle(oe,Gt,te),this._writeTriangle(ae,pe,ye),this._writeTriangle(ae,ye,ie)):(this._writeTriangle(oe,qt,te),this._writeTriangle(ae,pe,ie)):bt?(this._writeTriangle(ne,qt,Gt),this._writeTriangle(ne,Gt,ye),this._writeTriangle(ne,ye,ie)):(this._writeTriangle(ne,qt,te),this._writeTriangle(ne,pe,ie)),Et?(gt=this._writeVertex(pt,vt,wt,Ot,B.x,B.y,ot.x,ot.y,Vt.x,Vt.y,it),Rt=ie):(gt=lt?this._writeVertex(pt,vt,wt,Ot,B.x,B.y,ot.x,ot.y,Vt.x,Vt.y,it):Nt,this._writeTriangle(gt,ae,ie),Rt=ie),Pt){const Xt=gt;gt=Rt,Rt=Xt}break}}}}}},83006:(Wt,ct,m)=>{m.d(ct,{yu:()=>Qt,XB:()=>Dt,Qt:()=>gt,ri:()=>Jt,oo:()=>Rt,Pz:()=>zt,Ou:()=>yt,qH:()=>B,xh:()=>_t,Kw:()=>Bt,e5:()=>At});var x=m(17626),y=m(85931),f=m(63290),b=m(77275),Y=m(26584),X=m(37847),W=m(2282);const tt=()=>f.Z.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class ${constructor(){this._includedModules=new Map}include(p,g){if(this._includedModules.has(p)){const D=this._includedModules.get(p);if(D!==g){tt().error("Trying to include shader module multiple times with different sets of options.");const F=new Set;for(const K of Object.keys(D))D[K]!==p[K]&&F.add(K);for(const K of Object.keys(p))D[K]!==p[K]&&F.add(K);F.forEach(K=>console.error(`  ${K}: current ${D[K]} new ${p[K]}`))}}else this._includedModules.set(p,g),p(this.builder,g)}}class Z extends ${constructor(){super(...arguments),this.vertex=new U,this.fragment=new U,this.attributes=new w,this.varyings=new T,this.extensions=new v,this.constants=new O}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(p,g=!0){const D=this.extensions.generateSource(p),F=this.attributes.generateSource(p),K=this.varyings.generateSource(p),st="vertex"===p?this.vertex:this.fragment,mt=st.uniforms.generateSource(),ut=st.code.generateSource(),Et="vertex"===p?G:function L(it=!0){return`#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif\n${it?"out vec4 fragColor;":""}\n`}(g),Mt=this.constants.generateSource().concat(st.constants.generateSource());return`${g?"#version 300 es":""}\n${D.join("\n")}\n${Et}\n${Mt.join("\n")}\n${mt.join("\n")}\n${F.join("\n")}\n${K.join("\n")}\n${ut.join("\n")}`}generateBindPass(p){const g=new Map;this.vertex.uniforms.entries.forEach(K=>{const st=K.bind[X.P.Pass];st&&g.set(K.name,st)}),this.fragment.uniforms.entries.forEach(K=>{const st=K.bind[X.P.Pass];st&&g.set(K.name,st)});const D=Array.from(g.values()),F=D.length;return(K,st)=>{for(let mt=0;mt<F;++mt)D[mt](p,K,st)}}generateBindDraw(p){const g=new Map;this.vertex.uniforms.entries.forEach(K=>{const st=K.bind[X.P.Draw];st&&g.set(K.name,st)}),this.fragment.uniforms.entries.forEach(K=>{const st=K.bind[X.P.Draw];st&&g.set(K.name,st)});const D=Array.from(g.values()),F=D.length;return(K,st,mt)=>{for(let ut=0;ut<F;++ut)D[ut](p,K,st,mt)}}}class Q{constructor(){this._entries=new Map}add(...p){for(const g of p)this._add(g)}get(p){return this._entries.get(p)}_add(p){if(null!=p){if(this._entries.has(p.name)&&!this._entries.get(p.name).equals(p))throw new Y.Z(`Duplicate uniform name ${p.name} for different uniform type`);this._entries.set(p.name,p)}else tt().error(`Trying to add null Uniform from ${(new Error).stack}.`)}generateSource(){return Array.from(this._entries.values()).map(p=>null!=p.arraySize?`uniform ${p.type} ${p.name}[${p.arraySize}];`:`uniform ${p.type} ${p.name};`)}get entries(){return Array.from(this._entries.values())}}class j{constructor(){this._entries=new Array}add(p){this._entries.push(p)}generateSource(){return this._entries}}class U extends ${constructor(){super(...arguments),this.uniforms=new Q,this.code=new j,this.constants=new O}get builder(){return this}}class w{constructor(){this._entries=new Array}add(p,g){this._entries.push([p,g])}generateSource(p){return"fragment"===p?[]:this._entries.map(g=>`in ${g[1]} ${g[0]};`)}}class T{constructor(){this._entries=new Map}add(p,g){this._entries.has(p)&&(0,W.hu)(this._entries.get(p)===g),this._entries.set(p,g)}generateSource(p){const g=new Array;return this._entries.forEach((D,F)=>g.push("vertex"===p?`out ${D} ${F};`:`in ${D} ${F};`)),g}}class v{constructor(){this._entries=new Set}add(p){this._entries.add(p)}generateSource(p){const g="vertex"===p?v.ALLOWLIST_VERTEX:v.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(D=>g.includes(D)).map(D=>`#extension ${D} : enable`)}}v.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],v.ALLOWLIST_VERTEX=[];class O{constructor(){this._entries=new Set}add(p,g,D){let F="ERROR_CONSTRUCTOR_STRING";switch(g){case"float":F=O._numberToFloatStr(D);break;case"int":F=O._numberToIntStr(D);break;case"bool":F=D.toString();break;case"vec2":F=`vec2(${O._numberToFloatStr(D[0])},                            ${O._numberToFloatStr(D[1])})`;break;case"vec3":F=`vec3(${O._numberToFloatStr(D[0])},                            ${O._numberToFloatStr(D[1])},                            ${O._numberToFloatStr(D[2])})`;break;case"vec4":F=`vec4(${O._numberToFloatStr(D[0])},                            ${O._numberToFloatStr(D[1])},                            ${O._numberToFloatStr(D[2])},                            ${O._numberToFloatStr(D[3])})`;break;case"ivec2":F=`ivec2(${O._numberToIntStr(D[0])},                             ${O._numberToIntStr(D[1])})`;break;case"ivec3":F=`ivec3(${O._numberToIntStr(D[0])},                             ${O._numberToIntStr(D[1])},                             ${O._numberToIntStr(D[2])})`;break;case"ivec4":F=`ivec4(${O._numberToIntStr(D[0])},                             ${O._numberToIntStr(D[1])},                             ${O._numberToIntStr(D[2])},                             ${O._numberToIntStr(D[3])})`;break;case"mat2":case"mat3":case"mat4":F=`${g}(${Array.prototype.map.call(D,K=>O._numberToFloatStr(K)).join(", ")})`}return this._entries.add(`const ${g} ${p} = ${F};`),this}static _numberToIntStr(p){return p.toFixed(0)}static _numberToFloatStr(p){return Number.isInteger(p)?p.toFixed(1):p.toString()}generateSource(){return Array.from(this._entries)}}const G="precision highp float;\nprecision highp sampler2D;";var rt=m(99963);function A(it,p,g){const D=p.split("\n");for(const F of D)if(F.trim().length){{let K="";null!=g&&(K+=`/*id:${g??"000"}*/   `),it.body+=K.padEnd(14)}it.body+=" ".repeat(it.indent)+F+"\n"}}class nt{write(p){for(const g of p.rootOutputNodes())p.shouldPruneOutputNode(g)||(g.variableName=this._write(p,g.node));return p}_createVarName(p,g){let D="";return"boolean"!=typeof g&&"number"!=typeof g&&g.debugInfo.name&&(D=`${g.debugInfo.name}_`),`${D}v${p.varCount++}`}_write(p,g,D=!1){if("number"==typeof g||"boolean"==typeof g)return g.toString();let F=p.getEmit(g);if(F)return F;switch(g.shaderType){case"scope-node":F=this._writeScopeNode(p,g);break;case"primitive-node":F=this._writePrimitveNode(p,g,D);break;case"function-node":F=this._writeFunctionNode(p,g);break;case"property-access-node":F=this._writePropertyAccessNode(p,g);break;case"text-node":F=g.text;break;case"block-node":F=this._writeBlockNode(p,g);break;case"condition-node":F=this._writeConditionNode(p,g)}return p.setEmit(g,F),F}_writeScopeNode(p,g){const D=new g.child.constructor;D.setDebugName(g.debugInfo.name);const F=this._write(p,D,!0);return A(p,`{ /*ScopeStart: ${g.uid} ${g.debugInfo.name}*/`),p.indent+=2,A(p,`${F} = ${this._write(p,g.child)};`),p.indent-=2,A(p,`} /*ScopeEnd: ${g.uid} ${g.debugInfo.name}*/`),F}_writeConditionNode(p,g){const D=new g.ifTrue.constructor,F=this._write(p,D,!0);A(p,`if (${this._write(p,g.condition)}) {`),p.indent+=2;const K=p.createSubgraphContext(),st=this._write(K,g.ifTrue);if(p.body+=K.body,st&&A(p,`${F} = ${st};`),p.indent-=2,A(p,"}"),g.ifFalse){A(p,"else {"),p.indent+=2;const mt=p.createSubgraphContext(),ut=this._write(mt,g.ifFalse);p.body+=mt.body,ut&&A(p,`${F} = ${ut};`),p.indent-=2,A(p,"}")}return F}_writeBlockNode(p,g){const{captureList:D,generator:F,returnType:K}=g,st={};for(const Mt in D){if(!D[Mt])continue;const Ut=this._write(p,D[Mt]);st[Mt]=Ut}const mt=new K,ut=this._write(p,mt,!0);if(st.out=ut,g.subgraph){const Mt=p.createSubgraphContext(),Ut=this._write(Mt,g.subgraph.child);st.subgraph={varName:Ut,body:Mt.body}}const Et=F(st);return A(p,"{\n"),p.indent+=2,A(p,Et),p.indent-=2,A(p,"}\n"),ut}_writePropertyAccessNode(p,g){const D=this._write(p,g.target);return"string"==typeof g.property&&g.property.includes("[")?`${D}${g.property}`:"string"!=typeof g.property?`${D}[${this._write(p,g.property)}]`:`${D}.${g.property}`}_writeFunctionNode(p,g){const D=g.returnType.type;if(g.isInfix){const[st,mt]=g.children.map(Et=>this._write(p,Et)),ut=this._createVarName(p,g);return A(p,`${D.padEnd(5)} ${ut} = ${st} ${g.token} ${mt};`,g.uid),ut}const F=g.children.map(st=>this._write(p,st)).join(", "),K=this._createVarName(p,g);return A(p,`${D.padEnd(5)} ${K} = ${g.token}(${F});`,g.uid),K}_writePrimitveNode(p,g,D=!1){const F=p.getInput(g);if(F)return F.isUsed=!0,F.variableName;if(g.isImplicit||1===g.children.length&&g.children[0]?.type===g.type)return this._write(p,g.children[0]);const st=this._createVarName(p,g);if(D)return A(p,`${g.type.padEnd(5)} ${st};`,g.uid),st;const mt=!g.debugInfo.name&&!g.isMutable;if(mt&&"float"===g.type&&"number"==typeof g.children[0])return Number.isInteger(g.children[0])?g.children[0].toFixed(1):g.children[0].toString();if(mt&&"int"===g.type&&"number"==typeof g.children[0]&&Number.isInteger(g.children[0]))return g.children[0].toString();const ut=g.children.map(Et=>this._write(p,Et)).join(", ");return"array"===g.type?(A(p,`${g.type.padEnd(5)} ${st} = [${ut}];`,g.uid),st):mt?`${g.type}(${ut})`:(A(p,`${g.type.padEnd(5)} ${st} = ${g.type}(${ut});`,g.uid),st)}}var at=m(86451);class H{constructor(p,g,D){this.variableName=p,this.variableInputType=g,this.node=D,this.type="shader-input",this.isUsed=!1}clone(){return new H(this.variableName,this.variableInputType,(0,at.UV)(this.node))}}class ht{constructor(p,g,D){this.outVariableName=p,this.outVariableType=g,this.node=D,this.type="shader-output"}clone(){const p=new ht(this.outVariableName,this.outVariableType,(0,at.UV)(this.node));return p.variableName=this.variableName,p}}class lt{static createVertex(p,g,D,F,K,st){const mt=[];for(const Et in p){const Mt=p[Et],Ut=D.get(Et);mt.push(Ut?new H(Ut,"builtin",Mt):new H("a_"+Et,"attribute",Mt))}for(const Et of F)mt.push(new H(Et.uniformName,"uniform",Et.uniformHydrated));const ut=[];for(const Et in g){const Mt=g[Et];ut.push("glPosition"===Et?new ht("gl_Position","builtin",Mt):"glPointSize"===Et?new ht("gl_PointSize","builtin",Mt):new ht("v_"+Et,"varying",Mt))}return new lt(mt,ut,K,st)}static createFragment(p,g,D,F,K,st){const mt=[],ut=Array.from(K.rootOutputNodes());for(const Mt in p){const Ut=p[Mt],Pt=D.get(Mt);if(Pt){mt.push(new H(Pt,"builtin",Ut));continue}const Vt=ut.find(N=>N.node===Ut);Vt&&mt.push(new H(Vt.outVariableName,Vt.outVariableType,Ut))}for(const Mt of F)mt.push(new H(Mt.uniformName,"uniform",Mt.uniformHydrated));const Et=[];for(const Mt in g){const Ut=g[Mt],Pt=D.get(Mt);if("discard"===Mt)Et.push(new ht(null,"discard",Ut));else{if(!Pt)throw new Error(`Member ${Mt} in shader fragment output shoule be tagged as builtin`);Et.push(new ht(Pt,"builtin",Ut))}}return new lt(mt,Et,st)}constructor(p,g,D,F){this.type="shader-graph-context",this.indent=0,this.body="",this.varCount=0,this._inputShaderTypesByNodeUid=new Map,this._nodeEmitMap=new Map;for(const K of p)this._inputShaderTypesByNodeUid.set(K.node.uid,K);this._outputShaderTypes=g,this._transformFeedbackBindings=D,this._transformFeedbackNames=new Set(D.map(K=>"v_"+K.propertyKey)),this._usedInFragmentShader=F}shouldPruneOutputNode(p){return!!this._usedInFragmentShader&&"builtin"!==p.outVariableType&&!this._transformFeedbackNames.has(p.outVariableName)&&!this._usedInFragmentShader.has(p.node.uid)}setEmit(p,g){this._nodeEmitMap.set(p.uid,g)}getEmit(p){return this._nodeEmitMap.get(p.uid)}inputs(){return this._inputShaderTypesByNodeUid.values()}getInput(p){return this._inputShaderTypesByNodeUid.get(p.uid)}*rootOutputNodes(){for(const p of this._outputShaderTypes)yield p}*nodes(){const p=[];for(const g of this._outputShaderTypes.values())p.push(g.node);for(;p.length;){const g=p.pop();"number"!=typeof g&&"boolean"!=typeof g&&p.push(...g.children.filter(Boolean)),yield g}}*nodesOfTypeOrFunction(){for(const p of this.nodes())"number"!=typeof p&&"boolean"!=typeof p&&(yield p)}createSubgraphContext(){const p=this.clone();return p.body="",p.indent=this.indent+2,p._nodeEmitMap=new Map(this._nodeEmitMap),p}clone(){const p=new lt([],this._outputShaderTypes,this._transformFeedbackBindings,this._usedInFragmentShader);return p._inputShaderTypesByNodeUid=this._inputShaderTypesByNodeUid,p.indent=this.indent,p.body=this.body,p.varCount=this.varCount,p._nodeEmitMap=this._nodeEmitMap,p}insertVertexShader(p){p.vertex.code.add(""),this._insertInputs(p,"vertex"),p.vertex.code.add(""),p.vertex.code.add("// OUTPUTS: "),p.vertex.code.add("// --------------------------------------------------------- ");for(const g of this.rootOutputNodes()){const D="builtin"===g.outVariableType;this.shouldPruneOutputNode(g)||p.vertex.code.add(D?`// ${g.outVariableType.padEnd(7)} ${g.node.type.padEnd(9)} ${g.outVariableName};`:`${g.outVariableType.padEnd(10)} ${g.node.type.padEnd(9)} ${g.outVariableName};`)}p.vertex.code.add(""),p.vertex.code.add("void main() {"),p.vertex.code.add("  "+this.body.split("\n").join("\n  "));for(const g of this.rootOutputNodes())this.shouldPruneOutputNode(g)||p.vertex.code.add(`  ${g.outVariableName} = ${g.variableName};`);p.vertex.code.add("}")}insertFragmentShader(p){this._insertInputs(p,"fragment"),p.fragment.code.add(""),p.fragment.code.add("void main() {"),p.fragment.code.add("  "+this.body.split("\n").join("\n  "));for(const g of this.rootOutputNodes())"discard"===g.outVariableType?(p.fragment.code.add("  // TODO: Should ensure codegen for discard appears first in fragment shader"),p.fragment.code.add(`  if (${g.variableName}) {`),p.fragment.code.add("    discard;"),p.fragment.code.add("  }"),p.fragment.code.add("  ")):p.fragment.code.add(`  ${g.outVariableName} = ${g.variableName};`);p.fragment.code.add("}")}_insertInputs(p,g){p[g].code.add("// INPUTS: "),p[g].code.add("// --------------------------------------------------------- ");for(const D of this.inputs())D.isUsed&&"builtin"!==D.variableInputType&&p[g].code.add("array"===D.node.type?`${D.variableInputType.padEnd(10)} ${D.node.elementType.type.padEnd(9)} ${D.variableName}[${D.node.size}];`:`${D.variableInputType.padEnd(10)} ${D.node.type.padEnd(9)} ${D.variableName};`)}}var xt=m(61594);function pt(it){return new it}function vt(it,p,g){const D=it.constructor[p]??[];it.constructor.hasOwnProperty(p)||Object.defineProperty(it.constructor,p,{value:D.slice()}),it.constructor[p].push(g)}function _t(it,p){return(g,D)=>{vt(g,"locations",{typeCtor:p,propertyKey:D,parameterIndex:null,index:it})}}const B=it=>(p,g,D)=>{vt(p,"inputs",{inputCtor:it,propertyKey:g,parameterIndex:D})},At=it=>(p,g)=>{vt(p,"uniforms",{typeCtor:it,propertyKey:g})},Bt=it=>(p,g)=>{vt(p,"options",{typeCtor:it,propertyKey:g})},yt=(it,p)=>{vt(it,"defines",{propertyKey:p})},Ot=(it,p)=>(g,D)=>{g.constructor.builtins.push({builtin:it,propertyKey:D,typeCtor:p})};class zt{}zt.builtins=[],(0,x._)([Ot("gl_VertexID",rt.J7)],zt.prototype,"glVertexID",void 0);class Qt{}class Dt{}Dt.builtins=[],(0,x._)([Ot("gl_FragCoord",rt.T8)],Dt.prototype,"glFragCoord",void 0),(0,x._)([Ot("gl_PointCoord",rt.Sg)],Dt.prototype,"glPointCoord",void 0);class gt{}(0,x._)([("gl_FragColor",(p,g)=>{vt(p,"builtins",{builtin:"gl_FragColor",propertyKey:g})})],gt.prototype,"glFragColor",void 0);class Rt{constructor(){this.type="uniform-group"}get _uniforms(){return this.constructor.uniforms??[]}}class Jt{constructor(){this.logShader=!1,this.computeAttributes={}}get vertexInput(){const p=(0,y.dF)(this._shaderModuleClass.inputs,g=>"vertex"===g.propertyKey&&0===g.parameterIndex);if(!p)throw new Error("Unable to find vertex input parameter");return p}get computeInput(){return(0,y.dF)(this._shaderModuleClass.inputs,p=>"vertex"===p.propertyKey&&1===p.parameterIndex)}get fragmentInput(){const p=(0,y.dF)(this._shaderModuleClass.inputs,g=>"fragment"===g.propertyKey);if(!p)throw new Error("Unable to find fragment input parameter");return p}get transformFeedbackBindings(){return this.fragmentInput.inputCtor.transformFeedbackBindings??[]}get locations(){return[...this.vertexInput.inputCtor.locations,...this.computeInput?.inputCtor.locations??[]]}get locationsMap(){const p=new Map,g=new Set;for(const D of this.locations)g.has(D.index)?f.Z.getLogger("esri.views.2d.engine.webgl.shaderGraph.GraphShaderModule").warnOnce("mapview-rendering",`Unable to assigned attribute ${D.propertyKey} to ${D.index}. Index already in use`,{locationsMap:p}):(p.set(D.propertyKey,D.index),g.add(D.index));return p}get locationInfo(){if(!this._locationInfo){const p=this.locationsMap,g=Array.from(p.entries()).map(([F,K])=>`${F}.${K}`).join("."),D=(0,b.hP)(g);this._locationInfo={hash:D,locations:p}}return this._locationInfo}get renamedLocationsMap(){const p=new Map;for(const g of this.locations)p.set("a_"+g.propertyKey,g.index);return p}get optionPropertyKeys(){if(!this._optionPropertyKeys){const p=new Set;for(const g of this._options)p.add(g.propertyKey);this._optionPropertyKeys=p}return this._optionPropertyKeys}get _shaderModuleClass(){return this.constructor}get _defines(){return this._shaderModuleClass.defines??[]}get _options(){return this._shaderModuleClass.options??[]}get _uniforms(){return this._shaderModuleClass.uniforms??[]}getProgram(p,g,D,F){try{const{vertex:K,fragment:st,uniformBindings:mt}=this._generateShaders(p,g,D,F);return new xt.X(K,st,this.renamedLocationsMap,this.locationInfo,mt,this.transformFeedbackBindings)}catch(K){return console.error("Failed to create program",{error:K}),new xt.X("","",this.renamedLocationsMap,this.locationInfo,[],this.transformFeedbackBindings)}}getDebugUniformClassInfo(p){const g=this._options.find(F=>F.propertyKey===p);if(g)return{type:"option",className:g.typeCtor};const D=this._uniforms.find(F=>F.propertyKey===p);if(!D)throw new Error(`Unable to find uniform class type for property: ${p}`);return{type:"required",className:D.typeCtor}}getShaderKey(p,g,D,F){const K=Object.keys(D).map(ut=>`${ut}.${D[ut]}`).join("."),st=Object.keys(F).map(ut=>`${ut}.${F[ut]}`).join("."),mt=Object.keys(g).filter(ut=>this.optionPropertyKeys.has(ut)&&g[ut]).join(".");return`${this.constructor.name}.${p.hash}.${K}.${st}.${mt}`}_generateShaders(p,g,D,F){const K=[];this._setDefines(D),this._setOptionalUniforms(K,g),this._setRequiredUniforms(K);const st=this._hydrateVertexInput(F),mt=this._injectPackPrecisionFactor(st,p),ut=this._hydrateComputeInput(),Et=ut&&this._injectPackPrecisionFactor(ut,p),Mt=this.vertex(mt,Et),Ut=this._hydrateFragmentInput(Mt),Pt=this.fragment(Ut),Vt=new Set;for(const qt in Pt)(0,at.Q0)(Vt,Pt[qt]);const N=this._getVertexInputBuiltins(),Ft=lt.createVertex({...st,...ut},Mt,N,K,this.transformFeedbackBindings,Vt);(new nt).write(Ft);const Ct=this._getFragmentInputBuiltins(Pt);Ct.set("glPointCoord","gl_PointCoord");const ot=lt.createFragment(Ut,Pt,Ct,K,Ft,this.transformFeedbackBindings);(new nt).write(ot);const Kt=this._createShaderBuilder(Ft,ot),jt=Kt.generate("vertex",!1),Nt=Kt.generate("fragment",!1);return this.logShader&&(console.log(jt),console.log(Nt)),{vertex:jt,fragment:Nt,uniformBindings:K}}_setDefines(p){for(const g in p)this[g]=p[g]}_setOptionalUniforms(p,g){for(const D of this._options)this[D.propertyKey]=g[D.propertyKey]?this._hydrateUniformGroup(p,D):null}_setRequiredUniforms(p){for(const g of this._uniforms)this[g.propertyKey]=this._hydrateUniformGroup(p,g)}_hydrateUniformGroup(p,g){const D=new g.typeCtor;for(const F of D._uniforms??[]){const K=pt(F.typeCtor),st=`u_${g.propertyKey}_${F.propertyKey}`,mt=K.type,ut=[g.propertyKey,F.propertyKey].join(".");p.push("type"in F.typeCtor&&"array"===F.typeCtor.type?{shaderModulePath:ut,uniformName:st,uniformType:mt,uniformArrayLength:K.size,uniformArrayElementType:K.elementType.type,uniformHydrated:K}:{shaderModulePath:ut,uniformName:st,uniformType:mt,uniformHydrated:K}),D[F.propertyKey]=K}return D}_hydrateVertexInput(p){const g=this.vertexInput.inputCtor,D=g.locations.reduce((F,K)=>!1===p[K.propertyKey]?F:{...F,[K.propertyKey]:pt(K.typeCtor)},{});for(const{propertyKey:F,typeCtor:K}of g.builtins){const st=pt(K);D[F]=st}return D}_hydrateComputeInput(){return null==this.computeInput?null:this.computeInput.inputCtor.locations.reduce((p,g)=>({...p,[g.propertyKey]:pt(g.typeCtor)}),{})}_injectPackPrecisionFactor(p,g){const D={};for(const F in p){const K=p[F],st=g.attributes.find(mt=>mt.name===F);if(st?.packPrecisionFactor){if("float"!==K.type&&"vec2"!==K.type&&"vec3"!==K.type&&"vec4"!==K.type)throw new Error(`InternalError: packPrecisionFactor requires GenType, but found ${K.type}`);D[F]=K.divide(new rt.bv(st.packPrecisionFactor))}else D[F]=K}return D}_hydrateFragmentInput(p){const g={};for(const D in p)g[D]=p[D];for(const{propertyKey:D,typeCtor:F}of Dt.builtins){const K=pt(F);g[D]=K}return g}_getVertexInputBuiltins(){const p=this.vertexInput.inputCtor,g=new Map;for(const{builtin:D,propertyKey:F}of p.builtins)g.set(F,D);return g}_getFragmentInputBuiltins(p){const g=p.constructor,D=new Map;for(const F of g.builtins??[])D.set(F.propertyKey,F.builtin);return D}_createShaderBuilder(p,g){const D=new Z;return this._insertDebugInfo(D),p.insertVertexShader(D),g.insertFragmentShader(D),D}_insertDebugInfo(p){p.vertex.code.add("// DEFINES: "),p.vertex.code.add("// --------------------------------------------------------- ");for(const g of this._defines)p.vertex.code.add(this[g.propertyKey]?`//   ${g.propertyKey}: true`:`//   ${g.propertyKey}: false`);p.vertex.code.add(""),p.vertex.code.add("// OPTIONS: "),p.vertex.code.add("// --------------------------------------------------------- ");for(const g of this._options)p.vertex.code.add(this[g.propertyKey]?`//   ${g.propertyKey}: true`:`//   ${g.propertyKey}: false`)}}},86451:(Wt,ct,m)=>{function y(j,U){const w=[];for(w.push(U);w.length;){const T=w.pop();if("object"==typeof T&&!j.has(T.uid)){j.add(T.uid);for(const v of T.children)w.push(v)}}}m.d(ct,{Q0:()=>y,UV:()=>b,Yo:()=>$,Ys:()=>Q,h9:()=>Y,lJ:()=>Z,rK:()=>tt});class f{constructor(){this.uid=f.NodeCount++,this._debugName=null,this._isMutable=!1,this.isImplicit=!1}get isMutable(){return this._isMutable}setMutable(){return this._isMutable=!0,this}setDebugName(U){return U=function x(j){return j.split(" ").map((U,w)=>w>0?U.charAt(0).toUpperCase()+U.slice(1):U).join("")}(U),this._debugName=U,this.isImplicit&&this.children[0]instanceof f&&this.children[0].setDebugName(U),this}get debugInfo(){return{name:this._debugName??""}}cloneInto(U){U._debugName=this._debugName,U._isMutable=this._isMutable,U.isImplicit=this.isImplicit,U.uid=this.uid}}function b(j){return"object"==typeof j?j.clone():j}f.NodeCount=0;class Y extends f{constructor(){super(...arguments),this.shaderType="primitive-node"}}class X extends f{constructor(U){super(),this.child=U,this.shaderType="scope-node"}get children(){return[this.child]}clone(){const U=new X(b(this.child));return this.cloneInto(U),U}}class tt extends f{constructor(U,w,T){super(),this.property=U,this.target=w,this.returnType=T,this.shaderType="property-access-node"}get children(){const U=[this.target];return"string"!=typeof this.property&&U.push(this.property),U}clone(){const U=new tt(this.property,b(this.target),this.returnType);return this.cloneInto(U),U}}class $ extends f{constructor(U,w,T){super(),this.condition=U,this.ifTrue=w,this.ifFalse=T,this.shaderType="condition-node"}get children(){return[this.condition,this.ifTrue,this.ifFalse]}clone(){const U=b(this.ifTrue),w=this.ifFalse?b(this.ifFalse):null,T=new $(this.condition,U,w);return this.cloneInto(T),T}}class Z extends f{constructor(U,w,T,v){super(),this.captureList=U,this.returnType=w,this.generator=v,this.shaderType="block-node",T&&(this.subgraph=new X(T))}get children(){return Object.keys(this.captureList).map(U=>this.captureList[U]).concat(this.subgraph??[])}clone(){const U={};for(const T in this.captureList)U[T]=b(this.captureList[T]);const w=new Z(U,this.returnType,this.subgraph?b(this.subgraph.child):this.subgraph,this.generator);return this.cloneInto(w),w}}class Q extends f{constructor(U,w,T,v,O,L=!1){super(),this.token=U,this._children=w,this.isInfix=T,this.isPropertyAccess=v,this.returnType=O,this.isTernary=L,this.shaderType="function-node"}get children(){return this._children}clone(){const U=new Q(this.token,this._children.map(b),this.isInfix,this.isPropertyAccess,this.returnType,this.isTernary);return this.cloneInto(U),U}}},99963:(Wt,ct,m)=>{m.d(ct,{AK:()=>le,AO:()=>B,CD:()=>Ye,CW:()=>Mr,Dg:()=>ye,Eg:()=>vt,Fp:()=>fr,Fv:()=>Pe,GW:()=>cr,Iz:()=>Je,J7:()=>Jt,K4:()=>Et,KJ:()=>de,Nb:()=>ee,O$:()=>_e,Qj:()=>Zt,R3:()=>Mt,Sg:()=>V,T8:()=>At,TE:()=>Re,Tu:()=>F,VV:()=>yr,Wn:()=>Se,ZI:()=>lr,bv:()=>_t,e$:()=>mt,ff:()=>mr,fz:()=>ut,hx:()=>Xt,ig:()=>Tr,kE:()=>hr,ln:()=>ve,mC:()=>be,mD:()=>sr,or:()=>Ee,r7:()=>Ue,tS:()=>qe,tW:()=>zt,tk:()=>Nt,uZ:()=>ir,v8:()=>pt,vh:()=>Ut,wO:()=>Vt,wQ:()=>Ze,wV:()=>fe,xD:()=>Ce,yb:()=>K});var f,b,Y,X,W,tt,$,Z,Q,j,U,w,T,v,x=m(17626),y=m(86451);function at(a){return new Proxy(a,{get(M,P){if("constructor"===P)return new Proxy(M.constructor,{construct:(q,Tt,Lt)=>at(new q(...Tt))});if(P in M)return M[P];if("string"==typeof P){const q=function nt(a){const M=[["float","vec2","vec3","vec4"],["int","ivec2","ivec3","ivec4"],["uint","uvec2","uvec3","uvec4"],["bool","bvec2","bvec3","bvec4"]];for(const P of M)if(P.includes(a))return P.map(q=>st[q]);throw new Error("Unable to find type family")}(a.type);return Ft(a,P,q[P.length-1])}}})}function H(a){return new Proxy(a,{construct:(M,P,q)=>at(new M(...P))})}class xt extends Error{}let pt=f=class extends y.h9{constructor(a,M){super(),this.elementType=a,this.size=M,this.children=[],this.type="array"}clone(){const a=new f(this.elementType,this.size);return super.cloneInto(a),a}get(a){if("number"==typeof a){const M=new Jt(a);return M.isImplicit=!0,Ft(this,M,this.elementType.constructor)}return Ft(this,a,this.elementType.constructor)}last(){return this.get(this.size-1)}first(){return this.get(0)}findIndex(a,M,P){return function se(a,M,P=0,q=a.size){const Tt=new Jt(P).setMutable().setDebugName("FindIndexIterator"),Lt=M(a.get(Tt)).setDebugName("FindIndexPredicate");return qt({iter:Tt},Jt,Lt,({out:o,iter:r,subgraph:s})=>`\n${o} = -1;\n\nfor (; ${r} < ${q}; ${r}++) {\n\n${s.body}\n\n  if (${s.varName}) {\n    ${o} = ${r};\n    break;\n  }\n\n}\n`).setDebugName("FindIndexBlock")}(this,a,M,P)}glslFindIndex(a,M,P){return function ie(a,M,P=0,q=a.size){return qt({array:a},Jt,null,({out:Lt,array:re})=>`\n${Lt} = -1;\nfor (int i = ${P}; i < ${q}; i++) {\n  bool condition;\n  ${M({array:re,i:"i",out:"condition"})}\n  if (condition) {\n    ${Lt} = i;\n    break;\n  }\n}\n`).setDebugName("GlslFindIndexBlock")}(this,a,M,P)}static ofType(a,M){const P={construct:(q,Tt)=>new f(new a,M)};return new Proxy(f,P)}};pt.type="array",pt=f=(0,x._)([function lt(a){return new Proxy(a,{construct:(M,P,q)=>function ht(a){return new Proxy(a,{get(M,P){if(P in M)return M[P];if("string"==typeof P){const q=parseInt(P,10);if(!isNaN(q))return Ft(a,`[${q}]`,a.elementType.constructor)}}})}(new M(...P))})}],pt);let vt=(()=>{class a extends y.h9{constructor(){super(...arguments),this.type="sampler2D",this.children=[]}clone(){const P=new a;return P.children=this.children.map(y.UV),super.cloneInto(P),P}}return a.type="sampler2D",a})(),_t=(()=>{class a extends y.h9{constructor(P){super(),this.type="float",this.children=[P]}clone(){const P=new a((0,y.UV)(this.children[0]));return super.cloneInto(P),P}multiply(P){return te(this,"number"==typeof P?gt(P,a):P)}divide(P){return pe(this,"number"==typeof P?gt(P,a):P)}add(P){return oe(this,"number"==typeof P?gt(P,a):P)}subtract(P){return ae(this,"number"==typeof P?gt(P,a):P)}}return a.type="float",a})(),V=b=class extends y.h9{constructor(a,M){super(),this.type="vec2",this.children=[a,M].filter(P=>null!=P)}clone(){const a=new b((0,y.UV)(this.children[0]),(0,y.UV)(this.children[1]));return super.cloneInto(a),a}get 0(){return Ft(this,"[0]",_t)}get 1(){return Ft(this,"[1]",_t)}get 2(){throw new xt}get 3(){throw new xt}multiply(a){return te(this,"number"==typeof a?gt(a,_t):a)}divide(a){return pe(this,"number"==typeof a?gt(a,_t):a)}add(a){return oe(this,"number"==typeof a?gt(a,_t):a)}subtract(a){return ae(this,"number"==typeof a?gt(a,_t):a)}};V.type="vec2",V=b=(0,x._)([H],V);let B=Y=class extends y.h9{constructor(a,M,P){super(),this.type="vec3",this.children=[a,M,P].filter(q=>null!=q)}get 0(){return Ft(this,"[0]",_t)}get 1(){return Ft(this,"[1]",_t)}get 2(){return Ft(this,"[2]",_t)}get 3(){throw new xt}clone(){const a=new Y((0,y.UV)(this.children[0]),(0,y.UV)(this.children[1]),(0,y.UV)(this.children[2]));return super.cloneInto(a),a}multiply(a){return te(this,"number"==typeof a?gt(a,_t):a)}divide(a){return pe(this,"number"==typeof a?gt(a,_t):a)}add(a){return oe(this,"number"==typeof a?gt(a,_t):a)}subtract(a){return ae(this,"number"==typeof a?gt(a,_t):a)}};B.type="vec3",B=Y=(0,x._)([H],B);let At=X=class extends y.h9{constructor(a,M,P,q){super(),this.type="vec4",this.children=[a,M,P,q].filter(Tt=>null!=Tt)}clone(){const a=new X((0,y.UV)(this.children[0]),(0,y.UV)(this.children[1]),(0,y.UV)(this.children[2]),(0,y.UV)(this.children[3]));return super.cloneInto(a),a}get 0(){return Ft(this,"[0]",_t)}get 1(){return Ft(this,"[1]",_t)}get 2(){return Ft(this,"[2]",_t)}get 3(){return Ft(this,"[3]",_t)}multiply(a){return te(this,"number"==typeof a?gt(a,_t):a)}divide(a){return pe(this,"number"==typeof a?gt(a,_t):a)}add(a){return oe(this,"number"==typeof a?gt(a,_t):a)}subtract(a){return ae(this,"number"==typeof a?gt(a,_t):a)}};At.type="vec4",At=X=(0,x._)([H],At);let Bt=W=class extends y.h9{constructor(a){super(),this.type="uint",this.children=[a]}clone(){const a=new W((0,y.UV)(this.children[0]));return super.cloneInto(a),a}};Bt.type="uint",Bt=W=(0,x._)([H],Bt);let yt=tt=class extends y.h9{constructor(a,M){super(),this.type="uvec2",this.children=[a,M].filter(P=>null!=P)}clone(){const a=new tt((0,y.UV)(this.children[0]),(0,y.UV)(this.children[1]));return super.cloneInto(a),a}};yt.type="uvec2",yt=tt=(0,x._)([H],yt);let wt=$=class extends y.h9{constructor(a,M,P){super(),this.type="uvec3",this.children=[a,M,P].filter(q=>null!=q)}clone(){const a=new $((0,y.UV)(this.children[0]),(0,y.UV)(this.children[1]),(0,y.UV)(this.children[2]));return super.cloneInto(a),a}};wt.type="uvec3",wt=$=(0,x._)([H],wt);let Ot=Z=class extends y.h9{constructor(a,M,P,q){super(),this.type="uvec4",this.children=[a,M,P,q].filter(Tt=>null!=Tt)}clone(){const a=new Z((0,y.UV)(this.children[0]),(0,y.UV)(this.children[1]),(0,y.UV)(this.children[2]),(0,y.UV)(this.children[3]));return super.cloneInto(a),a}};Ot.type="uvec4",Ot=Z=(0,x._)([H],Ot);let zt=(()=>{class a extends y.h9{constructor(P){super(),this.type="bool",this.children=[P]}and(P){return Ce(this,P)}or(P){return Ee(this,P)}clone(){const P=new a((0,y.UV)(this.children[0]));return super.cloneInto(P),P}}return a.type="bool",a})(),Qt=Q=class extends y.h9{constructor(a,M){super(),this.type="bvec2",this.children=[a,M].filter(P=>null!=P)}all(){return Me(this)}any(){return De(this)}clone(){const a=new Q((0,y.UV)(this.children[0]),(0,y.UV)(this.children[1]));return super.cloneInto(a),a}};Qt.type="bvec2",Qt=Q=(0,x._)([H],Qt);let Dt=j=class extends y.h9{constructor(a,M,P){super(),this.type="bvec3",this.children=[a,M,P].filter(q=>null!=q)}all(){return Me(this)}any(){return De(this)}clone(){const a=new j((0,y.UV)(this.children[0]),(0,y.UV)(this.children[1]),(0,y.UV)(this.children[2]));return super.cloneInto(a),a}};function gt(a,M){return"number"==typeof a?new M(a):a}Dt.type="bvec3",Dt=j=(0,x._)([H],Dt);let Rt=U=class extends y.h9{constructor(a,M,P,q){super(),this.type="bvec4",this.children=[a,M,P,q].filter(Tt=>null!=Tt)}all(){return Me(this)}any(){return De(this)}clone(){const a=new U((0,y.UV)(this.children[0]),(0,y.UV)(this.children[1]),(0,y.UV)(this.children[2]),(0,y.UV)(this.children[3]));return super.cloneInto(a),a}};Rt.type="bvec4",Rt=U=(0,x._)([H],Rt);let Jt=(()=>{class a extends y.h9{constructor(P){super(),this.type="int",this.children=[P]}multiply(P){return te(this,gt(P,a))}add(P){return oe(this,gt(P,a))}subtract(P){return ae(this,gt(P,a))}divide(P){return pe(this,gt(P,a))}clone(){const P=new a((0,y.UV)(this.children[0]));return super.cloneInto(P),P}}return a.type="int",a})(),it=w=class extends y.h9{constructor(a,M){super(),this.type="ivec2",this.children=[a,M].filter(P=>null!=P)}clone(){const a=new w((0,y.UV)(this.children[0]),(0,y.UV)(this.children[1]));return super.cloneInto(a),a}};it.type="ivec2",it=w=(0,x._)([H],it);let p=T=class extends y.h9{constructor(a,M,P){super(),this.type="ivec3",this.children=[a,M,P].filter(q=>null!=q)}clone(){const a=new T((0,y.UV)(this.children[0]),(0,y.UV)(this.children[1]),(0,y.UV)(this.children[2]));return super.cloneInto(a),a}};p.type="ivec3",p=T=(0,x._)([H],p);let g=v=class extends y.h9{constructor(a,M,P,q){super(),this.type="ivec4",this.children=[a,M,P,q].filter(Tt=>null!=Tt)}clone(){const a=new v((0,y.UV)(this.children[0]),(0,y.UV)(this.children[1]),(0,y.UV)(this.children[2]),(0,y.UV)(this.children[3]));return super.cloneInto(a),a}};g.type="ivec4",g=v=(0,x._)([H],g);let F=(()=>{class a extends y.h9{static identity(){return new a(1,0,0,0,1,0,0,0,1)}static fromRotation(P){const q=_e(P),Tt=be(P);return new a(Tt,q,0,Nt(q),Tt,0,0,0,1)}constructor(P,q,Tt,Lt,re,o,r,s,c){super(),this.type="mat3",this.children=[P,q,Tt,Lt,re,o,r,s,c]}add(P){return oe(this,P)}multiply(P){return te(this,P)}clone(){const P=new a((0,y.UV)(this.children[0]),(0,y.UV)(this.children[1]),(0,y.UV)(this.children[2]),(0,y.UV)(this.children[3]),(0,y.UV)(this.children[4]),(0,y.UV)(this.children[5]),(0,y.UV)(this.children[6]),(0,y.UV)(this.children[7]),(0,y.UV)(this.children[8]));return super.cloneInto(P),P}}return a.type="mat3",a})(),K=(()=>{class a extends y.h9{static identity(){return new a(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}constructor(P,q,Tt,Lt,re,o,r,s,c,h,d,_,E,S,C,I){super(),this.type="mat4",this.children=[P,q,Tt,Lt,re,o,r,s,c,h,d,_,E,S,C,I]}static fromColumns(P,q,Tt,Lt){return new a(P.x,P.y,P.z,P.w,q.x,q.y,q.z,q.w,Tt.x,Tt.y,Tt.z,Tt.w,Lt.x,Lt.y,Lt.z,Lt.w)}multiply(P){return te(this,P)}clone(){const P=new a((0,y.UV)(this.children[0]),(0,y.UV)(this.children[1]),(0,y.UV)(this.children[2]),(0,y.UV)(this.children[3]),(0,y.UV)(this.children[4]),(0,y.UV)(this.children[5]),(0,y.UV)(this.children[6]),(0,y.UV)(this.children[7]),(0,y.UV)(this.children[8]),(0,y.UV)(this.children[9]),(0,y.UV)(this.children[10]),(0,y.UV)(this.children[11]),(0,y.UV)(this.children[12]),(0,y.UV)(this.children[13]),(0,y.UV)(this.children[14]),(0,y.UV)(this.children[15]));return super.cloneInto(P),P}}return a.type="mat4",a})();const st={float:_t,vec2:V,vec3:B,vec4:At,int:Jt,ivec2:it,ivec3:p,ivec4:g,uint:Bt,uvec2:yt,uvec3:wt,uvec4:Ot,bool:zt,bvec2:Qt,bvec3:Dt,bvec4:Rt},mt=(...a)=>new Jt(...a),ut=(...a)=>new _t(...a),Et=(...a)=>new V(...a),Mt=(...a)=>new B(...a),Ut=(...a)=>new At(...a),Vt=(...a)=>new F(...a);function Ft(a,M,P){const q=new P(new y.rK(M,a,P));return q.isImplicit=!0,q}function Ct(a,M,P,q=null){if(q){const Lt=new q,re=new q(new y.Ys(a,[M,P],!0,!1,Lt));return re.isImplicit=!0,re}if("float"===M.type||"int"===M.type){const Lt=new P.constructor(new y.Ys(a,[M,P],!0,!1,P.constructor));return Lt.isImplicit=!0,Lt}if(("mat2"===M.type||"mat3"===M.type||"mat4"===M.type)&&"float"!==P.type){const Lt=new P.constructor(new y.Ys(a,[M,P],!0,!1,P.constructor));return Lt.isImplicit=!0,Lt}const Tt=new M.constructor(new y.Ys(a,[M,P],!0,!1,M.constructor));return Tt.isImplicit=!0,Tt}function ot(a,M,P=M.constructor){const q=new P(new y.Ys(a,[M],!1,!1,P));return q.isImplicit=!0,q}function Kt(a,M,P,q=M.constructor){const Tt=new q(new y.Ys(a,[M,P],!1,!1,q));return Tt.isImplicit=!0,Tt}function jt(a,M,P,q,Tt=M.constructor){const Lt=new Tt(new y.Ys(a,[M,P,q],!1,!1,Tt));return Lt.isImplicit=!0,Lt}function Nt(a){return te(a,ut(-1))}function qt(a,M,P,q){return new M(new y.lJ(a,M,P,q))}function de(a,M,P){const q="function"==typeof M?M():M,Tt="function"==typeof P?P():P,Lt=new q.constructor(new y.Yo(a,q,Tt));return Lt.isImplicit=!0,Lt}function fe(...a){const M=a.map(([o,r])=>"function"==typeof r?[o,r()]:[o,r]),P=M[0][1].constructor,q=M.findIndex(o=>!0===o[0]);if(-1===q)throw new Error("A cond must have a fallthrough case with `true`/; ");const re=new P(M.slice(0,q).reduceRight((o,r)=>de(r[0],r[1],o),M[q][1]));return re.isImplicit=!0,re}function te(a,M){return Ct("*",a,M)}function pe(a,M){return Ct("/",a,M)}function oe(a,M){return Ct("+",a,M)}function ae(a,M){return Ct("-",a,M)}function ye(a,M){return Ct(">>",a,M)}function Xt(a,M){return Ct("&",a,M)}function ve(a,M){return Ct("==",a,M,zt)}function Zt(a,M){return Ct("<",a,M,zt)}function Je(a,M){return Ct("<=",a,M,zt)}function qe(a,M){return Ct(">",a,M,zt)}function Ue(a,M){return Ct(">=",a,M,zt)}function Ee(...a){return a.length<=1?a[0]:a.slice(1).reduce((M,P)=>function je(a,M){return Ct("||",a,M,zt)}(M,P),a[0])}function Ce(...a){return a.length<=1?a[0]:a.slice(1).reduce((M,P)=>function We(a,M){return Ct("&&",a,M,zt)}(M,P),a[0])}function Se(a){return ot("abs",a)}function Me(a){return ot("all",a,zt)}function De(a){return ot("any",a,zt)}function sr(a){return ot("ceil",a)}function ir(a,M,P){return jt("clamp",a,M,P,a.constructor)}function be(a){return ot("cos",a)}function Re(a,M){return Kt("distance",a,M,_t)}function le(a,M){return Kt("dot",a,M,_t)}function cr(a){return ot("floor",a)}function lr(a){return ot("fract",a)}function hr(a){return ot("length",a,_t)}function fr(a,M){return Kt("max",a,M)}function yr(a,M){return Kt("min",a,M)}function Ye(a,M,P){return jt("mix",a,M,P)}function Ze(a,M){return Kt("mod",a,M)}function Pe(a){return ot("normalize",a)}function mr(a){return ot("bool"===a.type?"!":"not",a)}function _e(a){return ot("sin",a)}function Mr(a,M,P){return jt("smoothstep",a,M,P)}function ee(a,M){return Kt("step",a,M,M.constructor)}function Tr(a,M){return Kt("texture2D",a,M,At)}},50305:(Wt,ct,m)=>{m.d(ct,{m:()=>x});const x={bitset:{isSDF:0,isMapAligned:1,scaleSymbolsProportionally:2,overrideOutlineColor:3,colorLocked:4}}},24962:(Wt,ct,m)=>{m.d(ct,{U:()=>Lt});var x=m(15861),y=m(8314),f=m(58774),Y=(m(11915),m(13160)),X=m(88071),W=m(39351);function tt(o,r,s,c,h,d,_){zt=0;const E=(c-s)*d,S=h&&h.length,C=S?(h[0]-s)*d:E;let I,R,z,k,et,dt=$(r,s,0,0,C,d,!0);if(dt&&dt.next!==dt.prev){if(S&&(dt=function O(o,r,s,c,h,d){const _=new Array;for(let E=0,S=c.length;E<S;E++){const C=$(o,r,0,c[E]*d,E<S-1?c[E+1]*d:s*d,d,!1);C===C.next&&(C.steiner=!0),_.push(v(C))}_.sort(vt);for(const E of _)h=L(E,h);return h}(r,s,c,h,dt,d)),E>80*d){I=z=r[0+s*d],R=k=r[1+s*d];for(let ft=d;ft<C;ft+=d){const St=r[ft+s*d],It=r[ft+1+s*d];I=Math.min(I,St),R=Math.min(R,It),z=Math.max(z,St),k=Math.max(k,It)}et=Math.max(z-I,k-R),et=0!==et?1/et:0}Q(dt,o,d,I,R,et,_,0)}}function $(o,r,s,c,h,d,_){let E;if(_===function H(o,r,s,c,h,d){let _=0;for(let E=c,S=h-d;E<h;E+=d)_+=(o[S+r*d]-o[E+r*d])*(o[E+1+r*d]+o[S+1+r*d]),S=E;return _}(o,r,0,c,h,d)>0)for(let S=c;S<h;S+=d)E=w(S+r*d,o[S+r*d],o[S+1+r*d],E);else for(let S=h-d;S>=c;S-=d)E=w(S+r*d,o[S+r*d],o[S+1+r*d],E);return E&&pt(E,E.next)&&(T(E),E=E.next),E}function Z(o,r=o){if(!o)return o;let s,c=o;do{if(s=!1,c.steiner||!pt(c,c.next)&&0!==A(c.prev,c,c.next))c=c.next;else{if(T(c),c=r=c.prev,c===c.next)break;s=!0}}while(s||c!==r);return r}function Q(o,r,s,c,h,d,_,E){if(!o)return;!E&&d&&(o=rt(o,c,h,d));let S=o;for(;o.prev!==o.next;){const C=o.prev,I=o.next;if(d?U(o,c,h,d):j(o))r.push(C.index/s+_),r.push(o.index/s+_),r.push(I.index/s+_),T(o),o=I.next,S=I.next;else if((o=I)===S){E?1===E?Q(o=_t(o,r,s,_),r,s,c,h,d,_,2):2===E&&V(o,r,s,c,h,d,_):Q(Z(o),r,s,c,h,d,_,1);break}}}function j(o){const r=o.prev,s=o,c=o.next;if(A(r,s,c)>=0)return!1;let h=o.next.next;const d=h;let _=0;for(;h!==o.prev&&(0===_||h!==d);){if(_++,ht(r.x,r.y,s.x,s.y,c.x,c.y,h.x,h.y)&&A(h.prev,h,h.next)>=0)return!1;h=h.next}return!0}function U(o,r,s,c){const h=o.prev,d=o,_=o.next;if(A(h,d,_)>=0)return!1;const C=h.x>d.x?h.x>_.x?h.x:_.x:d.x>_.x?d.x:_.x,I=h.y>d.y?h.y>_.y?h.y:_.y:d.y>_.y?d.y:_.y,R=xt(h.x<d.x?h.x<_.x?h.x:_.x:d.x<_.x?d.x:_.x,h.y<d.y?h.y<_.y?h.y:_.y:d.y<_.y?d.y:_.y,r,s,c),z=xt(C,I,r,s,c);let k=o.prevZ,et=o.nextZ;for(;k&&k.z>=R&&et&&et.z<=z;){if(k!==o.prev&&k!==o.next&&ht(h.x,h.y,d.x,d.y,_.x,_.y,k.x,k.y)&&A(k.prev,k,k.next)>=0||(k=k.prevZ,et!==o.prev&&et!==o.next&&ht(h.x,h.y,d.x,d.y,_.x,_.y,et.x,et.y)&&A(et.prev,et,et.next)>=0))return!1;et=et.nextZ}for(;k&&k.z>=R;){if(k!==o.prev&&k!==o.next&&ht(h.x,h.y,d.x,d.y,_.x,_.y,k.x,k.y)&&A(k.prev,k,k.next)>=0)return!1;k=k.prevZ}for(;et&&et.z<=z;){if(et!==o.prev&&et!==o.next&&ht(h.x,h.y,d.x,d.y,_.x,_.y,et.x,et.y)&&A(et.prev,et,et.next)>=0)return!1;et=et.nextZ}return!0}function w(o,r,s,c){const h=yt.create(o,r,s);return c?(h.next=c.next,h.prev=c,c.next.prev=h,c.next=h):(h.prev=h,h.next=h),h}function T(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function v(o){let r=o,s=o;do{(r.x<s.x||r.x===s.x&&r.y<s.y)&&(s=r),r=r.next}while(r!==o);return s}function L(o,r){const s=function G(o,r){let s=r;const c=o.x,h=o.y;let d,_=-1/0;do{if(h<=s.y&&h>=s.next.y&&s.next.y!==s.y){const z=s.x+(h-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(z<=c&&z>_){if(_=z,z===c){if(h===s.y)return s;if(h===s.next.y)return s.next}d=s.x<s.next.x?s:s.next}}s=s.next}while(s!==r);if(!d)return null;if(c===_)return d.prev;const E=d,S=d.x,C=d.y;let I,R=1/0;for(s=d.next;s!==E;)c>=s.x&&s.x>=S&&c!==s.x&&ht(h<C?c:_,h,S,C,h<C?_:c,h,s.x,s.y)&&(I=Math.abs(h-s.y)/(c-s.x),(I<R||I===R&&s.x>d.x)&&lt(s,o)&&(d=s,R=I)),s=s.next;return d}(o,r);if(!s)return r;const c=Bt(s,o);return Z(c,c.next),Z(s,s.next)}function rt(o,r,s,c){let h;for(;h!==o;h=h.next){if(h=h||o,null===h.z&&(h.z=xt(h.x,h.y,r,s,c)),h.prev.next!==h||h.next.prev!==h)return h.prev.next=h,h.next.prev=h,rt(o,r,s,c);h.prevZ=h.prev,h.nextZ=h.next}return o.prevZ.nextZ=null,o.prevZ=null,function J(o){let r,s=1;for(;;){let c,h=o;o=null,r=null;let d=0;for(;h;){d++,c=h;let _=0;for(;_<s&&c;_++)c=c.nextZ;let E=s;for(;_>0||E>0&&c;){let S;0===_?(S=c,c=c.nextZ,E--):0!==E&&c?h.z<=c.z?(S=h,h=h.nextZ,_--):(S=c,c=c.nextZ,E--):(S=h,h=h.nextZ,_--),r?r.nextZ=S:o=S,S.prevZ=r,r=S}h=c}if(r.nextZ=null,s*=2,d<2)return o}}(o)}function A(o,r,s){return(r.y-o.y)*(s.x-r.x)-(r.x-o.x)*(s.y-r.y)}function nt(o,r,s,c){return!!(pt(o,r)&&pt(s,c)||pt(o,c)&&pt(s,r))||A(o,r,s)>0!=A(o,r,c)>0&&A(s,c,o)>0!=A(s,c,r)>0}function ht(o,r,s,c,h,d,_,E){return(h-_)*(r-E)-(o-_)*(d-E)>=0&&(o-_)*(c-E)-(s-_)*(r-E)>=0&&(s-_)*(d-E)-(h-_)*(c-E)>=0}function lt(o,r){return A(o.prev,o,o.next)<0?A(o,r,o.next)>=0&&A(o,o.prev,r)>=0:A(o,r,o.prev)<0||A(o,o.next,r)<0}function xt(o,r,s,c,h){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-s)*h)|o<<8))|o<<4))|o<<2))|o<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-c)*h)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function pt(o,r){return o.x===r.x&&o.y===r.y}function vt(o,r){return o.x-r.x}function _t(o,r,s,c){let h=o;do{const d=h.prev,_=h.next.next;!pt(d,_)&&nt(d,h,h.next,_)&&lt(d,_)&&lt(_,d)&&(r.push(d.index/s+c),r.push(h.index/s+c),r.push(_.index/s+c),T(h),T(h.next),h=o=_),h=h.next}while(h!==o);return h}function V(o,r,s,c,h,d,_){let E=o;do{let S=E.next.next;for(;S!==E.prev;){if(E.index!==S.index&&B(E,S)){let C=Bt(E,S);return E=Z(E,E.next),C=Z(C,C.next),Q(E,r,s,c,h,d,_,0),void Q(C,r,s,c,h,d,_,0)}S=S.next}E=E.next}while(E!==o)}function B(o,r){return o.next.index!==r.index&&o.prev.index!==r.index&&!function at(o,r){let s=o;do{if(s.index!==o.index&&s.next.index!==o.index&&s.index!==r.index&&s.next.index!==r.index&&nt(s,s.next,o,r))return!0;s=s.next}while(s!==o);return!1}(o,r)&&lt(o,r)&&lt(r,o)&&function At(o,r){let s=o,c=!1;const h=(o.x+r.x)/2,d=(o.y+r.y)/2;do{s.y>d!=s.next.y>d&&s.next.y!==s.y&&h<(s.next.x-s.x)*(d-s.y)/(s.next.y-s.y)+s.x&&(c=!c),s=s.next}while(s!==o);return c}(o,r)}function Bt(o,r){const s=yt.create(o.index,o.x,o.y),c=yt.create(r.index,r.x,r.y),h=o.next,d=r.prev;return o.next=r,r.prev=o,s.next=h,h.prev=s,c.next=s,s.prev=c,d.next=c,c.prev=d,c}class yt{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}static create(r,s,c){const h=zt<wt.length?wt[zt++]:new yt;return h.index=r,h.x=s,h.y=c,h.prev=null,h.next=null,h.z=null,h.prevZ=null,h.nextZ=null,h.steiner=!1,h}}const wt=[];let zt=0;for(let o=0;o<8096;o++)wt.push(new yt);const Dt=new Y.bN(0,0,0,1,0),gt=new Y.bN(0,0,0,1,0);function Rt(o,r,s){let c=0;for(let h=1;h<s;h++)c+=(o[2*(r+h)]-o[2*(r+h-1)])*(o[2*(r+h)+1]+o[2*(r+h-1)+1]);return c}function Jt(o,r,s,c,h){let d=0;for(let E=s;E<c;E+=3){const S=2*(o[E]-h),C=2*(o[E+1]-h),I=2*(o[E+2]-h);d+=Math.abs((r[S]-r[I])*(r[C+1]-r[S+1])-(r[S]-r[C])*(r[I+1]-r[S+1]))}return d}function F(o,r){if(null==o)return null;if(!function D(o,r,s){let c=0;for(let h=0;h<o.lengths.length;h++){const d=o.lengths[h];for(let _=0;_<d;_++){const E=o.coords[2*(_+c)],S=o.coords[2*(_+c)+1];if(E<r||E>s||S<r||S>s)return!0}c+=d}return!1}(o,-128,W.i9+128))return o;Dt.setPixelMargin(r),Dt.reset(Y.Vl.Polygon);let s=0;for(let _=0;_<o.lengths.length;_++){const E=o.lengths[_];let S=o.coords[2*(0+s)],C=o.coords[2*(0+s)+1];Dt.moveTo(S,C);for(let I=1;I<E;I++)S=o.coords[2*(I+s)],C=o.coords[2*(I+s)+1],Dt.lineTo(S,C);Dt.close(),s+=E}const c=Dt.result(!1);if(!c)return null;const h=[],d=[];for(const _ of c){let E=0;for(const S of _)d.push(S.x),d.push(S.y),E++;h.push(E)}return new X.Z(h,d)}Dt.setExtent(W.i9),gt.setExtent(W.i9);var st=m(33359),mt=m(73608);let ut=null;function Et(){return ut}function Ut(){return(Ut=(0,x.Z)(function*(){ut=yield Promise.all([m.e(4918),m.e(8592),m.e(5994)]).then(m.bind(m,32825))})).apply(this,arguments)}var Pt=m(5254),Vt=m(95860),N=m(67969);function Ft(o){switch(o){case N.g.BYTE:case N.g.UNSIGNED_BYTE:return 1;case N.g.SHORT:case N.g.UNSIGNED_SHORT:return 2;case N.g.FLOAT:case N.g.INT:case N.g.UNSIGNED_INT:return 4}}class ot{static fromVertexSpec({attributes:r},s){let c,h,d;const _=[];for(const k in r){const et=r[k];!1!==s?.[k]&&("position"===et.pack?c={...et,name:k,offset:0}:"id"===et.pack?h={...et,name:k,offset:4}:"bitset"===k?d={...et,name:k,offset:7}:_.push({...et,name:k}))}const E=function Ct(o){const r=[],s=[],c=[];for(const h of o){const d=Ft(h.type)*h.count;switch(d%2||d%4||4){case 4:r.push(h);continue;case 2:s.push(h);continue;case 1:c.push(h);continue;default:throw new Error("Found unexpected dataType byte count")}}return r.push(...s),r.push(...c),r}(_),S=[];let C=8,I=1;for(const k of E)S.push({...k,offset:C}),C+=Ft(k.type)*k.count,k.packAlternating&&(I=Math.max(k.packAlternating.count,I));const R=Uint32Array.BYTES_PER_ELEMENT,z=C%R;return new ot(c,h,d,S,C+(z?R-z:0),I)}constructor(r,s,c,h,d,_){this.position=r,this.id=s,this.bitset=c,this.standardAttributes=h,this.stride=d,this.packVertexCount=_,h.push(c),this._attributes=[r,s,c,...h]}get attributeLayout(){if(!this._attributeLayout){const r=(0,Vt.ig)(this._attributes),s=this._attributes.map(c=>({name:c.name,count:c.count,offset:c.offset,type:c.type,packPrecisionFactor:c.packPrecisionFactor,normalized:c.normalized??!1}));this._attributeLayout={attributes:s,hash:r,stride:this.stride}}return this._attributeLayout}}var Kt=m(69862);class jt{static fromVertexSpec(r,s){const c=ot.fromVertexSpec(r,s);return new jt(c)}constructor(r){this._spec=r,this._packed=new Uint8Array(this._spec.stride*this._spec.packVertexCount),this._packedU32View=new Uint32Array(this._packed.buffer),this._dataView=new DataView(this._packed.buffer)}get attributeLayout(){return this._spec.attributeLayout}get stride(){return this._spec.stride}writeVertex(r,s,c,h,d,_){for(let E=0;E<this._spec.packVertexCount;E++){const S=E*this._spec.stride;this._packPosition(c,h,S),this._packId(s,S);const C=this._spec.bitset;if(_){if(C.packTessellation){const I=C.packTessellation(_,d);this._pack(I,C,S)}for(const I of this._spec.standardAttributes)if(null!=I.packTessellation){const R=I.packTessellation(_,d);this._pack(R,I,S)}else if(I.packAlternating?.packTessellation){const R=I.packAlternating.packTessellation(_,d);for(let z=0;z<this._spec.packVertexCount;z++)this._pack(R[z],I,z*this._spec.stride)}}}r.vertexWriteRegion(this._packedU32View)}pack(r,s){for(const c of this._spec.standardAttributes)if(c.pack&&"string"!=typeof c.pack){const h=c.pack(r,s);for(let d=0;d<this._spec.packVertexCount;d++)this._pack(h,c,d*this._spec.stride)}else if(c.packAlternating?.pack){const h=c.packAlternating.pack(r,s);for(let d=0;d<this._spec.packVertexCount;d++)this._pack(h[d],c,d*this._spec.stride)}}_packPosition(r,s,c){const{offset:h}=this._spec.position,d=this._spec.position.packPrecisionFactor??1,_=(0,Pt.UJ)(r*d,s*d);this._dataView.setUint32(c+h,_,!0)}_packId(r,s){const c=r*(this._spec.id.packPrecisionFactor??1),h=4278190080&this._dataView.getUint32(s+this._spec.id.offset,!0);this._dataView.setUint32(s+this._spec.id.offset,c|h,!0)}_pack(r,s,c){(0,Kt.G)(this._dataView,r,s,c)}}class qt{constructor(r,s,c,h){this._instanceId=r,this._evaluator=s,this._viewParams=c,this._optionalAttributes=h,this._evaluator.evaluator=d=>this.vertexSpec.createComputedParams(d)}get _vertexPack(){if(!this._cachedVertexPack){const r=jt.fromVertexSpec(this.vertexSpec,this._optionalAttributes);this._evaluator.hasDynamicProperties||r.pack(this._evaluator.evaluatedMeshParams,this._viewParams),this._cachedVertexPack=r}return this._cachedVertexPack}get evaluatedMeshParams(){return this._evaluator.evaluatedMeshParams}get hasEffects(){return!!this.evaluatedMeshParams.effects}get instanceId(){return this._instanceId}get attributeLayout(){return this._vertexPack.attributeLayout}setReferences(r){this._references=r}getBoundsInfo(){return null}getTileInfo(){return this._viewParams.tileInfo}loadDependencies(){var r=this;return(0,x.Z)(function*(){(function Nt(o){if(!o)return!1;for(const r of o)switch(r.effect.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1})(r._evaluator.inputMeshParams.params.effects?.effectInfos)&&(yield function Mt(){return Ut.apply(this,arguments)}())})()}enqueueRequest(r,s,c){this._evaluator.hasDynamicProperties&&this._evaluator.enqueueRequest(r,s,c)}write(r,s,c,h,d){this.ensurePacked(s,c,h);const _=this.evaluatedMeshParams.effects;if(!_||0===_.length)return void this._write(r,c,void 0,d);const E=c.readGeometryForDisplay()?.clone();if(!E)return;const S=st.z.fromOptimizedCIM(E,c.geometryType),C=Et();S.invertY();const R=mt.j.executeEffects(_,S,r.id||"",C);let z;for(;z=R.next();)z.invertY(),this._write(r,c,z,d)}ensurePacked(r,s,c){if(!this._evaluator.hasDynamicProperties)return;const h=this._evaluator.evaluateMeshParams(r,s,c);this._vertexPack.pack(h,this._viewParams)}_writeVertex(r,s,c,h,d){this._vertexPack.writeVertex(r,s,c,h,this.evaluatedMeshParams,d)}}const se=(0,y.Z)("featurelayer-fast-triangulation-enabled");class ie extends qt{loadDependencies(){var r=()=>super.loadDependencies,s=this;return(0,x.Z)(function*(){yield Promise.all([r().call(s),(0,f.j)()])})()}_write(r,s,c){const h=c?.asOptimized()??s.readGeometryForDisplay(),d=this._clip(h);d&&(r.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(r,s,d),r.recordEnd())}_clip(r){return r?F(r,this.hasEffects?256:8):null}_writeGeometry(r,s,c){const h=c.maxLength>100,d=[],_=this.createTesselationParams(s);if(!h&&se&&function it(o,r){const{coords:s,lengths:c,hasIndeterminateRingOrder:h}=r,_=o;if(h)return!1;let E=0;for(let S=0;S<c.length;){let C=S,I=c[S],R=Rt(s,E,I);const z=[];for(;++C<c.length;){const ft=c[C],St=Rt(s,E+I,ft);if(!(St>0))break;R+=St,z.push(E+I),I+=ft}const k=_.length;tt(_,s,E,E+I,z,2,0);const et=Jt(_,s,k,_.length,0),dt=Math.abs(R);if(Math.abs((et-dt)/Math.max(1e-7,dt))>1e-5)return _.length=0,!1;S=C,E+=I}return!0}(d,c))return void(d.length&&this._writeVertices(r,s,c.coords,_,d));const E=function g(o){const{coords:r,lengths:s}=o,{buffer:c}=(0,f.b)(r,s);return c}(c);this._writeVertices(r,s,E,_)}_writeVertices(r,s,c,h,d){const _=s.getDisplayId(),E=r.vertexCount(),S=this.hasEffects;let C=0;if(d)for(const I of d){const R=c[2*I],z=c[2*I+1];S&&r.recordBounds(R,z,0,0),this._writeVertex(r,_,R,z,h),C++}else for(let I=0;I<c.length;I+=2){const R=Math.round(c[I]),z=Math.round(c[I+1]);S&&r.recordBounds(R,z,0,0),this._writeVertex(r,_,R,z,h),C++}r.indexEnsureSize(C);for(let I=0;I<C;I++)r.indexWrite(I+E)}}const de={createComputedParams:o=>o,attributes:{id:{type:N.g.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:N.g.UNSIGNED_BYTE,count:1},pos:{type:N.g.SHORT,count:2,pack:"position",packPrecisionFactor:10},inverseArea:{type:N.g.FLOAT,count:1,packTessellation:({inverseArea:o})=>o}}};var bt=m(23841),te=m(86575),pe=m(91558),oe=m(26584),ae=m(63290),Gt=m(7547);const ye=()=>ae.Z.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.meshWriterUtils"),Xt=0,Dr=100;function ge(o,r){return[!!o?.minScale&&r.scaleToZoom(o.minScale)||Xt,!!o?.maxScale&&r.scaleToZoom(o.maxScale)||Dr]}function ve(o){return 1<<o}function we(o){let r=0;for(const[s,c]of o)c&&(r|=1<<s);return r}function Zt(o){let r;if(!o)return[0,0,0,0];if("string"==typeof o){const _=pe.Z.fromString(o);if(!_)return ye().errorOnce(new oe.Z("mapview:mesh-processing","Unable to parse string into color",{color:o})),[0,0,0,0];r=_.toArray()}else r=o;const[s,c,h,d]=r;return[s*(d/255),c*(d/255),h*(d/255),d]}function Ue(o,r){return Math.round(Math.min(Math.sqrt(o*r),255))}function Ee(o,r){return Math.round(o*r)/r}function je(o,r){return Math.ceil(o*r)/r}const Ce={createComputedParams:o=>o,attributes:{id:{type:N.g.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:N.g.UNSIGNED_BYTE,count:1},pos:{type:N.g.SHORT,count:2,pack:"position",packPrecisionFactor:10},zoomRange:{type:N.g.SHORT,count:2,packPrecisionFactor:W.JS,pack:({scaleInfo:o},{tileInfo:r})=>ge(o,r)},color:{type:N.g.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:o})=>Zt(o)}}};class We extends ie{constructor(){super(...arguments),this.vertexSpec=Ce}createTesselationParams(r){return null}}const Se={createComputedParams:o=>o,attributes:{...Ce.attributes,tlbr:{count:4,type:N.g.UNSIGNED_SHORT,pack:({sprite:o})=>{const{rect:r,width:s,height:c}=o,h=r.x+W.s4,d=r.y+W.s4;return[h,d,h+s,d+c]}},inverseRasterizationScale:{count:1,type:N.g.BYTE,packPrecisionFactor:16,pack:({sprite:o})=>1/o.rasterizationScale}}};class tr extends We{constructor(){super(...arguments),this.vertexSpec=Se}_write(r,s,c){const h=c?.asOptimized()??s.readGeometryForDisplay(),d=this._clip(h);if(!d)return;const _=this.evaluatedMeshParams.sprite?.textureBinding;r.recordStart(this.instanceId,this.attributeLayout,_),this._writeGeometry(r,s,d),r.recordEnd()}}var ce=m(36519);function Me(o){const{sprite:r,aspectRatio:s,scaleProportionally:c}=o,h=(0,bt.F2)(o.height);let _=h*s;return _<=0?_=r.width:c&&(_*=r.width/r.height),{width:_,height:h>0?h:r.height}}function De(o){const{applyRandomOffset:r,sampleAlphaOnly:s}=o,{width:c,height:h}=Me(o);return we([[ce.Ux,r],[ce.GS,s],[ce.i6,c<W.oh],[ce.oy,h<W.oh]])}function er(o){const{width:r}=Me(o);return Math.round(r<W.oh?r*W.Kg:r)}function rr(o){const{height:r}=Me(o);return Math.round(r<W.oh?r*W.Kg:r)}const nr={createComputedParams:o=>o,attributes:{...Se.attributes,bitset:{count:1,type:N.g.UNSIGNED_BYTE,pack:De},width:{count:1,type:N.g.UNSIGNED_SHORT,pack:er},height:{count:1,type:N.g.UNSIGNED_SHORT,pack:rr},offset:{count:2,type:N.g.SHORT,pack:({offsetX:o,offsetY:r})=>[(0,bt.F2)(o),-(0,bt.F2)(r)]},scale:{count:2,type:N.g.UNSIGNED_BYTE,packPrecisionFactor:16,pack:({scaleX:o,scaleY:r})=>[o,r]},angle:{count:1,type:N.g.UNSIGNED_BYTE,pack:({angle:o})=>(0,te.s5)(o)}}};var sr=m(46519);class ir{constructor(){this.extrusionOffsetX=0,this.extrusionOffsetY=0,this.normalX=0,this.normalY=0,this.directionX=0,this.directionY=0,this.distance=0}}const be={createComputedParams:o=>o,attributes:{id:{type:N.g.UNSIGNED_BYTE,count:3,pack:"id"},pos:{type:N.g.SHORT,count:2,pack:"position",packPrecisionFactor:10},bitset:{type:N.g.UNSIGNED_BYTE,count:1},zoomRange:{type:N.g.SHORT,count:2,packPrecisionFactor:W.JS,pack:({scaleInfo:o},{tileInfo:r})=>ge(o,r)},color:{type:N.g.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:o})=>Zt(o)},offset:{type:N.g.BYTE,count:2,packPrecisionFactor:16,packTessellation:({extrusionOffsetX:o,extrusionOffsetY:r})=>[Ee(o,16),Ee(r,16)]},normal:{type:N.g.BYTE,count:2,packPrecisionFactor:16,packTessellation:({normalX:o,normalY:r})=>[Ee(o,16),Ee(r,16)]},halfWidth:{type:N.g.UNSIGNED_SHORT,count:1,packPrecisionFactor:16,pack:({width:o})=>je((0,bt.F2)(.5*o),16)},referenceHalfWidth:{type:N.g.UNSIGNED_SHORT,count:1,packPrecisionFactor:16,pack:({referenceWidth:o})=>je((0,bt.F2)(.5*o),16)}}};class Ir{constructor(){this.id=0,this.bitset=0,this.indexCount=0,this.vertexCount=0,this.vertexFrom=0,this.vertexBounds=0}}class Ge extends qt{constructor(r,s,c,h){super(r,s,c,h),this.vertexSpec=be,this._currentWrite=new Ir,this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0,wrapDistance:65535,textured:!1},this._tessParams=new ir,this._initializeTessellator()}writeLineVertices(r,s,c){const h=this._getLines(s);null!=h&&this._writeVertices(r,c,h)}_initializeTessellator(){this._lineTessellator=new sr.z(this._writeTesselatedVertex.bind(this),this._writeTriangle.bind(this),!0)}_write(r,s,c){const h=c??st.z.fromFeatureSetReaderCIM(s);h&&this._writeGeometry(r,s,h)}_writeGeometry(r,s,c,h){r.recordStart(this.instanceId,this.attributeLayout,h),this.writeLineVertices(r,c,s),r.recordEnd()}_getLines(r){return function K(o,r){gt.setPixelMargin(r);const s=gt,c=-r,h=W.i9+r;let d=[],_=!1;if(!o.nextPath())return null;let E=!0;for(;E;){o.seekPathStart();const S=[];if(!o.pathSize)return null;s.reset(Y.Vl.LineString),o.nextPoint();let C=o.x,I=o.y;if(_)s.moveTo(C,I);else{if(C<c||C>h||I<c||I>h){_=!0;continue}S.push({x:C,y:I})}let R=!1;for(;o.nextPoint();)if(C=o.x,I=o.y,_)s.lineTo(C,I);else{if(C<c||C>h||I<c||I>h){R=!0;break}S.push({x:C,y:I})}if(R)_=!0;else{if(_){const z=s.resultWithStarts();if(z)for(const k of z)d.push(k)}else d.push({line:S,start:0});E=o.nextPath(),_=!1}}return d=d.filter(S=>S.line.length>1),0===d.length?null:d}(r,(0,Vt.b8)(this.evaluatedMeshParams))}_writeVertices(r,s,c){const{_currentWrite:h,_tessellationOptions:d,evaluatedMeshParams:_}=this,{width:E,capType:S,joinType:C,miterLimit:I,hasSizeVV:R}=_,z=(0,bt.F2)(.5*E);d.halfWidth=z,d.capType=function Je(o){switch(o){case"butt":case Gt.kP.Butt:return Gt.RL.BUTT;case"round":case Gt.kP.Round:return Gt.RL.ROUND;case"square":case Gt.kP.Square:return Gt.RL.SQUARE}}(S),d.joinType=function qe(o){switch(o){case"bevel":case Gt.r4.Bevel:return Gt.AH.BEVEL;case"miter":case Gt.r4.Miter:return Gt.AH.MITER;case"round":case Gt.r4.Round:return Gt.AH.ROUND}}(C),d.miterLimit=I;const k=!R;h.out=r,h.id=s.getDisplayId(),h.vertexCount=0,h.indexCount=0,h.vertexFrom=r.vertexCount(),h.vertexBounds=k&&z<W.do?0:1;for(const{line:et,start:dt}of c)d.initialDistance=dt%65535,this._lineTessellator.tessellate(et,d,k)}_writeTesselatedVertex(r,s,c,h,d,_,E,S,C,I,R){const{out:z,id:k,vertexBounds:et}=this._currentWrite;return this.hasEffects&&z.recordBounds(r,s,et,et),this._tessParams.extrusionOffsetX=E,this._tessParams.extrusionOffsetY=S,this._tessParams.normalX=C,this._tessParams.normalY=I,this._tessParams.directionX=d,this._tessParams.directionY=_,this._tessParams.distance=R,this._writeVertex(z,k,r,s,this._tessParams),this._currentWrite.vertexFrom+this._currentWrite.vertexCount++}_writeTriangle(r,s,c){const{out:h}=this._currentWrite;h.indexEnsureSize(3),h.indexWrite(r),h.indexWrite(s),h.indexWrite(c),this._currentWrite.indexCount+=3}}const ar={createComputedParams:o=>o,attributes:{...be.attributes,bitset:{type:N.g.UNSIGNED_BYTE,count:1,pack:o=>0},color:{type:N.g.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:o})=>Zt(o)}}},$e={createComputedParams:o=>o,attributes:{...be.attributes,bitset:{type:N.g.UNSIGNED_BYTE,count:1,pack:o=>we([[ce.WD,!0]])},color:{type:N.g.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:o})=>Zt(o)}}};class He extends Ge{constructor(){super(...arguments),this.vertexSpec=$e}}class Re extends We{constructor(r,s,c,h){super(r,s,c,h),this.vertexSpec=ar,this._lineMeshWriter=this._createOutlineWriter(r,s,c,h)}_createOutlineWriter(r,s,c,h){return new He(r,s,c,h)}_write(r,s,c){const h=c?.asOptimized()??s.readGeometryForDisplay(),d=this._clip(h);d&&(r.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(r,s,d),this._lineMeshWriter.writeLineVertices(r,st.z.fromOptimizedCIM(d,"esriGeometryPolyline"),s),r.recordEnd())}_clip(r){return r?F(r,(0,Vt.b8)(this.evaluatedMeshParams)):null}ensurePacked(r,s,c){super.ensurePacked(r,s,c),this._lineMeshWriter.ensurePacked(r,s,c)}enqueueRequest(r,s,c){super.enqueueRequest(r,s,c),this._lineMeshWriter.enqueueRequest(r,s,c)}loadDependencies(){var r=()=>super.loadDependencies,s=this;return(0,x.Z)(function*(){yield Promise.all([r().call(s),s._lineMeshWriter.loadDependencies()])})()}}var le=m(38420);const ue=nr.attributes,Cr={createComputedParams:o=>o,attributes:{id:ue.id,pos:ue.pos,zoomRange:ue.zoomRange,tlbr:ue.tlbr,angle:ue.angle,color:ue.color,bitset:{type:N.g.UNSIGNED_BYTE,count:1,pack:o=>De(o)},aux1:{count:1,type:N.g.UNSIGNED_SHORT,pack:o=>er(o)},aux2:{count:1,type:N.g.UNSIGNED_SHORT,pack:o=>rr(o)},aux3:{count:2,type:N.g.SHORT,pack:({offsetX:o,offsetY:r})=>[(0,bt.F2)(o),(0,bt.F2)(r)]},aux4:{count:2,type:N.g.UNSIGNED_BYTE,pack:({scaleX:o,scaleY:r})=>[o*le.$1,r*le.$1]}}},Wr={createComputedParams:o=>o,attributes:{id:ue.id,pos:ue.pos,zoomRange:ue.zoomRange,tlbr:ue.tlbr,angle:ue.angle,color:$e.attributes.color,bitset:{type:N.g.UNSIGNED_BYTE,count:1,pack:o=>we([[ce.WD,!0]])},aux1:{count:1,type:N.g.UNSIGNED_SHORT,pack:o=>(0,bt.F2)(.5*o.width)*le.$1},aux2:{count:1,type:N.g.UNSIGNED_SHORT,pack:o=>(0,bt.F2)(.5*o.referenceWidth)*le.$1},aux3:{count:2,type:N.g.SHORT,packTessellation:({extrusionOffsetX:o,extrusionOffsetY:r})=>[o*le.$1,r*le.$1]},aux4:{count:2,type:N.g.UNSIGNED_BYTE,packTessellation:({normalX:o,normalY:r})=>[o*le.$1+le.NS,r*le.$1+le.NS]}}};class Rr extends He{constructor(){super(...arguments),this.vertexSpec=Wr}}const Br={createComputedParams:o=>o,attributes:{...Se.attributes,...ar.attributes}},Ar={createComputedParams:o=>o,attributes:{...Se.attributes,...$e.attributes}};class cr extends He{constructor(){super(...arguments),this.vertexSpec=Ar}}const Vr={createComputedParams:o=>o,attributes:{pos:{type:N.g.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:N.g.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:N.g.UNSIGNED_BYTE,count:1},offset:{type:N.g.BYTE,count:2,packAlternating:{count:4,pack:()=>[[-1,-1],[1,-1],[-1,1],[1,1]]}}}};var Nr=m(88159),Oe=m(50047),ur=m(3348),Le=m(40028),Be=m(99666),hr=m(6239),Ae=m(83499),me=m(92087);function dr(o,r,s){return o[0]=r[0]-s[0],o[1]=r[1]-s[1],o}function pr(o,r){return Math.sqrt(o*o+r*r)}function _r(o){const r=pr(o[0],o[1]);o[0]/=r,o[1]/=r}function fr(o,r){return pr(o[0]-r[0],o[1]-r[1])}function Ye(o){return o.length-1}function zr(o,r,s=1){let[c,h]=function yr(o,r){return o[r+1]}(o,r);return[c,h]=[Math.round(c),Math.round(h)],Math.sqrt(c*c+h*h)*s}class Pe{constructor(r,s,c,h,d){this._segments=r,this._index=s,this._distance=c,this._xStart=h,this._yStart=d,this._done=!1}static create(r){return new Pe(r,0,0,r[0][0],r[0][1])}clone(){return new Pe(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(r){return this._index===r._index||r._index===this._index-1&&(0===this._distance||1===r._distance)||r._index===this._index+1&&(1===this._distance||0===r._distance)}leq(r){return this._index<r._index||this._index===r._index&&this._distance<=r._distance}geq(r){return this._index>r._index||this._index===r._index&&this._distance>=r._distance}get _segment(){return this._segments[this._index+1]}get angle(){const r=this.dy;let c=Math.acos((0*r+-1*-this.dx)/(1*this.length));return r>0&&(c=2*Math.PI-c),c}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const{dx:r,dy:s}=this;return Math.sqrt(r*r+s*s)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return this._index-1>=0}hasNext(){return this._index+1<Ye(this._segments)}next(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}prev(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}_seekBackwards(r,s){const c=this.backwardLength;if(r<=c)return this._distance=(c-r)/this.length,this;let h=this.backwardLength;for(;this.prev();){if(h+this.length>r)return this._seekBackwards(r-h);h+=this.length}return this._distance=0,s?this:null}seek(r,s=!1){if(r<0)return this._seekBackwards(Math.abs(r),s);if(r<=this.remainingLength)return this._distance=(this.backwardLength+r)/this.length,this;let c=this.remainingLength;for(;this.next();){if(c+this.length>r)return this.seek(r-c,s);c+=this.length}return this._distance=1,s?this:null}}function mr(o,r,s,c=!0){const h=function Ze(o){let r=0;for(let s=0;s<Ye(o);s++)r+=zr(o,s);return r}(o),d=Pe.create(o),_=h/2;if(!c)return d.seek(_),void(Math.abs(d.x)<me.L&&Math.abs(d.y)<me.L&&s(d.clone(),0,_+0*r,h));const E=Math.max((h-r)/2,0),S=Math.floor(E/r);d.seek(_-S*r);for(let I=-S;I<=S;I++)Math.abs(d.x)<me.L&&Math.abs(d.y)<me.L&&s(d.clone(),I,_+I*r,h),d.seek(r)}function kr(o,r){if(r<=0)return;const c=o.length;if(c<3)return;const h=[];let d=0;h.push(0);for(let R=1;R<c;R++)d+=fr(o[R],o[R-1]),h.push(d);r=Math.min(r,.2*d);const _=[];_.push(o[0][0]),_.push(o[0][1]);const E=o[c-1][0],S=o[c-1][1],C=dr([0,0],o[0],o[1]);_r(C),o[0][0]+=r*C[0],o[0][1]+=r*C[1],dr(C,o[c-1],o[c-2]),_r(C),o[c-1][0]+=r*C[0],o[c-1][1]+=r*C[1];for(let R=1;R<c;R++)h[R]+=r;h[c-1]+=r;const I=.5*r;for(let R=1;R<c-1;R++){let z=0,k=0,et=0;for(let dt=R-1;dt>=0&&!(h[dt+1]<h[R]-I);dt--){const ft=I+h[dt+1]-h[R],St=h[dt+1]-h[dt],It=h[R]-h[dt]<I?1:ft/St;if(Math.abs(It)<1e-6)break;const $t=It*It,Ht=It*ft-.5*$t*St,kt=It*St/r,Yt=o[dt+1],he=o[dt][0]-Yt[0],xe=o[dt][1]-Yt[1];z+=kt/Ht*(Yt[0]*It*ft+.5*$t*(ft*he-St*Yt[0])-$t*It*St*he/3),k+=kt/Ht*(Yt[1]*It*ft+.5*$t*(ft*xe-St*Yt[1])-$t*It*St*xe/3),et+=kt}for(let dt=R+1;dt<c&&!(h[dt-1]>h[R]+I);dt++){const ft=I-h[dt-1]+h[R],St=h[dt]-h[dt-1],It=h[dt]-h[R]<I?1:ft/St;if(Math.abs(It)<1e-6)break;const $t=It*It,Ht=It*ft-.5*$t*St,kt=It*St/r,Yt=o[dt-1],he=o[dt][0]-Yt[0],xe=o[dt][1]-Yt[1];z+=kt/Ht*(Yt[0]*It*ft+.5*$t*(ft*he-St*Yt[0])-$t*It*St*he/3),k+=kt/Ht*(Yt[1]*It*ft+.5*$t*(ft*xe-St*Yt[1])-$t*It*St*xe/3),et+=kt}_.push(z/et),_.push(k/et)}_.push(E),_.push(S);for(let R=0,z=0;R<c;R++)o[R][0]=_[z++],o[R][1]=_[z++]}var xr=m(21286),jr=m(73282);class gr{static getPlacement(r,s,c,h,d,_){const E=(0,jr.W)(c);return E?(-1===s&&r.invertY(),E.execute(r,c,h,d,_)):null}}var Gr=m(58626),vr=m(80991);class $r{constructor(r){const{offsetX:s,offsetY:c,postAngle:h,fontSize:d,scaleFactor:_,transforms:E}=r;if(this.offsetX=s,this.offsetY=c,this.postAngle=h,this.fontSize=Math.min(d,96),this.transforms=E,E&&E.infos.length>1){const S=(0,vr.yl)(d,h,!1,s,c,E);this.fontSize=Math.min(S.size,96),this.postAngle=S.rotation,this.offsetX=S.offsetX,this.offsetY=S.offsetY}_&&(this.fontSize*=_,this.offsetX*=_,this.offsetY*=_)}}const _e=[4,4],Fe=[16,4],Mr={topLeft:Fe,topRight:Fe,bottomLeft:Fe,bottomRight:Fe},Ne=[4,2],ee=[4,6],br={topLeft:Ne,topRight:Ne,bottomLeft:ee,bottomRight:ee},Pr={topLeft:Ne,topRight:ee,bottomLeft:Ne,bottomRight:ee},Hr={topLeft:ee,topRight:ee,bottomLeft:_e,bottomRight:_e},Yr={topLeft:_e,topRight:_e,bottomLeft:ee,bottomRight:ee},Zr={topLeft:ee,topRight:_e,bottomLeft:ee,bottomRight:_e},Tr={topLeft:_e,topRight:ee,bottomLeft:_e,bottomRight:ee},Xr={createComputedParams:o=>o,attributes:{pos:{type:N.g.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:N.g.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:N.g.UNSIGNED_BYTE,count:1,packTessellation:({isBackground:o,mapAligned:r})=>we([[ce.mL,o],[ce.$r,!!r]])},zoomRange:{type:N.g.UNSIGNED_SHORT,count:2,packPrecisionFactor:W.JS,packTessellation:({minZoom:o,maxZoom:r})=>[o||0,r||28]},offset:{type:N.g.SHORT,count:2,packPrecisionFactor:8,packAlternating:{count:4,packTessellation:({offsets:o})=>{const{bottomLeft:r,bottomRight:s,topLeft:c,topRight:h}=o;return[c,h,r,s]}}},textureUV:{type:N.g.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,packTessellation:({texcoords:o})=>{const{bottomLeft:r,bottomRight:s,topLeft:c,topRight:h}=o;return[c,h,r,s]}}},color:{type:N.g.UNSIGNED_BYTE,count:4,normalized:!0,packTessellation:({color:o})=>o},fontSize:{type:N.g.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,packTessellation:({fontSize:o})=>(0,bt.F2)(o)},referenceSize:{type:N.g.UNSIGNED_BYTE,count:1,packPrecisionFactor:4,packTessellation:({fontSize:o},{referenceSize:r})=>(0,bt.F2)(r??o)},haloColor:{type:N.g.UNSIGNED_BYTE,count:4,normalized:!0,pack:({haloColor:o})=>Zt(o)},haloFontSize:{type:N.g.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,pack:({haloFontSize:o})=>(0,bt.F2)(o)},clipAngle:{type:N.g.UNSIGNED_BYTE,count:1,packTessellation:({clipAngle:o})=>Qr(o||0)},referenceSymbol:{type:N.g.BYTE,count:4,packPrecisionFactor:1,packTessellation:(o,r)=>{if(!o.referenceBounds)return[0,0,0,0];const s=(0,Le.g)(r.horizontalAlignment),c=(0,Le.tf)(r.verticalAlignment),{offsetX:h,offsetY:d,size:_}=o.referenceBounds;return[(0,bt.F2)(h),-(0,bt.F2)(d),(0,bt.F2)(_),s+1<<2|c+1]}}}};class wr extends qt{constructor(){super(...arguments),this.vertexSpec=Xr,this._textMeshParamsPropsInitialized=!1}ensurePacked(r,s,c){super.ensurePacked(r,s,c),this._textMeshParamsPropsInitialized&&!this._evaluator.hasDynamicProperties||(this._textMeshTransformProps=new $r(this.evaluatedMeshParams),this._textMeshParamsPropsInitialized=!0)}_write(r,s,c){const h=this._getShaping();if(!h)return;const d=s.getDisplayId();if(null!=this.evaluatedMeshParams.placement)return this._writePlacedTextMarkers(r,s,h,c);if(c&&c.nextPath())return c.nextPoint(),this._writeGlyphs(r,d,c.x,c.y,h,0);if("esriGeometryPolygon"===s.geometryType){const S=s.readCentroidForDisplay();if(!S)return;const[C,I]=S.coords;return this._writeGlyphs(r,d,C,I,h,0)}if("esriGeometryMultipoint"===s.geometryType)return void s.readGeometryForDisplay()?.forEachVertex((C,I)=>this._writeGlyphs(r,d,C,I,h,0));const _=s.readXForDisplay(),E=s.readYForDisplay();return this._writeGlyphs(r,d,_,E,h,0)}_writePlacedTextMarkers(r,s,c,h){const d=h??st.z.fromFeatureSetReaderCIM(s);if(!d)return;const E=gr.getPlacement(d,-1,this.evaluatedMeshParams.placement,(0,bt.F2)(1),r.id,Et());if(!E)return;const S=s.getDisplayId();let C=E.next();for(;null!=C;){const I=C.tx,R=-C.ty,z=-C.getAngle();this._writeGlyphs(r,S,I,R,c,z),C=E.next()}}_getShaping(){const r=this._textMeshTransformProps,s=this.evaluatedMeshParams;if(!s.glyphs?.glyphs.length)return null;const c=Math.round((0,bt.F2)(r.fontSize)),h=(0,bt.F2)(r.offsetX),d=(0,bt.F2)(r.offsetY),_=(0,xr.uZ)((0,bt.F2)(s.lineWidth),32,512),E=W.uk*(0,xr.uZ)(s.lineHeightRatio,.25,4);return(0,Gr.Nr)(s.glyphs,{scale:c/W.iD,angle:r.postAngle,xOffset:h,yOffset:d,horizontalAlignment:s.horizontalAlignment,verticalAlignment:s.verticalAlignment,maxLineWidth:_,lineHeight:E,decoration:s.decoration,borderLineSizePx:(0,bt.F2)(s.boxBorderLineSize),hasBackground:!!s.boxBackgroundColor,useCIMAngleBehavior:s.useCIMAngleBehavior})}_writeGlyphs(r,s,c,h,d,_,E,S){const C=this.evaluatedMeshParams,I=this._textMeshTransformProps,R=I.fontSize,z=(0,bt.F2)(I.offsetX),k=(0,bt.F2)(I.offsetY),[et,dt]=ge(C.scaleInfo,this.getTileInfo());0!==_&&d.setRotation(_);const ft=d.bounds,St=c+ft.x+z,It=h+ft.y-k,$t=2*(C.minPixelBuffer?C.minPixelBuffer/R:1),Ht=Math.max(ft.width,ft.height)*$t;d.textBox&&(r.recordStart(this.instanceId,this.attributeLayout,d.glyphs[0].textureBinding),r.recordBounds(St,It,Ht,Ht),this._writeTextBox(r,s,c,h,d.textBox,E,S),r.recordEnd());for(const kt of d.glyphs){r.recordStart(this.instanceId,this.attributeLayout,kt.textureBinding),r.recordBounds(St,It,Ht,Ht);const{texcoords:Yt,offsets:he}=kt;this._writeQuad(r,s,c,h,{texcoords:Yt,offsets:he,fontSize:R,color:Zt(C.color),isBackground:!1,referenceBounds:E,minZoom:et,maxZoom:dt,...S}),r.recordEnd()}0!==_&&d.setRotation(-_)}_writeTextBox(r,s,c,h,d,_,E){const S=this.evaluatedMeshParams,{fontSize:C}=this._textMeshTransformProps,{boxBackgroundColor:I,boxBorderLineColor:R}=S,z={isBackground:!0,fontSize:C,referenceBounds:_,...E};I&&(this._writeQuad(r,s,c,h,{texcoords:Mr,offsets:d.main,color:Zt(I),...z}),R||(this._writeQuad(r,s,c,h,{texcoords:Hr,offsets:d.top,color:Zt(I),...z}),this._writeQuad(r,s,c,h,{texcoords:Yr,offsets:d.bot,color:Zt(I),...z}),this._writeQuad(r,s,c,h,{texcoords:Zr,offsets:d.left,color:Zt(I),...z}),this._writeQuad(r,s,c,h,{texcoords:Tr,offsets:d.right,color:Zt(I),...z}))),R&&(this._writeQuad(r,s,c,h,{texcoords:br,offsets:d.top,color:Zt(R),...z}),this._writeQuad(r,s,c,h,{texcoords:br,offsets:d.bot,color:Zt(R),...z}),this._writeQuad(r,s,c,h,{texcoords:Pr,offsets:d.left,color:Zt(R),...z}),this._writeQuad(r,s,c,h,{texcoords:Pr,offsets:d.right,color:Zt(R),...z}))}_writeQuad(r,s,c,h,d){const _=r.vertexCount();this._writeVertex(r,s,c,h,d),r.indexWrite(_+0),r.indexWrite(_+1),r.indexWrite(_+2),r.indexWrite(_+1),r.indexWrite(_+3),r.indexWrite(_+2)}}const Qr=o=>Math.round(o*(254/360)),qr=(0,Nr.HP)(o=>{let r=0;if(0===o)return 1/0;for(;!(o%2);)r++,o/=2;return r}),en={createComputedParams:o=>o,attributes:{...be.attributes,bitset:{type:N.g.UNSIGNED_BYTE,count:1,pack:({shouldSampleAlphaOnly:o,shouldScaleDash:r,isSDF:s})=>we([[ce.GS,o],[ce.Wq,r],[ce.B7,s]])},tlbr:{type:N.g.UNSIGNED_SHORT,count:4,pack:({sprite:o})=>{const{rect:r,width:s,height:c}=o,h=r.x+W.s4,d=r.y+W.s4;return[h,d,h+s,d+c]}},accumulatedDistance:{type:N.g.UNSIGNED_SHORT,count:1,packTessellation:({distance:o})=>o},segmentDirection:{type:N.g.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:o,directionY:r})=>[o,r]}}};var Ke=m(95470);class ke{static from(r){return"width"in r?this.fromSimpleMeshParams(r):this.fromComplexMeshParams(r)}static fromSimpleMeshParams(r){const s=new ke(r.sprite,r.color,r.outlineColor,r.minPixelBuffer,r.placement,r.scaleInfo,r.effects),{type:c,width:h,height:d,angle:_,alignment:E,outlineSize:S,referenceSize:C,sprite:I,overrideOutlineColor:R}=r;return s.rawWidth=(0,bt.F2)(h),s.rawHeight=(0,bt.F2)(d),s.angle=_,s.alignment=E,s.outlineSize=(0,bt.F2)(S),s.referenceSize=(0,bt.F2)(C),s.overrideOutlineColor=R,s.offsetX=(0,bt.F2)(r.offsetX),s.offsetY=(0,bt.F2)(r.offsetY),"simple"!==c||I.sdf||(s.rawWidth=I.width,s.rawHeight=I.height),s.sizeRatio=I.sdf?2:1,s._computeSize(r,!1),s}static fromComplexMeshParams(r){const s=new ke(r.sprite,r.color,r.outlineColor,r.minPixelBuffer,r.placement,r.scaleInfo,r.effects);let{alignment:c,transforms:h,size:d,scaleX:_,anchorX:E,anchorY:S,angle:C,colorLocked:I,frameHeight:R,widthRatio:z,offsetX:k,offsetY:et,outlineSize:dt,referenceSize:ft,scaleFactor:St,sizeRatio:It,isAbsoluteAnchorPoint:$t,rotateClockwise:Ht,scaleSymbolsProportionally:kt,sprite:Yt}=r;if(h&&h.infos.length>0){const Qe=(0,vr.yl)(d,C,Ht,k,et,h);d=Qe.size,C=Qe.rotation,k=Qe.offsetX,et=Qe.offsetY,Ht=!1}St&&(d*=St,k*=St,et*=St);const he=_*(Yt.width/Yt.height);s.alignment=c,s.rawHeight=(0,bt.F2)(d),s.rawWidth=s.rawHeight*he,s.referenceSize=(0,bt.F2)(ft),s.sizeRatio=It,s.angle=C,s.rotateClockwise=Ht,s.anchorX=E,s.anchorY=S,s.offsetX=(0,bt.F2)(k),s.offsetY=(0,bt.F2)(et),$t&&d&&(s.anchorX=Yt.sdf?E/(d*z):E/(d*he),s.anchorY=S/d);const xe=kt&&R?d/R:1;return s.outlineSize=0===dt||isNaN(dt)?0:(0,bt.F2)(dt)*xe,s.scaleSymbolsProportionally=kt,s.colorLocked=I,s._computeSize(r,!0),s}constructor(r,s,c,h,d,_,E){this.sprite=r,this.color=s,this.outlineColor=c,this.minPixelBuffer=h,this.placement=d,this.scaleInfo=_,this.effects=E,this.rawWidth=0,this.rawHeight=0,this.angle=0,this.outlineSize=0,this.referenceSize=0,this.sizeRatio=1,this.alignment=Gt.v2.SCREEN,this.scaleSymbolsProportionally=!1,this.overrideOutlineColor=!1,this.colorLocked=!1,this.anchorX=0,this.anchorY=0,this.computedWidth=0,this.computedHeight=0,this.texXmin=0,this.texYmin=0,this.texXmax=0,this.texYmax=0,this.offsetX=0,this.offsetY=0,this.rotateClockwise=!0}get boundsInfo(){return{size:Math.max(this.computedHeight,this.computedWidth),offsetX:this.offsetX,offsetY:this.offsetY}}_computeSize(r,s){const{sprite:c,hasSizeVV:h}=r,d=!!c.sdf,{rawWidth:_,rawHeight:E,sizeRatio:S,outlineSize:C}=this,I=_*S,R=E*S;if(d&&!h){const Ht=E,kt=C+2;this.computedWidth=Math.min((s&&_>E?I:_)+kt,I),this.computedHeight=Math.min(Ht+kt,R)}else this.computedWidth=I,this.computedHeight=R;const z=d?W.qu/Math.max(I,R):1,k=.5*(I-this.computedWidth)*z,et=.5*(R-this.computedHeight)*z,dt=c.rect.x+W.s4+k,ft=c.rect.y+W.s4+et,St=dt+c.width-2*k,It=ft+c.height-2*et;this.texXmin=Math.floor(dt),this.texYmin=Math.floor(ft),this.texXmax=Math.ceil(St),this.texYmax=Math.ceil(It),this.computedWidth*=(this.texXmax-this.texXmin)/(St-dt),this.computedHeight*=(this.texYmax-this.texYmin)/(It-ft),this.anchorX*=I/this.computedWidth,this.anchorY*=R/this.computedHeight}}var Ie=m(50305);const Sr=3.14159265359/180,nn=128/Math.PI;const M={createComputedParams:o=>ke.from(o),attributes:{pos:{type:N.g.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:N.g.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:N.g.UNSIGNED_BYTE,count:1,pack:({sprite:o,alignment:r,scaleSymbolsProportionally:s,overrideOutlineColor:c,colorLocked:h})=>{let d=0;return o.sdf&&(d|=ve(Ie.m.bitset.isSDF)),r===Gt.v2.MAP&&(d|=ve(Ie.m.bitset.isMapAligned)),s&&(d|=ve(Ie.m.bitset.scaleSymbolsProportionally)),c&&(d|=ve(Ie.m.bitset.overrideOutlineColor)),h&&(d|=ve(Ie.m.bitset.colorLocked)),d}},zoomRange:{type:N.g.SHORT,count:2,packPrecisionFactor:W.JS,pack:({scaleInfo:o},{tileInfo:r})=>ge(o,r)},offset:{type:N.g.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({angle:o,computedWidth:r,computedHeight:s,anchorX:c,anchorY:h,offsetX:d,offsetY:_,rotateClockwise:E})=>{const S=function a(o,r,s,c,h=!1){const d=(0,ur.Ue)(),_=h?1:-1;return o?(0,Oe.Us)(d,_*Sr*o):(0,Oe.yR)(d),(r||s)&&(0,Oe.Iu)(d,d,[r,-s]),c&&(0,Oe.U1)(d,d,_*Sr*-c),d}(0,d,_,-o,E),C=-(.5+c)*r,I=-(.5-h)*s,R=[C,I],z=[C+r,I],k=[C,I+s],et=[C+r,I+s];return(0,Ke.iu)(R,R,S),(0,Ke.iu)(z,z,S),(0,Ke.iu)(k,k,S),(0,Ke.iu)(et,et,S),[R,z,k,et]}}},textureUV:{type:N.g.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({texXmax:o,texXmin:r,texYmax:s,texYmin:c})=>[[r,c],[o,c],[r,s],[o,s]]}},color:{type:N.g.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:o})=>Zt(o)},outlineColor:{type:N.g.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:o})=>Zt(o)},sizing:{type:N.g.UNSIGNED_BYTE,count:4,pack:({rawWidth:o,rawHeight:r,outlineSize:s,referenceSize:c})=>[Ue(Math.max(o,r),128),Ue(s,128),Ue(c,128),0]},placementAngle:{type:N.g.UNSIGNED_BYTE,count:1,packTessellation:({placementAngle:o})=>function on(o){return function sn(o,r){return o%=r,Math.abs(o>=0?o:o+r)}(o*nn,256)}(o)},sizeRatio:{type:N.g.UNSIGNED_SHORT,count:1,packPrecisionFactor:64,pack:({sizeRatio:o})=>o}}},q={createComputedParams:o=>o,attributes:{pos:{type:N.g.SHORT,count:2,packPrecisionFactor:10,pack:"position"},id:{type:N.g.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:N.g.UNSIGNED_BYTE,count:1,pack:o=>0},offset:{type:N.g.SHORT,count:2,packPrecisionFactor:16,packAlternating:{count:4,pack:({size:o})=>{const r=(0,bt.F2)(o),s=-r/2,c=-r/2;return[[s,c],[s+r,c],[s,c+r],[s+r,c+r]]}}},texCoords:{type:N.g.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:()=>[[0,1],[1,1],[0,0],[1,0]]}},size:{type:N.g.UNSIGNED_BYTE,count:2,pack:({size:o})=>[o,o]},referenceSize:{type:N.g.UNSIGNED_BYTE,count:1,pack:({size:o})=>(0,bt.F2)(o)},zoomRange:{type:N.g.UNSIGNED_BYTE,count:2,pack:({scaleInfo:o},{tileInfo:r})=>ge(o,r)}}},Lt=function re(o){const r={};for(const s in o)r[s]={name:s,constructor:o[s]};return r}({FillMeshWriter:We,DotDensityMeshWriter:class fe extends ie{constructor(){super(...arguments),this.vertexSpec=de}createTesselationParams(r){return{inverseArea:1/r.readGeometryArea()}}},ComplexFillMeshWriter:class Or extends tr{constructor(){super(...arguments),this.vertexSpec=nr}},PatternFillMeshWriter:tr,OutlineFillMeshWriter:Re,PatternOutlineFillMeshWriter:class lr extends Re{constructor(){super(...arguments),this.vertexSpec=Br}_createOutlineWriter(r,s,c,h){return new cr(r,s,c,h)}_write(r,s,c){const h=c?.asOptimized()??s.readGeometryForDisplay(),d=this._clip(h);if(!d)return;const _=this.evaluatedMeshParams.sprite?.textureBinding;r.recordStart(this.instanceId,this.attributeLayout,_),this._writeGeometry(r,s,d),this._lineMeshWriter.writeLineVertices(r,st.z.fromOptimizedCIM(d,"esriGeometryPolyline"),s),r.recordEnd()}ensurePacked(r,s,c){super.ensurePacked(r,s,c),this._lineMeshWriter.ensurePacked(r,s,c)}enqueueRequest(r,s,c){super.enqueueRequest(r,s,c),this._lineMeshWriter.enqueueRequest(r,s,c)}loadDependencies(){var r=()=>super.loadDependencies,s=this;return(0,x.Z)(function*(){yield Promise.all([r().call(s),s._lineMeshWriter.loadDependencies()])})()}},ComplexOutlineFillMeshWriter:class Lr extends Re{constructor(){super(...arguments),this.vertexSpec=Cr}_createOutlineWriter(r,s,c,h){return new Rr(r,s,c,h)}_write(r,s,c){const h=c?.asOptimized()??s.readGeometryForDisplay(),d=this._clip(h);if(!d)return;const _=this.evaluatedMeshParams.sprite?.textureBinding;r.recordStart(this.instanceId,this.attributeLayout,_),this._writeGeometry(r,s,d),this._lineMeshWriter.writeLineVertices(r,st.z.fromOptimizedCIM(d,"esriGeometryPolyline"),s),r.recordEnd()}ensurePacked(r,s,c){super.ensurePacked(r,s,c),this._lineMeshWriter.ensurePacked(r,s,c)}enqueueRequest(r,s,c){super.enqueueRequest(r,s,c),this._lineMeshWriter.enqueueRequest(r,s,c)}loadDependencies(){var r=()=>super.loadDependencies,s=this;return(0,x.Z)(function*(){yield Promise.all([r().call(s),s._lineMeshWriter.loadDependencies()])})()}},MarkerMeshWriter:class P extends qt{constructor(){super(...arguments),this.vertexSpec=M}getBoundsInfo(){return this.evaluatedMeshParams.boundsInfo}_write(r,s,c){const h=this.evaluatedMeshParams.sprite?.textureBinding,d=s.getDisplayId();r.recordStart(this.instanceId,this.attributeLayout,h);const _=this.evaluatedMeshParams.minPixelBuffer,E=Math.max(this.evaluatedMeshParams.computedWidth,_),S=Math.max(this.evaluatedMeshParams.computedHeight,_),C=this.evaluatedMeshParams.offsetX,I=-this.evaluatedMeshParams.offsetY;if(null!=this.evaluatedMeshParams.placement)this._writePlacedMarkers(r,s,c,E,S);else if(c&&c.nextPath()){c.nextPoint();const R=c.x,z=c.y;r.recordBounds(R+C,z+I,E,S),this._writeQuad(r,d,R,z)}else if("esriGeometryPolygon"===s.geometryType){const R=s.readCentroidForDisplay();if(!R)return;const[z,k]=R.coords;r.recordBounds(z+C,k+I,E,S),this._writeQuad(r,d,z,k)}else if("esriGeometryPoint"===s.geometryType){const R=s.readXForDisplay(),z=s.readYForDisplay();r.recordBounds(R+C,z+I,E,S),this._writeQuad(r,d,R,z)}else s.readGeometryForDisplay()?.forEachVertex((z,k)=>{r.recordBounds(z+C,k+I,E,S),Math.abs(z)>me.L||Math.abs(k)>me.L||this._writeQuad(r,d,z,k)});r.recordEnd()}_writePlacedMarkers(r,s,c,h,d){const _=c??st.z.fromFeatureSetReaderCIM(s)?.clone();if(!_)return;const S=gr.getPlacement(_,-1,this.evaluatedMeshParams.placement,(0,bt.F2)(1),r.id,Et());if(!S)return;const C=s.getDisplayId();let I=S.next();const R=this.evaluatedMeshParams.offsetX,z=-this.evaluatedMeshParams.offsetY;for(;null!=I;){const k=I.tx,et=-I.ty;if(Math.abs(k)>me.L||Math.abs(et)>me.L){I=S.next();continue}const dt=-I.getAngle();r.recordBounds(k+R,et+z,h,d),this._writeQuad(r,C,k,et,dt),I=S.next()}}_writeQuad(r,s,c,h,d){const _=r.vertexCount();this._writeVertex(r,s,c,h,null==d?null:{placementAngle:d}),r.indexWrite(_+0),r.indexWrite(_+1),r.indexWrite(_+2),r.indexWrite(_+1),r.indexWrite(_+3),r.indexWrite(_+2)}},PieChartMeshWriter:class Tt extends qt{constructor(){super(...arguments),this.vertexSpec=q}_write(r,s){const c=s.getDisplayId(),h=this.evaluatedMeshParams.minPixelBuffer,d=Math.max((0,bt.F2)(this.evaluatedMeshParams.size),h);let _,E;if("esriGeometryPoint"===s.geometryType)_=s.readXForDisplay(),E=s.readYForDisplay();else{const C=s.readCentroidForDisplay();if(!C)return;_=C?.coords[0],E=C?.coords[1]}r.recordStart(this.instanceId,this.attributeLayout),r.recordBounds(_,E,d,d);const S=r.vertexCount();this._writeVertex(r,c,_,E),r.indexWrite(S+0),r.indexWrite(S+1),r.indexWrite(S+2),r.indexWrite(S+1),r.indexWrite(S+3),r.indexWrite(S+2),r.recordEnd()}},TextMeshWriter:wr,LineMeshWriter:Ge,TexturedLineMeshWriter:class rn extends Ge{constructor(r,s,c,h){super(r,s,c,h),this.vertexSpec=en,this._tessellationOptions.textured=!0}_write(r,s,c){const h=c??st.z.fromFeatureSetReaderCIM(s);if(!h)return;const{sprite:d}=this.evaluatedMeshParams;this._writeGeometry(r,s,h,d?.textureBinding)}},HeatmapMeshWriter:class Fr extends qt{constructor(){super(...arguments),this.vertexSpec=Vr}_write(r,s){r.recordStart(this.instanceId,this.attributeLayout);const c=s.getDisplayId();if("esriGeometryPoint"===s.geometryType){const h=s.readXForDisplay(),d=s.readYForDisplay();this._writeQuad(r,c,h,d)}else"esriGeometryMultipoint"===s.geometryType&&s.readGeometryForDisplay()?.forEachVertex((d,_)=>{d>=0&&d<=512&&_>=0&&_<=512&&this._writeQuad(r,c,d,_)});r.recordEnd()}_writeQuad(r,s,c,h){const d=r.vertexCount();this._writeVertex(r,s,c,h),r.indexWrite(d+0),r.indexWrite(d+1),r.indexWrite(d+2),r.indexWrite(d+1),r.indexWrite(d+3),r.indexWrite(d+2)}},LabelMeshWriter:class tn extends wr{constructor(){super(...arguments),this._zoomLevel=0}_write(r,s,c,h){if(this._zoomLevel=h||0,null!=c)throw new Error("InternalError: EffectGeometry not support for LabelMeshWriter");switch(s.geometryType){case"esriGeometryPoint":{const d=s.readXForDisplay(),_=s.readYForDisplay();return this._writePoint(r,d,_,s)}case"esriGeometryEnvelope":case"esriGeometryPolygon":case"esriGeometryMultipoint":{const d=s.readCentroidForDisplay();if(!d)return;const[_,E]=d.coords;return this._writePoint(r,_,E,s)}case"esriGeometryPolyline":{const d=s.readLegacyGeometryForDisplay();this._writeLines(r,s,d)}}}_writePoint(r,s,c,h){const d=this._getShaping();if(!d)return;let _=this._getPointReferenceBounds();_||(_={offsetX:0,offsetY:0,size:0});const E=d.boundsT,S=(0,Le.kH)(this.evaluatedMeshParams.horizontalAlignment),C=(0,Le.b7)(this.evaluatedMeshParams.verticalAlignment),I=this.evaluatedMeshParams.scaleInfo?.maxScale??0,R=this.evaluatedMeshParams.scaleInfo?.minScale??0,z=(0,Be.jL)(h.getDisplayId());r.metricStart(new Ae.O(z,s,c,S,C,I,R,_)),r.metricBoxWrite(E),this._writeGlyphs(r,h.getDisplayId(),s,c,d,0,_),r.metricEnd()}_getPointReferenceBounds(){if(!this._references)return null;for(const r of this._references){const s=r.getBoundsInfo();if(s)return s}return null}_writeLines(r,s,c){const{repeatLabel:h,scaleInfo:d}=this.evaluatedMeshParams,_=this.evaluatedMeshParams.repeatLabelDistance||128,E=this._getShaping();if(!E)return;this._current={out:r,id:s.getDisplayId(),shaping:E,zoomRange:ge(d,this.getTileInfo()),referenceBounds:this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0}};const S=function Kr(o,r){const s=r;for(let c=0;c<o.length;c++){let h=o[c];kr(h,s);const d=[];d.push(h[0]);for(let _=1;_<h.length;_++){const[E,S]=h[_-1],[C,I]=h[_];d.push([C-E,I-S])}o[c]=d,h=d}return o}(c.paths,E.bounds.width),C=this._placeSubdivGlyphs.bind(this),I=(E.bounds.width+_)/2;for(const R of S)mr(R,I,C,!!h)}_placeSubdivGlyphs(r,s,c,h){const{allowOverrun:d,labelPosition:_,repeatLabelDistance:E}=this.evaluatedMeshParams,S=this._current.zoomRange[0],C=qr(s),I=this._current.shaping.bounds.width/2,R=Math.sqrt(E||128)/2,z=Math.min(c,h-c),k=this._current.shaping.isMultiline?28:Math.log2(z/(R+I/2)),et=0===s?k:Math.min(C,k),dt=Math.max(S,this._zoomLevel+1-et),ft=this._zoomLevel-dt,St=this._current.shaping.bounds.width/2*2**ft;this._current.shaping.isMultiline?0===s&&this._placeStraight(r,dt):d&&ft<0?this._placeStraightAlong(r,S):"parallel"===_?this._placeStraightAlong(r,dt):"curved"===_&&this._placeCurved(r,dt,St)}_placeStraight(r,s){const{out:c,id:h,shaping:d,referenceBounds:_}=this._current,{x:E,y:S}=r,C=(0,Be.jL)(h);c.metricStart(new Ae.O(C,r.x,r.y,0,0,this.evaluatedMeshParams.scaleInfo?.maxScale??0,this.evaluatedMeshParams.scaleInfo?.minScale??0,null)),c.metricBoxWrite(d.boundsT);const z=r.angle*(180/Math.PI)%360,k=(r.angle*(180/Math.PI)+180)%360;this._writeGlyphs(c,h,E,S,d,0,_,{clipAngle:z,mapAligned:!0,isLineLabel:!0,minZoom:s}),this._writeGlyphs(c,h,E,S,d,0,_,{clipAngle:k,mapAligned:!0,isLineLabel:!0,minZoom:s}),c.metricEnd()}_placeCurved(r,s,c){const{out:h,id:d}=this._current,_=r.clone(),E=r.angle*(180/Math.PI)%360,S=(r.angle*(180/Math.PI)+180)%360,C=(0,Be.jL)(d);h.metricStart(new Ae.O(C,r.x,r.y,0,0,this.evaluatedMeshParams.scaleInfo?.maxScale??0,this.evaluatedMeshParams.scaleInfo?.minScale??0,null)),this._placeFirst(_,s,1,E),this._placeBack(r,_,s,c,1,E),this._placeForward(r,_,s,c,1,E),this._placeFirst(_,s,0,S),this._placeBack(r,_,s,c,0,S),this._placeForward(r,_,s,c,0,S),h.metricEnd()}_placeStraightAlong(r,s){const{out:c,id:h,shaping:d,zoomRange:_,referenceBounds:E}=this._current,{boxBorderLineColor:S,boxBackgroundColor:C}=this.evaluatedMeshParams,I=r.clone(),R=r.angle*(180/Math.PI)%360,z=(r.angle*(180/Math.PI)+180)%360;if(d.glyphs.length>0&&(S||C)){const ft=Math.max(s,_[0],0),St=Math.min(28,_[1]),It=(0,Oe.Us)((0,ur.Ue)(),-r.angle),[$t,Ht]=d.shapeBackground(It),kt={minZoom:ft,maxZoom:St,clipAngle:R,mapAligned:!0,isLineLabel:!0};c.recordStart(this.instanceId,this.attributeLayout,d.glyphs[0].textureBinding),this._writeTextBox(c,h,r.x,r.y,Ht,E,kt),c.recordEnd(),kt.clipAngle=z,c.recordStart(this.instanceId,this.attributeLayout,d.glyphs[0].textureBinding),this._writeTextBox(c,h,r.x,r.y,Ht,E,kt),c.recordEnd()}const k=(0,Be.jL)(h);c.metricStart(new Ae.O(k,r.x,r.y,0,0,this.evaluatedMeshParams.scaleInfo?.maxScale??0,this.evaluatedMeshParams.scaleInfo?.minScale??0,null)),this._placeFirst(I,s,1,R,!0),this._placeFirst(I,s,0,z,!0),c.metricEnd()}_placeBack(r,s,c,h,d,_){const E=r.clone();let S=r.backwardLength+0;for(;E.prev()&&!(S>=h);)this._placeOnSegment(E,s,S,c,-1,d,_),S+=E.length+0}_placeForward(r,s,c,h,d,_){const E=r.clone();let S=r.remainingLength+0;for(;E.next()&&!(S>=h);)this._placeOnSegment(E,s,S,c,1,d,_),S+=E.length+0}_placeFirst(r,s,c,h,d=!1){const _=r,{out:E,id:S,shaping:C,zoomRange:I,referenceBounds:R}=this._current,z=C.glyphs;for(const k of z){const et=k.x>C.bounds.x?c:1-c,dt=et*r.remainingLength+(1-et)*r.backwardLength,ft=Math.abs(k.x+k.width/2-C.bounds.x),St=Math.max(0,this._zoomLevel+Math.log2(ft/(dt+0))),It=Math.max(s,d?0:St);k.maxZoom=Math.min(I[1],28),k.angle=r.angle+(1-c)*Math.PI,k.minZoom=Math.max(I[0],It),this._writeLineGlyph(E,S,_.x,_.y,C.bounds,k,h,R,!0),c&&this._isVisible(k.minZoom,k.maxZoom)&&E.metricBoxWrite(k.bounds)}}_placeOnSegment(r,s,c,h,d,_,E){const{out:S,id:C,shaping:I,referenceBounds:R}=this._current,z=I.glyphs,dt={x:r.x+c*-d*(r.dx/r.length),y:r.y+c*-d*(r.dy/r.length)};for(const ft of z){const St=ft.x>I.bounds.x?_:1-_;if(!(St&&1===d||!St&&-1===d))continue;const It=Math.abs(ft.x+ft.width/2-I.bounds.x),$t=Math.max(0,this._zoomLevel+Math.log2(It/c)-.1),Ht=Math.max(h,this._zoomLevel+Math.log2(It/(c+r.length+0)));if(0!==$t&&(ft.angle=r.angle+(1-_)*Math.PI,ft.minZoom=Ht,ft.maxZoom=$t,this._writeLineGlyph(S,C,dt.x,dt.y,I.bounds,ft,E,R,!0),_&&this._isVisible(ft.minZoom,ft.maxZoom))){const kt=ft.bounds,xe=new hr.Z(kt.center[0]+(r.x-s.x),kt.center[1]+(r.y-s.y),kt.width,kt.height);S.metricBoxWrite(xe)}}}_writeLineGlyph(r,s,c,h,d,_,E,S,C){const I=c+d.x,R=h+d.y,z=2*(this.evaluatedMeshParams.minPixelBuffer?this.evaluatedMeshParams.minPixelBuffer/this._textMeshTransformProps.fontSize:1),k=Math.max(d.width,d.height)*z;r.recordStart(this.instanceId,this.attributeLayout,_.textureBinding),r.recordBounds(I,R,k,k);const{texcoords:et,offsets:dt}=_;this._writeQuad(r,s,c,h,{texcoords:et,offsets:dt,fontSize:this._textMeshTransformProps.fontSize,color:Zt(this.evaluatedMeshParams.color),isBackground:!1,referenceBounds:S,minZoom:Math.max(this._current.zoomRange[0],_.minZoom),maxZoom:Math.min(this._current.zoomRange[1],_.maxZoom),clipAngle:E,mapAligned:C,isLineLabel:!0}),r.recordEnd()}_isVisible(r,s){const c=this._zoomLevel;return r<=c&&c<=s}}})},24055:(Wt,ct,m)=>{function x(f){return f}function y(f){return f}m.d(ct,{G:()=>x,W:()=>y})},5885:(Wt,ct,m)=>{m.d(ct,{Ie:()=>w,RS:()=>j,fz:()=>U,HN:()=>Q});var x=m(17626),y=m(72571),f=m(83006),b=m(99963),Y=m(8314),X=m(75152);class W extends f.oo{getVisualVariableData(v){if(!this._vvData){const O=this.getAttributeDataCoords(v);this._vvData=(0,b.ig)(this.visualVariableData,O).setDebugName("storage2")}return this._vvData}getAttributeDataCoords(v){if(!this._uv){const O=(0,X.Wv)(v),L=this.size,G=(0,b.e$)(O.x),rt=(0,b.e$)(O.y).multiply((0,b.e$)(256)),J=(0,b.e$)(O.z).multiply((0,b.e$)(256)).multiply((0,b.e$)(256)),A=(0,b.fz)(G.add(rt).add(J)),nt=(0,b.wQ)(A,L),at=A.subtract(nt).divide(L);this._uv=new b.Sg(nt,at).add(.5).divide(L)}return this._uv}getFilterData(v){const O=this.getAttributeDataCoords(v);return(0,b.ig)(this.filterFlags,O).setDebugName("storage0")}getAnimationData(v){const O=this.getAttributeDataCoords(v);return(0,b.ig)(this.animation,O).setDebugName("storage1")}getVVData(v){return this.getVisualVariableData(v)}getDataDrivenData0(v){const O=this.getAttributeDataCoords(v);return(0,b.ig)(this.dataDriven0,O).setDebugName("storage30")}getDataDrivenData1(v){const O=this.getAttributeDataCoords(v);return(0,b.ig)(this.dataDriven1,O).setDebugName("storage31")}getDataDrivenData2(v){const O=this.getAttributeDataCoords(v);return(0,b.ig)(this.dataDriven2,O).setDebugName("storage32")}getGPGPUData(v){const O=this.getAttributeDataCoords(v);return(0,b.ig)(this.gpgpu,O).setDebugName("storage4")}getFilterFlags(v){return(0,Y.Z)("webgl-ignores-sampler-precision")?(0,b.mD)(this.getFilterData(v).x.multiply((0,b.fz)(255))):this.getFilterData(v).x.multiply((0,b.fz)(255))}getAnimationValue(v){return this.getAnimationData(v).x}getSizeValue(v){return this.getVisualVariableData(v).x}getColorValue(v){return this.getVisualVariableData(v).y}getOpacityValue(v){return this.getVisualVariableData(v).z}getRotationValue(v){return this.getVisualVariableData(v).w}}(0,x._)([(0,f.e5)(b.Eg)],W.prototype,"filterFlags",void 0),(0,x._)([(0,f.e5)(b.Eg)],W.prototype,"animation",void 0),(0,x._)([(0,f.e5)(b.Eg)],W.prototype,"gpgpu",void 0),(0,x._)([(0,f.e5)(b.Eg)],W.prototype,"visualVariableData",void 0),(0,x._)([(0,f.e5)(b.Eg)],W.prototype,"dataDriven0",void 0),(0,x._)([(0,f.e5)(b.Eg)],W.prototype,"dataDriven1",void 0),(0,x._)([(0,f.e5)(b.Eg)],W.prototype,"dataDriven2",void 0),(0,x._)([(0,f.e5)(b.bv)],W.prototype,"size",void 0);class tt extends f.oo{}(0,x._)([(0,f.e5)(b.bv)],tt.prototype,"activeReasons",void 0),(0,x._)([(0,f.e5)(b.bv)],tt.prototype,"highlightAll",void 0);class $ extends f.oo{}(0,x._)([(0,f.e5)(b.Sg)],$.prototype,"position",void 0),(0,x._)([(0,f.e5)(b.bv)],$.prototype,"distance",void 0),(0,x._)([(0,f.e5)(b.bv)],$.prototype,"smallSymbolDistance",void 0),(0,x._)([(0,f.e5)(b.bv)],$.prototype,"smallSymbolSizeThreshold",void 0);var Z=m(41069);class Q extends f.Pz{}(0,x._)([(0,f.xh)(0,b.AO)],Q.prototype,"id",void 0),(0,x._)([(0,f.xh)(1,b.bv)],Q.prototype,"bitset",void 0),(0,x._)([(0,f.xh)(2,b.Sg)],Q.prototype,"pos",void 0);class j extends f.yu{}(0,x._)([(0,f.xh)(14,b.Sg)],j.prototype,"nextPos1",void 0),(0,x._)([(0,f.xh)(15,b.Sg)],j.prototype,"nextPos2",void 0);class U extends f.XB{}class w extends f.ri{clip(v,O){let L=new b.bv(0);const G=this.storage.getFilterFlags(v);if(L=L.add((0,b.fz)(2).multiply((0,b.fz)(1).subtract((0,X.bG)(G,0)))),this.inside?L=L.add((0,b.fz)(2).multiply((0,b.fz)(1).subtract((0,X.bG)(G,1)))):this.outside?L=L.add((0,b.fz)(2).multiply((0,X.bG)(G,1))):this.highlight&&(L=L.add((0,b.fz)(2).multiply((0,b.fz)(1).subtract(this._checkHighlight(G))))),null!=O){const rt=new b.bv(1).subtract((0,b.Nb)(O.x,this.view.currentZoom)),J=(0,b.Nb)(O.y,this.view.currentZoom);L=L.add(new b.bv(2).multiply(rt.add(J)))}return L}getFragmentOutput(v,O,L=new b.bv(1/255)){const G=new f.Qt;return G.glFragColor=this._maybeWriteHittest(O)??this._maybeHighlight(v,L)??v,G}_maybeHighlight(v,O){return this.highlight?new b.T8(v.rgb,(0,b.Nb)(O,v.a)):null}_checkHighlight(v){let O=this._checkHighlightBit(v,0);for(let L=1;L<y.Oo.length;L++)O=O.add(this._checkHighlightBit(v,L));return(0,b.Nb)(new b.bv(.1),O.add(this.highlight.highlightAll))}_checkHighlightBit(v,O){return(0,X.hG)(v,O).multiply((0,X.qD)(this.highlight.activeReasons,O))}maybeRunHittest(v,O,L){if(null==this.hittestRequest)return null;const G=this.hittest(v,O,L);let rt=(0,b.KJ)((0,b.tS)(G,this.hittestRequest.distance),new b.bv(2),new b.bv(0));const J=this.storage.getAttributeDataCoords(v.id),A=(0,X.pK)(J);rt=rt.add(this.clip(v.id,v.zoomRange));const nt=new b.T8(new b.bv(1/255),0,0,0);return{glPointSize:new b.bv(1),glPosition:new b.T8(A,rt,1),color:nt}}_maybeWriteHittest(v){return null!=this.hittestRequest?v.color:null}}(0,x._)([f.Ou],w.prototype,"inside",void 0),(0,x._)([f.Ou],w.prototype,"outside",void 0),(0,x._)([(0,f.Kw)(tt)],w.prototype,"highlight",void 0),(0,x._)([(0,f.e5)(W)],w.prototype,"storage",void 0),(0,x._)([(0,f.e5)(Z.C)],w.prototype,"view",void 0),(0,x._)([(0,f.Kw)($)],w.prototype,"hittestRequest",void 0)},98092:(Wt,ct,m)=>{m.d(ct,{LU:()=>v,Oh:()=>T,YW:()=>w});var x=m(17626),y=m(39351),f=m(83006),b=m(99963),Y=m(5885),X=m(36519),W=m(94197),tt=m(74902),$=m(69767),Z=m(75152);class Q extends W.F{}function w(O,L){const G=(0,b.CD)(new b.Sg(1),new b.Sg(1/y.Kg),new b.Sg((0,Z.qD)(L.bitset,X.i6),(0,Z.qD)(L.bitset,X.oy))),rt=O.view.requiredZoomFactor,J=new b.Sg(L.width,L.height).multiply(G),A=J.multiply(L.scale).multiply(rt),nt=L.angle.multiply(X.e4),at=(0,b.O$)(nt),H=(0,b.mC)(nt),ht=function U(O,L,G,rt,J){const A=(0,b.ln)((0,Z.qD)(J,X.Ux),(0,b.fz)(1)),nt=(0,Z.JH)(new b.T8(O,0));return(0,b.KJ)(A,(0,b.wO)(rt.divide(L.x),G.divide(L.y),0,(0,b.tk)(G.divide(L.x)),rt.divide(L.y),0,(0,Z.TN)((0,b.K4)(nt,0)),(0,Z.TN)((0,b.K4)(0,nt)),1),(0,b.wO)(rt.divide(L.x),G.divide(L.y),0,(0,b.tk)(G.divide(L.x)),rt.divide(L.y),0,0,0,1))}(L.id,A,at,H,L.bitset),lt=O.localTileOffset.getPatternOffsetAtTileOrigin(J,at,H),xt=rt.multiply(L.scale).multiply(L.offset.subtract(lt)).divide(A),pt=new b.AO(L.pos,1),vt=ht.multiply(pt).xy.subtract(xt),_t=L.tlbr.divide(O.mosaicInfo.size.xyxy);let V=(0,Z.qD)(L.bitset,X.GS);return null!=O.visualVariableColor&&(V=(0,b.KJ)((0,Z.In)(O.storage.getColorValue(L.id)),new b.bv(0),V)),{tileTextureCoord:vt,tlbr:_t,sampleAlphaOnly:V}}function T(O,L){const G=(0,b.wQ)(L.tileTextureCoord,new b.bv(1)),rt=(0,b.CD)(L.tlbr.xy,L.tlbr.zw,G);let J=(0,b.ig)(O.mosaicInfo.texture,rt);return J=(0,b.KJ)((0,b.tS)(L.sampleAlphaOnly,new b.bv(.5)),J.aaaa,J),L.color.multiply(J)}(0,x._)([(0,f.xh)(5,b.T8)],Q.prototype,"tlbr",void 0),(0,x._)([(0,f.xh)(6,b.bv)],Q.prototype,"width",void 0),(0,x._)([(0,f.xh)(7,b.bv)],Q.prototype,"height",void 0),(0,x._)([(0,f.xh)(8,b.Sg)],Q.prototype,"offset",void 0),(0,x._)([(0,f.xh)(9,b.Sg)],Q.prototype,"scale",void 0),(0,x._)([(0,f.xh)(10,b.bv)],Q.prototype,"angle",void 0);class v extends W.C{vertex(L,G){return{...super.vertex(L,G),...w(this,L)}}fragment(L){const G=T(this,L);return this.getFragmentOutput(G,L,new b.bv(0))}}(0,x._)([(0,f.e5)($.N)],v.prototype,"mosaicInfo",void 0),(0,x._)([(0,f.e5)(tt.H)],v.prototype,"localTileOffset",void 0),(0,x._)([(0,x.a)(0,(0,f.qH)(Q)),(0,x.a)(1,(0,f.qH)(Y.RS))],v.prototype,"vertex",null),(0,x._)([(0,x.a)(0,(0,f.qH)(class j extends Y.fz{}))],v.prototype,"fragment",null)},38420:(Wt,ct,m)=>{m.d(ct,{$1:()=>j,NS:()=>w,Nz:()=>O});var x=m(17626),y=m(83006),f=m(99963),b=m(5885),Y=m(98092),X=m(95936),W=m(18642),tt=m(74902),$=m(69767),Z=m(3065),Q=m(57615);const j=16,U=1/j,w=128;class T extends b.HN{}(0,x._)([(0,y.xh)(3,f.T8)],T.prototype,"color",void 0),(0,x._)([(0,y.xh)(4,f.T8)],T.prototype,"tlbr",void 0),(0,x._)([(0,y.xh)(5,f.bv)],T.prototype,"angle",void 0),(0,x._)([(0,y.xh)(6,f.bv)],T.prototype,"aux1",void 0),(0,x._)([(0,y.xh)(7,f.bv)],T.prototype,"aux2",void 0),(0,x._)([(0,y.xh)(8,f.Sg)],T.prototype,"aux3",void 0),(0,x._)([(0,y.xh)(9,f.Sg)],T.prototype,"aux4",void 0),(0,x._)([(0,y.xh)(10,f.Sg)],T.prototype,"zoomRange",void 0);class O extends Z.VV{vertex(G,rt){const{aux1:J,aux2:A,aux3:nt,aux4:at}=G,H={...G,width:J,height:A,offset:nt,scale:at.multiply(U)},ht={...G,halfWidth:J.multiply(U),referenceHalfWidth:A.multiply(U),offset:nt.multiply(U),normal:at.subtract(w).multiply(U)},lt=(0,Z.R0)(this,ht),xt=(0,Y.YW)(this,H),pt=(0,f.tS)(lt.isOutline,new f.bv(.5));return{...lt,...xt,...this.maybeRunHittest(G,rt,pt)}}fragment(G){const{isOutline:rt}=G,J=(0,f.tS)(rt,new f.bv(.5)),A=(0,W.zj)(G,this.antialiasingControls.blur),nt=(0,Y.Oh)(this,G),at=(0,f.KJ)(J,A,nt),H=(0,f.KJ)(J,new f.bv(1/255),new f.bv(0));return this.getFragmentOutput(at,G,H)}hittest(G,rt,J){return(0,f.KJ)(J,(0,X.Oz)(this.hittestRequest),(0,X.CC)(this,G,rt))}}(0,x._)([(0,y.e5)($.N)],O.prototype,"mosaicInfo",void 0),(0,x._)([(0,y.e5)(tt.H)],O.prototype,"localTileOffset",void 0),(0,x._)([(0,x.a)(0,(0,y.qH)(T)),(0,x.a)(1,(0,y.qH)(b.RS))],O.prototype,"vertex",null),(0,x._)([(0,x.a)(0,(0,y.qH)(class v extends Q.K7{}))],O.prototype,"fragment",null)},94197:(Wt,ct,m)=>{m.d(ct,{C:()=>Z,F:()=>$});var x=m(17626),y=m(83006),f=m(99963),b=m(5885),Y=m(95936),X=m(72884),W=m(93239),tt=m(30247);class $ extends b.HN{}(0,x._)([(0,y.xh)(3,f.T8)],$.prototype,"color",void 0),(0,x._)([(0,y.xh)(4,f.Sg)],$.prototype,"zoomRange",void 0);class Z extends b.Ie{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(j,U){const w=(0,tt.sY)(this,j.id),T=(0,tt.Zt)(this,j.id,j.color).multiply(w),v=this.view.displayViewScreenMat3.multiply(new f.AO(j.pos.xy,1)),O=this.clip(j.id,j.zoomRange);return{glPosition:new f.T8(v.xy,O,1),color:T,...this.maybeRunHittest(j,U,null)}}fragment(j){return this.getFragmentOutput(j.color,j,new f.bv(0))}hittest(j,U){return(0,Y.CC)(this,j,U)}}(0,x._)([(0,y.Kw)(X.W)],Z.prototype,"visualVariableColor",void 0),(0,x._)([(0,y.Kw)(W.V)],Z.prototype,"visualVariableOpacity",void 0),(0,x._)([(0,x.a)(0,(0,y.qH)($)),(0,x.a)(1,(0,y.qH)(b.RS))],Z.prototype,"vertex",null),(0,x._)([(0,x.a)(0,(0,y.qH)(b.fz))],Z.prototype,"fragment",null)},18642:(Wt,ct,m)=>{m.d(ct,{Pf:()=>A,Wc:()=>L,b$:()=>v,fc:()=>T,tp:()=>w,uY:()=>rt,zj:()=>J});var x=m(17626),y=m(83006),f=m(99963),b=m(5885),Y=m(36519),X=m(95936),W=m(72884),tt=m(93239),$=m(72646),Z=m(6127),Q=m(90132),j=m(81575),U=m(30247);class w extends b.HN{}(0,x._)([(0,y.xh)(3,f.T8)],w.prototype,"color",void 0),(0,x._)([(0,y.xh)(4,f.Sg)],w.prototype,"offset",void 0),(0,x._)([(0,y.xh)(5,f.Sg)],w.prototype,"normal",void 0),(0,x._)([(0,y.xh)(6,f.bv)],w.prototype,"halfWidth",void 0),(0,x._)([(0,y.xh)(7,f.bv)],w.prototype,"referenceHalfWidth",void 0),(0,x._)([(0,y.xh)(8,f.Sg)],w.prototype,"zoomRange",void 0);class T extends b.fz{}class v extends y.oo{}function O(nt){return(0,f.Fp)(new f.bv(Y.Ay).multiply((0,f.Nb)(nt,new f.bv(Y.xp))),new f.bv(1))}function L(nt,at){const{halfWidth:H,normal:ht}=nt,lt=O(H),xt=(0,f.kE)(ht).multiply(H);return(0,f.uZ)(lt.multiply(H.subtract(xt)).divide(at.add(lt).subtract(new f.bv(1))),new f.bv(0),new f.bv(1))}function rt(nt,at){const{id:H,offset:ht,pos:lt,normal:xt,zoomRange:pt}=at,{displayViewScreenMat3:vt,displayViewMat3:_t}=nt.view,V=(0,U.Zt)(nt,H,at.color),B=(0,U.sY)(nt,H),At=function G(nt,at){const{id:H,halfWidth:ht,referenceHalfWidth:lt}=at;if((0,U.lA)(nt)){const xt=new f.bv(2).multiply(lt),pt=(0,U.Vm)(nt,H,xt);return new f.bv(.5).multiply(ht.divide((0,f.Fp)(lt,new f.bv(Y.Ho)))).multiply(pt)}return ht}(nt,at),Bt=new f.bv(.5).multiply(nt.antialiasingControls.antialiasing),yt=(0,f.Fp)(At.add(Bt),new f.bv(.45)).add(new f.bv(.1).multiply(Bt)),wt=O(yt).multiply(yt).multiply(ht),Ot=_t.multiply(new f.AO(wt,new f.bv(0))),zt=vt.multiply(new f.AO(lt,new f.bv(1))).add(Ot),Qt=new f.bv(2).multiply((0,f.Nb)(At,new f.bv(0))).add(nt.clip(H,pt)),Dt=new f.T8(zt.xy,Qt,1);return{color:V,opacity:B,halfWidth:yt,normal:xt,scaledOffset:wt,scaledHalfWidth:At,glPosition:new f.T8(Dt.xy,Qt,1)}}function J(nt,at){const{opacity:H,color:ht}=nt,lt=L(nt,at);return H.multiply(ht).multiply(lt)}(0,x._)([(0,y.e5)(f.bv)],v.prototype,"antialiasing",void 0),(0,x._)([(0,y.e5)(f.bv)],v.prototype,"blur",void 0);class A extends b.Ie{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(at,H){const ht=rt(this,at);return{...ht,...this.maybeRunHittest(at,H,ht.halfWidth)}}fragment(at){const H=J(at,this.antialiasingControls.blur);return this.getFragmentOutput(H,at)}hittest(at,H,ht){const{viewMat3:lt,tileMat3:xt}=this.view,pt=lt.multiply(xt),vt=pt.multiply(new f.AO(at.pos,1)),_t=pt.multiply(new f.AO(H.nextPos1,1)),V=pt.multiply(new f.AO(H.nextPos2,1)),{distance:B,smallSymbolDistance:At,smallSymbolSizeThreshold:Bt}=this.hittestRequest,yt=(0,f.Nb)(ht,Bt.multiply(.5)).multiply(B.subtract(At)),wt=this.hittestRequest.position;return(0,f.VV)((0,X.bA)(wt,vt.xy,_t.xy),(0,X.bA)(wt,vt.xy,V.xy)).subtract(ht).add(yt)}}(0,x._)([(0,y.e5)(v)],A.prototype,"antialiasingControls",void 0),(0,x._)([(0,y.Kw)(W.W)],A.prototype,"visualVariableColor",void 0),(0,x._)([(0,y.Kw)(tt.V)],A.prototype,"visualVariableOpacity",void 0),(0,x._)([(0,y.Kw)($.k)],A.prototype,"visualVariableSizeMinMaxValue",void 0),(0,x._)([(0,y.Kw)(Z.U)],A.prototype,"visualVariableSizeScaleStops",void 0),(0,x._)([(0,y.Kw)(Q.W)],A.prototype,"visualVariableSizeStops",void 0),(0,x._)([(0,y.Kw)(j.V)],A.prototype,"visualVariableSizeUnitValue",void 0),(0,x._)([(0,x.a)(0,(0,y.qH)(w)),(0,x.a)(1,(0,y.qH)(b.RS))],A.prototype,"vertex",null),(0,x._)([(0,x.a)(0,(0,y.qH)(T))],A.prototype,"fragment",null)},74902:(Wt,ct,m)=>{m.d(ct,{H:()=>Y});var x=m(17626),y=m(83006),f=m(99963),b=m(36519);class Y extends y.oo{getPatternOffsetAtTileOrigin(W,tt=new f.bv(0),$=new f.bv(1)){const Z=new f.Sg(b.ad).divide(W);let Q=W.multiply((0,f.ZI)(this.maxIntsToLocalOrigin.multiply(Z))).add(this.tileOffsetFromLocalOrigin).subtract(new f.bv(.5).multiply(W));return Q=new f.Sg(Q.x.multiply($).subtract(Q.y.multiply(tt)),Q.x.multiply(tt).add(Q.y.multiply($))),(0,f.wQ)(Q,W)}}(0,x._)([(0,y.e5)(f.Sg)],Y.prototype,"tileOffsetFromLocalOrigin",void 0),(0,x._)([(0,y.e5)(f.Sg)],Y.prototype,"maxIntsToLocalOrigin",void 0)},69767:(Wt,ct,m)=>{m.d(ct,{N:()=>b});var x=m(17626),y=m(83006),f=m(99963);class b extends y.oo{}(0,x._)([(0,y.e5)(f.Sg)],b.prototype,"size",void 0),(0,x._)([(0,y.e5)(f.Eg)],b.prototype,"texture",void 0)},3065:(Wt,ct,m)=>{m.d(ct,{N8:()=>v,R0:()=>L,VV:()=>G,jt:()=>O,py:()=>rt});var x=m(17626),y=m(83006),f=m(99963),b=m(5885),Y=m(36519),X=m(95936),W=m(18642),tt=m(75152),$=m(72884),Z=m(93239),Q=m(72646),j=m(6127),U=m(90132),w=m(81575),T=m(30247);class v extends b.HN{}(0,x._)([(0,y.xh)(3,f.Sg)],v.prototype,"offset",void 0),(0,x._)([(0,y.xh)(4,f.T8)],v.prototype,"color",void 0),(0,x._)([(0,y.xh)(5,f.Sg)],v.prototype,"normal",void 0),(0,x._)([(0,y.xh)(6,f.bv)],v.prototype,"halfWidth",void 0),(0,x._)([(0,y.xh)(7,f.bv)],v.prototype,"referenceHalfWidth",void 0),(0,x._)([(0,y.xh)(8,f.Sg)],v.prototype,"zoomRange",void 0);class O extends W.fc{}function L(J,A,nt){const{id:at,bitset:H}=A,ht=(0,tt.qD)(H,Y.WD),lt=(0,f.tS)(ht,new f.bv(.5)),xt=(0,W.uY)(J,A),pt=(0,f.KJ)(lt,xt.halfWidth,new f.bv(0)),vt=(0,T.sY)(J,at),_t=(0,T.Zt)(J,at,A.color),V=(0,f.KJ)(lt,A.color,_t.multiply(vt)),B=J.view.displayViewScreenMat3.multiply(new f.AO(A.pos.xy,1)),At=J.clip(A.id),Bt=new f.T8(B.xy,At,1),yt=(0,f.KJ)(lt,xt.glPosition,Bt),wt=nt&&J.maybeRunHittest(A,nt,lt);return{isOutline:ht,color:V,opacity:new f.bv(1),halfWidth:pt,normal:xt.normal,glPosition:yt,...wt}}class G extends b.Ie{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}}(0,x._)([(0,y.e5)(W.b$)],G.prototype,"antialiasingControls",void 0),(0,x._)([(0,y.Kw)($.W)],G.prototype,"visualVariableColor",void 0),(0,x._)([(0,y.Kw)(Z.V)],G.prototype,"visualVariableOpacity",void 0),(0,x._)([(0,y.Kw)(Q.k)],G.prototype,"visualVariableSizeMinMaxValue",void 0),(0,x._)([(0,y.Kw)(j.U)],G.prototype,"visualVariableSizeScaleStops",void 0),(0,x._)([(0,y.Kw)(U.W)],G.prototype,"visualVariableSizeStops",void 0),(0,x._)([(0,y.Kw)(w.V)],G.prototype,"visualVariableSizeUnitValue",void 0);class rt extends G{vertex(A,nt){return L(this,A,nt)}fragment(A){const{color:nt,isOutline:at}=A,H=(0,f.tS)(at,new f.bv(.5)),ht=(0,W.zj)(A,this.antialiasingControls.blur),lt=(0,f.KJ)(H,ht,nt),xt=(0,f.KJ)(H,new f.bv(1/255),new f.bv(0));return this.getFragmentOutput(lt,A,xt)}hittest(A,nt,at){return(0,f.KJ)(at,(0,X.Oz)(this.hittestRequest),(0,X.CC)(this,A,nt))}}(0,x._)([(0,x.a)(0,(0,y.qH)(v)),(0,x.a)(1,(0,y.qH)(b.RS))],rt.prototype,"vertex",null),(0,x._)([(0,x.a)(0,(0,y.qH)(O))],rt.prototype,"fragment",null)},75254:(Wt,ct,m)=>{m.d(ct,{DS:()=>j,Qp:()=>Q,lA:()=>U});var x=m(17626),y=m(83006),f=m(99963),b=m(5885),Y=m(94197),X=m(74902),W=m(69767);class tt extends Y.F{}function Q(w,T){const v=T.tlbr.xy,O=T.tlbr.zw,L=O.x.subtract(v.x),G=v.y.subtract(O.y),rt=new f.Sg(L,G).multiply(T.inverseRasterizationScale),J=rt.multiply(w.view.requiredZoomFactor),A=function Z(w){const T=new f.bv(1),v=new f.bv(0);return new f.Tu(T.divide(w.x),v.divide(w.y),0,(0,f.tk)(v.divide(w.x)),T.divide(w.y),0,0,0,1)}(J),nt=w.localTileOffset.getPatternOffsetAtTileOrigin(rt).divide(J),at=new f.AO(T.pos,1);return{tileTextureCoord:A.multiply(at).xy.subtract(nt),tlbr:T.tlbr.divide(w.mosaicInfo.size.xyxy)}}function j(w,T){const v=(0,f.wQ)(w.tileTextureCoord,new f.bv(1)),O=(0,f.CD)(w.tlbr.xy,w.tlbr.zw,v),L=(0,f.ig)(T.texture,O);return w.color.multiply(L)}(0,x._)([(0,y.xh)(5,f.T8)],tt.prototype,"tlbr",void 0),(0,x._)([(0,y.xh)(6,f.bv)],tt.prototype,"inverseRasterizationScale",void 0);class U extends Y.C{vertex(T,v){return{...super.vertex(T,v),...Q(this,T)}}fragment(T){const v=j(T,this.mosaicInfo);return this.getFragmentOutput(v,T,new f.bv(0))}}(0,x._)([(0,y.e5)(W.N)],U.prototype,"mosaicInfo",void 0),(0,x._)([(0,y.e5)(X.H)],U.prototype,"localTileOffset",void 0),(0,x._)([(0,x.a)(0,(0,y.qH)(tt)),(0,x.a)(1,(0,y.qH)(b.RS))],U.prototype,"vertex",null),(0,x._)([(0,x.a)(0,(0,y.qH)(class $ extends b.fz{}))],U.prototype,"fragment",null)},57615:(Wt,ct,m)=>{m.d(ct,{K7:()=>Q,Zd:()=>j});var x=m(17626),y=m(83006),f=m(99963),b=m(5885),Y=m(18642),X=m(74902),W=m(69767),tt=m(3065),$=m(75254);class Z extends tt.N8{}(0,x._)([(0,y.xh)(9,f.T8)],Z.prototype,"tlbr",void 0),(0,x._)([(0,y.xh)(10,f.bv)],Z.prototype,"inverseRasterizationScale",void 0);class Q extends tt.jt{}class j extends tt.py{vertex(w,T){return{...(0,tt.R0)(this,w,T),...(0,$.Qp)(this,w)}}fragment(w){const{isOutline:T}=w,v=(0,f.tS)(T,new f.bv(.5)),O=(0,Y.zj)(w,this.antialiasingControls.blur),L=(0,$.DS)(w,this.mosaicInfo),G=(0,f.KJ)(v,O,L),rt=(0,f.KJ)(v,new f.bv(1/255),new f.bv(0));return this.getFragmentOutput(G,w,rt)}}(0,x._)([(0,y.e5)(W.N)],j.prototype,"mosaicInfo",void 0),(0,x._)([(0,y.e5)(X.H)],j.prototype,"localTileOffset",void 0),(0,x._)([(0,x.a)(0,(0,y.qH)(Z)),(0,x.a)(1,(0,y.qH)(b.RS))],j.prototype,"vertex",null),(0,x._)([(0,x.a)(0,(0,y.qH)(Q))],j.prototype,"fragment",null)},41069:(Wt,ct,m)=>{m.d(ct,{C:()=>b});var x=m(17626),y=m(83006),f=m(99963);class b extends y.oo{}(0,x._)([(0,y.e5)(f.Tu)],b.prototype,"displayViewScreenMat3",void 0),(0,x._)([(0,y.e5)(f.Tu)],b.prototype,"displayViewMat3",void 0),(0,x._)([(0,y.e5)(f.Tu)],b.prototype,"displayMat3",void 0),(0,x._)([(0,y.e5)(f.Tu)],b.prototype,"viewMat3",void 0),(0,x._)([(0,y.e5)(f.Tu)],b.prototype,"tileMat3",void 0),(0,x._)([(0,y.e5)(f.bv)],b.prototype,"displayZoomFactor",void 0),(0,x._)([(0,y.e5)(f.bv)],b.prototype,"requiredZoomFactor",void 0),(0,x._)([(0,y.e5)(f.Sg)],b.prototype,"tileOffset",void 0),(0,x._)([(0,y.e5)(f.bv)],b.prototype,"currentScale",void 0),(0,x._)([(0,y.e5)(f.bv)],b.prototype,"currentZoom",void 0),(0,x._)([(0,y.e5)(f.bv)],b.prototype,"metersPerSRUnit",void 0),(0,x._)([(0,y.e5)(f.bv)],b.prototype,"rotation",void 0),(0,x._)([(0,y.e5)(f.bv)],b.prototype,"pixelRatio",void 0)},72884:(Wt,ct,m)=>{m.d(ct,{W:()=>Y});var x=m(17626),y=m(83006),f=m(99963),b=m(75152);class Y extends y.oo{getColor(W,tt,$){return(0,f.wV)([(0,f.or)((0,b.In)(W),$),tt],[(0,f.Iz)(W,this.values.first()),this.colors.first()],[(0,f.r7)(W,this.values.last()),this.colors.last()],[!0,()=>{const Z=this.values.findIndex(T=>(0,f.tS)(T,W)),Q=this.values.get(Z),j=Z.subtract(1),U=this.values.get(j),w=W.subtract(U).divide(Q.subtract(U));return(0,f.CD)(this.colors.get(j),this.colors.get(Z),w)}])}}(0,x._)([(0,y.e5)(f.v8.ofType(f.T8,8))],Y.prototype,"colors",void 0),(0,x._)([(0,y.e5)(f.v8.ofType(f.bv,8))],Y.prototype,"values",void 0)},93239:(Wt,ct,m)=>{m.d(ct,{V:()=>Y});var x=m(17626),y=m(83006),f=m(99963),b=m(75152);class Y extends y.oo{getOpacity(W){return(0,f.wV)([(0,b.In)(W),new f.bv(1)],[(0,f.Iz)(W,this.opacityValues.first()),this.opacities.first()],[(0,f.r7)(W,this.opacityValues.last()),this.opacities.last()],[!0,()=>{const tt=this.opacityValues.findIndex(U=>(0,f.tS)(U,W)),$=this.opacityValues.get(tt),Z=tt.subtract(1),Q=this.opacityValues.get(Z),j=W.subtract(Q).divide($.subtract(Q));return(0,f.CD)(this.opacities.get(Z),this.opacities.get(tt),j)}])}}(0,x._)([(0,y.e5)(f.v8.ofType(f.bv,8))],Y.prototype,"opacities",void 0),(0,x._)([(0,y.e5)(f.v8.ofType(f.bv,8))],Y.prototype,"opacityValues",void 0)},72646:(Wt,ct,m)=>{m.d(ct,{k:()=>Y});var x=m(17626),y=m(83006),f=m(99963),b=m(75152);class Y extends y.oo{getSize(W,tt){const $=this.minMaxValueAndSize.xy,Z=this.minMaxValueAndSize.zw;return(0,f.KJ)((0,b.In)(W),tt,()=>{const Q=W.subtract($.x).divide($.y.subtract($.x)),j=(0,f.uZ)(Q,new f.bv(0),new f.bv(1));return Z.x.add(j.multiply(Z.y.subtract(Z.x)))})}}(0,x._)([(0,y.e5)(f.T8)],Y.prototype,"minMaxValueAndSize",void 0)},6127:(Wt,ct,m)=>{m.d(ct,{U:()=>b});var x=m(17626),y=m(83006),f=m(99963);class b extends y.oo{getSizeForViewScale(X){return(0,f.wV)([(0,f.Iz)(X,this.values.first()),this.sizes.first()],[(0,f.r7)(X,this.values.last()),this.sizes.last()],[!0,()=>{const W=this.values.findIndex(j=>(0,f.tS)(j,X)),tt=this.values.get(W),$=W.subtract(1),Z=this.values.get($),Q=X.subtract(Z).divide(tt.subtract(Z));return(0,f.CD)(this.sizes.get($),this.sizes.get(W),Q)}])}}(0,x._)([(0,y.e5)(f.v8.ofType(f.bv,8))],b.prototype,"sizes",void 0),(0,x._)([(0,y.e5)(f.v8.ofType(f.bv,8))],b.prototype,"values",void 0)},90132:(Wt,ct,m)=>{m.d(ct,{W:()=>Y});var x=m(17626),y=m(83006),f=m(99963),b=m(75152);class Y extends y.oo{getSize(W,tt){const $=(0,f.wV)([(0,b.In)(W),tt],[(0,f.Iz)(W,this.values.first()),this.sizes.first()],[(0,f.r7)(W,this.values.last()),this.sizes.last()],[!0,()=>{const Z=this.values.findIndex(T=>(0,f.tS)(T,W)),Q=this.values.get(Z),j=Z.subtract(1),U=this.values.get(j),w=W.subtract(U).divide(Q.subtract(U));return(0,f.CD)(this.sizes.get(j),this.sizes.get(Z),w)}]);return(0,f.KJ)((0,b.In)($),tt,$)}}(0,x._)([(0,y.e5)(f.v8.ofType(f.bv,8))],Y.prototype,"sizes",void 0),(0,x._)([(0,y.e5)(f.v8.ofType(f.bv,8))],Y.prototype,"values",void 0)},81575:(Wt,ct,m)=>{m.d(ct,{V:()=>Y});var x=m(17626),y=m(83006),f=m(99963),b=m(75152);class Y extends y.oo{getSize(W,tt){return(0,f.KJ)((0,b.In)(W),tt,W.multiply(this.unitValueToPixelsRatio))}}(0,x._)([(0,y.e5)(f.bv)],Y.prototype,"unitValueToPixelsRatio",void 0)},36519:(Wt,ct,m)=>{var x,Ot;m.d(ct,{$r:()=>yt,Ay:()=>tt,B7:()=>At,GS:()=>H,Ho:()=>v,Ke:()=>w,MO:()=>x,T5:()=>O,Ux:()=>vt,V_:()=>U,WD:()=>pt,Wq:()=>B,ad:()=>wt,e4:()=>f,i6:()=>V,k9:()=>nt,mL:()=>Bt,nF:()=>y,nU:()=>W,oy:()=>_t,xp:()=>$}),(Ot=x||(x={}))[Ot.Geographic=0]="Geographic",Ot[Ot.Arithmatic=1]="Arithmatic";const y=3.14159265359/180,f=3.14159265359/128,W=1,tt=1.1,$=1,U=24,w=8,v=1e-5,O=.05,nt=1e-30,H=4,pt=0,vt=2,_t=5,V=6,B=2,At=3,Bt=0,yt=3,wt=16777216},95936:(Wt,ct,m)=>{m.d(ct,{CC:()=>Q,Oz:()=>Z,P0:()=>$,XM:()=>j,bA:()=>Y,hF:()=>W,lD:()=>X});var x=m(99963),y=m(36519),f=m(75152);function Y(U,w,T){const v=T.subtract(w),O=function b(U,w){return(0,x.AK)(U,(0,x.Fv)(w))}(U.subtract(w),v),L=(0,x.uZ)(O.divide((0,x.kE)(v)),new x.bv(0),new x.bv(1));return(0,x.TE)(U,w.add(L.multiply(T.subtract(w))))}function X(U){const w=(0,x.Wn)(U);return(0,x.Nb)(w.x.add(w.y).add(w.z),new x.bv(1.05))}function W(U,w,T,v){const O=new x.Tu(T.x.multiply(v.y).subtract(v.x.multiply(T.y)),v.x.multiply(w.y).subtract(w.x.multiply(v.y)),w.x.multiply(T.y).subtract(T.x.multiply(w.y)),T.y.subtract(v.y),v.y.subtract(w.y),w.y.subtract(T.y),v.x.subtract(T.x),w.x.subtract(v.x),T.x.subtract(w.x)),L=w.x.multiply(T.y.subtract(v.y)),G=T.x.multiply(v.y.subtract(w.y)),rt=v.x.multiply(w.y.subtract(T.y)),J=L.add(G).add(rt);return new x.bv(1).divide(J).multiply(O.multiply(new x.AO(1,U)))}function tt(U,w,T,v){return(0,x.ln)(X(W(U,w,T,v)),new x.bv(1))}function $(U,w,T,v){const O=T.subtract(w),L=v.subtract(w),G=(0,f.xQ)(O,L),rt=(0,x.xD)((0,x.Qj)(G,new x.bv(y.T5)),(0,x.tS)(G,new x.bv(-y.T5)));return(0,x.wV)([(0,x.xD)((0,x.ff)(rt),tt(U.xy,w,T,v)),new x.bv(-1)],[!0,()=>{const J=Y(U,w,T),A=Y(U,T,v),nt=Y(U,v,w);return(0,x.VV)((0,x.VV)(J,A),nt)}])}function Z(U){return U.distance.add(1)}function Q(U,w,T){const{viewMat3:v,tileMat3:O}=U.view,L=v.multiply(O),G=L.multiply(new x.AO(w.pos,1)),rt=L.multiply(new x.AO(T.nextPos1,1)),J=L.multiply(new x.AO(T.nextPos2,1));return $(U.hittestRequest.position,G.xy,rt.xy,J.xy)}function j(U,w,T){return(0,x.TE)(U,T).subtract(w)}},75152:(Wt,ct,m)=>{m.d(ct,{In:()=>Y,JH:()=>w,TN:()=>b,Wv:()=>U,X3:()=>T,bG:()=>Q,h7:()=>Z,hG:()=>j,pK:()=>tt,qD:()=>$,xQ:()=>W});var x=m(72571),y=m(99963),f=m(36519);function b(v){const O=(0,y.fz)(12.9898),L=(0,y.fz)(78.233),G=(0,y.fz)(43758.5453),rt=(0,y.AK)(v,(0,y.K4)(O,L)),J=(0,y.wQ)(rt,(0,y.fz)(3.14));return(0,y.ZI)((0,y.O$)(J).multiply(G))}function Y(v){return(0,y.ln)(v,(0,y.fz)(f.k9))}function W(v,O){return v.x.multiply(O.y).subtract(O.x.multiply(v.y))}function tt(v){return v.multiply(2).subtract(1)}function $(v,O){const L=(0,y.fz)(2**O);return(0,y.wQ)((0,y.GW)(v.divide(L)),(0,y.fz)(2))}function Z(v,O){return(0,y.tS)($(v,O),(0,y.fz)(.5))}function Q(v,O){return $(v,O+x.Oo.length)}function j(v,O){return $(v,O)}function U(v){const O=$(v.z,7),L=(0,y.fz)(1).subtract(O),G=v.xyz.subtract((0,y.R3)(0,0,(0,y.fz)(128)));return L.multiply(v).add(O.multiply(G))}function w(v){const O=(0,y.vh)(.99609375,.0038909912109375,1519918441772461e-20,5.9371814131736755e-8);return(0,y.AK)(v,O)}function T(v){return(0,y.Fp)((0,y.Fp)((0,y.Fp)(v.x,v.y),v.z),v.w)}},30247:(Wt,ct,m)=>{m.d(ct,{H8:()=>X,Vm:()=>f,Zt:()=>b,lA:()=>y,sY:()=>Y});var x=m(99963);function y(W){return null!=W.visualVariableSizeMinMaxValue||null!=W.visualVariableSizeScaleStops||null!=W.visualVariableSizeStops||null!=W.visualVariableSizeUnitValue}function f(W,tt,$){if(y(W)){const Z=W.storage.getSizeValue(tt);return W.visualVariableSizeMinMaxValue?.getSize(Z,$)??W.visualVariableSizeScaleStops?.getSizeForViewScale(W.view.currentScale)??W.visualVariableSizeStops?.getSize(Z,$)??W.visualVariableSizeUnitValue?.getSize(Z,$)}return $}function b(W,tt,$,Z=new x.tW(!1)){if(null==W.visualVariableColor)return $;const Q=W.storage.getColorValue(tt);return W.visualVariableColor.getColor(Q,$,Z)}function Y(W,tt){if(null==W.visualVariableOpacity)return new x.bv(1);const $=W.storage.getOpacityValue(tt);return W.visualVariableOpacity.getOpacity($)}function X(W,tt){if(null==W.visualVariableRotation)return x.Tu.identity();const $=W.storage.getRotationValue(tt);return W.visualVariableRotation.getVVRotationMat3($)}},61594:(Wt,ct,m)=>{m.d(ct,{X:()=>T});var x=m(26584),y=m(63290),f=m(94113),$=(m(4619),m(8314),m(68598),m(67969),m(85775),m(21285)),j=(m(72787),m(18952),m(87526));const U=()=>y.Z.getLogger("esri.views.2d.engine.webgl.shaderGraph.typed.TypedShaderProgram");function w(v,O,L){const G=O.length;if(G!==L){const rt=new x.Z("Invalid Uniform",`Invalid length, expected ${L} but got ${G}`,{uniformName:v,values:O});U().errorOnce(rt)}}class T{constructor(O,L,G,rt,J,A){this._program=null,this._vao=null,this._temporaryTextures=[],this.vertexShader=O,this.fragmentShader=L,this._locations=G,this._locationInfo=rt,this._uniformBindings=J,this._transformFeedbackBindings=A}destroy(){this._program&&this._program.dispose(),this.cleanupTemporaryTextures()}get locations(){return this._locations}get locationInfo(){return this._locationInfo}setUniforms(O){this._uniforms=O}cleanupTemporaryTextures(){for(const O of this._temporaryTextures)O.dispose();this._temporaryTextures=[]}bind(O){const L=this._uniforms;if(!this._program){const rt=new Map;for(const[A,nt]of this._locations)rt.set(A,nt);const J=[];for(const A of this._transformFeedbackBindings??[]){const{index:nt,propertyKey:at}=A;J[nt]=`v_${at}`}this._program=new $.$(O,this.vertexShader,this.fragmentShader,rt,new Map,J)}const G=this._program;O.useProgram(G);for(const rt of this._uniformBindings){const{shaderModulePath:J,uniformName:A,uniformType:nt,uniformArrayLength:at}=rt,H=(0,f.hS)(J,L);if(null==H){if("sampler2D"===nt)continue;throw new Error(`Failed to find uniform value for ${J}`)}switch("array"===nt?rt.uniformArrayElementType:nt){case"sampler2D":{const{unit:ht,texture:lt}=H;if(G.setUniform1i(A,ht),"type"in lt)O.bindTexture(lt,ht);else{const xt=(0,j.cU)(O,lt.descriptor,lt.data);O.bindTexture(xt,ht)}break}case"int":if(!at){G.setUniform1i(A,H);break}w(rt.uniformName,H,at),G.setUniform1iv(A,H);break;case"float":if(!at){G.setUniform1f(A,H);break}w(rt.uniformName,H,at),G.setUniform1fv(A,H);break;case"vec2":if(!at){G.setUniform2f(A,H[0],H[1]);break}w(rt.uniformName,H,at),G.setUniform2fv(A,H.flat());break;case"vec3":if(!at){G.setUniform3f(A,H[0],H[1],H[2]);break}w(rt.uniformName,H,at),G.setUniform3fv(A,H.flat());break;case"vec4":if(!at){G.setUniform4f(A,H[0],H[1],H[2],H[3]);break}w(rt.uniformName,H,at),G.setUniform4fv(A,H.flat());break;case"mat3":G.setUniformMatrix3fv(A,H.flat());break;case"mat4":G.setUniformMatrix4fv(A,H.flat());break;default:throw new Error(`Unable to set uniform for type ${nt}`)}}}}},25596:(Wt,ct,m)=>{m.d(ct,{x:()=>Q});var x=m(17626),y=m(83761),f=m(8314),b=m(88634),Y=m(32917),X=m(77712),$=(m(63290),m(4619),m(76898)),Z=m(11426);let Q=class extends y.Z{constructor(j){super(j),this.debugName="",this._updatingHandles=new Z.R,this._idToUpdatingState=new b.Z}get updating(){const j=this._updatingHandles.updating||Array.from(this._idToUpdatingState.values()).some(U=>U);if((0,f.Z)("esri-2d-log-updating")){const U=Array.from(this._idToUpdatingState.entries()).map(([w,T])=>`-> ${w}: ${T}`).join("\n");console.log(`${this.debugName}: Updating: ${j}\n-> Handles: ${this._updatingHandles.updating}\n${U}`)}return j}addUpdateTracking(j,U){const w=(0,Y.YP)(()=>U.updating,T=>this._idToUpdatingState.set(j,T),{sync:!0});this.addHandles(w)}addPromise(j){return this._updatingHandles.addPromise(j)}};(0,x._)([(0,X.Cb)({constructOnly:!0})],Q.prototype,"debugName",void 0),(0,x._)([(0,X.Cb)({readOnly:!0})],Q.prototype,"updating",null),Q=(0,x._)([(0,$.j)("esri.view.2d.layers.support.UpdateTracking2D")],Q)}}]);