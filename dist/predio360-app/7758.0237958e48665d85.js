"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[7758],{73771:(Ve,fe,m)=>{m.d(fe,{q:()=>ut});var F=m(15861),ve=m(85931),B=m(26584),Ie=m(86810),Q=m(58817),k=m(62208),Re=m(1036),L=m(10699),Se=m(16730),Ee=m(55915),pe=m(5548),le=m(65401),Qe=m(32442),ye=m(91179),ie=m(93555),X=m(37053),be=m(82054),Ae=m(93961),we=m(80774),Ce=m(85);const ge=new class Me{constructor(t,i){this._cache=new Ae.z(t),this._invalidCache=new Ae.z(i)}get(t,i){const s=`${i.uid}:${t}`,r=this._cache.get(s);if(r)return r;if(null!=this._invalidCache.get(s))return null;try{const n=we.WhereClause.create(t,i);return this._cache.put(s,n),n}catch(n){return this._invalidCache.put(s,n),null}}getError(t,i){return this._invalidCache.get(`${i.uid}:${t}`)??null}}(50,500),xe="unsupported-query",ze=" as ",Ne=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeBigInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong"]),Ge=new Set(["esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]),je=new Set(["esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...Ne,...Ge]);function De(f,t,i={}){const s=ne(t,f);if(!s){const n=ge.getError(t,f);throw new B.Z(xe,"invalid SQL expression",{expression:t,error:n})}const r=i.expressionName||"expression";if(i.validateStandardized&&!s.isStandardized)throw new B.Z(xe,`${r} is not standard`,{expression:t});if(i.validateAggregate&&!s.isAggregate)throw new B.Z(xe,`${r} does not contain a valid aggregate function`,{expression:t});return s.fieldNames}function ne(f,t){return f?ge.get(f,t):null}function $e(f){return/\((.*?)\)/.test(f)?f:f.split(ze)[0]}function y(f,t,i,s={}){const r=new Map;if(function T(f,t,i,s,r){const n=r.includes("*")?[...i,...r.filter(l=>"*"!==l)]:r;for(const l of n)if(t.get(l))M(f,t,i,s,l);else try{const o=De(t,$e(l),{validateStandardized:!0});for(const c of o)M(f,t,i,s,c)}catch(o){f.set(l,{type:"expression-error",expression:l,error:o})}}(r,f,t,s.allowedFieldTypes??je,i),r.size)throw new B.Z(xe,`${s.expressionName??"expression"} contains invalid or missing fields`,{errors:Array.from(r.values()),query:s.query})}function M(f,t,i,s,r){const n=t.get(r);n?i.has(n.name)?"all"!==s&&!1===s?.has(n.type)&&f.set(r,{type:"invalid-type",fieldName:n.name,fieldType:Ce.v.fromJSON(n.type),allowedFieldTypes:Array.from(s,l=>Ce.v.fromJSON(l))}):f.set(r,{type:"missing-field",fieldName:n.name}):f.set(r,{type:"invalid-field",fieldName:r})}var I=m(16983),P=m(82959),W=m(87757),j=m(27105),ee=m(15176),U=m(7848),w=m(90194),H=m(29466),C=m(26072),K=m(46679);class te{constructor(t,i,s){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=t.returnDistinctValues??!1,this.fieldsIndex=s,this.featureAdapter=i;const r=t.outFields;if(r&&!r.includes("*")){this.outFields=r;let n=0;for(const l of r){const o=$e(l),c=this.fieldsIndex.get(o),d=c?null:ne(o,s),h=c?c.name:l.split(ze)[1]||"FIELD_EXP_"+n++;this._fieldDataCache.set(l,{alias:h,clause:d})}}}countDistinctValues(t){return this.returnDistinctValues?(t.forEach(i=>this.getAttributes(i)),this._returnDistinctMap.size):t.length}getAttributes(t){const i=this._processAttributesForOutFields(t);return this._processAttributesForDistinctValues(i)}getFieldValue(t,i,s){const r=s?s.name:i;let n=null;return this._fieldDataCache.has(r)?n=this._fieldDataCache.get(r)?.clause:s||(n=ne(i,this.fieldsIndex),this._fieldDataCache.set(r,{alias:r,clause:n})),s?this.featureAdapter.getAttribute(t,r):n?.calculateValue(t,this.featureAdapter)}getDataValues(t,i,s=!0){const r=i.normalizationType,n=i.normalizationTotal,l=this.fieldsIndex.get(i.field),o=(0,w.UQ)(l)||(0,w.ig)(l),c=(0,w.sX)(l);return t.map(d=>{let h=i.field&&this.getFieldValue(d,i.field,this.fieldsIndex.get(i.field));if(i.field2?(h=`${(0,C.wk)(h)}${i.fieldDelimiter}${(0,C.wk)(this.getFieldValue(d,i.field2,this.fieldsIndex.get(i.field2)))}`,i.field3&&(h=`${h}${i.fieldDelimiter}${(0,C.wk)(this.getFieldValue(d,i.field3,this.fieldsIndex.get(i.field3)))}`)):"string"==typeof h&&s&&(o?h=h?new Date(h).getTime():null:c&&(h=h?(0,H.yO)(h):null)),r&&Number.isFinite(h)){const p="field"===r&&i.normalizationField?this.getFieldValue(d,i.normalizationField,this.fieldsIndex.get(i.normalizationField)):null;h=(0,C.fk)(h,r,p,n)}return h})}getExpressionValues(t,i,s,r,n){var l=this;return(0,F.Z)(function*(){const{arcadeUtils:o}=yield(0,K.LC)(),c=o.hasGeometryOperations(i);c&&(yield o.enableGeometryOperations());const d=o.createFunction(i),h=o.getViewInfo(s),p={fields:l.fieldsIndex.fields};return t.map(g=>{const E={attributes:l.featureAdapter.getAttributes(g),layer:p,geometry:c?{...(0,I.Op)(r.geometryType,r.hasZ,r.hasM,l.featureAdapter.getGeometry(g)),spatialReference:s?.spatialReference}:null},v=o.createExecContext(E,h,n);return o.executeFunction(d,v)})})()}validateItem(t,i){return this._fieldDataCache.has(i)||this._fieldDataCache.set(i,{alias:i,clause:ne(i,this.fieldsIndex)}),this._fieldDataCache.get(i)?.clause?.testFeature(t,this.featureAdapter)??!1}validateItems(t,i){return this._fieldDataCache.has(i)||this._fieldDataCache.set(i,{alias:i,clause:ne(i,this.fieldsIndex)}),this._fieldDataCache.get(i)?.clause?.testSet(t,this.featureAdapter)??!1}_processAttributesForOutFields(t){const i=this.outFields;if(!i?.length)return this.featureAdapter.getAttributes(t);const s={};for(const r of i){const{alias:n,clause:l}=this._fieldDataCache.get(r);s[n]=l?l.calculateValue(t,this.featureAdapter):this.featureAdapter.getAttribute(t,n)}return s}_processAttributesForDistinctValues(t){if(null==t||!this.returnDistinctValues)return t;const i=this.outFields,s=[];if(i)for(const l of i){const{alias:o}=this._fieldDataCache.get(l);s.push(t[o])}else for(const l in t)s.push(t[l]);const r=`${(i||["*"]).join(",")}=${s.join(",")}`;let n=this._returnDistinctMap.get(r)||0;return this._returnDistinctMap.set(r,++n),n>1?null:t}}var he=m(82141);class G{constructor(t,i,s){this.items=t,this.query=i,this.geometryType=s.geometryType,this.hasM=s.hasM,this.hasZ=s.hasZ,this.fieldsIndex=s.fieldsIndex,this.objectIdField=s.objectIdField,this.spatialReference=s.spatialReference,this.featureAdapter=s.featureAdapter}get size(){return this.items.length}createQueryResponseForCount(){const t=new te(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return t.countDistinctValues(this.items);const{groupByFieldsForStatistics:i,having:s,outStatistics:r}=this.query;if(!i?.length)return 1;const l=new Map,o=new Map,c=new Set;for(const d of r){const{statisticType:h}=d,p="exceedslimit"!==h?d.onStatisticField:void 0;if(!o.has(p)){const E=[];for(const v of i){const S=this._getAttributeValues(t,v,l);E.push(S)}o.set(p,this._calculateUniqueValues(E,t.returnDistinctValues))}const g=o.get(p);for(const E in g){const{data:v,items:S}=g[E],_=v.join(",");s&&!t.validateItems(S,s)||c.add(_)}}return c.size}createQueryResponse(){var t=this;return(0,F.Z)(function*(){let i;if(i=t.query.outStatistics?t.query.outStatistics.some(s=>"exceedslimit"===s.statisticType)?t._createExceedsLimitQueryResponse(t.query):yield t._createStatisticsQueryResponse(t.query):t._createFeatureQueryResponse(t.query),t.query.returnQueryGeometry){const s=t.query.geometry;i.queryGeometry=(0,X.JY)(t.query.outSR)&&!(0,X.fS)(s.spatialReference,t.query.outSR)?(0,I.S2)({spatialReference:t.query.outSR,...(0,P.iV)(s,s.spatialReference,t.query.outSR)}):(0,I.S2)({spatialReference:t.query.outSR,...s})}return i})()}createSnappingResponse(t,i){const s=this.featureAdapter,r=se(this.hasZ,this.hasM),{point:n,mode:l}=t,o="number"==typeof t.distance?t.distance:t.distance.x,c="number"==typeof t.distance?t.distance:t.distance.y,d={candidates:[]},h="esriGeometryPolygon"===this.geometryType,p=this._getPointCreator(l,this.spatialReference,i),g=new re(null,0),E=new re(null,0),v={x:0,y:0,z:0};for(const S of this.items){const _=s.getGeometry(S);if(null==_)continue;const{coords:D,lengths:N}=_;if(g.coords=D,E.coords=D,t.returnEdge){let b=0;for(let V=0;V<N.length;V++){const R=N[V];for(let A=0;A<R;A++,b+=r){const O=g;if(O.coordsIndex=b,A!==R-1){const Z=E;Z.coordsIndex=b+r;const q=v;oe(v,n,O,Z);const ue=(n.x-q.x)/o,me=(n.y-q.y)/c,Oe=ue*ue+me*me;Oe<=1&&d.candidates.push((0,he.p)(s.getObjectId(S),p(q),Math.sqrt(Oe),p(O),p(Z)))}}}}if("none"!==t.vertexMode){const b=h?D.length-r:D.length;if("all"===t.vertexMode)for(let V=0;V<b;V+=r){const R=g;R.coordsIndex=V;const A=(n.x-R.x)/o,O=(n.y-R.y)/c,Z=A*A+O*O;Z<=1&&d.candidates.push((0,he.u)(s.getObjectId(S),p(R),Math.sqrt(Z)))}else if("ends"===t.vertexMode){const V=[0];h||V.push(D.length-r);for(const R of V){const A=g;A.coordsIndex=R;const O=(n.x-A.x)/o,Z=(n.y-A.y)/c,q=O*O+Z*Z;q<=1&&d.candidates.push((0,he.u)(s.getObjectId(S),p(A),Math.sqrt(q)))}}}}return d.candidates.sort((S,_)=>S.distance-_.distance),d}_getPointCreator(t,i,s){const r=null==s||(0,X.fS)(i,s)?o=>o:o=>(0,P.iV)(o,i,s),{hasZ:n}=this;return"3d"===t?n?({x:o,y:c,z:d})=>r({x:o,y:c,z:d}):({x:o,y:c})=>r({x:o,y:c,z:0}):({x:o,y:c})=>r({x:o,y:c})}createSummaryStatisticsResponse(t){var i=this;return(0,F.Z)(function*(){const{field:s,valueExpression:r,normalizationField:n,normalizationType:l,normalizationTotal:o,minValue:c,maxValue:d,scale:h,timeZone:p}=t,g=i.fieldsIndex.get(s),E=(0,w.y2)(g)||(0,w.UQ)(g)||(0,w.ig)(g),v=yield i._getDataValues({field:s,valueExpression:r,normalizationField:n,normalizationType:l,normalizationTotal:o,scale:h,timeZone:p}),S=(0,C.S5)({normalizationType:l,normalizationField:n,minValue:c,maxValue:d}),_={value:.5,fieldType:g?.type},D=(0,w.qN)(g)?(0,C.H0)({values:v,supportsNullCount:S,percentileParams:_}):(0,C.i5)({values:v,minValue:c,maxValue:d,useSampleStdDev:!l,supportsNullCount:S,percentileParams:_});return(0,C.F_)(D,E)})()}createUniqueValuesResponse(t){var i=this;return(0,F.Z)(function*(){const{field:s,valueExpression:r,domains:n,returnAllCodedValues:l,scale:o,timeZone:c}=t,d=yield i._getDataValues({field:s,field2:t.field2,field3:t.field3,fieldDelimiter:t.fieldDelimiter,valueExpression:r,scale:o,timeZone:c},!1),h=(0,C.eT)(d);return(0,C.Qm)(h,n,l,t.fieldDelimiter)})()}createClassBreaksResponse(t){var i=this;return(0,F.Z)(function*(){const{field:s,valueExpression:r,normalizationField:n,normalizationType:l,normalizationTotal:o,classificationMethod:c,standardDeviationInterval:d,minValue:h,maxValue:p,numClasses:g,scale:E,timeZone:v}=t,S=yield i._getDataValues({field:s,valueExpression:r,normalizationField:n,normalizationType:l,normalizationTotal:o,scale:E,timeZone:v}),_=(0,C.G2)(S,{field:s,normalizationField:n,normalizationType:l,normalizationTotal:o,classificationMethod:c,standardDeviationInterval:d,minValue:h,maxValue:p,numClasses:g});return(0,C.DL)(_,c)})()}createHistogramResponse(t){var i=this;return(0,F.Z)(function*(){const{field:s,valueExpression:r,normalizationField:n,normalizationType:l,normalizationTotal:o,classificationMethod:c,standardDeviationInterval:d,minValue:h,maxValue:p,numBins:g,scale:E,timeZone:v}=t,S=yield i._getDataValues({field:s,valueExpression:r,normalizationField:n,normalizationType:l,normalizationTotal:o,scale:E,timeZone:v});return(0,C.oF)(S,{field:s,normalizationField:n,normalizationType:l,normalizationTotal:o,classificationMethod:c,standardDeviationInterval:d,minValue:h,maxValue:p,numBins:g})})()}_sortFeatures(t,i,s){if(t.length>1&&i?.length)for(const r of i.reverse()){const n=r.split(" "),l=n[0],o=this.fieldsIndex.get(l),c=!!n[1]&&"desc"===n[1].toLowerCase(),d=(0,C.Lq)(o?.type,c);t.sort((h,p)=>{const g=s(h,l,o),E=s(p,l,o);return d(g,E)})}}_createFeatureQueryResponse(t){const i=this.items,{geometryType:s,hasM:r,hasZ:n,objectIdField:l,spatialReference:o}=this,{outFields:c,outSR:d,quantizationParameters:h,resultRecordCount:p,resultOffset:g,returnZ:E,returnM:v}=t,S=null!=p&&i.length>(g||0)+p,_=c&&(c.includes("*")?[...this.fieldsIndex.fields]:c.map(D=>this.fieldsIndex.get(D)));return{exceededTransferLimit:S,features:this._createFeatures(t,i),fields:_,geometryType:s,hasM:r&&v,hasZ:n&&E,objectIdFieldName:l,spatialReference:(0,I.S2)(d||o),transform:h&&(0,U.vY)(h)||null}}_createFeatures(t,i){const s=new te(t,this.featureAdapter,this.fieldsIndex),{hasM:r,hasZ:n}=this,{orderByFields:l,quantizationParameters:o,returnGeometry:c,returnCentroid:d,maxAllowableOffset:h,resultOffset:p,resultRecordCount:g,returnZ:E=!1,returnM:v=!1}=t,S=n&&E,_=r&&v;let D=[],N=0;const b=[...i];if(this._sortFeatures(b,l,(R,A,O)=>s.getFieldValue(R,A,O)),this.geometryType&&(c||d)){const R=(0,U.vY)(o)??void 0,A="esriGeometryPolygon"===this.geometryType||"esriGeometryPolyline"===this.geometryType;if(c&&!d)for(const O of b){const Z=this.featureAdapter.getGeometry(O),q={attributes:s.getAttributes(O),geometry:(0,I.Op)(this.geometryType,this.hasZ,this.hasM,Z,h,R,S,_)};A&&Z&&!q.geometry&&(q.centroid=(0,I.EG)(this,this.featureAdapter.getCentroid(O,this),R)),D[N++]=q}else if(!c&&d)for(const O of b)D[N++]={attributes:s.getAttributes(O),centroid:(0,I.EG)(this,this.featureAdapter.getCentroid(O,this),R)};else for(const O of b)D[N++]={attributes:s.getAttributes(O),centroid:(0,I.EG)(this,this.featureAdapter.getCentroid(O,this),R),geometry:(0,I.Op)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(O),h,R,S,_)}}else for(const R of b){const A=s.getAttributes(R);A&&(D[N++]={attributes:A})}const V=p||0;return null!=g&&(D=D.slice(V,Math.min(D.length,V+g))),D}_createExceedsLimitQueryResponse(t){let i=!1,s=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY;for(const l of t.outStatistics??[])if("exceedslimit"===l.statisticType){s=null!=l.maxPointCount?l.maxPointCount:Number.POSITIVE_INFINITY,r=null!=l.maxRecordCount?l.maxRecordCount:Number.POSITIVE_INFINITY,n=null!=l.maxVertexCount?l.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)i=this.items.length>s;else if(this.items.length>r)i=!0;else{const l=se(this.hasZ,this.hasM),o=this.featureAdapter;i=this.items.reduce((c,d)=>{const h=o.getGeometry(d);return c+(null!=h&&h.coords.length||0)},0)/l>n}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(i)}}]}}_createStatisticsQueryResponse(t){var i=this;return(0,F.Z)(function*(){const s={attributes:{}},r=[],n=new Map,l=new Map,o=new Map,c=new Map,d=new te(t,i.featureAdapter,i.fieldsIndex),h=t.outStatistics,{groupByFieldsForStatistics:p,having:g,orderByFields:E,resultRecordCount:v}=t,S=p?.length,_=!!S,D=_?p[0]:null,N=_&&!i.fieldsIndex.get(D);for(const V of h??[]){const{outStatisticFieldName:R,statisticType:A}=V,O=V,Z="exceedslimit"!==A?V.onStatisticField:void 0,q="percentile_disc"===A||"percentile_cont"===A,ue="EnvelopeAggregate"===A||"CentroidAggregate"===A||"ConvexHullAggregate"===A,me=_&&1===S&&(Z===D||N)&&"count"===A;if(_){if(!o.has(Z)){const Pe=[];for(const He of p){const Ze=i._getAttributeValues(d,He,n);Pe.push(Ze)}o.set(Z,i._calculateUniqueValues(Pe,!ue&&d.returnDistinctValues))}const ce=o.get(Z);if(!ce)continue;const qe=Object.keys(ce);for(const Pe of qe){const{count:He,data:Ze,items:Xe,itemPositions:ct}=ce[Pe],ke=Ze.join(",");if(!g||d.validateItems(Xe,g)){const _e=c.get(ke)||{attributes:{}};if(ue){_e.aggregateGeometries||(_e.aggregateGeometries={});const{aggregateGeometries:de,outStatisticFieldName:Te}=yield i._getAggregateGeometry(O,Xe);_e.aggregateGeometries[Te]=de}else{let de=null;if(me)de=He;else{const Te=i._getAttributeValues(d,Z,n),et=ct.map(ft=>Te[ft]);de=q&&"statisticParameters"in O?i._getPercentileValue(O,et):i._getStatisticValue(O,et,null,d.returnDistinctValues)}_e.attributes[R]=de}let dt=0;p.forEach((de,Te)=>_e.attributes[i.fieldsIndex.get(de)?de:"EXPR_"+ ++dt]=Ze[Te]),c.set(ke,_e)}}}else if(ue){s.aggregateGeometries||(s.aggregateGeometries={});const{aggregateGeometries:ce,outStatisticFieldName:qe}=yield i._getAggregateGeometry(O,i.items);s.aggregateGeometries[qe]=ce}else{const ce=i._getAttributeValues(d,Z,n);s.attributes[R]=q&&"statisticParameters"in O?i._getPercentileValue(O,ce):i._getStatisticValue(O,ce,l,d.returnDistinctValues)}const Oe="min"!==A&&"max"!==A||!(0,w.qN)(i.fieldsIndex.get(Z))&&!i._isAnyDateField(Z)?null:i.fieldsIndex.get(Z)?.type;r.push({name:R,alias:R,type:Oe||"esriFieldTypeDouble"})}const b=_?Array.from(c.values()):[s];return i._sortFeatures(b,E,(V,R)=>V.attributes[R]),v&&(b.length=Math.min(v,b.length)),{fields:r,features:b}})()}_isAnyDateField(t){const i=this.fieldsIndex.get(t);return(0,w.y2)(i)||(0,w.UQ)(i)||(0,w.ig)(i)||(0,w.sX)(i)}_getAggregateGeometry(t,i){var s=this;return(0,F.Z)(function*(){const{convexHull:r,union:n}=yield Promise.all([m.e(4918),m.e(8592)]).then(m.bind(m,32825)),{statisticType:l,outStatisticFieldName:o}=t,{featureAdapter:c,spatialReference:d,geometryType:h,hasZ:p,hasM:g}=s,E=i.map(_=>(0,I.Op)(h,p,g,c.getGeometry(_))),v=r(d,E,!0)[0],S={aggregateGeometries:null,outStatisticFieldName:null};if("EnvelopeAggregate"===l){const _=v?(0,ee._w)(v):(0,ee.aO)(n(d,E));S.aggregateGeometries={..._,spatialReference:d},S.outStatisticFieldName=o||"extent"}else if("CentroidAggregate"===l){const _=v?(0,j.tO)(v):(0,j.$G)((0,ee.aO)(n(d,E)));S.aggregateGeometries={x:_[0],y:_[1],spatialReference:d},S.outStatisticFieldName=o||"centroid"}else"ConvexHullAggregate"===l&&(S.aggregateGeometries=v,S.outStatisticFieldName=o||"convexHull");return S})()}_getStatisticValue(t,i,s,r){const{onStatisticField:n,statisticType:l}=t;let o=null;return o=s?.has(n)?s.get(n):(0,w.qN)(this.fieldsIndex.get(n))||this._isAnyDateField(n)?(0,C.H0)({values:i,returnDistinct:r}):(0,C.i5)({values:r?[...new Set(i)]:i,minValue:null,maxValue:null,useSampleStdDev:!0}),s&&s.set(n,o),o["var"===l?"variance":l]}_getPercentileValue(t,i){const{onStatisticField:s,statisticParameters:r,statisticType:n}=t,{value:l,orderBy:o}=r,c=this.fieldsIndex.get(s);return(0,C.XL)(i,{value:l,orderBy:o,fieldType:c?.type,isDiscrete:"percentile_disc"===n})}_getAttributeValues(t,i,s){if(s.has(i))return s.get(i);const r=this.fieldsIndex.get(i),n=this.items.map(l=>t.getFieldValue(l,i,r));return s.set(i,n),n}_calculateUniqueValues(t,i){const s={},r=this.items,n=r.length;for(let l=0;l<n;l++){const o=r[l],c=[];for(const h of t)c.push(h[l]);const d=c.join(",");null==s[d]?s[d]={count:1,data:c,items:[o],itemPositions:[l]}:(i||s[d].count++,s[d].items.push(o),s[d].itemPositions.push(l))}return s}_getDataValues(t,i=!0){var s=this;return(0,F.Z)(function*(){const r=new te(s.query,s.featureAdapter,s.fieldsIndex),{valueExpression:n,scale:l,timeZone:o}=t;return n?r.getExpressionValues(s.items,n,{viewingMode:"map",scale:l,spatialReference:s.query.outSR||s.spatialReference},{geometryType:s.geometryType,hasZ:s.hasZ,hasM:s.hasM},o):r.getDataValues(s.items,(0,Q.d9)(t),i)})()}}function oe(f,t,i,s){const r=s.x-i.x,n=s.y-i.y,c=Math.min(1,Math.max(0,((t.x-i.x)*r+(t.y-i.y)*n)/(r*r+n*n)));f.x=i.x+r*c,f.y=i.y+n*c}function se(f,t){return f?t?4:3:t?3:2}class re{constructor(t,i){this.coords=t,this.coordsIndex=i}get x(){return this.coords[this.coordsIndex]}get y(){return this.coords[this.coordsIndex+1]}get z(){return this.coords[this.coordsIndex+2]}}var Y=m(56541),J=m(53023);const $="unsupported-query";function ae(f,t){return z.apply(this,arguments)}function z(){return(z=(0,F.Z)(function*(f,{fieldsIndex:t,geometryType:i,spatialReference:s,availableFields:r}){if((f.distance??0)<0||null!=f.geometryPrecision||f.multipatchOption&&"xyFootprint"!==f.multipatchOption||f.pixelSize||f.relationParam||f.text)throw new B.Z($,"Unsupported query options",{query:f});return Fe(t,r,f),function tt(f,t,i){const{outStatistics:s,groupByFieldsForStatistics:r,having:n}=i,l=r?.length,o=s?.length;if(n){if(!l||!o)throw new B.Z($,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:i});!function Ue(f,t,i,s,r){if(!i)return!0;const n="having clause",l=De(f,i,{validateAggregate:!0,expressionName:n});if(y(f,t,l,{expressionName:n,query:r}),!ne(i,f)?.getExpressions().every(d=>{const{aggregateType:h,field:p}=d,g=f.get(p)?.name;return s.some(E=>{const{onStatisticField:v,statisticType:S}=E;return f.get(v)?.name===g&&S.toLowerCase().trim()===h})}))throw new B.Z(xe,"expressions in having clause should also exist in outStatistics",{having:i})}(f,t,n,s,i)}if(o){if(!function rt(f){return null!=f&&f.every(t=>"exceedslimit"!==t.statisticType)}(s))return;y(f,t,s.map(d=>d.onStatisticField).filter(Boolean),{expressionName:"onStatisticFields",query:i}),l&&y(f,t,r,{expressionName:"groupByFieldsForStatistics",query:i});for(const d of s){const{onStatisticField:h,statisticType:p}=d;if("percentile_disc"!==p&&"percentile_cont"!==p||!("statisticParameters"in d))f.get(h)&&"count"!==p&&"min"!==p&&"max"!==p&&y(f,t,[h],{expressionName:`outStatistics with '${p}' statistic type`,allowedFieldTypes:Be,query:i});else{const{statisticParameters:g}=d;if(!g)throw new B.Z($,"statisticParameters should be set for percentile type",{definition:d,query:i})}}}}(t,r,f),Promise.all([(0,J.P0)(f,i,s),(0,P._W)(s,f.outSR)]).then(()=>f)})).apply(this,arguments)}function Fe(f,t,i){const{outFields:s,orderByFields:r,returnDistinctValues:n,outStatistics:l}=i,o=l?l.map(c=>c.outStatisticFieldName&&c.outStatisticFieldName.toLowerCase()).filter(Boolean):[];if(r&&r.length>0){const c=" asc",d=" desc";y(f,t,r.map(p=>{const g=p.toLowerCase();return g.includes(c)?g.split(c)[0]:g.includes(d)?g.split(d)[0]:p}).filter(p=>!o.includes(p)),{expressionName:"orderByFields",query:i})}if(s&&s.length>0)y(f,t,s,{expressionName:"outFields",query:i,allowedFieldTypes:"all"});else if(n)throw new B.Z($,"outFields should be specified for returnDistinctValues",{query:i});!function Ke(f,t,i,s){if(!i)return!0;const r="where clause";y(f,t,De(f,i,{validateStandardized:!0,expressionName:r}),{expressionName:r,query:s})}(f,t,i.where,i)}const Be=new Set([...Ne,...Ge]);function Le(){return(Le=(0,F.Z)(function*(f,t,{fieldsIndex:i,geometryType:s,spatialReference:r,availableFields:n}){if((f.distance??0)<0||null!=f.geometryPrecision||f.multipatchOption||f.pixelSize||f.relationParam||f.text||f.outStatistics||f.groupByFieldsForStatistics||f.having||f.orderByFields)throw new B.Z($,"Unsupported query options",{query:f});return Fe(i,n,f),Promise.all([st(i,n,t,f),(0,J.P0)(f,s,r),(0,P._W)(r,f.outSR)]).then(()=>f)})).apply(this,arguments)}function st(f,t,i,s){return We.apply(this,arguments)}function We(){return(We=(0,F.Z)(function*(f,t,i,s){let r=[];if(i.valueExpression){const{arcadeUtils:n}=yield(0,K.LC)();r=n.extractFieldNames(i.valueExpression)}if(i.field&&r.push(i.field),i.field2&&r.push(i.field2),i.field3&&r.push(i.field3),i.normalizationField&&r.push(i.normalizationField),!r.length&&!i.valueExpression)throw new B.Z($,"field or valueExpression is required",{params:i});y(f,t,r,{expressionName:"statistics",query:s})})).apply(this,arguments)}var Ye=m(76530),nt=m(60466),Je=m(87091);const lt=new Re.WJ(2e6);let ot=0;class ut{constructor(t){this._geometryQueryCache=null,this._changeHandle=null,this.capabilities={query:W.g},this.geometryType=t.geometryType,this.hasM=!!t.hasM,this.hasZ=!!t.hasZ,this.objectIdField=t.objectIdField,this.spatialReference=t.spatialReference,this.definitionExpression=t.definitionExpression,this.featureStore=t.featureStore,this.aggregateAdapter=t.aggregateAdapter,this._changeHandle=this.featureStore.events.on("changed",()=>this.clearCache()),this.timeInfo=t.timeInfo,t.cacheSpatialQueries&&(this._geometryQueryCache=new Re.Xq(ot+++"$$",lt)),this.fieldsIndex=(0,Ie.AK)(t.fieldsIndex)?t.fieldsIndex:nt.Z.fromJSON(t.fieldsIndex),this.availableFields=!t.availableFields||1===t.availableFields.length&&"*"===t.availableFields[0]?new Set(this.fieldsIndex.fields.map(i=>i.name)):new Set(t.availableFields.map(i=>this.fieldsIndex.get(i)?.name).filter(i=>null!=i)),t.scheduler&&t.priority&&(this._frameTask=t.scheduler.registerTask(t.priority))}destroy(){this._frameTask=(0,k.hw)(this._frameTask),this.clearCache(),(0,k.SC)(this._geometryQueryCache),this._changeHandle=(0,k.hw)(this._changeHandle)}get featureAdapter(){return this.featureStore.featureAdapter}clearCache(){this._geometryQueryCache?.clear(),this._allFeaturesPromise=null,this._timeExtentPromise=null,this._fullExtentPromise=null}executeQuery(t,i){var s=this;return(0,F.Z)(function*(){const r=(0,L.$h)(i);try{return(yield s._executeQuery(t,{},r)).createQueryResponse()}catch(n){if(n!==Y.Ti)throw n;return new G([],t,s).createQueryResponse()}})()}executeQueryForCount(t={},i){var s=this;return(0,F.Z)(function*(){const r=(0,L.$h)(i);try{return(yield s._executeQuery(t,{returnGeometry:!1,returnCentroid:!1,outSR:null},r)).createQueryResponseForCount()}catch(n){if(n!==Y.Ti)throw n;return 0}})()}executeQueryForExtent(t,i){var s=this;return(0,F.Z)(function*(){const r=(0,L.$h)(i),n=t.outSR;try{const l=yield s._executeQuery(t,{returnGeometry:!0,returnCentroid:!1,outSR:null},r),o=l.size;return o?{count:o,extent:yield s._getBounds(l.items,l.spatialReference,n||s.spatialReference)}:{count:0,extent:null}}catch(l){if(l===Y.Ti)return{count:0,extent:null};throw l}})()}executeQueryForIds(t,i){var s=this;return(0,F.Z)(function*(){return s.executeQueryForIdSet(t,i).then(r=>Array.from(r))})()}executeQueryForIdSet(t,i){var s=this;return(0,F.Z)(function*(){const r=(0,L.$h)(i);try{const n=yield s._executeQuery(t,{returnGeometry:!0,returnCentroid:!1,outSR:null},r),l=n.items,o=new Set;return yield s._reschedule(()=>{for(const c of l)o.add(n.featureAdapter.getObjectId(c))},r),o}catch(n){if(n===Y.Ti)return new Set;throw n}})()}executeQueryForSnapping(t,i){var s=this;return(0,F.Z)(function*(){const r=(0,L.$h)(i),{point:n,distance:l,returnEdge:o,vertexMode:c}=t;if(!o&&"none"===c)return{candidates:[]};let d=(0,Q.d9)(t.query);d=yield s._schedule(()=>(0,Y.j6)(d,s.definitionExpression,s.spatialReference),r),d=yield s._reschedule(()=>ae(d,{availableFields:s.availableFields,fieldsIndex:s.fieldsIndex,geometryType:s.geometryType,spatialReference:s.spatialReference}),r);const h=!(0,X.fS)(n.spatialReference,s.spatialReference);h&&(yield(0,P._W)(n.spatialReference,s.spatialReference));const p="number"==typeof l?l:l.x,g="number"==typeof l?l:l.y,E={xmin:n.x-p,xmax:n.x+p,ymin:n.y-g,ymax:n.y+g,spatialReference:n.spatialReference},v=h?(0,P.iV)(E,s.spatialReference):E;if(!v)return{candidates:[]};const S=(yield(0,ie.aX)((0,ye.im)(n),null,{signal:r}))[0],_=(yield(0,ie.aX)((0,ye.im)(v),null,{signal:r}))[0];if(null==S||null==_)return{candidates:[]};const D=new G(yield s._reschedule(()=>s._searchFeatures(s._getQueryBBoxes(_.toJSON())),r),d,s);yield s._reschedule(()=>s._executeObjectIdsQuery(D),r),yield s._reschedule(()=>s._executeTimeQuery(D),r),yield s._reschedule(()=>s._executeAttributesQuery(D),r),yield s._reschedule(()=>s._executeGeometryQueryForSnapping(D,r),r);const N=S.toJSON(),b=h?(0,P.iV)(N,s.spatialReference):N,V=h?Math.max(v.xmax-v.xmin,v.ymax-v.ymin)/2:l;return D.createSnappingResponse({...t,point:b,distance:V},n.spatialReference)})()}executeQueryForLatestObservations(t,i){var s=this;return(0,F.Z)(function*(){const r=(0,L.$h)(i);if(!s.timeInfo?.trackIdField)throw new B.Z("unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:t,timeInfo:s.timeInfo});try{const n=yield s._executeQuery(t,{},r);return yield s._reschedule(()=>s._filterLatest(n),r),n.createQueryResponse()}catch(n){if(n!==Y.Ti)throw n;return new G([],t,s).createQueryResponse()}})()}executeQueryForSummaryStatistics(t={},i,s){var r=this;return(0,F.Z)(function*(){const n=(0,L.$h)(s),{field:l,normalizationField:o,valueExpression:c}=i;return(yield r._executeQueryForStatistics(t,{field:l,normalizationField:o,valueExpression:c},n)).createSummaryStatisticsResponse(i)})()}executeQueryForUniqueValues(t={},i,s){var r=this;return(0,F.Z)(function*(){const n=(0,L.$h)(s),{field:l,field2:o,field3:c,valueExpression:d}=i;return(yield r._executeQueryForStatistics(t,{field:l,field2:o,field3:c,valueExpression:d},n)).createUniqueValuesResponse(i)})()}executeQueryForClassBreaks(t={},i,s){var r=this;return(0,F.Z)(function*(){const n=(0,L.$h)(s),{field:l,normalizationField:o,valueExpression:c}=i;return(yield r._executeQueryForStatistics(t,{field:l,normalizationField:o,valueExpression:c},n)).createClassBreaksResponse(i)})()}executeQueryForHistogram(t={},i,s){var r=this;return(0,F.Z)(function*(){const n=(0,L.$h)(s),{field:l,normalizationField:o,valueExpression:c}=i;return(yield r._executeQueryForStatistics(t,{field:l,normalizationField:o,valueExpression:c},n)).createHistogramResponse(i)})()}fetchRecomputedExtents(t){var i=this;return(0,F.Z)(function*(){const s=(0,L.$h)(t);i._timeExtentPromise||=(0,Ye.R)(i.timeInfo,i.featureStore);const[r,n]=yield Promise.all([i._getFullExtent(),i._timeExtentPromise]);return(0,L.k_)(s),{fullExtent:r,timeExtent:n}})()}_getBounds(t,i,s){var r=this;return(0,F.Z)(function*(){const n=(0,pe.t8)((0,pe.Ue)(),pe.G_);yield r.featureStore.forEachBounds(t,c=>(0,pe.TC)(n,c));const l={xmin:n[0],ymin:n[1],xmax:n[3],ymax:n[4],spatialReference:(0,I.S2)(r.spatialReference)};r.hasZ&&isFinite(n[2])&&isFinite(n[5])&&(l.zmin=n[2],l.zmax=n[5]);const o=(0,P.iV)(l,i,s);if(o.spatialReference=(0,I.S2)(s),o.xmax-o.xmin==0){const c=(0,Se.c9)(o.spatialReference);o.xmin-=c,o.xmax+=c}if(o.ymax-o.ymin==0){const c=(0,Se.c9)(o.spatialReference);o.ymin-=c,o.ymax+=c}if(r.hasZ&&null!=o.zmin&&null!=o.zmax&&o.zmax-o.zmin==0){const c=(0,Se.c9)(o.spatialReference);o.zmin-=c,o.zmax+=c}return o})()}_getFullExtent(){return this._fullExtentPromise||="getFullExtent"in this.featureStore&&this.featureStore.getFullExtent?Promise.resolve(this.featureStore.getFullExtent(this.spatialReference)):this._getAllFeatures().then(t=>this._getBounds(t,this.spatialReference,this.spatialReference)),this._fullExtentPromise}_schedule(t,i){var s=this;return(0,F.Z)(function*(){return null!=s._frameTask?s._frameTask.schedule(t,i):t(Je.G5)})()}_reschedule(t,i){var s=this;return(0,F.Z)(function*(){return null!=s._frameTask?s._frameTask.reschedule(t,i):t(Je.G5)})()}_getAllFeaturesQueryEngineResult(t){var i=this;return(0,F.Z)(function*(){return new G(yield i._getAllFeatures(),t,i)})()}_getAllFeatures(){var t=this;return(0,F.Z)(function*(){if(null==t._allFeaturesPromise){const r=[];t._allFeaturesPromise=(0,F.Z)(function*(){yield t.featureStore.forEach(n=>r.push(n))})().then(()=>r)}const i=t._allFeaturesPromise,s=yield i;return i===t._allFeaturesPromise?s.slice():t._getAllFeatures()})()}_executeQuery(t,i,s){var r=this;return(0,F.Z)(function*(){t=(0,Q.d9)(t),t=yield r._schedule(()=>(0,Y.Up)(t,r.definitionExpression,r.spatialReference),s),t=yield r._reschedule(()=>ae(t,{availableFields:r.availableFields,fieldsIndex:r.fieldsIndex,geometryType:r.geometryType,spatialReference:r.spatialReference}),s),t={...t,...i};const n=yield r._reschedule(()=>r._executeSceneFilterQuery(t,s),s),l=yield r._reschedule(()=>r._executeGeometryQuery(t,n,s),s);return yield r._reschedule(()=>r._executeAggregateIdsQuery(l),s),yield r._reschedule(()=>r._executeObjectIdsQuery(l),s),yield r._reschedule(()=>r._executeTimeQuery(l),s),yield r._reschedule(()=>r._executeAttributesQuery(l),s),l})()}_executeSceneFilterQuery(t,i){var s=this;return(0,F.Z)(function*(){if(null==t.sceneFilter)return null;const{outSR:r,returnGeometry:n,returnCentroid:l}=t,o=s.featureStore.featureSpatialReference,c=t.sceneFilter.geometry,d=null==o||(0,X.fS)(o,c.spatialReference)?c:(0,P.iV)(c,o);if(!d)return null;const h=n||l,p=(0,X.JY)(r)&&!(0,X.fS)(s.spatialReference,r)&&h?function(){var _=(0,F.Z)(function*(D){return s._project(D,r)});return function(D){return _.apply(this,arguments)}}():_=>_,g=s.featureAdapter,E=yield s._reschedule(()=>s._searchFeatures(s._getQueryBBoxes(d)),i);if("disjoint"===t.sceneFilter.spatialRelationship){if(!E.length)return null;const _=new Set;for(const b of E)_.add(g.getObjectId(b));const D=yield s._reschedule(()=>s._getAllFeatures(),i);return p(yield s._reschedule((0,F.Z)(function*(){const b=yield(0,J.cW)("esriSpatialRelDisjoint",d,s.geometryType,s.hasZ,s.hasM),R=yield s._runSpatialFilter(D,A=>!_.has(g.getObjectId(A))||b(g.getGeometry(A)),i);return new G(R,t,s)}),i))}if(!E.length)return new G([],t,s);if(s._canExecuteSinglePass(d,t))return p(new G(E,t,s));const v=yield(0,J.cW)("esriSpatialRelContains",d,s.geometryType,s.hasZ,s.hasM),S=yield s._runSpatialFilter(E,_=>v(g.getGeometry(_)),i);return p(new G(S,t,s))})()}_executeGeometryQuery(t,i,s){var r=this;return(0,F.Z)(function*(){if(null!=i&&0===i.items.length)return i;t=null!=i?i.query:t;const{geometry:n,outSR:l,spatialRel:o,returnGeometry:c,returnCentroid:d}=t,h=r.featureStore.featureSpatialReference,p=!n||null==h||(0,X.fS)(h,n.spatialReference)?n:(0,P.iV)(n,h),g=c||d,E=(0,X.JY)(l)&&!(0,X.fS)(r.spatialReference,l),v=r._geometryQueryCache&&null==i?JSON.stringify(E&&g?{originalFilterGeometry:n,spatialRelationship:o,outSpatialReference:l}:{originalFilterGeometry:n,spatialRelationship:o}):null,S=v?r._geometryQueryCache.get(v):null;if(null!=S)return new G(S,t,r);const _=function(){var R=(0,F.Z)(function*(A){return E&&g&&(yield r._project(A,l)),v&&r._geometryQueryCache.put(v,A.items,A.items.length+1),A});return function(O){return R.apply(this,arguments)}}();if(!p)return _(i??(yield r._getAllFeaturesQueryEngineResult(t)));const D=r.featureAdapter;let N=yield r._reschedule(()=>r._searchFeatures(r._getQueryBBoxes(n)),s);if("esriSpatialRelDisjoint"===o){if(!N.length)return _(i??(yield r._getAllFeaturesQueryEngineResult(t)));const R=new Set;for(const Z of N)R.add(D.getObjectId(Z));const A=null!=i?i.items:yield r._reschedule(()=>r._getAllFeatures(),s);return _(yield r._reschedule((0,F.Z)(function*(){const Z=yield(0,J.cW)(o,p,r.geometryType,r.hasZ,r.hasM),ue=yield r._runSpatialFilter(A,me=>!R.has(D.getObjectId(me))||Z(D.getGeometry(me)),s);return new G(ue,t,r)}),s))}if(null!=i){const R=new ve.SO;N=N.filter(A=>(0,ve.cq)(i.items,A,i.items.length,R)>=0)}if(!N.length){const R=new G([],t,r);return v&&r._geometryQueryCache.put(v,R.items,1),R}if(r._canExecuteSinglePass(p,t))return _(new G(N,t,r));const b=yield(0,J.cW)(o,p,r.geometryType,r.hasZ,r.hasM),V=yield r._runSpatialFilter(N,R=>b(D.getGeometry(R)),s);return _(new G(V,t,r))})()}_executeGeometryQueryForSnapping(t,i){var s=this;return(0,F.Z)(function*(){const{query:r}=t,{spatialRel:n}=r;if(!t?.items?.length||!r.geometry||!n)return;const l=yield(0,J.cW)(n,r.geometry,s.geometryType,s.hasZ,s.hasM),o=yield s._runSpatialFilter(t.items,c=>l(c.geometry),i);t.items=o})()}_executeAggregateIdsQuery(t){if(0===t.items.length||!t.query.aggregateIds?.length||null==this.aggregateAdapter)return;const i=new Set;for(const r of t.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(r).forEach(n=>i.add(n));const s=this.featureAdapter.getObjectId;t.items=t.items.filter(r=>i.has(s(r)))}_executeObjectIdsQuery(t){if(0===t.items.length||!t.query.objectIds?.length)return;const i=new Set(t.query.objectIds),s=this.featureAdapter.getObjectId;t.items=t.items.filter(r=>i.has(s(r)))}_executeTimeQuery(t){if(0===t.items.length)return;const i=(0,Ye.y)(this.timeInfo,t.query.timeExtent,this.featureAdapter);null!=i&&(t.items=t.items.filter(i))}_executeAttributesQuery(t){if(0===t.items.length)return;const i=ne(t.query.where,this.fieldsIndex);if(i){if(!i.isStandardized)throw new TypeError("Where clause is not standardized");t.items=t.items.filter(s=>i.testFeature(s,this.featureAdapter))}}_runSpatialFilter(t,i,s){var r=this;return(0,F.Z)(function*(){if(!i)return t;if(null==r._frameTask)return t.filter(c=>i(c));let n=0;const l=new Array,o=function(){var c=(0,F.Z)(function*(d){for(;n<t.length;){const h=t[n++];i(h)&&(l.push(h),d.madeProgress()),d.done&&(yield r._reschedule(p=>o(p),s))}});return function(h){return c.apply(this,arguments)}}();return r._reschedule(c=>o(c),s).then(()=>l)})()}_filterLatest(t){const{trackIdField:i,startTimeField:s,endTimeField:r}=this.timeInfo,n=r||s,l=new Map,o=this.featureAdapter.getAttribute;for(const c of t.items){const d=o(c,i),h=o(c,n),p=l.get(d);(!p||h>o(p,n))&&l.set(d,c)}t.items=Array.from(l.values())}_canExecuteSinglePass(t,i){const{spatialRel:s}=i;return(0,J.hN)(t)&&("esriSpatialRelEnvelopeIntersects"===s||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===s||"esriSpatialRelContains"===s))}_project(t,i){var s=this;return(0,F.Z)(function*(){if(!i||(0,X.fS)(s.spatialReference,i))return t;const r=s.featureAdapter;let n;try{const o=yield s._getFullExtent();n=(0,Ee.getTransformation)(s.spatialReference,i,o)}catch{}const l=yield(0,P.oj)(t.items.map(o=>(0,I.Op)(s.geometryType,s.hasZ,s.hasM,r.getGeometry(o))),s.spatialReference,i,n);return t.items=l.map((o,c)=>r.cloneWithGeometry(t.items[c],(0,be.GH)(o,s.hasZ,s.hasM))),t})()}_getQueryBBoxes(t){if((0,J.hN)(t)){if((0,ye.YX)(t))return[(0,le.al)(Math.min(t.xmin,t.xmax),Math.min(t.ymin,t.ymax),Math.max(t.xmin,t.xmax),Math.max(t.ymin,t.ymax))];if((0,ye.oU)(t))return t.rings.map(i=>(0,le.al)(Math.min(i[0][0],i[2][0]),Math.min(i[0][1],i[2][1]),Math.max(i[0][0],i[2][0]),Math.max(i[0][1],i[2][1])))}return[(0,Qe.$P)((0,le.Ue)(),t)]}_searchFeatures(t){var i=this;return(0,F.Z)(function*(){const s=new Set;yield Promise.all(t.map(n=>i.featureStore.forEachInBounds(n,l=>s.add(l))));const r=Array.from(s.values());return s.clear(),r})()}_executeQueryForStatistics(t,i,s){var r=this;return(0,F.Z)(function*(){t=(0,Q.d9)(t);try{t=yield r._schedule(()=>(0,Y.Up)(t,r.definitionExpression,r.spatialReference),s),t=yield r._reschedule(()=>function it(f,t,i){return Le.apply(this,arguments)}(t,i,{availableFields:r.availableFields,fieldsIndex:r.fieldsIndex,geometryType:r.geometryType,spatialReference:r.spatialReference}),s);const n=yield r._reschedule(()=>r._executeSceneFilterQuery(t,s),s),l=yield r._reschedule(()=>r._executeGeometryQuery(t,n,s),s);return yield r._reschedule(()=>r._executeAggregateIdsQuery(l),s),yield r._reschedule(()=>r._executeObjectIdsQuery(l),s),yield r._reschedule(()=>r._executeTimeQuery(l),s),yield r._reschedule(()=>r._executeAttributesQuery(l),s),l}catch(n){if(n!==Y.Ti)throw n;return new G([],t,r)}})()}}},87757:(Ve,fe,m)=>{m.d(fe,{g:()=>F});const F={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},92794:(Ve,fe,m)=>{m.d(fe,{n:()=>Ie});var F=m(77044),ve=m(66385),B=m(88071);const Ie={getObjectId:Q=>Q.objectId,getAttributes:Q=>Q.attributes,getAttribute:(Q,k)=>Q.attributes[k],cloneWithGeometry:(Q,k)=>new ve.u_(k,Q.attributes,null,Q.objectId),getGeometry:Q=>Q.geometry,getCentroid:(Q,k)=>(null==Q.centroid&&(Q.centroid=(0,F.Y)(new B.Z,Q.geometry,k.hasZ,k.hasM)),Q.centroid)}},29466:(Ve,fe,m)=>{m.d(fe,{do:()=>Ce,gq:()=>Ae,qQ:()=>we,yO:()=>Me});var F=m(15861),Ie=(m(29132),m(26584),m(23841)),Q=m(28170),k=m(65234),Re=m(7848),L=m(37053),Se=m(90194),Ee=m(36859),pe=m(51692),le=m(26072),Qe=m(46679),ye=m(72642);let ie=null;const X=/^(?<hh>([0-1][0-9])|([2][0-3])):(?<mm>[0-5][0-9])(:(?<ss>[0-5][0-9]))?([.](?<ms>\d+))?$/;function Ae(x,y,T,M){const I=(0,L.MP)(T)?(0,L.C5)(T):null,P=I?Math.round((I.valid[1]-I.valid[0])/y.scale[0]):null;return x.map(W=>{const j=new ye.Z(W.geometry);return(0,Re.RF)(y,j,j,j.hasZ,j.hasM),W.geometry=I?function be(x,y,T){return x.x<0?x.x+=y:x.x>T&&(x.x-=y),x}(j,P??0,M[0]):j,W})}function we(x,y=18,T,M,I){const P=new Float64Array(M*I);y=Math.round((0,Ie.F2)(y));let W=Number.POSITIVE_INFINITY,j=Number.NEGATIVE_INFINITY;const ee=(0,Ee.wx)(T);for(const{geometry:U,attributes:w}of x){const{x:H,y:C}=U,K=Math.max(0,H-y),te=Math.max(0,C-y),he=Math.min(I,C+y),G=Math.min(M,H+y),oe=+ee(w);for(let se=te;se<he;se++)for(let re=K;re<G;re++){const Y=se*M+re,J=(0,Ee.If)(re-H,se-C,y)*oe,$=P[Y]+=J;W=Math.min(W,$),j=Math.max(j,$)}}return{min:W,max:j}}function Me(x){const y=X.exec(x);if(!y)return null;const{hh:T,mm:M,ss:I,ms:P}=y.groups;return Number(T)*Q.fM.hours+Number(M)*Q.fM.minutes+Number(I)*Q.fM.seconds+Number(P||0)}function Ce(x,y){return ge.apply(this,arguments)}function ge(){return(ge=(0,F.Z)(function*(x,y,T=!0){if(!y)return[];const{field:M,field2:I,field3:P,fieldDelimiter:W,fieldInfos:j,timeZone:ee}=x,U=M&&j?.find($=>$.name.toLowerCase()===M.toLowerCase()),w=!!U&&(0,Se.sX)(U),H=!!U&&(0,pe.a8)(U),C=x.valueExpression,K=x.normalizationType,te=x.normalizationField,he=x.normalizationTotal,G=[],oe=x.viewInfoParams;let se=null,re=null;if(C){if(!ie){const{arcadeUtils:$}=yield(0,Qe.LC)();ie=$}ie.hasGeometryOperations(C)&&(yield ie.enableGeometryOperations()),se=ie.createFunction(C),re=oe?ie.getViewInfo({viewingMode:oe.viewingMode,scale:oe.scale,spatialReference:new k.Z(oe.spatialReference)}):null}const Y=x.fieldInfos,J=y[0]&&"declaredClass"in y[0]&&"esri.Graphic"===y[0].declaredClass||!Y?null:{fields:Y};return y.forEach($=>{const ae=$.attributes;let z;if(C){const Fe=J?{...$,layer:J}:$,Be=ie.createExecContext(Fe,re,ee);z=ie.executeFunction(se,Be)}else ae&&(z=ae[M],I?(z=`${(0,le.wk)(z)}${W}${(0,le.wk)(ae[I])}`,P&&(z=`${z}${W}${(0,le.wk)(ae[P])}`)):"string"==typeof z&&T&&(H?z=z?new Date(z).getTime():null:w&&(z=z?Me(z):null)));if(K&&"number"==typeof z&&isFinite(z)){const Fe=ae&&parseFloat(ae[te]);z=(0,le.fk)(z,K,Fe,he)}G.push(z)}),G})).apply(this,arguments)}}}]);