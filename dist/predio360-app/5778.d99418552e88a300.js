"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[5778],{65778:(q,S,l)=>{l.r(S),l.d(S,{createArcadeExecutor:()=>V,createArcadeProfile:()=>Q});var g=l(15861),B=l(88879),E=l(91365),F=l(98362),A=l(26584),K=l(58817),h=l(31910),P=l(29535),W=l(80415),G=l(31099),k=l(17253),z=l(46679);let m=null;function J(e,n,a,o={}){const r=n.elementType,s="value",u="array"===r.type?[{name:s,type:r.type,elementType:r.elementType}]:"dictionary"===r.type?[{name:s,type:r.type,properties:r.properties}]:[{name:s,type:r.type}];return new F.Z(e.map(c=>{const t={};return D(t,u,{[s]:c},a,o),t[s]}))}function H(e,n,a={}){const o=e instanceof k.Z?new W.default({source:e.features,geometryType:e.geometryType,fields:e.fields,spatialReference:e.spatialReference}):e;return n.constructFeatureSet(o,a.spatialReference,null,!0,a.lruCache,a.interceptor)}function N(e,n,a={}){const{spatialReference:o,interceptor:r,lruCache:s}=a;return"string"==typeof e?n.createFeatureSetCollectionFromService(e,o,s,r):n.createFeatureSetCollectionFromMap(e,o,s,r)}function Y(e,n,a,o={}){const r={};return D(r,n.properties,e,a,o),new m.Dictionary(r)}function D(e,n,a,o,r={}){const s={};for(const u of Object.keys(a))s[u.toLowerCase()]=a[u];for(const u of n){const c=u.name.toLowerCase();if(r.variablesPreProcessed)e[c]=s[c];else switch(u.type){case"array":{const t=s[c];e[c]=null==t?null:J(t,u,o,r);break}case"feature":{const t=s[c];e[c]=null==t?null:m.Feature.createFromGraphic(t,r?.timeZone);break}case"featureSet":{const t=s[c];e[c]=null==t?null:o?H(t,o,r):null;break}case"featureSetCollection":{const t=s[c];e[c]=null==t?null:o?N(t,o,r):null;break}case"dictionary":{const t=s[c];e[c]=null==t?null:Y(t,u,o,r);break}case"date":{const t=s[c];e[c]=t?t instanceof E.iG?t:r?.timeZone?E.iG.dateJSAndZoneToArcadeDate(t,r?.timeZone):E.iG.dateJSToArcadeDate(t):null;break}case"dateOnly":{const t=s[c];e[c]=t?t instanceof h.u?t:h.u.fromReader(t):null;break}case"time":{const t=s[c];e[c]=t?t instanceof P.n?t:P.n.fromReader(t):null;break}case"knowledgeGraph":case"geometry":case"boolean":case"text":case"number":e[c]=s[c]}}}function M(e,n){for(const a of e)n.push(a),"dictionary"===a.type&&M(a.properties,n);return n}function T(e,n,a,o,r){const{spatialReference:s,interceptor:u,lruCache:c,console:t,abortSignal:_,timeZone:p,services:b={portal:G.Z.getDefault()}}=a,d={vars:{},spatialReference:s,interceptor:u,timeZone:p,lrucache:c,useAsync:r,services:b,console:t,abortSignal:_};return n&&D(d.vars,e.variables,n,o,a),d}function C(e,n){switch(n.getArcadeType(e)){case"number":case"text":case"boolean":case"point":case"polygon":case"polyline":case"multipoint":case"extent":return e;case"date":return e.toJSDate();case"time":case"dateOnly":return e.toString();case"feature":{const a=e,o="geometry"in a?a.geometry():null,r="readAttributes"in a?a.readAttributes():a.attributes;return new B.Z({geometry:o,attributes:r})}case"dictionary":{const a=e,o=a.attributes,r={};for(const s of Object.keys(o))r[s]=C(a.field(s),n);return r}case"array":return("toArray"in e?e.toArray():e).map(a=>C(a,n))}return e}const $={variables:[{name:"$feature",type:"feature"},{name:"$layer",type:"featureSet"},{name:"$datastore",type:"featureSetCollection"},{name:"$map",type:"featureSetCollection"},{name:"$userInput",type:"geometry"},{name:"$graph",type:"knowledgeGraph"}]},R={variables:[{name:"$feature",type:"feature"},{name:"$aggregatedFeatures",type:"featureSet"}]},U=new Map([["form-constraint",{variables:[{name:"$feature",type:"feature"}]}],["feature-z",{variables:[{name:"$feature",type:"feature"}]}],["field-calculation",{variables:[{name:"$feature",type:"feature"},{name:"$datastore",type:"featureSetCollection"}]}],["form-calculation",{variables:[{name:"$feature",type:"feature"},{name:"$originalFeature",type:"feature"},{name:"$layer",type:"featureSet"},{name:"$featureSet",type:"featureSet"},{name:"$datastore",type:"featureSetCollection"},{name:"$map",type:"featureSetCollection"},{name:"$editContext",type:"dictionary",properties:[{name:"editType",type:"text"}]}]}],["labeling",{variables:[{name:"$feature",type:"feature"}]}],["popup",$],["popup-element",$],["feature-reduction-popup",R],["feature-reduction-popup-element",R],["visualization",{variables:[{name:"$feature",type:"feature"},{name:"$view",type:"dictionary",properties:[{name:"scale",type:"number"}]}]}]]);function Q(e){const n=U.get(e);if(!n){const a=Array.from(U.keys()).map(o=>`'${o}'`).join(", ");throw new A.Z("createArcadeProfile:invalid-profile-name",`Invalid profile name '${e}'. You must specify one of the following values: ${a}`)}return(0,K.d9)(n)}function V(e,n){return O.apply(this,arguments)}function O(){return O=(0,g.Z)(function*(e,n,a={}){m||(m=yield(0,z.LC)());const{arcade:o,arcadeUtils:r}=m,{loadScriptDependencies:s,referencesMember:u,scriptIsAsync:c}=o,t=M(n.variables,[]),_=t.filter(i=>"featureSet"===i.type||"featureSetCollection"===i.type).map(i=>i.name.toLowerCase()),p=o.parseScript(e,_);if(!p)throw new A.Z("arcade:invalid-script","Unable to create SyntaxTree");const b=r.extractFieldNames(p),d=o.scriptTouchesGeometry(p),L=t.map(i=>i.name.toLowerCase()).filter(i=>u(p,i)),f=c(p,_);yield s(p,f,_);const I={vars:{},spatialReference:null,useAsync:f};for(const i of L)I.vars[i]="any";const{lruCache:j}=a,x=o.compileScript(p,I),w=o.featureSetUtils(),{services:X}=a;return{execute:(i,v={})=>{if(f)throw new A.Z("arcade:invalid-execution-mode","Cannot execute the script in synchronous mode");const y=x(T(n,i,{lruCache:j,...v},w,f));return v.rawOutput?y:C(y,r)},executeAsync:(i=(0,g.Z)(function*(v,y={}){const Z=yield x(T(n,v,{lruCache:j,services:X,...y},w,f));return y.rawOutput?Z:C(Z,r)}),function(y){return i.apply(this,arguments)}),isAsync:f,variablesUsed:L,fieldsUsed:b,geometryUsed:d,syntaxTree:p};var i}),O.apply(this,arguments)}}}]);