"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[6269],{36592:(H,b,p)=>{p.d(b,{Q:()=>Y});var j=p(85931),O=p(77029),Z=p(14259);class Y{constructor(t=9,s){this._compareMinX=X,this._compareMinY=B,this._toBBox=i=>i,this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),s&&("function"==typeof s?this._toBBox=s:this._initFormat(s)),this.clear()}destroy(){this.clear(),I.prune(),L.prune(),A.prune(),w.prune()}all(t){this._all(this._data,t)}search(t,s){let i=this._data;const h=this._toBBox;if(y(t,i))for(I.clear();i;){for(let d=0,m=i.children.length;d<m;d++){const u=i.children[d],E=i.leaf?h(u):u;y(t,E)&&(i.leaf?s(u):f(t,E)?this._all(u,s):I.push(u))}i=I.pop()}}collides(t){let s=this._data;const i=this._toBBox;if(!y(t,s))return!1;for(I.clear();s;){for(let h=0,d=s.children.length;h<d;h++){const m=s.children[h],u=s.leaf?i(m):m;if(y(t,u)){if(s.leaf||f(t,u))return!0;I.push(m)}}s=I.pop()}return!1}load(t){if(!t.length)return this;if(t.length<this._minEntries){for(let i=0,h=t.length;i<h;i++)this.insert(t[i]);return this}let s=this._build(t.slice(0,t.length),0,t.length-1,0);if(this._data.children.length)if(this._data.height===s.height)this._splitRoot(this._data,s);else{if(this._data.height<s.height){const i=this._data;this._data=s,s=i}this._insert(s,this._data.height-s.height-1,!0)}else this._data=s;return this}insert(t){return t&&this._insert(t,this._data.height-1),this}clear(){return this._data=new l([]),this}remove(t){if(!t)return this;let s,i=this._data,h=null,d=0,m=!1;const u=this._toBBox(t);for(A.clear(),w.clear();i||A.length>0;){if(i||(i=A.pop(),h=A.data[A.length-1],d=w.pop()??0,m=!0),i.leaf&&(s=(0,j.cq)(i.children,t,i.children.length,i.indexHint),-1!==s))return i.children.splice(s,1),A.push(i),this._condense(A),this;m||i.leaf||!f(i,u)?h?(d++,i=h.children[d],m=!1):i=null:(A.push(i),w.push(d),d=0,h=i,i=i.children[0])}return this}toJSON(){return this._data}fromJSON(t){return this._data=t,this}_all(t,s){let i=t;for(L.clear();i;){if(!0===i.leaf)for(const h of i.children)s(h);else L.pushArray(i.children);i=L.pop()??null}}_build(t,s,i,h){const d=i-s+1;let m=this._maxEntries;if(d<=m){const r=new l(t.slice(s,i+1));return C(r,this._toBBox),r}h||(h=Math.ceil(Math.log(d)/Math.log(m)),m=Math.ceil(d/m**(h-1)));const u=new a([]);u.height=h;const E=Math.ceil(d/m),n=E*Math.ceil(Math.sqrt(m));M(t,s,i,n,this._compareMinX);for(let r=s;r<=i;r+=n){const _=Math.min(r+n-1,i);M(t,r,_,E,this._compareMinY);for(let g=r;g<=_;g+=E){const P=Math.min(g+E-1,_);u.children.push(this._build(t,g,P,h-1))}}return C(u,this._toBBox),u}_chooseSubtree(t,s,i,h){for(;h.push(s),!0!==s.leaf&&h.length-1!==i;){let d,m=1/0,u=1/0;for(let E=0,n=s.children.length;E<n;E++){const r=s.children[E],_=x(r),g=W(t,r)-_;g<u?(u=g,m=_<m?_:m,d=r):g===u&&_<m&&(m=_,d=r)}s=d||s.children[0]}return s}_insert(t,s,i){const d=i?t:(0,this._toBBox)(t);A.clear();const m=this._chooseSubtree(d,this._data,s,A);for(m.children.push(t),U(m,d);s>=0&&A.data[s].children.length>this._maxEntries;)this._split(A,s),s--;this._adjustParentBBoxes(d,A,s)}_split(t,s){const i=t.data[s],h=i.children.length,d=this._minEntries;this._chooseSplitAxis(i,d,h);const m=this._chooseSplitIndex(i,d,h);if(!m)return void console.log("  Error: assertion failed at PooledRBush._split: no valid split index");const u=i.children.splice(m,i.children.length-m),E=i.leaf?new l(u):new a(u);E.height=i.height,C(i,this._toBBox),C(E,this._toBBox),s?t.data[s-1].children.push(E):this._splitRoot(i,E)}_splitRoot(t,s){this._data=new a([t,s]),this._data.height=t.height+1,C(this._data,this._toBBox)}_chooseSplitIndex(t,s,i){let h,d,m;h=d=1/0;for(let u=s;u<=i-s;u++){const E=S(t,0,u,this._toBBox),n=S(t,u,i,this._toBBox),r=F(E,n),_=x(E)+x(n);r<h?(h=r,m=u,d=_<d?_:d):r===h&&_<d&&(d=_,m=u)}return m}_chooseSplitAxis(t,s,i){const h=t.leaf?this._compareMinX:X,d=t.leaf?this._compareMinY:B;this._allDistMargin(t,s,i,h)<this._allDistMargin(t,s,i,d)&&t.children.sort(h)}_allDistMargin(t,s,i,h){t.children.sort(h);const d=this._toBBox,m=S(t,0,s,d),u=S(t,i-s,i,d);let E=v(m)+v(u);for(let n=s;n<i-s;n++){const r=t.children[n];U(m,t.leaf?d(r):r),E+=v(m)}for(let n=i-s-1;n>=s;n--){const r=t.children[n];U(u,t.leaf?d(r):r),E+=v(u)}return E}_adjustParentBBoxes(t,s,i){for(let h=i;h>=0;h--)U(s.data[h],t)}_condense(t){for(let s=t.length-1;s>=0;s--){const i=t.data[s];if(0===i.children.length)if(s>0){const h=t.data[s-1],d=h.children;d.splice((0,j.cq)(d,i,d.length,h.indexHint),1)}else this.clear();else C(i,this._toBBox)}}_initFormat(t){const s=["return a"," - b",";"];this._compareMinX=new Function("a","b",s.join(t[0])),this._compareMinY=new Function("a","b",s.join(t[1])),this._toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}function C(e,t){S(e,0,e.children.length,t,e)}function S(e,t,s,i,h){h||(h=new l([])),h.minX=1/0,h.minY=1/0,h.maxX=-1/0,h.maxY=-1/0;for(let d,m=t;m<s;m++)d=e.children[m],U(h,e.leaf?i(d):d);return h}function U(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function X(e,t){return e.minX-t.minX}function B(e,t){return e.minY-t.minY}function x(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function v(e){return e.maxX-e.minX+(e.maxY-e.minY)}function W(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function F(e,t){const s=Math.max(e.minX,t.minX),i=Math.max(e.minY,t.minY),h=Math.min(e.maxX,t.maxX),d=Math.min(e.maxY,t.maxY);return Math.max(0,h-s)*Math.max(0,d-i)}function f(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function y(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function M(e,t,s,i,h){const d=[t,s];for(;d.length;){const m=d.pop(),u=d.pop();if(m-u<=i)continue;const E=u+Math.ceil((m-u)/i/2)*i;(0,Z.q)(e,E,u,m,h),d.push(u,E,E,m)}}const I=new O.Z,L=new O.Z,A=new O.Z,w=new O.Z({deallocator:void 0});class c{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class o extends c{constructor(){super(...arguments),this.height=1,this.indexHint=new j.SO}}class l extends o{constructor(t){super(),this.children=t,this.leaf=!0}}class a extends o{constructor(t){super(),this.children=t,this.leaf=!1}}},65629:(H,b,p)=>{p.d(b,{SR:()=>B,Ui:()=>X});var j=p(86810),O=p(65401),Z=p(32442),Y=p(25748),C=p(91179),S=p(74618),U=p(37053);function X(c){return x(c,!0)}function B(c){return x(c,!1)}function x(c,o){if(null==c)return null;const l=c.spatialReference,a=(0,U.C5)(l),e=(0,j.AK)(c)?c.toJSON():c;if(!a)return e;const t=(0,U.sS)(l)?102100:4326,s=S.UZ[t].maxX,i=S.UZ[t].minX;if((0,C.wp)(e))return W(e,s,i);if((0,C.aW)(e))return e.points=e.points.map(h=>W(h,s,i)),e;if((0,C.YX)(e))return function v(c,o){if(!o)return c;const l=function F(c,o){const l=[],{ymin:a,ymax:e,xmin:t,xmax:s}=c,i=c.xmax-c.xmin,[h,d]=o.valid,{x:m,frameId:u}=f(c.xmin,o),{x:E,frameId:n}=f(c.xmax,o),r=m===E&&i>0;if(i>2*d){const _={xmin:t<s?m:E,ymin:a,xmax:d,ymax:e},g={xmin:h,ymin:a,xmax:t<s?E:m,ymax:e},P={xmin:0,ymin:a,xmax:d,ymax:e},D={xmin:h,ymin:a,xmax:0,ymax:e},R=[],T=[];y(_,P)&&R.push(u),y(_,D)&&T.push(u),y(g,P)&&R.push(n),y(g,D)&&T.push(n);for(let K=u+1;K<n;K++)R.push(K),T.push(K);l.push(new L(_,[u]),new L(g,[n]),new L(P,R),new L(D,T))}else m>E||r?l.push(new L({xmin:m,ymin:a,xmax:d,ymax:e},[u]),new L({xmin:h,ymin:a,xmax:E,ymax:e},[n])):l.push(new L({xmin:m,ymin:a,xmax:E,ymax:e},[u]));return l}(c,o).map(a=>a.extent);return l.length<2?l[0]||c:l.length>2?(c.xmin=o.valid[0],c.xmax=o.valid[1],c):{rings:l.map(a=>[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]])}}(e,a);if((0,C.oU)(e)||(0,C.l9)(e)){const h=(0,Z.$P)(A,e),d={xmin:h[0],ymin:h[1],xmax:h[2],ymax:h[3]},m=(0,S.XZ)(d.xmin,i)*(2*s),u=0===m?e:(0,S.Sy)(e,m);return d.xmin+=m,d.xmax+=m,d.xmax>s?I(u,s,o):d.xmin<i?I(u,i,o):u}return e}function W(c,o,l){if(Array.isArray(c)){const a=c[0];if(a>o){const e=(0,S.XZ)(a,o);c[0]=a+e*(-2*o)}else if(a<l){const e=(0,S.XZ)(a,l);c[0]=a+e*(-2*l)}}else{const a=c.x;if(a>o){const e=(0,S.XZ)(a,o);c.x+=e*(-2*o)}else if(a<l){const e=(0,S.XZ)(a,l);c.x+=e*(-2*l)}}return c}function f(c,o){const[l,a]=o.valid,e=2*a;let t,s=0;return c>a?(t=Math.ceil(Math.abs(c-a)/e),c-=t*e,s=t):c<l&&(t=Math.ceil(Math.abs(c-l)/e),c+=t*e,s=-t),{x:c,frameId:s}}function y(c,o){const{xmin:l,ymin:a,xmax:e,ymax:t}=o;return M(c,l,a)&&M(c,l,t)&&M(c,e,t)&&M(c,e,a)}function M(c,o,l){return o>=c.xmin&&o<=c.xmax&&l>=c.ymin&&l<=c.ymax}function I(c,o,l=!0){const a=!(0,C.l9)(c);if(a&&(0,Y.Zy)(c),l)return(new w).cut(c,o);const e=a?c.rings:c.paths,t=a?4:2,s=e.length,i=-2*o;for(let h=0;h<s;h++){const d=e[h];if(d&&d.length>=t){const m=[];for(const u of d)m.push([u[0]+i,u[1]]);e.push(m)}}return a?c.rings=e:c.paths=e,c}class L{constructor(o,l){this.extent=o,this.frameIds=l}}const A=(0,O.Ue)();class w{constructor(){this._linesIn=[],this._linesOut=[]}cut(o,l){let a;if(this._xCut=l,o.rings)this._closed=!0,a=o.rings,this._minPts=4;else{if(!o.paths)return null;this._closed=!1,a=o.paths,this._minPts=2}for(const t of a){if(!t||t.length<this._minPts)continue;let s=!0;for(const i of t)s?(this.moveTo(i),s=!1):this.lineTo(i);this._closed&&this.close()}this._pushLineIn(),this._pushLineOut(),a=[];for(const t of this._linesIn)t&&t.length>=this._minPts&&a.push(t);const e=-2*this._xCut;for(const t of this._linesOut)if(t&&t.length>=this._minPts){for(const s of t)s[0]+=e;a.push(t)}return this._closed?o.rings=a:o.paths=a,o}moveTo(o){this._pushLineIn(),this._pushLineOut(),this._prevSide=this._side(o[0]),this._moveTo(o[0],o[1],this._prevSide),this._prevPt=o,this._firstPt=o}lineTo(o){const l=this._side(o[0]);if(l*this._prevSide==-1){const a=this._intersect(this._prevPt,o);this._lineTo(this._xCut,a,0),this._prevSide=0,this._lineTo(o[0],o[1],l)}else this._lineTo(o[0],o[1],l);this._prevSide=l,this._prevPt=o}close(){const o=this._firstPt,l=this._prevPt;o[0]===l[0]&&o[1]===l[1]||this.lineTo(o),this._checkClosingPt(this._lineIn),this._checkClosingPt(this._lineOut)}_moveTo(o,l,a){this._closed?(this._lineIn.push([a<=0?o:this._xCut,l]),this._lineOut.push([a>=0?o:this._xCut,l])):(a<=0&&this._lineIn.push([o,l]),a>=0&&this._lineOut.push([o,l]))}_lineTo(o,l,a){this._closed?(this._addPolyVertex(this._lineIn,a<=0?o:this._xCut,l),this._addPolyVertex(this._lineOut,a>=0?o:this._xCut,l)):a<0?(0===this._prevSide&&this._pushLineOut(),this._lineIn.push([o,l])):a>0?(0===this._prevSide&&this._pushLineIn(),this._lineOut.push([o,l])):this._prevSide<0?(this._lineIn.push([o,l]),this._lineOut.push([o,l])):this._prevSide>0&&(this._lineOut.push([o,l]),this._lineIn.push([o,l]))}_addPolyVertex(o,l,a){const e=o.length;e>1&&o[e-1][0]===l&&o[e-2][0]===l?o[e-1][1]=a:o.push([l,a])}_checkClosingPt(o){const l=o.length;l>3&&o[0][0]===this._xCut&&o[l-2][0]===this._xCut&&o[1][0]===this._xCut&&(o[0][1]=o[l-2][1],o.pop())}_side(o){return o<this._xCut?-1:o>this._xCut?1:0}_intersect(o,l){return o[1]+(this._xCut-o[0])/(l[0]-o[0])*(l[1]-o[1])}_pushLineIn(){this._lineIn&&this._lineIn.length>=this._minPts&&this._linesIn.push(this._lineIn),this._lineIn=[]}_pushLineOut(){this._lineOut&&this._lineOut.length>=this._minPts&&this._linesOut.push(this._lineOut),this._lineOut=[]}}},61256:(H,b,p)=>{p.d(b,{H:()=>X});var j=p(8314),O=p(36592),Z=p(65401);const C={minX:0,minY:0,maxX:0,maxY:0};class X{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new O.Q(9,(0,j.Z)("esri-csp-restrictions")?x=>({minX:x[0],minY:x[1],maxX:x[2],maxY:x[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const x=new Array(this._idByBounds.size);let v=0;this._idByBounds.forEach((W,F)=>{x[v++]=F}),this._indexInvalid=!1,this._index.clear(),this._index.load(x)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter(x=>this._idByBounds.has(x))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const x=(0,Z.cS)();for(const v of this._boundsById.values())v&&(x[0]=Math.min(v[0],x[0]),x[1]=Math.min(v[1],x[1]),x[2]=Math.max(v[2],x[2]),x[3]=Math.max(v[3],x[3]));return x}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(x){const v=this._boundsById.get(x);this._boundsById.delete(x),v&&(this._idByBounds.delete(v),this._indexInvalid||this._index.remove(v))}forEachInBounds(x,v){this._loadIndex(),function U(B,x,v){(function S(B){C.minX=B[0],C.minY=B[1],C.maxX=B[2],C.maxY=B[3]})(x),B.search(C,v)}(this._index,x,W=>v(this._idByBounds.get(W)))}get(x){return this._boundsById.get(x)}has(x){return this._boundsById.has(x)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(x,v){if(!this._indexInvalid){const W=this._boundsById.get(x);W&&(this._index.remove(W),this._idByBounds.delete(W))}this._boundsById.set(x,v),v&&(this._idByBounds.set(v,x),this._indexInvalid||(this._boundsToLoad.push(v),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},3579:(H,b,p)=>{p.d(b,{Z:()=>W});var j=p(85931),O=p(26584),Z=p(61885),Y=p(63290),C=p(5548),S=p(65401),U=p(82054),X=p(61256),B=p(16983),x=p(92794);const v=(0,C.Ue)();class W{constructor(f){this.geometryInfo=f,this._boundsStore=new X.H,this._featuresById=new Map,this._markedIds=new Set,this.events=new Z.Z,this.featureAdapter=x.n}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let f=0;return this._featuresById.forEach(y=>{null!=y.geometry&&y.geometry.coords&&(f+=y.geometry.coords.length)}),{featureCount:this._featuresById.size,vertexCount:f/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(f){if(null==this.fullBounds)return null;const[y,M,I,L]=this.fullBounds;return{xmin:y,ymin:M,xmax:I,ymax:L,spatialReference:(0,B.S2)(f)}}add(f){this._add(f),this._emitChanged()}addMany(f){for(const y of f)this._add(y);this._emitChanged()}upsertMany(f){const y=f.map(M=>this._upsert(M));return this._emitChanged(),y.filter(j.pC)}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}removeById(f){const y=this._featuresById.get(f);return y?(this._remove(y),this._emitChanged(),y):null}removeManyById(f){this._boundsStore.invalidateIndex();for(const y of f){const M=this._featuresById.get(y);M&&this._remove(M)}this._emitChanged()}forEachBounds(f,y){for(const M of f){const I=this._boundsStore.get(M.objectId);I&&y((0,C.JR)(v,I))}}getFeature(f){return this._featuresById.get(f)}has(f){return this._featuresById.has(f)}forEach(f){this._featuresById.forEach(y=>f(y))}forEachInBounds(f,y){this._boundsStore.forEachInBounds(f,M=>{y(this._featuresById.get(M))})}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}sweep(){let f=!1;this._featuresById.forEach((y,M)=>{this._markedIds.has(M)||(f=!0,this._remove(y))}),this._markedIds.clear(),f&&this._emitChanged()}_emitChanged(){this.events.emit("changed",void 0)}_add(f){if(!f)return;const y=f.objectId;if(null==y)return void Y.Z.getLogger("esri.layers.graphics.data.FeatureStore").error(new O.Z("featurestore:invalid-feature","feature id is missing",{feature:f}));const M=this._featuresById.get(y);let I;if(this._markedIds.add(y),M?(f.displayId=M.displayId,I=this._boundsStore.get(y),this._boundsStore.delete(y)):null!=this.onFeatureAdd&&this.onFeatureAdd(f),!f.geometry?.coords?.length)return this._boundsStore.set(y,null),void this._featuresById.set(y,f);I=(0,U.$)(I??(0,S.Ue)(),f.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),null!=I&&this._boundsStore.set(y,I),this._featuresById.set(y,f)}_upsert(f){const y=f?.objectId;if(null==y)return Y.Z.getLogger("esri.layers.graphics.data.FeatureStore").error(new O.Z("featurestore:invalid-feature","feature id is missing",{feature:f})),null;const M=this._featuresById.get(y);if(!M)return this._add(f),f;this._markedIds.add(y);const{geometry:I,attributes:L}=f;for(const A in L)M.attributes[A]=L[A];return I&&(M.geometry=I,this._boundsStore.set(y,(0,U.$)((0,S.Ue)(),I,this.geometryInfo.hasZ,this.geometryInfo.hasM)??null)),M}_remove(f){null!=this.onFeatureRemove&&this.onFeatureRemove(f);const y=f.objectId;return this._markedIds.delete(y),this._boundsStore.delete(y),this._featuresById.delete(y),f}}},66269:(H,b,p)=>{p.r(b),p.d(b,{GraphicsSnappingSource:()=>u});var j=p(15861),O=p(17626),Z=p(83761),Y=p(85931),C=p(59213),S=p(75618),U=p(10699),X=p(32917),B=p(77712),W=(p(8314),p(63290),p(76898)),F=p(11426),f=p(37118),y=p(55915),M=p(65629),I=p(71774),L=p(82054),A=p(66385),w=p(3579),c=p(73771),o=p(60466),l=p(60507),a=p(86606),e=p(44725),t=p(9218),s=p(17936),i=p(1520),h=p(83010),d=p(87091);const m="graphics-collections";let u=class extends Z.Z{get updating(){return this._updatingHandles.updating}get _hasZ(){const n=this.view;return null!=n&&"3d"===n.type&&"map-notes"!==this.layerSource.layer.type}get _snappingElevationAligner(){const{view:n}=this,{layer:r}=this.layerSource,_=null!=n&&"3d"===n.type;if(!_||"map-notes"===r.type)return(0,s.p)();const g=function(){var P=(0,j.Z)(function*(D,R){return(yield(0,U.Hl)(n.whenLayerView(r),R)).elevationAlignPointsInFeatures(D,R)});return function(R,T){return P.apply(this,arguments)}}();return(0,s.p)(_,{elevationInfo:r.elevationInfo,alignPointsInFeatures:g})}get _snappingElevationFilter(){const{view:n}=this;return(0,i.c)(null!=n&&"3d"===n.type&&"map-notes"!==this.layerSource.layer.type)}get _symbologySnappingFetcher(){const{view:n}=this,{layer:r}=this.layerSource,g=this._extrudedPolygonSymbolsCount>0;return null!=n&&"3d"===n.type&&"map-notes"!==r.type&&g?(0,h.k)(g,function(){var P=(0,j.Z)(function*(D,R){const T=yield n.whenLayerView(r);return(0,U.k_)(R),T.queryForSymbologySnapping({candidates:D,spatialReference:n.spatialReference},R)});return function(D,R){return P.apply(this,arguments)}}()):(0,h.k)()}constructor(n){super(n),this.availability=1,this._sources={multipoint:null,point:null,polygon:null,polyline:null},this._loadedWkids=new Set,this._loadedWkts=new Set,this._pendingAdds=[],this._extrudedPolygonSymbolsCount=0,this._updatingHandles=new F.R,this._memoizedMakeGetGroundElevation=(0,S.H)(t.g)}destroy(){for(const n of this._pendingAdds)n.task.abort();this._pendingAdds.length=0,this._mapSources(n=>this._destroySource(n)),this._updatingHandles.destroy()}initialize(){this._updatingHandles.add(()=>this.getGraphicsLayers(),_=>{this._updatingHandles.removeHandles(m);for(const g of _)this._addMany(g.graphics.toArray()),this.addHandles([g.on("graphic-update",P=>this._onGraphicUpdate(P)),this._updatingHandles.addOnCollectionChange(()=>g.graphics,P=>this._onGraphicsChanged(P))],m)},X.nn);const{view:n}=this,{layer:r}=this.layerSource;null!=n&&"3d"===n.type&&"map-notes"!==r.type&&n.elevationProvider&&this.addHandles([n.elevationProvider.on("elevation-change",({context:_})=>{(0,l.W_)(_,r.elevationInfo)&&this._snappingElevationAligner.notifyElevationSourceChange()}),(0,X.YP)(()=>r.elevationInfo,()=>this._snappingElevationAligner.notifyElevationSourceChange(),X.nn),(0,X.on)(()=>r,["edits","apply-edits","graphic-update"],()=>this._symbologySnappingFetcher.notifySymbologyChange())])}fetchCandidates(n,r){var _=this;return(0,j.Z)(function*(){const{point:g,coordinateHelper:{spatialReference:P}}=n,D=yield(0,U.OT)(_._mapSources(K=>_._fetchCandidatesForSource(K,n,r)));(0,U.k_)(r);const R=_._memoizedMakeGetGroundElevation(_.view,P),T=D.flat().map(K=>(0,t.X)(K,R));return(0,e.lQ)(g,T),T})()}_fetchCandidatesForSource(n,r,_){var g=this;return(0,j.Z)(function*(){const P=(0,e.rh)(r,g.view?.type??"2d"),D=yield n.queryEngine.executeQueryForSnapping(P,_);(0,U.k_)(_);const R=yield g._snappingElevationAligner.alignCandidates(D.candidates,r.coordinateHelper.spatialReference,_);(0,U.k_)(_);const T=yield g._symbologySnappingFetcher.fetch(R,_);(0,U.k_)(_);const K=0===T.length?R:[...R,...T];return g._snappingElevationFilter.filter(P,K)})()}refresh(){}_onGraphicUpdate(n){if(this.getGraphicsLayers().some(r=>r.graphics.includes(n.graphic)))switch(n.property){case"geometry":case"visible":this._remove(n.graphic),this._addMany([n.graphic])}}_onGraphicsChanged(n){for(const r of n.removed)this._remove(r);this._addMany(n.added)}_addMany(n){const r=[],_=new Map;for(const g of n)null!=g.geometry&&(this._needsInitializeProjection(g.geometry.spatialReference)?(r.push(g.geometry.spatialReference),_.set(g.uid,g)):this._add(g));this._createPendingAdd(r,_)}_createPendingAdd(n,r){var _=this;if(!n.length)return;const g=(0,C.vr)(function(){var R=(0,j.Z)(function*(T){yield(0,y.initializeProjection)(n.map(K=>({source:K,dest:_.spatialReference})),{signal:T}),_._markLoadedSpatialReferences(n);for(const[,K]of r)_._add(K)});return function(T){return R.apply(this,arguments)}}());this._updatingHandles.addPromise(g.promise);const P={task:g,graphics:r},D=()=>(0,Y.e$)(this._pendingAdds,P);g.promise.then(D,D),this._pendingAdds.push(P)}_markLoadedSpatialReferences(n){for(const r of n){null!=r.wkid&&this._loadedWkids.add(r.wkid);const _=r.wkt2||r.wkt;_&&this._loadedWkts.add(_)}}_add(n){if(null==n.geometry||!n.visible)return;let r=n.geometry;if("mesh"===r.type)return;"extent"===r.type&&(r=f.Z.fromExtent(r));const _=this._ensureSource(r.type);if(null==_)return;const g=this._createOptimizedFeature(n.uid,r);null!=g&&(_.featureStore.add(g),(0,a.QL)(n.symbol)&&this._extrudedPolygonSymbolsCount++)}_needsInitializeProjection(n){if(null!=n.wkid&&this._loadedWkids.has(n.wkid))return!1;const r=n.wkt2||n.wkt;return!(r&&this._loadedWkts.has(r)||(0,y.canProjectWithoutEngine)(n,this.spatialReference))}_createOptimizedFeature(n,r){const _=(0,y.project)((0,M.SR)(r),this.spatialReference);if(!_)return null;const g=this._ensureGeometryHasZ(_),P=(0,L.GH)(g,this._hasZ,!1);return new A.u_(P,{[E]:n},null,n)}_ensureGeometryHasZ(n){if(!this._hasZ)return n;const r=g=>{for(;g.length<3;)g.push(0)},_=n.clone();switch(_.hasZ=!0,_.type){case"point":_.z=_.z??0;break;case"multipoint":_.points.forEach(r);break;case"polyline":_.paths.forEach(g=>g.forEach(r));break;case"polygon":_.rings.forEach(g=>g.forEach(r))}return _}_ensureSource(n){const r=this._sources[n];if(null!=r)return r;const _=this._createSource(n);return this._sources[n]=_,_}_createSource(n){const r=I.M.toJSON(n),_=this._hasZ,g=new w.Z({geometryType:r,hasZ:_,hasM:!1});return{featureStore:g,queryEngine:new c.q({featureStore:g,fieldsIndex:o.Z.fromLayerJSON({fields:[{name:E,type:"esriFieldTypeOID",alias:E}]}),geometryType:r,hasM:!1,hasZ:_,objectIdField:E,spatialReference:this.spatialReference,priority:d.T8.SNAPPING,scheduler:null!=this.view&&"3d"===this.view.type?this.view.resourceController.scheduler:null}),type:n}}_remove(n){this._mapSources(r=>this._removeFromSource(r,n));for(const r of this._pendingAdds)r.graphics.delete(n.uid),0===r.graphics.size&&r.task.abort()}_removeFromSource(n,r){n.featureStore.has(r.uid)&&(n.featureStore.removeById(r.uid),(0,a.QL)(r.symbol)&&this._extrudedPolygonSymbolsCount--)}_destroySource(n){n.queryEngine.destroy(),this._sources[n.type]=null}_mapSources(n){const{point:r,polygon:_,polyline:g,multipoint:P}=this._sources,D=[];return null!=r&&D.push(n(r)),null!=_&&D.push(n(_)),null!=g&&D.push(n(g)),null!=P&&D.push(n(P)),D}};(0,O._)([(0,B.Cb)()],u.prototype,"getGraphicsLayers",void 0),(0,O._)([(0,B.Cb)({constructOnly:!0})],u.prototype,"layerSource",void 0),(0,O._)([(0,B.Cb)({constructOnly:!0})],u.prototype,"spatialReference",void 0),(0,O._)([(0,B.Cb)({constructOnly:!0})],u.prototype,"view",void 0),(0,O._)([(0,B.Cb)({readOnly:!0})],u.prototype,"updating",null),(0,O._)([(0,B.Cb)({readOnly:!0})],u.prototype,"availability",void 0),(0,O._)([(0,B.Cb)()],u.prototype,"_hasZ",null),(0,O._)([(0,B.Cb)()],u.prototype,"_snappingElevationAligner",null),(0,O._)([(0,B.Cb)()],u.prototype,"_snappingElevationFilter",null),(0,O._)([(0,B.Cb)()],u.prototype,"_symbologySnappingFetcher",null),(0,O._)([(0,B.Cb)()],u.prototype,"_extrudedPolygonSymbolsCount",void 0),u=(0,O._)([(0,W.j)("esri.views.interactive.snapping.featureSources.GraphicsSnappingSource")],u);const E="OBJECTID"}}]);