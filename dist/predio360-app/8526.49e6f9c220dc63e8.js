"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[8526,5611],{37946:(re,W,e)=>{e.d(W,{X:()=>S});var y=e(79800),m=e(94008),v=e(94425),V=e(37053);function S(I,L,c,Q){if(null==L||null==Q)return!1;const C=(0,m.eT)(L,m.Jz),T=(0,m.eT)(Q,m.sp);if(C===T&&C!==m.Ej.UNKNOWN||(0,V.fS)(L,Q))return c[0]=1,c[1]=1,c[2]=1,!0;if(C===m.Ej.SPHERICAL_ECEF){const E=(0,y.l)(I),_=E/Math.sqrt(I[0]*I[0]+I[1]*I[1]),g=E/v.sv.radius;if(T===m.Ej.WEB_MERCATOR)return c[0]=_*g,c[1]=_*g,c[2]=1,!0;if(T===m.Ej.WGS84||T===m.Ej.CGCS2000){const a=m.Ms;return c[0]=a*_*g,c[1]=a*g,c[2]=1,!0}}else if(C===m.Ej.PLATE_CARREE){if(T===m.Ej.WGS84||T===m.Ej.CGCS2000)return c[0]=m.Ms,c[1]=m.Ms,c[2]=1,!0;if(T===m.Ej.WEB_MERCATOR){const E=I[1]/v.sv.radius;return c[0]=1,c[1]=1/Math.cos(E),c[2]=1,!0}}return!1}},15869:(re,W,e)=>{e.d(W,{s:()=>S});var y=e(21286),m=e(29302),v=e(94008),V=e(94425);function S(C,T,E,_){if(null==T||null==_)return!1;const g=(0,v.Bg)(T,_,c);if(g.projector===v.iq)return E[0]=C[0],E[1]=C[1],E[2]=C[2],E[3]=C[3],!0;if(null==g.projector)return!1;const{source:a,dest:U}=g;if(U.spatialReferenceId===v.Ej.WEB_MERCATOR){const B=v.rf[a.spatialReferenceId][v.Ej.WGS84];return null!=B&&(B(C,0,L,0),(0,v.uT)(L,0,E,0),E[3]=I(L[1],C[2],C[3],V.sv.radius),!0)}if(a.spatialReferenceId!==v.Ej.WGS84&&a.spatialReferenceId!==v.Ej.CGCS2000||U.spatialReferenceId!==v.Ej.PLATE_CARREE)g.projector(C,0,E,0),E[3]=C[3]*(a.metersPerUnit??1)/(U.metersPerUnit??1);else{let ne=C[3];null!=v.rf[a.spatialReferenceId][v.Ej.SPHERICAL_ECEF]&&null!=v.rf[v.Ej.SPHERICAL_ECEF][v.Ej.PLATE_CARREE]&&(ne=I(C[1],C[2],C[3],V.sv.radius)),g.projector(C,0,E,0),E[3]=ne}return!0}function I(C,T,E,_){const g=_+T;if(g<_/2||E>g)return Number.MAX_VALUE;const a=Math.abs(Q*C)+Math.asin(E/g);return a>=Math.PI/2?Number.MAX_VALUE:E/Math.cos(a)}const L=(0,m.Ue)(),c=(0,v.sw)(),Q=(0,y.Vl)(1)},88526:(re,W,e)=>{e.r(W),e.d(W,{default:()=>Je});var y=e(15861),m=e(17626),v=e(26584),V=e(63290),S=e(62208),I=e(32917),L=e(50618),c=e(77712),T=(e(8314),e(4619),e(76898)),E=e(86274),_=e(32884),g=e(52113),a=e(74741),U=e(79800),B=e(29302),J=e(1503),ne=e(92383),Y=e(93146),te=e(37946),ce=e(1582),R=e(60479),r=e(87124),ue=e(29505),M=e(59617),H=e(46196);class q extends H.W{constructor(t,o,l,u,h,d,j){super(t,0,0,0,o),this.nodesCached=l,this.vboMB=u,this.textureMB=h,this.vboMBCached=d,this.textureMBCached=j}}var $=e(62600),N=e(19702),F=e(76652),ae=e(46884),w=e(42743),K=e(67969);const Z={[r.AQ.Points]:null,[r.AQ.Lines]:null,[r.AQ.LineStrip]:null,[r.AQ.Triangles]:K.MX.TRIANGLES,[r.AQ.TriangleStrip]:K.MX.TRIANGLE_STRIP,[r.AQ.NotSet]:null},ie={[r.xL.Opaque]:w.JJ.Opaque,[r.xL.Mask]:w.JJ.Mask,[r.xL.Blend]:w.JJ.Blend},he={[r.Qd.Back]:w.Vr.Back,[r.Qd.Front]:w.Vr.Front,[r.Qd.None]:w.Vr.None,[r.Qd.NotSet]:w.Vr.Back},Pe={[r.$1.WrapYBit]:{s:K.e8.CLAMP_TO_EDGE,t:K.e8.REPEAT},[r.$1.WrapXBit]:{s:K.e8.REPEAT,t:K.e8.CLAMP_TO_EDGE},[r.$1.WrapXy]:{s:K.e8.REPEAT,t:K.e8.REPEAT},[r.$1.None]:{s:K.e8.CLAMP_TO_EDGE,t:K.e8.CLAMP_TO_EDGE},[r.$1.NotSet]:{s:K.e8.CLAMP_TO_EDGE,t:K.e8.CLAMP_TO_EDGE}},Ce={[r.MB.U8]:1,[r.MB.I8]:1,[r.MB.U16]:2,[r.MB.I16]:2,[r.MB.U32]:4,[r.MB.I32]:4,[r.MB.F32]:4,[r.MB.F64]:8,[r.MB.Utf8String]:1,[r.MB.NotSet]:1};var me=e(88879),_e=e(77926),Se=e(62483),De=e(67857);class we{constructor(t){this.layerUid=[],this.type=De.q7.TILES3D,this.slicePlaneEnabled=!1,this.isGround=!0,this.layerView=t,this.layerUid.push(t.layer.uid)}intersect(t,o,l,u){const h=t.results,d=t.options.store===De.eC.ALL;if(t.options.filteredLayerUids.includes(this.layerView.layer.uid))return;const j=this.layerView.view._stage.renderView.componentObjectCollection;this.layerView.objects.forEach(D=>{D.visible&&D.intersectionGeometry&&j.intersect(D,l,u,t.tolerance,null,(G,O,b,P)=>{if(O>=0){if(null!=o&&!o(l,u,O))return;const p=i=>{const x=new _e.lt(this.layerView.layer.uid,()=>this._createTiles3DGraphic(this.layerView.layer,{}));i.set(this.type,x,O,b)};if(this.isGround&&(null==h.ground.dist||O<h.ground.dist)&&p(h.ground),t.options.isFiltered)return;if((null==h.min.dist||O<h.min.dist)&&p(h.min),(null==h.max.dist||O>h.max.dist)&&p(h.max),d){const i=(0,Se.LP)(t.ray);p(i),t.results.all.push(i)}}})})}_createTiles3DGraphic(t,o){return new me.Z({layer:t,sourceLayer:t,attributes:o})}}var A,s,We=e(74993),xe=e(93394),Ve=e(27355),He=e(40370),Fe=e(52051),Ie=e(36603),Ke=e(22799),pe=e(94255),Ge=e(49733),Ne=e(81695),ve=e(16396),ze=e(42037),Ze=e(45611);(s=A||(A={}))[s.API=1]="API",s[s.VerboseAPI=2]="VerboseAPI",s[s.Error=3]="Error";class Qe{constructor(){this.handle=0,this.isVisible=!1,this.components=[],this.texMemoryUsage=0,this.vboMemoryUsage=0,this.cpuMemoryUsage=0,this.textures=[]}totalMemory(){return this.texMemoryUsage+this.vboMemoryUsage+this.cpuMemoryUsage}}function Ee(s){return Math.round(s/1048.576)/1e3}let oe=class extends((0,N.A)(Ze.Z)){constructor(){super(...arguments),this.type="integrated-mesh-3dtiles",this._visibleGeometryChangedSchedulerHandle=null,this._wasmLayerId=-1,this.ignoresMemoryFactor=!1,this.drapeTargetType=$.al.WithoutRasterImage,this._lyrHandleToObjects=new Map,this._initialCullFace=new Map,this._suspendedHandle=null,this._dbgFlags=new Set}initialize(){if(this._dbgFlags.add(A.Error),this._dbg(A.VerboseAPI,"Tiles3DLayerView3D initialize() called"),!this._canProjectWithoutEngine())throw new v.Z("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});const s=(0,F.JF)(this).then(t=>{this._intersectionHandler=new we(this),this.view.sceneIntersectionHelper.addIntersectionHandler(this._intersectionHandler),this._updatingHandles.add(()=>this.slicePlaneEnabled,l=>this._slicePlaneEnabledChange(l)),this._elevationProvider=new ae.u({view:this.view,layerElevationSource:this,intersectionHandler:this._intersectionHandler}),this.view.elevationProvider.register("im",this._elevationProvider),this.view.basemapTerrain.overlayManager.registerDrapeTarget(this),this._wasmLayerId=t;const o=this.view.resourceController.memoryController.newCache(`t3d-${this.uid}`,l=>this._onRemoveFromCache(l));this._memCache=o,this._suspendedHandle=(0,I.YP)(()=>this.suspended,l=>{const u=(0,F.WM)(this.view);u&&u.setEnabled(this,!l)},I.nn),this.addHandles([(0,I.YP)(()=>this.layer.elevationInfo,l=>this._elevationInfoChanged(l))])}).catch(t=>{if((0,F.mq)(this),this._wasmLayerId=-1,t===r.Q3)throw new v.Z("tiles3d:addLayer-failure","The 3d tiles layer description was invalid.",{});if(t===r.Em)throw new v.Z("tiles3d:addLayer-failure","The 3d tiles layer web assembly module failed to download.",{})});this.addResolvingPromise(s)}destroy(){this._dbg(A.VerboseAPI,"Tiles3DLayerView3D destroy() called"),(0,F.mq)(this),this._suspendedHandle&&(this._suspendedHandle.remove(),this._suspendedHandle=null),this._intersectionHandler&&(this.view.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler),this._intersectionHandler=null),this._elevationProvider&&(this._elevationProvider.objectsChanged(this._obbs),this.view.elevationProvider.unregister(this._elevationProvider),this._elevationProvider=null),this.view.basemapTerrain.overlayManager.unregisterDrapeTarget(this),this._lyrHandleToObjects.forEach(s=>this.freeObject(s)),this._lyrHandleToObjects.clear(),this._initialCullFace.clear(),this._memCache=(0,S.SC)(this._memCache),this._updatingHandles=(0,S.SC)(this._updatingHandles),this.emit("visible-geometry-changed"),this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null)}_visibleGeometryChanged(){null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=(0,L.Os)(()=>{this.emit("visible-geometry-changed"),this._visibleGeometryChangedSchedulerHandle=null}))}_slicePlaneEnabledChange(s){this._intersectionHandler&&(this._intersectionHandler.slicePlaneEnabled=s),this.objects.forEach(t=>{const o=this._collection.getMaterial(t);o.commonMaterialParameters.hasSlicePlane=s,o.commonMaterialParameters.cullFace=s?w.Vr.None:this._initialCullFace.get(t)})}_elevationInfoChanged(s){const t=s?.offset??0,o=s?.unit?(0,ue.Z7)(s?.unit):1,l=(0,F.WM)(this.view);l&&l.setLayerOffset(this,t*o)}get _obbs(){return this.objects.map(s=>this._collection.getComponentObb(s))}get wasmLayerId(){return this._wasmLayerId}get usedMemory(){let s=0;return this._lyrHandleToObjects.forEach(t=>{t.isVisible&&(s+=t.totalMemory())}),s}get unloadedMemory(){let s=0;return this._lyrHandleToObjects.forEach(t=>{t.isVisible||(s+=t.totalMemory())}),s}get performanceInfo(){let s=0,t=0,o=0,l=0,u=0,h=0;return this._lyrHandleToObjects.forEach(d=>{d.isVisible?(s+=d.texMemoryUsage,t+=d.vboMemoryUsage,u++):(o+=d.texMemoryUsage,l+=d.vboMemoryUsage,h++)}),new q(this.usedMemory,u,h,Ee(t),Ee(s),Ee(l),Ee(o))}_canProjectWithoutEngine(){if(this.view.state.viewingMode===M.JY.Local){const s=this.view.renderSpatialReference?.isWebMercator?3857:this.view.renderSpatialReference?.wkid??-1;if(3857!==s&&32662!==s)return!1}return!0}get _stage(){return this.view._stage}get _collection(){return this._stage.renderView.componentObjectCollection}get elevationOffset(){return(this.layer.elevationInfo?.offset??0)*(this.layer.elevationInfo?.unit?(0,ue.Z7)(this.layer.elevationInfo.unit):1)}get elevationRange(){const s=this.fullExtent;return s?.zmin&&s?.zmax?new We.r(s.zmin,s.zmax):null}getElevationRange(s){return null}get fullExtent(){return this.layer.fullExtent}get objects(){return Array.from(this._lyrHandleToObjects.values()).reduce((s,t)=>s.concat(t.components),new Array)}isUpdating(){const s=(0,F.WM)(this.view);return!(this._wasmLayerId<0||null==s)&&s.isUpdating(this._wasmLayerId)}updatingFlagChanged(){this.notifyChange("updating")}createRenderable(s){var t=this;return(0,y.Z)(function*(){const o=s.meshData;if(null==o.data)throw new Error("meshData.data undefined");if(o.desc=JSON.parse(o.desc),null==o.desc)throw new Error("meshData.desc undefined");const l=(0,B.nI)(o.desc.origin),u=new Array,h=new Map,d=new Qe;d.handle=s.handle,t._lyrHandleToObjects.set(s.handle,d);const j=t.view.basemapTerrain.spatialReference;let D,G;if("global"===t.view.viewingMode){const i=(0,a.Ue)();(0,Y.B)(ne.kU,l,i,j),D=(0,E.xO)((0,_.Ue)(),i),G=(0,E.U_)((0,_.Ue)(),D)}else D=_.Wd,G=_.Wd;const O=(0,a.Ue)();(0,g.Iu)(O,O,l);const b=(0,g.i0)((0,B.Ue)(),O);let P=null;const p=(0,B.Ue)();for(let i=0;i<o.desc.prims.length;i++){const x=o.desc.prims[i];if(x.ptype!==r.AQ.Lines||null==o.data)continue;const{positionView:f,positionAttr:se,indicesView:k}=t.getBufferViews(x,o.data.buffer,D,!1);null!=se&&null!=f&&null!=k&&(P=(0,xe.Qb)(se),(0,U.g)(p,P.center,l),P.center=p)}for(let i=0;i<o.desc.prims.length;i++){const x=o.desc.prims[i];if(t._dbg(A.VerboseAPI,JSON.stringify(x)),x.ptype===r.AQ.Lines)continue;if(null==Z[x.ptype]||null==o.data){t._dbg(A.VerboseAPI,"[Unsupported Feature] Unsupported primitive mode ("+x.ptype+"). Skipping primitive.");continue}const f=o.desc?.materials&&null!=x.materialId?o.desc.materials[x.materialId]:null,se=null!=f?f.lightingModel:r.jE.Unlit,k=se!==r.jE.Unlit,{positionView:z,positionAttr:ee,normalsView:$e,normalsAttr:Oe,colorAttr:fe,texCoord0Attr:ge,indicesView:le}=t.getBufferViews(x,o.data.buffer,D,k);if(null==ee||null==z||null==le)continue;const Ae={colors:null!=fe,textureCoordinates:null!=ge?Ie.N.Default:Ie.N.None,hasNormals:null!=$e,needsNormals:k},Xe=ee.data.length/ee.size,be=(n,X)=>!n||n.data.length/n.size===Xe||(t._dbg(A.Error,`${X} !== numPos. Skipping primitive.`),!1);if(!be(ge,"numTexcoord")||!be(fe,"numColors")||!be(Oe,"normals"))continue;const je=(0,Ve.N)(Ae);let de;if(null!=P?de=P.clone():(de=(0,xe.Qb)(ee),(0,U.g)(p,de.center,l),de.center=p),D!==_.Wd)for(let n=0;n<z.count;n++)z.getVec(n,p),(0,U.t)(p,p,D),z.setVec(n,p);const Re=je.createBuffer(ee.data.length),ye=new Map([[ve.T.POSITION,ee]]);null!=ge&&ye.set(ve.T.UV0,ge),null!=fe&&ye.set(ve.T.COLOR,fe),null!=Oe&&ye.set(ve.T.NORMALCOMPRESSED,Oe),ye.forEach((n,X)=>{null!=n&&(0,ze.i9)(X,n,null,null,Re,0)});const Ye=new Uint32Array([0,le.typedBuffer.length]),ke={vertices:{data:Re.buffer,count:Re.byteLength/je.stride,layoutParameters:Ae},positionData:{positions:z.typedBuffer,indices:le.typedBuffer},indices:le.typedBuffer,componentOffsets:Ye};d.cpuMemoryUsage+=z.count,d.cpuMemoryUsage+=le.count;const Le=t.view.renderSpatialReference,Te=(0,B.Ue)(),Ue=[1,1,1];(0,te.X)(b,Le,Ue,j)||t._dbg(A.Error,"Unsupported coordinate system for IM overlay"),(0,ce.S)(b,Le,Te,j);const Me=t._collection.createObject({toMapSpace:(0,J.al)(Te[0],Te[1],Ue[0],Ue[1]),geometry:ke,obb:de,transform:{position:b,rotationScale:G}});f&&t._collection.updateMaterial(Me,n=>{n.baseColor=f.baseColorFactor,n.usePBR=se===r.jE.Pbr,n.hasParametersFromSource=!1,n.baseColorTexture=t._getTexture(f.baseColorTex,o,h),n.usePBR&&(n.mrrFactors=[f.metallicFactor,f.roughnessFactor,0],n.emissiveFactor=f.emissiveFactor??[0,0,0],n.metallicRoughnessTexture=t._getTexture(f.metalTex,o,h),n.emissionTexture=t._getTexture(f.emissiveTex,o,h),n.occlusionTexture=t._getTexture(f.occlusionTex,o,h),n.normalTexture=t._getTexture(f.normalTex,o,h)),n.objectOpacity=0,n.alphaDiscardMode=w.JJ.Mask;const X=[];n.baseColorTexture&&X.push(n.baseColorTexture.loadPromise),n.usePBR&&n.metallicRoughnessTexture&&X.push(n.metallicRoughnessTexture.loadPromise),n.usePBR&&n.emissionTexture&&X.push(n.emissionTexture.loadPromise),n.usePBR&&n.occlusionTexture&&X.push(n.occlusionTexture.loadPromise),n.usePBR&&n.normalTexture&&X.push(n.normalTexture.loadPromise);const Be=Promise.all(X);u.push(Be),Be.then(()=>{n.alphaDiscardMode=ie[f.alphaMode],n.objectOpacity=1,d.texMemoryUsage+=n.baseColorTexture?.glTexture?.usedMemory||0,n.usePBR&&(d.texMemoryUsage+=n.metallicRoughnessTexture?.glTexture?.usedMemory||0,d.texMemoryUsage+=n.emissionTexture?.glTexture?.usedMemory||0,d.texMemoryUsage+=n.occlusionTexture?.glTexture?.usedMemory||0,d.texMemoryUsage+=n.normalTexture?.glTexture?.usedMemory||0)}),n.commonMaterialParameters.doubleSided=f.isDoubleSided,n.commonMaterialParameters.cullFace=f.faceCulling?he[f.faceCulling]:w.Vr.Back,t._initialCullFace.set(Me,n.commonMaterialParameters.cullFace),n.commonMaterialParameters.hasSlicePlane=t.slicePlaneEnabled,n.componentParameters.castShadows=He.ws.All,n.textureAlphaCutoff=f.alphaCutoff??.1,n.alphaDiscardMode=ie[f.alphaMode],n.isIntegratedMesh=!0,n.polygonOffsetEnabled=!1,n.hasOccludees=!1,n.ellipsoidMode=(0,Ke.j)(t.view.spatialReference)}),d.components.push(Me),d.vboMemoryUsage+=t._collection.getObjectGPUMemoryUsage(Me)}if(yield Promise.all(u),h.forEach(i=>{d.textures.push(i)}),!t._memCache)throw new Error("no memCache");return t._memCache.put(`${d.handle}`,d,d.totalMemory()),{memUsageBytes:d.totalMemory()}})()}freeRenderable(s){const t=this._lyrHandleToObjects.get(s);t&&(this.freeObject(t),this._lyrHandleToObjects.delete(s))}freeObject(s){this._memCache&&this._memCache.pop(`${s.handle}`),s.components.forEach(t=>{s.textures.forEach(o=>{this._stage.remove(o)}),this._collection.destroyObject(t),this._initialCullFace.delete(t)})}setRenderableVisibility(s,t,o){if(this._memCache){for(let l=0;l<o;++l){const u=s[l],h=t[l];if(!h)continue;const d=this._lyrHandleToObjects.get(u);d&&(this._visibleGeometryChanged(),d.isVisible=h,d.components.forEach(j=>{this._collection.setObjectVisibility(j,h),this._elevationProvider.objectChanged(this._collection.getComponentObb(j))}),this._memCache.pop(`${u}`))}for(let l=0;l<o;++l){const u=s[l],h=t[l];if(h)continue;const d=this._lyrHandleToObjects.get(u);d&&(this._visibleGeometryChanged(),d.isVisible=h,d.components.forEach(j=>{this._collection.setObjectVisibility(j,h),this._elevationProvider.objectChanged(this._collection.getComponentObb(j))}),this._memCache.put(`${u}`,d,d.totalMemory()))}}}_getTexture(s,t,o){let l=null;if(s&&t.desc?.images&&t.data?.buffer){const u=t.desc.images[s?.imageId];if(l=o.get(u),!l&&u){const h=this._stage.renderView.renderingContext.parameters.maxMaxAnisotropy,d=h>1,j=Pe[s.wrapMode??r.$1.None];let D=u.alpha?4:3;const G=new Uint8Array(t.data.buffer,u.data.byteOffset,u.data.byteCount);let O=null,b=null,P=null;switch(u.format){case r.l7.Raw:u.pixelFormat===r.aw.R8?(O=G.buffer,D=1,b=""):u.pixelFormat===r.aw.Rgb8?(O=G.buffer,D=3,b=""):u.pixelFormat===r.aw.Rgba8&&(O=G.buffer,D=4,b="");break;case r.l7.Dxt1:O=G.buffer,D=3,b=w.Ti.DDS_ENCODING;break;case r.l7.Dxt5:O=G.buffer,D=4,b=w.Ti.DDS_ENCODING;break;case r.l7.Png:b="image/png",P=document.createElement("img");break;case r.l7.Jpeg:b="image/jpeg",P=document.createElement("img");break;case r.l7.Etc2:b="image/ktx",P=document.createElement("img");break;case r.l7.Astc:this._dbg(A.Error,"Astc texture not supported");break;case r.l7.Pvrtc:this._dbg(A.Error,"Pvrtc texture not supported")}if(P&&b){const p=new Blob([G],{type:b});P.src=URL.createObjectURL(p),O=P}O&&null!=b&&(l=new Ne.x(O,{mipmap:d,maxAnisotropy:h,encoding:b,wrap:j,components:D,noUnpackFlip:!0,width:u.mip0Width,height:u.mip0Height}),this._stage.add(l),o.set(u,l))}}return l?new Fe.T(this.view._stage.renderView.textureRepository,l.id):null}getBufferViews(s,t,o,l){let u,h,d,j,D,G,O,b=null;for(let P=0;P<s.atrbs.length;P++){const p=s.atrbs[P],i=p.view,x=void 0,f=i.byteOffset+i.byteCount,k=[...Array(i.byteCount/Ce[i.type]).keys()].map(z=>z);try{switch(p.sem){case r.Lz.Position:3!==i.ncomp||i.type!==r.MB.F32?this._dbg(A.Error,"[Unsupported Feature] Unsupported view for Position ("+i+")"):(u=new R.ct(t,i.byteOffset,x,f),h=new pe.a(u.typedBuffer,k,3));break;case r.Lz.Normal:if(3!==i.ncomp||i.type!==r.MB.F32)this._dbg(A.Error,"[Unsupported Feature] Unsupported view for Normal ("+i+")");else if(l){const z=new R.ct(t,i.byteOffset,x,f),ee=(0,Ge.Pj)(z.typedBuffer,o);D=new R.o7(ee),G=new pe.a(D.typedBuffer,k,2)}break;case r.Lz.TexCoord:2!==i.ncomp||i.type!==r.MB.F32?this._dbg(A.Error,"[Unsupported Feature] Unsupported view for Texcoord ("+i+")"):void 0===j&&(j=new pe.a(new R.Eu(t,i.byteOffset,x,f).typedBuffer,k,2));break;case r.Lz.Color:4===i.ncomp?(i.type===r.MB.F32&&(b=new R.ek(t,i.byteOffset,x,f)),i.type===r.MB.U8&&(b=new R.mc(t,i.byteOffset,x,f)),i.type===r.MB.U16&&(b=new R.v6(t,i.byteOffset,x,f))):3===i.ncomp&&(i.type===r.MB.F32&&(b=new R.ct(t,i.byteOffset,x,f)),i.type===r.MB.U8&&(b=new R.ne(t,i.byteOffset,x,f)),i.type===r.MB.U16&&(b=new R.mw(t,i.byteOffset,x,f))),null==b?this._dbg(A.VerboseAPI,"[Unsupported Feature] Unsupported view for Color ("+i+")"):d=new pe.a(b.typedBuffer,k,i.ncomp);break;case r.Lz.FeatureIndex:break;default:this._dbg(A.VerboseAPI,"[Unsupported Feature] Unsupported semantic ("+p.sem+"). Skipping vertex attribute.")}}catch(z){this._dbg(A.VerboseAPI,"Error Creating buffer ("+z+"). Skipping vertex attribute.")}}if(s.index){const P=s.index.view,p=void 0,i=P.byteOffset+P.byteCount;switch(s.index.view.type){case r.MB.U16:O=new R.av(t,P.byteOffset,p,i);break;case r.MB.U32:O=new R.Nu(t,P.byteOffset,p,i);break;default:this._dbg(A.Error,"[Unsupported Feature] index type not supported ("+P.type+").")}}if(null==O&&null!=u){const P=u.count;if(P<65535){const p=new Uint16Array(P);O=new R.av(p)}else{const p=new Uint32Array(P);O=new R.Nu(p)}for(let p=0;p<P;p++)O.set(p,p)}return{positionView:u,positionAttr:h,colorAttr:d,texCoord0Attr:j,indicesView:O,normalsView:D,normalsAttr:G}}_onRemoveFromCache(s){const t=(0,F.WM)(this.view);t&&t.onRenderableEvicted(this,s.handle,s.totalMemory()),this.freeRenderable(s.handle)}_dbg(s,t){this._dbgFlags.has(s)&&(s===A.Error?V.Z.getLogger(this).error(t):V.Z.getLogger(this).warn(t))}};(0,m._)([(0,c.Cb)()],oe.prototype,"_visibleGeometryChangedSchedulerHandle",void 0),(0,m._)([(0,c.Cb)()],oe.prototype,"layer",void 0),(0,m._)([(0,c.Cb)()],oe.prototype,"elevationOffset",null),oe=(0,m._)([(0,T.j)("esri.views.3d.layers.Tiles3DLayerView3D")],oe);const Je=oe},19702:(re,W,e)=>{e.d(W,{A:()=>E});var y=e(15861),m=e(17626),v=e(54024),V=e(10699),S=e(32917),I=e(77712),C=(e(8314),e(63290),e(4619),e(76898)),T=e(36947);const E=_=>{let g=class extends _{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(a){super.postscript(a),(0,T.qC)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}_validateHeightModelInfo(){var a=this;return(0,y.Z)(function*(){const U=new AbortController,B=U.signal;a.addHandles((0,v.kB)(()=>U.abort())),yield(0,S.N1)(()=>a.view.defaultsFromMap?.heightModelInfoReady,B),(0,V.k_)(B);const J=(0,T.Wt)(a.layer,a.view.heightModelInfo,a.supportsHeightUnitConversion);if(J)throw J})()}canResume(){const a=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return super.canResume()&&(!a?.minScale||!a.maxScale||a.minScale>=a.maxScale)}getSuspendInfo(){const a=super.getSuspendInfo(),U=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return U&&U.minScale&&U.maxScale&&U.minScale<U.maxScale&&(a.outsideScaleRange=!0),a}};return(0,m._)([(0,I.Cb)()],g.prototype,"view",void 0),(0,m._)([(0,I.Cb)()],g.prototype,"slicePlaneEnabled",void 0),g=(0,m._)([(0,C.j)("esri.views.3d.layers.LayerView3D")],g),g}},46884:(re,W,e)=>{e.d(W,{u:()=>Y});var y=e(17626),m=e(83761),v=e(61885),V=e(63290),S=e(77712),c=(e(8314),e(4619),e(76898)),Q=e(52113),C=e(74741),T=e(79800),E=e(29302),_=e(15869),g=e(65401),a=e(97126),U=e(74993),B=e(21358),J=e(62483),ne=e(67857);let Y=class extends(v.Z.EventedMixin(m.Z)){constructor(M){super(M),this._tmpEvent=new B.c,this._renderCoordsHelper=M.view.renderCoordsHelper,this._renderSR=this._renderCoordsHelper.spatialReference,this._layerElevationSource=M.layerElevationSource}initialize(){this._intersector=(0,J.Z8)(this.view.state.viewingMode),this._intersector.options.store=ne.eC.MIN,this._tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"}get spatialReference(){return this.view?.elevationProvider?.spatialReference}getElevation(M,H,q,$){const N=this._renderCoordsHelper,F=(0,T.s)(R,M,H,q);if(!N.toRenderCoords(F,$,F))return V.Z.getLogger(this).error("could not project point to compute elevation"),null;const{layerElevationSource:ae,_intersector:w,intersectionHandler:K}=this,Z=ae.fullExtent,ie=null!=Z&&Number.isFinite(Z.xmin)&&Number.isFinite(Z.xmax)&&Number.isFinite(Z.ymin)&&Number.isFinite(Z.ymax)&&Number.isFinite(Z.zmin)&&Number.isFinite(Z.zmax)?new U.r(Z.zmin,Z.zmax):ae.elevationRange;if(null==ie)return null;const he=ae.elevationOffset,Pe=ie.elevationRangeMin+he,me=N.setAltitude(r,ie.elevationRangeMax+he,F),_e=N.setAltitude(ue,Pe,F);return w.reset(me,_e,null),K.intersect(w,null,me,_e,null,!0),w.results.min.getIntersectionPoint(F)?N.getAltitude(F):null}getSphereElevationBounds(M,H){return(0,_.s)(M,H,ce,this._renderSR),this._layerElevationSource.getElevationRange(ce)}getRootElevationBounds(){const M=this.layerElevationSource.fullExtent;return M?.hasZ?new U.r(M.zmin,M.zmax):null}objectsChanged(M){this.spatialReference&&(this._computeLayerExtent(M,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}objectChanged(M){this.spatialReference&&(this._computeObjectExtent(M,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}_computeObjectExtent(M,H){(0,g.cS)(H),this._expandExtent(M,H)}_computeLayerExtent(M,H){(0,g.cS)(H);for(const q of M)this._expandExtent(q,H)}_expandExtent(M,H){const q=this.spatialReference;if(null==q||null==M)return;(0,Q.en)(te,M.quaternion),te[12]=M.center[0],te[13]=M.center[1],te[14]=M.center[2];const $=M.halfSize;for(let N=0;N<8;++N)R[0]=1&N?$[0]:-$[0],R[1]=2&N?$[1]:-$[1],R[2]=4&N?$[2]:-$[2],(0,T.e)(R,R,te),this._renderCoordsHelper.fromRenderCoords(R,R,q),(0,g.jn)(H,R,H)}};(0,y._)([(0,S.Cb)({constructOnly:!0})],Y.prototype,"layerElevationSource",void 0),(0,y._)([(0,S.Cb)({constructOnly:!0})],Y.prototype,"intersectionHandler",void 0),(0,y._)([(0,S.Cb)({constructOnly:!0})],Y.prototype,"view",void 0),(0,y._)([(0,S.Cb)()],Y.prototype,"spatialReference",null),Y=(0,y._)([(0,c.j)("esri.views.3d.layers.i3s.LayerElevationProvider")],Y);const te=(0,C.Ue)(),ce=(0,a.f)(0,0,0,0),R=(0,E.Ue)(),r=(0,E.Ue)(),ue=(0,E.Ue)()},52051:(re,W,e)=>{e.d(W,{T:()=>v});var y=e(62208),m=e(10699);class v{constructor(S,I){this._textureRep=S,this.loadPromise=null,this._disposed=!1;const L=this._textureRep.acquire(I);(0,m.y8)(L)?(L.then(c=>{this._disposed?(0,y.RY)(c):this._textureRef=c}),this.loadPromise=L):this._textureRef=L}dispose(){this._textureRef=(0,y.RY)(this._textureRef),this._disposed=!0}get glTexture(){return null!=this._textureRef?this._textureRef.glTexture:null}}},45611:(re,W,e)=>{e.d(W,{Z:()=>g});var y=e(17626),m=e(83761),v=e(61885),V=e(61996),S=e(63290),I=e(62208),L=e(60330),c=e(77712),T=(e(8314),e(4619),e(76898)),E=e(11426);let _=class extends((0,V.IG)((0,L.v)(v.Z.EventedMixin(m.Z)))){constructor(a){super(a),this._updatingHandles=new E.R,this.layer=null,this.parent=null}initialize(){this.when().catch(a=>{if("layerview:create-error"!==a.name){const U=this.layer&&this.layer.id||"no id",B=this.layer?.title||"no title";S.Z.getLogger(this).error("#resolve()",`Failed to resolve layer view (layer title: '${B}', id: '${U}')`,a)}})}destroy(){this._updatingHandles=(0,I.SC)(this._updatingHandles)}get fullOpacity(){return(this.layer?.opacity??1)*(this.parent?.fullOpacity??1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer?.legendEnabled}get updating(){return!(!this._updatingHandles?.updating&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){return!0===this.layer?.visible}set visible(a){this._overrideIfSome("visible",a)}canResume(){return this.visible&&this.layer?.loaded&&!this.parent?.suspended&&this.view?.ready||!1}getSuspendInfo(){const a=this.parent?.suspended?this.parent.suspendInfo:{};return this.view?.ready||(a.viewNotReady=!0),this.layer&&this.layer.loaded||(a.layerNotLoaded=!0),this.visible||(a.layerInvisible=!0),a}isUpdating(){return!1}};(0,y._)([(0,c.Cb)()],_.prototype,"fullOpacity",null),(0,y._)([(0,c.Cb)()],_.prototype,"layer",void 0),(0,y._)([(0,c.Cb)()],_.prototype,"parent",void 0),(0,y._)([(0,c.Cb)({readOnly:!0})],_.prototype,"suspended",null),(0,y._)([(0,c.Cb)({readOnly:!0})],_.prototype,"suspendInfo",null),(0,y._)([(0,c.Cb)({readOnly:!0})],_.prototype,"legendEnabled",null),(0,y._)([(0,c.Cb)({type:Boolean,readOnly:!0})],_.prototype,"updating",null),(0,y._)([(0,c.Cb)({readOnly:!0})],_.prototype,"updatingProgress",null),(0,y._)([(0,c.Cb)()],_.prototype,"visible",null),(0,y._)([(0,c.Cb)()],_.prototype,"view",void 0),_=(0,y._)([(0,T.j)("esri.views.layers.LayerView")],_);const g=_}}]);