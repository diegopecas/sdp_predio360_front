"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[3740],{3740:(Z,p,o)=>{o.r(p),o.d(p,{assetMapFromAssetMapsJSON:()=>O,extractMesh:()=>h,meshFeatureSetFromJSON:()=>R});var g=o(88879),y=o(63290),M=o(88159),d=o(2004),D=o(15453),L=o(72642),T=o(65234),I=o(99746),P=o(96603),S=o(35391),A=o(17253);const m=()=>y.Z.getLogger("esri.rest.support.meshFeatureSet");function R(t,e,r){const s=r.features;r.features=[],delete r.geometryType;const n=A.Z.fromJSON(r);if(n.geometryType="mesh",!r.assetMaps)return n;const a=O(e,r.assetMaps),i=t.sourceSpatialReference??T.Z.WGS84,c=r.globalIdFieldName,{outFields:u}=t,E=null!=u&&u.length>0?function v(t){return({attributes:e})=>{if(!e)return{};if(!t)return e;for(const r in e)t.has(r)||delete e[r];return e}}(u.includes("*")?null:new Set(u)):()=>({});for(const f of s){const l=h(f,c,i,e,a);null!=l&&n.features.push(new g.Z({geometry:l,attributes:E(f)}))}return n}function h(t,e,r,s,n){const i=n.get(t.attributes[e]);if(null==i)return m().error("mesh-feature-set:asset-not-found","Service returned a feature which was not found in the asset map",t),null;if(!t.geometry)return m().error("mesh-feature-set:no-geometry","Service returned a feature without geometry",t),null;const c=function C({attributes:t},e,{transformFieldRoles:r}){return new L.Z({x:t[r.originX],y:t[r.originY],z:t[r.originZ],spatialReference:e})}(t,r,s),u=d.Z.fromJSON(t.geometry);u.spatialReference=r;const E=function U(t,{transformFieldRoles:e}){return new I.Z({translation:[t[e.translationX],-t[e.translationZ],t[e.translationY]],rotationAxis:[t[e.rotationX],-t[e.rotationZ],t[e.rotationY]],rotationAngle:t[e.rotationDeg],scale:[t[e.scaleX],t[e.scaleZ],t[e.scaleY]]})}(t.attributes,s),f=r.isGeographic?"local":"georeferenced",l=function F(t){const e=Array.from(t.files.values()),r=new Array;for(const s of e){if(s.status!==_.COMPLETED)return null;const n=new Array;for(const a of s.parts){if(!a)return null;n.push(new P.LL(a.url,a.hash))}r.push(new P.CP(s.name,s.mimeType,n))}return r}(i);return l?D.Z.createWithExternalSource(c,l,{extent:u,transform:E,vertexSpace:f}):D.Z.createIncomplete(c,{extent:u,transform:E,vertexSpace:f})}var _,t;function O(t,e){const r=new Map;for(const s of e){const n=s.parentGlobalId;if(null==n)continue;const a=s.assetName,i=s.assetType,c=s.assetHash,u=s.assetURL,E=s.conversionStatus,f=s.seqNo,l=(0,S.d1)(i,t.supportedFormats);if(!l){m().error("mesh-feature-set:unknown-format",`Service returned an asset of type ${i}, but it does not list it as a supported type`);continue}const W=(0,M.s1)(r,n,()=>({files:new Map}));(0,M.s1)(W.files,a,()=>({name:a,type:i,mimeType:l,status:N(E),parts:[]})).parts[f]={hash:c,url:u}}return r}function N(t){switch(t){case"COMPLETED":case"SUBMITTED":return _.COMPLETED;case"INPROGRESS":return _.PENDING;default:return _.FAILED}}(t=_||(_={}))[t.FAILED=0]="FAILED",t[t.PENDING=1]="PENDING",t[t.COMPLETED=2]="COMPLETED"}}]);