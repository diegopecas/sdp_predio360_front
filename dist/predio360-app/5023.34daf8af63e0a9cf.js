"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[5023],{1268:(X,G,a)=>{a.d(G,{EE:()=>u,R:()=>_,_5:()=>j,aF:()=>I,f2:()=>r,fD:()=>S,fR:()=>B,nR:()=>f,r1:()=>n,vL:()=>U});var B,u,_,I,U,f,j,S,n,t,M=a(7547);(t=B||(B={}))[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE",function(t){t[t.VISIBLE=0]="VISIBLE",t[t.NONE=1]="NONE"}(u||(u={})),function(t){t[t.POINT=0]="POINT",t[t.LINE=1]="LINE",t[t.LINE_CENTER=2]="LINE_CENTER"}(_||(_={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT",t[t.AUTO=2]="AUTO"}(I||(I={})),function(t){t[t.AUTO=0]="AUTO",t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT"}(U||(U={})),function(t){t[t.CENTER=0]="CENTER",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.TOP_LEFT=5]="TOP_LEFT",t[t.TOP_RIGHT=6]="TOP_RIGHT",t[t.BOTTOM_LEFT=7]="BOTTOM_LEFT",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(f||(f={})),function(t){t[t.NONE=0]="NONE",t[t.UPPERCASE=1]="UPPERCASE",t[t.LOWERCASE=2]="LOWERCASE"}(j||(j={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT"}(S||(S={})),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(n||(n={}));class r{}r.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:u.VISIBLE}},r.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:u.VISIBLE}},r.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:u.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:M.RL.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:M.AH.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},r.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:u.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:_.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:f.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:I.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:f.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:U.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:I.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:j.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[n.HORIZONTAL]}},r.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:u.VISIBLE}},r.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},r.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:S.MAP}},r.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:S.MAP},"line-width":{type:"number",minimum:0,default:1}},r.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:S.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:S.MAP}},r.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},r.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:S.MAP}}},43289:(X,G,a)=>{a.d(G,{k3:()=>f,s5:()=>U}),Math;const B=256/360,u=1/Math.LN2;function U(n){return function _(n,r){return(n%=r)>=0?n:n+r}(n*B,256)}function f(n){return Math.log(n)*u}},62856:(X,G,a)=>{a.d(G,{Z:()=>M});class M{constructor(){this.name=this.constructor.name||"UnnamedBrush",this.brushEffect=null}prepareState(u,_){}draw(u,_,I){}drawMany(u,_,I){for(const U of _)U.visible&&this.draw(u,U,I)}}},66420:(X,G,a)=>{a.d(G,{J:()=>t});var M=a(21286),B=a(62208),u=a(49966),_=a(67709),I=a(39351),U=a(39406),f=a(5254),j=a(62856),S=a(83994),n=a(67969),r=a(49353);class t extends j.Z{constructor(){super(...arguments),this._color=(0,_.f)(1,0,0,1),this._patternMatrix=(0,u.c)(),this._programOptions={id:!1,pattern:!1}}dispose(){this._vao&&(this._vao.dispose(),this._vao=null)}drawMany(p,o){const{context:v,painter:g,styleLayerUID:i,requestRender:e,allowDelayedRender:R}=p;this._loadWGLResources(p);const m=p.displayLevel,D=p.styleLayer,V=D.backgroundMaterial,K=g.vectorTilesMaterialManager,x=D.getPaintValue("background-color",m),W=D.getPaintValue("background-opacity",m),O=D.getPaintValue("background-pattern",m),N=void 0!==O,c=x[3]*W,b=1|window.devicePixelRatio,l=p.spriteMosaic;let y,A;const w=b>I.a?2:1,P=p.drawPhase===U.jx.HITTEST,T=this._programOptions;T.id=P,T.pattern=N;const d=K.getMaterialProgram(v,V,T);if(R&&(0,B.pC)(e)&&!d.compiled)e();else{if(v.bindVAO(this._vao),v.useProgram(d),N){const s=l.getMosaicItemPosition(O,!0);if((0,B.pC)(s)){const{tl:E,br:h,page:C}=s;y=h[0]-E[0],A=h[1]-E[1];const z=l.getPageSize(C);(0,B.pC)(z)&&(l.bind(v,n.cw.LINEAR,C,I.V4),d.setUniform4f("u_tlbr",E[0],E[1],h[0],h[1]),d.setUniform2fv("u_mosaicSize",z),d.setUniform1i("u_texture",I.V4))}d.setUniform1f("u_opacity",W)}else this._color[0]=c*x[0],this._color[1]=c*x[1],this._color[2]=c*x[2],this._color[3]=c,d.setUniform4fv("u_color",this._color);if(d.setUniform1f("u_depth",D.z||0),P){const s=(0,f.Au)(i+1);d.setUniform4fv("u_id",s)}for(const s of o){if(d.setUniform1f("u_coord_range",s.rangeX),d.setUniformMatrix3fv("u_dvsMat3",s.transforms.dvs),N){const E=Math.max(2**(Math.round(m)-s.key.level),1),h=w*s.width*E,C=h/(0,M.fp)(y),z=h/(0,M.fp)(A);this._patternMatrix[0]=C,this._patternMatrix[4]=z,d.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)}v.setStencilFunction(n.wb.EQUAL,0,255),v.drawArrays(n.MX.TRIANGLE_STRIP,0,4)}}}_loadWGLResources(p){if(this._vao)return;const{context:o,styleLayer:v}=p,g=v.backgroundMaterial,i=new Int8Array([0,0,1,0,0,1,1,1]),e=S.f.createVertex(o,n.l1.STATIC_DRAW,i),R=new r.U(o,g.getAttributeLocations(),g.getLayoutInfo(),{geometry:e});this._vao=R}}},68109:(X,G,a)=>{a.d(G,{j:()=>f});var M=a(62208),B=a(1268),u=a(39406),_=a(5254),I=a(62856),U=a(67969);class f extends I.Z{constructor(){super(...arguments),this._programOptions={id:!1}}dispose(){}drawMany(S,n){const{context:r,displayLevel:t,requiredLevel:L,state:p,drawPhase:o,painter:v,spriteMosaic:g,styleLayerUID:i,requestRender:e,allowDelayedRender:R}=S;if(!n.some(l=>l.layerData.get(i)?.circleIndexCount??!1))return;const m=S.styleLayer,D=m.circleMaterial,V=v.vectorTilesMaterialManager,x=m.getPaintValue("circle-translate",t),W=m.getPaintValue("circle-translate-anchor",t),O=o===u.jx.HITTEST,N=this._programOptions;N.id=O;const c=V.getMaterialProgram(r,D,N);if(R&&(0,M.pC)(e)&&!c.compiled)return void e();r.useProgram(c),c.setUniformMatrix3fv("u_displayMat3",W===B.fD.VIEWPORT?p.displayMat3:p.displayViewMat3),c.setUniform2fv("u_circleTranslation",x),c.setUniform1f("u_depth",m.z),c.setUniform1f("u_antialiasingWidth",1.2);let b=-1;if(O){const l=(0,_.Au)(i+1);c.setUniform4fv("u_id",l)}for(const l of n){if(!l.layerData.has(i))continue;l.key.level!==b&&(b=l.key.level,D.setDataUniforms(c,t,m,b,g));const y=l.layerData.get(i);if(!y.circleIndexCount)continue;y.prepareForRendering(r);const A=y.circleVertexArrayObject;(0,M.Wi)(A)||(r.bindVAO(A),c.setUniformMatrix3fv("u_dvsMat3",l.transforms.dvs),L!==l.key.level?r.setStencilFunction(U.wb.EQUAL,l.stencilRef,255):r.setStencilFunction(U.wb.GREATER,255,255),r.drawElements(U.MX.TRIANGLES,y.circleIndexCount,U.g.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*y.circleIndexStart),l.triangleCount+=y.circleIndexCount/3)}}}},11099:(X,G,a)=>{a.d(G,{R:()=>S});var M=a(62208),B=a(1268),u=a(39351),_=a(39406),I=a(5254),U=a(62856),f=a(67969);const j=1/65536;class S extends U.Z{constructor(){super(...arguments),this._fillProgramOptions={id:!1,pattern:!1},this._outlineProgramOptions={id:!1}}dispose(){}drawMany(r,t){const{displayLevel:L,drawPhase:p,renderPass:o,spriteMosaic:v,styleLayerUID:g}=r;let i=!1;for(const l of t)if(l.layerData.has(g)){const y=l.layerData.get(g);if(y.fillIndexCount>0||y.outlineIndexCount>0){i=!0;break}}if(!i)return;const e=r.styleLayer,R=e.getPaintProperty("fill-pattern"),m=void 0!==R,D=m&&R.isDataDriven;let V;if(m&&!D){const l=R.getValue(L);V=v.getMosaicItemPosition(l,!0)}const K=!m&&e.getPaintValue("fill-antialias",L);let O,x=!0,W=1;if(!m){const l=e.getPaintProperty("fill-color"),y=e.getPaintProperty("fill-opacity");if(!l?.isDataDriven&&!y?.isDataDriven){const A=e.getPaintValue("fill-color",L);W=e.getPaintValue("fill-opacity",L)*A[3],W>=1&&(x=!1)}}if(x&&"opaque"===o)return;p===_.jx.HITTEST&&(O=(0,I.Au)(g+1));const N=e.getPaintValue("fill-translate",L),c=e.getPaintValue("fill-translate-anchor",L);(x||"translucent"!==o)&&this._drawFill(r,g,e,t,N,c,m,V,D,O),K&&"opaque"!==o&&!(!e.hasDataDrivenOutlineColor&&e.outlineUsesFillColor&&W<1)&&this._drawOutline(r,g,e,t,N,c,O)}_drawFill(r,t,L,p,o,v,g,i,e,R){if(g&&!e&&(0,M.Wi)(i))return;const{context:m,displayLevel:D,state:V,drawPhase:K,painter:x,pixelRatio:W,spriteMosaic:O,requestRender:N,allowDelayedRender:c}=r,b=L.fillMaterial,l=x.vectorTilesMaterialManager,y=W>u.a?2:1,A=K===_.jx.HITTEST,w=this._fillProgramOptions;w.id=A,w.pattern=g;const P=l.getMaterialProgram(m,b,w);if(c&&(0,M.pC)(N)&&!P.compiled)return void N();if(m.useProgram(P),(0,M.pC)(i)){const{page:d}=i,s=O.getPageSize(d);(0,M.pC)(s)&&(O.bind(m,f.cw.LINEAR,d,u.V4),P.setUniform2fv("u_mosaicSize",s),P.setUniform1i("u_texture",u.V4))}P.setUniformMatrix3fv("u_displayMat3",v===B.fD.VIEWPORT?V.displayMat3:V.displayViewMat3),P.setUniform2fv("u_fillTranslation",o),P.setUniform1f("u_depth",L.z+j),A&&P.setUniform4fv("u_id",R);let T=-1;for(const d of p){if(!d.layerData.has(t))continue;d.key.level!==T&&(T=d.key.level,b.setDataUniforms(P,D,L,T,O));const s=d.layerData.get(t);if(!s.fillIndexCount)continue;s.prepareForRendering(m);const E=s.fillVertexArrayObject;if(!(0,M.Wi)(E)){if(m.bindVAO(E),P.setUniformMatrix3fv("u_dvsMat3",d.transforms.dvs),m.setStencilFunction(f.wb.EQUAL,d.stencilRef,255),g){const h=Math.max(2**(Math.round(D)-d.key.level),1);P.setUniform1f("u_patternFactor",d.rangeX/(y*d.width*h))}if(e){const h=s.patternMap;if(!h)continue;for(const[C,z]of h){const k=O.getPageSize(C);(0,M.pC)(k)&&(O.bind(m,f.cw.LINEAR,C,u.V4),P.setUniform2fv("u_mosaicSize",k),P.setUniform1i("u_texture",u.V4),m.drawElements(f.MX.TRIANGLES,z[1],f.g.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*z[0]))}}else m.drawElements(f.MX.TRIANGLES,s.fillIndexCount,f.g.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*s.fillIndexStart);d.triangleCount+=s.fillIndexCount/3}}}_drawOutline(r,t,L,p,o,v,g){const{context:i,displayLevel:e,state:R,drawPhase:m,painter:D,pixelRatio:V,spriteMosaic:K,requestRender:x,allowDelayedRender:W}=r,O=L.outlineMaterial,N=D.vectorTilesMaterialManager,c=.75/V,b=m===_.jx.HITTEST,l=this._outlineProgramOptions;l.id=b;const y=N.getMaterialProgram(i,O,l);if(W&&(0,M.pC)(x)&&!y.compiled)return void x();i.useProgram(y),y.setUniformMatrix3fv("u_displayMat3",v===B.fD.VIEWPORT?R.displayMat3:R.displayViewMat3),y.setUniform2fv("u_fillTranslation",o),y.setUniform1f("u_depth",L.z+j),y.setUniform1f("u_outline_width",c),b&&y.setUniform4fv("u_id",g);let A=-1;for(const w of p){if(!w.layerData.has(t))continue;w.key.level!==A&&(A=w.key.level,O.setDataUniforms(y,e,L,A,K));const P=w.layerData.get(t);if(P.prepareForRendering(i),!P.outlineIndexCount)continue;const T=P.outlineVertexArrayObject;(0,M.Wi)(T)||(i.bindVAO(T),y.setUniformMatrix3fv("u_dvsMat3",w.transforms.dvs),i.setStencilFunction(f.wb.EQUAL,w.stencilRef,255),i.drawElements(f.MX.TRIANGLES,P.outlineIndexCount,f.g.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*P.outlineIndexStart),w.triangleCount+=P.outlineIndexCount/3)}}}},69172:(X,G,a)=>{a.d(G,{z:()=>j});var M=a(62208),B=a(1268),u=a(39351),_=a(39406),I=a(5254),U=a(62856),f=a(67969);class j extends U.Z{constructor(){super(...arguments),this._programOptions={id:!1,pattern:!1,sdf:!1}}dispose(){}drawMany(n,r){const{context:t,displayLevel:L,state:p,drawPhase:o,painter:v,pixelRatio:g,spriteMosaic:i,styleLayerUID:e,requestRender:R,allowDelayedRender:m}=n;if(!r.some(s=>s.layerData.get(e)?.lineIndexCount??!1))return;const D=n.styleLayer,V=D.lineMaterial,K=v.vectorTilesMaterialManager,x=D.getPaintValue("line-translate",L),W=D.getPaintValue("line-translate-anchor",L),O=D.getPaintProperty("line-pattern"),N=void 0!==O,c=N&&O.isDataDriven;let b,l;if(N&&!c){const s=O.getValue(L);b=i.getMosaicItemPosition(s)}let y=!1;if(!N){const s=D.getPaintProperty("line-dasharray");if(l=void 0!==s,y=l&&s.isDataDriven,l&&!y){const E=s.getValue(L),h=D.getDashKey(E,D.getLayoutValue("line-cap",L));b=i.getMosaicItemPosition(h)}}const A=1/g,w=o===_.jx.HITTEST,P=this._programOptions;P.id=w,P.pattern=N,P.sdf=l;const T=K.getMaterialProgram(t,V,P);if(m&&(0,M.pC)(R)&&!T.compiled)return void R();if(t.useProgram(T),T.setUniformMatrix3fv("u_displayViewMat3",p.displayViewMat3),T.setUniformMatrix3fv("u_displayMat3",W===B.fD.VIEWPORT?p.displayMat3:p.displayViewMat3),T.setUniform2fv("u_lineTranslation",x),T.setUniform1f("u_depth",D.z),T.setUniform1f("u_antialiasing",A),w){const s=(0,I.Au)(e+1);T.setUniform4fv("u_id",s)}if(b&&(0,M.pC)(b)){const{page:s}=b,E=i.getPageSize(s);(0,M.pC)(E)&&(i.bind(t,f.cw.LINEAR,s,u.V4),T.setUniform2fv("u_mosaicSize",E),T.setUniform1i("u_texture",u.V4))}let d=-1;for(const s of r){if(!s.layerData.has(e))continue;s.key.level!==d&&(d=s.key.level,V.setDataUniforms(T,L,D,d,i)),T.setUniform1f("u_zoomFactor",2**(L-d)/g);const h=s.layerData.get(e);if(!h.lineIndexCount)continue;h.prepareForRendering(t);const C=h.lineVertexArrayObject;if(!(0,M.Wi)(C)){if(t.bindVAO(C),T.setUniformMatrix3fv("u_dvsMat3",s.transforms.dvs),t.setStencilFunction(f.wb.EQUAL,s.stencilRef,255),c||y){const z=h.patternMap;if(!z)continue;for(const[k,Y]of z){const Z=i.getPageSize(k);(0,M.pC)(Z)&&(i.bind(t,f.cw.LINEAR,k,u.V4),T.setUniform2fv("u_mosaicSize",Z),T.setUniform1i("u_texture",u.V4),t.drawElements(f.MX.TRIANGLES,Y[1],f.g.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*Y[0]))}}else t.drawElements(f.MX.TRIANGLES,h.lineIndexCount,f.g.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*h.lineIndexStart);s.triangleCount+=h.lineIndexCount/3}}}}},86406:(X,G,a)=>{a.d(G,{e:()=>t});var M=a(62208),B=a(9545),u=a(47132),_=a(1268),I=a(39351),U=a(39406),f=a(43289),j=a(5254),S=a(62856),n=a(67969);class t extends S.Z{constructor(){super(...arguments),this._iconProgramOptions={id:!1,sdf:!1},this._sdfProgramOptions={id:!1},this._spritesTextureSize=(0,B.c)()}dispose(){}drawMany(p,o){const{drawPhase:v,styleLayerUID:g}=p,i=p.styleLayer;let e;v===U.jx.HITTEST&&(e=(0,j.Au)(g+1)),this._drawIcons(p,i,o,e),this._drawText(p,i,o,e)}_drawIcons(p,o,v,g){const{context:i,displayLevel:e,drawPhase:R,painter:m,spriteMosaic:D,state:V,styleLayerUID:K,requestRender:x,allowDelayedRender:W}=p,O=o.iconMaterial,N=m.vectorTilesMaterialManager;let c,b=!1;for(const C of v)if(C.layerData.has(K)&&(c=C.layerData.get(K),c.iconPerPageElementsMap.size>0)){b=!0;break}if(!b)return;const l=o.getPaintValue("icon-translate",e),y=o.getPaintValue("icon-translate-anchor",e);let A=o.getLayoutValue("icon-rotation-alignment",e);A===_.aF.AUTO&&(A=o.getLayoutValue("symbol-placement",e)===_.R.POINT?_.aF.VIEWPORT:_.aF.MAP);const w=A===_.aF.MAP,P=o.getLayoutValue("icon-keep-upright",e)&&w,T=c.isIconSDF,d=R===U.jx.HITTEST,s=this._iconProgramOptions;s.id=d,s.sdf=T;const E=N.getMaterialProgram(i,O,s);if(W&&(0,M.pC)(x)&&!E.compiled)return void x();i.useProgram(E),E.setUniformMatrix3fv("u_displayViewMat3",A===_.aF.MAP?V.displayViewMat3:V.displayMat3),E.setUniformMatrix3fv("u_displayMat3",y===_.fD.VIEWPORT?V.displayMat3:V.displayViewMat3),E.setUniform2fv("u_iconTranslation",l),E.setUniform1f("u_depth",o.z),E.setUniform1f("u_mapRotation",(0,f.s5)(V.rotation)),E.setUniform1f("u_keepUpright",P?1:0),E.setUniform1f("u_level",10*e),E.setUniform1i("u_texture",I.V4),E.setUniform1f("u_fadeDuration",u.nN/1e3),d&&E.setUniform4fv("u_id",g);let h=-1;for(const C of v){if(!C.layerData.has(K)||(C.key.level!==h&&(h=C.key.level,O.setDataUniforms(E,e,o,h,D)),c=C.layerData.get(K),0===c.iconPerPageElementsMap.size))continue;c.prepareForRendering(i),c.updateOpacityInfo();const z=c.iconVertexArrayObject;if(!(0,M.Wi)(z)){i.bindVAO(z),E.setUniformMatrix3fv("u_dvsMat3",C.transforms.dvs),E.setUniform1f("u_time",(performance.now()-c.lastOpacityUpdate)/1e3);for(const[k,Y]of c.iconPerPageElementsMap)this._renderIconRange(p,E,Y,k,C)}}}_renderIconRange(p,o,v,g,i){const{context:e,spriteMosaic:R}=p;this._spritesTextureSize[0]=R.getWidth(g)/4,this._spritesTextureSize[1]=R.getHeight(g)/4,o.setUniform2fv("u_mosaicSize",this._spritesTextureSize),R.bind(e,n.cw.LINEAR,g,I.V4),e.setStencilTestEnabled(!0),e.setStencilFunction(n.wb.GREATER,255,255),e.setStencilWriteMask(0),e.drawElements(n.MX.TRIANGLES,v[1],n.g.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*v[0]),i.triangleCount+=v[1]/3}_drawText(p,o,v,g){const{context:i,displayLevel:e,drawPhase:R,glyphMosaic:m,painter:D,pixelRatio:V,spriteMosaic:K,state:x,styleLayerUID:W,requestRender:O,allowDelayedRender:N}=p,c=o.textMaterial,b=D.vectorTilesMaterialManager;let l,y=!1;for(const H of v)if(H.layerData.has(W)&&(l=H.layerData.get(W),l.glyphPerPageElementsMap.size>0)){y=!0;break}if(!y)return;const A=o.getPaintProperty("text-opacity");if(A&&!A.isDataDriven&&0===A.getValue(e))return;const w=o.getPaintProperty("text-color"),P=!w||w.isDataDriven||w.getValue(e)[3]>0,T=o.getPaintProperty("text-halo-width"),d=o.getPaintProperty("text-halo-color"),s=(!T||T.isDataDriven||T.getValue(e)>0)&&(!d||d.isDataDriven||d.getValue(e)[3]>0);if(!P&&!s)return;let h=o.getLayoutValue("text-rotation-alignment",e);h===_.aF.AUTO&&(h=o.getLayoutValue("symbol-placement",e)===_.R.POINT?_.aF.VIEWPORT:_.aF.MAP);const C=h===_.aF.MAP,z=o.getLayoutValue("text-keep-upright",e)&&C,k=R===U.jx.HITTEST,Y=.8*3/V;this._glyphTextureSize||(this._glyphTextureSize=(0,B.f)(m.width/4,m.height/4));const Z=o.getPaintValue("text-translate",e),q=o.getPaintValue("text-translate-anchor",e),J=this._sdfProgramOptions;J.id=k;const F=b.getMaterialProgram(i,c,J);if(N&&(0,M.pC)(O)&&!F.compiled)return void O();i.useProgram(F),F.setUniformMatrix3fv("u_displayViewMat3",h===_.aF.MAP?x.displayViewMat3:x.displayMat3),F.setUniformMatrix3fv("u_displayMat3",q===_.fD.VIEWPORT?x.displayMat3:x.displayViewMat3),F.setUniform2fv("u_textTranslation",Z),F.setUniform1f("u_depth",o.z+152587890625e-16),F.setUniform2fv("u_mosaicSize",this._glyphTextureSize),F.setUniform1f("u_mapRotation",(0,f.s5)(x.rotation)),F.setUniform1f("u_keepUpright",z?1:0),F.setUniform1f("u_level",10*e),F.setUniform1i("u_texture",I.CU),F.setUniform1f("u_antialiasingWidth",Y),F.setUniform1f("u_fadeDuration",u.nN/1e3),k&&F.setUniform4fv("u_id",g);let Q=-1;for(const H of v){if(!H.layerData.has(W)||(H.key.level!==Q&&(Q=H.key.level,c.setDataUniforms(F,e,o,Q,K)),l=H.layerData.get(W),0===l.glyphPerPageElementsMap.size))continue;l.prepareForRendering(i),l.updateOpacityInfo();const $=l.textVertexArrayObject;if((0,M.Wi)($))continue;i.bindVAO($),F.setUniformMatrix3fv("u_dvsMat3",H.transforms.dvs),i.setStencilTestEnabled(!0),i.setStencilFunction(n.wb.GREATER,255,255),i.setStencilWriteMask(0);const tt=(performance.now()-l.lastOpacityUpdate)/1e3;F.setUniform1f("u_time",tt),l.glyphPerPageElementsMap.forEach((et,at)=>{this._renderGlyphRange(i,et,at,m,F,s,P,H)})}}_renderGlyphRange(p,o,v,g,i,e,R,m){g.bind(p,n.cw.LINEAR,v,I.CU),e&&(i.setUniform1f("u_halo",1),p.drawElements(n.MX.TRIANGLES,o[1],n.g.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*o[0]),m.triangleCount+=o[1]/3),R&&(i.setUniform1f("u_halo",0),p.drawElements(n.MX.TRIANGLES,o[1],n.g.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*o[0]),m.triangleCount+=o[1]/3)}}},7423:(X,G,a)=>{a.d(G,{B:()=>M});class M{constructor(u){this._readFile=u}resolveIncludes(u){return this._resolve(u)}_resolve(u,_=new Map){if(_.has(u))return _.get(u);const I=this._read(u);if(!I)throw new Error(`cannot find shader file ${u}`);const U=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm;let f=U.exec(I);const j=[];for(;null!=f;)j.push({path:f[1],start:f.index,length:f[0].length}),f=U.exec(I);let S=0,n="";return j.forEach(r=>{n+=I.slice(S,r.start),n+=_.has(r.path)?"":this._resolve(r.path,_),S=r.start+r.length}),n+=I.slice(S),_.set(u,n),n}_read(u){return this._readFile(u)}}}}]);