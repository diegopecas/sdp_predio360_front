"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[5376],{33428:(_e,te,v)=>{v.d(te,{k2:()=>Ae,IG:()=>ei,W4:()=>qt});var z=v(39351),h=v(80020),E=v(39406);class F{constructor(i){this.registryName=i,this.postProcessingEnabled=!1,this.overrideStencilRef=null,this.drawPhase=E.jx.MAP|E.jx.HITTEST|E.jx.HIGHLIGHT|E.jx.DEBUG,this.symbologyPlane=E.mH.FILL}startup(){}shutdown(i){}postProcess(i,r){}}var l=v(17626),u=v(83006),s=v(99963),M=v(5885),G=v(41069);class O extends u.Pz{}(0,l._)([(0,u.xh)(0,s.Sg)],O.prototype,"pos",void 0);class W extends u.oo{}(0,l._)([(0,u.e5)(s.bv)],W.prototype,"dotSize",void 0);class j extends u.oo{}(0,l._)([(0,u.e5)(s.Eg)],j.prototype,"locations",void 0),(0,l._)([(0,u.e5)(s.bv)],j.prototype,"pixelRatio",void 0),(0,l._)([(0,u.e5)(s.bv)],j.prototype,"tileZoomFactor",void 0);class $ extends u.ri{vertex(i){const r=new s.Tu(1,0,0,0,-1,0,0,1,1).multiply(new s.AO(i.pos.xy.divide(z.i9),1)),a=(0,s.ig)(this.draw.locations,r.xy),o=(0,s.Fp)(this.instance.dotSize.divide(2),new s.bv(1));let d=new s.bv(0);d=d.add((0,s.Nb)(a.a,new s.bv(1e-6)).multiply(2));let p=o.add(this.instance.dotSize);const b=this.view.displayViewScreenMat3.multiply(new s.AO(i.pos.add(.5),1)),x=new s.T8(b.xy,d,1),S=this.instance.dotSize.divide(p),_=new s.bv(-1).divide(o.divide(p));return p=p.multiply(this.draw.pixelRatio.multiply(this.draw.tileZoomFactor)),{glPosition:x,glPointSize:p,color:a,ratio:S,invEdgeRatio:_}}fragment(i){const r=(0,s.kE)(i.glPointCoord.subtract(.5)).multiply(2),a=(0,s.CW)(new s.bv(0),new s.bv(1),i.invEdgeRatio.multiply(r.subtract(i.ratio)).add(1)),o=new u.Qt;return o.glFragColor=i.color.multiply(a),o}}(0,l._)([(0,u.e5)(W)],$.prototype,"instance",void 0),(0,l._)([(0,u.e5)(j)],$.prototype,"draw",void 0),(0,l._)([(0,u.e5)(G.C)],$.prototype,"view",void 0),(0,l._)([(0,l.a)(0,(0,u.qH)(O))],$.prototype,"vertex",null),(0,l._)([(0,l.a)(0,(0,u.qH)(class R extends M.fz{}))],$.prototype,"fragment",null);var I=v(95936),m=v(75152);class V extends M.HN{}(0,l._)([(0,u.xh)(3,s.bv)],V.prototype,"inverseArea",void 0);class K extends u.oo{}(0,l._)([(0,u.e5)(s.v8.ofType(s.T8,2))],K.prototype,"isActive",void 0),(0,l._)([(0,u.e5)(s.v8.ofType(s.T8,8))],K.prototype,"colors",void 0),(0,l._)([(0,u.e5)(s.bv)],K.prototype,"dotValue",void 0);class oe extends u.oo{}(0,l._)([(0,u.e5)(s.Eg)],oe.prototype,"dotTexture0",void 0),(0,l._)([(0,u.e5)(s.Eg)],oe.prototype,"dotTexture1",void 0),(0,l._)([(0,u.e5)(s.bv)],oe.prototype,"tileZoomFactor",void 0),(0,l._)([(0,u.e5)(s.bv)],oe.prototype,"pixelRatio",void 0),(0,l._)([(0,u.e5)(s.bv)],oe.prototype,"tileDotsOverArea",void 0);class ie extends M.Ie{_dotThreshold(i,r,a){return i.divide(r).divide(a)}vertex(i){const r=new s.Tu(2/z.i9,0,0,0,-2/z.i9,0,-1,1,1).multiply(new s.AO(i.pos,1)),a=this.clip(i.id),o=new s.T8(r.xy,a,1),d=this.storage.getVVData(i.id).multiply(this.instance.isActive.get(0)).multiply(i.inverseArea),p=this.storage.getDataDrivenData0(i.id).multiply(this.instance.isActive.get(1)).multiply(i.inverseArea),b=this.draw.tileZoomFactor.multiply(z.i9).divide(this.draw.pixelRatio),x=this._dotThreshold(d,this.instance.dotValue,this.draw.tileDotsOverArea),S=this._dotThreshold(p,this.instance.dotValue,this.draw.tileDotsOverArea),_=i.pos.add(.5).divide(b);return{glPosition:o,color:new s.T8(0,0,0,0),textureCoords:_,thresholds0:x,thresholds1:S}}fragment(i){const r=new u.Qt,a=(0,s.ig)(this.draw.dotTexture0,i.textureCoords),o=(0,s.ig)(this.draw.dotTexture1,i.textureCoords),d=i.thresholds0.subtract(a),p=i.thresholds1.subtract(o);let b;const x=s.yb.fromColumns(this.instance.colors[0],this.instance.colors[1],this.instance.colors[2],this.instance.colors[3]),S=s.yb.fromColumns(this.instance.colors[4],this.instance.colors[5],this.instance.colors[6],this.instance.colors[7]);if(this.blending){const _=(0,s.Nb)(new s.bv(0),d),T=(0,s.Nb)(new s.bv(0),p),P=(0,s.AK)(_,d).add((0,s.AK)(T,p)),C=(0,s.Nb)(P,new s.bv(0)),k=new s.bv(1).subtract(C),N=P.add(C),Z=d.multiply(_).divide(N),ee=p.multiply(T).divide(N),Y=x.multiply(Z).add(S.multiply(ee));b=k.multiply(Y)}else{const _=(0,s.Fp)((0,m.X3)(d),(0,m.X3)(p)),T=(0,s.Nb)(_,new s.bv(0)),P=new s.bv(1).subtract(T),C=(0,s.Nb)(_,d),k=(0,s.Nb)(_,p),N=x.multiply(C).add(S.multiply(k));b=P.multiply(N)}return r.glFragColor=b,r}hittest(i){return(0,I.Oz)(this.hittestRequest)}}(0,l._)([u.Ou],ie.prototype,"blending",void 0),(0,l._)([(0,u.e5)(K)],ie.prototype,"instance",void 0),(0,l._)([(0,u.e5)(oe)],ie.prototype,"draw",void 0),(0,l._)([(0,l.a)(0,(0,u.qH)(V))],ie.prototype,"vertex",null),(0,l._)([(0,l.a)(0,(0,u.qH)(M.fz))],ie.prototype,"fragment",null);var c=v(4619),n=v(67969);const y={[n.g.BYTE]:1,[n.g.UNSIGNED_BYTE]:1,[n.g.SHORT]:2,[n.g.UNSIGNED_SHORT]:2,[n.g.INT]:4,[n.g.UNSIGNED_INT]:4,[n.g.FLOAT]:4};var f=v(83994),w=v(49353),L=v(40852);class H{constructor(i,r){this._boundPart=null;const a=[];for(const d of r.vertex){const p=f.f.createVertex(i,n.l1.STATIC_DRAW,d);a.push(p)}const o=[];for(const d of r.index||[]){const p=f.f.createIndex(i,n.l1.STATIC_DRAW,d);o.push(p)}this.groups=[];for(const d of r.groups){let p;if(null!=d.index){if(!r.index)throw new Error("No index data.");const{BYTES_PER_ELEMENT:P}=r.index[d.index];2===P?p=n.g.UNSIGNED_SHORT:4===P&&(p=n.g.UNSIGNED_INT)}const b=null!=d.index?o[d.index]:null,x=new Map,S={},_={};for(const P of d.attributes){const{name:C,count:k,type:N,offset:Z,normalized:ee,divisor:Y,stride:se,vertex:re,location:le}=P,J=`vertex-buffer-${re}`;let me=S[J];me||(me=S[J]=[]);const we=new L.G(C,k,N,Z,se,ee,Y);me.push(we),x.set(C,le),_[J]=a[re]}const T=new w.U(i,x,S,_,b);this.groups.push({...d,vertexArray:T,locations:x,layout:S,indexing:p})}this.parts=r.parts}bind(i,r){this._boundPart=r;const{group:a}=this.parts[this._boundPart],{vertexArray:o}=this.groups[a];i.bindVAO(o)}draw(i){if(null==this._boundPart)throw new Error("Mesh.bind() has not been called.");const{start:r,count:a}=this.parts[this._boundPart],{group:o}=this.parts[this._boundPart],{indexing:d,primitive:p}=this.groups[o];d?i.drawElements(p,a,d,r*y[d]):i.drawArrays(p,r,a)}unbind(i){this._boundPart=null,i.bindVAO(null)}destroy(){for(const{vertexArray:i}of this.groups)i.dispose()}}var Q=v(95860);class U extends H{static create(i,r){const a=[];let{stride:o,hash:d}=r.layout;if(null==o){o=0;for(const{count:P,type:C,offset:k}of r.layout.attributes){if(null!=k)throw new Error("Stride cannot be computed automatically when attribute offsets are supplied explicitly.");o+=P*y[C]}}let p=0,b=0;for(const{count:P,name:C,offset:k,type:N,normalized:Z}of r.layout.attributes)null!=k&&(b=k),a.push({name:C,location:p,vertex:0,count:P,type:N,offset:b,stride:o,divisor:0,normalized:null!=Z&&Z}),p++,b+=P*y[N];const x={attributes:a,primitive:r.primitive};null!=r.index&&(x.index=0);let{count:S}=r;if(null==S&&(S=r.index?r.index.length:r.vertex.byteLength/o,Math.floor(S)!==S))throw new Error(`The byte length of vertex data must be an exact multiple of the stride, which is ${o}.`);const T={vertex:[r.vertex],parts:[{start:0,count:S,group:0,primitive:r.primitive}],groups:[x]};return null!=r.index&&(T.index=[r.index]),null==d&&(d=(0,Q.ig)(a)),new U(i,T,{hash:d,attributes:a,stride:o})}constructor(i,r,a){super(i,r),this.layout=a}bind(i,r=0){super.bind(i,r)}}var ae=v(85775),fe=v(49266),ue=v(20781),De=v(18952),Ie=v(31548);class ht{constructor(){this._dotTextureSize=0,this._dotTextures=null,this._dotMesh=null}destroy(){this._disposeTextures(),this._dotFBO&&this._dotFBO.dispose(),this._dotMesh&&this._dotMesh.destroy()}getFBO(i){if(null==this._dotFBO){const r=z.i9,a=z.i9,o=new Ie.X(r,a);o.samplingMode=n.cw.NEAREST,o.wrapMode=n.e8.CLAMP_TO_EDGE;const d=new fe.r(i,new ue.Y(n.Tg.DEPTH_STENCIL,r,a));this._dotFBO=new ae.X(i,o,d)}return this._dotFBO}getDotDensityMesh(i){if(null==this._dotMesh){const r=z.i9,a=r*r,o=2,d=new Int16Array(a*o);for(let x=0;x<r;x++)for(let S=0;S<r;S++)d[o*(S+x*r)]=S,d[o*(S+x*r)+1]=x;const p=[{count:2,type:n.g.UNSIGNED_SHORT,name:"a_position",offset:0}],b={hash:(0,Q.ig)(p),attributes:p,stride:4};this._dotMesh=U.create(i,{primitive:n.MX.POINTS,vertex:d,count:a,layout:b})}return this._dotMesh}getDotDensityTextures(i,r,a){if(this._dotTextureSize===r&&this._seed===a||(this._disposeTextures(),this._dotTextureSize=r,this._seed=a),null===this._dotTextures){const o=new c.Z(a);this._dotTextures=[this._allocDotDensityTexture(i,r,o),this._allocDotDensityTexture(i,r,o)]}return this._dotTextures}_disposeTextures(){if(this._dotTextures){for(let i=0;i<this._dotTextures.length;i++)this._dotTextures[i].dispose();this._dotTextures=null}}_allocDotDensityTexture(i,r,a){const o=new Float32Array(r*r*4);for(let p=0;p<o.length;p++)o[p]=a.getFloat();const d=new Ie.X;return d.dataType=n.Br.FLOAT,d.samplingMode=n.cw.NEAREST,d.width=r,d.height=r,new De.x(i,d,o)}}var ce=v(24962),ke=v(94197),mt=v(98092);function ze(g){const i=1/g;return{antialiasing:i,blur:0+i}}var yt=v(38420),xt=v(3065),_t=v(75254),Vt=v(57615),zt=v(63290),Ze=v(62208),Mt=v(34109);class Pt{destroy(){this._accumulateFramebuffer=(0,Ze.M2)(this._accumulateFramebuffer),this._resolveGradientTexture=(0,Ze.M2)(this._resolveGradientTexture),this._prevGradientHash=null,this._qualityProfile=null}get initialized(){return null!=this._accumulateFramebuffer&&null!=this._resolveGradientTexture}get accumulateFramebuffer(){return this._accumulateFramebuffer}get resolveGradientTexture(){return this._resolveGradientTexture}loadQualityProfile(i){if(null==this._qualityProfile){const r=(0,Mt.v)(i,zt.Z.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.heatmap.HeatmapResources"));this._qualityProfile={...r,defines:{usesHalfFloatPrecision:r.dataType!==n.Br.FLOAT}}}return this._qualityProfile}ensureAccumulateFBO(i,r,a){if(null==this._accumulateFramebuffer){const{dataType:o,samplingMode:d,pixelFormat:p,internalFormat:b}=this.loadQualityProfile(i),x=new Ie.X(r,a);x.pixelFormat=p,x.internalFormat=b,x.dataType=o,x.samplingMode=d,x.wrapMode=n.e8.CLAMP_TO_EDGE;const S=new ue.Y(n.Tg.DEPTH_STENCIL,r,a);this._accumulateFramebuffer=new ae.X(i,x,S)}else{const{width:o,height:d}=this._accumulateFramebuffer;o===r&&d===a||this._accumulateFramebuffer.resize(r,a)}return this._accumulateFramebuffer}ensureResolveGradientTexture(i,r,a){if(null==this._resolveGradientTexture){const o=new Ie.X;o.wrapMode=n.e8.CLAMP_TO_EDGE,this._resolveGradientTexture=new De.x(i,o)}else this._prevGradientHash!==r&&(this._resolveGradientTexture.resize(a.length/4,1),this._resolveGradientTexture.setData(a),this._prevGradientHash=r);return this._resolveGradientTexture}}function Xe(g){return g?.25:1}class Ye extends M.HN{}(0,l._)([(0,u.xh)(5,s.Sg)],Ye.prototype,"offset",void 0);class He extends u.oo{}(0,l._)([(0,u.e5)(s.bv)],He.prototype,"radius",void 0),(0,l._)([(0,u.e5)(s.bv)],He.prototype,"isFieldActive",void 0);class Me extends M.Ie{constructor(){super(...arguments),this.usesHalfFloatPrecision=!1}vertex(i){const{radius:r,isFieldActive:a}=this.kernelControls,o=i.offset,d=a.multiply(this.storage.getVVData(i.id).x).add(new s.bv(1).subtract(a)),p=this.view.displayViewScreenMat3.multiply(new s.AO(i.pos,1)).add(this.view.displayViewMat3.multiply(new s.AO(o,0)).multiply(r)),b=this.clip(i.id);return{glPosition:new s.T8(p.xy,b,1),offset:o,fieldValue:d,color:new s.T8(0),...this.maybeRunHittest(i,{},null)}}fragment(i){const{offset:r,fieldValue:a}=i,o=(0,s.kE)(r),d=(0,s.Nb)(o,new s.bv(1)),p=new s.bv(1).subtract(o.multiply(o)),b=p.multiply(p),x=d.multiply(b).multiply(a).multiply(new s.bv(Xe(this.usesHalfFloatPrecision)));return this.getFragmentOutput(new s.T8(x),i)}hittest(i){const{viewMat3:r,tileMat3:a}=this.view,o=r.multiply(a).multiply(new s.AO(i.pos,1));return(0,I.XM)(o.xy,this.kernelControls.radius,this.hittestRequest.position)}}(0,l._)([u.Ou],Me.prototype,"usesHalfFloatPrecision",void 0),(0,l._)([(0,u.e5)(He)],Me.prototype,"kernelControls",void 0),(0,l._)([(0,l.a)(0,(0,u.qH)(Ye))],Me.prototype,"vertex",null),(0,l._)([(0,l.a)(0,(0,u.qH)(class Et extends M.fz{}))],Me.prototype,"fragment",null);class $e extends u.Pz{}(0,l._)([(0,u.xh)(0,s.Sg)],$e.prototype,"pos",void 0);class Ce extends u.oo{}(0,l._)([(0,u.e5)(s.Eg)],Ce.prototype,"texture",void 0),(0,l._)([(0,u.e5)(s.Sg)],Ce.prototype,"minAndInvRange",void 0),(0,l._)([(0,u.e5)(s.bv)],Ce.prototype,"normalization",void 0);class Je extends u.oo{}(0,l._)([(0,u.e5)(s.Eg)],Je.prototype,"texture",void 0);class Te extends u.ri{constructor(){super(...arguments),this.usesHalfFloatPrecision=!1}vertex(i){return{glPosition:new s.T8(i.pos.multiply(2).subtract(1),1,1),uv:i.pos}}fragment(i){const{accumulatedDensity:r,gradient:a}=this;let o=(0,s.ig)(r.texture,i.uv).r.multiply(new s.bv(Xe(this.usesHalfFloatPrecision)));o=o.multiply(r.normalization),o=o.subtract(r.minAndInvRange.x).multiply(r.minAndInvRange.y);const d=(0,s.ig)(a.texture,new s.Sg(o,.5)),p=new u.Qt;return p.glFragColor=new s.T8(d.rgb.multiply(d.a),d.a),p}}function Qe(g){return g.key.level+1}(0,l._)([u.Ou],Te.prototype,"usesHalfFloatPrecision",void 0),(0,l._)([(0,u.e5)(Ce)],Te.prototype,"accumulatedDensity",void 0),(0,l._)([(0,u.e5)(Je)],Te.prototype,"gradient",void 0),(0,l._)([(0,l.a)(0,(0,u.qH)($e))],Te.prototype,"vertex",null),(0,l._)([(0,l.a)(0,(0,u.qH)(class At extends u.XB{}))],Te.prototype,"fragment",null);const qe={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:{write:!1,test:{ref:Qe,compare:n.wb.GEQUAL,mask:255,op:{fail:n.xS.KEEP,zFail:n.xS.KEEP,zPass:n.xS.REPLACE}}}},It={...qe,stencil:!1},Ct={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1};function et(g,i){const{referenceScale:r,radius:a}=g;return a*(0!==r?r/i.scale:1)}var de=v(36519),We=v(69767),tt=v(72884),it=v(93239);class Ne extends u.oo{getVVRotationMat4(i){return(0,s.KJ)((0,m.In)(i),s.yb.identity(),()=>{const r=this._getNormalizedAngle(i).multiply(de.nF),a=(0,s.O$)(r),o=(0,s.mC)(r);return new s.yb(o,a,0,0,a.multiply(new s.bv(-1)),o,0,0,0,0,1,0,0,0,0,1)})}getVVRotationMat3(i){return(0,s.KJ)((0,m.In)(i),s.Tu.identity(),()=>{const r=this._getNormalizedAngle(i).multiply(de.nF),a=(0,s.O$)(r),o=(0,s.mC)(r);return new s.Tu(o,a,0,a.multiply(new s.bv(-1)),o,0,0,0,1)})}_getNormalizedAngle(i){const r=(0,s.ln)(this.rotationType,new s.bv(de.MO.Arithmatic));return(0,s.KJ)(r,new s.bv(90).subtract(i),i)}}(0,l._)([(0,u.e5)(s.bv)],Ne.prototype,"rotationType",void 0);var st=v(72646),rt=v(6127),ot=v(90132),at=v(81575),Ve=v(30247);class pe extends M.HN{}(0,l._)([(0,u.xh)(3,s.T8)],pe.prototype,"color",void 0),(0,l._)([(0,u.xh)(4,s.Sg)],pe.prototype,"offset",void 0),(0,l._)([(0,u.xh)(5,s.Sg)],pe.prototype,"textureUV",void 0),(0,l._)([(0,u.xh)(6,s.bv)],pe.prototype,"fontSize",void 0),(0,l._)([(0,u.xh)(7,s.bv)],pe.prototype,"referenceSize",void 0),(0,l._)([(0,u.xh)(8,s.bv)],pe.prototype,"haloFontSize",void 0),(0,l._)([(0,u.xh)(9,s.T8)],pe.prototype,"haloColor",void 0),(0,l._)([(0,u.xh)(10,s.Sg)],pe.prototype,"zoomRange",void 0),(0,l._)([(0,u.xh)(11,s.bv)],pe.prototype,"clipAngle",void 0),(0,l._)([(0,u.xh)(12,s.T8)],pe.prototype,"referenceSymbol",void 0);class Ke extends u.yu{}(0,l._)([(0,u.xh)(13,s.Sg)],Ke.prototype,"offsetNextVertex1",void 0),(0,l._)([(0,u.xh)(14,s.Sg)],Ke.prototype,"offsetNextVertex2",void 0);class ne extends M.Ie{constructor(){super(...arguments),this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"]},this.isHaloPass=!1,this.isBackgroundPass=!1,this.isLabel=!1}clipLabel(i,r,a){const o=r.multiply(1.4173228346456692),d=(0,s.Wn)(this.view.rotation.subtract(o)),p=(0,s.VV)(new s.bv(360).subtract(d),d);let b=new s.bv(0);const x=(0,s.GW)(this.view.currentZoom.multiply(z.JS)).divide(z.JS),S=i.x,_=i.y,T=new s.bv(1).subtract((0,s.Nb)(S,x)).multiply(2),P=(0,s.Nb)(new s.bv(90),p).multiply(2),C=new s.bv(2).multiply(new s.bv(1).subtract((0,s.Nb)(x,_)));return b=b.add(a.multiply(T)),b=b.add(a.multiply(P)),b=b.add(C),b}vertex(i,r){const a=(0,m.qD)(i.bitset,de.mL),o=new s.bv(1).subtract(a);let d=i.fontSize,p=d.divide(de.V_);const b=this.isHaloPass?i.haloColor:this._getVertexColor(i),x=this.isLabel?b.multiply(this.storage.getAnimationValue(i.id)):b,S=this.view.displayViewScreenMat3.multiply(new s.AO(i.pos,1));let _=i.offset,T=new s.bv(1),P=s.Tu.identity();if(this.isLabel){if(!i.referenceSymbol)throw new Error("InternalError: Optional attribute 'referenceSymbol' expected for labels");const se=i.referenceSymbol,re=se.xy,le=se.z,J=this._unpackDirection(se.w),me=(0,Ve.Vm)(this,i.id,le).divide(2),we=J.multiply(me.add(z.gj));_=_.add(re).add(we)}else T=(0,Ve.Vm)(this,i.id,i.referenceSize).divide(i.referenceSize),d=d.multiply(T),p=p.multiply(T),_=_.multiply(T),P=(0,Ve.H8)(this,i.id),_=P.multiply(new s.AO(_,0)).xy;const C=(0,m.qD)(i.bitset,de.$r),k=this._getViewRotationMatrix(C).multiply(new s.AO(_,0));let N=this.isLabel?this.clipLabel(i.zoomRange,i.clipAngle,C):this.clip(i.id,i.zoomRange);N=N.add(this.isBackgroundPass?o.multiply(2):a.multiply(2));const Z=new s.T8(S.xy.add(k.xy),N,1),ee=i.textureUV.divide(this.mosaicInfo.size);let Y=new s.bv(0);return this.isHaloPass&&(Y=i.haloFontSize.divide(p).divide(de.Ke)),{glPosition:Z,color:x,size:p,textureUV:ee,antialiasingWidth:new s.bv(.105*de.V_).divide(d).divide(this.view.pixelRatio),haloDistanceOffset:Y,...this.maybeRunHittest(i,r,{vvSizeAdjustment:T,vvRotation:P})}}_getViewRotationMatrix(i){const r=this.view.displayViewMat3,a=this.view.displayMat3,o=new s.bv(1).subtract(i);return r.multiply(i).add(a.multiply(o))}fragment(i){const r=new s.bv(.25),a=new s.bv(1).subtract(r),o=(0,s.ig)(this.mosaicInfo.texture,i.textureUV).a;let d=a.subtract(i.haloDistanceOffset);this.highlight&&(d=d.divide(2));const p=i.antialiasingWidth,b=(0,s.CW)(d.subtract(p),d.add(p),o);return this.getFragmentOutput(i.color.multiply(b),i)}hittest(i,r,{vvSizeAdjustment:a,vvRotation:o}){const d=o.multiply(new s.AO(i.offset.multiply(a),0)),p=o.multiply(new s.AO(r.offsetNextVertex1.multiply(a),0)),b=o.multiply(new s.AO(r.offsetNextVertex2.multiply(a),0)),{viewMat3:x,tileMat3:S}=this.view,_=x.multiply(S).multiply(new s.AO(i.pos,1)),T=_.add(S.multiply(d)).xy,P=_.add(S.multiply(p)).xy,C=_.add(S.multiply(b)).xy;return(0,I.P0)(this.hittestRequest.position,T.xy,P.xy,C.xy)}_unpackDirection(i){const r=new s.J7(i),a=(0,s.Dg)(r,new s.J7(2)),o=(0,s.hx)(r,new s.J7(3));return new s.Sg(new s.bv(a).subtract(1),new s.bv(o).subtract(1))}_getVertexColor(i){let r=i.color;if(this.visualVariableColor){const a=this.storage.getColorValue(i.id);r=this.visualVariableColor.getColor(a,i.color,new s.tW(!1))}if(this.visualVariableOpacity){const a=this.storage.getOpacityValue(i.id),o=this.visualVariableOpacity.getOpacity(a);r=r.multiply(o)}return r}}(0,l._)([(0,u.Kw)(tt.W)],ne.prototype,"visualVariableColor",void 0),(0,l._)([(0,u.Kw)(it.V)],ne.prototype,"visualVariableOpacity",void 0),(0,l._)([(0,u.Kw)(Ne)],ne.prototype,"visualVariableRotation",void 0),(0,l._)([(0,u.Kw)(st.k)],ne.prototype,"visualVariableSizeMinMaxValue",void 0),(0,l._)([(0,u.Kw)(rt.U)],ne.prototype,"visualVariableSizeScaleStops",void 0),(0,l._)([(0,u.Kw)(ot.W)],ne.prototype,"visualVariableSizeStops",void 0),(0,l._)([(0,u.Kw)(at.V)],ne.prototype,"visualVariableSizeUnitValue",void 0),(0,l._)([(0,u.e5)(We.N)],ne.prototype,"mosaicInfo",void 0),(0,l._)([u.Ou],ne.prototype,"isHaloPass",void 0),(0,l._)([u.Ou],ne.prototype,"isBackgroundPass",void 0),(0,l._)([u.Ou],ne.prototype,"isLabel",void 0),(0,l._)([(0,l.a)(0,(0,u.qH)(pe)),(0,l.a)(1,(0,u.qH)(Ke))],ne.prototype,"vertex",null),(0,l._)([(0,l.a)(0,(0,u.qH)(class Lt extends M.fz{}))],ne.prototype,"fragment",null);var Oe=v(18642),Ht=v(92087);class Re extends Oe.tp{}(0,l._)([(0,u.xh)(9,s.bv)],Re.prototype,"accumulatedDistance",void 0),(0,l._)([(0,u.xh)(10,s.Sg)],Re.prototype,"segmentDirection",void 0),(0,l._)([(0,u.xh)(11,s.T8)],Re.prototype,"tlbr",void 0);class Ge extends Oe.Pf{_getLineWidthRatio(i,r){const a=new s.bv(Ht.v),o=(0,m.qD)(i.bitset,de.Wq);return o.multiply((0,s.Fp)(r,new s.bv(.25))).add(new s.bv(1).subtract(o)).divide(a)}_getSDFAlpha(i){const{halfWidth:r,normal:a,tlbr:o,patternSize:d,accumulatedDistance:p,lineWidthRatio:b}=i,x=d.x.multiply(new s.bv(2)).multiply(b),S=(0,s.ZI)(p.divide(x)),_=new s.bv(.25).multiply(a.y).add(new s.bv(.5)),T=(0,s.CD)(o.xy,o.zw,new s.Sg(S,_)),P=(0,m.JH)((0,s.ig)(this.mosaicInfo.texture,T)).subtract(new s.bv(.5)).multiply(r),C=(0,s.uZ)(new s.bv(.5).subtract(P),new s.bv(0),new s.bv(1));return new s.T8(C)}_getPatternColor(i){const{halfWidth:r,normal:a,color:o,accumulatedDistance:d,patternSize:p,sampleAlphaOnly:b,tlbr:x}=i,S=p.y.multiply(new s.bv(2).multiply(r).divide(p.x)),_=(0,s.ZI)(d.divide(S)),T=new s.bv(.5).multiply(a.y).add(new s.bv(.5)),P=(0,s.CD)(x.xy,x.zw,new s.Sg(T,_));let C=(0,s.ig)(this.mosaicInfo.texture,P);return null!=this.visualVariableColor&&(C=(0,s.KJ)((0,s.tS)(b,new s.bv(.5)),new s.T8(o.a),o)),C}vertex(i,r){const{segmentDirection:a,tlbr:o,bitset:d}=i,p=(0,Oe.uY)(this,i),b=i.accumulatedDistance.divide(this.view.displayZoomFactor).add((0,s.AK)(a,p.scaledOffset)),x=new s.Sg(o.z.subtract(o.x),o.w.subtract(o.y)),S=o.divide(this.mosaicInfo.size.xyxy),_=(0,m.qD)(d,de.B7),T=(0,m.qD)(d,de.GS),P=(0,s.KJ)((0,s.tS)(_,new s.bv(.5)),this._getLineWidthRatio(i,p.scaledHalfWidth),new s.bv(1));return{...p,tlbr:S,patternSize:x,accumulatedDistance:b,isSDF:_,sampleAlphaOnly:T,lineWidthRatio:P,...this.maybeRunHittest(i,r,p.halfWidth)}}fragment(i){const{color:r,opacity:a,isSDF:o}=i,d=(0,Oe.Wc)(i,this.antialiasingControls.blur),p=(0,s.KJ)((0,s.tS)(o,new s.bv(.5)),this._getSDFAlpha(i),this._getPatternColor(i)),b=r.multiply(a).multiply(d).multiply(p);return this.getFragmentOutput(b,i)}}(0,l._)([(0,u.e5)(We.N)],Ge.prototype,"mosaicInfo",void 0),(0,l._)([(0,l.a)(0,(0,u.qH)(Re)),(0,l.a)(1,(0,u.qH)(M.RS))],Ge.prototype,"vertex",null);var Pe=v(50305);class ve extends M.HN{}(0,l._)([(0,u.xh)(3,s.T8)],ve.prototype,"color",void 0),(0,l._)([(0,u.xh)(4,s.T8)],ve.prototype,"outlineColor",void 0),(0,l._)([(0,u.xh)(5,s.Sg)],ve.prototype,"offset",void 0),(0,l._)([(0,u.xh)(6,s.Sg)],ve.prototype,"textureUV",void 0),(0,l._)([(0,u.xh)(7,s.T8)],ve.prototype,"sizing",void 0),(0,l._)([(0,u.xh)(8,s.bv)],ve.prototype,"placementAngle",void 0),(0,l._)([(0,u.xh)(9,s.bv)],ve.prototype,"sizeRatio",void 0),(0,l._)([(0,u.xh)(10,s.Sg)],ve.prototype,"zoomRange",void 0);class Ee extends u.yu{}function ye(g,i,r,a){return i.multiply(g.x).add(r.multiply(g.y)).add(a.multiply(g.z))}function je(g){return g.multiply(g).divide(128)}(0,l._)([(0,u.xh)(12,s.Sg)],Ee.prototype,"offsetNextVertex1",void 0),(0,l._)([(0,u.xh)(13,s.Sg)],Ee.prototype,"offsetNextVertex2",void 0),(0,l._)([(0,u.xh)(14,s.Sg)],Ee.prototype,"textureUVNextVertex1",void 0),(0,l._)([(0,u.xh)(15,s.Sg)],Ee.prototype,"textureUVNextVertex2",void 0);class he extends M.Ie{constructor(){super(...arguments),this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],textureUV:["textureUVNextVertex1","textureUVNextVertex2"]}}vertex(i,r){const a=je(i.sizing.x),o=je(i.sizing.y),d=je(i.sizing.z),p=i.placementAngle,b=(0,m.qD)(i.bitset,Pe.m.bitset.isSDF),x=(0,m.qD)(i.bitset,Pe.m.bitset.isMapAligned),S=(0,m.qD)(i.bitset,Pe.m.bitset.scaleSymbolsProportionally),_=(0,m.h7)(i.bitset,Pe.m.bitset.colorLocked),T=(0,Ve.sY)(this,i.id),P=(0,Ve.Zt)(this,i.id,i.color,_).multiply(T),C=this.view.displayViewScreenMat3.multiply(new s.AO(i.pos.xy,1)),k=(0,Ve.Vm)(this,i.id,d).divide(d),N=a.multiply(k),Z=i.offset.xy.multiply(k);let ee=o.multiply(S.multiply(k.subtract(1)).add(1));ee=(0,s.VV)(ee,(0,s.Fp)(N.subtract(.99),new s.bv(0)));const Y=(0,s.Fp)(ee,new s.bv(1)),se=(0,s.VV)(ee,new s.bv(1)),re=s.Tu.fromRotation(p.multiply(de.e4)),le=(0,Ve.H8)(this,i.id),J=this._getViewRotationMatrix(x).multiply(le).multiply(re).multiply(new s.AO(Z.xy,0)),me=this.clip(i.id,i.zoomRange),we=new s.T8(C.xy.add(J.xy),me,1),Le=i.textureUV.divide(this.mosaicInfo.size),Ue=i.outlineColor.multiply(se),Be=(0,m.qD)(i.bitset,Pe.m.bitset.overrideOutlineColor),Fe=i.sizeRatio.multiply(N).multiply(.5);return{glPosition:we,color:P,textureUV:Le,outlineColor:Ue,outlineSize:Y,distanceToPx:Fe,isSDF:b,overrideOutlineColor:Be,...this.maybeRunHittest(i,r,{pos:i.pos,size:N,sizeCorrection:k,isMapAligned:x,outlineSize:Y,distanceToPx:Fe,isSDF:b})}}fragment(i){const r=this._getColor(i.textureUV,i);return this.getFragmentOutput(r,i)}hittest(i,r,a){return(0,s.KJ)((0,s.Qj)(a.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(i,r,a),this._hittestMarker(i,r,a))}_getViewRotationMatrix(i){const r=this.view.displayViewMat3,a=this.view.displayMat3,o=new s.bv(1).subtract(i);return r.multiply(i).add(a.multiply(o))}_getViewScreenMatrix(i){const r=this.view.viewMat3.multiply(this.view.tileMat3),a=this.view.tileMat3,o=new s.bv(1).subtract(i);return r.multiply(i).add(a.multiply(o))}_getColor(i,r){return(0,s.KJ)((0,s.ln)(r.isSDF,new s.bv(1)),this._getSDFColor(i,r),this._getSpriteColor(i,r))}_getSpriteColor(i,r){return(0,s.ig)(this.mosaicInfo.texture,i).multiply(r.color)}_getSDFColor(i,r){const a=(0,s.ig)(this.mosaicInfo.texture,i),o=new s.bv(.5).subtract((0,m.JH)(a)).multiply(r.distanceToPx).multiply(de.nU),d=(0,s.uZ)(new s.bv(.5).subtract(o),new s.bv(0),new s.bv(1)),p=r.color.multiply(d);let b=r.outlineSize;this.highlight&&(b=(0,s.Fp)(b,r.overrideOutlineColor.multiply(4)));const x=b.multiply(.5),S=(0,s.Wn)(o).subtract(x),_=(0,s.uZ)(new s.bv(.5).subtract(S),new s.bv(0),new s.bv(1)),T=(0,s.CD)(r.outlineColor,r.color,r.overrideOutlineColor).multiply(_);return new s.bv(1).subtract(T.a).multiply(p).add(T)}_hittestSmallMarker(i,r,a){const{position:o,distance:d,smallSymbolDistance:p}=this.hittestRequest,b=d.subtract(p),{viewMat3:x,tileMat3:S}=this.view,_=x.multiply(S).multiply(new s.AO(a.pos,1)).xy,T=a.size.multiply(.5);return(0,s.TE)(_,o).subtract(T).add(b)}_hittestMarker(i,r,a){const{pos:o,sizeCorrection:p,isMapAligned:b,outlineSize:x,isSDF:S,distanceToPx:_}=a,T=new s.AO(i.offset.multiply(p),0),P=new s.AO(r.offsetNextVertex1.multiply(p),0),C=new s.AO(r.offsetNextVertex2.multiply(p),0),{viewMat3:k,tileMat3:N}=this.view,Z=k.multiply(N).multiply(new s.AO(o,1)),ee=this._getViewScreenMatrix(b),Y=Z.add(ee.multiply(T)).xy,se=Z.add(ee.multiply(P)).xy,re=Z.add(ee.multiply(C)).xy,le=this.hittestRequest.position,J=this.hittestRequest.distance,me=(0,I.hF)(le.add(new s.Sg((0,s.tk)(J),(0,s.tk)(J))),Y,se,re),we=(0,I.hF)(le.add(new s.Sg(0,(0,s.tk)(J))),Y,se,re),Le=(0,I.hF)(le.add(new s.Sg(J,(0,s.tk)(J))),Y,se,re),Ue=(0,I.hF)(le.add(new s.Sg((0,s.tk)(J),0)),Y,se,re),Be=(0,I.hF)(le,Y,se,re),Fe=(0,I.hF)(le.add(new s.Sg(J,0)),Y,se,re),ct=(0,I.hF)(le.add(new s.Sg((0,s.tk)(J),J)),Y,se,re),dt=(0,I.hF)(le.add(new s.Sg(0,J)),Y,se,re),pt=(0,I.hF)(le.add(new s.Sg(J,J)),Y,se,re),be=i.textureUV.divide(this.mosaicInfo.size),ge=r.textureUVNextVertex1.divide(this.mosaicInfo.size),xe=r.textureUVNextVertex2.divide(this.mosaicInfo.size),Se={color:new s.T8(1),outlineColor:new s.T8(1),overrideOutlineColor:new s.bv(1),outlineSize:x,distanceToPx:_,isSDF:S};let q=new s.bv(0);return q=q.add((0,I.lD)(me).multiply(this._getColor(ye(me,be,ge,xe),Se).a)),q=q.add((0,I.lD)(we).multiply(this._getColor(ye(we,be,ge,xe),Se).a)),q=q.add((0,I.lD)(Le).multiply(this._getColor(ye(Le,be,ge,xe),Se).a)),q=q.add((0,I.lD)(Ue).multiply(this._getColor(ye(Ue,be,ge,xe),Se).a)),q=q.add((0,I.lD)(Be).multiply(this._getColor(ye(Be,be,ge,xe),Se).a)),q=q.add((0,I.lD)(Fe).multiply(this._getColor(ye(Fe,be,ge,xe),Se).a)),q=q.add((0,I.lD)(ct).multiply(this._getColor(ye(ct,be,ge,xe),Se).a)),q=q.add((0,I.lD)(dt).multiply(this._getColor(ye(dt,be,ge,xe),Se).a)),q=q.add((0,I.lD)(pt).multiply(this._getColor(ye(pt,be,ge,xe),Se).a)),(0,s.Nb)(q,new s.bv(.05)).multiply((0,I.Oz)(this.hittestRequest))}}(0,l._)([(0,u.Kw)(tt.W)],he.prototype,"visualVariableColor",void 0),(0,l._)([(0,u.Kw)(it.V)],he.prototype,"visualVariableOpacity",void 0),(0,l._)([(0,u.Kw)(Ne)],he.prototype,"visualVariableRotation",void 0),(0,l._)([(0,u.Kw)(st.k)],he.prototype,"visualVariableSizeMinMaxValue",void 0),(0,l._)([(0,u.Kw)(rt.U)],he.prototype,"visualVariableSizeScaleStops",void 0),(0,l._)([(0,u.Kw)(ot.W)],he.prototype,"visualVariableSizeStops",void 0),(0,l._)([(0,u.Kw)(at.V)],he.prototype,"visualVariableSizeUnitValue",void 0),(0,l._)([(0,u.e5)(We.N)],he.prototype,"mosaicInfo",void 0),(0,l._)([(0,l.a)(0,(0,u.qH)(ve)),(0,l.a)(1,(0,u.qH)(Ee))],he.prototype,"vertex",null),(0,l._)([(0,l.a)(0,(0,u.qH)(class Nt extends M.fz{}))],he.prototype,"fragment",null);var Gt=v(77275),jt=v(61594);class kt{constructor(){this.computeAttributes={}}get locationsMap(){const i=new Map;for(const r in this.locations)i.set(r,this.locations[r].index);return i}get optionPropertyKeys(){if(!this._optionPropertyKeys){const i=new Set(Object.keys(this.options));this._optionPropertyKeys=i}return this._optionPropertyKeys}get _transformFeedbackBindings(){return[]}get locationInfo(){if(!this._locationInfo){const i=this.locationsMap,r=Array.from(i.entries()).map(([o,d])=>`${o}.${d}`).join("."),a=(0,Gt.hP)(r);this._locationInfo={hash:a,locations:i}}return this._locationInfo}get renamedLocationsMap(){const i=new Map;for(const[r,a]of this.locationsMap.entries())i.set("a_"+r,a);return i}getShaderKey(i,r,a){const o=Object.keys(a).filter(p=>a[p]).map(p=>`${p}_${a[p].toString()}`).join("."),d=Object.keys(r).filter(p=>this.optionPropertyKeys.has(p)).join(".");return`${i.hash}.${o}.${d}`}getProgram(i,r,a,o){let d="",p="";for(const b in a)if(a[b]){const x="boolean"==typeof a[b]?`#define ${b}\n`:`#define ${b} ${a[b]}\n`;d+=x,p+=x}return d+=this.vertexShader,p+=this.fragmentShader,new jt.X(d,p,this.renamedLocationsMap,this.locationInfo,this._getUniformBindings(r),this._transformFeedbackBindings)}_getUniformBindings(i){const r=[];for(const a in this.required){const o=this.required[a];r.push({uniformHydrated:null,shaderModulePath:a,uniformName:a,uniformType:o.type,uniformArrayElementType:nt(o),uniformArrayLength:lt(o)})}for(const a in i){const o=this.options[a];if(i[a])for(const d in o){const p=o[d];r.push({uniformHydrated:null,shaderModulePath:`${a}.${d}`,uniformName:d,uniformType:p.type,uniformArrayElementType:nt(p),uniformArrayLength:lt(p)})}}return r}}const nt=g=>"array"===g.type?g.elementType?.type:void 0,lt=g=>"array"===g.type?g.size:void 0;var ut=v(37977);const Zt={hittestDist:s.bv,hittestPos:s.Sg},Xt={filterFlags:s.Eg,animation:s.Eg,visualVariableData:s.Eg,dataDriven0:s.Eg,dataDriven1:s.Eg,dataDriven2:s.Eg,gpgpu:s.Eg,size:s.bv},Yt={displayViewScreenMat3:s.Tu,displayViewMat3:s.Tu,displayMat3:s.Tu,viewMat3:s.Tu,tileMat3:s.Tu,displayZoomFactor:s.bv,requiredZoomFactor:s.bv,tileOffset:s.Sg,currentScale:s.bv,currentZoom:s.bv,metersPerSRUnit:s.bv};class $t extends kt{constructor(){super(...arguments),this.vertexShader=(0,ut.w)("materials/pie/pie.vert"),this.fragmentShader=(0,ut.w)("materials/pie/pie.frag"),this.required={...Xt,...Yt,outlineWidth:s.bv,colors:s.v8,defaultColor:s.T8,othersColor:s.T8,outlineColor:s.T8,donutRatio:s.bv,sectorThreshold:s.bv},this.options={hittestUniforms:Zt,visualVariableSizeMinMaxValue:{minMaxValueAndSize:s.T8},visualVariableSizeScaleStops:{sizes:{...s.v8.ofType(s.bv,8),type:"array",elementType:s.bv,size:8},values:{...s.v8.ofType(s.bv,8),type:"array",elementType:s.bv,size:8}},visualVariableSizeStops:{sizes:{...s.v8.ofType(s.bv,8),type:"array",elementType:s.bv,size:8},values:{...s.v8.ofType(s.bv,8),type:"array",elementType:s.bv,size:8}},visualVariableSizeUnitValue:{unitValueToPixelsRatio:s.bv},visualVariableOpacity:{opacities:{...s.v8.ofType(s.bv,8),type:"array",elementType:s.bv,size:8},opacityValues:{...s.v8.ofType(s.bv,8),type:"array",elementType:s.bv,size:8}}},this.locations={pos:{index:0,type:s.Sg},id:{index:1,type:s.AO},bitset:{index:2,type:s.bv},offset:{index:3,type:s.Sg},texCoords:{index:4,type:s.Sg},size:{index:5,type:s.Sg},referenceSize:{index:6,type:s.bv},zoomRange:{index:7,type:s.Sg}},this.defines={VV_SIZE_MIN_MAX_VALUE:"boolean",VV_SIZE_SCALE_STOPS:"boolean",VV_SIZE_FIELD_STOPS:"boolean",VV_SIZE_UNIT_VALUE:"boolean",VV_OPACITY:"boolean",HITTEST:"boolean",numberOfFields:"number",highlight:"boolean",inside:"boolean",outside:"boolean"}}setNumberOfFields(i){this.required.colors={...s.v8.ofType(s.T8,i),type:"array",elementType:s.T8,size:i}}}const Ae={fill:new class gt extends F{constructor(){super(...arguments),this.meshWriter=ce.U.FillMeshWriter,this.shaders={geometry:new ke.C}}render(i,r){const{context:a,painter:o}=i;o.setShader({shader:this.shaders.geometry,uniforms:{...(0,h.vY)(i,r.target,r.instance.getInput().geometry),...(0,h.l5)(i,r.target)},defines:(0,h.rO)(i),optionalAttributes:r.instance.optionalAttributes,useComputeBuffer:(0,h.VF)(i)}),o.setPipelineState((0,h.H6)(i)),o.submitDraw(a,r)}}("fill"),patternFill:new class wt extends F{constructor(){super(...arguments),this.meshWriter=ce.U.PatternFillMeshWriter,this.shaders={geometry:new _t.lA}}render(i,r){const{context:a,painter:o}=i;o.setShader({shader:this.shaders.geometry,uniforms:{...(0,h.vY)(i,r.target,r.instance.getInput().geometry),...(0,h.l5)(i,r.target),mosaicInfo:o.textureManager.getMosaicInfo(a,r.textureKey),localTileOffset:(0,h.wb)(r.target)},defines:{...(0,h.rO)(i)},optionalAttributes:r.instance.optionalAttributes,useComputeBuffer:(0,h.VF)(i)}),o.setPipelineState((0,h.H6)(i)),o.submitDraw(a,r)}}("patternFill"),complexFill:new class vt extends F{constructor(){super(...arguments),this.meshWriter=ce.U.ComplexFillMeshWriter,this.shaders={geometry:new mt.LU}}render(i,r){const{context:a,painter:o}=i;o.setShader({shader:this.shaders.geometry,uniforms:{...(0,h.vY)(i,r.target,r.instance.getInput().geometry),...(0,h.l5)(i,r.target),mosaicInfo:o.textureManager.getMosaicInfo(a,r.textureKey),localTileOffset:(0,h.wb)(r.target)},defines:{...(0,h.rO)(i)},optionalAttributes:r.instance.optionalAttributes,useComputeBuffer:(0,h.VF)(i)}),o.setPipelineState((0,h.H6)(i)),o.submitDraw(a,r)}}("complexFill"),outlineFill:new class St extends F{constructor(){super(...arguments),this.meshWriter=ce.U.OutlineFillMeshWriter,this.shaders={geometry:new xt.py}}render(i,r){const{context:a,painter:o,pixelRatio:d}=i;o.setShader({shader:this.shaders.geometry,uniforms:{...(0,h.vY)(i,r.target,r.instance.getInput().geometry),...(0,h.l5)(i,r.target),antialiasingControls:ze(d)},defines:{...(0,h.rO)(i)},optionalAttributes:r.instance.optionalAttributes,useComputeBuffer:(0,h.VF)(i)}),o.setPipelineState((0,h.H6)(i)),o.submitDraw(a,r)}}("outlineFill"),patternOutlineFill:new class Tt extends F{constructor(){super(...arguments),this.meshWriter=ce.U.PatternOutlineFillMeshWriter,this.shaders={geometry:new Vt.Zd}}render(i,r){const{context:a,painter:o,pixelRatio:d}=i;o.setShader({shader:this.shaders.geometry,uniforms:{...(0,h.vY)(i,r.target,r.instance.getInput().geometry),...(0,h.l5)(i,r.target),antialiasingControls:ze(d),mosaicInfo:o.textureManager.getMosaicInfo(a,r.textureKey),localTileOffset:(0,h.wb)(r.target)},defines:{...(0,h.rO)(i)},optionalAttributes:r.instance.optionalAttributes,useComputeBuffer:(0,h.VF)(i)}),o.setPipelineState((0,h.H6)(i)),o.submitDraw(a,r)}}("patternOutlineFill"),complexOutlineFill:new class bt extends F{constructor(){super(...arguments),this.meshWriter=ce.U.ComplexOutlineFillMeshWriter,this.shaders={geometry:new yt.Nz}}render(i,r){const{context:a,painter:o,pixelRatio:d}=i;o.setShader({shader:this.shaders.geometry,uniforms:{...(0,h.vY)(i,r.target,r.instance.getInput().geometry),...(0,h.l5)(i,r.target),antialiasingControls:ze(d),mosaicInfo:o.textureManager.getMosaicInfo(a,r.textureKey),localTileOffset:(0,h.wb)(r.target)},defines:{...(0,h.rO)(i)},optionalAttributes:r.instance.optionalAttributes,useComputeBuffer:(0,h.VF)(i)}),o.setPipelineState((0,h.H6)(i)),o.submitDraw(a,r)}}("complexOutlineFill"),marker:new class Kt extends F{constructor(){super(...arguments),this.meshWriter=ce.U.MarkerMeshWriter,this.shaders={geometry:new he},this.symbologyPlane=E.mH.MARKER}render(i,r){const{context:a,painter:o}=i;o.setShader({shader:this.shaders.geometry,uniforms:{...(0,h.vY)(i,r.target,r.instance.getInput().geometry),...(0,h.l5)(i,r.target),mosaicInfo:o.textureManager.getMosaicInfo(a,r.textureKey,!0)},defines:{...(0,h.rO)(i)},optionalAttributes:r.instance.optionalAttributes,useComputeBuffer:(0,h.VF)(i)}),o.setPipelineState((0,h.H6)(i)),o.submitDraw(a,r)}}("marker"),pieChart:new class Jt extends F{constructor(){super(...arguments),this.meshWriter=ce.U.PieChartMeshWriter,this.shaders={geometry:new $t},this.symbologyPlane=E.mH.MARKER}render(i,r){const{context:a,painter:o}=i,{instance:d,target:p}=r,b=this.shaders.geometry,x=d.getInput(),S=x.numberOfFields,_=(0,h.VF)(i),T=(0,h.l5)(i,p),P=(0,h.rO)(i);b.setNumberOfFields(S),o.setShader({shader:b,uniforms:{...(0,h.vY)(i,r.target,x.geometry),...T.storage,...T.view,hittestUniforms:T.hittestRequest?{hittestDist:T.hittestRequest?.distance,hittestPos:T.hittestRequest?.position}:null},defines:{VV_SIZE_MIN_MAX_VALUE:!!x.geometry.visualVariableSizeMinMaxValue,VV_SIZE_SCALE_STOPS:!!x.geometry.visualVariableSizeScaleStops,VV_SIZE_FIELD_STOPS:!!x.geometry.visualVariableSizeStops,VV_SIZE_UNIT_VALUE:!!x.geometry.visualVariableSizeUnitValue,VV_OPACITY:!!x.geometry.visualVariableOpacity,HITTEST:_,highlight:T.highlight?1:0,...P,numberOfFields:S},optionalAttributes:{},useComputeBuffer:_}),o.setPipelineState((0,h.H6)(i)),o.submitDraw(a,r)}}("pieChart"),line:new class Bt extends F{constructor(){super(...arguments),this.meshWriter=ce.U.LineMeshWriter,this.shaders={geometry:new Oe.Pf},this.symbologyPlane=E.mH.LINE}render(i,r){const{context:a,painter:o,pixelRatio:d}=i;o.setShader({shader:this.shaders.geometry,uniforms:{...(0,h.vY)(i,r.target,r.instance.getInput().geometry),...(0,h.l5)(i,r.target),antialiasingControls:ze(d)},defines:{...(0,h.rO)(i)},optionalAttributes:r.instance.optionalAttributes,useComputeBuffer:(0,h.VF)(i)}),o.setPipelineState((0,h.H6)(i)),o.submitDraw(a,r)}}("line"),texturedLine:new class Wt extends F{constructor(){super(...arguments),this.meshWriter=ce.U.TexturedLineMeshWriter,this.shaders={geometry:new Ge},this.symbologyPlane=E.mH.LINE}render(i,r){const{context:a,painter:o,pixelRatio:d}=i;o.setShader({shader:this.shaders.geometry,uniforms:{...(0,h.vY)(i,r.target,r.instance.getInput().geometry),...(0,h.l5)(i,r.target),antialiasingControls:ze(d),mosaicInfo:o.textureManager.getMosaicInfo(a,r.textureKey)},defines:{...(0,h.rO)(i)},optionalAttributes:r.instance.optionalAttributes,useComputeBuffer:(0,h.VF)(i)}),o.setPipelineState((0,h.H6)(i)),o.submitDraw(a,r)}}("texturedLine"),text:new class Qt extends F{constructor(){super(...arguments),this.meshWriter=ce.U.TextMeshWriter,this.shaders={geometry:new ne},this.symbologyPlane=E.mH.TEXT}render(i,r){const{context:a,painter:o}=i,d=(0,h.rO)(i),p={shader:this.shaders.geometry,uniforms:{...(0,h.vY)(i,r.target,r.instance.getInput().geometry),...(0,h.l5)(i,r.target),mosaicInfo:o.textureManager.getMosaicInfo(a,r.textureKey)},defines:{...d,isHaloPass:!1,isBackgroundPass:!0,isLabel:!1},optionalAttributes:r.instance.optionalAttributes,useComputeBuffer:(0,h.VF)(i)};o.setShader(p),o.setPipelineState((0,h.H6)(i)),o.submitDraw(a,r),o.setShader({...p,defines:{...d,isHaloPass:!0,isBackgroundPass:!1,isLabel:!1}}),o.submitDraw(a,r),o.setShader({...p,defines:{...d,isHaloPass:!1,isBackgroundPass:!1,isLabel:!1}}),o.submitDraw(a,r)}}("text"),label:new class Ut extends F{constructor(){super(...arguments),this.meshWriter=ce.U.LabelMeshWriter,this.shaders={geometry:new ne},this.drawPhase=E.jx.LABEL|E.jx.LABEL_ALPHA,this.symbologyPlane=E.mH.TEXT}render(i,r){const{context:a,painter:o}=i,d=(0,h.rO)(i),p={...(0,h.H6)(i)},b={shader:this.shaders.geometry,uniforms:{...(0,h.vY)(i,r.target,r.instance.getInput().geometry),...(0,h.l5)(i,r.target),mosaicInfo:o.textureManager.getMosaicInfo(a,r.textureKey)},defines:{...d,isHaloPass:!1,isBackgroundPass:!0,isLabel:!0},optionalAttributes:r.instance.optionalAttributes,useComputeBuffer:!1};o.setShader(b),o.setPipelineState(p),o.submitDraw(a,r),o.setShader({...b,defines:{...d,isHaloPass:!0,isBackgroundPass:!1,isLabel:!0}}),o.setPipelineState(p),o.submitDraw(a,r),o.setShader({...b,defines:{...d,isHaloPass:!1,isBackgroundPass:!1,isLabel:!0}}),o.setPipelineState(p),o.submitDraw(a,r)}}("label"),heatmap:new class Ft extends F{constructor(){super(...arguments),this.meshWriter=ce.U.HeatmapMeshWriter,this.shaders={accumulate:new Me,resolve:new Te},this.postProcessingEnabled=!0,this._isBound=!1,this._resources=new Map,this.overrideStencilRef=Qe}shutdown(i){super.shutdown(i),this._resources.get(i)?.destroy(),this._resources.delete(i),this._prevFBO=null,this._unbind()}render(i,r){const{context:a,painter:o,state:d}=i,p=r.instance.getInput(),{isFieldActive:b}=p,x=this._getOrCreateResourcesRecord(a),S=x.loadQualityProfile(a);if((0,h.il)(i))return;(0,h.VF)(i)||this._bind(i,x,p),o.setShader({shader:this.shaders.accumulate,uniforms:{...(0,h.l5)(i,r.target),kernelControls:{radius:et(p,d),isFieldActive:b?1:0}},defines:{...(0,h.rO)(i),...S.defines},optionalAttributes:r.instance.optionalAttributes,useComputeBuffer:(0,h.VF)(i)});const _=(0,h.VF)(i)?It:qe;o.setPipelineState(_),o.submitDraw(a,r)}postProcess(i,r){if((0,h.VF)(i)||(0,h.il)(i))return;const{context:a,painter:o}=i,d=this._resources.get(a);if(null==this._prevFBO||null==this._prevViewport||!d?.initialized)return;const{defines:p}=d.loadQualityProfile(a),{minDensity:b,maxDensity:x,radius:S}=r.getInput(),P=d.accumulateFramebuffer,C=d.resolveGradientTexture;o.setShader({shader:this.shaders.resolve,uniforms:{accumulatedDensity:{texture:{unit:8,texture:P.colorTexture},minAndInvRange:[b,1/(x-b)],normalization:3/(S*S*Math.PI)},gradient:{texture:{unit:9,texture:C}}},defines:p,optionalAttributes:{},useComputeBuffer:!1}),a.bindFramebuffer(this._prevFBO),a.setViewport(0,0,this._prevViewport.width,this._prevViewport.height),a.bindTexture(P.colorTexture,8),a.bindTexture(C,9),o.setPipelineState(Ct),o.submitDrawQuad(a),this._unbind()}_getOrCreateResourcesRecord(i){let r=this._resources.get(i);return null==r&&(r=new Pt,this._resources.set(i,r)),r}_unbind(){this._prevFBO=null,this._prevViewport=null,this._isBound=!1}_bind(i,r,a){if(this._isBound)return;const{context:o,state:d,pixelRatio:p}=i,b=o.getBoundFramebufferObject(),x=o.getViewport();this._prevFBO=b,this._prevViewport=x;const{gradient:S,gradientHash:_}=a;r.ensureResolveGradientTexture(o,_,S);const{width:T,height:P}=x,C=function Dt(g,i){const r=i>1.5?.25:.5;return g<1/(2*r)?1:r}(et(a,d),p),Z=r.ensureAccumulateFBO(o,T*C,P*C);o.blitFramebuffer(b,Z,0,0,b.width,b.height,0,0,Z.width,Z.height,n.lk.STENCIL_BUFFER_BIT,n.cw.NEAREST),o.bindFramebuffer(Z),o.setViewport(0,0,Z.width,Z.height),o.setColorMask(!0,!0,!0,!0),o.setClearColor(0,0,0,0),o.clear(n.lk.COLOR_BUFFER_BIT),this._isBound=!0}}("heatmap"),dotDensity:new class ft extends F{constructor(){super(...arguments),this.shaders={polygon:new ie,point:new $,fill:new ke.C},this.meshWriter=ce.U.DotDensityMeshWriter,this._resources=new Map}render(i,r){(0,h.il)(i)||(0,h.VF)(i)?this._renderPolygons(i,r):this._renderDotDensity(i,r)}_renderPolygons(i,r){const{context:a,painter:o}=i;o.setShader({shader:this.shaders.fill,uniforms:{...(0,h.l5)(i,r.target),visualVariableColor:null,visualVariableOpacity:null},defines:{...(0,h.rO)(i)},optionalAttributes:{zoomRange:!1},useComputeBuffer:(0,h.VF)(i)}),o.setPipelineState((0,h.H6)(i)),o.submitDraw(a,r)}_renderDotDensity(i,r){const{context:a,painter:o,requiredLevel:d}=i,p=r.instance.getInput(),b=this._getOrCreateResourcesRecord(a),x=b.getDotDensityTextures(a,z.i9,p.seed),S=1/2**(d-r.target.key.level),_=z.i9,T=_*window.devicePixelRatio*_*window.devicePixelRatio,k=p.dotValue*(p.dotScale?i.state.scale/p.dotScale:1)*(1/S*(1/S));o.setShader({shader:this.shaders.polygon,uniforms:{...(0,h.l5)(i,r.target),instance:{isActive:p.isActive,colors:p.colors,dotValue:Math.max(1,k)},draw:{dotTexture0:{unit:z.Of,texture:x[0]},dotTexture1:{unit:z.vk,texture:x[1]},tileZoomFactor:S,pixelRatio:window.devicePixelRatio,tileDotsOverArea:T/(z.i9*window.devicePixelRatio*z.i9*window.devicePixelRatio)}},defines:{...(0,h.rO)(i),blending:p.blending},optionalAttributes:{},useComputeBuffer:!1}),o.setPipelineState((0,h.H6)(i));const N=a.getViewport();a.setViewport(0,0,z.i9,z.i9);const Z=a.getBoundFramebufferObject(),ee=b.getFBO(a);a.bindFramebuffer(ee),a.setClearColor(0,0,0,0),o.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}),o.updatePipelineState(a),a.clear(n.lk.COLOR_BUFFER_BIT),o.submitDraw(a,r),a.bindFramebuffer(Z),a.setViewport(N.x,N.y,N.width,N.height);const Y=b.getFBO(a).colorTexture;o.setShader({shader:this.shaders.point,uniforms:{view:(0,h.yF)(i,r.target),instance:{dotSize:p.dotSize},draw:{locations:{unit:z.Of,texture:Y},tileZoomFactor:1,pixelRatio:window.devicePixelRatio}},defines:{...(0,h.rO)(i)},optionalAttributes:{},useComputeBuffer:!1}),o.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}),o.submitDrawMesh(a,b.getDotDensityMesh(a))}shutdown(i){super.shutdown(i),this._resources.get(i)?.destroy(),this._resources.delete(i)}_getOrCreateResourcesRecord(i){let r=this._resources.get(i);return null==r&&(r=new ht,this._resources.set(i,r)),r}}("dotDensity")};function qt(){for(const g in Ae)Ae[g].startup()}function ei(g){for(const i in Ae)Ae[i].shutdown(g)}},958:(_e,te,v)=>{v.d(te,{$F:()=>l,vZ:()=>R});var z=v(85931),h=v(39406),E=v(22418),F=v(31637);function l(m,V){return{type:"simple",filters:V,capabilities:{maxTextureSize:(0,F.h)().maxTextureSize},bindings:s(m)}}function u(m){switch(m){case"opacity":return h.CU.OPACITY;case"color":return h.CU.COLOR;case"rotation":return h.CU.ROTATION;case"size":return h.CU.SIZE;default:return null}}function s(m){if(!m)return[];switch(m.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return R(m);case"dot-density":return function M(m){const V=[];for(const B of m.attributes)V.push({binding:V.length,expression:B.valueExpression,field:B.field});return V}(m);case"pie-chart":return function G(m){const V=R(m);let B=4;for(const K of m.attributes)V.push({binding:B++,expression:K.valueExpression,field:K.field});return V}(m);case"heatmap":return function O({valueExpression:m,field:V}){return m||V?[{binding:0,expression:m,field:V}]:[]}(m)}}function R(m){return"visualVariables"in m&&m.visualVariables?.length?(0,E.t)(m.visualVariables).map(V=>function I(m){switch(m.type){case"size":return function W(m){return"$view.scale"===m.valueExpression?null:{binding:u(m.type),field:m.field,normalizationField:m.normalizationField,expression:m.valueExpression,valueRepresentation:m.valueRepresentation}}(m);case"color":return function j(m){return{binding:u(m.type),field:m.field,normalizationField:m.normalizationField,expression:m.valueExpression}}(m);case"opacity":return function X(m){return{binding:u(m.type),field:m.field,normalizationField:m.normalizationField,expression:m.valueExpression}}(m);case"rotation":return function $(m){return{binding:u(m.type),expression:m.valueExpression,field:m.field}}(m)}}(V)).filter(z.pC):[]}},31201:(_e,te,v)=>{v.d(te,{Jh:()=>B,Sc:()=>oe,XS:()=>K});var z=v(23841),h=v(16730),E=v(21254),F=v(39351),l=v(36519),u=v(5352),s=v(22418);const M=1.25,G=128,O=128;function R(c){if(!c.stops?.length)return null;const n=c.stops.sort((L,H)=>L.value-H.value),y=(0,u.Q)(n,8);return{values:y.map(({value:L})=>L),colors:y.map(({color:L})=>(0,u.n)(L))}}function W(c){if(!c.stops?.length)return null;const n=c.stops.sort((f,w)=>f.value-w.value),y=(0,u.Q)(n,8);return{opacityValues:y.map(({value:f})=>f),opacities:y.map(({opacity:f})=>f)}}function j(c){return{rotationType:"geographic"===c.rotationType?l.MO.Geographic:l.MO.Arithmatic}}function X(c){if(!c.stops?.length)return null;if(c.stops.some(f=>f.useMaxValue||f.useMinValue))return(f,w)=>{const L=f.statisticsByLevel.get(w.key.level),H=c.stops.map(U=>({value:U.useMaxValue?L?.get(c.field)?.maxValue??0:U.useMinValue?L?.get(c.field)?.minValue??0:U.value,size:U.size?(0,z.F2)(U.size):F.k9})).sort((U,ae)=>U.value-ae.value),Q=(0,u.Q)(H,8);return{values:Q.map(({value:U})=>U),sizes:Q.map(({size:U})=>U)}};const n=c.stops.sort((f,w)=>f.value-w.value),y=(0,u.Q)(n,8);return{values:y.map(({value:f})=>f),sizes:y.map(({size:f})=>(0,z.F2)(f))}}function I(c){return n=>{const{state:y}=n;return{unitValueToPixelsRatio:(0,h.c9)(y.spatialReference)/E.a[c.valueUnit]/y.resolution}}}function m(c,n){const y=n.length;if(c<n[0].value||1===y)return n[0].size;for(let f=1;f<y;f++)if(c<n[f].value)return n[f-1].size+(c-n[f-1].value)/(n[f].value-n[f-1].value)*(n[f].size-n[f-1].size);return n[y-1].size}function V(c){const{minDataValue:n,maxDataValue:y,minSize:f,maxSize:w}=c;if("object"==typeof f&&"object"==typeof w)return(L,H)=>{const Q=L.state.scale,U=(0,z.F2)(m(Q,f.stops)),ae=(0,z.F2)(m(Q,w.stops));return{minMaxValueAndSize:[n,y,U,ae]}};if("object"==typeof f||"object"==typeof w)throw new Error("InternalError: Found a partial VisualVariableSizeMinMaxValue");return{minMaxValueAndSize:[n,y,(0,z.F2)(f),(0,z.F2)(w)]}}const B={visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:null,visualVariableSizeStops:null,visualVariableSizeScaleStops:null,visualVariableSizeOutlineScaleStops:null,visualVariableSizeUnitValue:null,visualVariableSizeMinMaxValue:null};function K(c,n=O,y=M){if(c.visualVariableSizeMinMaxValue)return c.visualVariableSizeMinMaxValue instanceof Function?G:Math.max(c.visualVariableSizeMinMaxValue.minMaxValueAndSize[3]*y,n);if(c.visualVariableSizeScaleStops){if(c.visualVariableSizeScaleStops instanceof Function)return G;const f=c.visualVariableSizeScaleStops.sizes;return Math.max(f[f.length-1]*y,n)}if(c.visualVariableSizeStops){if(c.visualVariableSizeStops instanceof Function)return G;const f=c.visualVariableSizeStops.sizes;return Math.max(f[f.length-1]*y,n)}return c.visualVariableSizeUnitValue?2*G:0}function oe(c){const n={...B};if(!c||!("visualVariables"in c)||!c.visualVariables)return n;for(const y of(0,s.t)(c.visualVariables))switch(y.type){case"color":n.visualVariableColor=R(y);break;case"opacity":n.visualVariableOpacity=W(y);break;case"rotation":n.visualVariableRotation=j(y);break;case"size":switch(ie(y)){case"field-stops":n.visualVariableSizeStops=X(y);break;case"scale-stops":"outline"===y.target?n.visualVariableSizeOutlineScaleStops=X(y):n.visualVariableSizeScaleStops=X(y);break;case"min-max":n.visualVariableSizeMinMaxValue=V(y);break;case"unit-value":n.visualVariableSizeUnitValue=I(y)}break;default:console.error("Unable to handle VV type")}return n}function ie(c){if("number"==typeof c.minDataValue&&"number"==typeof c.maxDataValue&&null!=c.minSize&&null!=c.maxSize)return"min-max";if((c.expression&&"view.scale"===c.expression||c.valueExpression&&"$view.scale"===c.valueExpression)&&Array.isArray(c.stops))return"scale-stops";if((null!=c.field||c.expression&&"view.scale"!==c.expression||c.valueExpression&&"$view.scale"!==c.valueExpression)&&(Array.isArray(c.stops)||"levels"in c&&c.levels))return"field-stops";if((null!=c.field||c.expression&&"view.scale"!==c.expression||c.valueExpression&&"$view.scale"!==c.valueExpression)&&null!=c.valueUnit)return"unit-value";throw new Error("InternalError: Found unknown sizeVV type")}},5352:(_e,te,v)=>{function z(E,F){const l=E.slice(0,F),u=F-l.length;for(let s=0;s<u;s++)l.push(l[l.length-1]);return l}function h(E){if(!E)return[0,0,0,0];const{r:F,g:l,b:u,a:s}=E;return[F*(s/255),l*(s/255),u*(s/255),s]}v.d(te,{Q:()=>z,n:()=>h})},80095:(_e,te,v)=>{v.d(te,{$L:()=>G,KR:()=>B,QA:()=>ie,U9:()=>X,UX:()=>s,cs:()=>K,ep:()=>I,zw:()=>W});var z=v(15861),h=v(35909),E=v(96731),F=v(33428),l=v(31201),u=v(6939);function s(c){return c.minScale||c.maxScale?{minScale:c.minScale??0,maxScale:c.maxScale??0}:null}function M(c){if(null==c)return null;if(Array.isArray(c)){const[n,y,f,w]=c;return[n,y,f,255*w]}return"string"==typeof c?c:{...c,defaultValue:M(c?.defaultValue)}}function G(c,n){return O.apply(this,arguments)}function O(){return(O=(0,z.Z)(function*(c,n){const{cimResourceManager:y,cimAnalyzer:f,scaleExpression:w}=n.schemaOptions;yield Promise.all(h.B$.fetchResources(c.symbol,y,[]));const L=f.analyzeSymbolReference(c,!1),H={scaleInfo:s(c),scaleExpression:w},Q=[];for(const U of L)switch(U.type){case"marker":Q.push(...R(U,n,H));break;case"fill":Q.push(...$(U,n,H));break;case"line":Q.push(...m(U,n,H));break;case"text":Q.push(...oe(U,n,H))}return Q})).apply(this,arguments)}function R(c,n,y){const{uniforms:f,schemaOptions:w}=n,{store:L}=w,H=c.isOutline?{...l.Jh,visualVariableSizeScaleStops:f.visualVariableSizeOutlineScaleStops}:{visualVariableColor:f.visualVariableColor,visualVariableOpacity:f.visualVariableOpacity,visualVariableSizeMinMaxValue:f.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:f.visualVariableSizeScaleStops,visualVariableSizeStops:f.visualVariableSizeStops,visualVariableSizeUnitValue:f.visualVariableSizeUnitValue,visualVariableRotation:f.visualVariableRotation};return W(L.ensureInstance(F.k2.marker,{geometry:H},{zoomRange:!!y.scaleInfo}),c,f,y)}function W(c,n,y,{scaleInfo:f,scaleExpression:w}){const L=(0,u.h)(y);return[c.createMeshInfo({params:{size:n.size,scaleX:n.scaleX,anchorX:n.anchorPoint.x,anchorY:n.anchorPoint.y,angle:n.rotation,color:M(n.color)??[0,0,0,0],colorLocked:n.colorLocked,frameHeight:n.frameHeight,widthRatio:n.widthRatio,scaleInfo:f,offsetX:n.offsetX,offsetY:n.offsetY,outlineColor:M(n.outlineColor)??[0,0,0,0],outlineSize:n.outlineWidth,referenceSize:n.referenceSize||E.E.CIMVectorMarker.size,rotateClockwise:n.rotateClockwise,scaleFactor:w??1,sizeRatio:n.sizeRatio,alignment:n.alignment,isAbsoluteAnchorPoint:n.isAbsoluteAnchorPoint,scaleSymbolsProportionally:n.scaleSymbolsProportionally,sprite:n.spriteRasterizationParam,hasSizeVV:L,placement:n.markerPlacement,effects:n.effects?{type:"cim-effect-infos",effectInfos:n.effects}:null,transforms:n.transform,minPixelBuffer:(0,l.XS)(y)}})]}function X(c,n,{scaleInfo:y}){return[c.createMeshInfo({params:{color:M(n.color)??[0,0,0,0],scaleInfo:y,effects:n.effects?{type:"cim-effect-infos",effectInfos:n.effects}:null}})]}function $(c,n,y){if(!c.spriteRasterizationParam)return function j(c,n,y){const{uniforms:f,schemaOptions:w}=n,{store:L}=w;return X(L.ensureInstance(F.k2.fill,{geometry:{visualVariableColor:c.colorLocked?null:f.visualVariableColor,visualVariableOpacity:f.visualVariableOpacity}},{zoomRange:!!y.scaleInfo}),c,y)}(c,n,y);const{uniforms:f,schemaOptions:w}=n,{store:L}=w;return I(L.ensureInstance(F.k2.complexFill,{geometry:{visualVariableColor:c.colorLocked?null:f.visualVariableColor,visualVariableOpacity:f.visualVariableOpacity}},{zoomRange:!!y.scaleInfo}),c,null!=f.visualVariableColor,y)}function I(c,n,y,{scaleInfo:f}){if(!n.spriteRasterizationParam)throw new Error("InternalError: Sprite should always be defined");const L=n.sampleAlphaOnly&&!(n.hasUnresolvedReplacementColor&&(!y||n.colorLocked)),H=n.spriteRasterizationParam;return[c.createMeshInfo({params:{color:M(n.color)??[0,0,0,0],height:n.height,aspectRatio:n.scaleX,offsetX:n.offsetX,offsetY:n.offsetY,scaleX:1,scaleY:1,angle:n.angle,applyRandomOffset:n.applyRandomOffset,sampleAlphaOnly:L,scaleProportionally:"CIMHatchFill"===H.resource.type,sprite:H,scaleInfo:f,effects:n.effects?{type:"cim-effect-infos",effectInfos:n.effects}:null}})]}function m(c,n,y){const{uniforms:f,schemaOptions:w}=n,{store:L}=w,H=c.isOutline?{...l.Jh,visualVariableSizeScaleStops:f.visualVariableSizeOutlineScaleStops}:{visualVariableColor:c.colorLocked?null:f.visualVariableColor,visualVariableOpacity:f.visualVariableOpacity,visualVariableSizeMinMaxValue:f.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:f.visualVariableSizeScaleStops,visualVariableSizeStops:f.visualVariableSizeStops,visualVariableSizeUnitValue:f.visualVariableSizeUnitValue},Q={geometry:H},U=!!(H.visualVariableSizeMinMaxValue||H.visualVariableSizeScaleStops||H.visualVariableSizeStops||H.visualVariableSizeUnitValue);return c.spriteRasterizationParam?K(L.ensureInstance(F.k2.texturedLine,Q,{zoomRange:!!y.scaleInfo}),c,U,y):B(L.ensureInstance(F.k2.line,Q,{zoomRange:!!y.scaleInfo}),c,U,y)}function V(c,n,{scaleInfo:y}){return{params:{color:M(c.color)??[0,0,0,0],width:c.width,referenceWidth:c.referenceWidth,capType:c.cap,joinType:c.join,miterLimit:c.miterLimit,scaleInfo:y,hasSizeVV:n,effects:c.effects?{type:"cim-effect-infos",effectInfos:c.effects}:null}}}function B(c,n,y,f){if(n.spriteRasterizationParam)throw new Error("InternalError: Sprite should not be defined");return[c.createMeshInfo({params:V(n,y,f).params})]}function K(c,n,y,f){const{spriteRasterizationParam:w,scaleDash:L,sampleAlphaOnly:H}=n;if(!w)throw new Error("InternalError: Sprite should be defined");return[c.createMeshInfo({params:{...V(n,y,f).params,shouldScaleDash:L??!1,shouldSampleAlphaOnly:H,isSDF:"CIMPictureStroke"!==w.resource.type,sprite:w}})]}function oe(c,n,y){const{uniforms:f,schemaOptions:w}=n,{store:L}=w;return ie(L.ensureInstance(F.k2.text,{geometry:{visualVariableColor:c.colorLocked?null:f.visualVariableColor,visualVariableOpacity:f.visualVariableOpacity,visualVariableRotation:f.visualVariableRotation,visualVariableSizeMinMaxValue:f.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:f.visualVariableSizeScaleStops,visualVariableSizeStops:f.visualVariableSizeStops,visualVariableSizeUnitValue:f.visualVariableSizeUnitValue}},{zoomRange:!!y.scaleInfo,referenceSymbol:!1,clipAngle:!1}),c,f,y)}function ie(c,n,y,{scaleInfo:f,scaleExpression:w}){return[c.createMeshInfo({params:{boxBackgroundColor:M(n.backgroundColor),boxBorderLineColor:M(n.borderLineColor),boxBorderLineSize:n.borderLineWidth??0,color:M(n.color)??[0,0,0,0],offsetX:n.offsetX,offsetY:n.offsetY,postAngle:n.angle,fontSize:n.size,referenceSize:n.referenceSize,decoration:n.decoration,haloColor:M(n.outlineColor)??[0,0,0,0],haloFontSize:n.outlineSize,lineWidth:n.lineWidth||512,lineHeightRatio:1,horizontalAlignment:n.horizontalAlignment??"center",verticalAlignment:n.verticalAlignment??"baseline",useCIMAngleBehavior:!1,glyphs:n.textRasterizationParam,scaleInfo:f,effects:n.effects?{type:"cim-effect-infos",effectInfos:n.effects}:null,placement:n.markerPlacement,transforms:n.transform,scaleFactor:w??1,minPixelBuffer:(0,l.XS)(y),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null,isLineLabel:!1}})]}},6939:(_e,te,v)=>{function z(E){return!!(E.visualVariableSizeMinMaxValue||E.visualVariableSizeScaleStops||E.visualVariableSizeStops||E.visualVariableSizeUnitValue||E.visualVariableSizeOutlineScaleStops)}function h(E){return!!E.visualVariableRotation}v.d(te,{A:()=>h,h:()=>z})},22418:(_e,te,v)=>{v.d(te,{T:()=>I,t:()=>M});var z=v(26584),h=v(63290),E=v(23841),F=v(31637);const l=8,u=l-2,s=()=>h.Z.getLogger("esri.views.2d.layers.features.support.rendererUtils");function M(m){return m.map(V=>function G(m){return("size"===m.type||"color"===m.type||"opacity"===m.type)&&null!=m.stops}(V)?function O(m){return m.stops=function X(m,V){return V.length<=l?V:(s().warn(`Found ${V.length} Visual Variable stops, but MapView only supports ${l}. Displayed stops will be simplified.`),V.length>2*l?function W(m,V){const[B,...K]=V,oe=K.pop(),ie=K[0].value,c=K[K.length-1].value,n=(c-ie)/u,y=[];for(let f=ie;f<c;f+=n){let w=0;for(;f>=K[w].value;)w++;const L=K[w],H=V[w-1],U=L.value===H.value?1:(f-H.value)/(L.value-H.value);if("color"===m){const ae=K[w],fe=V[w-1],ue=ae.color.clone();ue.r=R(fe.color.r,ue.r,U),ue.g=R(fe.color.g,ue.g,U),ue.b=R(fe.color.b,ue.b,U),ue.a=R(fe.color.a,ue.a,U),y.push({value:f,color:ue,label:ae.label})}else if("size"===m){const ae=K[w],fe=V[w-1],ue=(0,E.t_)(ae.size),De=R((0,E.t_)(fe.size),ue,U);y.push({value:f,size:De,label:ae.label})}else{const ae=K[w],fe=R(V[w-1].opacity,ae.opacity,U);y.push({value:f,opacity:fe,label:ae.label})}}return[B,...y,oe]}(m,V):function j(m){const[V,...B]=m,K=B.pop();for(;B.length>u;){let oe=0,ie=0;for(let c=1;c<B.length;c++){const f=Math.abs(B[c].value-B[c-1].value);f>ie&&(ie=f,oe=c)}B.splice(oe,1)}return[V,...B,K]}(V))}(m.type,m.stops??[]),m}(V.clone()):V)}function R(m,V,B){return(1-B)*m+B*V}function I(m){if(!m)return!0;switch(m.type){case"dot-density":break;case"heatmap":if(!function $(){const{supportsColorBufferFloat:m,supportsColorBufferFloatBlend:V,supportsColorBufferHalfFloat:B}=(0,F.h)();return m&&V||B}()){const V=(0,F.h)(),B=["supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter(K=>!V[K]).join(", ");return s().errorOnce(new z.Z("webgl-missing-extension",`Missing WebGL2 requirements for Heatmap: ${B}`)),!1}}return!0}},74738:(_e,te,v)=>{v.d(te,{Z:()=>M});var z=v(15861),h=v(25596),E=v(71251);function F(G){return G.some(O=>O.globalId)}function l(G){return G.filter(O=>!O.error).map(O=>O.objectId??O.globalId).filter(O=>null!=O)}function u(G,O){const R=new Set(G);for(const W of O.values())R.add(W);return R}function s(G,O){const R=new Set(G);for(const W of O.values())R.delete(W);return R}class M{constructor(O){this.updateTracking=new h.x({debugName:"FeatureCommandQueue"}),this._hasGlobalIds=!1,this._queueProcessor=new E.e({concurrency:1,process:O.process})}destroy(){this.updateTracking.destroy(),this._queueProcessor.destroy(),this.clear()}clear(){this._queueProcessor.clear()}push(O){var R=this;return(0,z.Z)(function*(){return R.updateTracking.addPromise(R._doPush(O))})()}_doPush(O){var R=this;return(0,z.Z)(function*(){const W=R._queueProcessor,j=W.last(),X=[];switch(O.type){case"update":if(j?.type===O.type)return;X.push(W.push(O));break;case"edit":{const $="processed-edit"===j?.type?j:null;$&&W.popLast();const I=R._mergeEdits($,O);for(const m of I)m&&X.push(W.push(m));break}}yield Promise.all(X)})()}_mergeEdits(O,R){const{addedFeatures:W,deletedFeatures:j,updatedFeatures:X}=R.edits;if(this._hasGlobalIds=this._hasGlobalIds||F(W)||F(X)||F(j),this._hasGlobalIds)return[O,{type:"processed-edit",edits:{addOrModified:[...W,...X],removed:j}}];const $=new Set(l(O?.edits.addOrModified??[])),I=new Set(l(O?.edits.removed??[])),m=new Set([...l(W),...l(X)]),V=new Set(l(j));return[{type:"processed-edit",edits:{addOrModified:Array.from(u(s($,V),m)).map(B=>({objectId:B})),removed:Array.from(u(s(I,m),V)).map(B=>({objectId:B}))}}]}}},34109:(_e,te,v)=>{v.d(te,{v:()=>F});var z=v(26584),h=v(67969);class E{constructor(u,s,M,G){this.dataType=u,this.samplingMode=s,this.pixelFormat=M,this.internalFormat=G}}function F(l,u){const{textureFloat:s,colorBufferFloat:M}=l.capabilities,G=s?.textureFloatLinear,O=M?.textureFloat,R=M?.textureHalfFloat,W=M?.floatBlend,j=l.driverTest.floatBufferBlend.result;if(!O&&!R)throw new z.Z("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");if(!(W&&j||R))throw new z.Z("heatmap:missing-float-blend","HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float."+(j?"":" This device claims support for EXT_float_blend, but does not actually support it."));const $=R,I=G,m=!!M?.R32F,V=!!M?.R16F;if(O&&W&&j&&I)return I||u.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),new E(h.Br.FLOAT,I?h.cw.LINEAR:h.cw.NEAREST,m?h.VI.RED:h.VI.RGBA,m?h.lP.R32F:h.VI.RGBA);if($)return new E(h.Br.HALF_FLOAT,h.cw.LINEAR,V?h.VI.RED:h.VI.RGBA,V?h.lP.R16F:h.VI.RGBA);throw new z.Z("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.")}}}]);