"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[299],{19702:(L,M,t)=>{t.d(M,{A:()=>g});var p=t(15861),y=t(17626),f=t(54024),E=t(10699),m=t(32917),v=t(77712),c=(t(90912),t(85931),t(76898)),I=t(36947);const g=W=>{let r=class extends W{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(l){super.postscript(l),(0,I.qC)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}_validateHeightModelInfo(){var l=this;return(0,p.Z)(function*(){const n=new AbortController,h=n.signal;l.handles.add((0,f.kB)(()=>n.abort())),yield(0,m.N1)(()=>l.view.defaultsFromMap?.heightModelInfoReady,h),(0,E.k_)(h);const D=(0,I.Wt)(l.layer,l.view.heightModelInfo,l.supportsHeightUnitConversion);if(D)throw D})()}canResume(){const l=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return super.canResume()&&(!l||!l.minScale||!l.maxScale||l.minScale>=l.maxScale)}getSuspendInfo(){const l=super.getSuspendInfo(),n=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return n&&n.minScale&&n.maxScale&&n.minScale<n.maxScale&&(l.outsideScaleRange=!0),l}};return(0,y._)([(0,v.Cb)()],r.prototype,"view",void 0),(0,y._)([(0,v.Cb)()],r.prototype,"slicePlaneEnabled",void 0),r=(0,y._)([(0,c.j)("esri.views.3d.layers.LayerView3D")],r),r}},19991:(L,M,t)=>{t.r(M),t.d(M,{default:()=>B});var _,s,p=t(15861),y=t(17626),E=(t(29132),t(26584)),m=t(72392),v=t(63290),a=t(62208),d=t(32917),c=t(77712),W=(t(90912),t(85931),t(76898)),r=t(84161),l=t(28093),n=t(55915),h=t(5548),D=t(37053),T=t(19702),x=t(40465),U=t(45611),w=t(57596),R=t(65234);(s=_||(_={}))[s.API=1]="API",s[s.VerboseAPI=2]="VerboseAPI",s[s.Error=3]="Error";const b=(0,l.c)(),A=(0,l.c)();let S=class extends((0,x.i)((0,T.A)(U.Z))){constructor(){super(...arguments),this._suspendedHandle=null,this._usedMemory=0,this._futureMemory=0,this.type="voxel-3d",this.slicePlaneEnabled=!1,this._wasmLayerId=-1,this._handles=new m.Z,this._dbgFlags=new Set}get baseUrl(){return this.layer.parsedUrl?.path??""}get wasmLayerId(){return this._wasmLayerId}initialize(){if(this._dbgFlags.add(_.Error),"local"!==this.view.viewingMode)throw new E.Z("voxel:unsupported-viewingMode","Voxel layers support local viewingMode only.",{});if(this.view._stage.renderView.renderingContext.type!==w.zO.WEBGL2)throw new E.Z("voxel:unsupported-context","Voxel layers are supported in WebGL2 rendering contexts only.",{});if(!this.view._stage.renderView.renderingContext.capabilities.colorBufferFloat?.textureFloat)throw new E.Z("voxel:missing-color-buffer-float","Voxel layers require the WebGL2 extension EXT_color_buffer_float",{});if(!(0,D.fS)(this.layer.spatialReference,this.view.spatialReference))throw new E.Z("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});const e=this.layer.currentVariableId,o=this.layer.getVolume(e),u=this.layer.getVariable(e);if((0,a.pC)(o)&&(0,a.pC)(u)){const O=o.zDimension;if(O>1){const K=o.dimensions[0].size*o.dimensions[1].size*o.dimensions[O].size;let V=1;switch(u.renderingFormat.type){case"Int16":case"UInt16":V=2;break;case"Int32":case"UInt32":case"Float32":V=4}this._futureMemory=V*K}}const C=this.view.addVoxelLayerViewToWasm(this).then(P=>{this._wasmLayerId=P,this._suspendedHandle=(0,d.YP)(()=>this.suspended,i=>{const O=this.view.voxelWasm;(0,a.pC)(O)&&O.setEnabled(this,!i)},d.nn),this._handles.add([(0,d.YP)(()=>this.layer.renderMode,i=>this._pushRenderModeToWasm(i)),(0,d.YP)(()=>this.layer.currentVariableId,i=>this._pushCurrentVariableIdToWasm(i)),(0,d.YP)(()=>this.layer.getSections(),i=>this._pushSectionsToWasm(i)),(0,d.YP)(()=>this.layer.getVariableStyles(),i=>this._pushVariableStylesToWasm(i)),(0,d.YP)(()=>this.layer.getVolumeStyles(),i=>this._pushVolumeStylesToWasm(i)),(0,d.YP)(()=>this.layer.enableDynamicSections,i=>this._pushEnableDynamicSectionsToWasm(i)),(0,d.YP)(()=>this.layer.enableIsosurfaces,i=>this._pushEnableIsosurfacesToWasm(i)),(0,d.YP)(()=>this.layer.enableSections,i=>this._pushEnableSectionsToWasm(i)),(0,d.YP)(()=>this.layer.enableSlices,i=>this._pushEnableSlicesToWasm(i)),(0,d.YP)(()=>this.slicePlaneEnabled,i=>this._pushAnalysisSliceToWasm(i,this.view.slicePlane)),(0,d.YP)(()=>this.view.slicePlane,i=>this._pushAnalysisSliceToWasm(this.slicePlaneEnabled,i))])}).catch(P=>{if(this.view.removeVoxelLayerViewFromWasm(this),this._wasmLayerId=-1,-1===P)throw new E.Z("voxel:addLayer-failure","The voxel layer description was invalid.",{});if(-2===P)throw new E.Z("voxel:addLayer-failure","The voxel layer web assembly module failed to download.",{})});this.addResolvingPromise(C)}destroy(){this.view.removeVoxelLayerViewFromWasm(this),this._suspendedHandle&&(this._suspendedHandle.remove(),this._suspendedHandle=null),this._handles=(0,a.SC)(this._handles)}isUpdating(){const s=this.view.voxelWasm;return!(this._wasmLayerId<0||!(0,a.pC)(s))&&s.isUpdating(this._wasmLayerId)}updatingFlagChanged(){this.notifyChange("updating")}getUsedMemory(){return this._usedMemory}getUnloadedMemory(){return this._futureMemory}ignoresMemoryFactor(){return!0}get performanceInfo(){return{nodes:0,displayedNumberOfFeatures:0,maximumNumberOfFeatures:0,totalNumberOfFeatures:0,core:null}}whenGraphicBounds(s,e){const o=s.attributes["Voxel.WorldPosition"];if(o){const u=(0,h.cS)(),C=JSON.parse(o);if((0,n.SH)(C,this.view.renderSpatialReference,A,this.view.spatialReference||R.Z.WGS84))return(0,h.pp)(u,A),Promise.resolve({boundingBox:u,screenSpaceObjects:[]})}return Promise.reject()}setUsedMemory(s){this._usedMemory=s,this._futureMemory=0}captureFrustum(){const s=this.view.voxelWasm;(0,a.pC)(s)&&s.captureFrustum()}toggleFullVolumeExtentDraw(){const s=this.view.voxelWasm;(0,a.pC)(s)&&s.toggleFullVolumeExtentDraw(this)}getLayerTimes(){let s=[];const e=this.view.voxelWasm;return(0,a.pC)(e)&&(s=e.getLayerTimes(this)),s}getCurrentLayerTimeIndex(){let s=0;const e=this.view.voxelWasm;return(0,a.pC)(e)&&(s=e.getCurrentLayerTimeIndex(this)),s}_pushRenderModeToWasm(s){const e=this.view.voxelWasm;this._dbg(_.VerboseAPI,"VoxelLayerView3D._pushRenderModeToWasm() called, "+((0,a.pC)(e)?"have WASM":"don't have WASM!!!")),(0,a.pC)(e)&&e.setRenderMode(this,s)||this._dbg(_.Error,"VoxelLayerView3D._pushRenderModeToWasm() failed!")}_pushSectionsToWasm(s){const e=this.view.voxelWasm;this._dbg(_.VerboseAPI,"VoxelLayerView3D._pushSectionsToWasm() called, "+((0,a.pC)(e)?"have WASM":"don't have WASM!!!")),(0,a.pC)(e)&&e.setStaticSections(this,s)||this._dbg(_.Error,"VoxelLayerView3D._pushSectionsToWasm() failed!")}_pushCurrentVariableIdToWasm(s){const e=this.view.voxelWasm;this._dbg(_.VerboseAPI,"VoxelLayerView3D._pushCurrentVariableIdToWasm() called!, "+((0,a.pC)(e)?"have WASM":"don't have WASM!!!")),(0,a.pC)(e)&&e.setCurrentVariable(this,s)||this._dbg(_.Error,"VoxelLayerView3D._pushCurrentVariableIdToWasm() failed!")}_pushVariableStylesToWasm(s){const e=this.view.voxelWasm;this._dbg(_.VerboseAPI,"VoxelLayerView3D._pushVariableStylesToWasm() called, "+((0,a.pC)(e)?"have WASM":"don't have WASM!!!"));let o=!1;(0,a.pC)(e)&&(o=e.setVariableStyles(this,s),o||this._dbg(_.Error,"VoxelLayerView3D._pushVariableStylesToWasm() failed!"))}_accountForEnableSlices(s,e){const o=(0,a.pC)(e)?e:this.layer.enableSlices;for(let u=0;u<s.length;++u){const C=s[u];for(const P of C.slices)P.enabled=P.enabled&&o}}_pushVolumeStylesToWasm(s){const e=this.view.voxelWasm;this._dbg(_.VerboseAPI,"VoxelLayerView3D._pushVolumeStylesToWasm() called, "+((0,a.pC)(e)?"have WASM":"don't have WASM!!!"));let o=!1;(0,a.pC)(e)&&(this._accountForEnableSlices(s,null),o=e.setVolumeStyles(this,s),o||this._dbg(_.Error,"VoxelLayerView3D._pushVolumeStylesToWasm() failed!"))}_pushAnalysisSliceToWasm(s,e){const o=this.view.voxelWasm;this._dbg(_.VerboseAPI,"VoxelLayerView3D._pushAnalysisSliceToWasm() called, "+((0,a.pC)(o)?"have WASM":"don't have WASM!!!"));let u=!1;if((0,a.pC)(o)){if((0,a.pC)(e)){const C=e.origin;(0,r.f)(b,e.basis1,e.basis2),(0,r.n)(b,b),u=o.setAnalysisSlice(this,s,C,b)}else(0,r.s)(b,0,0,1),u=o.setAnalysisSlice(this,!1,b,b);u||this._dbg(_.Error,"VoxelLayerView3D._pushAnalysisSliceToWasm() failed!")}}_pushEnableDynamicSectionsToWasm(s){const e=this.view.voxelWasm;this._dbg(_.VerboseAPI,"VoxelLayerView3D._pushEnableDynamicSectionsToWasm() called, "+((0,a.pC)(e)?"have WASM":"don't have WASM!!!"));let o=!1;(0,a.pC)(e)&&(o=e.setEnableDynamicSections(this,s),o||this._dbg(_.Error,"VoxelLayerView3D._pushEnableDynamicSectionsToWasm() failed!"))}_pushEnableSlicesToWasm(s){const e=this.view.voxelWasm;this._dbg(_.VerboseAPI,"VoxelLayerView3D._pushEnableSlicesToWasm() called, "+((0,a.pC)(e)?"have WASM":"don't have WASM!!!"));let o=!1;if((0,a.pC)(e)){const u=this.layer.getVolumeStyles();this._accountForEnableSlices(u,s),o=e.setVolumeStyles(this,u),o||this._dbg(_.Error,"VoxelLayerView3D._pushEnableSlicesToWasm() failed!")}}_pushEnableIsosurfacesToWasm(s){const e=this.view.voxelWasm;this._dbg(_.VerboseAPI,"VoxelLayerView3D._pushEnableIsosurfacesToWasm() called, "+((0,a.pC)(e)?"have WASM":"don't have WASM!!!"));let o=!1;(0,a.pC)(e)&&(o=e.setEnableIsosurfaces(this,s),o||this._dbg(_.Error,"VoxelLayerView3D._pushEnableIsosurfacesToWasm() failed!"))}_pushEnableSectionsToWasm(s){const e=this.view.voxelWasm;this._dbg(_.VerboseAPI,"VoxelLayerView3D._pushEnableSectionsToWasm() called, "+((0,a.pC)(e)?"have WASM":"don't have WASM!!!"));let o=!1;(0,a.pC)(e)&&(o=e.setEnableSections(this,s),o||this._dbg(_.Error,"VoxelLayerView3D._pushEnableSectionsToWasm() failed!"))}whenGraphicAttributes(s,e){return(0,p.Z)(function*(){return s})()}_dbg(s,e){this._dbgFlags.has(s)&&(s===_.Error?v.Z.getLogger(this.declaredClass).error(e):v.Z.getLogger(this.declaredClass).warn(e))}};(0,y._)([(0,c.Cb)()],S.prototype,"layer",void 0),(0,y._)([(0,c.Cb)()],S.prototype,"baseUrl",null),(0,y._)([(0,c.Cb)({type:Boolean})],S.prototype,"slicePlaneEnabled",void 0),S=(0,y._)([(0,W.j)("esri.views.3d.layers.VoxelLayerView3D")],S);const B=S},45611:(L,M,t)=>{t.d(M,{Z:()=>l});var p=t(17626),y=t(14517),f=t(61885),E=t(80542),m=t(61996),v=t(63290),a=t(62208),d=t(60330),c=t(77712),W=(t(90912),t(85931),t(76898));let r=class extends((0,E.p)((0,m.IG)((0,d.v)(f.Z.EventedMixin(y.Z))))){constructor(n){super(n),this.layer=null,this.parent=null}initialize(){this.when().catch(n=>{if("layerview:create-error"!==n.name){const h=this.layer&&this.layer.id||"no id",D=this.layer&&this.layer.title||"no title";v.Z.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${D}', id: '${h}')`,n)}})}get fullOpacity(){return(0,a.Pt)(this.get("layer.opacity"),1)*(0,a.Pt)(this.get("parent.fullOpacity"),1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer?.legendEnabled}get updating(){return!(!this.updatingHandles?.updating&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){return!0===this.layer?.visible}set visible(n){this._overrideIfSome("visible",n)}canResume(){return this.visible&&this.layer?.loaded&&!this.parent?.suspended&&this.view?.ready||!1}getSuspendInfo(){const n=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(n.viewNotReady=!0),this.layer&&this.layer.loaded||(n.layerNotLoaded=!0),this.visible||(n.layerInvisible=!0),n}isUpdating(){return!1}};(0,p._)([(0,c.Cb)()],r.prototype,"fullOpacity",null),(0,p._)([(0,c.Cb)()],r.prototype,"layer",void 0),(0,p._)([(0,c.Cb)()],r.prototype,"parent",void 0),(0,p._)([(0,c.Cb)({readOnly:!0})],r.prototype,"suspended",null),(0,p._)([(0,c.Cb)({readOnly:!0})],r.prototype,"suspendInfo",null),(0,p._)([(0,c.Cb)({readOnly:!0})],r.prototype,"legendEnabled",null),(0,p._)([(0,c.Cb)({type:Boolean,readOnly:!0})],r.prototype,"updating",null),(0,p._)([(0,c.Cb)({readOnly:!0})],r.prototype,"updatingProgress",null),(0,p._)([(0,c.Cb)()],r.prototype,"visible",null),(0,p._)([(0,c.Cb)()],r.prototype,"view",void 0),r=(0,p._)([(0,W.j)("esri.views.layers.LayerView")],r);const l=r},10023:(L,M,t)=>{t.d(M,{V:()=>v,e:()=>E});var p=t(15861),y=t(62208),f=t(36630);function E(a){return m.apply(this,arguments)}function m(){return(m=(0,p.Z)(function*(a,d=a.popupTemplate){if((0,y.Wi)(d))return[];const c=yield d.getRequiredFields(a.fieldsIndex),{lastEditInfoEnabled:I}=d,{objectIdField:g,typeIdField:W,globalIdField:r,relationships:l}=a;if(c.includes("*"))return["*"];const n=I?yield(0,f.CH)(a):[],h=(0,f.Q0)(a.fieldsIndex,[...c,...n]);return W&&h.push(W),h&&g&&a.fieldsIndex?.has(g)&&!h.includes(g)&&h.push(g),h&&r&&a.fieldsIndex?.has(r)&&!h.includes(r)&&h.push(r),l&&l.forEach(D=>{const{keyField:T}=D;h&&T&&a.fieldsIndex?.has(T)&&!h.includes(T)&&h.push(T)}),h})).apply(this,arguments)}function v(a,d){return a.popupTemplate?a.popupTemplate:(0,y.pC)(d)&&d.defaultPopupTemplateEnabled&&(0,y.pC)(a.defaultPopupTemplate)?a.defaultPopupTemplate:null}}}]);