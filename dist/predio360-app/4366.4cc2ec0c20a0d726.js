"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[4366],{4366:(O,R,e)=>{e.r(R),e.d(R,{default:()=>U});var y=e(15861),o=e(17626),u=e(62208),P=e(10699),v=e(32917),E=(e(63290),e(90912),e(85931),e(26584)),m=(e(8314),e(76898)),w=e(69759),d=e(77712),D=e(72642),T=e(13812),i=e(96854),C=e(10023);const g=a=>{let s=class extends a{constructor(){super(...arguments),this.view=null}fetchPopupFeatures(r,n){var l=this;return(0,y.Z)(function*(){const{layer:f}=l;if(!r)throw new E.Z("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:f});const{popupEnabled:p}=f,c=(0,C.V)(f,n);if(!p||(0,u.Wi)(c))throw new E.Z("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:p,popupTemplate:c});const b=yield c.getRequiredFields(),x=new i.Z;x.timeExtent=l.timeExtent,x.geometry=r,x.outFields=b,x.outSpatialReference=r.spatialReference;const{resolution:I,spatialReference:M}=l.view,L="2d"===l.view.type?new D.Z(I,I,M):new D.Z(.5*I,.5*I,M),{returnTopmostRaster:V,showNoDataRecords:W}=c.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},j={returnDomainValues:!0,returnTopmostRaster:V,pixelSize:L,showNoDataRecords:W,signal:(0,u.pC)(n)?n.signal:null};return f.queryVisibleRasters(x,j).then(z=>z)})()}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return(0,o._)([(0,d.Cb)()],s.prototype,"layer",void 0),(0,o._)([(0,d.Cb)()],s.prototype,"suspended",void 0),(0,o._)([(0,d.Cb)(T.qG)],s.prototype,"timeExtent",void 0),(0,o._)([(0,d.Cb)()],s.prototype,"view",void 0),s=(0,o._)([(0,m.j)("esri.views.layers.ImageryLayerView")],s),s};let F=class extends(g(w.Z)){constructor(){var a;super(...arguments),a=this,this.type="imagery-3d",this.redrawDebounced=(0,P.Ds)(function(){var s=(0,y.Z)(function*(r){a.redraw((n,l)=>a._redrawImage(n,l),r)});return function(r){return s.apply(this,arguments)}}(),2e3)}initialize(){this.handles.add([(0,v.gx)(()=>this.view.basemapTerrain.ready,()=>this._initializeMaximumDataResolution(),{once:!0,initial:!0}),this.layer.on("redraw",()=>this.updatingHandles.addPromise(this.redrawDebounced()))]),this.updatingHandles.add(()=>this.layer?.exportImageServiceParameters?.version,()=>{this.updatingHandles.addPromise(this.refreshDebounced())}),this.updatingHandles.add(()=>this.layer?.renderer,()=>{this.updatingHandles.addPromise(this.refreshDebounced())}),this.updatingHandles.add(()=>this.timeExtent,()=>this.updatingHandles.addPromise(this.refreshDebounced()))}_initializeMaximumDataResolution(){this.maximumDataResolution=this.layer.loaded?this.layer.serviceRasterInfo.pixelSize:null}getFetchOptions(){return{timeExtent:this.timeExtent}}processResult(a,s,r){var n=this;return(0,y.Z)(function*(){s.imageOrCanvasElement?a.image=s.imageOrCanvasElement:(a.image=document.createElement("canvas"),a.pixelData=s.pixelData,yield n._redrawImage(a,r))})()}_redrawImage(a,s){var r=this;return(0,y.Z)(function*(){if(!(a.image instanceof HTMLCanvasElement)||(0,u.Wi)(a.pixelData))throw new Error;const n=a.image,l=n.getContext("2d"),f=yield r.layer.applyRenderer(a.pixelData,{signal:s}),p=r.layer.applyFilter(f).pixelBlock;if((0,u.Wi)(p))throw new Error;n.width=p.width,n.height=p.height;const c=l.createImageData(p.width,p.height);c.data.set(p.getAsRGBA()),l.putImageData(c,0,0)})()}};F=(0,o._)([(0,m.j)("esri.views.3d.layers.ImageryLayerView3D")],F);const U=F},10023:(O,R,e)=>{e.d(R,{V:()=>Z,e:()=>P});var y=e(15861),o=e(62208),u=e(36630);function P(t){return v.apply(this,arguments)}function v(){return(v=(0,y.Z)(function*(t,h=t.popupTemplate){if((0,o.Wi)(h))return[];const E=yield h.getRequiredFields(t.fieldsIndex),{lastEditInfoEnabled:H}=h,{objectIdField:m,typeIdField:w,globalIdField:d,relationships:D}=t;if(E.includes("*"))return["*"];const T=H?yield(0,u.CH)(t):[],i=(0,u.Q0)(t.fieldsIndex,[...E,...T]);return w&&i.push(w),i&&m&&t.fieldsIndex?.has(m)&&!i.includes(m)&&i.push(m),i&&d&&t.fieldsIndex?.has(d)&&!i.includes(d)&&i.push(d),D&&D.forEach(C=>{const{keyField:g}=C;i&&g&&t.fieldsIndex?.has(g)&&!i.includes(g)&&i.push(g)}),i})).apply(this,arguments)}function Z(t,h){return t.popupTemplate?t.popupTemplate:(0,o.pC)(h)&&h.defaultPopupTemplateEnabled&&(0,o.pC)(t.defaultPopupTemplate)?t.defaultPopupTemplate:null}}}]);