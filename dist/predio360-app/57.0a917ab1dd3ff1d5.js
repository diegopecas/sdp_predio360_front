"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[57],{90512:(ne,$,f)=>{f.d($,{Z:()=>Q});var F=f(15861);class Q{constructor(){this.declaredRootClass="esri.arcade.featureSetCollection",this._layerById={},this._layerByName={}}add(L,A,G){this._layerById[A]=G,this._layerByName[L]=G}featureSetByName(L,A=!0,G=["*"]){var U=this;return(0,F.Z)(function*(){return void 0===U._layerByName[L]?null:U._layerByName[L]})()}featureSetById(L,A=!0,G=["*"]){var U=this;return(0,F.Z)(function*(){return void 0===U._layerById[L]?null:U._layerById[L]})()}castToText(L=!1){return"object, FeatureSetCollection"}}},20057:(ne,$,f)=>{f.r($),f.d($,{constructAssociationMetaDataFeatureSetFromUrl:()=>qe,constructFeatureSet:()=>se,constructFeatureSetFromPortalItem:()=>nt,constructFeatureSetFromRelationship:()=>Xe,constructFeatureSetFromUrl:()=>me,convertToFeatureSet:()=>rt,createFeatureSetCollectionFromMap:()=>et,createFeatureSetCollectionFromService:()=>tt,initialiseMetaDataCache:()=>Je});var F=f(15861),Q=f(84792),K=f(90512),L=f(47562),A=f(53997),G=f(88879),U=f(52724),E=f(95896),S=f(47982),P=f(49086),j=f(91510),C=f(57366),m=f(77132),T=f(83947),B=f(45333),h=f(80774);class D{constructor(){this.field="",this.tofieldname="",this.typeofstat="MIN",this.workingexpr=null}clone(){const e=new D;return e.field=this.field,e.tofieldname=this.tofieldname,e.typeofstat=this.typeofstat,e.workingexpr=this.workingexpr,e}static parseStatField(e,t,r,n){const l=new D;l.field=e;const s=h.WhereClause.create(t,r,n),d=function Z(w){if("function"===w.parseTree.type){if(0===w.parseTree.args.value.length)return{name:w.parseTree.name,expr:null};if(w.parseTree.args.value.length>1)throw new S.eS(S.f.MissingStatisticParameters);const e=h.WhereClause.create((0,T.XF)(w.parseTree.args.value[0],m.Bj.Standardised,w.parameters),w.fieldsIndex,w.timeZone);return{name:w.parseTree.name,expr:e}}return null}(s);if(null===d)throw new S.eS(S.f.UnsupportedSqlFunction,{function:""});const i=d.name.toUpperCase().trim();if("MIN"===i){if(l.typeofstat="MIN",l.workingexpr=d.expr,null===s)throw new S.eS(S.f.InvalidFunctionParameters,{function:"min"})}else if("MAX"===i){if(l.typeofstat="MAX",l.workingexpr=d.expr,null===s)throw new S.eS(S.f.InvalidFunctionParameters,{function:"max"})}else if("COUNT"===i)l.typeofstat="COUNT",l.workingexpr=d.expr;else if("STDEV"===i){if(l.typeofstat="STDDEV",l.workingexpr=d.expr,null===s)throw new S.eS(S.f.InvalidFunctionParameters,{function:"stdev"})}else if("SUM"===i){if(l.typeofstat="SUM",l.workingexpr=d.expr,null===s)throw new S.eS(S.f.InvalidFunctionParameters,{function:"sum"})}else if("MEAN"===i){if(l.typeofstat="AVG",l.workingexpr=d.expr,null===s)throw new S.eS(S.f.InvalidFunctionParameters,{function:i})}else if("AVG"===i){if(l.typeofstat="AVG",l.workingexpr=d.expr,null===s)throw new S.eS(S.f.InvalidFunctionParameters,{function:"avg"})}else{if("VAR"!==i)throw new S.eS(S.f.UnsupportedSqlFunction,{function:i});if(l.typeofstat="VAR",l.workingexpr=d.expr,null===s)throw new S.eS(S.f.InvalidFunctionParameters,{function:"var"})}return l}toStatisticsName(){switch(this.typeofstat.toUpperCase()){case"MIN":return"min";case"MAX":return"max";case"SUM":return"sum";case"COUNT":default:return"count";case"VAR":return"var";case"STDDEV":return"stddev";case"AVG":return"avg"}}}var p=f(50011),u=f(31910),_=f(67398),c=f(29535),g=f(65234),y=f(36255),R=f(60466);function O(w){if(!w)return"COUNT";switch(w.toLowerCase()){case"max":return"MAX";case"var":case"variance":return"VAR";case"avg":case"average":case"mean":return"AVG";case"min":return"MIN";case"sum":return"SUM";case"stdev":case"stddev":return"STDDEV";case"count":return"COUNT"}return"COUNT"}class M extends P.Z{constructor(e){super(e),this._decodedStatsfield=[],this._decodedGroupbyfield=[],this._candosimplegroupby=!0,this.phsyicalgroupbyfields=[],this.objectIdField="ROW__ID",this._internalObjectIdField="ROW__ID",this._adaptedFields=[],this.declaredClass="esri.arcade.featureset.actions.Aggregate",this._uniqueIds=1,this._maxQuery=10,this._maxProcessing=10,this._parent=e.parentfeatureset,this._config=e}isTable(){return!0}_getSet(e){var t=this;return(0,F.Z)(function*(){if(null===t._wset){const r=yield t._getFilteredSet("",null,null,null,e);return t._wset=r,t._wset}return t._wset})()}_isInFeatureSet(){return m.dj.InFeatureSet}_nextUniqueName(e){for(;1===e["T"+this._uniqueIds.toString()];)this._uniqueIds++;const t="T"+this._uniqueIds.toString();return e[t]=1,t}_convertToEsriFieldType(e){return e}_initialiseFeatureSet(){const e={};let t=!1,r=1;const n=this._parent?this._parent.getFieldsIndex():new R.Z([]);for(this.objectIdField="ROW__ID",this.globalIdField="";!1===t;){let s=!1;for(let d=0;d<this._config.groupbyfields.length;d++)if(this._config.groupbyfields[d].name.toLowerCase()===this.objectIdField.toLowerCase()){s=!0;break}if(!1===s)for(let d=0;d<this._config.statsfields.length;d++)if(this._config.statsfields[d].name.toLowerCase()===this.objectIdField.toLowerCase()){s=!0;break}!1===s?t=!0:(this.objectIdField="ROW__ID"+r.toString(),r++)}for(const s of this._config.statsfields){const d=new D;d.field=s.name,d.tofieldname=s.name,d.workingexpr=s.expression instanceof h.WhereClause?s.expression:h.WhereClause.create(s.expression,n,this.dateFieldsTimeZoneDefaultUTC),d.typeofstat=O(s.statistic),this._decodedStatsfield.push(d)}this._decodedGroupbyfield=[];for(const s of this._config.groupbyfields){const d={name:s.name,singlefield:null,tofieldname:s.name,expression:s.expression instanceof h.WhereClause?s.expression:h.WhereClause.create(s.expression,n,this.dateFieldsTimeZoneDefaultUTC),sqlType:null};this._decodedGroupbyfield.push(d)}if(null!==this._parent){this.geometryType=this._parent.geometryType,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField="";for(const s of this._parent.fields)e[s.name.toUpperCase()]=1;this.types=null,this.subtypes=null,this.subtypeField=""}else this.geometryType=m.Qk.point,this.typeIdField="",this.types=null,this.subtypes=null,this.subtypeField="",this.spatialReference=new g.Z({wkid:4326});this.fields=[];const l=new D;l.field=this._nextUniqueName(e),l.tofieldname=this.objectIdField,l.workingexpr=h.WhereClause.create(this._parent.objectIdField,this._parent.getFieldsIndex(),this.dateFieldsTimeZoneDefaultUTC),l.typeofstat="MIN",this._decodedStatsfield.push(l);for(const s of this._decodedGroupbyfield){const d=new y.Z;if(s.name=this._nextUniqueName(e),d.name=s.tofieldname,d.alias=d.name,(0,T.y5)(s.expression)){const i=this._parent.getField((0,T.zR)(s.expression,m.Bj.Standardised));if(!i)throw new S.EN(S.H9.AggregationFieldNotFound);s.name=i.name,s.singlefield=i.name,this.phsyicalgroupbyfields.push(i.name),d.type=i.type,s.sqlType=i.type}else{d.type=this._convertToEsriFieldType((0,T.DT)(s.expression,this._parent.fields));const i=new y.Z;i.name=s.name,i.alias=i.name,this.phsyicalgroupbyfields.push(s.name),this._adaptedFields.push(new U.yN(i,s.expression)),this._candosimplegroupby=!1,s.sqlType=d.type}this.fields.push(d)}if(this._adaptedFields.length>0)for(const s of this._parent.fields)this._adaptedFields.push(new U.$X(s));for(let s=0;s<this._decodedStatsfield.length;s++){const d=new y.Z;let i=null;const I=this._decodedStatsfield[s];I.field=this._nextUniqueName(e),I.tofieldname===this.objectIdField&&(this._internalObjectIdField=I.field),d.name=I.tofieldname,d.alias=d.name;const b=null!==I.workingexpr&&(0,T.y5)(I.workingexpr)?(0,T.zR)(I.workingexpr,m.Bj.Standardised):"";switch(this._decodedStatsfield[s].typeofstat){case"SUM":if(""!==b){if(i=this._parent.getField(b),!i)throw new S.EN(S.H9.AggregationFieldNotFound);d.type=i.type}else d.type="double";break;case"MIN":case"MAX":if(""!==b){if(i=this._parent.getField(b),!i)throw new S.EN(S.H9.AggregationFieldNotFound);d.type=i.type}else d.type="double";break;case"COUNT":d.type="integer";break;case"STDDEV":case"VAR":case"AVG":if(""!==b&&(i=this._parent.getField(b),!i))throw new S.EN(S.H9.AggregationFieldNotFound);d.type="double"}this.fields.push(d)}}_canDoAggregates(){return(0,F.Z)(function*(){return!1})()}_getFeatures(e,t,r,n){var l=this;return(0,F.Z)(function*(){const s=l._maxQuery;return!0===l._checkIfNeedToExpandKnownPage(e,s)?(yield l._expandPagedSet(e,s,0,0,n),l._getFeatures(e,t,r,n)):"success"})()}_getFilteredSet(e,t,r,n,l){var s=this;return(0,F.Z)(function*(){if(""!==e)return new j.Z([],[],!0,null);let d=null;const i={ordered:!1,nowhereclause:!1};if(yield s._ensureLoaded(),null!==r)for(let b=0;b<s._decodedStatsfield.length;b++)if(!0===(0,T.hq)(r,s._decodedStatsfield[b].tofieldname)){i.nowhereclause=!0,r=null;break}if(null!==n){i.ordered=!0;for(let b=0;b<s._decodedStatsfield.length;b++)if(!0===n.scanForField(s._decodedStatsfield[b].tofieldname)){n=null,i.ordered=!1;break}if(null!==n)for(const b of s._decodedGroupbyfield)if(null===b.singlefield&&!0===n.scanForField(b.tofieldname)){n=null,i.ordered=!1;break}}if(!1!==s._candosimplegroupby&&(yield s._parent._canDoAggregates(s.phsyicalgroupbyfields,s._decodedStatsfield,"",null,null))){let b=null;r&&(b=s._reformulateWhereClauseWithoutGroupByFields(r));let N=null;n&&(N=s._reformulateOrderClauseWithoutGroupByFields(n));const W=yield s._parent._getAggregatePagesDataSourceDefinition(s.phsyicalgroupbyfields,s._decodedStatsfield,"",null,b,N,s._internalObjectIdField);return s._checkCancelled(l),d=!0===i.nowhereclause?new j.Z(W._candidates.slice(0).concat(W._known.slice(0)),[],!0===i.ordered&&W._ordered,s._clonePageDefinition(W.pagesDefinition)):new j.Z(W._candidates.slice(0),W._known.slice(0),!0===i.ordered&&W._ordered,s._clonePageDefinition(W.pagesDefinition)),d}let I=s._parent;if(s._adaptedFields.length>0&&(I=new U.Xx({parentfeatureset:s._parent,adaptedFields:s._adaptedFields,extraFilter:null})),!0===i.nowhereclause)d=new j.Z(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:s._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new E.Z({parentfeatureset:I,orderbyclause:new C.Z(s.phsyicalgroupbyfields.join(",")+","+s._parent.objectIdField+" ASC")})}});else{let b=I;if(null!==r){let N=null;r&&(N=s._reformulateWhereClauseWithoutGroupByFields(r)),b=new A.Z({parentfeatureset:b,whereclause:N})}d=new j.Z(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:s._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new E.Z({parentfeatureset:b,orderbyclause:new C.Z(s.phsyicalgroupbyfields.join(",")+","+s._parent.objectIdField+" ASC")})}})}return d})()}_reformulateWhereClauseWithoutStatsFields(e){for(const t of this._decodedStatsfield)e=(0,T.bB)(e,t.tofieldname,(0,T.zR)(t.workingexpr,m.Bj.Standardised),this._parent.getFieldsIndex());return e}_reformulateWhereClauseWithoutGroupByFields(e){for(const t of this._decodedGroupbyfield)t.tofieldname!==t.name&&(e=(0,T.bB)(e,t.tofieldname,(0,T.zR)(t.expression,m.Bj.Standardised),this._parent.getFieldsIndex()));return e}_reformulateOrderClauseWithoutGroupByFields(e){const t=[];for(const r of this._decodedGroupbyfield)r.tofieldname!==r.name&&t.push({field:r.tofieldname,newfield:r.name});return t.length>0?e.replaceFields(t):e}_clonePageDefinition(e){return null===e?null:!0===e.aggregatefeaturesetpagedefinition?{aggregatefeaturesetpagedefinition:!0,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,internal:e.internal}:this._parent._clonePageDefinition(e)}_refineSetBlock(e,t,r){var n=this;return(0,F.Z)(function*(){return!0===n._checkIfNeedToExpandCandidatePage(e,n._maxQuery)?(yield n._expandPagedSet(e,n._maxQuery,0,0,r),n._refineSetBlock(e,t,r)):(n._checkCancelled(r),n._refineKnowns(e,t),e)})()}_expandPagedSet(e,t,r,n,l){return this._expandPagedSetFeatureSet(e,t,r,n,l)}_getPhysicalPage(e,t,r){var n=this;return(0,F.Z)(function*(){if(!0===e.pagesDefinition.aggregatefeaturesetpagedefinition)return n._sequentialGetPhysicalItem(e,e.pagesDefinition.resultRecordCount,r,[]);const l=yield n._getAgregagtePhysicalPage(e,t,r);for(const s of l){const d={geometry:s.geometry,attributes:{}},i={};for(const I in s.attributes)i[I.toLowerCase()]=s.attributes[I];for(const I of n._decodedGroupbyfield)d.attributes[I.tofieldname]=i[I.name.toLowerCase()];for(const I of n._decodedStatsfield)d.attributes[I.tofieldname]=i[I.field.toLowerCase()];n._featureCache[d.attributes[n.objectIdField]]=new G.Z(d)}return l.length})()}_sequentialGetPhysicalItem(e,t,r,n){return new Promise((l,s)=>{null===e.pagesDefinition.internal.iterator&&(e.pagesDefinition.internal.iterator=e.pagesDefinition.internal.subfeatureset.iterator(r)),!0===e.pagesDefinition.internal.fullyResolved||0===t?l(n.length):this._nextAggregateItem(e,t,r,n,d=>{l(null===d?n.length:this._sequentialGetPhysicalItem(e,t-=1,r,n))},s)})}_nextAggregateItem(e,t,r,n,l,s){try{(0,L.a2)(e.pagesDefinition.internal.iterator.next()).then(d=>{if(null===d)if(null!==e.pagesDefinition.internal.workingItem){const i=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);n.push(i),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(i.attributes[this.objectIdField]),e.pagesDefinition.internal.fullyResolved=!0,l(null)}else e.pagesDefinition.internal.fullyResolved=!0,l(null);else{const i=this._generateAggregateHash(d);if(null===e.pagesDefinition.internal.workingItem)e.pagesDefinition.internal.workingItem={features:[d],id:i};else{if(i!==e.pagesDefinition.internal.workingItem.id){const I=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);return n.push(I),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(I.attributes[this.objectIdField]),t-=1,e.pagesDefinition.internal.workingItem={features:[d],id:i},void l(I)}e.pagesDefinition.internal.workingItem.features.push(d)}this._nextAggregateItem(e,t,r,n,l,s)}},s)}catch(d){s(d)}}_calculateFieldStat(e,t,r){const n=[];for(let l=0;l<e.features.length;l++)if(null!==t.workingexpr){const s=t.workingexpr.calculateValue(e.features[l]);null!==s&&n.push(s instanceof u.u||s instanceof c.n?s.toNumber():s instanceof _.H?s.toMilliseconds():s)}else n.push(null);switch(t.typeofstat){case"MIN":r.attributes[t.tofieldname]=(0,B.tj)("min",n,-1);break;case"MAX":r.attributes[t.tofieldname]=(0,B.tj)("max",n,-1);break;case"SUM":r.attributes[t.tofieldname]=(0,B.tj)("sum",n,-1);break;case"COUNT":r.attributes[t.tofieldname]=n.length;break;case"VAR":r.attributes[t.tofieldname]=(0,B.tj)("var",n,-1);break;case"STDDEV":r.attributes[t.tofieldname]=(0,B.tj)("stddev",n,-1);break;case"AVG":r.attributes[t.tofieldname]=(0,B.tj)("avg",n,-1)}return!0}_calculateAndAppendAggregateItem(e){const t={attributes:{},geometry:null};for(const n of this._decodedGroupbyfield){const l=n.singlefield?e.features[0].attributes[n.singlefield]:h.WhereClause.convertValueToStorageFormat(n.expression.calculateValue(e.features[0]),n.sqlType);t.attributes[n.tofieldname]=l}for(const n of this._decodedStatsfield)this._calculateFieldStat(e,n,t);const r=[];for(let n=0;n<this._decodedStatsfield.length;n++)r.push(this._calculateFieldStat(e,this._decodedStatsfield[n],t));return this._featureCache[t.attributes[this.objectIdField]]=new G.Z({attributes:t.attributes,geometry:t.geometry}),t}_generateAggregateHash(e){let t="";for(const r of this._decodedGroupbyfield){const n=r.singlefield?e.attributes[r.singlefield]:r.expression.calculateValue(e);t+=null==n?":":":"+n.toString()}return(0,p.F)(t,p.M.String)}_stat(){return(0,F.Z)(function*(){return{calculated:!1}})()}getFeatureByObjectId(){return(0,F.Z)(function*(){return null})()}static registerAction(){P.Z._featuresetFunctions.groupby=function(e,t){return new M({parentfeatureset:this,groupbyfields:e,statsfields:t})}}}var x=f(3482),v=f(79429),k=f(24263),z=f(22386),ie=f(6729),le=f(91179),re=f(37053),te=f(80415),Oe=f(81976),Pe=f(26584),Ze=f(8314),Le=f(10699),de=f(35391),Ae=f(15283),fe=f(2865),Ne=f(20721),je=f(17253),oe=f(96854);function he(){return he=(0,F.Z)(function*(w,e,t,r){return function Ge(w,e,t,r){return _e.apply(this,arguments)}(e,yield function Ue(w,e,t,r){return pe.apply(this,arguments)}(w,e,t,r),t,r)}),he.apply(this,arguments)}function pe(){return(pe=(0,F.Z)(function*(w,e,t,r){const n={...r},l=function ke(w,e){let t=oe.Z.from(w);t.sourceSpatialReference=t.sourceSpatialReference??e?.sourceSpatialReference??null,(e?.gdbVersion||e?.dynamicDataSource)&&(t=t===w?t.clone():t,t.gdbVersion=w.gdbVersion||e.gdbVersion,t.dynamicDataSource=w.dynamicDataSource?Ae.n.from(w.dynamicDataSource):e.dynamicDataSource);const r=e?.infoFor3D;if(null!=r&&be(w,r)){t=t===w?t.clone():t,t.formatOf3DObjects=null;const{supportedFormats:n,queryFormats:l}=r,s=(0,de.S0)("model/gltf-binary",n)??(0,de.Ow)("glb",n),d=(0,de.S0)("model/gltf+json",n)??(0,de.Ow)("gtlf",n);for(const i of l){if(i===s){t.formatOf3DObjects=i;break}i!==d||t.formatOf3DObjects||(t.formatOf3DObjects=i)}if(!t.formatOf3DObjects)throw new Pe.Z("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(null==t.outFields||!t.outFields.includes("*")){t=t===w?t.clone():t,null==t.outFields&&(t.outFields=[]);const{originX:i,originY:I,originZ:b,translationX:N,translationY:W,translationZ:V,scaleX:J,scaleY:X,scaleZ:Y,rotationX:ee,rotationY:H,rotationZ:ue,rotationDeg:ae}=r.transformFieldRoles;t.outFields.push(i,I,b,N,W,V,J,X,Y,ee,H,ue,ae)}}return t}(e,t),s=null!=e.outStatistics?.[0],d=(0,Ze.Z)("featurelayer-pbf-statistics"),i=!s||d;let I;if("pbf"===t?.format&&i)try{I=yield(0,Ne.t)(w,l,n)}catch(b){if("query:parsing-pbf"!==b.name)throw b;t.format="json"}return"json"!==t?.format&&i||(I=yield(0,fe.F)(w,l,n)),function Be(w,e){if(null!=w&&null!=e)for(const t of e){const r=w.get(t.name);r&&Object.assign(t,r.toJSON())}}(t?.fieldsIndex,I.fields),I})).apply(this,arguments)}function _e(){return(_e=(0,F.Z)(function*(w,e,t,r){const n=t?.infoFor3D;if(!be(w,n)||null==n||!e.assetMaps||!e.features?.length)return je.Z.fromJSON(e);const{meshFeatureSetFromJSON:l}=yield(0,Le.Hl)(Promise.all([f.e(5453),f.e(3740)]).then(f.bind(f,3740)),r);return l(w,n,e)})).apply(this,arguments)}function be(w,e){return null!=e&&!0===w.returnGeometry&&"xyFootprint"!==w.multipatchOption&&!w.outStatistics}f(59318),f(4619),f(21726),f(87183),f(67736);var We=f(90463),Ke=(f(29132),f(63290),f(37118),f(55214),f(74618),f(94425),f(24192),f(16730),f(92383),f(24865)),Te=(f(5548),f(21286),f(2004),f(67010)),Re=(f(6871),f(60776));class ce extends P.Z{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerDynamic",this._removeGeometry=!1,this._overrideFields=null,this.formulaCredential=null,this._pageJustIds=!1,this._requestStandardised=!1,this._useDefinitionExpression=!0,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return m.tI}end(){return this._layer}optimisePagingFeatureQueries(e){this._pageJustIds=e}get urlQueryPath(){return this._layer.parsedUrl.path||""}convertQueryToLruCacheKey(e){const t=this.urlQueryPath+","+(0,m.hd)(e.toJSON());return(0,p.F)(t,p.M.String)}loadImpl(){var e=this;return(0,F.Z)(function*(){return!0===e._layer.loaded?(e._initialiseFeatureSet(),e):(yield e._layer.load(),e._initialiseFeatureSet(),e)})()}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this.hasZ=!0===this._layer?.capabilities?.data?.supportsZ,this.hasM=!0===this._layer?.capabilities?.data?.supportsM,null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const e=[],t=[];for(const r of this.fields)if("oid"===r.type)e.push(r),t.push(r.name);else for(const n of this._overrideFields)if(n.toLowerCase()===r.name.toLowerCase()){e.push(r),t.push(r.name);break}this.fields=e,this._overrideFields=t}if(this._layer.source&&this._layer.source.sourceJSON){const e=this._layer.source.sourceJSON.currentVersion;!0===this._layer.source.sourceJSON.useStandardizedQueries?(this._databaseType=m.Bj.StandardisedNoInterval,null!=e&&e>=10.61&&(this._databaseType=m.Bj.Standardised)):null!=e&&(e>=10.5&&(this._databaseType=m.Bj.StandardisedNoInterval,this._requestStandardised=!0),e>=10.61&&(this._databaseType=m.Bj.Standardised))}this.objectIdField=this._layer.objectIdField;for(const e of this.fields)"global-id"===e.type&&(this.globalIdField=e.name);this._layer instanceof Oe.default?(this.subtypeField=this._layer.subtypeField??"",this.subtypes=this._layer.subtypes,this.types=null,this.typeIdField=null):(this.typeIdField=this._layer.typeIdField??"",this.types=this._layer.types,this.subtypeField=this._layer.subtypeField,this.subtypes=this._layer.subtypes)}_isInFeatureSet(){return m.dj.InFeatureSet}_refineSetBlock(e){return(0,F.Z)(function*(){return e})()}_candidateIdTransform(e){return e}_getSet(e){var t=this;return(0,F.Z)(function*(){if(null===t._wset){yield t._ensureLoaded();const r=yield t._getFilteredSet("",null,null,null,e);return t._wset=r,r}return t._wset})()}_runDatabaseProbe(e){var t=this;return(0,F.Z)(function*(){yield t._ensureLoaded();const r=new oe.Z;t.datesInUnknownTimezone&&(r.timeReferenceUnknownClient=!0),r.where=e.replace("OBJECTID",t._layer.objectIdField);try{return yield t._layer.queryObjectIds(r),!0}catch{return!1}})()}_canUsePagination(){return!(!this._layer.capabilities||!this._layer.capabilities.query||!0!==this._layer.capabilities.query.supportsPagination)}_cacheableFeatureSetSourceKey(){return this._layer.url}pbfSupportedForQuery(e){const t=this._layer?.capabilities?.query;return!e.outStatistics&&!0===t?.supportsFormatPBF&&!0===t?.supportsQuantizationEditMode}queryPBF(e){var t=this;return(0,F.Z)(function*(){return e.quantizationParameters={mode:"edit"},(yield function Me(w,e,t,r){return he.apply(this,arguments)}(t._layer.parsedUrl,e,{format:"pbf"},{})).unquantize()})()}get gdbVersion(){return this._layer&&this._layer.capabilities&&this._layer.capabilities.data&&this._layer.capabilities.data.isVersioned?this._layer.gdbVersion||"SDE.DEFAULT":""}nativeCapabilities(){return{title:this._layer.title??"",source:this,canQueryRelated:!0,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:this._requestStandardised}}executeQuery(e,t){e.returnZ=this.hasZ,e.returnM=this.hasM;const r="execute"===t?fe.e:"executeForCount"===t?We.P:Ke.G,n="execute"===t&&this.pbfSupportedForQuery(e);let l=null;if(this.recentlyUsedQueries){const s=this.convertQueryToLruCacheKey(e);l=this.recentlyUsedQueries.getFromCache(s),null===l&&(l=!0!==n?r(this._layer.parsedUrl.path,e):this.queryPBF(e),this.recentlyUsedQueries.addToCache(s,l),l=l.catch(d=>{throw this.recentlyUsedQueries?.removeFromCache(s),d}))}return this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:e,method:t}),null===l&&(l=!0!==n?r(this._layer.parsedUrl.path,e):this.queryPBF(e)),l}_getFilteredSet(e,t,r,n,l){var s=this;return(0,F.Z)(function*(){const d=yield s.databaseType();if(s.isTable()&&t&&null!==e&&""!==e)return new j.Z([],[],!0,null);if(s._canUsePagination())return s._getFilteredSetUsingPaging(e,t,r,n,l);let i="",I=!1;null!==n&&s._layer.capabilities&&s._layer.capabilities.query&&!0===s._layer.capabilities.query.supportsOrderBy&&(i=n.constructClause(),I=!0);const b=new oe.Z;s.datesInUnknownTimezone&&(b.timeReferenceUnknownClient=!0),b.where=null===r?null===t?"1=1":"":(0,T.zR)(r,d),s._requestStandardised&&(b.sqlFormat="standard"),b.spatialRelationship=s._makeRelationshipEnum(e),b.outSpatialReference=s.spatialReference,b.orderByFields=""!==i?i.split(","):null,b.geometry=null===t?null:t,b.relationParameter=s._makeRelationshipParam(e);let N=yield s.executeQuery(b,"executeForIds");return null===N&&(N=[]),s._checkCancelled(l),new j.Z([],N,I,null)})()}_expandPagedSet(e,t,r,n,l){return this._expandPagedSetFeatureSet(e,t,r,n,l)}_getFilteredSetUsingPaging(e,t,r,n,l){var s=this;return(0,F.Z)(function*(){let d="",i=!1;null!==n&&s._layer.capabilities&&s._layer.capabilities.query&&!0===s._layer.capabilities.query.supportsOrderBy&&(d=n.constructClause(),i=!0);const I=yield s.databaseType();let b=null===r?null===t?"1=1":"":(0,T.zR)(r,I);s._layer.definitionExpression&&s._useDefinitionExpression&&(b=""!==b?"(("+s._layer.definitionExpression+") AND ("+b+"))":s._layer.definitionExpression);let N=s._maxQueryRate();const W=s._layer.capabilities?.query.maxRecordCount;null!=W&&W<N&&(N=W);let V=null;if(!0===s._pageJustIds)V=new j.Z([],["GETPAGES"],i,{spatialRel:s._makeRelationshipEnum(e),relationParam:s._makeRelationshipParam(e),outFields:s._layer.objectIdField,resultRecordCount:N,resultOffset:0,geometry:null===t?null:t,where:b,orderByFields:d,returnGeometry:!1,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}});else{let J=!0;!0===s._removeGeometry&&(J=!1);const X=s._overrideFields??s._fieldsIncludingObjectId(["*"]);V=new j.Z([],["GETPAGES"],i,{spatialRel:s._makeRelationshipEnum(e),relationParam:s._makeRelationshipParam(e),outFields:X.join(","),resultRecordCount:N,resultOffset:0,geometry:null===t?null:t,where:b,orderByFields:d,returnGeometry:J,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}return yield s._expandPagedSet(V,N,0,1,l),V})()}_clonePageDefinition(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}_getPhysicalPage(e,t,r){var n=this;return(0,F.Z)(function*(){const l=e.pagesDefinition.internal.lastRetrieved,s=l,d=e.pagesDefinition.internal.lastPage,i=new oe.Z;n._requestStandardised&&(i.sqlFormat="standard"),n.datesInUnknownTimezone&&(i.timeReferenceUnknownClient=!0),i.spatialRelationship=e.pagesDefinition.spatialRel,i.relationParameter=e.pagesDefinition.relationParam,i.outFields=e.pagesDefinition.outFields.split(","),i.num=e.pagesDefinition.resultRecordCount,i.start=e.pagesDefinition.internal.lastPage,i.geometry=e.pagesDefinition.geometry,i.where=e.pagesDefinition.where,i.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,i.returnGeometry=e.pagesDefinition.returnGeometry,i.outSpatialReference=n.spatialReference;const I=yield n.executeQuery(i,"execute");if(n._checkCancelled(r),e.pagesDefinition.internal.lastPage!==d)return"done";const b=n._layer.objectIdField;for(let N=0;N<I.features.length;N++)e.pagesDefinition.internal.set[s+N]=I.features[N].attributes[b];if(!1===n._pageJustIds)for(let N=0;N<I.features.length;N++)n._featureCache[I.features[N].attributes[b]]=I.features[N];return(void 0===I.exceededTransferLimit&&I.features.length!==e.pagesDefinition.resultRecordCount||!1===I.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=l+I.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,"done"})()}_fieldsIncludingObjectId(e){if(null===e)return[this.objectIdField];const t=e.slice(0);if(t.includes("*"))return t;let r=!1;for(const n of t)if(n.toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t}_getFeatures(e,t,r,n){var l=this;return(0,F.Z)(function*(){const s=[];if(-1!==t&&void 0===l._featureCache[t]&&s.push(t),!0===l._checkIfNeedToExpandKnownPage(e,l._maxProcessingRate()))return yield l._expandPagedSet(e,l._maxProcessingRate(),0,0,n),l._getFeatures(e,t,r,n);let d=0;for(let N=e._lastFetchedIndex;N<e._known.length;N++){if(e._lastFetchedIndex+=1,d++,void 0===l._featureCache[e._known[N]]){let W=!1;if(null!=l._layer._mode){const V=l._layer._mode;if(void 0!==V._featureMap[e._known[N]]){const J=V._featureMap[e._known[N]];null!==J&&(W=!0,l._featureCache[e._known[N]]=J)}}if(!1===W&&(e._known[N]!==t&&s.push(e._known[N]),s.length>=l._maxProcessingRate()-1))break}if(d>=r&&0===s.length)break}if(0===s.length)return"success";const i=new oe.Z;l._requestStandardised&&(i.sqlFormat="standard"),l.datesInUnknownTimezone&&(i.timeReferenceUnknownClient=!0),i.objectIds=s,i.outFields=l._overrideFields??l._fieldsIncludingObjectId(["*"]),i.returnGeometry=!0,!0===l._removeGeometry&&(i.returnGeometry=!1),i.outSpatialReference=l.spatialReference;const I=yield l.executeQuery(i,"execute");if(l._checkCancelled(n),void 0!==I.error)throw new S.EN(S.H9.RequestFailed,{reason:I.error});const b=l._layer.objectIdField;for(let N=0;N<I.features.length;N++)l._featureCache[I.features[N].attributes[b]]=I.features[N];return"success"})()}_getDistinctPages(e,t,r,n,l,s,d,i,I){var b=this;return(0,F.Z)(function*(){yield b._ensureLoaded();const N=yield b.databaseType();let W=r.parseTree.column;const V=b._layer.fields??[];for(let H=0;H<V.length;H++)if(V[H].name.toLowerCase()===W.toLowerCase()){W=V[H].name;break}const J=new oe.Z;b._requestStandardised&&(J.sqlFormat="standard"),b.datesInUnknownTimezone&&(J.timeReferenceUnknownClient=!0);let X=null===s?null===l?"1=1":"":(0,T.zR)(s,N);b._layer.definitionExpression&&b._useDefinitionExpression&&(X=""!==X?"(("+b._layer.definitionExpression+") AND ("+X+"))":b._layer.definitionExpression),J.where=X,J.spatialRelationship=b._makeRelationshipEnum(n),J.relationParameter=b._makeRelationshipParam(n),J.geometry=null===l?null:l,J.returnDistinctValues=!0,J.returnGeometry=!1,J.outFields=[W];const Y=yield b.executeQuery(J,"execute");if(b._checkCancelled(I),!Y.hasOwnProperty("features"))throw new S.EN(S.H9.InvalidStatResponse);let ee=!1;for(let H=0;H<V.length;H++)if(V[H].name===W){"date"===V[H].type&&(ee=!0);break}for(let H=0;H<Y.features.length;H++){if(ee){const ue=Y.features[H].attributes[W];i.push(null!==ue?new Date(ue):ue)}else i.push(Y.features[H].attributes[W]);if(i.length>=d)break}return 0===Y.features.length?i:Y.features.length===b._layer.capabilities?.query.maxRecordCount&&i.length<d?{calculated:!0,result:yield b._getDistinctPages(e+Y.features.length,t,r,n,l,s,d,i,I)}:i})()}_distinctStat(e,t,r,n,l,s,d){var i=this;return(0,F.Z)(function*(){return{calculated:!0,result:yield i._getDistinctPages(0,e,t,r,n,l,s,[],d)}})()}isTable(){return this._layer.isTable||null===this._layer.geometryType||"table"===this._layer.type||""===this._layer.geometryType||"esriGeometryNull"===this._layer.geometryType}_countstat(e,t,r,n){var l=this;return(0,F.Z)(function*(){const s=yield l.databaseType(),d=new oe.Z;if(l._requestStandardised&&(d.sqlFormat="standard"),l.isTable()&&r&&null!==t&&""!==t)return{calculated:!0,result:0};let i=null===n?null===r?"1=1":"":(0,T.zR)(n,s);return l._layer.definitionExpression&&l._useDefinitionExpression&&(i=""!==i?"(("+l._layer.definitionExpression+") AND ("+i+"))":l._layer.definitionExpression),d.where=i,l.datesInUnknownTimezone&&(d.timeReferenceUnknownClient=!0),d.where=i,d.spatialRelationship=l._makeRelationshipEnum(t),d.relationParameter=l._makeRelationshipParam(t),d.geometry=null===r?null:r,d.returnGeometry=!1,{calculated:!0,result:yield l.executeQuery(d,"executeForCount")}})()}_stats(e,t,r,n,l,s,d){var i=this;return(0,F.Z)(function*(){yield i._ensureLoaded();const I=i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsSqlExpression,b=i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsStatistics,N=i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsDistinct;if("count"===e)return N?i._countstat(e,r,n,l):{calculated:!1};if(!1===b||!1===(0,T.y5)(t)&&!1===I||!1===t.isStandardized)return""!==r||null!==l?{calculated:!1}:i._manualStat(e,t,s,d);if("distinct"===e)return!1===N?""!==r||null!==l?{calculated:!1}:i._manualStat(e,t,s,d):i._distinctStat(e,t,r,n,l,s,d);const W=yield i.databaseType();if(i.isTable()&&n&&null!==r&&""!==r)return{calculated:!0,result:null};const V=new oe.Z;i._requestStandardised&&(V.sqlFormat="standard");let J=null===l?null===n?"1=1":"":(0,T.zR)(l,W);i._layer.definitionExpression&&i._useDefinitionExpression&&(J=""!==J?"(("+i._layer.definitionExpression+") AND ("+J+"))":i._layer.definitionExpression),V.where=J,V.spatialRelationship=i._makeRelationshipEnum(r),V.relationParameter=i._makeRelationshipParam(r),V.geometry=null===n?null:n,i.datesInUnknownTimezone&&(V.timeReferenceUnknownClient=!0);const X=new Re.Z;X.statisticType=(0,B.g3)(e),X.onStatisticField=(0,T.zR)(t,W),X.outStatisticFieldName="ARCADE_STAT_RESULT",V.returnGeometry=!1;let Y="ARCADE_STAT_RESULT";V.outStatistics=[X];const ee=yield i.executeQuery(V,"execute");if(!ee.hasOwnProperty("features")||0===ee.features.length)throw new S.EN(S.H9.InvalidStatResponse);let H=!1;const ue=ee.fields??[];for(let ae=0;ae<ue.length;ae++)if("ARCADE_STAT_RESULT"===ue[ae].name.toUpperCase()){Y=ue[ae].name,"date"===ue[ae].type&&(H=!0);break}if(H){let ae=ee.features[0].attributes[Y];return null!==ae&&(ae=new Date(ee.features[0].attributes[Y])),{calculated:!0,result:ae}}return{calculated:!0,result:ee.features[0].attributes[Y]}})()}_stat(e,t,r,n,l,s,d){return this._stats(e,t,r,n,l,s,d)}_canDoAggregates(e,t){var r=this;return(0,F.Z)(function*(){yield r._ensureLoaded();let n=!1;const l=r._layer.capabilities?.query,s=!0===l?.supportsSqlExpression;if(null!=l&&!0===l.supportsStatistics&&!0===l.supportsOrderBy&&(n=!0),n)for(let d=0;d<t.length-1;d++)(!1===t[d].workingexpr?.isStandardized||!1===(0,T.y5)(t[d].workingexpr)&&!1===s)&&(n=!1);return!1!==n})()}_makeRelationshipEnum(e){if(e.includes("esriSpatialRelRelation"))return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}_makeRelationshipParam(e){return e.includes("esriSpatialRelRelation")?e.split(":")[1]:""}_getAggregatePagesDataSourceDefinition(e,t,r,n,l,s,d){var i=this;return(0,F.Z)(function*(){yield i._ensureLoaded();const I=yield i.databaseType();let b="",N=!1,W=!1;null!==s&&i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsOrderBy&&(b=s.constructClause(),W=!0),i._layer.capabilities&&i._layer.capabilities.query&&!1===i._layer.capabilities.query.supportsPagination&&(W=!1,N=!0,b=i._layer.objectIdField);const V=[];for(let ee=0;ee<t.length;ee++){const H=new Re.Z;H.onStatisticField=null!==t[ee].workingexpr?(0,T.zR)(t[ee].workingexpr,I):"",H.outStatisticFieldName=t[ee].field,H.statisticType=t[ee].toStatisticsName(),V.push(H)}""===b&&(b=e.join(","));let J=i._maxQueryRate();const X=i._layer.capabilities?.query.maxRecordCount;null!=X&&X<J&&(J=X);let Y=null===l?null===n?"1=1":"":(0,T.zR)(l,I);return i._layer.definitionExpression&&i._useDefinitionExpression&&(Y=""!==Y?"(("+i._layer.definitionExpression+") AND ("+Y+"))":i._layer.definitionExpression),new j.Z([],["GETPAGES"],W,{groupbypage:!0,spatialRel:i._makeRelationshipEnum(r),relationParam:i._makeRelationshipParam(r),outFields:["*"],useOIDpagination:N,generatedOid:d,resultRecordCount:J,resultOffset:0,groupByFieldsForStatistics:e,outStatistics:V,geometry:null===n?null:n,where:Y,orderByFields:b,returnGeometry:!1,returnIdsOnly:!1,internal:{lastMaxId:-1,set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})})()}_getAgregagtePhysicalPage(e,t,r){var n=this;return(0,F.Z)(function*(){let l=e.pagesDefinition.where;!0===e.pagesDefinition.useOIDpagination&&(l=""!==l?"("+l+") AND ("+e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString()+")":e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString());const s=e.pagesDefinition.internal.lastRetrieved,d=s,i=e.pagesDefinition.internal.lastPage,I=new oe.Z;if(n._requestStandardised&&(I.sqlFormat="standard"),I.where=l,I.spatialRelationship=e.pagesDefinition.spatialRel,I.relationParameter=e.pagesDefinition.relationParam,I.outFields=e.pagesDefinition.outFields,I.outStatistics=e.pagesDefinition.outStatistics,I.geometry=e.pagesDefinition.geometry,I.groupByFieldsForStatistics=e.pagesDefinition.groupByFieldsForStatistics,I.num=e.pagesDefinition.resultRecordCount,I.start=e.pagesDefinition.internal.lastPage,I.returnGeometry=e.pagesDefinition.returnGeometry,n.datesInUnknownTimezone&&(I.timeReferenceUnknownClient=!0),I.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,n.isTable()&&I.geometry&&I.spatialRelationship)return[];const b=yield n.executeQuery(I,"execute");if(n._checkCancelled(r),!b.hasOwnProperty("features"))throw new S.EN(S.H9.InvalidStatResponse);const N=[];if(e.pagesDefinition.internal.lastPage!==i)return[];b.features.length>0&&void 0===b.features[0].attributes[e.pagesDefinition.generatedOid]&&(e.pagesDefinition.generatedOid=e.pagesDefinition.generatedOid.toLowerCase());for(let W=0;W<b.features.length;W++)e.pagesDefinition.internal.set[d+W]=b.features[W].attributes[e.pagesDefinition.generatedOid];for(let W=0;W<b.features.length;W++)N.push(new G.Z({attributes:b.features[W].attributes,geometry:null}));return!0===e.pagesDefinition.useOIDpagination?0===b.features.length?e.pagesDefinition.internal.fullyResolved=!0:e.pagesDefinition.internal.lastMaxId=b.features[b.features.length-1].attributes[e.pagesDefinition.generatedOid]:(void 0===b.exceededTransferLimit&&b.features.length!==e.pagesDefinition.resultRecordCount||!1===b.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=s+b.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,N})()}static create(e,t,r,n,l){const s=new te.default({url:e,outFields:null===t?["*"]:t});return new ce({layer:s,spatialReference:r,lrucache:n,interceptor:l})}relationshipMetaData(){return this._layer&&this._layer.source&&this._layer.source.sourceJSON?.relationships?this._layer.source.sourceJSON.relationships:[]}serviceUrl(){return(0,m.US)(this._layer.parsedUrl.path)}queryAttachments(e,t,r,n,l){var s=this;return(0,F.Z)(function*(){const d=s._layer.capabilities;if(d?.data.supportsAttachment&&d?.operations.supportsQueryAttachments){const i={objectIds:[e],returnMetadata:l};(t&&t>0||r&&r>0)&&(i.size=[t&&t>0?t:0,r&&r>0?r:t+1]),n&&n.length>0&&(i.attachmentTypes=n),s.featureSetQueryInterceptor&&s.featureSetQueryInterceptor.preLayerQueryCallback({layer:s._layer,query:i,method:"attachments"});const I=yield s._layer.queryAttachments(i),b=[];return I&&I[e]&&I[e].forEach(N=>{const W=s._layer.parsedUrl.path+"/"+e.toString()+"/attachments/"+N.id.toString();let V=null;l&&N.exifInfo&&(V=ie.Z.convertJsonToArcade(N.exifInfo,"system",!0)),b.push(new z.Z(N.id,N.name,N.contentType,N.size,W,V,N.keywords??null))}),b}return[]})()}queryRelatedFeatures(e){var t=this;return(0,F.Z)(function*(){const r={f:"json",relationshipId:e.relationshipId.toString(),definitionExpression:e.where,outFields:e.outFields?.join(","),returnGeometry:e.returnGeometry.toString()};null!=e.resultOffset&&(r.resultOffset=e.resultOffset.toString()),null!=e.resultRecordCount&&(r.resultRecordCount=e.resultRecordCount.toString()),e.orderByFields&&(r.orderByFields=e.orderByFields.join(",")),e.objectIds&&e.objectIds.length>0&&(r.objectIds=e.objectIds.join(",")),e.outSpatialReference&&(r.outSR=(0,re.B9)(e.outSpatialReference)),t.featureSetQueryInterceptor&&t.featureSetQueryInterceptor.preRequestCallback({layer:t._layer,queryPayload:r,method:"relatedrecords",url:t._layer.parsedUrl.path+"/queryRelatedRecords"});const n=yield(0,Q.Z)(t._layer.parsedUrl.path+"/queryRelatedRecords",{responseType:"json",query:r});if(n.data){const l={},s=n.data;if(s?.relatedRecordGroups){const d=s.spatialReference;for(const i of s.relatedRecordGroups){const I=i.objectId,b=[];for(const N of i.relatedRecords){N.geometry&&(N.geometry.spatialReference=d);const W=new G.Z({geometry:N.geometry?(0,le.im)(N.geometry):null,attributes:N.attributes});b.push(W)}l[I]={features:b,exceededTransferLimit:!0===s.exceededTransferLimit}}}return l}throw new S.EN(S.H9.InvalidRequest)})()}getFeatureByObjectId(e,t){var r=this;return(0,F.Z)(function*(){const n=new oe.Z;n.outFields=t,n.returnGeometry=!1,n.outSpatialReference=r.spatialReference,n.where=r.objectIdField+"="+e.toString(),r.datesInUnknownTimezone&&(n.timeReferenceUnknownClient=!0),r.featureSetQueryInterceptor&&r.featureSetQueryInterceptor.preLayerQueryCallback({layer:r._layer,query:n,method:"execute"});const l=yield(0,fe.e)(r._layer.parsedUrl.path,n);return 1===l.features.length?l.features[0]:null})()}getIdentityUser(){var e=this;return(0,F.Z)(function*(){yield e.load();const t=k.id?.findCredential(e._layer.url);return t?t.userId:null})()}getOwningSystemUrl(){var e=this;return(0,F.Z)(function*(){yield e.load();const t=k.id?.findServerInfo(e._layer.url);if(t)return t.owningSystemUrl;let r=e._layer.url;const n=r.toLowerCase().indexOf("/rest/services");if(r=n>-1?r.substring(0,n):r,r){r+="/rest/info";try{const l=yield(0,Q.Z)(r,{query:{f:"json"}});let s="";return l.data?.owningSystemUrl&&(s=l.data.owningSystemUrl),s}catch{return""}}return""})()}getDataSourceFeatureSet(){const e=new ce({layer:this._layer,spatialReference:this.spatialReference??void 0,outFields:this._overrideFields??void 0,includeGeometry:!this._removeGeometry,lrucache:this.recentlyUsedQueries??void 0,interceptor:this.featureSetQueryInterceptor??void 0});return e._useDefinitionExpression=!1,e}get preferredTimeZone(){return this._layer.preferredTimeZone??null}get dateFieldsTimeZone(){return this._layer.dateFieldsTimeZone??null}get datesInUnknownTimezone(){return this._layer.datesInUnknownTimezone}get editFieldsInfo(){return this._layer.editFieldsInfo??null}get timeInfo(){return this._layer.timeInfo??null}getFeatureSetInfo(){var e=this;return(0,F.Z)(function*(){if(e.fsetInfo)return e.fsetInfo;let t=null,{parsedUrl:{path:r},serviceItemId:n=null}=e._layer;if(r){const s=yield(0,Q.Z)(r,{responseType:"json",query:{f:"json"}});t=s?.data?.name??null,n=s?.data?.serviceItemId??null}const l=e._layer.title&&null!==(e._layer.parent??null);return e.featureSetInfo={layerId:e._layer.layerId,layerName:""===t?null:t,itemId:""===n?null:n,serviceLayerUrl:""===r?null:r,webMapLayerId:l?e._layer.id??null:null,webMapLayerTitle:l?e._layer.title??null:null,className:null,objectClassId:null},e.fsetInfo})()}}var ze=f(16776);class Ve extends P.Z{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerRelated",this._findObjectId=-1,this._requestStandardised=!1,this._removeGeometry=!1,this._overrideFields=null,this.featureObjectId=null,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,this._findObjectId=e.objectId,this.featureObjectId=e.objectId,this.relationship=e.relationship,this._relatedLayer=e.relatedLayer,void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return m.tI}end(){return this._layer}optimisePagingFeatureQueries(){}loadImpl(){var e=this;return(0,F.Z)(function*(){return yield Promise.all([e._layer.load(),e._relatedLayer?.load()]),e._initialiseFeatureSet(),e})()}nativeCapabilities(){return this._relatedLayer.nativeCapabilities()}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._relatedLayer.geometryType,this.fields=this._relatedLayer.fields.slice(0),this.hasZ=this._relatedLayer.hasZ,this.hasM=this._relatedLayer.hasM,null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const t=[],r=[];for(const n of this.fields)if("oid"===n.type)t.push(n),r.push(n.name);else for(const l of this._overrideFields)if(l.toLowerCase()===n.name.toLowerCase()){t.push(n),r.push(n.name);break}this.fields=t,this._overrideFields=r}const e=this._layer.nativeCapabilities();e&&(this._databaseType=e.databaseType,this._requestStandardised=e.requestStandardised),this.objectIdField=this._relatedLayer.objectIdField,this.globalIdField=this._relatedLayer.globalIdField,this.hasM=this._relatedLayer.supportsM,this.hasZ=this._relatedLayer.supportsZ,this.typeIdField=this._relatedLayer.typeIdField,this.types=this._relatedLayer.types,this.subtypeField=this._relatedLayer.subtypeField,this.subtypes=this._relatedLayer.subtypes}databaseType(){var e=this;return(0,F.Z)(function*(){return yield e._relatedLayer.databaseType(),e._databaseType=e._relatedLayer._databaseType,e._databaseType})()}isTable(){return this._relatedLayer.isTable()}_isInFeatureSet(){return m.dj.InFeatureSet}_candidateIdTransform(e){return e}_getSet(e){var t=this;return(0,F.Z)(function*(){if(null===t._wset){yield t._ensureLoaded();const r=yield t._getFilteredSet("",null,null,null,e);return t._wset=r,r}return t._wset})()}_changeFeature(e){const t={};for(const r of this.fields)t[r.name]=e.attributes[r.name];return new G.Z({geometry:!0===this._removeGeometry?null:e.geometry,attributes:t})}_getFilteredSet(e,t,r,n,l){var s=this;return(0,F.Z)(function*(){if(yield s.databaseType(),s.isTable()&&t&&null!==e&&""!==e)return new j.Z([],[],!0,null);const d=s._layer.nativeCapabilities();if(!1===d.canQueryRelated)return new j.Z([],[],!0,null);if(d.capabilities?.queryRelated&&d.capabilities.queryRelated.supportsPagination)return s._getFilteredSetUsingPaging(e,t,r,n,l);let i="",I=!1;null!==n&&d.capabilities?.queryRelated&&!0===d.capabilities.queryRelated.supportsOrderBy&&(i=n.constructClause(),I=!0);const b=new Te.default;b.objectIds=[s._findObjectId];const N=null!==s._overrideFields?s._overrideFields:s._fieldsIncludingObjectId(s._relatedLayer.fields?s._relatedLayer.fields.map(H=>H.name):["*"]);b.outFields=N,b.relationshipId=s.relationship.id,b.where="1=1";let W=!0;!0===s._removeGeometry&&(W=!1),b.returnGeometry=W,s._requestStandardised&&(b.sqlFormat="standard"),b.outSpatialReference=s.spatialReference,b.orderByFields=""!==i?i.split(","):null;const V=yield d.source.queryRelatedFeatures(b);s._checkCancelled(l);const J=V[s._findObjectId]?V[s._findObjectId].features:[],X=[];for(let H=0;H<J.length;H++)s._featureCache[J[H].attributes[s._relatedLayer.objectIdField]]=J[H],X.push(J[H].attributes[s._relatedLayer.objectIdField]);const Y=t&&null!==e&&""!==e,ee=null!=r;return new j.Z(Y||ee?X:[],Y||ee?[]:X,I,null)})()}_fieldsIncludingObjectId(e){if(null===e)return[this.objectIdField];const t=e.slice(0);if(t.includes("*"))return t;let r=!1;for(const n of t)if(n.toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t}_getFilteredSetUsingPaging(e,t,r,n,l){var s=this;return(0,F.Z)(function*(){let d="",i=!1;const I=s._layer.nativeCapabilities();null!==n&&I?.capabilities?.queryRelated&&!0===I.capabilities.queryRelated.supportsOrderBy&&(d=n.constructClause(),i=!0),yield s.databaseType();let N=s._maxQueryRate();const W=I.capabilities?.query.maxRecordCount;null!=W&&W<N&&(N=W);const V=t&&null!==e&&""!==e,J=null!=r;let X=null,Y=!0;!0===s._removeGeometry&&(Y=!1);const ee=null!==s._overrideFields?s._overrideFields:s._fieldsIncludingObjectId(s._relatedLayer.fields?s._relatedLayer.fields.map(H=>H.name):["*"]);return X=new j.Z(V||J?["GETPAGES"]:[],V||J?[]:["GETPAGES"],i,{outFields:ee.join(","),resultRecordCount:N,resultOffset:0,objectIds:[s._findObjectId],where:"1=1",orderByFields:d,returnGeometry:Y,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}}),yield s._expandPagedSet(X,N,0,0,l),X})()}_expandPagedSet(e,t,r,n,l){return this._expandPagedSetFeatureSet(e,t,r,n,l)}_clonePageDefinition(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}_getPhysicalPage(e,t,r){var n=this;return(0,F.Z)(function*(){const l=e.pagesDefinition.internal.lastRetrieved,s=l,d=e.pagesDefinition.internal.lastPage,i=n._layer.nativeCapabilities(),I=new Te.default;!0===n._requestStandardised&&(I.sqlFormat="standard"),I.relationshipId=n.relationship.id,I.objectIds=e.pagesDefinition.objectIds,I.resultOffset=e.pagesDefinition.internal.lastPage,I.resultRecordCount=e.pagesDefinition.resultRecordCount,I.outFields=e.pagesDefinition.outFields.split(","),I.where=e.pagesDefinition.where,I.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,I.returnGeometry=e.pagesDefinition.returnGeometry,I.outSpatialReference=n.spatialReference;const b=yield i.source.queryRelatedFeatures(I);if(n._checkCancelled(r),e.pagesDefinition.internal.lastPage!==d)return 0;const N=b[n._findObjectId]?b[n._findObjectId].features:[];for(let V=0;V<N.length;V++)e.pagesDefinition.internal.set[s+V]=N[V].attributes[n._relatedLayer.objectIdField];for(let V=0;V<N.length;V++)n._featureCache[N[V].attributes[n._relatedLayer.objectIdField]]=N[V];return N.length!==e.pagesDefinition.resultRecordCount&&(!b[n._findObjectId]||!1===b[n._findObjectId].exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=l+N.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,N.length})()}_getFeatures(e,t,r,n){var l=this;return(0,F.Z)(function*(){const s=[];-1!==t&&void 0===l._featureCache[t]&&s.push(t);const d=l._maxQueryRate();if(!0===l._checkIfNeedToExpandKnownPage(e,d))return yield l._expandPagedSet(e,d,0,0,n),l._getFeatures(e,t,r,n);let i=0;for(let I=e._lastFetchedIndex;I<e._known.length&&(i++,i<=r&&(e._lastFetchedIndex+=1),!("GETPAGES"!==e._known[I]&&void 0===l._featureCache[e._known[I]]&&(e._known[I]!==t&&s.push(e._known[I]),s.length>r)))&&!(i>=r&&0===s.length);I++);if(0===s.length)return"success";throw new S.EN(S.H9.MissingFeatures)})()}_refineSetBlock(e,t,r){return(0,F.Z)(function*(){return e})()}_stat(e,t,r,n,l,s,d){return(0,F.Z)(function*(){return{calculated:!1}})()}get gdbVersion(){return this._relatedLayer.gdbVersion}_canDoAggregates(e,t,r,n,l){return(0,F.Z)(function*(){return!1})()}relationshipMetaData(){return this._relatedLayer.relationshipMetaData()}serviceUrl(){return this._relatedLayer.serviceUrl()}queryAttachments(e,t,r,n,l){return this._relatedLayer.queryAttachments(e,t,r,n,l)}getFeatureByObjectId(e,t){return this._relatedLayer.getFeatureByObjectId(e,t)}getOwningSystemUrl(){return this._relatedLayer.getOwningSystemUrl()}getIdentityUser(){return this._relatedLayer.getIdentityUser()}getDataSourceFeatureSet(){return this._relatedLayer}get preferredTimeZone(){return this._relatedLayer?.preferredTimeZone??null}get dateFieldsTimeZone(){return this._relatedLayer?.dateFieldsTimeZone??null}get datesInUnknownTimezone(){return this._relatedLayer?.datesInUnknownTimezone}get editFieldsInfo(){return this._relatedLayer?.editFieldsInfo??null}get timeInfo(){return this._relatedLayer?.timeInfo??null}getFeatureSetInfo(){var e=this;return(0,F.Z)(function*(){return e.fsetInfo??e._layer.featureSetInfo})()}}var q=f(53791),Qe=f(55463);function Je(){null===q.Z.applicationCache&&(q.Z.applicationCache=new q.Z)}function ye(w,e){return ge.apply(this,arguments)}function ge(){return(ge=(0,F.Z)(function*(w,e){if(q.Z.applicationCache){const t=q.Z.applicationCache.getLayerInfo(w);if(t){const l=yield t;return new te.default({url:w,outFields:e,sourceJSON:l})}const r=new te.default({url:w,outFields:e}),n=(0,F.Z)(function*(){return yield r.load(),r.sourceJSON})();if(q.Z.applicationCache){q.Z.applicationCache.setLayerInfo(w,n);try{return yield n,r}catch(l){throw q.Z.applicationCache.clearLayerInfo(w),l}}return yield n,r}return new te.default({url:w,outFields:e})})).apply(this,arguments)}function me(w,e,t,r,n){return Fe.apply(this,arguments)}function Fe(){return(Fe=(0,F.Z)(function*(w,e,t,r,n,l=null){return se(yield ye(w,["*"]),e,t,r,n,l)})).apply(this,arguments)}function se(w,e=null,t=null,r=!0,n=null,l=null){if(w instanceof te.default||(0,L.a0)(w)){const d={layer:w,spatialReference:e,outFields:t,includeGeometry:r,lrucache:n,interceptor:l};return w.url||!w.source?new ce(d):new ze.Z(d)}const s=se(w.parent,e,t,r,n,l);return s.filter(h.WhereClause.create(w.parent.subtypeField+"="+w.subtypeCode.toString(),w.parent.fieldsIndex,s.dateFieldsTimeZoneDefaultUTC))}function Se(){return(Se=(0,F.Z)(function*(w){if(null!==q.Z.applicationCache){const t=q.Z.applicationCache.getLayerInfo(w);if(null!==t)return t}const e=(0,F.Z)(function*(){const t=yield(0,Q.Z)(w,{responseType:"json",query:{f:"json"}});return t.data?t.data:null})();if(null!==q.Z.applicationCache){q.Z.applicationCache.setLayerInfo(w,e);try{return yield e}catch(t){throw q.Z.applicationCache.clearLayerInfo(w),t}}return e})).apply(this,arguments)}function Ie(){return(Ie=(0,F.Z)(function*(w,e){const t="QUERYDATAELEMTS:"+e.toString()+":"+w;if(null!==q.Z.applicationCache){const n=q.Z.applicationCache.getLayerInfo(t);if(null!==n)return n}const r=(0,F.Z)(function*(){const n=yield(0,Q.Z)(w+"/queryDataElements",{method:"post",responseType:"json",query:{layers:JSON.stringify([e.toString()]),f:"json"}});if(n.data){const l=n.data;if(l.layerDataElements?.[0])return l.layerDataElements[0]}throw new S.EN(S.H9.DataElementsNotFound)})();if(null!==q.Z.applicationCache){q.Z.applicationCache.setLayerInfo(t,r);try{return yield r}catch(n){throw q.Z.applicationCache.clearLayerInfo(t),n}}return r})).apply(this,arguments)}function xe(w){return ve.apply(this,arguments)}function ve(){return(ve=(0,F.Z)(function*(w){if(null!==q.Z.applicationCache){const t=q.Z.applicationCache.getLayerInfo(w);if(null!==t)return t}const e=(0,F.Z)(function*(){const t=yield(0,Q.Z)(w,{responseType:"json",query:{f:"json"}});if(t.data){const r=t.data;return r.layers||(r.layers=[]),r.tables||(r.tables=[]),r}return{layers:[],tables:[]}})();if(null!==q.Z.applicationCache){q.Z.applicationCache.setLayerInfo(w,e);try{return yield e}catch(t){throw q.Z.applicationCache.clearLayerInfo(w),t}}return e})).apply(this,arguments)}function qe(w,e){return Ce.apply(this,arguments)}function Ce(){return Ce=(0,F.Z)(function*(w,e){const t={metadata:null,networkId:-1,unVersion:3,terminals:[],queryelem:null,layerNameLkp:{},lkp:null},r=yield xe(w);if(t.metadata=r,void 0!==r.controllerDatasetLayers?.utilityNetworkLayerId&&null!==r.controllerDatasetLayers.utilityNetworkLayerId){if(r.layers)for(const s of r.layers)t.layerNameLkp[s.id]=s.name;if(r.tables)for(const s of r.tables)t.layerNameLkp[s.id]=s.name;const n=r.controllerDatasetLayers.utilityNetworkLayerId;t.networkId=n;const l=yield function $e(w,e){return Ie.apply(this,arguments)}(w,n);if(l){t.queryelem=l,t.queryelem?.dataElement&&void 0!==t.queryelem.dataElement.schemaGeneration&&(t.unVersion=t.queryelem.dataElement.schemaGeneration),t.lkp={},t.queryelem.dataElement.domainNetworks||(t.queryelem.dataElement.domainNetworks=[]);for(const d of t.queryelem.dataElement.domainNetworks){for(const i of d.edgeSources??[]){const I={layerId:i.layerId,sourceId:i.sourceId,className:t.layerNameLkp[i.layerId]??null};I.className&&(t.lkp[I.className]=I)}for(const i of d.junctionSources??[]){const I={layerId:i.layerId,sourceId:i.sourceId,className:t.layerNameLkp[i.layerId]??null};I.className&&(t.lkp[I.className]=I)}}if(t.queryelem.dataElement.terminalConfigurations)for(const d of t.queryelem.dataElement.terminalConfigurations)for(const i of d.terminals)t.terminals.push({terminalId:i.terminalId,terminalName:i.terminalName});const s=yield function He(w){return Se.apply(this,arguments)}(w+"/"+n);if(void 0!==s.systemLayers?.associationsTableId&&null!==s.systemLayers.associationsTableId){const d=[];t.unVersion>=4&&(d.push("STATUS"),d.push("PERCENTALONG"));let i=yield me(w+"/"+s.systemLayers.associationsTableId.toString(),e,["OBJECTID","FROMNETWORKSOURCEID","TONETWORKSOURCEID","FROMGLOBALID","TOGLOBALID","TOTERMINALID","FROMTERMINALID","ASSOCIATIONTYPE","ISCONTENTVISIBLE","GLOBALID",...d],!1,null,null);return yield i.load(),t.unVersion>=4&&(i=i.filter(h.WhereClause.create("STATUS NOT IN (1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 30, 31, 33, 34, 35, 36, 37, 38, 39, 41, 42, 43, 44, 45, 46, 47, 49, 50, 51, 52, 53, 54, 55, 57, 58, 59, 60, 61, 62, 63)",i.getFieldsIndex(),i.dateFieldsTimeZoneDefaultUTC)),yield i.load()),{lkp:t.lkp,associations:i,unVersion:t.unVersion,terminals:t.terminals}}return{associations:null,unVersion:t.unVersion,lkp:null,terminals:[]}}return{associations:null,unVersion:t.unVersion,lkp:null,terminals:[]}}return{associations:null,unVersion:t.unVersion,lkp:null,terminals:[]}}),Ce.apply(this,arguments)}function Xe(w,e,t){return De.apply(this,arguments)}function De(){return(De=(0,F.Z)(function*(w,e,t,r=null,n=null,l=!0,s=null,d=null){let i=w.serviceUrl();if(!i)return null;i="/"===i.charAt(i.length-1)?i+e.relatedTableId.toString():i+"/"+e.relatedTableId.toString();const I=yield me(i,r,n,l,s,d);return new Ve({layer:w,relatedLayer:I,relationship:e,objectId:t,spatialReference:r,outFields:n,includeGeometry:l,lrucache:s,interceptor:d})})).apply(this,arguments)}A.Z.registerAction(),M.registerAction(),E.Z.registerAction(),x.Z.registerAction(),v.Z.registerAction();class Ye extends K.Z{constructor(e,t=null,r=null,n=null){super(),this._map=e,this._overridespref=t,this._lrucache=r,this._interceptor=n,this._instantLayers=[]}_makeAndAddFeatureSet(e,t=!0,r=null){const n=se(e,this._overridespref,null===r?["*"]:r,t,this._lrucache,this._interceptor);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n}featureSetByName(e,t=!0,r=null){var n=this;return(0,F.Z)(function*(){if(void 0!==n._map.loaded&&void 0!==n._map.load&&!1===n._map.loaded)return yield n._map.load(),n.featureSetByName(e,t,r);null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const l=JSON.stringify(r);for(let d=0;d<n._instantLayers.length;d++){const i=n._instantLayers[d];if(i.opitem.title===e&&i.includeGeometry===t&&i.outFields===l)return n._instantLayers[d].featureset}const s=n._map.allLayers.find(d=>{if(d instanceof te.default){if(d.title===e)return!0}else if((0,L.a0)(d)&&d.title===e)return!0;return!1});if(s)return n._makeAndAddFeatureSet(s,t,r);if(n._map.tables){const d=n._map.tables.find(i=>!!(i.title&&i.title===e||i.title&&i.title===e));if(d){if(d instanceof te.default)return n._makeAndAddFeatureSet(d,t,r);if(!d._materializedTable){const i=d.outFields?d:{...d,outFields:["*"]};d._materializedTable=new te.default(i)}return yield d._materializedTable.load(),n._makeAndAddFeatureSet(d._materializedTable,t,r)}}return null})()}featureSetById(e,t=!0,r=["*"]){var n=this;return(0,F.Z)(function*(){if(void 0!==n._map.loaded&&void 0!==n._map.load&&!1===n._map.loaded)return yield n._map.load(),n.featureSetById(e,t,r);null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const l=JSON.stringify(r);for(let d=0;d<n._instantLayers.length;d++){const i=n._instantLayers[d];if(i.opitem.id===e&&i.includeGeometry===t&&i.outFields===l)return n._instantLayers[d].featureset}const s=n._map.allLayers.find(d=>{if(d instanceof te.default){if(d.id===e)return!0}else if((0,L.a0)(d)&&d.id===e)return!0;return!1});if(s)return n._makeAndAddFeatureSet(s,t,r);if(n._map.tables){const d=n._map.tables.find(i=>i.id===e);if(d){if(d instanceof te.default)return n._makeAndAddFeatureSet(d,t,r);if(!d._materializedTable){const i={...d,outFields:["*"]};d._materializedTable=new te.default(i)}return yield d._materializedTable.load(),n._makeAndAddFeatureSet(d._materializedTable,t,r)}}return null})()}}class we extends K.Z{constructor(e,t=null,r=null,n=null){super(),this._url=e,this._overridespref=t,this._lrucache=r,this._interceptor=n,this.metadata=null,this._instantLayers=[]}get url(){return this._url}_makeAndAddFeatureSet(e,t=!0,r=null){const n=se(e,this._overridespref,null===r?["*"]:r,t,this._lrucache);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n}_loadMetaData(){var e=this;return(0,F.Z)(function*(){const t=yield xe(e._url);return e.metadata=t,t})()}load(){return this._loadMetaData()}clone(){return new we(this._url,this._overridespref,this._lrucache,this._interceptor)}featureSetByName(e,t=!0,r=null){var n=this;return(0,F.Z)(function*(){null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const l=JSON.stringify(r);for(let i=0;i<n._instantLayers.length;i++){const I=n._instantLayers[i];if(I.opitem.title===e&&I.includeGeometry===t&&I.outFields===l)return n._instantLayers[i].featureset}const s=yield n._loadMetaData();let d=null;for(const i of s.layers??[])i.name===e&&(d=i);if(!d)for(const i of s.tables??[])i.name===e&&(d=i);if(d){const i=yield ye(n._url+"/"+d.id,["*"]);return n._makeAndAddFeatureSet(i,t,r)}return null})()}featureSetById(e,t=!0,r=["*"]){var n=this;return(0,F.Z)(function*(){null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const l=JSON.stringify(r);e=null!=e?e.toString():"";for(let i=0;i<n._instantLayers.length;i++){const I=n._instantLayers[i];if(I.opitem.id===e&&I.includeGeometry===t&&I.outFields===l)return n._instantLayers[i].featureset}const s=yield n._loadMetaData();let d=null;for(const i of s.layers??[])null!=i.id&&i.id.toString()===e&&(d=i);if(!d)for(const i of s.tables??[])null!=i.id&&i.id.toString()===e&&(d=i);if(d){const i=yield ye(n._url+"/"+d.id,["*"]);return n._makeAndAddFeatureSet(i,t,r)}return null})()}}function et(w,e,t=null,r=null){return new Ye(w,e,t,r)}function tt(w,e,t=null,r=null){return new we(w,e,t,r)}function rt(w,e,t,r,n){if(null===w)return null;if(w instanceof te.default){switch(e){case"datasource":return se(w,n,w.outFields,!0,t,r).getDataSourceFeatureSet();case"parent":case"root":return se(w,n,w.outFields,!0,t,r)}return null}if((0,L.a0)(w)){switch(e){case"datasource":return se(w,n,w.outFields,!0,t,r).getDataSourceFeatureSet();case"parent":case"root":return se(w,n,w.outFields,!0,t,r)}return null}if((0,L.a1)(w)){switch(e){case"datasource":return se(w.parent,n,w.parent.outFields,!0,t,r).getDataSourceFeatureSet();case"parent":case"root":return se(w,n,w.parent.outFields,!0,t,r)}return null}if(w instanceof P.Z)switch(e){case"datasource":return w.getDataSourceFeatureSet();case"parent":return w;case"root":return w.getRootFeatureSet()}return null}function nt(w,e,t,r,n,l,s){return Ee.apply(this,arguments)}function Ee(){return(Ee=(0,F.Z)(function*(w,e,t,r,n,l,s,d=null){if(q.Z.applicationCache){const I=q.Z.applicationCache.getLayerInfo(w+":"+l.url);if(I){const b=yield I;return se(new te.default({url:(0,m.US)(b.url)+"/"+e,outFields:["*"]}),t,r,n,s,d)}}const i=new Qe.default({id:w,portal:l}).load();q.Z.applicationCache&&q.Z.applicationCache.setLayerInfo(w+":"+l.url,i);try{const I=yield i;return se(new te.default({url:(0,m.US)(I.url??"")+"/"+e,outFields:["*"]}),t,r,n,s,d)}catch(I){throw q.Z.applicationCache&&q.Z.applicationCache.clearLayerInfo(w+":"+l.url),I}})).apply(this,arguments)}},52724:(ne,$,f)=>{f.d($,{$X:()=>m,QP:()=>T,TO:()=>B,Xx:()=>Z,yN:()=>h});var F=f(15861),Q=f(88879),K=f(27187),L=f(47982),A=f(49086),G=f(91510),U=f(77132),E=f(83947),S=f(62208),P=f(80774),j=f(65234);class C{constructor(p){this.field=p,this.sqlRewritable=!1}postInitialization(p,u){}}class m extends C{constructor(p){super(p),this.sqlRewritable=!0}extractValue(p){return p.attributes[this.field.name]}rewriteSql(p){return{rewritten:this.sqlRewritable,where:p}}}class T extends C{constructor(p,u,_){super((0,U.JW)(p)),this.originalField=p,this.sqlRewritable=!0,this.field.name=u,this.field.alias=_}rewriteSql(p,u){return{rewritten:this.sqlRewritable,where:(0,E.bB)(p,this.field.name,this.originalField.name,u.getFieldsIndex())}}extractValue(p){return p.attributes[this.originalField.name]}}let B=(()=>{class D extends C{constructor(u,_,c){super(u),this.codefield=_,this.lkp=c,this.reverseLkp={};for(const g in c)this.reverseLkp[c[g]]=g;this.sqlRewritable=!0}rewriteSql(u,_){const c=this.evaluateNodeToWhereClause(u.parseTree,U.Bj.Standardised,this.field.name,this.codefield instanceof P.WhereClause?(0,E.zR)(this.codefield,U.Bj.Standardised):this.codefield,u.parameters);return c.includes(D.BADNESS)?{rewritten:!1,where:u}:{rewritten:this.sqlRewritable,where:P.WhereClause.create(c,_._parent.getFieldsIndex(),_.dateFieldsTimeZoneDefaultUTC)}}evaluateNodeToWhereClause(u,_,c=null,g=null,y){let R,O,M,x;switch(u.type){case"interval":return(0,E.TE)(this.evaluateNodeToWhereClause(u.value,_,c,g,y),u.qualifier,u.op);case"case-expression":{let v=" CASE ";"simple"===u.format&&(v+=this.evaluateNodeToWhereClause(u.operand,_,c,D.BADNESS,y));for(let k=0;k<u.clauses.length;k++)v+=" WHEN "+this.evaluateNodeToWhereClause(u.clauses[k].operand,_,c,D.BADNESS,y)+" THEN "+this.evaluateNodeToWhereClause(u.clauses[k].value,_,c,D.BADNESS,y);return null!==u.else&&(v+=" ELSE "+this.evaluateNodeToWhereClause(u.else,_,c,D.BADNESS,y)),v+=" END ",v}case"parameter":{const v=y[u.value.toLowerCase()];if("string"==typeof v)return"'"+v.toString().replaceAll("'","''")+"'";if((0,U.J_)(v)||(0,U.T4)(v))return(0,E.vn)(v,_);if((0,U._U)(v))return(0,E.wF)(v,_);if((0,U.NP)(v))return(0,E.mA)(v,_);if((0,U.$A)(v))return(0,E.av)(v,_);if(v instanceof Array){const k=[];for(let z=0;z<v.length;z++)"string"==typeof v[z]?k.push("'"+v[z].toString().replaceAll("'","''")+"'"):(0,U.J_)(v[z])||(0,U.T4)(v[z])?k.push((0,E.vn)(v[z],_)):(0,U._U)(v[z])?k.push((0,E.wF)(v[z],_)):(0,U.NP)(v[z])?k.push((0,E.mA)(v[z],_)):(0,U.$A)(v[z])?k.push((0,E.av)(v[z],_)):k.push(v[z].toString());return k}return v.toString()}case"expression-list":O=[];for(const v of u.value)O.push(this.evaluateNodeToWhereClause(v,_,c,g,y));return O;case"unary-expression":return" ( NOT "+this.evaluateNodeToWhereClause(u.expr,_,c,D.BADNESS,y)+" ) ";case"binary-expression":switch(u.operator){case"AND":return" ("+this.evaluateNodeToWhereClause(u.left,_,c,g,y)+" AND "+this.evaluateNodeToWhereClause(u.right,_,c,g,y)+") ";case"OR":return" ("+this.evaluateNodeToWhereClause(u.left,_,c,g,y)+" OR "+this.evaluateNodeToWhereClause(u.right,_,c,g,y)+") ";case"IS":if("null"!==u.right.type)throw new L.eS(L.f.UnsupportedIsRhs);return" ("+this.evaluateNodeToWhereClause(u.left,_,c,g,y)+" IS NULL )";case"ISNOT":if("null"!==u.right.type)throw new L.eS(L.f.UnsupportedIsRhs);return" ("+this.evaluateNodeToWhereClause(u.left,_,c,g,y)+" IS NOT NULL )";case"IN":if(R=[],"expression-list"===u.right.type){if("column-reference"===u.left.type&&u.left.column.toUpperCase()===this.field.name.toUpperCase()){const v=[];let k=!0;for(const z of u.right.value){if("string"!==z.type){k=!1;break}if(void 0===this.lkp[z.value]){k=!1;break}v.push(this.lkp[z.value].toString())}if(k)return" ("+this.evaluateNodeToWhereClause(u.left,_,c,g,y)+" IN ("+v.join(",")+")) "}return R=this.evaluateNodeToWhereClause(u.right,_,c,g,y)," ("+this.evaluateNodeToWhereClause(u.left,_,c,g,y)+" IN ("+R.join(",")+")) "}return x=this.evaluateNodeToWhereClause(u.right,_,c,g,y),x instanceof Array?" ("+this.evaluateNodeToWhereClause(u.left,_,c,g,y)+" IN ("+x.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(u.left,_,c,g,y)+" IN ("+x+")) ";case"NOT IN":if(R=[],"expression-list"===u.right.type){if("column-reference"===u.left.type&&u.left.column.toUpperCase()===this.field.name.toUpperCase()){const v=[];let k=!0;for(const z of u.right.value){if("string"!==z.type){k=!1;break}if(void 0===this.lkp[z.value]){k=!1;break}v.push(this.lkp[z.value].toString())}if(k)return" ("+this.evaluateNodeToWhereClause(u.left,_,c,g,y)+" NOT IN ("+v.join(",")+")) "}return R=this.evaluateNodeToWhereClause(u.right,_,c,g,y)," ("+this.evaluateNodeToWhereClause(u.left,_,c,g,y)+" NOT IN ("+R.join(",")+")) "}return x=this.evaluateNodeToWhereClause(u.right,_,c,g,y),x instanceof Array?" ("+this.evaluateNodeToWhereClause(u.left,_,c,g,y)+" NOT IN ("+x.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(u.left,_,c,g,y)+" NOT IN ("+x+")) ";case"BETWEEN":return M=this.evaluateNodeToWhereClause(u.right,_,c,D.BADNESS,y)," ("+this.evaluateNodeToWhereClause(u.left,_,c,D.BADNESS,y)+" BETWEEN "+M[0]+" AND "+M[1]+" ) ";case"NOTBETWEEN":return M=this.evaluateNodeToWhereClause(u.right,_,c,D.BADNESS,y)," ("+this.evaluateNodeToWhereClause(u.left,_,c,D.BADNESS,y)+" NOT BETWEEN "+M[0]+" AND "+M[1]+" ) ";case"LIKE":return""!==u.escape?" ("+this.evaluateNodeToWhereClause(u.left,_,c,D.BADNESS,y)+" LIKE "+this.evaluateNodeToWhereClause(u.right,_,c,D.BADNESS,y)+" ESCAPE '"+u.escape+"') ":" ("+this.evaluateNodeToWhereClause(u.left,_,c,D.BADNESS,y)+" LIKE "+this.evaluateNodeToWhereClause(u.right,_,c,D.BADNESS,y)+") ";case"NOT LIKE":return""!==u.escape?" ("+this.evaluateNodeToWhereClause(u.left,_,c,D.BADNESS,y)+" NOT LIKE "+this.evaluateNodeToWhereClause(u.right,_,c,D.BADNESS,y)+" ESCAPE '"+u.escape+"') ":" ("+this.evaluateNodeToWhereClause(u.left,_,c,D.BADNESS,y)+" NOT LIKE "+this.evaluateNodeToWhereClause(u.right,_,c,D.BADNESS,y)+") ";case"<>":case"=":if("column-reference"===u.left.type&&"string"===u.right.type){if(u.left.column.toUpperCase()===this.field.name.toUpperCase()&&void 0!==this.lkp[u.right.value.toString()])return" ("+g+" "+u.operator+" "+this.lkp[u.right.value.toString()].toString()+") "}else if("column-reference"===u.right.type&&"string"===u.left.type&&u.right.column.toUpperCase()===this.field.name.toUpperCase())return" ("+this.lkp[u.right.value.toString()].toString()+" "+u.operator+" "+g+") ";return" ("+this.evaluateNodeToWhereClause(u.left,_,c,D.BADNESS,y)+" "+u.operator+" "+this.evaluateNodeToWhereClause(u.right,_,c,D.BADNESS,y)+") ";case"<":case">":case">=":case"<=":case"*":case"-":case"+":case"/":case"||":return" ("+this.evaluateNodeToWhereClause(u.left,_,c,D.BADNESS,y)+" "+u.operator+" "+this.evaluateNodeToWhereClause(u.right,_,c,D.BADNESS,y)+") "}case"null":return"null";case"boolean":return!0===u.value?"1":"0";case"string":return"'"+u.value.toString().replaceAll("'","''")+"'";case"timestamp":return`timestamp '${u.value}'`;case"date":return`date '${u.value}'`;case"time":return`time '${u.value}'`;case"number":return u.value.toString();case"current-time":return(0,E.vR)("date"===u.mode,_);case"column-reference":return c&&c.toLowerCase()===u.column.toLowerCase()?"("+g+")":u.column;case"data-type":return u.value;case"function":{const v=this.evaluateNodeToWhereClause(u.args,_,c,D.BADNESS,y);return(0,E.fz)(u.name,v,_)}}throw new L.eS(L.f.UnsupportedSyntax,{node:u.type})}extractValue(u){return this.codefield instanceof P.WhereClause?this.reverseLkp[P.WhereClause.convertValueToStorageFormat(this.codefield.calculateValueCompiled(u))]:this.reverseLkp[u.attributes[this.codefield]]}}return D.BADNESS="_!!!_BAD_LKP_!!!!",D})();class h extends C{constructor(p,u){super(p),this._sql=u}rewriteSql(p,u){return{rewritten:!0,where:(0,E.bB)(p,this.field.name,(0,E.zR)(this._sql,U.Bj.Standardised),u.getFieldsIndex())}}extractValue(p){return P.WhereClause.convertValueToStorageFormat(this._sql.calculateValueCompiled(p),this.field.type)}}class Z extends A.Z{static findField(p,u){for(const _ of p)if(_.name.toLowerCase()===u.toString().toLowerCase())return _;return null}constructor(p){super(p),this._calcFunc=null,this.declaredClass="esri.arcade.featureset.actions.Adapted",this.adaptedFields=[],this._extraFilter=null,this._extraFilter=p.extraFilter,this._parent=p.parentfeatureset,this._maxProcessing=30,this.adaptedFields=p.adaptedFields}_initialiseFeatureSet(){null!==this._parent?(this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.spatialReference=new j.Z({wkid:4326}),this.objectIdField="",this.globalIdField="",this.geometryType=U.Qk.point,this.typeIdField="",this.types=null,this.subtypeField=null,this.subtypes=null),this.fields=[];for(const p of this.adaptedFields)p.postInitialization(this,this._parent),this.fields.push(p.field)}_getSet(p){var u=this;return(0,F.Z)(function*(){if(null===u._wset){yield u._ensureLoaded();let _=null;return _=u._extraFilter?yield u._getFilteredSet("",null,null,null,p):yield u._parent?._getSet(p),u._checkCancelled(p),(0,S.O3)(_),u._wset=new G.Z(_._candidates.slice(0),_._known.slice(0),_._ordered,u._clonePageDefinition(_.pagesDefinition)),u._wset}return u._wset})()}_isInFeatureSet(p){return this._parent._isInFeatureSet(p)}_getFeatures(p,u,_,c){var g=this;return(0,F.Z)(function*(){const y=[];-1!==u&&void 0===g._featureCache[u]&&y.push(u);const R=g._maxQueryRate();if(!0===g._checkIfNeedToExpandKnownPage(p,R))return yield g._expandPagedSet(p,R,0,0,c),g._getFeatures(p,u,_,c);let O=0;for(let v=p._lastFetchedIndex;v<p._known.length&&(O++,O<=_&&(p._lastFetchedIndex+=1),!(void 0===g._featureCache[p._known[v]]&&(p._known[v]!==u&&y.push(p._known[v]),y.length>=R)));v++);if(0===y.length)return"success";p=new G.Z([],y,p._ordered,null);const M=Math.min(y.length,_);yield g._parent?._getFeatures(p,-1,M,c),g._checkCancelled(c);const x=[];for(let v=0;v<M;v++){const k=g._parent?._featureFromCache(y[v]);void 0!==k&&x.push({geometry:k.geometry,attributes:k.attributes,id:y[v]})}for(const v of x){const k=[];for(const z of g.adaptedFields)k[z.field.name]=z.extractValue(v);g._featureCache[v.id]=new Q.Z({attributes:k,geometry:(0,K.r1)(v.geometry)})}return"success"})()}_fetchAndRefineFeatures(){return(0,F.Z)(function*(){throw new L.EN(L.H9.NeverReach)})()}_getFilteredSet(p,u,_,c,g){var y=this;return(0,F.Z)(function*(){let R=!1;const O=y._reformulateWithoutAdaptions(_);R=O.cannot,_=O.where;let M=!1;if(null!==c){M=!0;const k=[];for(const z of y.adaptedFields)if(!(z instanceof m)&&!0===c.scanForField(z.field.name)){if(!(z instanceof T)){c=null,M=!1;break}k.push({field:z.field.name,newfield:z.originalField.name})}c&&k.length>0&&(c=c.replaceFields(k))}null!==_?null!==y._extraFilter&&(_=(0,E.$e)(y._extraFilter,_)):_=y._extraFilter,yield y._ensureLoaded();const x=yield y._parent._getFilteredSet(p,u,_,c,g);let v;return y._checkCancelled(g),v=!0===R?new G.Z(x._candidates.slice(0).concat(x._known.slice(0)),[],!0===M&&x._ordered,y._clonePageDefinition(x.pagesDefinition)):new G.Z(x._candidates.slice(0),x._known.slice(0),!0===M&&x._ordered,y._clonePageDefinition(x.pagesDefinition)),v})()}_reformulateWithoutAdaptions(p){const u={cannot:!1,where:p};if(null!==p)for(const _ of this.adaptedFields)if(!0===(0,E.hq)(p,_.field.name)){const c=_.rewriteSql(p,this);if(!0!==c.rewritten){u.cannot=!0,u.where=null;break}u.where=c.where}return u}_stat(p,u,_,c,g,y,R){var O=this;return(0,F.Z)(function*(){let M=!1,x=O._reformulateWithoutAdaptions(u);if(M=x.cannot,u=x.where,x=O._reformulateWithoutAdaptions(g),M=M||x.cannot,null!==(g=x.where)?null!==O._extraFilter&&(g=(0,E.$e)(O._extraFilter,g)):g=O._extraFilter,!0===M)return null===g&&""===_&&null===c?O._manualStat(p,u,y,R):{calculated:!1};const v=yield O._parent._stat(p,u,_,c,g,y,R);return!1===v.calculated?null===g&&""===_&&null===c?O._manualStat(p,u,y,R):{calculated:!1}:v})()}_canDoAggregates(p,u,_,c,g){var y=this;return(0,F.Z)(function*(){if(null===y._parent)return!1;for(let M=0;M<p.length;M++)for(const x of y.adaptedFields)if(p[M].toLowerCase()===x.field.name.toLowerCase()&&!(x instanceof m))return!1;const R=[];for(let M=0;M<u.length;M++){const x=u[M];if(null!==x.workingexpr){const v=y._reformulateWithoutAdaptions(x.workingexpr);if(v.cannot)return!1;const k=x.clone();k.workingexpr=v.where,R.push(k)}else R.push(x)}const O=y._reformulateWithoutAdaptions(g);return!O.cannot&&(null!==(g=O.where)?null!==y._extraFilter&&(g=(0,E.$e)(y._extraFilter,g)):g=y._extraFilter,y._parent._canDoAggregates(p,R,_,c,g))})()}_getAggregatePagesDataSourceDefinition(p,u,_,c,g,y,R){var O=this;return(0,F.Z)(function*(){if(null===O._parent)throw new L.EN(L.H9.NeverReach);const M=[];for(let v=0;v<u.length;v++){const k=u[v];if(null!==k.workingexpr){const z=O._reformulateWithoutAdaptions(k.workingexpr);if(z.cannot)throw new L.EN(L.H9.NeverReach);const ie=k.clone();ie.workingexpr=z.where,M.push(ie)}else M.push(k)}const x=O._reformulateWithoutAdaptions(g);if(x.cannot)throw new L.EN(L.H9.NeverReach);return null!==(g=x.where)?null!==O._extraFilter&&(g=(0,E.$e)(O._extraFilter,g)):g=O._extraFilter,O._parent._getAggregatePagesDataSourceDefinition(p,M,_,c,g,y,R)})()}}},53997:(ne,$,f)=>{f.d($,{Z:()=>P});var F=f(15861),Q=f(47982),K=f(49086),L=f(91510),A=f(77132),G=f(83947),U=f(10699),E=f(80774),S=f(65234);class P extends K.Z{constructor(C){super(C),this.declaredClass="esri.arcade.featureset.actions.AttributeFilter",this._maxProcessing=1e3,this._parent=C.parentfeatureset,C.whereclause instanceof E.WhereClause?(this._whereclause=C.whereclause,this._whereClauseFunction=null):(this._whereClauseFunction=C.whereclause,this._whereclause=null)}_initialiseFeatureSet(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types,this.subtypeField=this._parent.subtypeField,this.subtypes=this._parent.subtypes):(this.fields=[],this.typeIdField="",this.subtypeField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new S.Z({wkid:4326}),this.geometryType=A.Qk.point)}_getSet(C){var m=this;return(0,F.Z)(function*(){if(null===m._wset){yield m._ensureLoaded();const T=yield m._parent._getFilteredSet("",null,m._whereclause,null,C);return m._checkCancelled(C),m._wset=null!==m._whereClauseFunction?new L.Z(T._candidates.slice(0).concat(T._known.slice(0)),[],T._ordered,m._clonePageDefinition(T.pagesDefinition)):new L.Z(T._candidates.slice(0),T._known.slice(0),T._ordered,m._clonePageDefinition(T.pagesDefinition)),m._wset}return m._wset})()}_isInFeatureSet(C){let m=this._parent?._isInFeatureSet(C);return m===A.dj.NotInFeatureSet?m:(m=this._idstates[C],void 0===m?A.dj.Unknown:m)}_getFeature(C,m,T){return this._parent._getFeature(C,m,T)}_getFeatures(C,m,T,B){return this._parent._getFeatures(C,m,T,B)}_featureFromCache(C){return this._parent._featureFromCache(C)}executeWhereClause(C){return this._whereclause?.testFeature(C)??!1}executeWhereClauseDeferred(C){var m=this;return(0,F.Z)(function*(){if(null!==m._whereClauseFunction){const T=m._whereClauseFunction(C);return(0,U.y8)(T),T}return m.executeWhereClause(C)})()}_fetchAndRefineFeatures(C,m,T){var B=this;return(0,F.Z)(function*(){const h=new L.Z([],C,!1,null),Z=Math.min(m,C.length);if(yield B._parent?._getFeatures(h,-1,Z,T),B._checkCancelled(T),null==B._whereClauseFunction){for(let p=0;p<Z;p++){const u=B._parent?._featureFromCache(C[p]);B._idstates[C[p]]=!0===B.executeWhereClause(u)?A.dj.InFeatureSet:A.dj.NotInFeatureSet}return"success"}const D=[];for(let p=0;p<Z;p++){const u=B._parent?._featureFromCache(C[p]);D.push(yield B.executeWhereClauseDeferred(u))}for(let p=0;p<m;p++)B._idstates[C[p]]=!0===D[p]?A.dj.InFeatureSet:A.dj.NotInFeatureSet;return"success"})()}_getFilteredSet(C,m,T,B,h){var Z=this;return(0,F.Z)(function*(){null!==Z._whereClauseFunction||(null!==T?null!==Z._whereclause&&(T=(0,G.$e)(Z._whereclause,T)):T=Z._whereclause),yield Z._ensureLoaded();const D=yield Z._parent._getFilteredSet(C,m,T,B,h);let p;return Z._checkCancelled(h),p=null!==Z._whereClauseFunction?new L.Z(D._candidates.slice(0).concat(D._known.slice(0)),[],D._ordered,Z._clonePageDefinition(D.pagesDefinition)):new L.Z(D._candidates.slice(0),D._known.slice(0),D._ordered,Z._clonePageDefinition(D.pagesDefinition)),p})()}_stat(C,m,T,B,h,Z,D){var p=this;return(0,F.Z)(function*(){if(null!==p._whereClauseFunction)return null===h&&""===T&&null===B?p._manualStat(C,m,Z,D):{calculated:!1};let u=p._whereclause;null!==h&&null!==p._whereclause&&(u=(0,G.$e)(p._whereclause,h));const _=yield p._parent._stat(C,m,T,B,u,Z,D);return!1===_.calculated?null===h&&""===T&&null===B?p._manualStat(C,m,Z,D):{calculated:!1}:_})()}_canDoAggregates(C,m,T,B,h){var Z=this;return(0,F.Z)(function*(){return null===Z._whereClauseFunction&&(null!==h?null!==Z._whereclause&&(h=(0,G.$e)(Z._whereclause,h)):h=Z._whereclause,null!==Z._parent&&Z._parent._canDoAggregates(C,m,T,B,h))})()}_getAggregatePagesDataSourceDefinition(C,m,T,B,h,Z,D){var p=this;return(0,F.Z)(function*(){if(null===p._parent)throw new Q.EN(Q.H9.NeverReach);return null!==h?null!==p._whereclause&&(h=(0,G.$e)(p._whereclause,h)):h=p._whereclause,p._parent._getAggregatePagesDataSourceDefinition(C,m,T,B,h,Z,D)})()}static registerAction(){K.Z._featuresetFunctions.filter=function(C){if("function"==typeof C)return new P({parentfeatureset:this,whereclause:C});let m=null;return C instanceof E.WhereClause&&(m=C),new P({parentfeatureset:this,whereclause:m})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}},95896:(ne,$,f)=>{f.d($,{Z:()=>U});var F=f(15861),Q=f(47562),K=f(47982),L=f(49086),A=f(91510),G=f(57366);class U extends L.Z{constructor(S){super(S),this._orderbyclause=null,this.declaredClass="esri.arcade.featureset.actions.OrderBy",this._maxProcessing=100,this._orderbyclause=S.orderbyclause,this._parent=S.parentfeatureset}_getSet(S){var P=this;return(0,F.Z)(function*(){if(null===P._wset){yield P._ensureLoaded();const j=yield P._getFilteredSet("",null,null,P._orderbyclause,S);return P._checkCancelled(S),P._wset=j,P._wset}return P._wset})()}manualOrderSet(S,P){var j=this;return(0,F.Z)(function*(){const C=yield j.getIdColumnDictionary(S,[],-1,P);j._orderbyclause?.order(C);const m=new A.Z([],[],!0,null);for(let T=0;T<C.length;T++)m._known.push(C[T].id);return m})()}getIdColumnDictionary(S,P,j,C){var m=this;return(0,F.Z)(function*(){if(j<S._known.length-1){const T=m._maxQueryRate();if("GETPAGES"===S._known[j+1])return yield(0,Q.a2)(m._parent._expandPagedSet(S,T,0,0,C)),m.getIdColumnDictionary(S,P,j,C);let B=j+1;const h=[];for(;B<S._known.length&&"GETPAGES"!==S._known[B];)h.push(S._known[B]),B++;j+=h.length;const Z=yield(0,Q.a2)(m._parent._getFeatureBatch(h,C));m._checkCancelled(C);for(const D of Z)P.push({id:D.attributes[m.objectIdField],feature:D});return m.getIdColumnDictionary(S,P,j,C)}return S._candidates.length>0?(yield(0,Q.a2)(m._refineSetBlock(S,m._maxProcessingRate(),C)),m._checkCancelled(C),m.getIdColumnDictionary(S,P,j,C)):P})()}_isInFeatureSet(S){return this._parent._isInFeatureSet(S)}_getFeatures(S,P,j,C){return this._parent._getFeatures(S,P,j,C)}_featureFromCache(S){if(void 0===this._featureCache[S]){const P=this._parent._featureFromCache(S);return void 0===P?void 0:null===P?null:(this._featureCache[S]=P,P)}return this._featureCache[S]}_fetchAndRefineFeatures(){return(0,F.Z)(function*(){throw new K.EN(K.H9.NeverReach)})()}_getFilteredSet(S,P,j,C,m){var T=this;return(0,F.Z)(function*(){yield T._ensureLoaded();const B=yield T._parent._getFilteredSet(S,P,j,null===C?T._orderbyclause:C,m);T._checkCancelled(m);const h=new A.Z(B._candidates.slice(0),B._known.slice(0),B._ordered,T._clonePageDefinition(B.pagesDefinition));let Z=!0;if(B._candidates.length>0&&(Z=!1),!1===h._ordered){let D=yield T.manualOrderSet(h,m);return!1===Z&&(null===P&&null===j||(D=new A.Z(D._candidates.slice(0).concat(D._known.slice(0)),[],D._ordered,T._clonePageDefinition(D.pagesDefinition)))),D}return h})()}static registerAction(){L.Z._featuresetFunctions.orderBy=function(S){return""===S?this:new U({parentfeatureset:this,orderbyclause:new G.Z(S)})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}},79429:(ne,$,f)=>{f.d($,{Z:()=>G});var F=f(15861),Q=f(47982),K=f(49086),L=f(91510),A=f(77132);class G extends K.Z{constructor(E){super(E),this._topnum=0,this.declaredClass="esri.arcade.featureset.actions.Top",this._countedin=0,this._maxProcessing=100,this._topnum=E.topnum,this._parent=E.parentfeatureset}_getSet(E){var S=this;return(0,F.Z)(function*(){if(null===S._wset){yield S._ensureLoaded();const P=yield S._parent._getSet(E);return S._wset=new L.Z(P._candidates.slice(0),P._known.slice(0),!1,S._clonePageDefinition(P.pagesDefinition)),S._setKnownLength(S._wset)>S._topnum&&(S._wset._known=S._wset._known.slice(0,S._topnum)),S._setKnownLength(S._wset)>=S._topnum&&(S._wset._candidates=[]),S._wset}return S._wset})()}_setKnownLength(E){return E._known.length>0&&"GETPAGES"===E._known[E._known.length-1]?E._known.length-1:E._known.length}_isInFeatureSet(E){const S=this._parent._isInFeatureSet(E);if(S===A.dj.NotInFeatureSet)return S;const P=this._idstates[E];return P===A.dj.InFeatureSet||P===A.dj.NotInFeatureSet?P:S===A.dj.InFeatureSet&&void 0===P?this._countedin<this._topnum?(this._idstates[E]=A.dj.InFeatureSet,this._countedin++,A.dj.InFeatureSet):(this._idstates[E]=A.dj.NotInFeatureSet,A.dj.NotInFeatureSet):A.dj.Unknown}_expandPagedSet(E,S,P,j,C){var m=this;return(0,F.Z)(function*(){if(null===m._parent)throw new Q.EN(Q.H9.NotImplemented);if(S>m._topnum&&(S=m._topnum),m._countedin>=m._topnum&&E.pagesDefinition.internal.set.length<=E.pagesDefinition.resultOffset){let B=E._known.length;return B>0&&"GETPAGES"===E._known[B-1]&&(E._known.length=B-1),B=E._candidates.length,B>0&&"GETPAGES"===E._candidates[B-1]&&(E._candidates.length=B-1),"success"}const T=yield m._parent._expandPagedSet(E,S,P,j,C);return m._setKnownLength(E)>m._topnum&&(E._known.length=m._topnum),m._setKnownLength(E)>=m._topnum&&(E._candidates.length=0),T})()}_getFeatures(E,S,P,j){var C=this;return(0,F.Z)(function*(){const m=[],T=C._maxQueryRate();if(!0===C._checkIfNeedToExpandKnownPage(E,T))return yield C._expandPagedSet(E,T,0,0,j),C._getFeatures(E,S,P,j);-1!==S&&void 0===C._featureCache[S]&&m.push(S);let B=0;for(let D=E._lastFetchedIndex;D<E._known.length&&(B++,B<=P&&(E._lastFetchedIndex+=1),!(void 0===C._featureCache[E._known[D]]&&(E._known[D]!==S&&m.push(E._known[D]),m.length>T)));D++);if(0===m.length)return"success";const h=new L.Z([],m,!1,null),Z=Math.min(m.length,P);yield C._parent._getFeatures(h,-1,Z,j);for(let D=0;D<Z;D++){const p=C._parent._featureFromCache(m[D]);void 0!==p&&(C._featureCache[m[D]]=p)}return"success"})()}_getFilteredSet(E,S,P,j,C){var m=this;return(0,F.Z)(function*(){yield m._ensureLoaded();const T=yield m._getSet(C);return new L.Z(T._candidates.slice(0).concat(T._known.slice(0)),[],!1,m._clonePageDefinition(T.pagesDefinition))})()}_refineKnowns(E,S){let P=0,j=null;const C=[];for(let m=0;m<E._candidates.length;m++){const T=this._isInFeatureSet(E._candidates[m]);if(T===A.dj.InFeatureSet){if(E._known.push(E._candidates[m]),P+=1,null===j?j={start:m,end:m}:j.end===m-1?j.end=m:(C.push(j),j={start:m,end:m}),E._known.length>=this._topnum)break}else if(T===A.dj.NotInFeatureSet)null===j?j={start:m,end:m}:j.end===m-1?j.end=m:(C.push(j),j={start:m,end:m}),P+=1;else if(T===A.dj.Unknown)break;if(P>=S)break}null!==j&&C.push(j);for(let m=C.length-1;m>=0;m--)E._candidates.splice(C[m].start,C[m].end-C[m].start+1);this._setKnownLength(E)>this._topnum&&(E._known=E._known.slice(0,this._topnum)),this._setKnownLength(E)>=this._topnum&&(E._candidates=[])}_stat(){return(0,F.Z)(function*(){return{calculated:!1}})()}_canDoAggregates(){return(0,F.Z)(function*(){return!1})()}static registerAction(){K.Z._featuresetFunctions.top=function(E){return new G({parentfeatureset:this,topnum:E})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}},16776:(ne,$,f)=>{f.d($,{Z:()=>T});var F=f(15861),Q=f(88879),K=f(47982),L=f(49086),A=f(91510),G=f(77132),U=f(83947),E=f(21674),S=f(80415),P=f(81976),j=f(41638),C=f(36255),m=f(96854);class T extends L.Z{constructor(h){super(h),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerMemory",this._removeGeometry=!1,this._overrideFields=null,this._forceIsTable=!1,h.spatialReference&&(this.spatialReference=h.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=h.layer,this._wset=null,!0===h.isTable&&(this._forceIsTable=!0),void 0!==h.outFields&&(this._overrideFields=h.outFields),void 0!==h.includeGeometry&&(this._removeGeometry=!1===h.includeGeometry)}_maxQueryRate(){return G.tI}end(){return this._layer}optimisePagingFeatureQueries(){}loadImpl(){var h=this;return(0,F.Z)(function*(){return!0===h._layer.loaded?(h._initialiseFeatureSet(),h):(yield h._layer.load(),h._initialiseFeatureSet(),h)})()}get gdbVersion(){return""}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const h=[],Z=[];for(const D of this.fields)if("oid"===D.type)h.push(D),Z.push(D.name);else for(const p of this._overrideFields)if(p.toLowerCase()===D.name.toLowerCase()){h.push(D),Z.push(D.name);break}this.fields=h,this._overrideFields=Z}this.objectIdField=this._layer.objectIdField;for(const h of this.fields)"global-id"===h.type&&(this.globalIdField=h.name);this._databaseType=G.Bj.Standardised,this.hasZ=!0===this._layer?.capabilities?.data?.supportsZ,this.hasM=!0===this._layer?.capabilities?.data?.supportsM,this._layer instanceof P.default?(this.subtypeField=this._layer.subtypeField??"",this.subtypes=this._layer.subtypes,this.types=null,this.typeIdField=null):(this.typeIdField=this._layer.typeIdField??"",this.types=this._layer.types,this.subtypeField=this._layer.subtypeField,this.subtypes=this._layer.subtypes)}isTable(){return this._forceIsTable||this._layer.isTable||"table"===this._layer.type||!this._layer.geometryType}_isInFeatureSet(){return G.dj.InFeatureSet}_candidateIdTransform(h){return h}_getSet(h){var Z=this;return(0,F.Z)(function*(){if(null===Z._wset){yield Z._ensureLoaded();const D=yield Z._getFilteredSet("",null,null,null,h);return Z._wset=D,D}return Z._wset})()}_changeFeature(h){const Z={};for(const D of this.fields)Z[D.name]=h.attributes[D.name];return new Q.Z({geometry:!0===this._removeGeometry?null:h.geometry,attributes:Z})}_getFilteredSet(h,Z,D,p,u){var _=this;return(0,F.Z)(function*(){let c="",g=!1;if(null!==p&&(c=p.constructClause(),g=!0),_.isTable()&&Z&&null!==h&&""!==h)return new A.Z([],[],!0,null);const y=new m.Z;y.returnZ=_.hasZ,y.returnM=_.hasM,y.where=null===D?null===Z?"1=1":"":(0,U.zR)(D,G.Bj.Standardised),y.spatialRelationship=_._makeRelationshipEnum(h),y.outSpatialReference=_.spatialReference,y.orderByFields=""!==c?c.split(","):null,y.geometry=null===Z?null:Z,y.returnGeometry=!0,y.relationParameter=_._makeRelationshipParam(h);const R=yield _._layer.queryFeatures(y);if(null===R)return new A.Z([],[],g,null);_._checkCancelled(u);const O=[];return R.features.forEach(M=>{const x=M.attributes[_._layer.objectIdField];O.push(x),_._featureCache[x]=_._changeFeature(M)}),new A.Z([],O,g,null)})()}_makeRelationshipEnum(h){if(h.includes("esriSpatialRelRelation"))return"relation";switch(h){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return h}_makeRelationshipParam(h){return h.includes("esriSpatialRelRelation")?h.split(":")[1]:""}_queryAllFeatures(){var h=this;return(0,F.Z)(function*(){if(h._wset)return h._wset;const Z=new m.Z;if(Z.where="1=1",yield h._ensureLoaded(),h._layer.source&&h._layer.source.items){const u=[];return h._layer.source.items.forEach(_=>{const c=_.attributes[h._layer.objectIdField];u.push(c),h._featureCache[c]=h._changeFeature(_)}),h._wset=new A.Z([],u,!1,null),h._wset}Z.returnZ=h.hasZ,Z.returnM=h.hasM;const D=yield h._layer.queryFeatures(Z),p=[];return D.features.forEach(u=>{const _=u.attributes[h._layer.objectIdField];p.push(_),h._featureCache[_]=h._changeFeature(u)}),h._wset=new A.Z([],p,!1,null),h._wset})()}_getFeatures(h,Z,D){var p=this;return(0,F.Z)(function*(){const u=[];-1!==Z&&void 0===p._featureCache[Z]&&u.push(Z);for(let _=h._lastFetchedIndex;_<h._known.length&&(h._lastFetchedIndex+=1,!(void 0===p._featureCache[h._known[_]]&&(h._known[_]!==Z&&u.push(h._known[_]),u.length>D)));_++);if(0===u.length)return"success";throw new K.EN(K.H9.MissingFeatures)})()}_refineSetBlock(h){return(0,F.Z)(function*(){return h})()}_stat(){return(0,F.Z)(function*(){return{calculated:!1}})()}_canDoAggregates(){return(0,F.Z)(function*(){return!1})()}relationshipMetaData(){return[]}static _cloneAttr(h){const Z={};for(const D in h)Z[D]=h[D];return Z}nativeCapabilities(){return{title:this._layer.title??"",canQueryRelated:!1,source:this,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:!0}}static create(h,Z){let D=h.layerDefinition.objectIdField;const p=h.layerDefinition.typeIdField??"",u=[];if(h.layerDefinition.types)for(const v of h.layerDefinition.types)u.push(j.Z.fromJSON(v));let _=h.layerDefinition.geometryType;void 0===_&&(_=h.featureSet.geometryType||"");let c=h.featureSet.features;const g=Z.toJSON();if(!D){let v=!1;for(const k of h.layerDefinition.fields)if("oid"===k.type||"esriFieldTypeOID"===k.type){D=k.name,v=!0;break}if(!1===v){let k="FID",z=!0,ie=0;for(;z;){let re=!0;for(const te of h.layerDefinition.fields)if(te.name===k){re=!1;break}!0===re?z=!1:(ie++,k="FID"+ie.toString())}h.layerDefinition.fields.push({type:"esriFieldTypeOID",name:k,alias:k});const le=[];for(let re=0;re<c.length;re++)le.push({geometry:h.featureSet.features[re].geometry,attributes:h.featureSet.features[re].attributes?this._cloneAttr(h.featureSet.features[re].attributes):{}}),le[re].attributes[k]=re;c=le,D=k}}const y=[];for(const v of h.layerDefinition.fields)y.push(v instanceof C.Z?v:C.Z.fromJSON(v));let R=_;switch(R||(R=""),R){case"esriGeometryPoint":R="point";break;case"esriGeometryPolyline":R="polyline";break;case"esriGeometryPolygon":R="polygon";break;case"esriGeometryEnvelope":R="extent";break;case"esriGeometryMultipoint":R="multipoint";break;case"":case"esriGeometryNull":R="esriGeometryNull"}if("esriGeometryNull"!==R)for(const v of c)v.geometry&&!(v.geometry instanceof E.Z)&&(v.geometry.type=R,void 0===v.geometry.spatialReference&&(v.geometry.spatialReference=g));else for(const v of c)v.geometry&&(v.geometry=null);const O={outFields:["*"],source:c,fields:y,hasZ:!0===h?.layerDefinition?.hasZ||!0===h?.featureSet?.hasZ,hasM:!0===h?.layerDefinition?.hasM||!0===h?.featureSet?.hasM,types:u,typeIdField:p,objectIdField:D,spatialReference:Z},M="esriGeometryNull"===R||null===R;M||(O.geometryType=R);const x=new S.default(O);return h?.layerDefinition?.subtypeField&&h?.layerDefinition?.subtypes&&x.read({subtypes:h.layerDefinition.subtypes,subtypeField:h.layerDefinition.subtypeField}),new T({layer:x,spatialReference:Z,isTable:M})}queryAttachments(){return(0,F.Z)(function*(){return[]})()}getFeatureByObjectId(h){var Z=this;return(0,F.Z)(function*(){const D=new m.Z;D.where=Z.objectIdField+"="+h.toString(),D.returnZ=Z.hasZ,D.returnM=Z.hasM;const p=yield Z._layer.queryFeatures(D);return 1===p.features.length?p.features[0]:null})()}getOwningSystemUrl(){return(0,F.Z)(function*(){return""})()}getIdentityUser(){return(0,F.Z)(function*(){return""})()}get preferredTimeZone(){return this._layer.preferredTimeZone??null}get dateFieldsTimeZone(){return this._layer.dateFieldsTimeZone??null}get datesInUnknownTimezone(){return this._layer?.datesInUnknownTimezone}get editFieldsInfo(){return this._layer?.editFieldsInfo}get timeInfo(){return this._layer?.timeInfo}getFeatureSetInfo(){var h=this;return(0,F.Z)(function*(){const Z=h._layer.title&&h._layer.parent;return h.fsetInfo??{layerId:null,layerName:null,itemId:null,serviceLayerUrl:null,webMapLayerId:Z?h._layer.id??null:null,webMapLayerTitle:Z?h._layer.title??null:null,className:null,objectClassId:null}})()}}},57366:(ne,$,f)=>{function F(K,L){return K===L?0:null===K?-1:null===L?1:K<L?-1:1}f.d($,{Z:()=>Q});class Q{constructor(L){const A=L.split(",");this._fields=[],this._directions=[];for(let G=0;G<A.length;G++){const U=A[G].match(/\S+/g);this._fields.push(U[0]),2===U.length?"asc"===U[1].toLowerCase()?this._directions.push(1):this._directions.push(0):this._directions.push(1)}}constructClause(){let L="";for(let A=0;A<this._fields.length;A++)0!==A&&(L+=","),L+=this._fields[A],L+=1===this._directions[A]?" ASC":" DESC";return L}order(L){L.sort((A,G)=>{for(let U=0;U<this._fields.length;U++){const E=this.featureValue(A.feature,this._fields[U],U),S=this.featureValue(G.feature,this._fields[U],U);let P=0;if(P=1===this._directions[U]?F(E,S):-1*F(E,S),0!==P)return P}return 0})}scanForField(L){for(let A=0;A<this._fields.length;A++)if(this._fields[A].toLowerCase().trim()===L.toLowerCase().trim())return!0;return!1}replaceFields(L){let A="";for(let G=0;G<this._fields.length;G++){0!==G&&(A+=",");let U=this._fields[G];for(const E of L)if(U.toLowerCase()===E.field.toLowerCase()){U=E.newfield;break}A+=U,A+=1===this._directions[G]?" ASC":" DESC"}return new Q(A)}featureValue(L,A,G){const U=L.attributes[A];if(void 0!==U)return U;for(const E in L.attributes)if(A.toLowerCase()===E.toLowerCase())return this._fields[G]=E,L.attributes[E];return null}}},35391:(ne,$,f)=>{f.d($,{$6:()=>D,$z:()=>K,F7:()=>Q,Ow:()=>U,S0:()=>G,d1:()=>E,dm:()=>S});const F=[["binary","application/octet-stream","bin",""]];function Q(p,u){return null!=m(u.name,p?.supportedFormats??[])}function K(p,u){if(!p)return!1;const _=S(u,p.supportedFormats??[]);return null!=_&&p.editFormats.includes(_)}function G(p,u){return T(function C(p,u){const _=p.toLowerCase();return P(u).find(c=>B(c)===_)}(p,u))}function U(p,u){return T(m(p,u))}function E(p,u){return B(function j(p,u){return P(u).find(_=>T(_)===p)}(p,u))}function S(p,u){return U(p.name,u)??G(p.type,u)}function P(p){return[...F,...p]}function m(p,u){const _=p.toLowerCase();return P(u).find(c=>function h(p){return p?.[2].split(",").map(u=>u.toLowerCase())??[]}(c).some(g=>_.endsWith(g)))}function T(p){return p?.[0]}function B(p){return p?.[1].toLowerCase()}function D(p){return p.tables?.find(u=>"assetMaps"===u.role)}},76391:(ne,$,f)=>{function F(Q){const K={};for(const L in Q){if("declaredClass"===L)continue;const A=Q[L];if(null!=A&&"function"!=typeof A)if(Array.isArray(A)){K[L]=[];for(let G=0;G<A.length;G++)K[L][G]=F(A[G])}else"object"==typeof A?A.toJSON&&(K[L]=JSON.stringify(A)):K[L]=A}return K}f.d($,{A:()=>F})},90463:(ne,$,f)=>{f.d($,{P:()=>A});var F=f(15861),Q=f(2618),K=f(20477),L=f(96854);function A(U,E,S){return G.apply(this,arguments)}function G(){return(G=(0,F.Z)(function*(U,E,S){const P=(0,Q.en)(U);return(0,K.hH)(P,L.Z.from(E),{...S}).then(j=>j.data.count)})).apply(this,arguments)}},24865:(ne,$,f)=>{f.d($,{G:()=>A});var F=f(15861),Q=f(2618),K=f(20477),L=f(96854);function A(U,E,S){return G.apply(this,arguments)}function G(){return(G=(0,F.Z)(function*(U,E,S){const P=(0,Q.en)(U);return(0,K.Ev)(P,L.Z.from(E),{...S}).then(j=>j.data.objectIds)})).apply(this,arguments)}},2865:(ne,$,f)=>{f.d($,{F:()=>E,e:()=>G});var F=f(15861),Q=f(2618),K=f(20477),L=f(17253),A=f(96854);function G(P,j,C){return U.apply(this,arguments)}function U(){return(U=(0,F.Z)(function*(P,j,C){const m=yield E(P,j,C);return L.Z.fromJSON(m)})).apply(this,arguments)}function E(P,j,C){return S.apply(this,arguments)}function S(){return(S=(0,F.Z)(function*(P,j,C){const m=(0,Q.en)(P),T={...C},B=A.Z.from(j),{data:h}=yield(0,K.JT)(m,B,B.sourceSpatialReference,T);return h})).apply(this,arguments)}},20721:(ne,$,f)=>{f.d($,{t:()=>p});var F=f(15861),Q=f(2618),K=f(62208),L=f(33696),A=f(82054);function G(_,c){return c}function U(_,c,g,y){switch(g){case 0:return j(_,c+y,0);case 1:return"lowerLeft"===_.originPosition?j(_,c+y,1):function C({translate:_,scale:c},g,y){return _[y]-g*c[y]}(_,c+y,1)}}function E(_,c,g,y){return 2===g?j(_,c,2):U(_,c,g,y)}function S(_,c,g,y){return 2===g?0===c?0:j(_,c,3):U(_,c,g,y)}function P(_,c,g,y){return 3===g?0===c?0:j(_,c,3):E(_,c,g,y)}function j({translate:_,scale:c},g,y){return _[y]+g*c[y]}class m{constructor(c){this._options=c,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this._previousCoordinate=[0,0],this._transform=null,this._applyTransform=G,this._lengths=[],this._currentLengthIndex=0,this._toAddInCurrentPath=0,this._vertexDimension=0,this._mValueOffset=null,this._coordinateBuffer=null,this._coordinateBufferPtr=0,this._attributesConstructor=class{}}createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(c){if(this._options.applyTransform&&(c.transform=null),this._attributesConstructor=class{},this._coordinateBuffer=null,this._lengths.length=0,!c.hasZ)return;const g=(0,L.k)(c.geometryType,this._options.sourceSpatialReference,c.spatialReference);if(null!=g)for(const y of c.features)g(y.geometry)}createSpatialReference(){return{}}addField(c,g){const y=c.fields;(0,K.O3)(y),y.push(g);const R=y.map(O=>O.name);this._attributesConstructor=function(){for(const O of R)this[O]=null}}addFeature(c,g){c.features.push(g)}prepareFeatures(c){switch(this._transform=c.transform,this._options.applyTransform&&c.transform&&(this._applyTransform=this._deriveApplyTransform(c)),this._mValueOffset=null,this._vertexDimension=2,c.hasZ&&this._vertexDimension++,c.hasM&&(this._mValueOffset=this._vertexDimension,this._vertexDimension++),c.geometryType){case"esriGeometryPoint":this.addCoordinate=(g,y,R)=>this.addCoordinatePoint(g,y,R),this.createGeometry=g=>this.createPointGeometry(g);break;case"esriGeometryPolygon":this.addCoordinate=(g,y,R)=>this._addCoordinatePolygon(g,y,R),this.createGeometry=g=>this._createPolygonGeometry(g);break;case"esriGeometryPolyline":this.addCoordinate=(g,y,R)=>this._addCoordinatePolyline(g,y,R),this.createGeometry=g=>this._createPolylineGeometry(g);break;case"esriGeometryMultipoint":this.addCoordinate=(g,y,R)=>this._addCoordinateMultipoint(g,y,R),this.createGeometry=g=>this._createMultipointGeometry(g)}}createFeature(){return this._lengths.length=0,this._currentLengthIndex=0,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0,this._coordinateBuffer=null,this._coordinateBufferPtr=0,{attributes:new this._attributesConstructor}}allocateCoordinates(){}addLength(c,g,y){0===this._lengths.length&&(this._toAddInCurrentPath=g),this._lengths.push(g)}addQueryGeometry(c,g){const{queryGeometry:y,queryGeometryType:R}=g,O=(0,A.$g)(y.clone(),y,!1,!1,this._transform),M=(0,A.di)(O,R,!1,!1);c.queryGeometryType=R,c.queryGeometry={...M}}createPointGeometry(c){const g={x:0,y:0,spatialReference:c.spatialReference};return c.hasZ&&(g.z=0),c.hasM&&(g.m=0),g}addCoordinatePoint(c,g,y){switch(g=this._applyTransform(this._transform,g,y,0),y){case 0:c.x=g;break;case 1:c.y=g;break;case 2:"z"in c?c.z=g:c.m=g;break;case 3:c.m=g}}_transformPathLikeValue(c,g){let y=0;return g<=1&&(y=this._previousCoordinate[g],this._previousCoordinate[g]+=c),null===this._mValueOffset||0!==c||g%this._mValueOffset?this._applyTransform(this._transform,c,g,y):0}_addCoordinatePolyline(c,g,y){this._dehydratedAddPointsCoordinate(c.paths,g,y)}_addCoordinatePolygon(c,g,y){this._dehydratedAddPointsCoordinate(c.rings,g,y)}_addCoordinateMultipoint(c,g,y){0===y&&c.points.push([]);const R=this._transformPathLikeValue(g,y);c.points[c.points.length-1].push(R)}_createPolygonGeometry(c){return{rings:[[]],spatialReference:c.spatialReference,hasZ:!!c.hasZ,hasM:!!c.hasM}}_createPolylineGeometry(c){return{paths:[[]],spatialReference:c.spatialReference,hasZ:!!c.hasZ,hasM:!!c.hasM}}_createMultipointGeometry(c){return{points:[],spatialReference:c.spatialReference,hasZ:!!c.hasZ,hasM:!!c.hasM}}_dehydratedAddPointsCoordinate(c,g,y){0===y&&0==this._toAddInCurrentPath--&&(c.push([]),this._toAddInCurrentPath=this._lengths[++this._currentLengthIndex]-1,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0);const R=this._transformPathLikeValue(g,y),O=c[c.length-1];0===y&&(this._coordinateBufferPtr=0,this._coordinateBuffer=new Array(this._vertexDimension),O.push(this._coordinateBuffer)),this._coordinateBuffer[this._coordinateBufferPtr++]=R}_deriveApplyTransform(c){const{hasZ:g,hasM:y}=c;return g&&y?P:g?E:y?S:U}}var T=f(20477),h=(f(17253),f(96854));function p(_,c,g){return u.apply(this,arguments)}function u(){return(u=(0,F.Z)(function*(_,c,g){const y=(0,Q.en)(_),R={...g},O=h.Z.from(c),M=!O.quantizationParameters,{data:x}=yield(0,T.qp)(y,O,new m({sourceSpatialReference:O.sourceSpatialReference,applyTransform:M}),R);return x})).apply(this,arguments)}},20477:(ne,$,f)=>{f.d($,{Ev:()=>D,JT:()=>m,Vn:()=>c,Vr:()=>u,hH:()=>p,n7:()=>Z,qp:()=>B});var F=f(15861),Q=f(84792),K=f(21726),L=f(91179),A=f(93555),G=f(37053),U=f(76391),E=f(85262),S=f(61515);const P="Layer does not support extent calculation.";function C(R,O){const M=R.geometry,x=R.toJSON();delete x.compactGeometryEnabled,delete x.defaultSpatialReferenceEnabled;const v=x;let k,z,ie;if(null!=M&&(z=M.spatialReference,ie=(0,G.B9)(z),v.geometryType=(0,L.Ji)(M),v.geometry=function j(R,O){if(O&&"extent"===R.type)return`${R.xmin},${R.ymin},${R.xmax},${R.ymax}`;if(O&&"point"===R.type)return`${R.x},${R.y}`;const M=R.toJSON();return delete M.spatialReference,JSON.stringify(M)}(M,R.compactGeometryEnabled),v.inSR=ie),x.groupByFieldsForStatistics&&(v.groupByFieldsForStatistics=x.groupByFieldsForStatistics.join(",")),x.objectIds&&(v.objectIds=x.objectIds.join(",")),x.orderByFields&&(v.orderByFields=x.orderByFields.join(",")),!x.outFields||!x.returnDistinctValues&&(O?.returnCountOnly||O?.returnExtentOnly||O?.returnIdsOnly)?delete v.outFields:v.outFields=x.outFields.includes("*")?"*":x.outFields.join(","),x.outSR?(v.outSR=(0,G.B9)(x.outSR),k=R.outSpatialReference):M&&(x.returnGeometry||x.returnCentroid)&&(v.outSR=v.inSR,k=z),x.returnGeometry&&delete x.returnGeometry,x.outStatistics&&(v.outStatistics=JSON.stringify(x.outStatistics)),x.fullText&&(v.fullText=JSON.stringify(x.fullText)),x.pixelSize&&(v.pixelSize=JSON.stringify(x.pixelSize)),x.quantizationParameters&&(R.defaultSpatialReferenceEnabled&&null!=z&&null!=R.quantizationParameters?.extent&&z.equals(R.quantizationParameters.extent.spatialReference)&&delete x.quantizationParameters.extent.spatialReference,v.quantizationParameters=JSON.stringify(x.quantizationParameters)),x.parameterValues&&(v.parameterValues=JSON.stringify(x.parameterValues)),x.rangeValues&&(v.rangeValues=JSON.stringify(x.rangeValues)),x.dynamicDataSource&&(v.layer=JSON.stringify({source:x.dynamicDataSource}),delete x.dynamicDataSource),x.timeExtent){const le=x.timeExtent,{start:re,end:te}=le;null==re&&null==te||(v.time=re===te?re:`${re??"null"},${te??"null"}`),delete x.timeExtent}return R.defaultSpatialReferenceEnabled&&null!=z&&null!=k&&z.equals(k)&&(v.defaultSR=v.inSR,delete v.inSR,delete v.outSR),v}function m(R,O,M,x){return T.apply(this,arguments)}function T(){return(T=(0,F.Z)(function*(R,O,M,x){const v=null!=O.timeExtent&&O.timeExtent.isEmpty?{data:{features:[]}}:yield c(R,O,"json",x);return(0,S.p)(O,M,v.data),v})).apply(this,arguments)}function B(R,O,M,x){return h.apply(this,arguments)}function h(){return(h=(0,F.Z)(function*(R,O,M,x){if(null!=O.timeExtent&&O.timeExtent.isEmpty)return{data:M.createFeatureResult()};const v=yield Z(R,O,x),k=v;return k.data=(0,E.C)(v.data,M),k})).apply(this,arguments)}function Z(R,O,M){return c(R,O,"pbf",M)}function D(R,O,M){return null!=O.timeExtent&&O.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):c(R,O,"json",M,{returnIdsOnly:!0})}function p(R,O,M){return null!=O.timeExtent&&O.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):c(R,O,"json",M,{returnIdsOnly:!0,returnCountOnly:!0})}function u(R,O,M){return _.apply(this,arguments)}function _(){return(_=(0,F.Z)(function*(R,O,M){if(null!=O.timeExtent&&O.timeExtent.isEmpty)return{data:{count:0,extent:null}};const x=yield c(R,O,"json",M,{returnExtentOnly:!0,returnCountOnly:!0}),v=x.data;if(v.hasOwnProperty("extent"))return x;if(v.features)throw new Error(P);if(v.hasOwnProperty("count"))throw new Error(P);return x})).apply(this,arguments)}function c(R,O,M){return g.apply(this,arguments)}function g(){return(g=(0,F.Z)(function*(R,O,M,x={},v={}){const k="string"==typeof R?(0,K.mN)(R):R,z=O.geometry?[O.geometry]:[],le=(yield(0,A.aX)(z,null,{signal:x.signal}))?.[0];null!=le&&((O=O.clone()).geometry=le);const re=(0,U.A)({...k.query,f:M,...v,...C(O,v)});return(0,Q.Z)((0,K.v_)(k.path,function y(R,O){return null!=R.formatOf3DObjects&&!(O.returnCountOnly||O.returnExtentOnly||O.returnIdsOnly)}(O,v)?"query3d":"query"),{...x,responseType:"pbf"===M?"array-buffer":"json",query:{...re,...x.query}})})).apply(this,arguments)}},87183:(ne,$,f)=>{f.d($,{Z:()=>m});var P,F=f(17626),Q=f(86810),K=f(77712),L=f(90912),U=(f(4619),f(8314),f(76898));const j={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let C=P=class extends Q.wq{constructor(T){super(T),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:T}=this,B=function E(T){const{exifInfo:B,exifName:h,tagName:Z}=T;if(!B||!h||!Z)return null;const D=B.find(p=>p.name===h);return D?function S(T){const{tagName:B,tags:h}=T;return h&&B&&h.find(D=>D.name===B)?.value||null}({tagName:Z,tags:D.tags}):null}({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:T});return j[B]||null}clone(){return new P({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};(0,F._)([(0,K.Cb)({type:String})],C.prototype,"contentType",void 0),(0,F._)([(0,K.Cb)()],C.prototype,"exifInfo",void 0),(0,F._)([(0,K.Cb)({readOnly:!0})],C.prototype,"orientationInfo",null),(0,F._)([(0,K.Cb)({type:L.z8})],C.prototype,"id",void 0),(0,F._)([(0,K.Cb)({type:String})],C.prototype,"globalId",void 0),(0,F._)([(0,K.Cb)({type:String})],C.prototype,"keywords",void 0),(0,F._)([(0,K.Cb)({type:String})],C.prototype,"name",void 0),(0,F._)([(0,K.Cb)({json:{read:!1}})],C.prototype,"parentGlobalId",void 0),(0,F._)([(0,K.Cb)({json:{read:!1}})],C.prototype,"parentObjectId",void 0),(0,F._)([(0,K.Cb)({type:L.z8})],C.prototype,"size",void 0),(0,F._)([(0,K.Cb)({json:{read:!1}})],C.prototype,"url",void 0),C=P=(0,F._)([(0,U.j)("esri.layers.support.AttachmentInfo")],C);const m=C}}]);