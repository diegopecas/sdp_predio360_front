"use strict";(self.webpackChunkpredio360_app=self.webpackChunkpredio360_app||[]).push([[1269],{21269:(I,v,i)=>{i.r(v),i.d(v,{default:()=>U});var p=i(15861),L=i(17626),E=i(10699),b=(i(63290),i(8314),i(4619),i(26584),i(76898)),h=i(79800),a=i(29302),m=i(13777),g=i(97126),C=i(82274),y=i(17827);function x(t,e,n){const s=(0,g.c)(),o=(0,g.g)(s);return(0,h.r)(o,o,t,.5),(0,h.r)(o,o,e,.5),s[3]=(0,h.q)(o,t),(0,h.g)(o,o,n),s}let f=class{constructor(){this._idToComponent=new Map,this._components=new C.Z(t=>t.bounds),this._edges=new C.Z(t=>t.bounds),this._tmpLineSegment=(0,m.Ue)(),this._tmpP1=(0,a.Ue)(),this._tmpP2=(0,a.Ue)(),this._tmpP3=(0,a.Ue)(),this.remoteClient=null}fetchCandidates(t,e){var n=this;return(0,p.Z)(function*(){yield Promise.resolve(),(0,E.k_)(e),yield n._ensureEdgeLocations(t,e);const s=[];return n._edges.forEachNeighbor(o=>(n._addCandidates(t,o,s),s.length<1e3),t.bounds),{result:{candidates:s}}})()}_ensureEdgeLocations(t,e){var n=this;return(0,p.Z)(function*(){const s=[];if(n._components.forEachNeighbor(r=>{if(null==r.info){const{id:c,uid:d}=r;s.push({id:c,uid:d})}return!0},t.bounds),!s.length)return;const o={components:s},u=yield n.remoteClient.invoke("fetchAllEdgeLocations",o,e??{});for(const r of u.components)n._setFetchEdgeLocations(r)})()}add(t){var e=this;return(0,p.Z)(function*(){const n=new V(t.id,t.bounds);return e._idToComponent.set(n.id,n),e._components.add([n]),{result:{}}})()}remove(t){var e=this;return(0,p.Z)(function*(){const n=e._idToComponent.get(t.id);if(n){const s=[];e._edges.forEachNeighbor(o=>(o.component===n&&s.push(o),!0),n.bounds),e._edges.remove(s),e._components.remove([n]),e._idToComponent.delete(n.id)}return{result:{}}})()}_setFetchEdgeLocations(t){const e=this._idToComponent.get(t.id);if(null==e||t.uid!==e.uid)return;const n=y.n_.createView(t.locations),s=new Array(n.count),o=(0,a.Ue)(),u=(0,a.Ue)();for(let d=0;d<n.count;d++){n.position0.getVec(d,o),n.position1.getVec(d,u);const l=x(o,u,t.origin),j=new P(e,d,l);s[d]=j}this._edges.add(s);const{objectIds:r,origin:c}=t;e.info={locations:n,objectIds:r,origin:c}}_addCandidates(t,e,n){const{info:s}=e.component,{origin:o,objectIds:u}=s,r=s.locations,c=r.position0.getVec(e.index,this._tmpP1),d=r.position1.getVec(e.index,this._tmpP2);(0,h.g)(c,c,o),(0,h.g)(d,d,o);const l=u[r.componentIndex.get(e.index)];this._addEdgeCandidate(t,l,c,d,n),this._addVertexCandidate(t,l,c,n),this._addVertexCandidate(t,l,d,n)}_addEdgeCandidate(t,e,n,s,o){if(!t.returnEdge)return;const u=(0,g.g)(t.bounds),r=(0,m.zk)(n,s,this._tmpLineSegment),c=(0,m.nF)(r,u,this._tmpP3);(0,g.n)(t.bounds,c)&&o.push({type:"edge",objectId:e,target:(0,a.d9)(c),distance:(0,h.q)(u,c),start:(0,a.d9)(n),end:(0,a.d9)(s)})}_addVertexCandidate(t,e,n,s){if(!t.returnVertex||!(0,g.n)(t.bounds,n))return;const o=(0,g.g)(t.bounds);s.push({type:"vertex",objectId:e,target:(0,a.d9)(n),distance:(0,h.q)(o,n)})}};f=(0,L._)([(0,b.j)("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],f);const U=f;let V=(()=>{class t{constructor(n,s){this.id=n,this.bounds=s,this.info=null,this.uid=++t.uid}}return t.uid=0,t})();class P{constructor(e,n,s){this.component=e,this.index=n,this.bounds=s}}}}]);